<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>javascript常用中英文惯译法</title>
      <link href="/2022/12/06/javascript%E5%B8%B8%E7%94%A8%E4%B8%AD%E8%8B%B1%E6%96%87%E6%83%AF%E8%AF%91%E6%B3%95/"/>
      <url>/2022/12/06/javascript%E5%B8%B8%E7%94%A8%E4%B8%AD%E8%8B%B1%E6%96%87%E6%83%AF%E8%AF%91%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>javascript常用中英文惯译法<br><a id="more"></a></p><h2 id="语法或词法分析"><a href="#语法或词法分析" class="headerlink" title="语法或词法分析"></a>语法或词法分析</h2><blockquote><p>标识符（identifier）<br>标签（label）<br>关键字，保留字（keyword,reserved words）<br>符号（symbol）<br>标记，记号（token）<br>数据类型（types,data types）<br>无类型的（untepe-）<br>变量（variable）<br>声明（declare）<br>赋值（assignment）<br>解构赋值（destructuring assignment）<br>未赋值变量（unassigned variable）<br>未声明变量（undeclared variable）<br>值（values）<br>常量，常数，常值（constant,const）<br>直接量，字面量（literal,literal constant,manifest constant）<br>指数计数法，科学计数法（exponential notation）<br>定点计数法（fixed-point notation）<br>代码逻辑行，物理行（logical line,physical line）<br>语句（statements）<br>语句块（statement block）<br>简单语句（simple statements）<br>单行语句（single line statements）<br>复合语句（compound statements）<br>条件（condition）<br>表达式（expression）<br>一元运算符，单目运算符（unary operator）<br>二元运算符（binary operator）<br>运算符优先级（precedence）<br>运算符，操作符，操作数（operator）</p></blockquote><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><blockquote><p>数组（array）<br>关联数组（associative array）<br>索引数组（index array）<br>多维数组（multidimensional array）<br>动态数组（dynamic arry）<br>变长数组（variable length array）<br>元素（element）<br>索引，下标（index）<br>字符串（string）<br>Unicode 字符串（Unicode string）<br>转义序列（escape sequence）</p></blockquote><h2 id="编程范型（面向对象，函数式等）"><a href="#编程范型（面向对象，函数式等）" class="headerlink" title="编程范型（面向对象，函数式等）"></a>编程范型（面向对象，函数式等）</h2><blockquote><p>编程范型（programming paradigm）<br>多范型语言（multi-paradigm language）<br>动态绑定（dynamic bind）<br>作用域（scope）<br>引用（reference）<br>域，成员，字段（member,field）<br>类（class）<br>继承（inheritance）<br>多态（polymorphism）<br>封装（encapsulation）<br>类方法（class method）<br>虚方法（virtual method）<br>纯虚方法，抽象方法（abstract method）<br>覆盖（override）<br>对象（object）<br>实例（instance）<br>原型（prototype）<br>构造器，构造函数（constructor,constructor function）<br>属性（property）<br>方法（method）<br>用户定义属性（user-defined properties）<br>预定义属性（pre-defined properties）<br>内部（内建）属性/方法/成员（build-in properties/method/member）<br>事件（event）<br>事件句柄，事件处理器，事件处理代码（event handle）<br>特性，性质，属性（attribute）<br>特性（feature）<br>函数（function）<br>参数（arguments）<br>外部局部变量（external local variable,upvalue）<br>lambda运算（lambda calculus）<br>闭包（closure）</p></blockquote><h2 id="编译、执行及其他"><a href="#编译、执行及其他" class="headerlink" title="编译、执行及其他"></a>编译、执行及其他</h2><p>解释器（interpreter）<br>运行期（runtime）<br>宿主（host）<br>上下文（context）<br>环境（environment）<br>执行环境，执行上下文（execution context）<br>异常（exception）<br>错误（error）<br>正则表达式（regular expression）<br>全局（global）<br>局部（local）<br>全局对象（global object）<br>全局变量（global variable）<br>局部变量（local variable）</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GPU和CSS硬件加速</title>
      <link href="/2022/10/21/GPU%E5%92%8CCSS%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/"/>
      <url>/2022/10/21/GPU%E5%92%8CCSS%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/</url>
      
        <content type="html"><![CDATA[<p>彻底搞懂GPU和CSS硬件加速<br><a id="more"></a></p><h2 id="从-cpu-聊起"><a href="#从-cpu-聊起" class="headerlink" title="从 cpu 聊起"></a>从 cpu 聊起</h2><p>cpu (central process) 是计算机的大脑，它提供了一套指令集，我们写的程序最终会通过 cpu 指令来控制的计算机的运行。</p><p>cpu 会对指令进行译码，然后通过逻辑电路执行该指令。整个执行的流程分为了多个阶段，叫做流水线。指令流水线包括取指令、译码、执行、取数、写回五步，这是一个指令周期。cpu 会不断的执行指令周期来完成各种任务。</p><p>指令和数据都会首先加载到内存中，在程序运行时依次取到 cpu 里。cpu 访问内存虽然比较快，但比起 cpu 执行速度来说还是比较慢的，为了缓解这种速度矛盾，cpu 设计了 3 级缓存，也就是 L1、L2、L3 的缓存。<br><img src="/2022/10/21/GPU和CSS硬件加速/1.webp" alt="img"><br>如图，多核 cpu 各核心都有自有独立的 L1、L2 缓存，然后共享 L3 缓存，这 3 级缓存容量是逐渐递增的，但是速度是逐渐下降的，但是也会比访问内存快一些。</p><p>有了这 3 级缓存以后，cpu 执行速度和访问内存速度的矛盾就可以得到缓解，不需要一直访问内存，cpu 每次会加载一个缓存行，也就是 64 字节大小的数据到缓存中。这样访问临近的数据的时候就可以直接访问缓存。</p><p>从内存中把数据和指令加载到 cpu 的缓存中，然后通过控制器控制指令的译码、执行，通过运算器进行运算，之后把结果写回内存。这就是 cpu 的工作流程。</p><p>cpu 每个核只有一个线程，也就是单控制流、单数据流。这样的架构导致 cpu 在一些场景下效率是不高的，比如 3d 渲染的场景。</p><h2 id="3d-渲染流程"><a href="#3d-渲染流程" class="headerlink" title="3d 渲染流程"></a>3d 渲染流程</h2><p>3d 的渲染首先是建立 3d 的模型，它由一系列三维空间中的顶点构成，3 个顶点构成一个三角形，然后所有的顶点构成的三角形拼接起来就是 3d 模型。<br><img src="/2022/10/21/GPU和CSS硬件加速/2.webp" alt="img"><br>顶点、三角形，这是 3d 的基础。3d 引擎首先要计算顶点数据，确定 3d 图形的形状。之后还要对每个面进行贴图，可以在每个三角形画上不同的纹理。</p><p>3d 图形要显示在二维的屏幕上就要做投影，这个投影的过程叫做光栅化。（光栅是一种光学仪器，在这里就代表 3d 投影到 2d 屏幕的过程）<br><img src="/2022/10/21/GPU和CSS硬件加速/3.webp" alt="img"><br>光栅化要计算 3d 图形投影到屏幕的每一个像素的颜色，计算完所有的像素之后会写到显存的帧缓冲区，完成了一帧的渲染，之后会继续这样计算下一帧。</p><p>也就是说，3d 渲染的流程是：</p><blockquote><p>计算顶点数据，构成 3d 的图形<br>给每个三角形贴图，画上纹理<br>投影到二维的屏幕，计算每个像素的颜色（光栅化）<br>把一帧的数据写入显存的帧缓冲区</p></blockquote><p>顶点的数量是非常庞大的，而 cpu 只能顺序的一个个计算，所以处理这种 3d 渲染会特别费劲，于是就出现了专门用于这种 3d 数据的并行计算的硬件，也就是 GPU。</p><h2 id="GPU-的构成"><a href="#GPU-的构成" class="headerlink" title="GPU 的构成"></a>GPU 的构成</h2><p>和 cpu 的一个一个数据计算不同，gpu 是并行的，有成百上千个核心用于并行计算。<br><img src="/2022/10/21/GPU和CSS硬件加速/4.webp" alt="img"><br>gpu 也是有着指令、译码、执行的流程，只不过，每个指令会并行执行 n 个计算，是单控制流多数据流的，而 cpu 是单控制流单数据流。</p><p>所以，对于 3d 渲染这种要计算成万个顶点数据和像素点的场景，GPU 会比 CPU 高效很多。</p><p>但是，gpu 全是优点么？也不是。</p><h2 id="cpu-和-gpu-的区别"><a href="#cpu-和-gpu-的区别" class="headerlink" title="cpu 和 gpu 的区别"></a>cpu 和 gpu 的区别</h2><p>cpu 是通用的，能够执行各种逻辑和运算，而 gpu 则是主要是用于并行计算大批量的重复任务，不能处理复杂逻辑。</p><p>如上图，cpu 中控制器和缓存占据了很大一部分，而 gpu 中这两部分则很少，但是有更多的核心用于计算。</p><p>两者对比的话，cpu 相当于一个大学生，能够解决各种难题，但是计算 1 万个加法就没那么快，而 gpu 就像一帮小学生，解决不了难题，但是计算加法这种就很快，因为人多。</p><p>也就是说如果逻辑复杂，那么只能用 cpu，如果只是计算量大，并且每个计算都比较重复，那就比较适合 gpu。</p><p>3d 的渲染中有大量这种重复却简单的计算，比如顶点数据和光栅化的像素数据，通过 gpu 就可以并发的一次计算成百上千个。</p><h2 id="opengl、webgl、css-硬件加速"><a href="#opengl、webgl、css-硬件加速" class="headerlink" title="opengl、webgl、css 硬件加速"></a>opengl、webgl、css 硬件加速</h2><p>显卡中集成了 gpu，提供了驱动，使用 gpu 能力需要使用驱动的 api。 gpu 的 api 有一套开源标准叫做 opengl，有三百多个函数，用于各种图形的绘制。（在 windows 下有一套自己的标准叫做 DirectX）</p><p>我们在网页中绘制 3d 图形是使用 webgl 的 api，而浏览器在实现 webgl 的时候也是基于 opengl 的 api，最终会驱动 gpu 进行渲染。</p><p>css 大部分样式还是通过 cpu 来计算的，但 css 中也有一些 3d 的样式和动画的样式，计算这些样式同样有很多重复且大量的计算任务，可以交给 gpu 来跑。</p><p>浏览器在处理下面的 css 的时候，会使用 gpu 渲染：</p><blockquote><p>transform<br>opacity<br>filter<br>will-change</p></blockquote><p>浏览器是把内容分到不同的图层分别渲染的，最后合并到一起，而触发 gpu 渲染会新建一个图层，把该元素样式的计算交给 gpu。</p><p>opacity 需要改变每个像素的值，符合重复且大量的特点，会新建图层，交给 gpu 渲染。transform 是动画，每个样式值的计算也符合重复且大量的特点，也默认会使用 gpu 加速。同理 fiter 也是一样。</p><p>这里要注意的是 gpu 硬件加速是需要新建图层的，而把该元素移动到新图层是个耗时操作，界面可能会闪一下，所以最好提前做。will-change 就是提前告诉浏览器在一开始就把元素放到新的图层，方便后面用 gpu 渲染的时候，不需要做图层的新建。</p><p>当然，有的时候我们想强制触发硬件渲染，就可以通过上面的属性，比如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">will-change: transform;</span><br></pre></td></tr></table></figure></p><p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform:translate3d(0, 0, 0);</span><br></pre></td></tr></table></figure></p><p>chrome devtools 可以看到是 cpu 渲染还是 gpu 渲染，打开 rendering 面板，勾选 layer borders，会发现蓝色和黄色的框。蓝色的是 cpu 渲染的，而黄色的是 gpu 渲染的。</p><p>比如这段文字，现在没有单独一个图层：<br><img src="/2022/10/21/GPU和CSS硬件加速/5.webp" alt="img"><br>添加一个 will-change: transform 的属性，浏览器会新建图层来渲染该元素，然后使用 gpu 渲染：<br><img src="/2022/10/21/GPU和CSS硬件加速/6.webp" alt="img"><br>gpu 硬件加速能减轻 cpu 压力，使得渲染更流畅，但是也会增加内存的占用，对于 transform、opacity、filter 默认会开启硬件加速。其余情况，建议只在必要的时候用。</p><h2 id="opencl-和神经网络"><a href="#opencl-和神经网络" class="headerlink" title="opencl 和神经网络"></a>opencl 和神经网络</h2><p>重复且大量的计算任务只有 3d 渲染一种场景么？</p><p>不是的，AI 领域的机器学习也很典型，它的特点是大量的神经元需要计算，但是每个计算都比较简单，也很适合用 gpu 来跑。</p><p>现在的 gpu 不只是能跑图形渲染，也提供了一些编程能力，这部分 api 有 opencl 标准。可以通过 gpu 的并行计算能力来跑一些有大量计算但是没有很多逻辑的的任务，会比 cpu 效率更高。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>cpu 提供了指令集，会不断的执行取指令、译码、执行、取数、写回的指令周期，控制着计算机的运转。</p><p>cpu 计算的速度比较快，而访问内存比较慢，为了缓和两者的矛盾，引入了 L1、L2、L3 的多级缓存体系，L1、L2、L3 是容器逐渐变大，访问速度逐渐变慢的关系，但还是比访问内存快。内存会通过一个缓存行（64 字节）的大小为单位来读入缓存，供 cpu 访问。</p><p>3d 渲染的流程是计算每一个顶点的数据，连成一个个三角形，然后进行纹理贴图，之后计算投影到二维屏幕的每一个像素的颜色，也就是光栅化，最后写入显存帧缓冲区，这样进行一帧帧的渲染。</p><p>cpu 的计算是一个个串行执行的，对于 3d 渲染这种涉及大量顶点、像素要计算的场景就不太合适，于是出现了 gpu。</p><p>gpu 可以并行执行大量重复的计算，有成百上千个计算单元，相比 cpu 虽然执行不了复杂逻辑，但是却能执行大量重复的运算。提供了 opengl 的标准 api。</p><p>css 中可以使用 gpu 加速渲染来减轻 cpu 压力，使得页面体验更流畅，默认 transform、opacity、filter 都会新建新的图层，交给 gpu 渲染。对于这样的元素可以使用 will-change: 属性名; 来告诉浏览器在最开始就把该元素放到新图层渲染。</p><p>gpu 的并行计算能力不只是 3d 渲染可以用，机器学习也有类似的场景，可以通过 opencl 的 api 来控制 gpu 进行计算。</p><p>gpu 和前端的关系还是挺密切的，不管是 webgl，还是 css 硬件加速，或者网页的性能都与之相关。希望这篇文章能够帮大家了解 gpu 的原理和应用。</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web图形 </tag>
            
            <tag> 3D </tag>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css中的单位</title>
      <link href="/2022/10/21/css%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BD%8D/"/>
      <url>/2022/10/21/css%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BD%8D/</url>
      
        <content type="html"><![CDATA[<p>css中的一些单位<br><a id="more"></a><br>说起CSS单位，我们最熟悉的可能就是像素单位（px），它是一个绝对单位，也就是说一个10px的文字，放在哪里都是一样大的。单位可以影响颜色、距离、尺寸等一系列的属性。CSS中单位的形式有很多种，下面就分别来看看这些单位。<br><img src="/2022/10/21/css中的单位/1.webp" alt="img"></p><h2 id="相对单位"><a href="#相对单位" class="headerlink" title="相对单位"></a>相对单位</h2><p>相对单位就是相对于另一个长度的长度。CSS中的相对单位主要分为两大类：</p><blockquote><p>字体相对单位，他们都是根据font-size来进行计算的。常见的字体相对单位有：em、rem、ex、ch；<br>视窗相对单位，他们都是根据视窗大小来决定的。常见的视窗相对单位有vw、vh、vmax、vmin。</p></blockquote><h3 id="em-和-rem"><a href="#em-和-rem" class="headerlink" title="em 和 rem"></a>em 和 rem</h3><h4 id="em"><a href="#em" class="headerlink" title="em"></a>em</h4><p>em是最常见的相对长度单位，适合基于特定的字号进行排版。根据CSS的规定，1em 等于元素的font-size属性的值。<br>em 是相对于父元素的字体大小进行计算的。如果当前对行内文本的字体尺寸未进行显示设置，则相对于浏览器的默认字体尺寸。当DOM元素嵌套加深时，并且同时给很多层级显式的设置了font-size的值的单位是em，那么就需要层层计算，复杂度会很高。<br><strong>如果自身元素是没有设置字体大小的，那么就会根据其父元素的字体大小作为参照去计算，如果元素本身已经设置了字体，那么就会基于自身的字体大小进行计算。</strong><br>em单位除了可以作用于 font-size之外，还可以运用于其他使用长度的属性，比如border-width、width、height、margin、padding、text-shadow等。<br>所以，em的使用还是比较复杂的，它可能会继承任意一级父元素的字体大小。需要谨慎使用。</p><h4 id="rem"><a href="#rem" class="headerlink" title="rem"></a>rem</h4><p>rem相对于em就简单了很多，它是根据页面的根元素（根元素）的字体大小来计算的。<br>如果没有对根元素设定字号的话，font-size: 1rem的作用与font-size: initial相同。</p><h4 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h4><p>使用 em 和 rem 可以让我们灵活的够控制元素整体的放大和缩小，而不是固定大小。那何时应使用 em，何时应使用 rem 呢？可以根据两者的差异来进行选择：</p><blockquote><p>两者在客户端中计算出来的样式都会以px的形式显示；<br>rem是相对于根元素html的font-size计算，em 相对于元素的font-size计算；<br>当需要根据浏览器的font-size设置缩放时，应该使用 rem；<br>使用 em 应该根据组件的font-size来定，而不是根元素的font-size来定；<br>rem 可以从浏览器字体设置中继承 font-size 值， em 可能受任何继承过来的父元素 font-size 的影响。</p></blockquote><h3 id="ex-和-ch"><a href="#ex-和-ch" class="headerlink" title="ex 和 ch"></a>ex 和 ch</h3><p>ex 和 ch 都是排版用的单位，它们的大小取决于元素的font-size 和 font-family属性。</p><blockquote><p>ex 指的是所用字体中小写字母 x 的高度。因此，如果两个字体不一样，那么 ex 的值是不一样的。因为每种字体的小写 x 的高度是不一样的。<br>ch 和 ex 类似，不过它是基于数字 0 的宽度计算的。会随着字体的变化而变化。而0 的宽度通常是对字体的平均字符宽度，它是一个估计值。由于 ch 是一个近似等宽的单元，所以在设置容器的宽度时很有用，比如一个容器想要显示指定个数的字符串时，就可以使用这个单位。</p></blockquote><h3 id="vw、vh、vmax-和-vmin"><a href="#vw、vh、vmax-和-vmin" class="headerlink" title="vw、vh、vmax 和 vmin"></a>vw、vh、vmax 和 vmin</h3><p>这四个单位都是视窗单位，所谓的视窗，在web端指的就是可视区域，移动端的视窗指的就是布局视窗。如果视窗大小发生了变化，那么这些值都会随之变化。这四个单位指的是：</p><blockquote><p>vw：视窗宽度的百分比；<br>vh：视窗高度的百分比；<br>vmax：较大的 vh 和 vw；<br>vmin：较小的 vh 和 vw。</p></blockquote><p>假如一个浏览器的高度是800px，那么1vh的值就是8px。vh和vw的大小总是和视窗的高度和宽度有关。 ​<br>vmin 和 vmax 与视窗宽度和高度的最大值和最小值有关。假如一个浏览器高度为500px，宽度为1200px，那么1vmin就是5px，1vmax就是12px。</p><h2 id="绝对单位"><a href="#绝对单位" class="headerlink" title="绝对单位"></a>绝对单位</h2><p>在 CSS 中，绝对单位包括： px 、pt 、pc、 cm 、 mm 、in 等。绝对单位是一个固定的值，它反应了一个真实的物理尺寸。它不会受屏幕大小或者字体的影响。它们的大小取决于值以及屏幕的分辨率（DPI，每英寸的点数）。px就是我们最常用的绝对单位之一。这些绝对单位的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1in = 25.4mm = 2.54cm = 6pc = 72pt =96px</span><br></pre></td></tr></table></figure></p><h3 id="px"><a href="#px" class="headerlink" title="px"></a>px</h3><p>px 全称为 Pixels，表示像素，它并不严格等于显示器的像素，尤其在高清屏下。尽管CSS单位会根据浏览器、操作系统或者硬件适当缩放，在某些设备或者用户的分辨率设置下也会发生变化，但是96px通常等于一个物理英寸的大小。<br>CSS 将光栅图像(如照片等)的显示方式定义为默认每一个图像大小为1px。 一个“600x400”解析度的照片的长宽分别为“600px”和“400px”，所以照片本身的像素并不会与显示装置像素一致，而是与 px 单位一致。如此就可以将图像完整的与网页的其它元素排列起来。 ​<br>很多时候， px 也常被称为 CSS 像素。它是一个绝对单位，但也可以被视为相对单位，因为像素单位相对的是设备像素。在同一个设备上，每 1 个 CSS 像素所代表的物理像素是可以变化的；在不同的设备之间，每 1 个 CSS 像素所代表的物理像素是可以变化的。</p><h3 id="pt"><a href="#pt" class="headerlink" title="pt"></a>pt</h3><p>pt 全称为 Point，表示点。常用于软件设计和排版印刷行业（笔者做的前端系统，最终的产物就是一个需要拿去印刷的PDF，所以会经常用到这个单位）。当使用这个单位时，无论显示器的分辨率是多少，打印在纸上的结果都是一样的。 ​<br>如果单纯为了网页的显示，建议就使用px像素单位，如果需要输出印刷产品，就可以考虑使用pt。</p><h3 id="pc"><a href="#pc" class="headerlink" title="pc"></a>pc</h3><p>pc 全程为 Picas，表示派卡。相当于我国新四号铅字的尺寸。派卡也是印刷的术语，1派卡等于12点。它和 px 的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1pc = 16px</span><br></pre></td></tr></table></figure></p><h3 id="cm"><a href="#cm" class="headerlink" title="cm"></a>cm</h3><p>cm 全称为 Centimeters，表示厘米。它和 px 的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1cm = 37.8px</span><br></pre></td></tr></table></figure></p><h3 id="mm"><a href="#mm" class="headerlink" title="mm"></a>mm</h3><p>mm 全称为 Millimeters，表示毫米。它和 px 的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1mm = 3.78px</span><br></pre></td></tr></table></figure></p><h3 id="in"><a href="#in" class="headerlink" title="in"></a>in</h3><p>in 全称为 Inches，表示英寸。它和 px 的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1in = 96px</span><br></pre></td></tr></table></figure></p><h2 id="频率单位"><a href="#频率单位" class="headerlink" title="频率单位"></a>频率单位</h2><p>CSS中的频率单位有两个：赫兹（Hz）和千赫兹（kHz）。它们的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1kHz = 1000Hz</span><br></pre></td></tr></table></figure></p><p>通常情况下，频率单位使用在听或说级联样式表中。频率可以被用来改变一个语音阅读文本的音调。低频率就是低音，高频率就是高音。<br>需要注意，当数值为0时，单位对值没有影响，但是单位是不能省略的。也就是说0、0Hz、0kHz是不一样的。所以，在使用频率单位时，不要直接写0。另外，这两个单位是不区分大小写的。</p><h2 id="时间单位"><a href="#时间单位" class="headerlink" title="时间单位"></a>时间单位</h2><p>CSS中的时间单位有两个：秒（s）和毫秒（ms）。这两个时间单位都是CSS新增的单位。这两个单位的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1s = 1000ms</span><br></pre></td></tr></table></figure></p><p>时间单位主要用于过度和动画中，用于定义持续时间或延迟时间。</p><h2 id="分辨率单位"><a href="#分辨率单位" class="headerlink" title="分辨率单位"></a>分辨率单位</h2><p>CSS中的分辨率单位有三个：dpi、dpcm、dppx。这三个单位都是CSS3中华新增的单位。他们都是正值，不允许为负值。这三个单位的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1dppx = 96dpi</span><br><span class="line">1dpi ≈ 0.39dpcm</span><br><span class="line">1dpcm ≈ 2.54dpi</span><br></pre></td></tr></table></figure></p><p>分辨率单位主要用于媒体查询等操作。</p><h3 id="dpi"><a href="#dpi" class="headerlink" title="dpi"></a>dpi</h3><p>dpi 全称为 dots per inch，表示每英寸包含的点的数量。普通屏幕通常包含 72或96个点，大于 192dpi 的屏幕被称为高分屏。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (min-resolution: 96dpi) &#123; ... &#125;</span><br><span class="line">@media print and (min-resolution: 300dpi) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p><h3 id="dpcm"><a href="#dpcm" class="headerlink" title="dpcm"></a>dpcm</h3><p>dpcm 全称为 dots per centimeter，表示每厘米包含的点的数量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (min-resolution: 28dpcm) &#123; ... &#125;</span><br><span class="line">@media print and (min-resolution: 118dpcm) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p><h3 id="dppx"><a href="#dppx" class="headerlink" title="dppx"></a>dppx</h3><p>dppx 全称为 dots per pixel，表示每像素（px）包含点的数量。由于CSS px的固定比率为1:96，因此1dppx相当于96dpi。它对应于由图像分辨率定义的CSS中显示的图像的默认分辨率。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (min-resolution: 2dppx) &#123; ... &#125;</span><br><span class="line">@media screen and (min-resolution: 1dppx) and (max-resolution: 1.9dppx) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p><h2 id="角度单位"><a href="#角度单位" class="headerlink" title="角度单位"></a>角度单位</h2><p>CSS中的角度单位有四个：deg、grad、rad、turn。这些角度单位都是CSS3中新增的单位。它们的换算关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">90deg = 100grad = 0.25turn ≈ 1.570796326794897rad</span><br></pre></td></tr></table></figure></p><p>一般这些角度单位用于元素的旋转操作，包括2D旋转、3D旋转等。</p><blockquote><p>当旋转值为正值时，元素会顺时针旋转；<br>当旋转值为负值时，元素会逆时针旋转。</p></blockquote><p>通常情况下，一个完整的旋转就是360度。所以，所有的角度都在0-360度之间。但是，超出这个范围的值也是允许的，只不过都会归到0-360度之间。比如，顺时针旋转450度（450deg）、逆时针旋转270度（-270deg）、顺时针旋转90度（90deg）都是一样的效果，都会归为90deg。但是当使用动画时，这些角度值就非常重要了。<br>CSS的旋转主要依赖于 transform 属性中的 rotate() 、rotate3d、 skew() 等方法。只需给它们传递旋转的角度即可。 ​<br>除了旋转会使用角度之外，线性渐变也会经常使用角度值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background: linear-gradient(45deg, #000, #fff);</span><br></pre></td></tr></table></figure></p><h3 id="deg"><a href="#deg" class="headerlink" title="deg"></a>deg</h3><p>deg 全称为 Degress，表示度，一个圆总共360度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotate(2deg);</span><br></pre></td></tr></table></figure></p><h3 id="grad"><a href="#grad" class="headerlink" title="grad"></a>grad</h3><p>grad 全称为 Gradians，表示梯度，一个圆总共400梯度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotate(2grad);</span><br></pre></td></tr></table></figure></p><h3 id="rad"><a href="#rad" class="headerlink" title="rad"></a>rad</h3><p>rad 全称为 Radians，表示弧度，一个圆总共2π弧度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotate(2rad);</span><br></pre></td></tr></table></figure></p><h3 id="turn"><a href="#turn" class="headerlink" title="turn"></a>turn</h3><p>turn 全称为 Turns，表示圈（转），一个圆总共一圈（转）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform:rotate(.5turn);</span><br></pre></td></tr></table></figure></p><h2 id="百分比单位"><a href="#百分比单位" class="headerlink" title="百分比单位"></a>百分比单位</h2><p>百分比（%）也是我们比较常用的单位之一，所有接受长度值的属性都可以使用百分比单位。但是不同属性使用该单位的效果可能并不一样。但是都需要有一个参照值，也就是说百分比值是一个相对的值。 ​</p><h3 id="盒模型中的百分比"><a href="#盒模型中的百分比" class="headerlink" title="盒模型中的百分比"></a>盒模型中的百分比</h3><p>在CSS中的盒模型包含的属性有：width、max-width、min-width、height、max-height、min-height、padding、margin等。这些属性在使用百分比时，参照物不尽相同：</p><blockquote><p>width、max-width、min-width：值为百分比时，其相对于包含块的 width 进行计算；<br>height、max-height、min-height：值为百分比时，其相对于包含块的 height 进行计算；<br>padding、margin：值为百分比时，如果是水平的值，就是相对于包含块的 width 进行计算；如果是垂直的值，也是相对于包含块的 width 进行计算。</p></blockquote><h3 id="文本中的百分比"><a href="#文本中的百分比" class="headerlink" title="文本中的百分比"></a>文本中的百分比</h3><p>在CSS中文本控制的属性有font-size、line-height 、vertical-align、 text-indent等。这些属性在使用百分比时，参照物不尽相同：</p><blockquote><p>font-size：根据父元素的font-size 进行计算；<br>line-height：根据font-size进行计算；<br>vertical-align：根据line-height进行计算；<br>text-indent：如果是水平的，则根据width进行计算，如果是垂直的，则根据 height 进行计算。</p></blockquote><h3 id="定位中的百分比"><a href="#定位中的百分比" class="headerlink" title="定位中的百分比"></a>定位中的百分比</h3><p>在CSS中用控制 position 位置的top、right、bottom、left都可以使用百分比作为单位。其参照物就是包含块的同方向的width和height。不同定位的包含块不尽相同：</p><blockquote><p>如果元素为静态（ static ）或相对定位（ relative ），包含块一般是其父容器；<br>如果元素为绝对定位（ absolute ），包含块应该是离它最近的 position 为 absolute 、 relative 或 fixed 的祖先元素；<br>如果元素为固定定位（ fixed ），包含块就是视窗（ viewport ）。</p></blockquote><h3 id="变换中的百分比"><a href="#变换中的百分比" class="headerlink" title="变换中的百分比"></a>变换中的百分比</h3><p>CSS 中的 transform 属性中的 translate 和 transform-origin 值也可以设置百分比。</p><blockquote><p>translateX() 根据容器的 width 计算<br>translateY() 根据容器的 height 计算<br>transform-origin 中横坐标（ x ）相对于容器的 width 计算；纵坐标（ y ）相对于容器的 height 计算</p></blockquote><p>注意，在 translate 还有一个 z 轴的函数 translateZ() 。它是不接受百分比为单位的值。</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github工作流</title>
      <link href="/2022/10/14/github%E5%B7%A5%E4%BD%9C%E6%B5%81/"/>
      <url>/2022/10/14/github%E5%B7%A5%E4%BD%9C%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<p>常用的一种github工作流<br><a id="more"></a></p><blockquote><p>1.git clone // 到本地<br>2.git checkout -b xxx 切换至新分支xxx<br>（相当于复制了remote的仓库到本地的xxx分支上<br>3.修改或者添加本地代码（部署在硬盘的源文件上）<br>4.git diff 查看自己对代码做出的改变<br>5.git add 上传更新后的代码至暂存区<br>6.git commit 可以将暂存区里更新后的代码更新到本地git<br>7.git push origin xxx 将本地的xxxgit分支上传至github上的git</p></blockquote><blockquote><p>（如果在写自己的代码过程中发现远端GitHub上代码出现改变）<br>1.git checkout main 切换回main分支<br>2.git pull origin master(main) 将远端修改过的代码再更新到本地<br>3.git checkout xxx 回到xxx分支<br>4.git rebase main 我在xxx分支上，先把main移过来，然后根据我的commit来修改成新的内容<br>（中途可能会出现，rebase conflict —–》手动选择保留哪段代码）<br>5.git push -f origin xxx 把rebase后并且更新过的代码再push到远端github上<br>（-f —》强行）<br>6.原项目主人采用pull request 中的 squash and merge 合并所有不同的commit</p></blockquote><blockquote><p>远端完成更新后<br>1.git branch -d xxx 删除本地的git分支<br>2.git pull origin master 再把远端的最新代码拉至本地</p></blockquote><p><a href="https://www.bilibili.com/video/BV19e4y1q7JJ/?spm_id_from=333.1007.tianma.2-2-4.click&amp;vd_source=52fb49cd12021ddab3266f637619f33b" target="_blank" rel="noopener">视频教程地址</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>企业信息化常用系统</title>
      <link href="/2022/10/12/%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E5%8C%96%E5%B8%B8%E7%94%A8%E7%B3%BB%E7%BB%9F/"/>
      <url>/2022/10/12/%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E5%8C%96%E5%B8%B8%E7%94%A8%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>企业信息化常用系统的英文缩写<br><a id="more"></a></p><h2 id="企业资源计划（ERP）"><a href="#企业资源计划（ERP）" class="headerlink" title="企业资源计划（ERP）"></a>企业资源计划（ERP）</h2><p><img src="/2022/10/12/企业信息化常用系统/1.png" alt="img"></p><h2 id="客户关系管理（CRM）"><a href="#客户关系管理（CRM）" class="headerlink" title="客户关系管理（CRM）"></a>客户关系管理（CRM）</h2><p><img src="/2022/10/12/企业信息化常用系统/2.png" alt="img"></p><h2 id="供应链管理（SCM）"><a href="#供应链管理（SCM）" class="headerlink" title="供应链管理（SCM）"></a>供应链管理（SCM）</h2><p><img src="/2022/10/12/企业信息化常用系统/3.png" alt="img"></p><h2 id="商业智能（BI）"><a href="#商业智能（BI）" class="headerlink" title="商业智能（BI）"></a>商业智能（BI）</h2><p><img src="/2022/10/12/企业信息化常用系统/4.png" alt="img"></p><h2 id="决策支持系统（DSS）"><a href="#决策支持系统（DSS）" class="headerlink" title="决策支持系统（DSS）"></a>决策支持系统（DSS）</h2><p><img src="/2022/10/12/企业信息化常用系统/5.png" alt="img"></p><h2 id="业务流程重组（BPR）"><a href="#业务流程重组（BPR）" class="headerlink" title="业务流程重组（BPR）"></a>业务流程重组（BPR）</h2><p><img src="/2022/10/12/企业信息化常用系统/6.png" alt="img"></p><h2 id="业务流程管理（BPM）"><a href="#业务流程管理（BPM）" class="headerlink" title="业务流程管理（BPM）"></a>业务流程管理（BPM）</h2><p><img src="/2022/10/12/企业信息化常用系统/7.png" alt="img"></p><h2 id="企业应用集成（EAI）"><a href="#企业应用集成（EAI）" class="headerlink" title="企业应用集成（EAI）"></a>企业应用集成（EAI）</h2><p><img src="/2022/10/12/企业信息化常用系统/8.png" alt="img"></p><h2 id="企业门户"><a href="#企业门户" class="headerlink" title="企业门户"></a>企业门户</h2><p><img src="/2022/10/12/企业信息化常用系统/9.png" alt="img"></p><h2 id="电子政务与电子商务简称"><a href="#电子政务与电子商务简称" class="headerlink" title="电子政务与电子商务简称"></a>电子政务与电子商务简称</h2><blockquote><p>政府 Government<br>  企业 Business<br>  公民 Citizen<br>  线上 Online<br>  线下 Offline<br>  G2G G2B B2C C2C等<br>  O2O</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 软考 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5禁止微信字体设置</title>
      <link href="/2022/10/10/h5%E7%A6%81%E6%AD%A2%E5%BE%AE%E4%BF%A1%E5%AD%97%E4%BD%93%E8%AE%BE%E7%BD%AE/"/>
      <url>/2022/10/10/h5%E7%A6%81%E6%AD%A2%E5%BE%AE%E4%BF%A1%E5%AD%97%E4%BD%93%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>解除微信字体大小设置，对h5页面的影响<br><a id="more"></a><br>在开发微信公众号，或者用微信打开一个h5页面，如果调整了微信的字体大小，页面的布局会发生改变，这样就做不到统一。<br>IOS和安卓用不同的方法禁止了微信字体的调整，见下例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;微信字体大小设置&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  /* iOS禁止微信调整字体大小 */</span><br><span class="line">  body &#123;</span><br><span class="line">    -webkit-text-size-adjust: 100% !important;</span><br><span class="line">    text-size-adjust: 100% !important;</span><br><span class="line">    -moz-text-size-adjust: 100% !important;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;h1字体大小测试微信&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;h2字体大小测试微信&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;h3字体大小测试微信&lt;/h3&gt;</span><br><span class="line">  &lt;h4&gt;h4字体大小测试微信&lt;/h4&gt;</span><br><span class="line">  &lt;h5&gt;h5字体大小测试微信&lt;/h5&gt;</span><br><span class="line">  &lt;h6&gt;h6字体大小测试微信&lt;/h6&gt;</span><br><span class="line">  &lt;div style=&quot;font-size:14px;&quot;&gt;div字体大小测试微信px&lt;/div&gt;</span><br><span class="line">  &lt;div style=&quot;font-size:2rem;&quot;&gt;div字体大小测试微信rem&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  // 对安卓手机有效</span><br><span class="line">  // 强制禁止用户修改微信客户端的字体大小</span><br><span class="line">  (function() &#123;</span><br><span class="line">    if (typeof WeixinJSBridge == &quot;object&quot; &amp;&amp; typeof WeixinJSBridge.invoke == &quot;function&quot;) &#123;</span><br><span class="line">    handleFontSize();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    if (document.addEventListener) &#123;</span><br><span class="line">    document.addEventListener(&quot;WeixinJSBridgeReady&quot;, handleFontSize, false);</span><br><span class="line">  &#125; else if (document.attachEvent) &#123;</span><br><span class="line">    document.attachEvent(&quot;WeixinJSBridgeReady&quot;, handleFontSize);</span><br><span class="line">    document.attachEvent(&quot;onWeixinJSBridgeReady&quot;, handleFontSize);  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  function handleFontSize() &#123;</span><br><span class="line">    // 设置网页字体为默认大小</span><br><span class="line">    WeixinJSBridge.invoke(&apos;setFontSizeCallback&apos;, &#123; &apos;fontSize&apos; : 0 &#125;);</span><br><span class="line">    // 重写设置网页字体大小的事件</span><br><span class="line">    WeixinJSBridge.on(&apos;menu:setfont&apos;, function() &#123;</span><br><span class="line">      WeixinJSBridge.invoke(&apos;setFontSizeCallback&apos;, &#123; &apos;fontSize&apos; : 0 &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)();</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>canvas-html属性width与css的width区别</title>
      <link href="/2022/09/15/canvas-html%E5%B1%9E%E6%80%A7width%E4%B8%8Ecss%E7%9A%84width%E5%8C%BA%E5%88%AB/"/>
      <url>/2022/09/15/canvas-html%E5%B1%9E%E6%80%A7width%E4%B8%8Ecss%E7%9A%84width%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>canvas中标签属性的width，height与css的width，height的区别<br><a id="more"></a><br>canvas中，如果不写width和height，会默认width=300，height=150。</p><blockquote><p>标签属性中的width和height可以理解为虚拟画布的宽高，比如设置width=3000，height=1000，在js中对其进行绘图时，都是在这个宽3000，高1000的画布上进行绘制。<br>而css的width和height是绘制好的这块画布在实际的页面中显示的具体宽高，可以把画布理解为一张宽3000，高1000的图片，当设置其css宽高时，这张图片会根据实际的宽高进行变化。</p></blockquote><p>附上一段代码，可以更改width和height观察其变化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;canvas&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  canvas &#123;</span><br><span class="line">    border: 1px solid blue;</span><br><span class="line">    width: 300px;</span><br><span class="line">    height: 300px;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;canvas id=&quot;mycanvas&quot; width=&quot;300&quot; height=&quot;300&quot;&gt;浏览器不支持Canvas,请升级或改用其它浏览器！&lt;/canvas&gt;</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var canvas = document.getElementById(&quot;mycanvas&quot;),</span><br><span class="line">        ctx = canvas.getContext(&apos;2d&apos;);</span><br><span class="line">    ctx.moveTo(0,0);</span><br><span class="line">    ctx.lineTo(300,150);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信公众号开发</title>
      <link href="/2022/09/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/"/>
      <url>/2022/09/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>微信公众号开发简介<br><a id="more"></a><br>微信公众号开发比较繁琐，先来看一下大致架构：<br><img src="/2022/09/05/微信公众号开发/1.png" alt="img"><br>服务器鉴权这块，应该是比较难的。<br>这里有两个需要鉴权的地方，一个是基本配置里的URL接入鉴权，另一个是JS-SDK的鉴权。</p><h2 id="URL接入鉴权"><a href="#URL接入鉴权" class="headerlink" title="URL接入鉴权"></a>URL接入鉴权</h2><p><img src="/2022/09/05/微信公众号开发/2.png" alt="img"><br>上图中的这个URL是微信公众平台接入到自己的后台服务器的接口鉴权，URL可以写成这样<code>http://jinux.top/weixinapi</code>。<br>看一看微信公众平台的定义：</p><blockquote><p>开发者通过检验 signature 对请求进行校验（下面有校验方式）。若确认此次 GET 请求来自微信服务器，请原样返回 echostr 参数内容，则接入生效，成为开发者成功，否则接入失败。加密/校验流程如下：<br>1）将token、timestamp、nonce三个参数进行字典序排序<br>2）将三个参数字符串拼接成一个字符串进行sha1加密<br>3）开发者获得加密后的字符串可与 signature 对比，标识该请求来源于微信</p></blockquote><p><a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html" target="_blank" rel="noopener">官网文档地址</a><br>验证signature的示例代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function checkSignature() &#123;</span><br><span class="line">  let &#123; signature, timestamp, nonce, echostr &#125; = req.query;</span><br><span class="line">  let token = &apos;testweixin&apos;; // 这个token是上图中的填写的Token</span><br><span class="line">  let array = [timestamp, nonce, token];</span><br><span class="line">  array.sort(); // 字典排序</span><br><span class="line">  let str = array.join(&apos;&apos;);</span><br><span class="line">  let resultStr = sha1(str); // 对字符串进行sha1加密，需要const sha1 = require(&apos;sha1&apos;)</span><br><span class="line">  if(resultStr === signature) &#123;</span><br><span class="line">    res.send(echostr);</span><br><span class="line">  &#125;else &#123;</span><br><span class="line">    res.send(&apos;Error&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="JS-SDK使用"><a href="#JS-SDK使用" class="headerlink" title="JS-SDK使用"></a>JS-SDK使用</h2><p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62" target="_blank" rel="noopener">官方文档地址</a><br>js-sdk使用流程图：<br><img src="/2022/09/05/微信公众号开发/3.png" alt="img"><br>在网页中调用微信赋予的功能时，需要config 接口注入权限验证配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.config(&#123;</span><br><span class="line">  debug: true, // 开启调试模式,调用的所有 api 的返回值会在客户端 alert 出来，若要查看传入的参数，可以在 pc 端打开，参数信息会通过 log 打出，仅在 pc 端时才会打印。</span><br><span class="line">  appId: &apos;&apos;, // 必填，公众号的唯一标识</span><br><span class="line">  timestamp: , // 必填，生成签名的时间戳</span><br><span class="line">  nonceStr: &apos;&apos;, // 必填，生成签名的随机串</span><br><span class="line">  signature: &apos;&apos;,// 必填，签名</span><br><span class="line">  jsApiList: [] // 必填，需要使用的 JS 接口列表</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p><code>timestamp, nonceStr, signature</code>需要后台生成。<br>接下来，看一下生成流程</p><h3 id="获取ticket"><a href="#获取ticket" class="headerlink" title="获取ticket"></a>获取ticket</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">async function getTicket() &#123;</span><br><span class="line">  let tokenUrl = `https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=$&#123;appid&#125;&amp;secret=$&#123;secret&#125;`;</span><br><span class="line">  let token_data = await axios.get(tokenUrl);</span><br><span class="line">  let access_token = token_data.data.access_token; // 得到access_token</span><br><span class="line">  let ticketUrl = `https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=$&#123;access_token&#125;&amp;type=jsapi`;</span><br><span class="line">  let ticket_data = await axios.get(ticketUrl);</span><br><span class="line">  let ticket = ticket_data.data.ticket; // 获取jsp_ticket</span><br><span class="line">  return ticket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成nonceStr"><a href="#生成nonceStr" class="headerlink" title="生成nonceStr"></a>生成nonceStr</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function createNonceStr() &#123;</span><br><span class="line">  return Math.random().toString(36).subStr(2, 15);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成timestamp"><a href="#生成timestamp" class="headerlink" title="生成timestamp"></a>生成timestamp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function createTimestamp() &#123;</span><br><span class="line">  return parseInt(new Date().getTime() / 1000) + &apos;&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成signature"><a href="#生成signature" class="headerlink" title="生成signature"></a>生成signature</h3><blockquote><p>签名生成规则如下：<br>1）参与签名的字段包括noncestr（随机字符串）, 有效的jsapi_ticket, timestamp（时间戳）, url（当前网页的URL，不包含#及其后面部分） 。<br>2）对所有待签名参数按照字段名的ASCII 码从小到大排序（字典序）后，使用 URL 键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串string1。<br>3）这里需要注意的是所有参数名均为小写字符。对string1作sha1加密，字段名和字段值都采用原始值，不进行URL 转义。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 处理数据格式</span><br><span class="line">function row(obj) &#123;</span><br><span class="line">  let keys = Object.keys(obj);</span><br><span class="line">  keys = keys.sort(); // 字典排序</span><br><span class="line">  let newObj = &#123;&#125;;</span><br><span class="line">  keys.forEach(key=&gt; &#123;</span><br><span class="line">    newObj[key] = obj[key];</span><br><span class="line">  &#125;);</span><br><span class="line">  let string = &apos;&apos;;</span><br><span class="line">  for(let k in newObj) &#123;</span><br><span class="line">    string += &apos;&amp;&apos; + k + &apos;=&apos; + newObj[k];</span><br><span class="line">  &#125;</span><br><span class="line">  string = string.subStr(1);</span><br><span class="line">  return string;</span><br><span class="line">&#125;</span><br><span class="line">// 生成signature签名方法</span><br><span class="line">async function getSignature(url) &#123;</span><br><span class="line">  let jsapi_ticket = await getTicket();</span><br><span class="line">  var obj = &#123;</span><br><span class="line">    jsapi_ticket,</span><br><span class="line">    nonceStr: createNonceStr(),</span><br><span class="line">    timestamp: createTimestamp(),</span><br><span class="line">    url</span><br><span class="line">  &#125;</span><br><span class="line">  let str = row(obj);</span><br><span class="line">  let signature = sha1(str);</span><br><span class="line">  obj.signature = signature;</span><br><span class="line">  return obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="人脸识别认证"><a href="#人脸识别认证" class="headerlink" title="人脸识别认证"></a>人脸识别认证</h2><p>微信是提供了人脸识别验证接口的，该接口目前是免费的，并且是适用公众号的。由于该接口属于未开放接口，所以在微信JS-SDK说明文档是无法查看到该接口文档的，需要写邮件给腾讯进行申请审核，如果申请通过，腾讯会回复邮件，开通对应公众号的调用权限，并会发送接口文档。<br><a href="https://blog.csdn.net/weixin_36463040/article/details/112664578" target="_blank" rel="noopener">开通人脸识别方法</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上只是简单的列举了URL接入鉴权和JS-SDK的鉴权，这两个也是公众号中最繁琐的地方。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs path模块详解</title>
      <link href="/2022/08/23/nodejs-path%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3/"/>
      <url>/2022/08/23/nodejs-path%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>nodejs的path模块用法<br><a id="more"></a><br>nodejs的path模块包含一系列处理和转换文件路径的工具集</p><h2 id="normalize"><a href="#normalize" class="headerlink" title="normalize"></a>normalize</h2><p>规范化路径，处理冗余的“..”、“.”、“/”字符。发现多个斜杠时，会替换成一个斜杠。当路径末尾包含一个斜杠时，保留。Windows系统使用反斜杠<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.normalize(&apos;a/b/c/../user/bin&apos;));// a\b\user\bin</span><br><span class="line">console.log(path.normalize(&apos;a/b/c///../user/bin/&apos;));// a\b\user\bin\</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/../../user/bin&apos;));// a\user\bin</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/.././///../user/bin/..&apos;));// a\user</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/../../user/bin/../../&apos;));// a\</span><br><span class="line">console.log(path.normalize(&apos;a/../../user/bin/../../&apos;));// ..\</span><br><span class="line">console.log(path.normalize(&apos;a/../../user/bin/../../../../&apos;));// ..\..\..\</span><br><span class="line">console.log(path.normalize(&apos;./a/.././user/bin/./&apos;));// user\bin\</span><br></pre></td></tr></table></figure></p><h2 id="join"><a href="#join" class="headerlink" title="join"></a>join</h2><p>path.join([path1], [path2], […])<br>将多个路径结合在一起，并转换为规范化路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.join(&apos;////./a&apos;, &apos;b////c&apos;, &apos;user/&apos;));// \a\b\c\user</span><br><span class="line">console.log(path.join(&apos;./a&apos;, &apos;b//c&apos;, &apos;user&apos;));// a\b\c\user</span><br><span class="line">console.log(path.join(&apos;a&apos;, &apos;../../&apos;, &apos;user/&apos;));// ..\user\</span><br><span class="line">console.log(path.join(__dirname, &apos;a&apos;, &apos;../../&apos;, &apos;user/&apos;));// E:\jinux\node\study\user\</span><br></pre></td></tr></table></figure></p><h2 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h2><p>从源地址 from 到目的地址 to 的绝对路径</p><blockquote><p>类似在shell里执行一系列的cd命令<br>path.resolve(‘foo/bar’, ‘/tmp/file/‘, ‘..’, ‘a/../subfile’)<br>类似于:<br>cd foo/bar<br>cd /tmp/file/<br>cd ..<br>cd a/../subfile<br>pwd<br>[注意]如果某个from或to参数是绝对路径（比如 ‘E:/abc’，或是以“/”开头的路径），则将忽略之前的from参数</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.resolve(&apos;.&apos;, &apos;testFiles/..&apos;, &apos;trdLayer&apos;));// E:\jinux\node\study\path模块\trdLayer</span><br><span class="line">console.log(path.resolve(&apos;..&apos;, &apos;testFiles&apos;, &apos;a.txt&apos;));// E:\jinux\node\study\testFiles\a.txt</span><br><span class="line">console.log(path.resolve(&apos;D:&apos;, &apos;abc&apos;, &apos;D:/a&apos;));// D:\a</span><br><span class="line">console.log(path.resolve(&apos;abc&apos;, &apos;ok.gif&apos;));// E:\jinux\node\study\path模块\abc\ok.gif</span><br><span class="line">console.log(path.resolve(&apos;abc&apos;, &apos;..&apos;, &apos;a/../subfile&apos;)); // E:\jinux\node\study\path模块\subfile</span><br><span class="line">console.log(path.resolve(&apos;/a&apos;, &apos;/b&apos;, &apos;c&apos;)); // E:\b\c</span><br></pre></td></tr></table></figure><h2 id="relative"><a href="#relative" class="headerlink" title="relative"></a>relative</h2><p>path.relative(from, to)<br>获取从 from 到 to 的相对路径，可以看作 path.resolve 的相反实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.relative(&apos;C:\\\test&apos;, &apos;C:\\\impl\\bbb&apos;));//..\impl\bbb</span><br><span class="line">console.log(path.relative(&apos;C:/test/aaa&apos;, &apos;C:/bbb&apos;));//..\..\bbb</span><br><span class="line">console.log(path.relative(&apos;C:/test/aaa&apos;, &apos;D:/bbb&apos;));//D:\bbb</span><br></pre></td></tr></table></figure></p><h2 id="isAbsolute"><a href="#isAbsolute" class="headerlink" title="isAbsolute"></a>isAbsolute</h2><p>path.isAbsolute(path)<br>path是一个绝对路径(比如 ‘E:/abc’)，或者是以“/”开头的路径，二者都会返回true<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.isAbsolute(&apos;../testFiles/secLayer&apos;));// false</span><br><span class="line">console.log(path.isAbsolute(&apos;./join.js&apos;));// false</span><br><span class="line">console.log(path.isAbsolute(&apos;temp&apos;));// false</span><br><span class="line">console.log(path.isAbsolute(&apos;/temp/../..&apos;));// true</span><br><span class="line">console.log(path.isAbsolute(&apos;E:/github/nodeAPI/abc/efg&apos;));// true</span><br><span class="line">console.log(path.isAbsolute(&apos;///temp123&apos;));// true</span><br></pre></td></tr></table></figure></p><h2 id="dirname"><a href="#dirname" class="headerlink" title="dirname"></a>dirname</h2><p>path.dirname(p)<br>返回路径p所在的目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.dirname(&apos;/foo/bar/baz/asdf/a.txt&apos;)); // /foo/bar/baz/asdf</span><br><span class="line">console.log(path.dirname(&apos;/foo/bar/baz/asdf/&apos;)); // /foo/bar/baz</span><br><span class="line">console.log(path.dirname(&apos;C:/test/aaa&apos;)); // C:/test</span><br><span class="line">console.log(path.dirname(__dirname)); // E:\jinux\node\study</span><br></pre></td></tr></table></figure></p><h2 id="basename"><a href="#basename" class="headerlink" title="basename"></a>basename</h2><p>path.basename(p[, ext])<br>返回路径的最后一个部分，即文件名。参数ext为需要截掉的后缀内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.basename(&apos;/foo/bar/baz/asdf/a.txt&apos;)); // a.txt</span><br><span class="line">console.log(path.basename(&apos;/foo/bar/baz/asdf/a.txt&apos;,&apos;.txt&apos;)); // a</span><br><span class="line">console.log(path.basename(&apos;/foo/bar/baz/asdf/&apos;)); // asdf</span><br><span class="line">console.log(path.basename(&apos;C:/test/aaa&apos;)); // aaa</span><br></pre></td></tr></table></figure></p><h2 id="extname"><a href="#extname" class="headerlink" title="extname"></a>extname</h2><p>path.extname(p)<br>返回路径p的扩展名，从最后一个’.’到字符串的末尾。如果最后一个部分没有’.’，或者路径是以’.’开头，则返回空字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.extname(&apos;/foo/bar/baz/asdf/a.txt&apos;)); // .txt</span><br><span class="line">console.log(path.extname(&apos;/foo/bar/baz/asdf/a.txt.b&apos;)); // .b</span><br><span class="line">console.log(path.extname(&apos;/foo/bar/baz/asdf/a.&apos;)); // .</span><br><span class="line">console.log(path.extname(&apos;C:/test/aaa/.&apos;)); // &apos;&apos;</span><br><span class="line">console.log(path.extname(&apos;C:/test/aaa&apos;)); // &apos;&apos;</span><br></pre></td></tr></table></figure></p><h2 id="sep"><a href="#sep" class="headerlink" title="sep"></a>sep</h2><p>返回对应平台下的文件分隔符，win下为’\’，linux下为’/‘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.sep); // win下为\，linux下为/</span><br><span class="line">console.log(&apos;foo\\bar\\baz&apos;.split(path.sep)); // [ &apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos; ]</span><br><span class="line">console.log(&apos;foo/bar/baz&apos;.split(path.sep)); // win下返回[&apos;foo/bar/baz&apos;]，但在linux系统下会返回[&apos;foo&apos;,&apos;bar&apos;,&apos;baz&apos;]</span><br></pre></td></tr></table></figure></p><h2 id="delimiter"><a href="#delimiter" class="headerlink" title="delimiter"></a>delimiter</h2><p>返回对应平台下的路径分隔符，win下为’;’ linux下为’:’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.delimiter); //win下为“;” linux下为“:”</span><br></pre></td></tr></table></figure></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>所有代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">// 当前文件路径</span><br><span class="line">console.log(&apos;当前文件夹路径&apos;, process.cwd());</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.normalize</span><br><span class="line"> * 规范化路径，处理冗余的“..”、“.”、“/”字符。发现多个斜杠时，会替换成一个斜杠。当路径末尾包含一个斜杠时，保留。Windows系统使用反斜杠　</span><br><span class="line"> */</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/../user/bin&apos;));// a\b\user\bin</span><br><span class="line">console.log(path.normalize(&apos;a/b/c///../user/bin/&apos;));// a\b\user\bin\</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/../../user/bin&apos;));// a\user\bin</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/.././///../user/bin/..&apos;));// a\user</span><br><span class="line">console.log(path.normalize(&apos;a/b/c/../../user/bin/../../&apos;));// a\</span><br><span class="line">console.log(path.normalize(&apos;a/../../user/bin/../../&apos;));// ..\</span><br><span class="line">console.log(path.normalize(&apos;a/../../user/bin/../../../../&apos;));// ..\..\..\</span><br><span class="line">console.log(path.normalize(&apos;./a/.././user/bin/./&apos;));// user\bin\</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.join</span><br><span class="line"> * path.join([path1], [path2], [...])</span><br><span class="line"> * 将多个路径结合在一起，并转换为规范化路径</span><br><span class="line"> */</span><br><span class="line">console.log(path.join(&apos;////./a&apos;, &apos;b////c&apos;, &apos;user/&apos;));// \a\b\c\user</span><br><span class="line">console.log(path.join(&apos;./a&apos;, &apos;b//c&apos;, &apos;user&apos;));// a\b\c\user</span><br><span class="line">console.log(path.join(&apos;a&apos;, &apos;../../&apos;, &apos;user/&apos;));// ..\user\</span><br><span class="line">console.log(path.join(__dirname, &apos;a&apos;, &apos;../../&apos;, &apos;user/&apos;));// E:\jinux\node\study\user\</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.resolve</span><br><span class="line"> * path.resolve([from ...], to)</span><br><span class="line"> * 从源地址 from 到目的地址 to 的绝对路径，类似在shell里执行一系列的cd命令</span><br><span class="line"> * path.resolve(&apos;foo/bar&apos;, &apos;/tmp/file/&apos;, &apos;..&apos;, &apos;a/../subfile&apos;)</span><br><span class="line"> * 类似于:</span><br><span class="line"> * cd foo/bar</span><br><span class="line"> * cd /tmp/file/</span><br><span class="line"> * cd ..</span><br><span class="line"> * cd a/../subfile</span><br><span class="line"> * pwd</span><br><span class="line"> * [注意]如果某个from或to参数是绝对路径（比如 &apos;E:/abc&apos;，或是以“/”开头的路径），则将忽略之前的from参数</span><br><span class="line"> */</span><br><span class="line">console.log(path.resolve(&apos;.&apos;, &apos;testFiles/..&apos;, &apos;trdLayer&apos;));// E:\jinux\node\study\path模块\trdLayer</span><br><span class="line">console.log(path.resolve(&apos;..&apos;, &apos;testFiles&apos;, &apos;a.txt&apos;));// E:\jinux\node\study\testFiles\a.txt</span><br><span class="line">console.log(path.resolve(&apos;D:&apos;, &apos;abc&apos;, &apos;D:/a&apos;));// D:\a</span><br><span class="line">console.log(path.resolve(&apos;abc&apos;, &apos;ok.gif&apos;));// E:\jinux\node\study\path模块\abc\ok.gif</span><br><span class="line">console.log(path.resolve(&apos;abc&apos;, &apos;..&apos;, &apos;a/../subfile&apos;)); // E:\jinux\node\study\path模块\subfile</span><br><span class="line">console.log(path.resolve(&apos;/a&apos;, &apos;/b&apos;, &apos;c&apos;)); // E:\b\c</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.relative</span><br><span class="line"> * path.relative(from, to)</span><br><span class="line"> * 获取从 from 到 to 的相对路径，可以看作 path.resolve 的相反实现</span><br><span class="line"> */</span><br><span class="line">console.log(path.relative(&apos;C:\\\test&apos;, &apos;C:\\\impl\\bbb&apos;));//..\impl\bbb</span><br><span class="line">console.log(path.relative(&apos;C:/test/aaa&apos;, &apos;C:/bbb&apos;));//..\..\bbb</span><br><span class="line">console.log(path.relative(&apos;C:/test/aaa&apos;, &apos;D:/bbb&apos;));//D:\bbb</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.dirname</span><br><span class="line"> * path.dirname(p)</span><br><span class="line"> * 返回路径p所在的目录</span><br><span class="line"> */</span><br><span class="line">console.log(path.dirname(&apos;/foo/bar/baz/asdf/a.txt&apos;)); // /foo/bar/baz/asdf</span><br><span class="line">console.log(path.dirname(&apos;/foo/bar/baz/asdf/&apos;)); // /foo/bar/baz</span><br><span class="line">console.log(path.dirname(&apos;C:/test/aaa&apos;)); // C:/test</span><br><span class="line">console.log(path.dirname(__dirname)); // E:\jinux\node\study</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.basename</span><br><span class="line"> * path.basename(p[, ext])</span><br><span class="line"> * 返回路径的最后一个部分，即文件名。参数ext为需要截掉的后缀内容</span><br><span class="line"> */</span><br><span class="line">console.log(path.basename(&apos;/foo/bar/baz/asdf/a.txt&apos;)); // a.txt</span><br><span class="line">console.log(path.basename(&apos;/foo/bar/baz/asdf/a.txt&apos;,&apos;.txt&apos;)); // a</span><br><span class="line">console.log(path.basename(&apos;/foo/bar/baz/asdf/&apos;)); // asdf</span><br><span class="line">console.log(path.basename(&apos;C:/test/aaa&apos;)); // aaa</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.extname</span><br><span class="line"> * path.extname(p)</span><br><span class="line"> * 返回路径p的扩展名，从最后一个&apos;.&apos;到字符串的末尾。如果最后一个部分没有&apos;.&apos;，或者路径是以&apos;.&apos;开头，则返回空字符串</span><br><span class="line"> */</span><br><span class="line">console.log(path.extname(&apos;/foo/bar/baz/asdf/a.txt&apos;)); // .txt</span><br><span class="line">console.log(path.extname(&apos;/foo/bar/baz/asdf/a.txt.b&apos;)); // .b</span><br><span class="line">console.log(path.extname(&apos;/foo/bar/baz/asdf/a.&apos;)); // .</span><br><span class="line">console.log(path.extname(&apos;C:/test/aaa/.&apos;)); // &apos;&apos;</span><br><span class="line">console.log(path.extname(&apos;C:/test/aaa&apos;)); // &apos;&apos;</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.sep</span><br><span class="line"> * 返回对应平台下的文件分隔符，win下为&apos;\&apos;，linux下为&apos;/&apos;</span><br><span class="line"> */</span><br><span class="line">console.log(path.sep); // win下为\，linux下为/</span><br><span class="line">console.log(&apos;foo\\bar\\baz&apos;.split(path.sep)); // [ &apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos; ]</span><br><span class="line">console.log(&apos;foo/bar/baz&apos;.split(path.sep)); // win下返回[&apos;foo/bar/baz&apos;]，但在linux系统下会返回[&apos;foo&apos;,&apos;bar&apos;,&apos;baz&apos;]</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.delimiter</span><br><span class="line"> * 返回对应平台下的路径分隔符，win下为&apos;;&apos; linux下为&apos;:&apos;</span><br><span class="line"> */</span><br><span class="line">console.log(path.delimiter); //win下为“;” linux下为“:”</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br><span class="line">/**</span><br><span class="line"> * path.isAbsolute</span><br><span class="line"> * path.isAbsolute(path)</span><br><span class="line"> * path是一个绝对路径(比如 &apos;E:/abc&apos;)，或者是以“/”开头的路径，二者都会返回true</span><br><span class="line"> */</span><br><span class="line">console.log(path.isAbsolute(&apos;../testFiles/secLayer&apos;));// false</span><br><span class="line">console.log(path.isAbsolute(&apos;./join.js&apos;));// false</span><br><span class="line">console.log(path.isAbsolute(&apos;temp&apos;));// false</span><br><span class="line">console.log(path.isAbsolute(&apos;/temp/../..&apos;));// true</span><br><span class="line">console.log(path.isAbsolute(&apos;E:/github/nodeAPI/abc/efg&apos;));// true</span><br><span class="line">console.log(path.isAbsolute(&apos;///temp123&apos;));// true</span><br><span class="line">console.log(&apos;-------------------------------------------------------------&apos;);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS设计模式</title>
      <link href="/2022/08/15/CSS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2022/08/15/CSS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>CSS设计模式<br><a id="more"></a><br>css的设计模式有OOCSS，BEM，SMACSS，ACSS这几种，接下来逐一介绍。</p><h2 id="设计模式-OOCSS"><a href="#设计模式-OOCSS" class="headerlink" title="设计模式:OOCSS"></a>设计模式:OOCSS</h2><p>OOCSS是比较基础的设计模式，其他设计模式或多或少都有OOCSS的影子,OO就是面向对象，也就是用面向对象的思维来写CSS。</p><h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><p>大家都很熟悉面向对象，我们简单看下下面这一段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">    void study () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Teacher extends Person &#123;</span><br><span class="line">    void study () &#123;&#125;</span><br><span class="line">    void teach () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Student extends Person &#123;</span><br><span class="line">    void study () &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>有一个Person类，它有一些方法，Teacher和Student都继承Person，并且进行了一些修订和扩展。那么我们可以把Person类看成是别人写代码，在不改变别人源码的情况下,新增Teacher和Student对源码进行修订和扩展。这种写法是完全可以应用到CSS上面的。我们看下面一段代码场景:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;menu&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;menu fix&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;menu&quot;&gt;&lt;/div&gt;</span><br><span class="line">.menu &#123;</span><br><span class="line">   color: green;</span><br><span class="line">   font-size: 14px;</span><br><span class="line">&#125;</span><br><span class="line">.fix &#123;</span><br><span class="line">   color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>设计师只想让我们改变其中一个盒子的样式，其他的不变。<br>这时不能轻易改变menu，因为一旦改变就会影响不需要改变的地方。那么我们可以直接利用面向对象的思想，在后面单独添加一个类进行修订和扩展。这样一看我们平时在写的CSS，不就是面向对象吗？<br>当然，OOCSS是有具体的原则的。那么它有哪些原则且个原则的具体是什么呢？我们来看一下：</p><h3 id="原则一-容器与内容分离"><a href="#原则一-容器与内容分离" class="headerlink" title="原则一:容器与内容分离"></a>原则一:容器与内容分离</h3><p>容器与内容分离顾名思义，直接看一个代码案例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;post&quot;&gt; </span><br><span class="line">  &lt;p class=&quot;metadata&quot;&gt;</span><br><span class="line">    &lt;a&gt;Hello&lt;/a&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;comment&quot;&gt; </span><br><span class="line">  &lt;p class=&quot;metadata&quot;&gt;</span><br><span class="line">    &lt;a&gt;Hello&lt;/a&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">// ---------code 1-----------</span><br><span class="line">.post .metadata &#123;</span><br><span class="line">  // css code</span><br><span class="line">&#125;</span><br><span class="line">// ---------code 2-----------</span><br><span class="line">.post &#123;&#125;</span><br><span class="line">.metadata &#123;</span><br><span class="line">  // css code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h3><p>两个不同容器中的内容相同<br>先看样式的code 1，这样显然不好，容器和内容是嵌套依赖关系，并没有做到容器与内容分离。内容的样式无法复用。样式的code 2做到了容器与内容分离，内容在不同的容器中可以复用。</p><h3 id="原则二-结构与皮肤分离"><a href="#原则二-结构与皮肤分离" class="headerlink" title="原则二:结构与皮肤分离"></a>原则二:结构与皮肤分离</h3><p>结构可以看做是一个基础对象,而皮肤可以看做是另外一个对象,也就是对象与对象要分离。基础对象不能改,不断的分离出皮肤对象达到对基础对象的修正和扩展。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;menu fix&quot;&gt;&lt;/div&gt;</span><br><span class="line">// 基础对象</span><br><span class="line">.menu &#123;</span><br><span class="line">  color: green;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">&#125;</span><br><span class="line">// 皮肤</span><br><span class="line">.fix &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="OOCSS与Vue的关系"><a href="#OOCSS与Vue的关系" class="headerlink" title="OOCSS与Vue的关系"></a>OOCSS与Vue的关系</h3><p>我们每天都在写OOCSS，Vue的组件就是OOCSS。我们下面一段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// -------------定义组件-----------------</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;menu&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &apos;MateData&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt; </span><br><span class="line">// 基础对象</span><br><span class="line">.menu &#123;</span><br><span class="line">   color: green;</span><br><span class="line">   font-size: 14px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">// -----------使用组件-------------------</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;mate-data class=&quot;fix1&quot;&gt;&lt;/mate-data&gt;</span><br><span class="line">  &lt;mate-data class=&quot;fix2&quot;&gt;&lt;/mate-data&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style&gt; </span><br><span class="line">// 皮肤</span><br><span class="line">.fix1 &#123;</span><br><span class="line">   color: red;</span><br><span class="line">&#125;</span><br><span class="line">.fix2 &#123;</span><br><span class="line">   font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></p><h2 id="设计模式-BEM"><a href="#设计模式-BEM" class="headerlink" title="设计模式:BEM"></a>设计模式:BEM</h2><h3 id="BEM是什么"><a href="#BEM是什么" class="headerlink" title="BEM是什么"></a>BEM是什么</h3><p>BEM即块(Block)、元素(Element)、修饰符(Modifier) 是由Yandex（俄罗斯最著名的互联网企业）的开发团队提出的前端开发理论。BEM通过Block、Element、Modifier来描述页面(关键就是为了解决多人协作的命名问题)。<br>Block是页面中独立存在的区块，可以在不同场合下使用。每个页面都可以看做是多个Block组成。<br>Element是构成Block的元素，只有在对应Block内部才具有意义，是依赖于Block的存在。<br>Modifier是描述Block或Element的属性或状态。同一Block或Element可以有多个Modifier，Modifier不可以单独存在。<br>在命名时，Block作为起始开头，不同 Block 和 Element 用 _ 两个底线区隔开来，不同的 Modifier 则用 – 区隔。<br><img src="/2022/08/15/CSS设计模式/1.jpg" alt="img"></p><h3 id="进阶版的OOCSS"><a href="#进阶版的OOCSS" class="headerlink" title="进阶版的OOCSS"></a>进阶版的OOCSS</h3><p>BEM就是进阶版的OOCSS，我们看下图所示:<br><img src="/2022/08/15/CSS设计模式/2.jpg" alt="img"></p><h3 id="场景-2"><a href="#场景-2" class="headerlink" title="场景"></a>场景</h3><p>页面两个tab栏，整体布局相似,只有细节部分不同<br>那么使用BEM写样式时，就会定义一个块menu，下面包含元素menu_tab，完成整体布局，细微部分使用修饰符menu_tab-style1进行微调。代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- BEM --&gt;</span><br><span class="line">&lt;div class=&quot;menu menu-style1&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style1&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style1&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style1&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style1&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;menu&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style2&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style2&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style2&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;menu_tab menu_tab-style2&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><p>通过上面代码可以看出BEM就是OOCSS。<br>对BEM感兴趣的话，可以访问<a href="https://en.bem.info/methodology/css/" target="_blank" rel="noopener">BEM的官网</a></p><h2 id="设计模式-SMACSS"><a href="#设计模式-SMACSS" class="headerlink" title="设计模式:SMACSS"></a>设计模式:SMACSS</h2><p>SMACSS is a way to examine your design process and as a way to fit those rigid frameworks into a flexible thought process. (SMACSS通过一个灵活的思维过程来检查你的设计过程和方式是否符合你的架构，更像一种规范~)</p><h3 id="核心思想-分类"><a href="#核心思想-分类" class="headerlink" title="核心思想:分类"></a>核心思想:分类</h3><ul><li>SMACSS的核心就是分类，它主要要求分为五大类分别是：Base、Layout、Modules、State、Theme</li><li>Base是对浏览器默认样式的重置，常见的<a href="http://necolas.github.io/normalize.css/" target="_blank" rel="noopener">normalize.css</a>就属于此。这里样式只会对标签元素本身做设定，不会出现任何 class 或id，但是可以有属性选择器或是伪类.</li><li>Layout对页面布局的一些功能，属于较高的一层，它可以作为层级较低的Module Rules元素的容器。左右分栏、栅格系统等都属于布局规范。SMACSS还约定命名使用l-/layout-前缀来标识布局的class。</li><li>Modules公共复用的小模块，模块是SMACSS最基本的思想，同时也是大部分CSS理论的基本，将样式模块化就能达到复用和可维护的目的，但是SMACSS提出了更具体的模块化方案。SMACSS中的模块具有自己的一个命名，隶属于模块下的类皆以该模块为前缀，例如：.menu .menu-title等。</li><li>State对不同的展示效果，例如显示、隐藏，与BEM抽取修饰类的方式的不同，SMACSS是抽取更高级别的样式类，得到更强的复用性，命名全都以is-前缀,如:is-hidden。</li><li>Theme对不同主题皮肤的维护，可以修改前面4个类别的样式，且应和前面4个类别分离开来（便于切换，也就是“换肤”）。命名规范需要添加theme-前缀。</li></ul><h3 id="最小适配深度原则"><a href="#最小适配深度原则" class="headerlink" title="最小适配深度原则"></a>最小适配深度原则</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/* depth 1 */</span><br><span class="line">.sidebar ul h3 &#123;&#125;</span><br><span class="line">/* depth 2 */</span><br><span class="line">.sub-title &#123;&#125;</span><br></pre></td></tr></table></figure><p>两段css的区别在于html和css的耦合度(这一点上和OOCSS的分离容器和内容的原则不谋而合)。可以想到，由于上面的样式规则使用了继承选择符，因此对于html的结构实际是有一定依赖的。如果html发生重构，就有可能不再具有这些样式。对应的，下面的样式规则只有一个选择符，因此不依赖于特定html结构，只要为元素添加class，就可以获得对应样式。<br>当然，继承选择符是有用的，它可以减少因相同命名引发的样式冲突（常发生于多人协作开发）。但是，我们不应过度使用，在不造成样式冲突的允许范围之内，尽可能使用短的、不限定html结构的选择符。这就是SMACSS的最小化适配深度的意义。<br>在项目中使用SMACSS时，每一个分类都是一个目录，但是在Vue中，Layout和Modules不需要单独维护目录，因为我们写的布局组件和模块组件就相当于这两个分类了。<br>如果想要对SMACSS更详细的了解可以访问<a href="https://smacss-zh.vercel.app/preface.html" target="_blank" rel="noopener">SMACSS</a></p><h2 id="设计模式-ITCSS"><a href="#设计模式-ITCSS" class="headerlink" title="设计模式:ITCSS"></a>设计模式:ITCSS</h2><p>这是由<a href="https://csswizardry.com/" target="_blank" rel="noopener">csswizardry</a>提倡的一个 CSS 设计方法论，它可以让CSS更好的管理和维护。<br>使用ITCSS主要可以帮助我们以下几点:</p><ul><li>Manages source order.(管理 CSS 代码的书写顺序)</li><li>Filters explicitness.(过滤器的明确性，是说分层来明确每层 CSS 的作用)</li><li>Tames the cascade.(控制好 CSS 的权重)</li><li>Sanitises inheritance.(安全地使用继承)</li></ul><h3 id="核心思想-分层"><a href="#核心思想-分层" class="headerlink" title="核心思想:分层"></a>核心思想:分层</h3><p>TCSS的核心是分层,主要分为七层, 与SMACSS的分类相比更加精细，层次分的更细主要有:</p><table><thead><tr><th>Layer</th><th>作用</th></tr></thead><tbody><tr><td>Settings</td><td>项目使用的全局变量</td></tr><tr><td>Tools</td><td>mixin，function</td></tr><tr><td>Generic</td><td>最基本的设定 normalize.css，reset</td></tr><tr><td>Base</td><td>type selector</td></tr><tr><td>Objects</td><td>不经过装饰 (Cosmetic-free) 的设计模式，相当于SMACSS的Layout</td></tr><tr><td>Components</td><td>UI 组件</td></tr><tr><td>Trumps</td><td>helper 唯一可以使用 !important 的地方</td></tr></tbody></table><p>下面就是ITCSS的架构模型:<br><img src="/2022/08/15/CSS设计模式/3.jpg" alt="img"><br>从这个模型可以看出来，越往下就越具体，越局限于使用在某个具体的东西。另外它的下一层永远继承上一层的所有样式。</p><h3 id="各个分层例子"><a href="#各个分层例子" class="headerlink" title="各个分层例子"></a>各个分层例子</h3><h4 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h4><p>全局变量，比如颜色，字体大小等等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$yellow: #FAAF00;</span><br><span class="line">$yellow-bright: #FAF7F0;</span><br></pre></td></tr></table></figure></p><h4 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h4><p>mixin，function 等等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@mixin sample-mixin () &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>到 Tools 为止，不会生成具体的 css</p><h4 id="Generic"><a href="#Generic" class="headerlink" title="Generic"></a>Generic</h4><p>reset，normalize 等等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*,</span><br><span class="line">*::before,</span><br><span class="line">*::after &#123;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h4><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Type_selectors" target="_blank" rel="noopener">type selector</a> 比如 link, p 等等，只有这一层才使用 type selector<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p &#123;</span><br><span class="line">  margin: 0</span><br><span class="line">  line-height: 1.5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h4><p>Cosmetic-free，不使用比如 color、border-color、background-color 之类的<br>使用这个 CSS 你在浏览器上面只可以看一片空白<br>主要用来做画面的 layout<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.o-container &#123;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  margin: 0 auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h4><p>UI 组件<br>到这个部分，根据UI分析具体有哪些组件需要实现，可以分给多个人来同时实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># button组件</span><br><span class="line">.c-btn &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">  ...</span><br><span class="line">  &amp;--primary &#123;</span><br><span class="line">    background-color: #ff5959;</span><br><span class="line">    color: #fff;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;--large &#123;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    padding: 16px 14px;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>HTML 类似这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;a class=&quot;c-btn c-btn--primary&quot; href=&quot;#&quot;&gt;sample&lt;/a&gt;</span><br><span class="line">&lt;a class=&quot;c-btn c-btn--primary c-btn--large&quot; href=&quot;#&quot;&gt;sample&lt;/a&gt;</span><br></pre></td></tr></table></figure></p><h4 id="Trumps"><a href="#Trumps" class="headerlink" title="Trumps"></a>Trumps</h4><p>放各种 helper<br>最主要的作用是用在不适合或者不容易放在 Component 的时候<br>比如 margin，很可能不应该放 Component，这时候可以用 Trumps 来微调<br>这样可以防止你的 Component 变得非常大<br>只有这一层才可以使用! important，以此来避免多个! important 的混乱局面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.u-color &#123;</span><br><span class="line">  &amp;--white &#123;</span><br><span class="line">    color: $white !important;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.u-hidden &#123;</span><br><span class="line">  display: hidden !important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>在使用时，每个分层都维护为一个文件夹。在Vue中使用时，Objects和Components相当于我们的组件，不需要单独维护。<br>另外值得注意的是，无论是SMACSS的分类还是ITCSS的分层，都是一种思想，我们可以根据实际项目来动态的添加或者删除某一个分类或者分层，不能生搬硬套。</p></blockquote><h2 id="设计模式-ACSS"><a href="#设计模式-ACSS" class="headerlink" title="设计模式:ACSS"></a>设计模式:ACSS</h2><p>ACSS使用了紧密的类名库。 这些类名通常被缩写，并与它们影响的内容分开。 在ACSS系统中，我们可以知道类名的作用； 但是类名称与内容类型之间没有关系,即每一个样式对应一个类，也称原子类CSS。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.float-left &#123;</span><br><span class="line">  float: left;</span><br><span class="line">&#125;</span><br><span class="line">.float-right &#123;</span><br><span class="line">  float: right;</span><br><span class="line">&#125;</span><br><span class="line">.z-0 &#123;</span><br><span class="line">  z-index: 0;</span><br><span class="line">&#125;</span><br><span class="line">.z-auto &#123;</span><br><span class="line">  z-index: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>从上面的代码中，可以看到ACSS有极强的复用性,维护成本低，但是破坏了css命名的语义化。最终很可能代码会成为下面这样。但是存在即合理，ACSS也有其作用，继续往下看。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;grid grid-cols-3 gap-2 place-content-center h-48 ...&quot;&gt;</span><br><span class="line">  &lt;div&gt;1&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;2&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;3&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;4&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;5&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;6&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><p><a href="https://tailwindcss.com/" target="_blank" rel="noopener">tailwindcss</a>是一个典型的ACSS框架。</p><h2 id="混合使用CSS设计模式"><a href="#混合使用CSS设计模式" class="headerlink" title="混合使用CSS设计模式"></a>混合使用CSS设计模式</h2><p>在进行一个项目的设计时,我们可以针对多种CSS设计模式进行选型，结合不同设计模式的优点和缺点，设计一个完整银杏的CSS架构。<br>假如我们选择ITCSS、BEM、ACSS进行组合，设计一个CSS架构。<br>在我们设计CSS架构时,我们首先想到的一定是SMACSS和ITCSS,因为它们两个对CSS进行了分类分层的划分。</p><table><thead><tr><th>SMACSS</th><th>ITCSS</th></tr></thead><tbody><tr><td>Base</td><td>Setting</td></tr><tr><td>Layout</td><td>Tools</td></tr><tr><td>Modules</td><td>Generic</td></tr><tr><td>State</td><td>Base</td></tr><tr><td>Theme</td><td>Objects</td></tr><tr><td></td><td>Components</td></tr><tr><td></td><td>Trumps</td></tr></tbody></table><p>根据上表我们可以看出ITCSS分层更加精细，所以我们选择ITCSS，接着我们继续看ITCSS的Objects和Components层，它就相当于OOCSS且相当于开发Vue组件，所以我们在开发组件时使用选择OOCSS的进阶版BEM。我们知道如果一个项目全部使用ACSS的缺点跟明显，那么我们选择ACSS的原因是因为项目中可能会存在向字体大小的这种的样式,所以我们可以把这一类样式维护在ACSS目录中。Generic和Base类似所以只保留Base即可，我假设Trumps用不到,所以也去掉这一层。所以我们的架构现在就是下面这样。</p><table><thead><tr><th>ITCSS+BEM+ACSS</th></tr></thead><tbody><tr><td>Setting</td></tr><tr><td>Tools</td></tr><tr><td>Base</td></tr><tr><td>Objects</td></tr><tr><td>Components</td></tr><tr><td>ACSS</td></tr></tbody></table><p>目录结构就是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-|comments</span><br><span class="line">-|styles</span><br><span class="line">--|acss</span><br><span class="line">--|base</span><br><span class="line">--|settings</span><br><span class="line">--|tools</span><br></pre></td></tr></table></figure></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>CSS设计模式听起来很深奥，但是大家在日常开发时，已经不知不觉的在使用，只不过是没有概念而已。在开发中熟练的使用CSS设计模式，可以使代码结构思路清晰，易于阅读，维护，如果想真正的在项目中写好CSS,CSS设计模式是必不可少的，也是我们开发者应该掌握的。</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 样式 </tag>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法基础-时间复杂度</title>
      <link href="/2022/08/05/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/"/>
      <url>/2022/08/05/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<p>算法基础之时间复杂度<br><a id="more"></a><br>对于算法的衡量一般是从两个维度进行的，一是空间维度，即算法执行所需要占据的内存空间；一是时间维度，即算法执行所需要的时间，今天主讲时间维度。</p><h2 id="大O符号表示法"><a href="#大O符号表示法" class="headerlink" title="大O符号表示法"></a>大O符号表示法</h2><p>对于时间复杂度的衡量，我们最常见的就是使用大O符号表示法，例如O(1),O(n)等。之所以采用这样的方式衡量，是因为在不同配置的计算机上，相同的算法代码所呈现出来的性能也不尽相同。所以引入大O符号表示法可以使算法执行所消耗的时间标准化，更加易于对比。<br>大O符号表示法的完整格式是T(n)=O(f(n))，这个函数表示的是代码执行次数与所使用时间之间的正比例关系。其中f(n)表示算法中每行代码执行次数的和，O()表示一个正比例关系。所以大O符号表示法所表示的是算法执行时间的增长变化趋势的，而不是算法实际的执行时间。在使用大O符号表示法的时候，我们一般会假设算法中每一行代码的执行时间都是一样，也就是一个单位时间会运行一行代码，这样我们就能够方便的计算f(n)了。</p><h2 id="常见时间复杂度量级"><a href="#常见时间复杂度量级" class="headerlink" title="常见时间复杂度量级"></a>常见时间复杂度量级</h2><p>一般在代码设计中长长的出现的时间复杂度量级主要有以下这些：</p><ul><li>常数阶O(1)。</li><li>对数阶O(logN)。</li><li>线性阶O(n) 。</li><li>线性对数阶O(nlogN)。</li><li>平方阶O(n^2)。</li><li>立方阶O(n^3)。</li><li>K方阶O(n^k)。</li><li>指数阶O(2^n)。</li><li>组合阶O(n!)。</li></ul><p>以上这些复杂度量级从上到下所表示的复杂度越来越大，执行效率也越来越低。下面就一些示例来说明不同形式的代码其时间复杂度的量级。</p><h3 id="O-1"><a href="#O-1" class="headerlink" title="O(1)"></a>O(1)</h3><p>代码中没有循环结构，无论执行多少行，代码所消耗的时间始终固定，不随着某个变量的操作发生变化，其复杂度就是O(1) 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">i = 1</span><br><span class="line">j = 2</span><br><span class="line">i += 1</span><br><span class="line">j += 2</span><br></pre></td></tr></table></figure></p><h3 id="O-n"><a href="#O-n" class="headerlink" title="O(n)"></a>O(n)</h3><p>代码中只有一层循环结构，没有任何嵌套的循环结构，代码执行所消耗的时间只与循环控制变量线性相关，那么这段代码的复杂度就是O(n) 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int n =100;</span><br><span class="line">for(int i=0; i&lt;n; i++)&#123;</span><br><span class="line">  System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="O-logN"><a href="#O-logN" class="headerlink" title="O(logN)"></a>O(logN)</h3><p>代码中同样只有一层循环结构，没有任何嵌套的循环结构，但是代码执行所消耗的时间与循环控制变量指数相关，那么这段代码的复杂度就是O(logN)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int i = 1;</span><br><span class="line">int n = 1024;</span><br><span class="line">while(i &lt; n)&#123;</span><br><span class="line">    i = i*2;</span><br><span class="line">&#125;</span><br><span class="line">// 或者</span><br><span class="line">for(int i=0; i&lt;n; i*=2)&#123;</span><br><span class="line">    System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>从例子可以看出，时间复杂度是O(log2(n)),但是2可以忽略掉，直接写成O(log(n))。</p><h3 id="O-nlogN"><a href="#O-nlogN" class="headerlink" title="O(nlogN)"></a>O(nlogN)</h3><p>线性对数阶量级中就已经开始出现多层的循环结构了，在复杂度为O(nlogN)量级的代码中，有两层循环结构，其中一层为O(n)量级的循环，一层为O(logN)量级的循环。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int n =100;</span><br><span class="line">int m = 1024;</span><br><span class="line">for(int i=0; i&lt;n; i++)&#123;</span><br><span class="line">  while(i &lt; m)&#123;</span><br><span class="line">    i = i*2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="O-n-2"><a href="#O-n-2" class="headerlink" title="O(n^2)"></a>O(n^2)</h3><p>平方阶O(n²) 就是把 O(n) 的代码再嵌套循环一遍，它的时间复杂度就是 O(n²) 了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int n = 100;</span><br><span class="line">int m = 100;</span><br><span class="line">for (i=0; i &lt; n ; i++)&#123;</span><br><span class="line">  for(i=0; i &lt; m ;i++)&#123;</span><br><span class="line">    System.out.println(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="O-n-3-O-n-k"><a href="#O-n-3-O-n-k" class="headerlink" title="O(n^3) O(n^k)"></a>O(n^3) O(n^k)</h3><p>立方阶则是3层循环嵌套。<br>K方阶则是k层循环嵌套。</p><h3 id="O-2-n"><a href="#O-2-n" class="headerlink" title="O(2^n)"></a>O(2^n)</h3><p>下例从出现递归的时候，T(0) = T(1) = 1，同时 T(n) = T(n - 1) + T(n - 2) + 1，这里的 1 是其中的加法算一次执行。显然 T(n) = T(n - 1) + T(n - 2) 是一个斐波那契数列，通过归纳证明法可以证明，当 n &gt;= 1 时 T(n) &lt; (5/3)^n，同时当 n &gt; 4 时 T(n) &gt;= (3/2)^n。所以该方法的时间复杂度可以表示为 O((5/3)^n)，简化后为 O(2^n)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">long function1(int n) &#123;    </span><br><span class="line">  if (n &lt;= 1) &#123;        </span><br><span class="line">    return 1;</span><br><span class="line">  &#125; else &#123;        </span><br><span class="line">    return function1(n - 1) + function1(n - 2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="复杂度分析的4个高阶概念"><a href="#复杂度分析的4个高阶概念" class="headerlink" title="复杂度分析的4个高阶概念"></a>复杂度分析的4个高阶概念</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul><li>最好情况时间复杂度：代码在最理想情况下执行的时间复杂度。</li><li>最坏情况时间复杂度：代码在最坏情况下执行的时间复杂度。</li><li>平均时间复杂度：用代码在所有情况下执行的次数的加权平均值表示。</li><li>均摊时间复杂度：在代码执行的所有复杂度情况中绝大部分是低级别的复杂度，个别情况是高级别复杂度且发生具有时序关系时，可以将个别高级别复杂度均摊到低级别复杂度上。基本上均摊结果就等于低级别复杂度。</li></ul><h3 id="为什么要引入这4个概念？"><a href="#为什么要引入这4个概念？" class="headerlink" title="为什么要引入这4个概念？"></a>为什么要引入这4个概念？</h3><p>同一段代码在不同情况下时间复杂度会出现量级差异，为了更全面，更准确的描述代码的时间复杂度，所以引入这4个概念。代码复杂度在不同情况下出现量级差别时才需要区别这四种复杂度。大多数情况下，是不需要区别分析它们的。</p><h3 id="如何分析平均、均摊时间复杂度？"><a href="#如何分析平均、均摊时间复杂度？" class="headerlink" title="如何分析平均、均摊时间复杂度？"></a>如何分析平均、均摊时间复杂度？</h3><p>平均时间复杂度：代码在不同情况下复杂度出现量级差别，则用代码所有可能情况下执行次数的加权平均值表示。<br>均摊时间复杂度：两个条件满足时使用：1）代码在绝大多数情况下是低级别复杂度，只有极少数情况是高级别复杂度；2）低级别和高级别复杂度出现具有时序规律。均摊结果一般都等于低级别复杂度。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上是浅浅的介绍下算法的时间复杂度内容。<br>最后介绍一个图形工具<a href="https://zh.numberempire.com/" target="_blank" rel="noopener">数学工具</a><br>进入网站后，点击函数图像绘制工具，可以把复杂度量级以图形的方式直观的展示出来。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>node.js中的setTimeout,setImmediate,Promise,process.nextTick</title>
      <link href="/2022/08/02/node-js%E4%B8%AD%E7%9A%84setTimeout-setImmediate-Promise-process-nextTick/"/>
      <url>/2022/08/02/node-js%E4%B8%AD%E7%9A%84setTimeout-setImmediate-Promise-process-nextTick/</url>
      
        <content type="html"><![CDATA[<p>nodejs中的事件循环宏任务和微任务<br><a id="more"></a></p><h2 id="宏任务"><a href="#宏任务" class="headerlink" title="宏任务"></a>宏任务</h2><p>首先，看一下nodejs的任务队列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">┌───────────────────────┐</span><br><span class="line"></span><br><span class="line">┌&gt; │timers          │执行setTimeout() 和 setInterval()中到期的callback</span><br><span class="line"></span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line"></span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line"></span><br><span class="line">│  │pending callbacks│执行系统操作的回调, 如:tcp, udp通信的错误callback</span><br><span class="line"></span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line"></span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line"></span><br><span class="line">│  │idle, prepare   │只在内部使用</span><br><span class="line"></span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line"></span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line"></span><br><span class="line">│  │poll            │执行与I/O相关的回调</span><br><span class="line"></span><br><span class="line">    │                  (除了close回调、定时器回调和setImmediate()之外，几乎所有回调都执行);</span><br><span class="line"></span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line"></span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line"></span><br><span class="line">│  │check           │执行setImmediate的callback</span><br><span class="line"></span><br><span class="line">│  └──────────┬────────────┘</span><br><span class="line"></span><br><span class="line">│  ┌──────────┴────────────┐</span><br><span class="line"></span><br><span class="line">└─┤close callbacks │执行close事件的callback，例如socket.on(&quot;close&quot;,func)</span><br><span class="line"></span><br><span class="line">    └───────────────────────┘</span><br><span class="line">————————————————</span><br></pre></td></tr></table></figure></p><p>nodejs任务队列有timers，pending callbacks，idle, prepare，poll ，check，close callbacks这6个阶段，其中第2，3个属于nodejs内部的不去探讨，还剩下1，4，5，6.<br>先看两个宏任务的执行顺序：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;setTimeout&apos;);</span><br><span class="line">&#125;, 0);</span><br><span class="line"></span><br><span class="line">setImmediate(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;setImmediate&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>输出的结果不是固定的，可能是nodejs启动时进入的任务队列时机不一样造成的，再看下边的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(&apos;./file.txt&apos;, &apos;utf-8&apos;, (err, data)=&gt; &#123;</span><br><span class="line">    setTimeout(()=&gt; &#123;</span><br><span class="line">        console.log(&apos;setTimeout&apos;);</span><br><span class="line">    &#125;, 0);</span><br><span class="line">    </span><br><span class="line">    setImmediate(()=&gt; &#123;</span><br><span class="line">        console.log(&apos;setImmediate&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>这个例子的输出就是固定的，永远都是”setImmediate”,”setTimeout”,因为按照按照上边任务队列的表来看，poll之后就是check。</p><h2 id="微任务"><a href="#微任务" class="headerlink" title="微任务"></a>微任务</h2><p>Promise和process.nextTick是两个微任务，他们不在任务队列的表格中。他们的执行跟在浏览器端一样，在宏任务之前执行，就是每个宏任务执行之后都会把微任务都执行完了再去执行宏任务。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Promise.resolve().then(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;Promise&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">process.nextTick(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;nextTick&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>nextTick优先顺序高于Promise</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后写一个宏任务和微任务都有的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;setTimeout&apos;);</span><br><span class="line">    process.nextTick(()=&gt; &#123;</span><br><span class="line">        console.log(&apos;setTimeout-nextTick&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, 0);</span><br><span class="line"></span><br><span class="line">setImmediate(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;setImmediate&apos;);</span><br><span class="line">    process.nextTick(()=&gt; &#123;</span><br><span class="line">        console.log(&apos;setImmediate-nextTick&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Promise.resolve().then(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;Promise&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">process.nextTick(()=&gt; &#123;</span><br><span class="line">    console.log(&apos;nextTick&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>执行后发现，当有下边两个微任务在的时候，setTimeout永远在setImmediate前执行，当没有这两个微任务的时候，先后顺序又不一定了，侧面说明微任务可以校准任务队列的执行时机。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Component</title>
      <link href="/2022/06/22/Web-Component/"/>
      <url>/2022/06/22/Web-Component/</url>
      
        <content type="html"><![CDATA[<p>Web Component初探<br><a id="more"></a></p><h3 id="什么是-Web-Component"><a href="#什么是-Web-Component" class="headerlink" title="什么是 Web Component"></a>什么是 Web Component</h3><p>Web Component 是一种 W3C标准 支持的 组件化方案，通过它，我们可以编写可复用的 组件，同时，我们也可以对自己的组件做更精细化的控制。正如 PWA 一样，他并非一项单一的技术，而是由三项技术组成：</p><blockquote><p>1.Shadow DOM<br>2.Custom elements<br>3.HTML templates</p></blockquote><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>我们准备编写一个 TextReverse 组件，TextReverse 只有一个很简单的功能，就是把传入的 字符串颠倒显示。<br>例如： <text-reverse text="123"></text-reverse> 将会显示 321。<br>第一步，我们需要 定义 这个自定义组件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class TextReverse extends HTMLElement &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        super();</span><br><span class="line">        const shadowRoot = this.attachShadow(&#123; mode: &apos;open&apos; &#125;);</span><br><span class="line">        const text = this.getAttribute(&apos;text&apos;) || &apos;&apos;;</span><br><span class="line">        const wrapper = document.createElement(&apos;span&apos;);</span><br><span class="line">        wrapper.textContent = text.split(&apos;&apos;).reverse().join(&apos;&apos;);</span><br><span class="line">        shadowRoot.appendChild(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>定义组件的方式也十分简单，我们只需要 继承一下 HTMLElement，然后在 构造函数 中编写自己的 初始化逻辑 就可以了。<br>初始化过程中，我们首先 创建了一个 shadowRoot，这个相当于是我们整个组件的一个 根结点。<br>紧接着，我们获取到自身的 text 属性，并且将其 倒置 放入新创建的 span 元素中。<br>最后，我们把带有 text 的 span 塞入 shadowRoot。<br>定义完成之后，我们要告知一下系统，也就是 组件注册。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">customElements.define(</span><br><span class="line">    &apos;text-reverse&apos;,</span><br><span class="line">    TextReverse</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>这里有一个小细节，就是我们注册的名字必须是带短横线的。<br>注册完成之后就可以正式使用啦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;text-reverse text=&apos;12345&apos;&gt;&lt;/text-reverse&gt;</span><br></pre></td></tr></table></figure></p><p>上面的例子中，我们用到了 shadow root，他承载着我们组件所有的内容。而他也是 Web Component 核心技术。<br>我们都知道 Dom 其实就是一棵树，而我们的组件则是树上的一个节点。我们可以称组件节点为 shadow host。<br>shadow host 中含有一颗与外界隔离的 dom 树，我们称之为 shadow tree。shadow tree 中的内容不会影响到外界。Shadow Root 则是这一课shadow tree 的根节点。</p><h3 id="样式隔离"><a href="#样式隔离" class="headerlink" title="样式隔离"></a>样式隔离</h3><p>shadow dom 一大亮点就是样式隔离。我们可以给之前的例子加上样式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class TextReverse extends HTMLElement &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        super();</span><br><span class="line">        // ...</span><br><span class="line">        const style = document.createElement(&apos;style&apos;);</span><br><span class="line">        style.textContent = `* &#123;</span><br><span class="line">            background: red;</span><br><span class="line">        &#125;`</span><br><span class="line">        shadowRoot.appendChild(style);</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>我们给所有元素添加一个红的背景色。但是，结果只有组件内的元素背景色受到了影响。这种样式隔离的特性很好地避免了不同组件之间的样式干扰。</p><h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><p>在上面的例子中，我们采用代码的方式来创建修改节点。相较于 React 的 Jsx 和 Vue 的模版，这种方法比较低效。所以，我们可以使用 Template 来解决这问题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template id=&apos;text-reverse&apos;&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        *&#123;</span><br><span class="line">            background: red;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;span id=&apos;text&apos;&gt;&lt;/span&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">class TextReverse extends HTMLElement &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        super();</span><br><span class="line">        const shadowRoot = this.attachShadow(&#123; mode: &apos;open&apos; &#125;);</span><br><span class="line">        const text = this.getAttribute(&apos;text&apos;) || &apos;&apos;;</span><br><span class="line">        const template = document.getElementById(&apos;text-reverse&apos;).content.cloneNode(true);</span><br><span class="line">        template.getElementById(&apos;text&apos;).textContent = text.split(&apos;&apos;).reverse().join(&apos;&apos;);</span><br><span class="line">        shadowRoot.appendChild(template);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>我们在 html 中定义了一个 template，然后，就和操作普通元素一样获取到 template 节点，然后深拷贝一份节点内容。最后直接操作这个节点。</p><h3 id="Slot"><a href="#Slot" class="headerlink" title="Slot"></a>Slot</h3><p>和 Vue 的 Slot 相似，Slot 赋予了组件更高的可扩展性。通过 Slot，我们可以给组件传入更多的自定义内容。<br>在上面的例子中，我们给组件添加一个自定义的标题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;text-reverse text=&apos;12345&apos;&gt;</span><br><span class="line">    &lt;span slot=&apos;title&apos;&gt;text reverse&lt;/span&gt;</span><br><span class="line">&lt;/text-reverse&gt;</span><br><span class="line">&lt;template id=&apos;text-reverse&apos;&gt;</span><br><span class="line">        &lt;h1&gt;&lt;slot name=&apos;title&apos;&gt;default title&lt;/slot&gt;&lt;/h1&gt;</span><br><span class="line">        &lt;span id=&apos;text&apos;&gt;&lt;/span&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></p><p>模版中，我们定义一个 slot 元素，命名为 title，并且设置一个无内容时的默认值 default title。 使用的时候，我们在元素中添加一个 slot 属性来与模版中的 slot 相匹配。</p><h3 id="继承现有元素"><a href="#继承现有元素" class="headerlink" title="继承现有元素"></a>继承现有元素</h3><p>至今，我们都是完全自定义组件内容，假如我们想扩展现有系统元素，那就需要定义一个 内置自定义元素。 我们来用一个屏蔽数字的 p 元素来说明。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class PFilter extends HTMLParagraphElement &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        super();</span><br><span class="line">        const textContent = this.textContent;</span><br><span class="line">        this.textContent = textContent.replace(/\d/g, &apos;*&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">customElements.define(</span><br><span class="line">    &apos;p-filter&apos;,</span><br><span class="line">    PFilter,</span><br><span class="line">    &#123;</span><br><span class="line">        extends: &apos;p&apos;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>我们这边不再是继承 HTMLElement，而是继承需要扩展的 p节点 HTMLParagraphElement。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p is=&apos;p-filter&apos;&gt;我的手机号是：10086&lt;/p&gt;</span><br></pre></td></tr></table></figure></p><p>不同于独立自定义组件，我们还是需要用原有元素名去声明，并且在 is 属性中填写我们的组件名。</p><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>和大多数框架一样，Web Component 也含有许多控制组件生命周期的方法。</p><blockquote><p>1.connectedCallback：当 custom elemen t首次被插入 DOM 时，被调用。<br>2.disconnectedCallback：当 custom element 从 DOM 中删除时，被调用。<br>3.adoptedCallback：当 custom element 被移动到新的文档时，被调用。<br>4.attributeChangedCallback: 当 custom element 增加、删除、修改自身属性时，被调用。</p></blockquote><p>我们只需在定义组件的类中声明对应的方法即可。attributeChangedCallback 相对与别的属性比较特别，他需要 搭配 observedAttributes 使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class TextReverse extends HTMLElement &#123;</span><br><span class="line">    //...</span><br><span class="line">    static get observedAttributes () &#123;</span><br><span class="line">        return [&apos;text&apos;];</span><br><span class="line">    &#125;</span><br><span class="line">    attributeChangedCallback () &#123;</span><br><span class="line">        const text = this.getAttribute(&apos;text&apos;) || &apos;&apos;;</span><br><span class="line">        this.shadowRoot.getElementById(&apos;text&apos;).textContent = text.split(&apos;&apos;).reverse().join(&apos;&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>我们在 observedAttributes静态方法中添加需要监听的属性值。然后，在 text 改变的时候，触发 attributeChangedCallback方法来更新 text的值。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Web Component 的功能十分强大，相较于 React，Vue等框架，他天生自带样式隔离，并且最主要的是拥有浏览器的原生支持。不过，想要达到工程开发标准 的话，他还有一段很长很长的路要走。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Service Worker</title>
      <link href="/2022/06/06/Service-Worker/"/>
      <url>/2022/06/06/Service-Worker/</url>
      
        <content type="html"><![CDATA[<p>Service Worker初探<br><a id="more"></a></p><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>service worker定义先不谈，主要简单的介绍下笔者对service worker流程理解,也就是生命周期,直奔主题。</p><blockquote><p>1.第一次进入html文件时，注册service worker文件(sw.js)，接下来sw.js文件中的install事件响应，紧接着activate事件响应，最后是register注册的Promise的then执行，记住，这时registration的状态是installed。在第一次打开网页时，install和activate事件都会执行，可以在install事件里做缓存配置处理，可以在activate事件里做删除无用的缓存处理。<br>2.再次进入这个页面时，因为第一次已经注册了sw.js文件，所以install和activate事件是不会执行的，但是fetch事件可以执行，也可以理解为，再次进入这个页面时，service worker已经接管了这个页面，可以在fetch事件里对请求做处理，也就是service worker的核心功能所在。这时registration的状态是active。<br>3.service worker和html页面是分离的，页面关闭，service worker并不会关闭，每次打开html页面时，这个页面注册过的service worker都会对其进行监管操作，一个页面可以对应多个service worker，只有active状态下的service worker才是正在工作的。因为每次在修改了sw.js文件后，浏览器会自动检查这个文件是否有改变，如果有改变了，会执行步骤1的注册流程，这个时候可以在install事件中，加上self.skipWaiting()，它的作用是将当前的service worker状态提升到active，接管网页操作。</p></blockquote><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>sw.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;./lib/1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;./lib/2.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;./lib/3.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;./lib/4.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;./lib/5.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;./lib/6.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;service worker&lt;/h1&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    if (&apos;serviceWorker&apos; in navigator) &#123;</span><br><span class="line">      /* 当页面加载完成就创建一个serviceWorker */</span><br><span class="line">      window.addEventListener(&apos;load&apos;, function () &#123;</span><br><span class="line">        /* 创建并指定对应的执行内容 */</span><br><span class="line">        /* scope 参数是可选的，可以用来指定你想让 service worker 控制的内容的子目录。 在这个例子里，我们指定了 &apos;/&apos;，表示 根网域下的所有内容。这也是默认值。 */</span><br><span class="line">        navigator.serviceWorker.register(&apos;./sw.js&apos;, &#123;scope: &apos;./&apos;&#125;)</span><br><span class="line">          .then(function (registration) &#123;</span><br><span class="line">            if (registration.installing) &#123;</span><br><span class="line">              console.log(&apos;Service worker installing&apos;);</span><br><span class="line">            &#125; else if (registration.waiting) &#123;</span><br><span class="line">              console.log(&apos;Service worker installed&apos;);</span><br><span class="line">            &#125; else if (registration.active) &#123;</span><br><span class="line">              console.log(&apos;Service worker active&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(function (err) &#123;</span><br><span class="line">            console.log(&apos;ServiceWorker registration failed: &apos;, err);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>sw.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">var CACHE_NAME = &apos;v1&apos;;</span><br><span class="line">/* 监听安装事件，install 事件一般是被用来设置你的浏览器的离线缓存逻辑 */</span><br><span class="line">this.addEventListener(&apos;install&apos;, function (event) &#123;</span><br><span class="line">  console.log(&apos;install-&apos;+CACHE_NAME);</span><br><span class="line">  self.skipWaiting();</span><br><span class="line">  event.waitUntil(</span><br><span class="line">      /* 创建一个名叫V1的缓存版本 */</span><br><span class="line">      caches.open(CACHE_NAME).then(function (cache) &#123;</span><br><span class="line">          /* 指定要缓存的内容，地址为相对于跟域名的访问路径 */</span><br><span class="line">          return cache.addAll([</span><br><span class="line">              &apos;/sw.html&apos;,</span><br><span class="line">              &apos;./lib/1.js&apos;,</span><br><span class="line">              &apos;./lib/2.js&apos;,</span><br><span class="line">              &apos;./lib/3.js&apos;,</span><br><span class="line">          ]);</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line">// 激活事件</span><br><span class="line">this.addEventListener(&apos;activate&apos;, function(event) &#123;</span><br><span class="line">  console.log(&apos;activate&apos;);</span><br><span class="line">  let cacheWhitelist = [CACHE_NAME];</span><br><span class="line">    // 将其他的chace缓存清除</span><br><span class="line">    event.waitUntil(</span><br><span class="line">      caches.keys().then (cacheNames =&gt; &#123;</span><br><span class="line">        return Promise.all(</span><br><span class="line">          cacheNames.map( cacheName =&gt; &#123;</span><br><span class="line">            if (cacheWhitelist.indexOf(cacheName) === -1) &#123;</span><br><span class="line">              return caches.delete(cacheName)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;);</span><br><span class="line">// fetch事件-是否是install时缓存的文件</span><br><span class="line">// this.addEventListener(&apos;fetch&apos;, function(event) &#123;</span><br><span class="line">//   event.respondWith(caches.match(event.request).then(function (response) &#123;</span><br><span class="line">//     if (response) &#123;</span><br><span class="line">//       console.log(response, &apos;------&apos;);</span><br><span class="line">//       return response</span><br><span class="line">//     &#125; else &#123;</span><br><span class="line">//       console.log(event.request, &apos;========&apos;);</span><br><span class="line">//       return fetch(event.request)</span><br><span class="line">//     &#125;</span><br><span class="line">//   &#125;));</span><br><span class="line">// &#125;);</span><br><span class="line">// fetch事件-</span><br><span class="line">this.addEventListener(&apos;fetch&apos;, function(event) &#123;</span><br><span class="line">  if (navigator.onLine) &#123;</span><br><span class="line">    return fetch(event.request.clone()).then(function (response) &#123;</span><br><span class="line">      if (!response || response.status !== 200) &#123;</span><br><span class="line">        return response</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      caches.open(CACHE_NAME).then(function (cache) &#123;</span><br><span class="line">        cache.put(event.request, response.clone())</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      return response</span><br><span class="line">    &#125;).catch(function (err) &#123;</span><br><span class="line">      console.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    event.respondWith(caches.match(event.request).then(function (response) &#123;</span><br><span class="line">      if (response) &#123;</span><br><span class="line">        // A cached response has been found!</span><br><span class="line">        return response</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // We don&apos;t have a cached response, initiate a fetch...</span><br><span class="line">        return fetch(event.request)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>service worker功能非常强大，PWA就是基于service worker，以上只是简单的介绍，不过生命周期也就这么多内容。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> worker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Worker</title>
      <link href="/2022/06/01/Web-Worker/"/>
      <url>/2022/06/01/Web-Worker/</url>
      
        <content type="html"><![CDATA[<p>Web Server的简单介绍<br><a id="more"></a></p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Web Worker使得一个Web应用程序可以在与主执行线程分离的后台线程中运行一个脚本操作。这样做的好处是可以在一个单独的线程中执行任务，从而允许主（通常是UI）线程运行而不被阻塞。<br>它的作用就是给JS创造多线程运行环境，允许主线程创建worker线程，分配任务给后者，主线程运行的同时worker线程也在运行，相互不干扰，在worker线程运行结束后把结果返回给主线程。这样做的好处是主线程可以把计算密集型或高延迟的任务交给worker线程执行，这样主线程就会变得轻松，不会被阻塞或拖慢。这并不意味着JS语言本身支持了多线程能力，而是浏览器作为宿主环境提供了JS一个多线程运行的环境。<br>不过因为worker一旦新建，就会一直运行，不会被主线程的活动打断，这样有利于随时响应主线程的通性，但是也会造成资源的浪费，所以不应过度使用，用完注意关闭。或者说：如果worker无实例引用，该worker空闲后立即会被关闭；如果worker实列引用不为0，该worker空闲也不会被关闭。</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><ul><li>同源限制<br>worker线程执行的脚本文件必须和主线程的脚本文件同源，这是当然的了，总不能允许worker线程到别人电脑上到处读文件吧</li><li>文件限制<br>为了安全，worker线程无法读取本地文件，它所加载的脚本必须来自网络，且需要与主线程的脚本同源</li><li>DOM操作限制<br>worker线程在与主线程的window不同的另一个全局上下文中运行，其中无法读取主线程所在网页的DOM对象，也不能获取 document、window等对象，但是可以获取navigator、location(只读)、XMLHttpRequest、setTimeout族等浏览器API。</li><li>通信限制<br>worker线程与主线程不在同一个上下文，不能直接通信，需要通过postMessage方法来通信。</li><li>脚本限制<br>worker线程不能执行alert、confirm，但可以使用 XMLHttpRequest 对象发出ajax请求。</li></ul><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>worker线程的js文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// workerThread1.js</span><br><span class="line">let i = 1</span><br><span class="line">function simpleCount() &#123;</span><br><span class="line">  i++</span><br><span class="line">  self.postMessage(i)</span><br><span class="line">  setTimeout(simpleCount, 1000)</span><br><span class="line">&#125;</span><br><span class="line">simpleCount()</span><br><span class="line">self.onmessage = ev =&gt; &#123;</span><br><span class="line">  postMessage(ev.data + &apos; 呵呵~&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>html文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  Worker 输出内容：&lt;span id=&apos;app&apos;&gt;&lt;/span&gt;</span><br><span class="line">  &lt;input type=&apos;text&apos; title=&apos;&apos; id=&apos;msg&apos;&gt;</span><br><span class="line">  &lt;button onclick=&apos;sendMessage()&apos;&gt;发送&lt;/button&gt;</span><br><span class="line">  &lt;button onclick=&apos;stopWorker()&apos;&gt;stop!&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&apos;text/javascript&apos;&gt;</span><br><span class="line">  if (typeof(Worker) === &apos;undefined&apos;)// 使用Worker前检查一下浏览器是否支持</span><br><span class="line">    document.writeln(&apos; Sorry! No Web Worker support.. &apos;)</span><br><span class="line">  else &#123;</span><br><span class="line">    window.w = new Worker(&apos;workerThread1.js&apos;)</span><br><span class="line">    window.w.onmessage = ev =&gt; &#123;</span><br><span class="line">      document.getElementById(&apos;app&apos;).innerHTML = ev.data</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    window.w.onerror = err =&gt; &#123;</span><br><span class="line">      w.terminate()</span><br><span class="line">      console.log(error.filename, error.lineno, error.message) // 发生错误的文件名、行号、错误内容</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function sendMessage() &#123;</span><br><span class="line">      const msg = document.getElementById(&apos;msg&apos;)</span><br><span class="line">      window.w.postMessage(msg.value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function stopWorker() &#123;</span><br><span class="line">      window.w.terminate()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>主线程中的api，worker表示是 Worker 的实例</p><blockquote><p>worker.postMessage: 主线程往worker线程发消息，消息可以是任意类型数据，包括二进制数据<br>worker.terminate: 主线程关闭worker线程<br>worker.onmessage: 指定worker线程发消息时的回调，也可以通过worker.addEventListener(‘message’,cb)的方式<br>worker.onerror: 指定worker线程发生错误时的回调，也可以 worker.addEventListener(‘error’,cb)</p></blockquote><p>Worker线程中全局对象为 self，代表子线程自身，这时 this指向self</p><blockquote><p>self.postMessage: worker线程往主线程发消息，消息可以是任意类型数据，包括二进制数据<br>self.close: worker线程关闭自己<br>self.onmessage: 指定主线程发worker线程消息时的回调，也可以self.addEventListener(‘message’,cb)<br>self.onerror: 指定worker线程发生错误时的回调，也可以 self.addEventListener(‘error’,cb)</p></blockquote><p>注意，w.postMessage(aMessage, transferList) 方法接受两个参数，aMessage 是可以传递任何类型数据的，包括对象，这种通信是拷贝关系，即是传值而不是传址，Worker 对通信内容的修改，不会影响到主线程。事实上，浏览器内部的运行机制是，先将通信内容串行化，然后把串行化后的字符串发给 Worker，后者再将它还原。一个可选的 Transferable对象的数组，用于传递所有权。如果一个对象的所有权被转移，在发送它的上下文中将变为不可用（中止），并且只有在它被发送到的worker中可用。可转移对象是如ArrayBuffer，MessagePort或ImageBitmap的实例对象，transferList数组中不可传入null。</p><p>worker线程中加载脚本的api</p><blockquote><p>importScripts(‘script1.js’)    // 加载单个脚本<br>importScripts(‘script1.js’, ‘script2.js’)    // 加载多个脚本</p></blockquote><h2 id="实战场景"><a href="#实战场景" class="headerlink" title="实战场景"></a>实战场景</h2><ul><li>加密数据<br>有些加解密的算法比较复杂，或者在加解密很多数据的时候，这会非常耗费计算资源，导致UI线程无响应，因此这是使用Web Worker的好时机，使用Worker线程可以让用户更加无缝的操作UI。</li><li>预取数据<br>有时候为了提升数据加载速度，可以提前使用Worker线程获取数据，因为Worker线程是可以是用 XMLHttpRequest 的。</li><li>预渲染<br>在某些渲染场景下，比如渲染复杂的canvas的时候需要计算的效果比如反射、折射、光影、材料等，这些计算的逻辑可以使用Worker线程来执行，也可以使用多个Worker线程，这里有个<a href="https://nerget.com/rayjs-mt/rayjs.html" target="_blank" rel="noopener">射线追踪的示例</a>。</li><li>复杂数据处理场景<br>某些检索、排序、过滤、分析会非常耗费时间，这时可以使用Web Worker来进行，不占用主线程。</li><li>预加载图片<br>有时候一个页面有很多图片，或者有几个很大的图片的时候，如果业务限制不考虑懒加载，也可以使用Web Worker来加载图片，可以参考一下<a href="https://juejin.cn/post/6844903510673211400" target="_blank" rel="noopener">这篇文章的探索</a>，这里简单提要一下。</li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> worker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Map与WeakMap(垃圾回收角度)</title>
      <link href="/2022/05/30/Map%E4%B8%8EWeakMap-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%A7%92%E5%BA%A6/"/>
      <url>/2022/05/30/Map%E4%B8%8EWeakMap-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%A7%92%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<p>nodejs环境，垃圾回收角度看Map与WeakMap区别<br><a id="more"></a></p><h3 id="Map与WeakMap简单区别"><a href="#Map与WeakMap简单区别" class="headerlink" title="Map与WeakMap简单区别"></a>Map与WeakMap简单区别</h3><blockquote><p>Map的键值可以是原始数据类型和引用类型，WeakMap的键值只能说引用类型（object）。<br>Map可以迭代遍历键，WeakMap不可迭代遍历键。<br>WeakMap中的”weak“表示弱映射的键是”弱弱地拿着“的，意思就是，这些键不属于正式的引用。<br>换言之，WeakMap所构建的实例中，其key键所对应引用地址的引用断开或不属于指向同一个内存地址的时候，其对应value值就会被加入垃圾回收队伍。（粗暴理解为：因为key必须是个引用类型，当key引用断了或变了，这个键值对就可以进垃圾桶了）<br>观察内存空间理解WeakMap，因为通常条件下很难察觉WeakMap里面keyValue什么时候消失，但是通过某一个引用类型的值大到足够占据一定内存时候，我们可以通过观察内存的变化来观察WeakMap的特性。</p></blockquote><h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><p>Node.js的进程Api process.memoryUsage()配合手动垃圾回收global.gc()在终端观察。（也可以使用Chrome浏览器Performance功能录制内存变化）</p><blockquote><p>glabal.gc()<br>手动调用一次垃圾回收。需要在运行js文件时候增加命令 –expose-gc，一般环境下不推荐使用，这里做学习用。</p></blockquote><blockquote><p>process.memoryUsage()<br>查看Node进程的内存占用情况,返回值为对象其中包含五个属性 rss，heapTotal，heapUsed，external，arrayBuffers；其中主要属性是 heapTotal和heapUsed对应的是V8的堆内存信息。heapTotal是堆中总共申请的内存量，heapUsed表示目前堆中使用的内存量,单位都为字节。</p></blockquote><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>1.WeakMap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 第一次手动清理垃圾以确保为最新状态，观察内存情况</span><br><span class="line">global.gc();</span><br><span class="line">console.log(`第一次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB`);</span><br><span class="line">const wm = new WeakMap();</span><br><span class="line"></span><br><span class="line">let key = &#123;&#125;;</span><br><span class="line">// 给 WeakMap实例 赋值一个 占领内存足够大的 键值对</span><br><span class="line">wm.set(key, new Array(114514 * 19));</span><br><span class="line">// 手动清理一下垃圾 观察内存占用情况</span><br><span class="line">global.gc();</span><br><span class="line">console.log(`第二次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB`);</span><br><span class="line"></span><br><span class="line">// 此时把 key键 的引用进行断开，并观察内存占用情况</span><br><span class="line">key = null;</span><br><span class="line">// key = new Array();  </span><br><span class="line">// 这种改变引用地址写法也可以引起 弱映射，因为引用地址不再是同块内存地址 WeakMap内对应的value也会被垃圾回收</span><br><span class="line"></span><br><span class="line">global.gc();</span><br><span class="line">console.log(`第三次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB`);</span><br><span class="line"></span><br><span class="line">$ node --expose-gc index.js</span><br><span class="line"></span><br><span class="line">第一次垃圾回收，当前内存使用情况：1.66MB</span><br><span class="line">第二次垃圾回收，当前内存使用情况：18.45MB</span><br><span class="line">第三次垃圾回收，当前内存使用情况：1.84MB</span><br></pre></td></tr></table></figure></p><p>2.Map<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// 第一次手动清理垃圾以确保为最新状态，观察内存情况</span><br><span class="line">global.gc();</span><br><span class="line">console.log(</span><br><span class="line">  `第一次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB`</span><br><span class="line">);</span><br><span class="line">const m = new Map();</span><br><span class="line"></span><br><span class="line">let key = &#123;&#125;;</span><br><span class="line">m.set(key, new Array(114514 * 19));</span><br><span class="line">// 手动清理一下垃圾 观察内存占用情况</span><br><span class="line">global.gc();</span><br><span class="line">console.log(</span><br><span class="line">  `第二次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB，</span><br><span class="line">  当前Map的长度: $&#123;m.size&#125;`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 此时把 key键 的引用进行断开，并观察内存占用情况</span><br><span class="line">key = null;</span><br><span class="line">global.gc();</span><br><span class="line">console.log(</span><br><span class="line">  `第三次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB，</span><br><span class="line">  当前Map的长度: $&#123;m.size&#125;`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 清除Map所有键值对</span><br><span class="line">m.clear();</span><br><span class="line"></span><br><span class="line">global.gc();</span><br><span class="line">console.log(</span><br><span class="line">  `第四次垃圾回收，当前内存使用情况：$&#123;(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)&#125;MB，</span><br><span class="line">  当前Map的长度: $&#123;m.size&#125;`</span><br><span class="line">);</span><br><span class="line">$ node --expose-gc index.js</span><br><span class="line">第一次垃圾回收，当前内存使用情况：1.66MB</span><br><span class="line">第二次垃圾回收，当前内存使用情况：18.45MB，当前Map的长度: 1</span><br><span class="line">第三次垃圾回收，当前内存使用情况：18.45MB，当前Map的长度: 1</span><br><span class="line">第四次垃圾回收，当前内存使用情况：1.85MB，当前Map的长度: 0</span><br></pre></td></tr></table></figure></p><p>由此可见Map所构建的实例是需要手动清理，才能被垃圾回收清除，而WeakMap只要外部的引用消失，所对应的键值对就会自动被垃圾回收清除。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数式编程的核心思想</title>
      <link href="/2022/05/09/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3/"/>
      <url>/2022/05/09/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3/</url>
      
        <content type="html"><![CDATA[<p>什么是函数式编程<br><a id="more"></a><br>函数式编程最近几年越炒越热，有函数式编程的语言鄙视没有函数式编程的语言，纯函数式编程的语言鄙视不纯的函数式编程的语言。</p><p>那么，到底什么是函数式编程，函数式编程的核心思想又是什么？</p><p>函数式编程的第一个特点就是可以把函数作为参数传递给另一个函数，也就是所谓的高阶函数。例如，对数组进行排序，可以传入一个排序函数作为参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] array = &#123; &quot;orange&quot;, &quot;Pear&quot;, &quot;Apple&quot; &#125;;</span><br><span class="line">Arrays.sort(array, String::compareToIgnoreCase);</span><br></pre></td></tr></table></figure></p><p>函数式编程的第二个特点就是可以返回一个函数，这样就可以实现闭包或者惰性计算：</p><p>以上两个特点还仅仅是简化了代码。从代码的可维护性上讲，函数式编程最大的好处是引用透明，即函数运行的结果只依赖于输入的参数，而不依赖于外部状态，因此，我们常常说函数式编程没有副作用。</p><p>没有副作用有个巨大的好处，就是函数内部无状态，即输入确定，输出就是确定的，容易测试和维护。</p><p>很多初学者容易纠结“纯”函数式语言，认为只有Haskell这种消除了变量和副作用的语言才是正宗的函数式编程。还有人甚至认为纯函数不能有任何IO操作，包括打行日志都不行。</p><p>其实这种纠结是没有意义的，因为计算机底层就是一个完全可变的内存和不可预测输入的系统，追求完美的无副作用是不现实的，我们只需要理解函数式编程的思想，把业务逻辑做到“无副作用”，至于有变量、打日志、读缓存这些无关紧要的“副作用”，根本不用担心，不需要解决，也几乎没法解决。</p><p>我们来举个栗子。</p><p>比如一个财务软件，需要一个函数专门计算个人所得税，输入是一个<code>IncomeRecord</code>，输出是个税金额：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">double calculateIncomeTax(IncomeRecord record) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>又假设<code>IncomeRecord</code>长这样：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class IncomeRecord &#123;</span><br><span class="line">    String id; // 身份证号</span><br><span class="line">    String name; // 姓名</span><br><span class="line">    double salary; // 工资</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先不考虑五险一金这些乱七八糟的东西，我们只关注如何计算个税。为了简化，我们假设直接扣除一个免征额后按20%计算：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">double calculateIncomeTax(IncomeRecord record) &#123;</span><br><span class="line">    double threshold = 3500;</span><br><span class="line">    double tax = record.salary &lt;= threshold ? 0 : (record.salary - threshold) * 0.2;</span><br><span class="line">    return tax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这个程序在2018年9月1号前是没问题的，问题是2018年9月1号后起征点调整到了5000，那2018年8月和2018年9月，计算结果应该不一样。怎么改？</p><p>普通开发者的改法：那还不简单？直接获取当前日期，返回正确的起征点就行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">double calculateIncomeTax(IncomeRecord record) &#123;</span><br><span class="line">    double threshold = today() &lt; date(2018, 9, 1) ? 3500 : 5000;</span><br><span class="line">    double tax = record.salary &lt;= threshold ? 0 : (record.salary - threshold) * 0.2;</span><br><span class="line">    return tax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>程序是没错，问题是：</p><p>同样的输入，8月31号跑，和9月1号跑，结果不一样，难道会计要在9月1号做8月份的工资条，必须把电脑的时间先调到8月份？</p><p>用函数式编程的观点思考一下，就发现问题所在：</p><p><code>today()</code>这个函数，返回结果与时间有关，这就造成了<code>calculateIncomeTax()</code>不再是一个纯函数，它与当前时间相关了。</p><p>那怎么把<code>calculateIncomeTax()</code>恢复成一个纯函数，同时要支持起征点调整？</p><p>方法是把时间相关的变量作为参数传进来，例如，给<code>IncomeRecord</code>增加几个字段：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class IncomeRecord &#123;</span><br><span class="line">    String id; // 身份证号</span><br><span class="line">    String name; // 姓名</span><br><span class="line">    double salary; // 工资</span><br><span class="line">    int year; // 年</span><br><span class="line">    int month; // 月</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样我们就可以消除today()的调用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">double calculateIncomeTax(IncomeRecord record) &#123;</span><br><span class="line">    double threshold = date(record.year, record.month) &lt; date(2018, 9) ? 3500 : 5000;</span><br><span class="line">    double tax = record.salary &lt;= threshold ? 0 : (record.salary - threshold) * 0.2;</span><br><span class="line">    return tax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>calculateIncomeTax()</code>又变成了一个纯函数，会计就不用改电脑时间了。</p><p>是不是觉得这个例子太简单了？其实简单的函数如果都能写成有状态的，那么复杂的业务逻辑必然写成一锅粥。</p><p>举个复杂的栗子：</p><p>对于一个股票交易系统，如果我们把输入定义为：开盘前所有股民的现金和持股，以及交易时段的所有订单，那么，输出就是收盘后所有股民的现金和持股：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StockStatus process(StockStatus old, List&lt;Order&gt; orders) &#123;</span><br><span class="line">    ...</span><br><span class="line">    for (Order order : orders) &#123;</span><br><span class="line">        ...</span><br><span class="line">        sendExchangeResult(...); // 给每一笔成交发送信息</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>很显然这是一个纯函数，虽然在处理过程中，这个函数会给股民朋友发送各种心跳消息。</p><p>如果把交易系统的模型设计成这样一个纯函数，那么理论上我们只需要从股市开市的那一天开始，把所有订单全部处理一遍，就可以正确得到今天收盘后的状态。</p><p>或者说，只要取任意一天开盘前的系统状态的备份（就是整个数据库的备份），把当天的订单重新处理一遍，就得到了当天收盘的状态。这个过程可以做任意次，结果不变，因此，非常适合验证代码的修改是否影响了业务流程。</p><p>那么问题来了，交易系统中有无数和时间相关的状态，怎么处理成纯函数？这个模型的处理，可比计算个税复杂多了。</p><p>这就是函数式编程的精髓：业务系统模型无状态。模型的好坏，直接影响到代码的正确性、可靠性、稳定性，以及是否需要996。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fork github仓库后，与原仓库进行同步</title>
      <link href="/2022/04/29/fork-github%E4%BB%93%E5%BA%93%E5%90%8E%EF%BC%8C%E4%B8%8E%E5%8E%9F%E4%BB%93%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%90%8C%E6%AD%A5/"/>
      <url>/2022/04/29/fork-github%E4%BB%93%E5%BA%93%E5%90%8E%EF%BC%8C%E4%B8%8E%E5%8E%9F%E4%BB%93%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%90%8C%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<p>fork了别人的github仓库，如何与原仓库进行同步？<br><a id="more"></a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我们在使用GitHub时，看到好的项目或想给某个项目做贡献，此时通常会将代码仓库fork到自己的账号下。如果在此期间，如果源仓库的代码发生了变动，就需要与源仓库代码进行同步。本篇文章就带大家实操一下，如何实现这一操作。</p><h2 id="配置项目的上游仓库"><a href="#配置项目的上游仓库" class="headerlink" title="配置项目的上游仓库"></a>配置项目的上游仓库</h2><p>首先需要大家将fork的仓库代码clone到本地，后面的所有操作都是基于本地代码库来进行操作的。比如，可以通过git clone先将fork的代码下载到本地：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:secbr/nacos.git</span><br></pre></td></tr></table></figure></p><p>后续的一步步操作，都是基于本地仓库来进行操作。</p><h2 id="进入到本地仓库目录"><a href="#进入到本地仓库目录" class="headerlink" title="进入到本地仓库目录"></a>进入到本地仓库目录</h2><p>通过cd操作，进入到clone下来的本地仓库根目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/apple/develop/nacos-request/nacos</span><br></pre></td></tr></table></figure></p><p>后续的操作无特殊说明，都是在这个本地仓库的目录下进行操作。</p><h2 id="查看远程仓库路径"><a href="#查看远程仓库路径" class="headerlink" title="查看远程仓库路径"></a>查看远程仓库路径</h2><p>执行命令 git remote -v 查看远程仓库的路径：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git remote -v</span><br><span class="line">origin  https://github.com/secbr/nacos.git (fetch)</span><br><span class="line">origin  https://github.com/secbr/nacos.git (push)</span><br></pre></td></tr></table></figure></p><p>如果只显示2行内容，说明该项目还未设置upstream （中文叫：上游代码库），一般情况下，设置好一次 upstream 后就无需重复设置。通过显示远程仓库的路径和clone时的路径对照，会发现，此时远程仓库的路径还是fork项目的路径。</p><h2 id="添加upstream路径"><a href="#添加upstream路径" class="headerlink" title="添加upstream路径"></a>添加upstream路径</h2><p>执行命令 git remote add upstream <a href="https://xxx.git，把fork的源仓库设置为" target="_blank" rel="noopener">https://xxx.git，把fork的源仓库设置为</a> upstream 。这里项目是从alibaba的nacos仓库fork过来的，因此对应的upstream就是alibaba的源仓库地址。</p><p>执行上述命令，在此执行git remote -v 检查是否成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git remote add upstream https://github.com/alibaba/nacos.git</span><br><span class="line">appledeMacBook-Pro-2:nacos apple$ git remote -v</span><br><span class="line">origin  https://github.com/secbr/nacos.git (fetch)</span><br><span class="line">origin  https://github.com/secbr/nacos.git (push)</span><br><span class="line">upstream        https://github.com/alibaba/nacos.git (fetch)</span><br><span class="line">upstream        https://github.com/alibaba/nacos.git (push)</span><br></pre></td></tr></table></figure></p><p>通过上面的输出可以看出，多了两项upstream的地址，说明添加upstream成功。</p><h2 id="检查本地代码状态"><a href="#检查本地代码状态" class="headerlink" title="检查本地代码状态"></a>检查本地代码状态</h2><p>由于我们的实例是直接从仓库clone下来的，本地还没有修改代码。如果你的本地项目已经修改了一些代码，不确定是否提交了代码，就需要执行git status来检查一下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git status</span><br><span class="line">On branch develop</span><br><span class="line">Your branch is up to date with &apos;origin/develop&apos;.</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure></p><p>上面显示，本地没有需要提交的（commit）的代码。如果本地有修改，需要先从本地仓库推送到GitHub仓库。然后，再执行一次 git status 检查。<br>对应推送到GitHub仓库的基本操作步骤如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add -A 或者 git add filename</span><br><span class="line">git commit -m &quot;your note&quot;</span><br><span class="line">git push origin master</span><br><span class="line">git status</span><br></pre></td></tr></table></figure></p><p>完成上面的基本操作之后，确认代码都已经提交，便可以开始执行源仓库与本地仓库的merge操作了。</p><h2 id="抓取源仓库的更新"><a href="#抓取源仓库的更新" class="headerlink" title="抓取源仓库的更新"></a>抓取源仓库的更新</h2><p>经过上面步骤的准备之后，我们可以进行源仓库的代码更新了。执行命令 git fetch upstream 抓取原仓库的更新：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git fetch upstream</span><br><span class="line">remote: Enumerating objects: 2646, done.</span><br><span class="line">remote: Counting objects: 100% (2593/2593), done.</span><br><span class="line">remote: Compressing objects: 100% (1157/1157), done.</span><br><span class="line">remote: Total 2646 (delta 731), reused 2404 (delta 682), pack-reused 53</span><br><span class="line">Receiving objects: 100% (2646/2646), 1.67 MiB | 1.47 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (734/734), completed with 37 local objects.</span><br><span class="line">From https://github.com/alibaba/nacos</span><br><span class="line"> * [new branch]          0.2.1                               -&gt; upstream/0.2.1</span><br><span class="line"> * [new branch]          0.2.2                               -&gt; upstream/0.2.2</span><br><span class="line"> * [new branch]          0.3.0                               -&gt; upstream/0.3.0</span><br><span class="line">//...省略一部分</span><br></pre></td></tr></table></figure></p><p>执行上述命令之后，上游仓库的更新（commit）会本存储为本地的分支，通常名称为：upstream/BRANCHNAME。比如上面的upstream/0.3.0。</p><h2 id="切换分支"><a href="#切换分支" class="headerlink" title="切换分支"></a>切换分支</h2><p>完成了上游仓库分支的拉取之后，先来核查一下本地仓库当前处于哪个分支，也就是需要更新合并的分支。比如，这里我需要将develop分支的内容更新到与上游仓库代码一致。则先切换到develop分支：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git checkout develop</span><br><span class="line">Already on &apos;develop&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/develop&apos;.</span><br></pre></td></tr></table></figure></p><p>上面提示已经是develop分支了。</p><h2 id="执行合并"><a href="#执行合并" class="headerlink" title="执行合并"></a>执行合并</h2><p>执行命令 git merge upstream/develop 合并远程的develop分支。比如你合并的可能是master，可根据需要将develop的名称替换成对应的master。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git merge upstream/develop</span><br><span class="line">Removing test/src/test/java/com/alibaba/nacos/test/naming/DeregisterInstance_ITCase.java</span><br><span class="line">// ...省略一部分</span><br><span class="line">Removing naming/src/test/java/com/alibaba/nacos/naming/core/PushServiceTest.java</span><br><span class="line">Auto-merging client/src/main/java/com/alibaba/nacos/client/naming/remote/http/NamingHttpClientProxy.java</span><br><span class="line">CONFLICT (content): Merge conflict in client/src/main/java/com/alibaba/nacos/client/naming/remote/http/NamingHttpClientProxy.java</span><br><span class="line">Removing client/src/main/java/com/alibaba/nacos/client/naming/core/HostReactor.java</span><br><span class="line">Removing .editorconfig</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></table></figure></p><p>执行完上述命令之后，会发现上游代码指定分支的修改内容已经反映到本地代码了。</p><h2 id="上传代码到fork分支"><a href="#上传代码到fork分支" class="headerlink" title="上传代码到fork分支"></a>上传代码到fork分支</h2><p>执行完上一步的合并操作之后，往后还有一些后续处理，比如代码冲突。如果本地修改了内容，上游仓库也修改了对应的代码，则可能会出现冲突。这时就需要对比代码进行修改。本人更习惯使用IDEA中可视化的插件进行代码冲突解决，你也可以选择你喜欢的方式进行解决。</p><p>解决完冲突之后，就可以执行正常的代码add、commit和push操作了。这里的一系列操作都是针对自己fork的仓库的，对应操作实例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">appledeMacBook-Pro-2:nacos apple$ git add .</span><br><span class="line">appledeMacBook-Pro-2:nacos apple$ git commit -m &apos;merge from nacos&apos;</span><br><span class="line">[develop 8601c1791] merge from nacos </span><br><span class="line">appledeMacBook-Pro-2:nacos apple$ git push</span><br><span class="line">Enumerating objects: 4, done.</span><br><span class="line">Counting objects: 100% (4/4), done.</span><br><span class="line">Delta compression using up to 12 threads</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (2/2), 281 bytes | 281.00 KiB/s, done.</span><br><span class="line">Total 2 (delta 1), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (1/1), completed with 1 local object.</span><br><span class="line">To https://github.com/secbr/nacos.git</span><br><span class="line">   76a4dcbb1..8601c1791  develop -&gt; develop</span><br></pre></td></tr></table></figure></p><p>上述操作，通过add、commit、push一系列操作，将源仓库中的修改内容，提交到自己fork的分支当中了。此时再查看自己fork的GitHub仓库，发现代码已经更新。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本篇文章介绍了当我们fork一个仓库代码之后，如何将上游仓库最新的代码与自己仓库进行同步更新。如果你喜欢fork一些优秀的代码，需要在GitHub上为开源项目做贡献，那么这个基本的操作必须得了解一下。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript设计模式与开发实践</title>
      <link href="/2022/04/12/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/"/>
      <url>/2022/04/12/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<p>JavaScript设计模式与开发实践<br><a id="more"></a></p><h1 id="JavaScript设计模式与开发实践"><a href="#JavaScript设计模式与开发实践" class="headerlink" title="JavaScript设计模式与开发实践"></a>JavaScript设计模式与开发实践</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="面向对象的JavaScript"><a href="#面向对象的JavaScript" class="headerlink" title="面向对象的JavaScript"></a>面向对象的JavaScript</h3><p>::: tip<br>编程语言按照数据类型大体分为两大类：一类是<strong>静态类型语言</strong>，一类是<strong>动态类型语言</strong><br>:::</p><h4 id="静态类型语言的优缺点"><a href="#静态类型语言的优缺点" class="headerlink" title="静态类型语言的优缺点"></a>静态类型语言的优缺点</h4><p><strong>优点</strong>：</p><ul><li>能够在编译时就能发现类型不匹配的错误</li><li>能够根据数据的不同类型进行针对的优化，提高程序的执行速度</li></ul><p><strong>缺点</strong>:</p><ul><li>强迫程序员必须使用强契约来编写程序，为每一个变量规定数据类型</li><li>类型的声明会增加更多的代码，这些细节容易让程序员的精力从思考业务逻辑上分散开</li></ul><h4 id="动态类型语言的优缺点"><a href="#动态类型语言的优缺点" class="headerlink" title="动态类型语言的优缺点"></a>动态类型语言的优缺点</h4><p><strong>优点</strong>：</p><ul><li>编写的代码数量更少，看起来也更简洁，程序员可以把精力更多的放在业务逻辑上面</li></ul><p><strong>缺点</strong>:</p><ul><li>无法保证变量的类型，从而在程序运行期有可能发生跟类型相关的错误</li></ul><h4 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h4><p>::: tip<br>如果它走起路来像鸭子，叫起来也像鸭子，那么它就是鸭子，鸭子类型指导我们只关注对象的行为，而不关注对象本身<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 鸭子类型</span></span><br><span class="line"><span class="keyword">var</span> duck = &#123;</span><br><span class="line">  duckSinging: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'嘎嘎嘎'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> chicken = &#123;</span><br><span class="line">  duckSinging: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'嘎嘎嘎'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 合唱团</span></span><br><span class="line"><span class="keyword">var</span> choir = [];</span><br><span class="line"><span class="keyword">var</span> joinChoir = <span class="function"><span class="keyword">function</span>(<span class="params">animal</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(animal &amp;&amp; <span class="keyword">typeof</span> animal.duckSinging === <span class="string">'function'</span>) &#123;</span><br><span class="line">    choir.push(animal);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'恭喜加入合唱团'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">joinChoir(duck);    <span class="comment">// 恭喜加入合唱团</span></span><br><span class="line">joinChoir(chicken); <span class="comment">// 恭喜加入合唱团</span></span><br></pre></td></tr></table></figure></p><h4 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h4><p>::: tip<br>多态的含义是：同一操作作用于不同的对象，可以产生不同的解释和不同的执行结果<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多态</span></span><br><span class="line"><span class="keyword">var</span> makeSound = <span class="function"><span class="keyword">function</span>(<span class="params">animal</span>) </span>&#123;</span><br><span class="line">  animal.sound();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Duck = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">Duck.prototype.sound =<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'嘎嘎嘎'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Chicken = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">Chicken.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'咯咯咯'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">makeSound(<span class="keyword">new</span> Duck());    <span class="comment">// 嘎嘎嘎</span></span><br><span class="line">makeSound(<span class="keyword">new</span> Chicken()); <span class="comment">// 咯咯咯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Dog.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'汪汪汪'</span>);</span><br><span class="line">&#125;</span><br><span class="line">makeSound(<span class="keyword">new</span> Dog());     <span class="comment">// 汪汪汪</span></span><br></pre></td></tr></table></figure></p><h3 id="this，call和apply"><a href="#this，call和apply" class="headerlink" title="this，call和apply"></a>this，call和apply</h3><p>::: tip<br>JavaScript中this始终指向一个对象，而具体指向哪个对象，是根据程序运行时的环境所决定的，不是在被声明时决定的<br>:::</p><p><strong>this指向的四种情况</strong></p><ol><li>作为对象的方法调用</li><li>作为普通函数调用</li><li>构造器调用</li><li>Function.prototype.call 或 Function.prototype.apply调用</li></ol><p><strong>第一种：作为对象方法调用</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种：作为对象方法调用</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  getA: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.getA(); <span class="comment">// 输出1</span></span><br></pre></td></tr></table></figure></p><p><strong>第二种：作为普通函数调用</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第二种：作为普通函数调用</span></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'global-name'</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'obj'</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newGetName = obj.getName;</span><br><span class="line"><span class="built_in">console</span>.log(newGetName());  <span class="comment">// 输出global-name</span></span><br></pre></td></tr></table></figure></p><p><strong>第三种：作为构造器调用</strong><br>::: tip<br>new进行构造器调用时的步骤:<br></p><ol><li>新创建一个对象</li><li>新对象进行原型委托</li><li>this绑定到这个新对象</li><li>如果构造器不返回其他对象，那么默认返回这个新对象<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第三种：作为构造器调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'why'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> Student();</span><br><span class="line"><span class="built_in">console</span>.log(stu.name);      <span class="comment">// 输出why</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Teacher</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'www'</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'AAA'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line"><span class="built_in">console</span>.log(teacher.name);  <span class="comment">// 输出AAA，而不是wwww</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>第四中：call和apply调用</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第四中：call和apply调用</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">'why'</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  name: <span class="string">'AAA'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj1.getName.call(obj2)); <span class="comment">// 输出AAA</span></span><br></pre></td></tr></table></figure></p><h4 id="call和apply详解"><a href="#call和apply详解" class="headerlink" title="call和apply详解"></a>call和apply详解</h4><p>::: tip 区别</p><ol><li>apply只接受两个参数，其中第二个参数是一个类数组或者数组</li><li>call可以接受多个参数，即参数不固定<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// call和apply的区别</span></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">a,b,c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log([a,b,c]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当使用call和apply时，如果第一个参数传递的是null,则此时this指向全局对象</span></span><br><span class="line">func.apply(<span class="literal">null</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);   <span class="comment">// 输出[1,2,3]</span></span><br><span class="line">func.call(<span class="literal">null</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);      <span class="comment">// 输出[1,2,3]</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="call和apply的用途"><a href="#call和apply的用途" class="headerlink" title="call和apply的用途"></a>call和apply的用途</h5><p>::: tip</p><ol><li>改变this指向</li><li>Function.prototype.bind绑定</li><li>借用其他对象的方法<br>:::</li></ol><p><strong>改变this指向</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// call和apply的用途：改变this指向</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">'why'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  name: <span class="string">'www'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'global-name'</span></span><br><span class="line"><span class="keyword">var</span> getName =<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getName());           <span class="comment">// 输出global-name</span></span><br><span class="line"><span class="built_in">console</span>.log(getName.call(obj1));  <span class="comment">// 输出why</span></span><br><span class="line"><span class="built_in">console</span>.log(getName.apply(obj2)); <span class="comment">// 输出www</span></span><br></pre></td></tr></table></figure></p><p><strong>Function.prototype.bind绑定</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// call和apply的用途：Function.prototype.bind绑定</span></span><br><span class="line"><span class="comment">// 基础bind实现</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> self.apply(context,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'why'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;.bind(obj);</span><br><span class="line">func(); <span class="comment">// 输出why</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 完善版bind</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> context = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>); <span class="comment">// 读取第一个参数，即this对象</span></span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);    <span class="comment">// 获取参数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newArgs = <span class="built_in">Array</span>.prototype.concat.call(args,<span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>));</span><br><span class="line">    <span class="keyword">return</span> self.apply(context,newArgs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">'why'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">a,b,c,d</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  <span class="built_in">console</span>.log([a,b,c,d]);</span><br><span class="line">&#125;.bind(obj1,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">func(<span class="number">3</span>,<span class="number">4</span>);    <span class="comment">// 输出why  [1,2,3,4]</span></span><br></pre></td></tr></table></figure></p><p><strong>借用其他对象的方法</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// call和apply的用途：借用其他对象的方法</span></span><br><span class="line"><span class="keyword">var</span> Foo = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Foo.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">Bar.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> Bar(<span class="string">'why'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bar.getName()); <span class="comment">// 输出why</span></span><br></pre></td></tr></table></figure></p><h3 id="闭包和高阶函数"><a href="#闭包和高阶函数" class="headerlink" title="闭包和高阶函数"></a>闭包和高阶函数</h3><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>::: tip</p><ol><li>全局变量的生存周期是永久的</li><li>局部变量在退出函数时，局部变量会被销毁</li><li>闭包能够延长局部变量的生存周期<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变量的生存周期</span></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'why'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sex = <span class="string">'男'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(sex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> age = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> _bar = bar();</span><br><span class="line"><span class="built_in">console</span>.log(name);    <span class="comment">// 输出why</span></span><br><span class="line"><span class="built_in">console</span>.log(sex);     <span class="comment">// 报错</span></span><br><span class="line"><span class="built_in">console</span>.log(_bar());  <span class="comment">// 输出11</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="闭包的作用"><a href="#闭包的作用" class="headerlink" title="闭包的作用"></a>闭包的作用</h4><p>::: tip</p><ol><li>封装变量</li><li>延续局部变量的寿命<br>:::<br><strong>封装变量</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包的作用：封装变量</span></span><br><span class="line"><span class="comment">// 实例：计算乘积</span></span><br><span class="line"><span class="keyword">var</span> mult = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 小函数提取出来</span></span><br><span class="line">  <span class="keyword">var</span> calculate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,len=<span class="built_in">arguments</span>.length;i&lt;len;i++) &#123;</span><br><span class="line">      a = a * <span class="built_in">arguments</span>[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 闭包计算</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>,<span class="string">','</span>);</span><br><span class="line">    <span class="keyword">if</span>(cache[args]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[args]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = calculate.apply([],<span class="built_in">arguments</span>);</span><br><span class="line">    cache[args] = result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)); <span class="comment">// 输出24</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>延续局部变量的寿命</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包的作用：延续局部变量的寿命</span></span><br><span class="line"><span class="comment">// 实例：利用img进行数据上报</span></span><br><span class="line"><span class="keyword">var</span> report = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> imgs = [];</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    imgs.push(img);</span><br><span class="line">    img.src = src;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p><h4 id="闭包和面向对象设计"><a href="#闭包和面向对象设计" class="headerlink" title="闭包和面向对象设计"></a>闭包和面向对象设计</h4><p>::: tip<br>用面向对象思想能实现的功能，用闭包也能实现，反之亦然。<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包和面向对象设计</span></span><br><span class="line"><span class="keyword">var</span> extent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    call: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      value++;</span><br><span class="line">      <span class="built_in">console</span>.log(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = extent();</span><br><span class="line">foo.call();     <span class="comment">// 输出1</span></span><br><span class="line">foo.call();     <span class="comment">// 输出2</span></span><br><span class="line">foo.call();     <span class="comment">// 输出3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> extent = &#123;</span><br><span class="line">  value: <span class="number">0</span>,</span><br><span class="line">  call: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value++;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">extent.call();  <span class="comment">// 输出1</span></span><br><span class="line">extent.call();  <span class="comment">// 输出2</span></span><br><span class="line">extent.call();  <span class="comment">// 输出3</span></span><br></pre></td></tr></table></figure></p><h4 id="面向对象和闭包实现命令模式"><a href="#面向对象和闭包实现命令模式" class="headerlink" title="面向对象和闭包实现命令模式"></a>面向对象和闭包实现命令模式</h4><p><strong>面向对象实现命令模式</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 面向对象实现命令模式</span></span><br><span class="line"><span class="keyword">var</span> TV = &#123;</span><br><span class="line">  open: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开电视'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  close: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'关闭电视'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> TVCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver = receiver</span><br><span class="line">&#125;</span><br><span class="line">TVCommand.prototype.open = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver.open();</span><br><span class="line">&#125;</span><br><span class="line">TVCommand.prototype.close = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> setCommand = <span class="function"><span class="keyword">function</span>(<span class="params">command</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    open: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      command.open();</span><br><span class="line">    &#125;,</span><br><span class="line">    close: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      command.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = setCommand(<span class="keyword">new</span> TVCommand(TV));</span><br><span class="line">obj.open();   <span class="comment">// 输出打开电视</span></span><br><span class="line">obj.close();  <span class="comment">// 输出关闭电视</span></span><br></pre></td></tr></table></figure></p><p><strong>闭包实现命令模式</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包实现命令模式</span></span><br><span class="line"><span class="keyword">var</span> TV = &#123;</span><br><span class="line">  open: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开电视'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  close: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'关闭电视'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> createCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> open = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    receiver.open();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> close = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    receiver.close();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    open: open,</span><br><span class="line">    close: close</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> setCommand = <span class="function"><span class="keyword">function</span>(<span class="params">command</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    open: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      command.open();</span><br><span class="line">    &#125;,</span><br><span class="line">    close: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      command.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj =  setCommand(createCommand(TV));</span><br><span class="line">obj.open();   <span class="comment">// 输出打开电视</span></span><br><span class="line">obj.close();  <span class="comment">// 输出关闭电视</span></span><br></pre></td></tr></table></figure></p><h4 id="闭包在内存泄露上的争议"><a href="#闭包在内存泄露上的争议" class="headerlink" title="闭包在内存泄露上的争议"></a>闭包在内存泄露上的争议</h4><ol><li><p>局部函数应该在函数退出时就销毁，而闭包却延续了局部变量的生存周期<br><br><strong>解答</strong>：闭包之所以会延长局部变量的生存周期，是因为该局部变量会在以后使用到，而需要使用到的变量，你把它存放在全局或者闭包里，对内存方面的影响是一致的。</p></li><li><p>使用闭包容易形成循环引用，如果闭包的作用域链中保存着一些DOM节点，这可能会造成内存泄露<br><br><strong>解答</strong>：在IE浏览器中，垃圾回收机制是基于COM对象的引用计数策略，而基于此的垃圾回收机制无法在两个循环引用的对象之间进行回收，实质是并不是闭包的问题造成的。</p></li></ol><h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><p>::: tip 条件</p><ol><li>函数可以作为参数被传递</li><li>函数可以作为返回值输出<br>:::<br>JavaScript语言中的函数显然满足高阶函数的条件，在实际开发中，无论是将函数作为参数传递还是让函数的执行结果返回另一个函数，这两种情形都有很多的应用场景。</li></ol><p><strong>函数作为参数传递</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数的应用场景：函数作为参数传递</span></span><br><span class="line"><span class="comment">// 应用场景：创建100个div，并将这些div节点设置隐藏</span></span><br><span class="line"><span class="keyword">var</span> appendDiv = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    div.innerHTML = i;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> callback === <span class="string">'function'</span>) &#123;</span><br><span class="line">      callback(div);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 回调函数</span></span><br><span class="line"><span class="keyword">var</span> hideDiv = <span class="function"><span class="keyword">function</span>(<span class="params">div</span>) </span>&#123;</span><br><span class="line">  div.style.display = <span class="string">'none'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">appendDiv(hideDiv);</span><br></pre></td></tr></table></figure></p><p><strong>函数作为返回值输出</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数的应用场景：函数作为返回值输出</span></span><br><span class="line"><span class="comment">// 应用场景：注册isType方法</span></span><br><span class="line"><span class="keyword">var</span> isType = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object '</span>+ type+<span class="string">']'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> isNumber = isType(<span class="string">'Number'</span>);</span><br><span class="line"><span class="keyword">var</span> isString = isType(<span class="string">'String'</span>);</span><br><span class="line"><span class="keyword">var</span> isArray = isType(<span class="string">'Array'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(isNumber(<span class="number">12</span>));      <span class="comment">// 输出true</span></span><br><span class="line"><span class="built_in">console</span>.log(isString(<span class="string">'abc'</span>));   <span class="comment">// 输出true</span></span><br><span class="line"><span class="built_in">console</span>.log(isArray([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]));  <span class="comment">// 输出true</span></span><br></pre></td></tr></table></figure></p><p><strong>实现AOP</strong><br>::: tip<br>AOP(面向切面编程)的主要作用是把一些跟核心业务逻辑模块无关的功能抽离出来，这些跟业务逻辑无关的功能通常包括日志统计，安全控制，异常处理等。把这些功能抽离出来后，再通过动态织入的方式掺入业务逻辑模块中<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数的应用场景：实现AOP</span></span><br><span class="line"><span class="comment">// 应用场景：装饰者模式</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforeFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeFn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> _self.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">afterFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ret = _self.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    afterFn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">func = func.before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;)</span><br><span class="line">func();</span><br></pre></td></tr></table></figure></p><h4 id="高阶函数的其他用法"><a href="#高阶函数的其他用法" class="headerlink" title="高阶函数的其他用法"></a>高阶函数的其他用法</h4><p><strong>柯里化</strong>：又称部分求值，一个柯里化参数首先会接受一些参数，接受这些参数之后，该函数并不会立即求值，而是继续返回另外一个函数，刚才传入的参数在函数形成的闭包中被保存起来，待到合适的时机一起求值。<br></p><p><strong>其他用法：柯里化</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数其他用法：柯里化</span></span><br><span class="line"><span class="comment">// 不完整的柯里化</span></span><br><span class="line"><span class="keyword">var</span> cost = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> costs = [];</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 开始计算</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">arguments</span>.length==<span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;costs.length;i++) &#123;</span><br><span class="line">        total += costs[i];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> total;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">Array</span>.prototype.push.apply(costs,<span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line">cost(<span class="number">100</span>);           <span class="comment">// 未真正计算</span></span><br><span class="line">cost(<span class="number">200</span>);           <span class="comment">// 未真正计算</span></span><br><span class="line">cost(<span class="number">20</span>);            <span class="comment">// 未真正计算</span></span><br><span class="line">cost(<span class="number">10</span>);            <span class="comment">// 未真正计算</span></span><br><span class="line"><span class="built_in">console</span>.log(cost()); <span class="comment">// 真正计算，输出330</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用的柯里化</span></span><br><span class="line"><span class="keyword">var</span> currying = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = [];</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">arguments</span>.length==<span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>,args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">Array</span>.prototype.push.apply(args,<span class="built_in">arguments</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">arguments</span>.callee;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cost = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> money = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>,len = <span class="built_in">arguments</span>.length;i&lt;len;i++) &#123;</span><br><span class="line">      money +=<span class="built_in">arguments</span>[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> money;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">var</span> cost = currying(cost);</span><br><span class="line">cost(<span class="number">100</span>);</span><br><span class="line">cost(<span class="number">200</span>);</span><br><span class="line">cost(<span class="number">20</span>);</span><br><span class="line">cost(<span class="number">10</span>);</span><br><span class="line"><span class="built_in">console</span>.log(cost()); <span class="comment">// 输出330</span></span><br></pre></td></tr></table></figure></p><p><strong>其他用法：函数节流</strong><br><br>将原本一秒执行10次的事件，节流成一秒执行2次或者3次<br>::: tip 函数节流的场景</p><ol><li>window.onresize事件</li><li>mouseover事件</li><li>scroll事件</li><li>其他<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数其他用法：函数节流</span></span><br><span class="line"><span class="comment">// 应用场景：window.onresize事件</span></span><br><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn,interval</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> firstTime = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">var</span> _self = fn;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断是否第一次执行</span></span><br><span class="line">    <span class="keyword">if</span>(firstTime) &#123;</span><br><span class="line">      _self.apply(that,args);</span><br><span class="line">      <span class="keyword">return</span> firstTime = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 判断定时器是否执行完毕</span></span><br><span class="line">    <span class="keyword">if</span>(timer) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">      _self.apply(that,args);</span><br><span class="line">    &#125;,interval || <span class="number">500</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.onresize = throttle(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'window onsize'</span>);</span><br><span class="line">&#125;, <span class="number">500</span>)</span><br></pre></td></tr></table></figure></li></ol><p><strong>其他用法：分时函数</strong><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数其他用法：分时函数</span></span><br><span class="line"><span class="comment">// 应用场景：分批次创建1000个DOM节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 分时函数</span></span><br><span class="line"><span class="comment">// 参数arr：要填充的数据</span></span><br><span class="line"><span class="comment">// 参数fn：要分时的函数</span></span><br><span class="line"><span class="comment">// 参数count：每一次分时的数量</span></span><br><span class="line"><span class="comment">// 参数interval：分时的间隔</span></span><br><span class="line"><span class="keyword">var</span> timeChunk = <span class="function"><span class="keyword">function</span>(<span class="params">arr,fn,count,interval</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="built_in">Math</span>.min(count || <span class="number">1</span> , arr.length) ; i++) &#123;</span><br><span class="line">      data = arr.shift();</span><br><span class="line">      fn(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(arr.length == <span class="number">0</span>) &#123;</span><br><span class="line">        clearInterval(timer);</span><br><span class="line">        timer = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      start();</span><br><span class="line">    &#125;, interval || <span class="number">200</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">1000</span> ; i++) &#123;</span><br><span class="line">  arr.push(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> renderDOMList = timeChunk(arr, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = data;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">&#125;,<span class="number">8</span>,<span class="number">200</span>);</span><br><span class="line">renderDOMList();</span><br></pre></td></tr></table></figure></p><h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><p>第二部分设计模式并没有全部覆盖GoF所提出的23种设计模式，而是选择了在JavaScript开发中更常见的14种设计模式</p><h3 id="单例设计模式"><a href="#单例设计模式" class="headerlink" title="单例设计模式"></a>单例设计模式</h3><p>::: tip 定义<br>单例模式：保证一个类仅有一个实例，并提供一个访问它的全局访问点。<br>:::</p><h4 id="单例设计模式的案例"><a href="#单例设计模式的案例" class="headerlink" title="单例设计模式的案例"></a>单例设计模式的案例</h4><ol><li>线程池</li><li>全局缓存</li><li>浏览器中的window对象</li><li>网页登录浮窗</li><li>等等</li></ol><h4 id="单例设计模式的实现：面向对象"><a href="#单例设计模式的实现：面向对象" class="headerlink" title="单例设计模式的实现：面向对象"></a>单例设计模式的实现：面向对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例设计模式的实现：面向对象</span></span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.instance = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Singleton.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line">Singleton.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">this</span>.instance) &#123;</span><br><span class="line">    <span class="keyword">this</span>.instance = <span class="keyword">new</span> Singleton(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = Singleton.getInstance(<span class="string">'why'</span>);</span><br><span class="line"><span class="keyword">var</span> instance2 = Singleton.getInstance(<span class="string">'www'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance1===instance2); <span class="comment">// 输出true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> Singleton(<span class="string">'why'</span>);</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="keyword">new</span> Singleton(<span class="string">'www'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj1.getName());        <span class="comment">// 输出why</span></span><br><span class="line"><span class="built_in">console</span>.log(obj2.getName());        <span class="comment">// 输出www</span></span><br></pre></td></tr></table></figure><h4 id="单例设计模式的实现：闭包"><a href="#单例设计模式的实现：闭包" class="headerlink" title="单例设计模式的实现：闭包"></a>单例设计模式的实现：闭包</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例设计模式的实现：闭包</span></span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">Singleton.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line">Singleton.getInstance = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!instance) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> Singleton(name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = Singleton.getInstance(<span class="string">'why'</span>);</span><br><span class="line"><span class="keyword">var</span> instance2 = Singleton.getInstance(<span class="string">'www'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance1 === instance2); <span class="comment">// 输出true</span></span><br></pre></td></tr></table></figure><h4 id="透明的单例设计模式"><a href="#透明的单例设计模式" class="headerlink" title="透明的单例设计模式"></a>透明的单例设计模式</h4><p>无论以上面向对象的单例实现还是闭包的单例实现，都通过<code>Singleton.getInstance</code>来获取<code>Singleton</code>类的唯一对象，这增加了这个类的不透明性，使用者必须知道<code>Singleton</code>是一个单例类，然后通过<code>Singleton.getInstance</code>方法才能获取单例对象，要解决这一问题，可以使用透明的单例设计模式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 透明的单例模式</span></span><br><span class="line"><span class="keyword">var</span> CreateDiv = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(instance) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.html = html;</span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">    instance = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    div.innerHTML = <span class="keyword">this</span>.html;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> CreateDiv;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> CreateDiv(<span class="string">'why'</span>);</span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> CreateDiv(<span class="string">'www'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance1===instance2); <span class="comment">// 输出true</span></span><br></pre></td></tr></table></figure></p><h4 id="用代理实现单例模式"><a href="#用代理实现单例模式" class="headerlink" title="用代理实现单例模式"></a>用代理实现单例模式</h4><p>虽然上述透明的单例设计模式解决了不用通过<code>Singleton.getInstance</code>来获取单例类的唯一对象，但是在透明的单例设计模式中，构造函数<code>CreateDiv</code>违反了单一职责，它不仅要负责创建对象，而且还要负责保证单例，假如某一天需求变化了，不再需要创建单例的<code>div</code>，则需要改写<code>CreateDiv</code>函数，解决这种问题，可以使用代理来实现单例模式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用代理实现单例模式</span></span><br><span class="line"><span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.html = html;</span><br><span class="line">  <span class="keyword">this</span>.init();</span><br><span class="line">&#125;</span><br><span class="line">CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = <span class="keyword">this</span>.html;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ProxyCreateDiv = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 惰性单例</span></span><br><span class="line">    <span class="keyword">if</span>(!instance) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> CreateDiv(html);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">var</span> divInstance1 = <span class="keyword">new</span> ProxyCreateDiv(<span class="string">'why'</span>);</span><br><span class="line"><span class="keyword">var</span> divInstance2 = <span class="keyword">new</span> ProxyCreateDiv(<span class="string">'www'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(divInstance1===divInstance2); <span class="comment">// 输出true</span></span><br></pre></td></tr></table></figure></p><h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p>::: tip 定义<br>策略模式：定义一系列算法，把他们一个一个封装起来，并且使他们可以相互替换。<br>:::</p><h4 id="策略模式的优点"><a href="#策略模式的优点" class="headerlink" title="策略模式的优点"></a>策略模式的优点</h4><ol><li>策略模式利用组合、委托和多态等技术的思想，可以有效的避免多重条件分支语句</li><li>策略模式提供了对开放-封闭原则的完美支持，将算法封装在独立的策略类中，使它们易于切换、易于理解、易于扩展。</li><li>策略模式中的算法也可以复用在系统的其他地方</li><li>策略模式利用组合和委托来让<code>Context</code>拥有执行算法的能力，这也是继承的一种更轻便的替代方案。</li></ol><h4 id="策略模式案例：计算奖金"><a href="#策略模式案例：计算奖金" class="headerlink" title="策略模式案例：计算奖金"></a>策略模式案例：计算奖金</h4><p>案例描述：某公司的年终奖是根据员工的工资基数和年底绩效来发放的。例如，绩效为S的人年终奖有4倍工资，绩效为A的人年终奖有3倍工资，绩效为B的人年终奖有2倍工资，财务部要求我们提供一段代码，来方便他们计算员工的年终奖。</p><h5 id="计算奖金：最初版本"><a href="#计算奖金：最初版本" class="headerlink" title="计算奖金：最初版本"></a>计算奖金：最初版本</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算奖金：最初版本</span></span><br><span class="line"><span class="keyword">var</span> calculateBouns = <span class="function"><span class="keyword">function</span>(<span class="params">level,salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(level==<span class="string">'S'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(level==<span class="string">'A'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(level==<span class="string">'B'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(calculateBouns(<span class="string">'S'</span>,<span class="number">4000</span>));  <span class="comment">// 输出16000</span></span><br><span class="line"><span class="built_in">console</span>.log(calculateBouns(<span class="string">'A'</span>,<span class="number">3000</span>));  <span class="comment">// 输出9000</span></span><br><span class="line"><span class="built_in">console</span>.log(calculateBouns(<span class="string">'B'</span>,<span class="number">2000</span>));  <span class="comment">// 输出4000</span></span><br></pre></td></tr></table></figure><h5 id="计算奖金：面向对象完善版本"><a href="#计算奖金：面向对象完善版本" class="headerlink" title="计算奖金：面向对象完善版本"></a>计算奖金：面向对象完善版本</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算奖金：面向对象完善版本</span></span><br><span class="line"><span class="keyword">var</span> PerformanceS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">PerformanceS.prototype.calculate = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary * <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PerformanceA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">PerformanceA.prototype.calculate = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary * <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PerformanceB = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">PerformanceB.prototype.calculate = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Bouns = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.salary = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.strategy = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Bouns.prototype.setSalary = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line">Bouns.prototype.setStrategy = <span class="function"><span class="keyword">function</span>(<span class="params">strategy</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">&#125;</span><br><span class="line">Bouns.prototype.getBouns = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.strategy.calculate(<span class="keyword">this</span>.salary);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bouns = <span class="keyword">new</span> Bouns();</span><br><span class="line">bouns.setSalary(<span class="number">4000</span>);</span><br><span class="line">bouns.setStrategy(<span class="keyword">new</span> PerformanceS());</span><br><span class="line"><span class="built_in">console</span>.log(bouns.getBouns());  <span class="comment">// 输出16000</span></span><br><span class="line"></span><br><span class="line">bouns.setSalary(<span class="number">3000</span>);</span><br><span class="line">bouns.setStrategy(<span class="keyword">new</span> PerformanceA());</span><br><span class="line"><span class="built_in">console</span>.log(bouns.getBouns());  <span class="comment">// 输出9000</span></span><br><span class="line"></span><br><span class="line">bouns.setSalary(<span class="number">2000</span>);</span><br><span class="line">bouns.setStrategy(<span class="keyword">new</span> PerformanceB());</span><br><span class="line"><span class="built_in">console</span>.log(bouns.getBouns());  <span class="comment">// 输出4000</span></span><br></pre></td></tr></table></figure><h5 id="计算奖金：JavaScript的完善版本"><a href="#计算奖金：JavaScript的完善版本" class="headerlink" title="计算奖金：JavaScript的完善版本"></a>计算奖金：JavaScript的完善版本</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算奖金：JavaScript的完善版本</span></span><br><span class="line"><span class="keyword">var</span> strategy = &#123;</span><br><span class="line">  <span class="string">'S'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">4</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'A'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">3</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'B'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> calcluateBouns = <span class="function"><span class="keyword">function</span>(<span class="params">level,salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> strategy[level](salary);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(calcluateBouns(<span class="string">'S'</span>,<span class="number">4000</span>));  <span class="comment">// 输出16000</span></span><br><span class="line"><span class="built_in">console</span>.log(calcluateBouns(<span class="string">'A'</span>,<span class="number">3000</span>));  <span class="comment">// 输出9000</span></span><br><span class="line"><span class="built_in">console</span>.log(calcluateBouns(<span class="string">'B'</span>,<span class="number">2000</span>));  <span class="comment">// 输出4000</span></span><br></pre></td></tr></table></figure><h4 id="策略模式案例：表单验证"><a href="#策略模式案例：表单验证" class="headerlink" title="策略模式案例：表单验证"></a>策略模式案例：表单验证</h4><p>::: tip 表单标签</p><ol><li>用户名(验证是否为空)</li><li>密码(验证长度不能小于6位)</li><li>手机号(验证是否是手机号格式)<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略模式案例：表单验证</span></span><br><span class="line"><span class="keyword">var</span> strategies = &#123;</span><br><span class="line">  isEmpty: <span class="function"><span class="keyword">function</span>(<span class="params">value,errMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value===<span class="string">''</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> errMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  minLength: <span class="function"><span class="keyword">function</span>(<span class="params">value,length,errMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value.length&lt;length) &#123;</span><br><span class="line">      <span class="keyword">return</span> errMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  isMobile: <span class="function"><span class="keyword">function</span>(<span class="params">value,errMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="regexp">/^1[34578]\d&#123;9&#125;$/</span>.test(value))) &#123;</span><br><span class="line">      <span class="keyword">return</span> errMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cache = [];</span><br><span class="line">&#125;</span><br><span class="line">Validator.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">dom,rule,msg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ary = rule.split(<span class="string">':'</span>);</span><br><span class="line">  <span class="keyword">this</span>.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> strategy = ary.shift();</span><br><span class="line">    ary.unshift(dom.value);</span><br><span class="line">    ary.push(msg);</span><br><span class="line">    <span class="keyword">return</span> strategies[strategy].apply(dom,ary);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">Validator.prototype.run = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.cache.length; index++) &#123;</span><br><span class="line">    <span class="keyword">var</span> msg = <span class="keyword">this</span>.cache[index]();</span><br><span class="line">    <span class="keyword">if</span>(msg) &#123;</span><br><span class="line">      <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validateFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> validator = <span class="keyword">new</span> Validator();</span><br><span class="line">  validator.add(registerForm.username,<span class="string">'isEmpty'</span>,<span class="string">'用户名不能为空'</span>);</span><br><span class="line">  validator.add(registerForm.password,<span class="string">'minLength:6'</span>,<span class="string">'密码长度不能小于6位'</span>);</span><br><span class="line">  validator.add(registerForm.phone,<span class="string">'isMobile'</span>,<span class="string">'手机号格式不正确'</span>);</span><br><span class="line">  <span class="keyword">var</span> errMsg = validator.run();</span><br><span class="line">  <span class="keyword">return</span> errMsg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> submitBtn = <span class="built_in">document</span>.getElementById(<span class="string">'submitBtn'</span>);</span><br><span class="line"><span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>);</span><br><span class="line">submitBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> errMsg = validateFunc();</span><br><span class="line">  <span class="keyword">if</span>(errMsg) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(errMsg);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'表单验证成功'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>::: tip 定义<br>代理模式是为一个对象提供一个代用品或占位符，以便控制对它的访问。<br>:::<br>代理模式的<strong>关键</strong>所在就是：当客户不方便直接访问一个对象或者不满足需要的时候，提供一个替身对象来控制对这个对象的访问，客户实际上访问的是替身对象，替身对象作出一些请求后再把请求转接给本体对象</p><h4 id="简单的代理：小明追女神"><a href="#简单的代理：小明追女神" class="headerlink" title="简单的代理：小明追女神"></a>简单的代理：小明追女神</h4><p>::: tip 场景<br>小明打算向女神表白，又怕直接被拒绝而尴尬，决定找女神的同学帮忙转接鲜花给女神<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Flower = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">  sendFlower: <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flower = <span class="keyword">new</span> Flower();</span><br><span class="line">    target.receive(flower);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> classmate = &#123;</span><br><span class="line">  receive: <span class="function"><span class="keyword">function</span>(<span class="params">flower</span>) </span>&#123;</span><br><span class="line">    girl.receive(flower);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> girl = &#123;</span><br><span class="line">  receive: <span class="function"><span class="keyword">function</span>(<span class="params">flower</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'女神收到了花'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">xiaoming.sendFlower(classmate); <span class="comment">// 输出女神收到了花</span></span><br></pre></td></tr></table></figure></p><h4 id="保护代理"><a href="#保护代理" class="headerlink" title="保护代理"></a>保护代理</h4><p>::: tip<br>在代理模式中，替身对象能做到过滤一些对本体不合理的请求时，这种代理就叫保护代理<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保护代理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Flower</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sendFlower = <span class="function"><span class="keyword">function</span>(<span class="params">target,person</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> flower = <span class="keyword">new</span> Flower();</span><br><span class="line">  target.receive(flower,person);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">'www'</span>,<span class="number">20</span>,<span class="number">4000</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">'AAA'</span>,<span class="number">25</span>,<span class="number">8000</span>);</span><br><span class="line"><span class="keyword">var</span> person3 = <span class="keyword">new</span> Person(<span class="string">'BBB'</span>,<span class="number">45</span>,<span class="number">16000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proxyObj = &#123;</span><br><span class="line">  receive: <span class="function"><span class="keyword">function</span>(<span class="params">flower,person</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(person.age&gt;=<span class="number">40</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(person.name+<span class="string">',你年龄太大了'</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(person.salary&lt;<span class="number">5000</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(person.name+<span class="string">',你工资太低了'</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    originObj.receive(flower);</span><br><span class="line">    <span class="built_in">console</span>.log(person.name+<span class="string">',恭喜你,女神收下了你的花'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> originObj = &#123;</span><br><span class="line">  receive: <span class="function"><span class="keyword">function</span>(<span class="params">flower</span>) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">person1.sendFlower(proxyObj,person1); <span class="comment">// 输出www,你工资太低了</span></span><br><span class="line">person2.sendFlower(proxyObj,person2); <span class="comment">// 输出AAA,恭喜你,女神收下了你的花</span></span><br><span class="line">person3.sendFlower(proxyObj,person3); <span class="comment">// 输出BBB,你年龄太大了</span></span><br></pre></td></tr></table></figure></p><h4 id="虚拟代理"><a href="#虚拟代理" class="headerlink" title="虚拟代理"></a>虚拟代理</h4><p>::: tip<br>将一些代价昂贵的操作放置在代理对象中，待到机会合适时再进行，这种代理就叫虚拟代理<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 虚拟代理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Flower</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">  sendFlower: <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    target.receiveFlower();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> classmate = &#123;</span><br><span class="line">  receiveFlower: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    girl.listenMood(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> flower = <span class="keyword">new</span> Flower();</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'同学帮你买了花,并送了出去'</span>);</span><br><span class="line">      girl.receiveFlower(flower);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> girl = &#123;</span><br><span class="line">  mood: <span class="number">0</span>,</span><br><span class="line">  receiveFlower: <span class="function"><span class="keyword">function</span>(<span class="params">flower</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'女神收下了你的花'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  listenMood: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      fn();</span><br><span class="line">    &#125;,<span class="number">1500</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 首先输出：同学帮你买了花,并送了出去、</span></span><br><span class="line"><span class="comment">// 最后输出：女神收下了你的花</span></span><br><span class="line">xiaoming.sendFlower(classmate);</span><br></pre></td></tr></table></figure></p><h4 id="代理模式实现图片懒加载"><a href="#代理模式实现图片懒加载" class="headerlink" title="代理模式实现图片懒加载"></a>代理模式实现图片懒加载</h4><p><strong>不用代理实现</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不用代理实现图片懒加载</span></span><br><span class="line"><span class="keyword">var</span> myImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> imgNode = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(imgNode);</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    imgNode.src = img.src;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      imgNode.src = <span class="string">'file:///C:/Users/admin/Desktop/mask/img/7.jpg'</span></span><br><span class="line">      img.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line">myImage.setSrc(<span class="string">'https://img1.sycdn.imooc.com/5c09123400014ba418720632.jpg'</span>)</span><br></pre></td></tr></table></figure></p><p><strong>用代理实现图片懒加载</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用代理实现图片懒加载</span></span><br><span class="line"><span class="keyword">var</span> myImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> image = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(image);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      image.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proxyImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    myImage.setSrc(<span class="keyword">this</span>.src);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      myImage.setSrc(<span class="string">'file:///C:/Users/admin/Desktop/mask/img/7.jpg'</span>);</span><br><span class="line">      img.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line">proxyImage.setSrc(<span class="string">'https://img1.sycdn.imooc.com/5c09123400014ba418720632.jpg'</span>);</span><br></pre></td></tr></table></figure></p><h4 id="缓存代理"><a href="#缓存代理" class="headerlink" title="缓存代理"></a>缓存代理</h4><p>::: tip<br>缓存代理可以为一些开销大的运算结果提供暂时的存储，在下次运算时，如果传递进来的参数跟之前一样，则可以直接返回前面存储的运算结果。<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 缓存代理：计算乘积</span></span><br><span class="line"><span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始计算乘积'</span>);</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="built_in">arguments</span>.length;i++) &#123;</span><br><span class="line">    sum = sum * <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> proxyMult = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>,<span class="string">','</span>);</span><br><span class="line">    <span class="keyword">if</span>(cache.hasOwnProperty(args)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[args];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache[args] = mult.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="built_in">console</span>.log(proxyMult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)); <span class="comment">// 输出：开始计算乘积 24</span></span><br><span class="line"><span class="built_in">console</span>.log(proxyMult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)); <span class="comment">// 输出24</span></span><br></pre></td></tr></table></figure></p><h4 id="举一反三代理工厂"><a href="#举一反三代理工厂" class="headerlink" title="举一反三代理工厂"></a>举一反三代理工厂</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代理工厂(累加和乘积)</span></span><br><span class="line"><span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始计算乘积'</span>)</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="built_in">arguments</span>.length; index++) &#123;</span><br><span class="line">    sum = sum * <span class="built_in">arguments</span>[index]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> plus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始计算累加'</span>)</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="built_in">arguments</span>.length; index++) &#123;</span><br><span class="line">    sum = sum + <span class="built_in">arguments</span>[index]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> createProxyFactory = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>,<span class="string">','</span>);</span><br><span class="line">    <span class="keyword">if</span>(cache.hasOwnProperty(args)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[args]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache[args] = fn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> proxyMult = createProxyFactory(mult);</span><br><span class="line"><span class="keyword">var</span> proxyPlus = createProxyFactory(plus);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxyMult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)); <span class="comment">// 输出：开始计算乘积 24</span></span><br><span class="line"><span class="built_in">console</span>.log(proxyMult(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)); <span class="comment">// 输出： 24</span></span><br><span class="line"><span class="built_in">console</span>.log(proxyPlus(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)); <span class="comment">// 输出：开始计算累加 18</span></span><br><span class="line"><span class="built_in">console</span>.log(proxyPlus(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)); <span class="comment">// 输出 18</span></span><br></pre></td></tr></table></figure><h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><p>::: tip<br>迭代器模式是指提供一种顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。迭代器分为两种，一种是内部迭代器，另外一种是外部迭代器<br>:::</p><h4 id="内部迭代器"><a href="#内部迭代器" class="headerlink" title="内部迭代器"></a>内部迭代器</h4><p>::: tip<br>内部迭代器在调用的时候非常方便，外界不用关心迭代器内部到底是如何实现的，跟迭代器的交互也只有一次初始调用，而这也正好是内部迭代器的缺点。<br>:::<br><strong>Jquery中的迭代器</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Jquery中的迭代器</span></span><br><span class="line">$.each([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index);</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><strong>实现自己的each迭代器</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现自己的each迭代器</span></span><br><span class="line"><span class="keyword">var</span> each = <span class="function"><span class="keyword">function</span>(<span class="params">array,callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;array.length;i++) &#123;</span><br><span class="line">    callback.call(<span class="literal">null</span>,i,array[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">each([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index);<span class="comment">// 依次输出0 1 2</span></span><br><span class="line">  <span class="built_in">console</span>.log(value);<span class="comment">// 依次输出1 2 3</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h4 id="外部迭代器"><a href="#外部迭代器" class="headerlink" title="外部迭代器"></a>外部迭代器</h4><p>::: tip<br>外部迭代器必须显示的请求迭代下一个元素<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义外部迭代器实现比较两个数组的值是否完全相等</span></span><br><span class="line"><span class="keyword">var</span> Iterator = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> current = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    current++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> isDone = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> current &gt;=obj.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> getCurrentItem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj[current];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: next,</span><br><span class="line">    isDone: isDone,</span><br><span class="line">    getCurrentItem:getCurrentItem,</span><br><span class="line">    length: obj.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> compare = <span class="function"><span class="keyword">function</span>(<span class="params">iterator1,iterator2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(iterator1.length!=iterator2.length) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'两个数组不相等'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>(!iterator1.isDone() &amp;&amp; !iterator2.isDone()) &#123;</span><br><span class="line">    <span class="keyword">if</span>(iterator1.getCurrentItem()!=iterator2.getCurrentItem()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'两个数组不相等'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    iterator1.next();</span><br><span class="line">    iterator2.next();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'两个数组相等'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> iterator1 = Iterator([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">var</span> iterator2 = Iterator([<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]);</span><br><span class="line">compare(iterator1,iterator2); <span class="comment">// 报错，两个数组不相等</span></span><br></pre></td></tr></table></figure></p><h3 id="发布-订阅模式"><a href="#发布-订阅模式" class="headerlink" title="发布-订阅模式"></a>发布-订阅模式</h3><p>::: tip 定义<br>发布-订阅模式又叫观察者模式，他定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。<br>:::</p><p><strong>优点</strong>：发布-订阅模式一为时间上的解耦，二为对象之间的解耦。它的应用非常广泛，既可以用在异步编程中，也可以帮助我们完成更加松耦合的代码编写。发布-订阅模式还可以用来帮助实现一些其他的设计模式，例如中介者模式。<br><br><strong>缺点</strong>：创建订阅者本身要消耗一定的时间和内存，而当你订阅一个消息后，也许此消息最后都没有发生，但订阅者依然存在于内存中，造成了一种浪费。发布-订阅模式虽然弱化了对象之间的联系，但过度使用的话，对象和对象之间的必要联系也将深埋在背后，会导致程序难以追踪维护和理解。</p><h4 id="DOM事件中的发布-订阅"><a href="#DOM事件中的发布-订阅" class="headerlink" title="DOM事件中的发布-订阅"></a>DOM事件中的发布-订阅</h4><p>只要我们曾经在DOM节点上绑定了事件函数，那我们就曾经使用过发布-订阅模式。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DOM事件中的发布-订阅模式</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.body.click(); <span class="comment">// 输出1 2 3 4</span></span><br></pre></td></tr></table></figure></p><h4 id="自定义发布-订阅"><a href="#自定义发布-订阅" class="headerlink" title="自定义发布-订阅"></a>自定义发布-订阅</h4><p>背景：小明最近看中一套房子，到销售中心才告知已经卖完了，好在销售楼中心准备出后期工程，但不知道什么时候出，只要小明留下自己的联系方式，楼盘开启后销售中心会通知小明相关信息。而对于其他像小明那样的客户，只要同样留下联系方式都可以收到相关信息。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义发布-订阅事件</span></span><br><span class="line"><span class="keyword">var</span> sales = &#123;</span><br><span class="line">  clientList: &#123;&#125;,</span><br><span class="line">  listen: <span class="function"><span class="keyword">function</span>(<span class="params">key,fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">this</span>.clientList[key]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.clientList[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.clientList[key].push(fn)</span><br><span class="line">  &#125;,</span><br><span class="line">  trigger: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[type];</span><br><span class="line">    <span class="keyword">if</span>(!fns || fns.length&lt;<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; fns.length; index++) &#123;</span><br><span class="line">      fns[index].apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line">sales.listen(<span class="string">'88'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">price</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'88平米的房子价格是：'</span>+price);</span><br><span class="line">&#125;)</span><br><span class="line">sales.listen(<span class="string">'100'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">price</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'100平米的房子价格是：'</span>+price);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">sales.trigger(<span class="string">'88'</span>,<span class="number">200000</span>);  <span class="comment">// 88平米的房子价格是：200000</span></span><br><span class="line">sales.trigger(<span class="string">'100'</span>,<span class="number">300000</span>); <span class="comment">// 100平米的房子价格是：300000</span></span><br></pre></td></tr></table></figure></p><h4 id="取消订阅的事件"><a href="#取消订阅的事件" class="headerlink" title="取消订阅的事件"></a>取消订阅的事件</h4><p>发布-订阅模式中，既然可以订阅事件，那么一定可以取消订阅，假设小明突然不想买房子了，为避免销售中心发短信打搅自己，他决定取消订阅。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取消订阅事件</span></span><br><span class="line"><span class="keyword">var</span> sales = &#123;</span><br><span class="line">  clientList: &#123;&#125;,</span><br><span class="line">  listen: <span class="function"><span class="keyword">function</span>(<span class="params">key,fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">this</span>.clientList[key]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.clientList[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.clientList[key].push(fn);</span><br><span class="line">  &#125;,</span><br><span class="line">  trigger: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[type]</span><br><span class="line">    <span class="keyword">if</span>(!fns || fns.length&lt;<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; fns.length; index++) &#123;</span><br><span class="line">      fns[index].apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[type];</span><br><span class="line">    <span class="keyword">if</span>(!fns || fns.length&lt;<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 全部取消订阅</span></span><br><span class="line">    fns.length = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line">sales.listen(<span class="string">'88'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">price</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'88平米的房子价格是：'</span>+price);</span><br><span class="line">&#125;)</span><br><span class="line">sales.listen(<span class="string">'100'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">price</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'100平米的房子价格是：'</span>+price);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消订阅</span></span><br><span class="line">sales.remove(<span class="string">'88'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">sales.trigger(<span class="string">'88'</span>,<span class="number">200000</span>);  <span class="comment">// 不输出</span></span><br><span class="line">sales.trigger(<span class="string">'100'</span>,<span class="number">300000</span>); <span class="comment">// 100平米的房子价格是：300000</span></span><br></pre></td></tr></table></figure></p><h4 id="一个真实的例子：网站登录"><a href="#一个真实的例子：网站登录" class="headerlink" title="一个真实的例子：网站登录"></a>一个真实的例子：网站登录</h4><p>背景：一个商场网站，有头部header，有导航nav，有购物车cart，有消息列表message等等模块度依赖于登录成功后的用户信息。而用户不知道什么时候会登陆。需要将以上各个模块与登录模块做一个发布-订阅<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个真实的发布-订阅例子：网站登录</span></span><br><span class="line"><span class="keyword">var</span> login = &#123;</span><br><span class="line">  clientList: &#123;&#125;,</span><br><span class="line">  listen: <span class="function"><span class="keyword">function</span>(<span class="params">key,fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">this</span>.clientList[key]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.clientList[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.clientList[key].push(fn);</span><br><span class="line">  &#125;,</span><br><span class="line">  trigger: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[type];</span><br><span class="line">    <span class="keyword">if</span>(!fns || fns.length&lt;<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; fns.length; index++) &#123;</span><br><span class="line">      fns[index].apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 头部</span></span><br><span class="line"><span class="keyword">var</span> header = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  login.listen(<span class="string">'loginSuccess'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    header.setAvatar(data.avatar);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setAvatar: <span class="function"><span class="keyword">function</span>(<span class="params">avatar</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'设置header头像：'</span>+avatar);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导航</span></span><br><span class="line"><span class="keyword">var</span> nav = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  login.listen(<span class="string">'loginSuccess'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    nav.setAvatar(data.avatar);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setAvatar: <span class="function"><span class="keyword">function</span>(<span class="params">avatar</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'设置nav头像：'</span>+avatar);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 购物车</span></span><br><span class="line"><span class="keyword">var</span> cart = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  login.listen(<span class="string">'loginSuccess'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    cart.getOrders(data);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getOrders: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'获取'</span>+data.name+<span class="string">'的购物车订单列表'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 依次输出</span></span><br><span class="line">  <span class="comment">// 设置header头像：https://www.baidu.com/1.jpg</span></span><br><span class="line">  <span class="comment">// 设置nav头像：https://www.baidu.com/1.jpg</span></span><br><span class="line">  <span class="comment">// 获取AAA的购物车订单列表</span></span><br><span class="line">  login.trigger(<span class="string">'loginSuccess'</span>,&#123;<span class="attr">name</span>:<span class="string">'AAA'</span>,<span class="attr">avatar</span>: <span class="string">'https://www.baidu.com/1.jpg'</span>&#125;);</span><br><span class="line">&#125;, <span class="number">1500</span>)</span><br></pre></td></tr></table></figure></p><h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p>::: tip 定义<br>命令模式是最简单和优雅的模式之一，命令模式中的命令指的是一个执行某些特定事件的指令。<br>:::</p><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>有时候需要向某些对象发送请求，但是并不知道请求的接受者是谁，也不知道被请求的操作是什么。此时希望有一种松耦合的方式来设计程序，使得请求发送者和接受者能够消除彼此之间的耦合关系。</p><h4 id="命令模式案例：面向对象版"><a href="#命令模式案例：面向对象版" class="headerlink" title="命令模式案例：面向对象版"></a>命令模式案例：面向对象版</h4><p>故事背景：有一个用户界面程序，该用户界面上至少有数十个Button按钮，因为项目比较复杂，所以我们觉得让某个程序员负责Button按钮的绘制，另外一个程序员负责编写点击按钮的具体行为，这些行为都将封装在对象里。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span>刷新界面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span>添加子菜单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button3"</span>&gt;</span>删除子菜单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 面向对象版本</span></span><br><span class="line"><span class="keyword">var</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">'button1'</span>);</span><br><span class="line"><span class="keyword">var</span> button2 = <span class="built_in">document</span>.getElementById(<span class="string">'button2'</span>);</span><br><span class="line"><span class="keyword">var</span> button3 = <span class="built_in">document</span>.getElementById(<span class="string">'button3'</span>);</span><br><span class="line"><span class="comment">// 设置命令</span></span><br><span class="line"><span class="keyword">var</span> setCommand = <span class="function"><span class="keyword">function</span>(<span class="params">button,command</span>) </span>&#123;</span><br><span class="line">  button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    command.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体行为</span></span><br><span class="line"><span class="keyword">var</span> MenuBar = &#123;</span><br><span class="line">  refresh: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'刷新界面'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> SubMenu = &#123;</span><br><span class="line">  add: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'添加子菜单'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'删除子菜单'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封装具体行为到对象中</span></span><br><span class="line"><span class="keyword">var</span> RefreshBarCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">&#125;</span><br><span class="line">RefreshBarCommand.prototype.execute = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver.refresh();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> AddSubMenuCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">&#125;</span><br><span class="line">AddSubMenuCommand.prototype.execute = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver.add();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> RemoveSubMenuCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">&#125;</span><br><span class="line">RemoveSubMenuCommand.prototype.execute = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver.remove();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传入命令接受者</span></span><br><span class="line"><span class="keyword">var</span> refreshBarCommand = <span class="keyword">new</span> RefreshBarCommand(MenuBar);</span><br><span class="line"><span class="keyword">var</span> addSubMenuCommand = <span class="keyword">new</span> AddSubMenuCommand(SubMenu);</span><br><span class="line"><span class="keyword">var</span> removeSubMenuCommand = <span class="keyword">new</span> RemoveSubMenuCommand(SubMenu);</span><br><span class="line">setCommand(button1,refreshBarCommand);    <span class="comment">// 点击按钮输出：刷新界面</span></span><br><span class="line">setCommand(button2,addSubMenuCommand);    <span class="comment">// 点击按钮输出：添加子菜单</span></span><br><span class="line">setCommand(button3,removeSubMenuCommand); <span class="comment">// 点击按钮输出：删除子菜单</span></span><br></pre></td></tr></table></figure><h4 id="命令模式案例：闭包版本"><a href="#命令模式案例：闭包版本" class="headerlink" title="命令模式案例：闭包版本"></a>命令模式案例：闭包版本</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span>刷新界面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span>添加子菜单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button3"</span>&gt;</span>删除子菜单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包版本</span></span><br><span class="line"><span class="keyword">var</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">'button1'</span>);</span><br><span class="line"><span class="keyword">var</span> button2 = <span class="built_in">document</span>.getElementById(<span class="string">'button2'</span>);</span><br><span class="line"><span class="keyword">var</span> button3 = <span class="built_in">document</span>.getElementById(<span class="string">'button3'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置命令</span></span><br><span class="line"><span class="keyword">var</span> setCommand = <span class="function"><span class="keyword">function</span>(<span class="params">button,func</span>) </span>&#123;</span><br><span class="line">  button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    func();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义具体行为</span></span><br><span class="line"><span class="keyword">var</span> MenuBar = &#123;</span><br><span class="line">  refresh: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'刷新界面'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> SubMenu = &#123;</span><br><span class="line">  add: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'添加子菜单'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'删除子菜单'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封装具体行为到对象</span></span><br><span class="line"><span class="keyword">var</span> RefreshBarCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    receiver.refresh();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> AddSubMenuCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    receiver.add();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> RemoveSubMenuCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    receiver.remove();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传入命令接受者</span></span><br><span class="line"><span class="keyword">var</span> refreshBarCommand = RefreshBarCommand(MenuBar);</span><br><span class="line"><span class="keyword">var</span> addSubMenuCommand = AddSubMenuCommand(SubMenu);</span><br><span class="line"><span class="keyword">var</span> removeSubMenuCommand = RemoveSubMenuCommand(SubMenu);</span><br><span class="line">setCommand(button1,refreshBarCommand);    <span class="comment">// 点击按钮输出：刷新界面</span></span><br><span class="line">setCommand(button2,addSubMenuCommand);    <span class="comment">// 点击按钮输出：添加子菜单</span></span><br><span class="line">setCommand(button3,removeSubMenuCommand); <span class="comment">// 点击按钮输出：删除子菜单</span></span><br></pre></td></tr></table></figure><h4 id="更为简单的回调函数版本"><a href="#更为简单的回调函数版本" class="headerlink" title="更为简单的回调函数版本"></a>更为简单的回调函数版本</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span>刷新界面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span>添加子菜单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"button3"</span>&gt;</span>删除子菜单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更为简单的回调函数版本</span></span><br><span class="line"><span class="comment">// 绑定事件</span></span><br><span class="line"><span class="keyword">var</span> bindClick = <span class="function"><span class="keyword">function</span>(<span class="params">button,func</span>) </span>&#123;</span><br><span class="line">  button.onclick = func;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义具体行为</span></span><br><span class="line"><span class="keyword">var</span> MenuBar = &#123;</span><br><span class="line">  refresh: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'刷新界面'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> SubMenu = &#123;</span><br><span class="line">  add: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'添加子菜单'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'删除子菜单'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数</span></span><br><span class="line">bindClick(button1,MenuBar.refresh); <span class="comment">// 点击按钮输出：刷新界面</span></span><br><span class="line">bindClick(button2,SubMenu.add);     <span class="comment">// 点击按钮输出：添加子菜单</span></span><br><span class="line">bindClick(button3,SubMenu.remove);  <span class="comment">// 点击按钮输出：删除子菜单</span></span><br></pre></td></tr></table></figure><h4 id="宏命令"><a href="#宏命令" class="headerlink" title="宏命令"></a>宏命令</h4><p>::: tip 定义<br>宏命令是一组命令的集合，通过执行宏命令的方式，可以一次执行多个命令。<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 宏命令</span></span><br><span class="line"><span class="comment">// 基础命令</span></span><br><span class="line"><span class="keyword">var</span> CloseDoorCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'关门'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> OpenTVCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开电视'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> OpenQQComand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'登QQ'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 宏命令</span></span><br><span class="line"><span class="keyword">var</span> MacroCommand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    commandList: [],</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">command</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.commandList.push(command)</span><br><span class="line">    &#125;,</span><br><span class="line">    execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.commandList.length; index++) &#123;</span><br><span class="line">        <span class="keyword">this</span>.commandList[index].execute();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加命令到宏命令</span></span><br><span class="line"><span class="keyword">var</span> macroCommand = MacroCommand();</span><br><span class="line">macroCommand.add(CloseDoorCommand);</span><br><span class="line">macroCommand.add(OpenTVCommand);</span><br><span class="line">macroCommand.add(OpenQQComand);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行宏命令</span></span><br><span class="line">macroCommand.execute(); <span class="comment">// 依次输出：关门 打开电视 登QQ</span></span><br></pre></td></tr></table></figure></p><h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><p>::: tip<br>组合模式将对象组合成树形结构，以表示”部分-整体”的层次结构。<br>:::</p><h4 id="传递顺序"><a href="#传递顺序" class="headerlink" title="传递顺序"></a>传递顺序</h4><p>对宏命令为例，请求从树最顶端的对象往下传递，如果当前处理请求的对象是叶对象，叶对象自身会对请求做出相应的处理。如果当前处理请求的是组合对象，则遍历该组合对象下的子节点，将请求继续传递给这些子节点。</p><h4 id="更强大的宏命令"><a href="#更强大的宏命令" class="headerlink" title="更强大的宏命令"></a>更强大的宏命令</h4><p>万能遥控器:<br></p><ol><li>打开空调</li><li>打开电视和音响</li><li>关门、打开电脑、登录QQ<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"SuperButton"</span>&gt;</span>万能遥控器<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更强大的宏命令</span></span><br><span class="line"><span class="keyword">var</span> MacroCommand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    commandList: [],</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">command</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.commandList.push(command)</span><br><span class="line">    &#125;,</span><br><span class="line">    execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.commandList.length; index++) &#123;</span><br><span class="line">        <span class="keyword">this</span>.commandList[index].execute();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打开空调</span></span><br><span class="line"><span class="keyword">var</span> openAcCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开空调'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打开电视和音响</span></span><br><span class="line"><span class="keyword">var</span> openTVCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开电视'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> openSoundCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开音响'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> macroCommand1 = MacroCommand();</span><br><span class="line">macroCommand1.add(openTVCommand);</span><br><span class="line">macroCommand1.add(openSoundCommand);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关门、开电脑、登QQ</span></span><br><span class="line"><span class="keyword">var</span> closeCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'关门'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> openPcCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开电脑'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> openQQCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'登录QQ'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> macroCommand2 = MacroCommand();</span><br><span class="line">macroCommand2.add(closeCommand);</span><br><span class="line">macroCommand2.add(openPcCommand);</span><br><span class="line">macroCommand2.add(openQQCommand);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 宏命令</span></span><br><span class="line"><span class="keyword">var</span> macroCommand = MacroCommand();</span><br><span class="line">macroCommand.add(openAcCommand);</span><br><span class="line">macroCommand.add(macroCommand1);</span><br><span class="line">macroCommand.add(macroCommand2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发宏命令</span></span><br><span class="line"><span class="keyword">var</span> setCommand = (<span class="function"><span class="keyword">function</span>(<span class="params">command</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'SuperButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 依次输出：打开空调 打开电视 打开音响 关门 打开电脑 登录QQ</span></span><br><span class="line">    command.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(macroCommand)</span><br></pre></td></tr></table></figure><h4 id="组合模式案例：扫描文件"><a href="#组合模式案例：扫描文件" class="headerlink" title="组合模式案例：扫描文件"></a>组合模式案例：扫描文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组合模式案例：文件扫描</span></span><br><span class="line"><span class="comment">// 文件夹类</span></span><br><span class="line"><span class="keyword">var</span> Folder = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.files = [];</span><br><span class="line">&#125;</span><br><span class="line">Folder.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.files.push(file);</span><br><span class="line">&#125;</span><br><span class="line">Folder.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始扫描文件夹:'</span>+<span class="keyword">this</span>.name);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.files.length; index++) &#123;</span><br><span class="line">    <span class="keyword">this</span>.files[index].scan();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 文件类</span></span><br><span class="line"><span class="keyword">var</span> File = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">File.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'文件下面不能添加文件'</span>);</span><br><span class="line">&#125;</span><br><span class="line">File.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始扫描文件：'</span>+<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> folder = <span class="keyword">new</span> Folder(<span class="string">'学习资料'</span>);</span><br><span class="line"><span class="keyword">var</span> folder1 = <span class="keyword">new</span> Folder(<span class="string">'JavaScript'</span>);</span><br><span class="line"><span class="keyword">var</span> folder2 = <span class="keyword">new</span> Folder(<span class="string">'jQuery'</span>);</span><br><span class="line"><span class="keyword">var</span> folder3 = <span class="keyword">new</span> Folder(<span class="string">'重构与实现'</span>);</span><br><span class="line"><span class="keyword">var</span> folder4 = <span class="keyword">new</span> Folder(<span class="string">'NodeJs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> file1 = <span class="keyword">new</span> File(<span class="string">'JavaScript设计模式'</span>);</span><br><span class="line"><span class="keyword">var</span> file2 = <span class="keyword">new</span> File(<span class="string">'精通jQuery'</span>);</span><br><span class="line"><span class="keyword">var</span> file3 = <span class="keyword">new</span> File(<span class="string">'JavaScript语言精粹'</span>);</span><br><span class="line"><span class="keyword">var</span> file4 = <span class="keyword">new</span> File(<span class="string">'深入浅出的Node.js'</span>);</span><br><span class="line"></span><br><span class="line">folder1.add(file1);</span><br><span class="line">folder2.add(file2);</span><br><span class="line">folder4.add(file4);</span><br><span class="line"></span><br><span class="line">folder.add(folder1);</span><br><span class="line">folder.add(folder2);</span><br><span class="line">folder.add(file3);</span><br><span class="line">folder.add(folder3);</span><br><span class="line">folder.add(folder4);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行扫描</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹:学习资料</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹:JavaScript</span></span><br><span class="line"><span class="comment">// 开始扫描文件：JavaScript设计模式</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹:jQuery</span></span><br><span class="line"><span class="comment">// 开始扫描文件：精通jQuery</span></span><br><span class="line"><span class="comment">// 开始扫描文件：JavaScript语言精粹</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹:重构与实现</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹:NodeJs</span></span><br><span class="line"><span class="comment">// 开始扫描文件：深入浅出的Node.js</span></span><br><span class="line">folder.scan();</span><br></pre></td></tr></table></figure><h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><p>::: tip 定义<br>模板方法是一种只需使用继承就可以实现的非常简单的模式。模板方法由两部分组成，一部分是抽象的父类，另一部分是具体的子类。<br>:::<br>通常而言，在抽象父类中封装了子类的算法框架，包括实现一些公共方法以及封装子类中所有方法的执行顺序。子类通过继承抽象的父类，也继承了整个算法结构。</p><h4 id="模板方法：经典案例"><a href="#模板方法：经典案例" class="headerlink" title="模板方法：经典案例"></a>模板方法：经典案例</h4><p>泡咖啡的步骤：</p><ol><li>把水煮沸</li><li>用沸水泡咖啡</li><li>把咖啡倒进杯子</li><li>加糖和牛奶<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泡咖啡</span></span><br><span class="line"><span class="keyword">var</span> Coffee = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">Coffee.prototype.boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把水煮沸'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Coffee.prototype.brewCoffee = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'冲泡咖啡'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Coffee.prototype.purInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把咖啡倒进杯子里'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Coffee.prototype.addSugarAndMilk = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'加牛奶和糖'</span>)</span><br><span class="line">&#125;</span><br><span class="line">Coffee.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.boilWater();</span><br><span class="line">  <span class="keyword">this</span>.brewCoffee();</span><br><span class="line">  <span class="keyword">this</span>.purInCup();</span><br><span class="line">  <span class="keyword">this</span>.addSugarAndMilk();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line"><span class="comment">// 依次输出： 把水煮沸 冲泡咖啡 把咖啡倒进杯子里 加牛奶和糖</span></span><br><span class="line">coffee.init();</span><br></pre></td></tr></table></figure></li></ol><p>泡茶的步骤:</p><ol><li>把水煮沸</li><li>用沸水浸泡茶叶</li><li>把茶水倒进杯子</li><li>加柠檬<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泡茶</span></span><br><span class="line"><span class="keyword">var</span> Tea = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">Tea.prototype.boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把水煮沸'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Tea.prototype.brewTea = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'用沸水浸泡茶叶'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Tea.prototype.purInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把茶水倒进杯子'</span>)</span><br><span class="line">&#125;</span><br><span class="line">Tea.prototype.addLemon = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'加柠檬'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Tea.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.boilWater();</span><br><span class="line">  <span class="keyword">this</span>.brewTea();</span><br><span class="line">  <span class="keyword">this</span>.purInCup();</span><br><span class="line">  <span class="keyword">this</span>.addLemon();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> tea = <span class="keyword">new</span> Tea();</span><br><span class="line"><span class="comment">// 依次输出： 把水煮沸 用沸水浸泡茶叶 把茶水倒进杯子 加柠檬</span></span><br><span class="line">tea.init();</span><br></pre></td></tr></table></figure></li></ol><h4 id="泡茶经典案例重构"><a href="#泡茶经典案例重构" class="headerlink" title="泡茶经典案例重构"></a>泡茶经典案例重构</h4><p>经过对比分析，泡咖啡和泡茶虽然具体实现的方法是不一样的，但是步骤大致是类似的：</p><ol><li>把水煮沸</li><li>用沸水</li><li>倒进杯子</li><li>加调料</li></ol><p>泡咖啡和泡茶主要的不同点</p><ol><li>原料不同，一个是咖啡，一个是茶，统称为饮料</li><li>泡的方式不同，一个是冲泡，一个是浸泡，统称为泡</li><li>加入的调料不同，一个是牛奶和糖，另一个是柠檬。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象父类提取</span></span><br><span class="line"><span class="keyword">var</span> Beverage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Beverage.prototype.boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把水煮沸'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象方法，由子类去具体实现</span></span><br><span class="line">Beverage.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="comment">// 抽象方法，由子类去具体实现</span></span><br><span class="line">Beverage.prototype.pourInCur = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="comment">// 抽象方法，由子类去具体实现</span></span><br><span class="line">Beverage.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">Beverage.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.boilWater();</span><br><span class="line">  <span class="keyword">this</span>.brew();</span><br><span class="line">  <span class="keyword">this</span>.pourInCur();</span><br><span class="line">  <span class="keyword">this</span>.addCondiments();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建子类以及实例化子类</span></span><br><span class="line"><span class="keyword">var</span> Coffee = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">Coffee.prototype = <span class="keyword">new</span> Beverage();</span><br><span class="line">Coffee.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'用沸水冲泡咖啡'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Coffee.prototype.pourInCur = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把咖啡到进杯子里'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Coffee.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'加糖和牛奶'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Tea = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125; ;</span><br><span class="line">Tea.prototype = <span class="keyword">new</span> Beverage();</span><br><span class="line">Tea.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'用沸水浸泡茶'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Tea.prototype.pourInCur = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'把茶到进杯子里'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Tea.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'加柠檬'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例化子类</span></span><br><span class="line"><span class="keyword">var</span> coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line"><span class="comment">// 依次输出：用沸水冲泡咖啡 把咖啡到进杯子里 加糖和牛奶</span></span><br><span class="line">coffee.init();</span><br><span class="line"><span class="keyword">var</span> tea = <span class="keyword">new</span> Tea();</span><br><span class="line"><span class="comment">// 依次输出：用沸水浸泡茶 把茶到进杯子里  加柠檬</span></span><br><span class="line">tea.init();</span><br></pre></td></tr></table></figure><h4 id="泡茶经典案例解析"><a href="#泡茶经典案例解析" class="headerlink" title="泡茶经典案例解析"></a>泡茶经典案例解析</h4><p>在泡咖啡和茶的经典案例中，到底谁才是真正的模板方法呢？答案是<code>Beverage.prototype.init</code>,<br>这是因为该方法中封装了子类的算法框架，它作为一个算法的模板，指导子类以何种顺序去执行哪些方法。</p><h4 id="好莱坞原则重写经典案例"><a href="#好莱坞原则重写经典案例" class="headerlink" title="好莱坞原则重写经典案例"></a>好莱坞原则重写经典案例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重构父类</span></span><br><span class="line"><span class="keyword">var</span> Beverage = <span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'把水煮沸'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> brew = params.brew || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写brew方法'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> pourInCup = params.pourInCup || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写pourInCup方法'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> addCondiments = params.addCondiments || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写addCondiments方法'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  F.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    boilWater();</span><br><span class="line">    brew();</span><br><span class="line">    pourInCup();</span><br><span class="line">    addCondiments();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> F;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建子类</span></span><br><span class="line"><span class="keyword">var</span> Coffee = Beverage(&#123;</span><br><span class="line">  brew: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'冲泡咖啡'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  pourInCup: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'把咖啡倒进杯子里'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  addCondiments: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'加牛奶和糖'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> Tea = Beverage(&#123;</span><br><span class="line">  brew: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'用沸水浸泡茶叶'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  pourInCup: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'把茶水倒进杯子'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  addCondiments: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'加柠檬'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 实例化子类</span></span><br><span class="line"><span class="keyword">var</span> coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line"><span class="comment">// 依次输出： 把水煮沸 冲泡咖啡 把咖啡倒进杯子里 加牛奶和糖</span></span><br><span class="line">coffee.init();</span><br><span class="line"><span class="keyword">var</span> tea = <span class="keyword">new</span> Tea();</span><br><span class="line"><span class="comment">// 依次输出： 把水煮沸 用沸水浸泡茶叶 把茶水倒进杯子 加柠檬</span></span><br><span class="line">tea.init();</span><br></pre></td></tr></table></figure><h3 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h3><p>::: tip<br>亨元模式是一种用于性能优化的模式，其核心是运用共享技术来有效支持大量细粒度的对象。亨元模式要求将对象的属性划分为内部状态和外部状态。<br>:::</p><h4 id="亨元模式雏形"><a href="#亨元模式雏形" class="headerlink" title="亨元模式雏形"></a>亨元模式雏形</h4><p><strong>背景</strong>：某内衣厂生产有50种男士内衣和50种女士内衣，正常情况下，需要50个男模特和50个女模特来完成对内衣的试穿拍照，在不使用亨元模式的情况下，在程序里也许会这样写<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 亨元模式雏形</span></span><br><span class="line"><span class="keyword">var</span> Model = <span class="function"><span class="keyword">function</span>(<span class="params">sex,underwear</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">  <span class="keyword">this</span>.underwear = underwear;</span><br><span class="line">&#125;</span><br><span class="line">Model.prototype.takePhoto = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sex='</span>+<span class="keyword">this</span>.sex+<span class="string">',underwear='</span>+<span class="keyword">this</span>.underwear);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">50</span>; index++) &#123;</span><br><span class="line">  <span class="keyword">var</span> model = <span class="keyword">new</span> Model(<span class="string">'male'</span>,<span class="string">'underwear'</span>+index);</span><br><span class="line">  model.takePhoto();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">50</span>; index++) &#123;</span><br><span class="line">  <span class="keyword">var</span> model = <span class="keyword">new</span> Model(<span class="string">'female'</span>,<span class="string">'underwear'</span>+index);</span><br><span class="line">  model.takePhoto();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>思考</strong>：</p><ol><li>在上列中，要得到一张照片，每次需要传入sex和underwear参数，一共有50种男士内衣和50种女士内衣，一共需要100个对象，将来如果生产1000种内衣，则需要的对象会更多。</li><li>利用亨元模式后，虽然有100种内衣，但只需要男、女两个模特即可，即只需要两个对象</li></ol><h4 id="亨元模式初运用"><a href="#亨元模式初运用" class="headerlink" title="亨元模式初运用"></a>亨元模式初运用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Model = <span class="function"><span class="keyword">function</span> (<span class="params">sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line">Model.prototype.takePhoto = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sex='</span> + <span class="keyword">this</span>.sex + <span class="string">',underwear='</span> + <span class="keyword">this</span>.underwear);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> male = <span class="keyword">new</span> Model(<span class="string">'male'</span>);</span><br><span class="line"><span class="keyword">var</span> female = <span class="keyword">new</span> Model(<span class="string">'female'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">50</span>; index++) &#123;</span><br><span class="line">  male.underwear = index+<span class="number">1</span>;</span><br><span class="line">  male.takePhoto();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">50</span>; index++) &#123;</span><br><span class="line">  female.underwear = index+<span class="number">1</span>;</span><br><span class="line">  female.takePhoto();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>亨元模式初运用思考</strong>：</p><ol><li>我们通过new来创建男女两个model对象，在其他情况下，也许并不是一开始就需要共享所有的对象。</li><li>给model手动添加了underwear属性，在更加复杂的系统中，这并不是一个最好的方法，因为外部状态可能是相对比较复杂的，他们与共享对象的联系会变得更加困难。</li></ol><h4 id="真实案例：文件上传"><a href="#真实案例：文件上传" class="headerlink" title="真实案例：文件上传"></a>真实案例：文件上传</h4><p><strong>背景</strong>：在微云文件上传模块的开发中，曾爆发过对象爆炸的问题。微云文件上传分为浏览器插件上传，flash上传和表单上传等。用户对于不用的上传模式，都能一个一个上传，或者批量上传。在最初版时，同时上传2000个文件，在IE浏览器中直接进入假死状态。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实案例：文件上传</span></span><br><span class="line"><span class="comment">// 文件上传对象</span></span><br><span class="line"><span class="keyword">var</span> Upload = <span class="function"><span class="keyword">function</span> (<span class="params">uploadType, fileName, fileSize</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.uploadType = uploadType;</span><br><span class="line">  <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">  <span class="keyword">this</span>.fileSize = fileSize;</span><br><span class="line">  <span class="keyword">this</span>.dom = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Upload.prototype.init = <span class="function"><span class="keyword">function</span> (<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.id = id;</span><br><span class="line">  <span class="keyword">this</span>.dom = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  <span class="keyword">this</span>.dom.innerHTML = <span class="string">'&lt;span&gt;文件名称：'</span> + <span class="keyword">this</span>.fileName + <span class="string">',文件大小：'</span> </span><br><span class="line">  + <span class="keyword">this</span>.fileSize + <span class="string">'kb&lt;/span&gt;'</span> + <span class="string">'&lt;button type="button" class="delFile"&gt;删除&lt;/button&gt;'</span>;</span><br><span class="line">  <span class="keyword">this</span>.dom.querySelector(<span class="string">'.delFile'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    _self.deleteFile();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.dom);</span><br><span class="line">&#125;</span><br><span class="line">Upload.prototype.deleteFile = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.fileSize &lt; <span class="number">3000</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功删除'</span> + <span class="keyword">this</span>.fileName + <span class="string">'文件'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (confirm(<span class="string">'是否确定删除此文件?'</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传方法</span></span><br><span class="line"><span class="keyword">var</span> id = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">window</span>.startUpload = <span class="function"><span class="keyword">function</span> (<span class="params">uploadType, fileList</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; fileList.length; index++) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = fileList[index];</span><br><span class="line">    <span class="keyword">var</span> upload = <span class="keyword">new</span> Upload(uploadType, file.name, file.size);</span><br><span class="line">    upload.init(id++);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户上传</span></span><br><span class="line">startUpload(<span class="string">'plugin'</span>, [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'1.txt'</span>, <span class="attr">size</span>: <span class="number">1000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'2.txt'</span>, <span class="attr">size</span>: <span class="number">3000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'3.txt'</span>, <span class="attr">size</span>: <span class="number">5000</span> &#125;</span><br><span class="line">])</span><br><span class="line">startUpload(<span class="string">'flash'</span>, [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'4.txt'</span>, <span class="attr">size</span>: <span class="number">1000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'5.txt'</span>, <span class="attr">size</span>: <span class="number">3000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'6.txt'</span>, <span class="attr">size</span>: <span class="number">5000</span> &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure></p><h4 id="真实案例：文件上传结果"><a href="#真实案例：文件上传结果" class="headerlink" title="真实案例：文件上传结果"></a>真实案例：文件上传结果</h4><p><img src="/2022/04/12/JavaScript设计模式与开发实践/images/books/fileUploadResult.png" alt="真实案例：文件上传结果"></p><h4 id="真实案例：亨元模式重构文件上传"><a href="#真实案例：亨元模式重构文件上传" class="headerlink" title="真实案例：亨元模式重构文件上传"></a>真实案例：亨元模式重构文件上传</h4><p>::: tip 如何划分内部状态和外部状态</p><ol><li>内部状态存储于对象内部</li><li>内部状态可以被一些对象共享</li><li>内部状态独立于具体的场景，通常不会改变</li><li>外部状态取决于具体的场景，并根据场景的变化而变化，外部状态通常是不能被共享的。<br>:::<br>::: tip 文件上传内部状态划分<br>内部状态：uploadType<br><br>外部状态：fileName,fileSize(文件名和文件大小不能被共享，它随不同的文件不同而不同)<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实案例：亨元模式重构文件上传</span></span><br><span class="line"><span class="comment">// 文件上传对象</span></span><br><span class="line"><span class="keyword">var</span> Upload = <span class="function"><span class="keyword">function</span> (<span class="params">uploadType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.uploadType = uploadType;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 工厂模式：解决一开始就共享所有对象的问题</span></span><br><span class="line"><span class="keyword">var</span> UploadFactory = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> createFactoryList = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params">uploadType</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(createFactoryList[uploadType]) &#123;</span><br><span class="line">        <span class="keyword">return</span> createFactoryList[uploadType]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> createFactoryList[uploadType] = <span class="keyword">new</span> Upload(uploadType);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// 管理器：封装外部状态，使程序在运行时给upload对象设置外部状态</span></span><br><span class="line"><span class="keyword">var</span> uploadManage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> uploadDataBase = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">id,type,name,size</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> uploadObj = UploadFactory.create(type);</span><br><span class="line">      <span class="keyword">var</span> dom = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">      dom.innerHTML = <span class="string">'&lt;span&gt;文件名称：'</span> + name + <span class="string">',文件大小：'</span> + </span><br><span class="line">      size + <span class="string">'kb&lt;/span&gt;'</span> + <span class="string">'&lt;button type="button" class="delFile"&gt;删除&lt;/button&gt;'</span>;</span><br><span class="line">      dom.querySelector(<span class="string">'.delFile'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        uploadObj.deleteFile(id);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(dom);</span><br><span class="line">      uploadDataBase[id] = &#123;</span><br><span class="line">        fileName: name,</span><br><span class="line">        fileSize: size,</span><br><span class="line">        dom: dom</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> uploadObj;</span><br><span class="line">    &#125;,</span><br><span class="line">    setExternalState: <span class="function"><span class="keyword">function</span>(<span class="params">id,uploadObj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> uploadData = uploadDataBase[id];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> uploadData) &#123;</span><br><span class="line">        uploadObj[i] = uploadData[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">Upload.prototype.deleteFile = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  uploadManage.setExternalState(id,<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.fileSize &lt; <span class="number">3000</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (confirm(<span class="string">'是否确定删除此文件?'</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传方法</span></span><br><span class="line"><span class="keyword">var</span> id = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">window</span>.startUpload = <span class="function"><span class="keyword">function</span> (<span class="params">uploadType, fileList</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; fileList.length; index++) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = fileList[index];</span><br><span class="line">    <span class="keyword">var</span> upload = uploadManage.add(++id,uploadType,file.name,file.size);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户上传</span></span><br><span class="line">startUpload(<span class="string">'plugin'</span>, [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'1.txt'</span>, <span class="attr">size</span>: <span class="number">1000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'2.txt'</span>, <span class="attr">size</span>: <span class="number">3000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'3.txt'</span>, <span class="attr">size</span>: <span class="number">5000</span> &#125;</span><br><span class="line">])</span><br><span class="line">startUpload(<span class="string">'flash'</span>, [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'4.txt'</span>, <span class="attr">size</span>: <span class="number">1000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'5.txt'</span>, <span class="attr">size</span>: <span class="number">3000</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'6.txt'</span>, <span class="attr">size</span>: <span class="number">5000</span> &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure></li></ol><h4 id="真实案例：亨元模式重构文件上传-1"><a href="#真实案例：亨元模式重构文件上传-1" class="headerlink" title="真实案例：亨元模式重构文件上传"></a>真实案例：亨元模式重构文件上传</h4><p><img src="/2022/04/12/JavaScript设计模式与开发实践/images/books/fileUploadResult.png" alt="亨元模式重构文件上传结果"></p><h3 id="职责链模式"><a href="#职责链模式" class="headerlink" title="职责链模式"></a>职责链模式</h3><p>::: tip 定义<br>职责链模式：使多个对象都有机会处理请求，从而避免请求的发送者和接受者之间的耦合关系，将这些对象连成一条链传递该请求，直到有一个对象处理它为止。<br>:::<br><strong>优点</strong>：</p><ol><li>解耦发送者和N个接受者之间的关系</li><li>可以手动设置起始节点，并不是必须从第一个开始</li><li>可以与其他设计模式在一起实现更加复杂的功能，例如职责链模式+命令模式</li></ol><p><strong>缺点</strong>：</p><ol><li>请求不能保证一定能在接受者中被处理</li><li>请求链过长的情况下，可能某些节点并没有起到实质性的作用，造成性能损耗。</li></ol><h4 id="现实中的职责链模式"><a href="#现实中的职责链模式" class="headerlink" title="现实中的职责链模式"></a>现实中的职责链模式</h4><ol><li>高峰坐公交时，从后门上车的乘客需要把卡一个一个传递，最后一个人打卡或者投币。</li><li>考试写小纸条，往后一个一个传递，直到有一个人把正确答案给你为止。</li></ol><h4 id="实际开发中的职责链模式-if-else版"><a href="#实际开发中的职责链模式-if-else版" class="headerlink" title="实际开发中的职责链模式: if-else版"></a>实际开发中的职责链模式: if-else版</h4><p><strong>背景</strong>：某公司电商网站，准备做一个活动，用户分别交纳500元定金，可得100元优惠券；交纳200元定金，可得50元优惠券；不交纳定金，正常购买，不享受优惠券，切在库存不充足时，不一定保证能买到商品。<br><br><strong>字段描述</strong>:</p><ol><li>orderType: 1代表500元定金用户；2代表200元定金用户；3代表普通用户</li><li>pay：是否已支付定金</li><li>stock：库存，支付了定金的用户不受库存限制</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else版</span></span><br><span class="line"><span class="keyword">var</span>  order = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(pay) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'500元定金预购，享受100元优惠券'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 未支付定金，降级到普通订单</span></span><br><span class="line">      <span class="keyword">if</span>(stock&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'普通订单，无优惠券'</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'库存不足'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(orderType==<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(pay) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'200元定金预购，享受50元优惠券'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 未支付定金，降级到普通订单</span></span><br><span class="line">      <span class="keyword">if</span>(stock&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'普通订单，无优惠券'</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'库存不足'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(orderType==<span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(stock&gt;<span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'普通订单，无优惠券'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'库存不足'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单测试</span></span><br><span class="line">order(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：500元定金预购，享受100元优惠券</span></span><br><span class="line">order(<span class="number">1</span>, <span class="literal">false</span>,<span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br><span class="line">order(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：200元定金预购，享受50元优惠券</span></span><br><span class="line">order(<span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br></pre></td></tr></table></figure><h4 id="实际开发中的职责链模式-职责链重构版"><a href="#实际开发中的职责链模式-职责链重构版" class="headerlink" title="实际开发中的职责链模式: 职责链重构版"></a>实际开发中的职责链模式: 职责链重构版</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 职责链重构版</span></span><br><span class="line"><span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">1</span> &amp;&amp; pay) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'500元定金预购，享受100元优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    order200(orderType,pay,stock);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">2</span> &amp;&amp; pay) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'200元定金预购，享受50元优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    orderNormal(orderType,pay,stock);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(stock&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'普通订单，无优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'库存不足'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单测试</span></span><br><span class="line">order500(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：500元定金预购，享受100元优惠券</span></span><br><span class="line">order500(<span class="number">1</span>, <span class="literal">false</span>,<span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br><span class="line">order500(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：200元定金预购，享受50元优惠券</span></span><br><span class="line">order500(<span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br></pre></td></tr></table></figure><p><strong>存在的问题</strong>:</p><ol><li>传递请求的代码被严格耦合在了一起，违反开放-封闭原则</li><li>当要新增300元订单时，必须把原来的职责链拆解，移动后才能运行起来</li></ol><h4 id="实际开发中的职责链模式-职责链重构完善版"><a href="#实际开发中的职责链模式-职责链重构完善版" class="headerlink" title="实际开发中的职责链模式: 职责链重构完善版"></a>实际开发中的职责链模式: 职责链重构完善版</h4><p>::: tip 约定<br>我们约定，在某个节点处理不了请求时，返回一个字段，把请求往后传递<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 职责链重构完善版</span></span><br><span class="line"><span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">1</span> &amp;&amp; pay) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'500元定金预购，享受100元优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'next'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">2</span> &amp;&amp; pay) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'200元定金预购，享受50元优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'next'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(stock&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'普通订单，无优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'库存不足'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增职责链类</span></span><br><span class="line"><span class="keyword">var</span> Chain = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.fn = fn;</span><br><span class="line">  <span class="keyword">this</span>.receiver = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Chain.prototype.setReceiver = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">&#125;</span><br><span class="line">Chain.prototype.passRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> returnMsg = <span class="keyword">this</span>.fn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="keyword">if</span>(returnMsg==<span class="string">'next'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.receiver &amp;&amp; <span class="keyword">this</span>.receiver.passRequest.apply(<span class="keyword">this</span>.receiver,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> returnMsg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chainOrder500 = <span class="keyword">new</span> Chain(order500);</span><br><span class="line"><span class="keyword">var</span> chainOrder200 = <span class="keyword">new</span> Chain(order200);</span><br><span class="line"><span class="keyword">var</span> chainOrderNormal = <span class="keyword">new</span> Chain(orderNormal);</span><br><span class="line">chainOrder500.setReceiver(chainOrder200);</span><br><span class="line">chainOrder200.setReceiver(chainOrderNormal);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单测试</span></span><br><span class="line">chainOrder500.passRequest(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：500元定金预购，享受100元优惠券</span></span><br><span class="line">chainOrder500.passRequest(<span class="number">1</span>, <span class="literal">false</span>,<span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br><span class="line">chainOrder500.passRequest(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：200元定金预购，享受50元优惠券</span></span><br><span class="line">chainOrder500.passRequest(<span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br></pre></td></tr></table></figure></p><h4 id="实际开发中的职责链模式-AOP实现"><a href="#实际开发中的职责链模式-AOP实现" class="headerlink" title="实际开发中的职责链模式: AOP实现"></a>实际开发中的职责链模式: AOP实现</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AOP实现职责链模式</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> returnMsg = self.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">if</span>(returnMsg==<span class="string">'next'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnMsg;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">1</span> &amp;&amp; pay) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'500元定金预购，享受100元优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'next'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(orderType==<span class="number">2</span> &amp;&amp; pay) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'200元定金预购，享受50元优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'next'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params">orderType,pay,stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(stock&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'普通订单，无优惠券'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'库存不足'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> order = order500.after(order200).after(orderNormal);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单测试</span></span><br><span class="line">order(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：500元定金预购，享受100元优惠券</span></span><br><span class="line">order(<span class="number">1</span>, <span class="literal">false</span>,<span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br><span class="line">order(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：200元定金预购，享受50元优惠券</span></span><br><span class="line">order(<span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span>);  <span class="comment">// 输出：普通订单，无优惠券</span></span><br></pre></td></tr></table></figure><h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><p>::: tip<br>中介者模式：中介者模式的作用就是解除对象与对象之间的紧耦合关系。增加一个中介者对象后，所有的相关对象都通过中介者对象来通信，而不是互相引用，所以当一个对象发生改变时，只需要通知中介者即可。<br>:::</p><h4 id="中介者模式的缺点"><a href="#中介者模式的缺点" class="headerlink" title="中介者模式的缺点"></a>中介者模式的缺点</h4><ol><li>中介者模式本身就要新增一个中介者对象</li><li>将对象与对象之间交互的复杂性，转移到对象与中介者之间的复杂性，使得中介者对象经常是巨大的</li><li>中介者本身就是一个难以维护的对象。</li></ol><h4 id="现实中的案例"><a href="#现实中的案例" class="headerlink" title="现实中的案例"></a>现实中的案例</h4><ol><li>机场指挥塔<br>机场指挥塔扮演者中介者，而不同的飞机扮演对象，他们通过与指挥塔进行通信，从而得知消息，什么时候可以起飞，什么时候可以降落。</li><li>博彩公司<br>在世界杯期间，博彩公司通过扮演中介者，把成千上万的用户投注情况进行汇总，根据比赛的输赢，进行计算相关的赔率。</li></ol><h4 id="中介者模式案例：泡泡堂-原始版"><a href="#中介者模式案例：泡泡堂-原始版" class="headerlink" title="中介者模式案例：泡泡堂(原始版)"></a>中介者模式案例：泡泡堂(原始版)</h4><p>::: tip</p><ol><li>分为红蓝两队</li><li>只有某队全部死亡，才算失败<br>:::<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中介者模式案例：泡泡堂(原始版)</span></span><br><span class="line"><span class="keyword">var</span> Player = <span class="function"><span class="keyword">function</span>(<span class="params">name,teamColor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.partners = [];         <span class="comment">// 队友列表</span></span><br><span class="line">  <span class="keyword">this</span>.emeies = [];           <span class="comment">// 敌人列表</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;           <span class="comment">// 名字</span></span><br><span class="line">  <span class="keyword">this</span>.teamColor = teamColor; <span class="comment">// 队伍颜色</span></span><br><span class="line">  <span class="keyword">this</span>.state = <span class="string">'live'</span>;        <span class="comment">// 生存状态</span></span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.win = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'胜利了'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.lose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'失败了'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.die = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> allDie = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">this</span>.state = <span class="string">'dead'</span>;</span><br><span class="line">  <span class="comment">// 遍历队友是否全部阵亡</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len = <span class="keyword">this</span>.partners.length; index &lt; len; index++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.partners[index].state!=<span class="string">'dead'</span>) &#123;</span><br><span class="line">      allDie = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果全部阵亡，遍历通知队友失败，通知敌人胜利</span></span><br><span class="line">  <span class="keyword">if</span>(allDie) &#123;</span><br><span class="line">    <span class="keyword">this</span>.lose();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len = <span class="keyword">this</span>.partners.length; index &lt; len; index++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.partners[index].lose();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len = <span class="keyword">this</span>.emeies.length; index &lt; len; index++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.emeies[index].win();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂方法创建玩家</span></span><br><span class="line"><span class="keyword">var</span> players = [];</span><br><span class="line"><span class="keyword">var</span> playerFactory = <span class="function"><span class="keyword">function</span>(<span class="params">name,teamColor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newPlayer = <span class="keyword">new</span> Player(name,teamColor);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len = players.length; index &lt; len; index++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(players[index].teamColor==teamColor) &#123;</span><br><span class="line">      players[index].partners.push(newPlayer);</span><br><span class="line">      newPlayer.partners.push(players[index]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      players[index].emeies.push(newPlayer);</span><br><span class="line">      newPlayer.emeies.push(players[index]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  players.push(newPlayer);</span><br><span class="line">  <span class="keyword">return</span> newPlayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 红队</span></span><br><span class="line"><span class="keyword">var</span> player1 = playerFactory(<span class="string">'张三'</span>,<span class="string">'red'</span>),</span><br><span class="line">    player2 = playerFactory(<span class="string">'张四'</span>,<span class="string">'red'</span>),</span><br><span class="line">    player3 = playerFactory(<span class="string">'张五'</span>,<span class="string">'red'</span>),</span><br><span class="line">    player4 = playerFactory(<span class="string">'张六'</span>,<span class="string">'red'</span>);</span><br><span class="line"><span class="comment">// 蓝队</span></span><br><span class="line"><span class="keyword">var</span> player5 = playerFactory(<span class="string">'辰大'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    player6 = playerFactory(<span class="string">'辰二'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    player7 = playerFactory(<span class="string">'辰三'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    player8 = playerFactory(<span class="string">'辰四'</span>,<span class="string">'blue'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 淘汰玩家</span></span><br><span class="line"><span class="comment">// 依次输出：辰四失败了 辰大失败了 辰二失败了 辰三失败了 张三胜利了  张四胜利了</span></span><br><span class="line"><span class="comment">// 张五胜利了  张六胜利了</span></span><br><span class="line">player5.die();</span><br><span class="line">player6.die();</span><br><span class="line">player7.die();</span><br><span class="line">player8.die();</span><br></pre></td></tr></table></figure></li></ol><p><strong>思考</strong>：<br></p><ol><li>虽然我们可以随意创建任意对个玩家，但玩家和其他玩家紧紧耦合在了一起</li><li>某一个玩家的状态改变，必须通知其他对象，当其它对象很多时，会非常不合适。</li><li>不利于扩展，今后如果要添加新的功能，如：玩家掉线，解除队伍，添加到别的队伍会非常不方便。</li></ol><h4 id="中介者模式案例：泡泡堂-引入中介者"><a href="#中介者模式案例：泡泡堂-引入中介者" class="headerlink" title="中介者模式案例：泡泡堂(引入中介者)"></a>中介者模式案例：泡泡堂(引入中介者)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中介者模式案例：泡泡堂(引入中介者)</span></span><br><span class="line"><span class="keyword">var</span> playerDirector = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> players = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> operations = &#123;</span><br><span class="line">    addPlayer: <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> teamColor = player.teamColor;</span><br><span class="line">      <span class="keyword">if</span>(!players[teamColor]) &#123;</span><br><span class="line">        players[teamColor] = [];</span><br><span class="line">      &#125;</span><br><span class="line">      players[teamColor].push(player)</span><br><span class="line">    &#125;,</span><br><span class="line">    removePlayer: <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> teamColor = player.teamColor;</span><br><span class="line">      <span class="keyword">var</span> teamPlayers = players[teamColor] || [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len=teamPlayers.length; index &lt; len; index++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(teamPlayers[index]==player) &#123;</span><br><span class="line">          teamPlayers.splice(index,<span class="number">1</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    changeTeam: <span class="function"><span class="keyword">function</span>(<span class="params">player,newTeamColor</span>) </span>&#123;</span><br><span class="line">      operations.removePlayer(player);</span><br><span class="line">      player.teamColor = newTeamColor;</span><br><span class="line">      operations.addPlayer(player);</span><br><span class="line">    &#125;,</span><br><span class="line">    playerDead: <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> teamColor = player.teamColor;</span><br><span class="line">      <span class="keyword">var</span> teamPlayers = players[teamColor];</span><br><span class="line">      <span class="keyword">var</span> allDead = <span class="literal">true</span>;</span><br><span class="line">      player.state = <span class="string">'dead'</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len=teamPlayers.length; index &lt; len; index++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(teamPlayers[index].state!=<span class="string">'dead'</span>) &#123;</span><br><span class="line">          allDead = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(allDead) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len=teamPlayers.length; index &lt; len; index++) &#123;</span><br><span class="line">          teamPlayers[index].lose();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> color <span class="keyword">in</span> players) &#123;</span><br><span class="line">          <span class="keyword">if</span>(color!=teamColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>,len=players[color].length; index &lt; len; index++) &#123;</span><br><span class="line">              players[color][index].win();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> ReceiveMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> message = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    operations[message].apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ReceiveMessage: ReceiveMessage</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">var</span> Player = <span class="function"><span class="keyword">function</span>(<span class="params">name,teamColor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.teamColor = teamColor;</span><br><span class="line">  <span class="keyword">this</span>.state = <span class="string">'live'</span>;</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.win = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'胜利了'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.lose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'失败了'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'掉线了'</span>);</span><br><span class="line">  playerDirector.ReceiveMessage(<span class="string">'removePlayer'</span>,<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.die = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'死亡'</span>);</span><br><span class="line">  playerDirector.ReceiveMessage(<span class="string">'playerDead'</span>,<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.changeTeam = <span class="function"><span class="keyword">function</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'换队'</span>);</span><br><span class="line">  playerDirector.ReceiveMessage(<span class="string">'changeTeam'</span>,<span class="keyword">this</span>,color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂模式创建玩家</span></span><br><span class="line"><span class="keyword">var</span> playerFactory = <span class="function"><span class="keyword">function</span>(<span class="params">name,teamColor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newPlayer = <span class="keyword">new</span> Player(name,teamColor);</span><br><span class="line">  playerDirector.ReceiveMessage(<span class="string">'addPlayer'</span>,newPlayer);</span><br><span class="line">  <span class="keyword">return</span> newPlayer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 红队</span></span><br><span class="line"><span class="keyword">var</span> player1 = playerFactory(<span class="string">'张三'</span>,<span class="string">'red'</span>),</span><br><span class="line">    player2 = playerFactory(<span class="string">'张四'</span>,<span class="string">'red'</span>),</span><br><span class="line">    player3 = playerFactory(<span class="string">'张五'</span>,<span class="string">'red'</span>),</span><br><span class="line">    player4 = playerFactory(<span class="string">'张六'</span>,<span class="string">'red'</span>);</span><br><span class="line"><span class="comment">// 蓝队</span></span><br><span class="line"><span class="keyword">var</span> player5 = playerFactory(<span class="string">'辰大'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    player6 = playerFactory(<span class="string">'辰二'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    player7 = playerFactory(<span class="string">'辰三'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    player8 = playerFactory(<span class="string">'辰四'</span>,<span class="string">'blue'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 掉线</span></span><br><span class="line"><span class="comment">// 依次输出：张三掉线了 张四掉线了</span></span><br><span class="line">player1.remove();</span><br><span class="line">player2.remove();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更换队伍</span></span><br><span class="line"><span class="comment">// 依次输出：张五换队 张五死亡</span></span><br><span class="line">player3.changeTeam(<span class="string">'blue'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 阵亡</span></span><br><span class="line"><span class="comment">// 依次输出：辰大死亡 辰二死亡  辰三死亡 辰四死亡</span></span><br><span class="line"><span class="comment">// 辰大失败了 辰二失败了  辰三失败了 辰四失败了 张五失败了</span></span><br><span class="line"><span class="comment">// 张六胜利了</span></span><br><span class="line">player3.die();</span><br><span class="line">player5.die();</span><br><span class="line">player6.die();</span><br><span class="line">player7.die();</span><br><span class="line">player8.die();</span><br></pre></td></tr></table></figure><h3 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h3><p>::: tip 定义<br>装饰者模式可以动态的给某个对象添加一些额外的职责，而不会影响从这个类中派生的其他对象。<br>:::</p><h4 id="继承的问题"><a href="#继承的问题" class="headerlink" title="继承的问题"></a>继承的问题</h4><p>在传统的面向对象语言中，给对象添加功能常常使用继承的方式，但继承的方式并不灵活，还会带来许多问题</p><ol><li>超类和子类之间存在强耦合关系，当改变超类时，子类也会随之改变。</li><li>超类的内部细节对子类是可见的，继承常常被认为破坏了封装性。</li><li>在完成一些功能复用的同时，有可能创建出大量的子类，使子类的数量呈爆炸式增长。</li></ol><h4 id="模拟面向对象语言的装饰者模式"><a href="#模拟面向对象语言的装饰者模式" class="headerlink" title="模拟面向对象语言的装饰者模式"></a>模拟面向对象语言的装饰者模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 飞机大战案例: 面向对象版</span></span><br><span class="line"><span class="keyword">var</span> Plane = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> Missile = <span class="function"><span class="keyword">function</span>(<span class="params">plane</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.plane = plane;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> Atom = <span class="function"><span class="keyword">function</span>(<span class="params">plane</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.plane = plane;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Plane.prototype.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发射普通子弹'</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Missile.prototype.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.plane.fire();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发射导弹'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Atom.prototype.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.plane.fire();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发射原子弹'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">var</span> plane = <span class="keyword">new</span> Plane();</span><br><span class="line">plane = <span class="keyword">new</span> Missile(plane);</span><br><span class="line">plane = <span class="keyword">new</span> Atom(plane);</span><br><span class="line">plane.fire(); <span class="comment">// 依次输出：发射普通子弹 发射导弹 发射原子弹</span></span><br></pre></td></tr></table></figure><h4 id="JavaScript中的装饰者"><a href="#JavaScript中的装饰者" class="headerlink" title="JavaScript中的装饰者"></a>JavaScript中的装饰者</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript版</span></span><br><span class="line"><span class="keyword">var</span> plane = &#123;</span><br><span class="line">  fire: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'发射普通子弹'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> missile = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发射导弹'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> atom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发射原子弹'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fire1 = plane.fire;</span><br><span class="line">plane.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fire1();</span><br><span class="line">  missile();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fire2 = plane.fire;</span><br><span class="line">plane.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fire2();</span><br><span class="line">  atom();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">plane.fire();<span class="comment">// 依次输出：发射普通子弹 发射导弹 发射原子弹</span></span><br></pre></td></tr></table></figure><p><strong>解析</strong>：这种给对象添加职责的方式，并没有真正的改动对象自身，而是将对象放入另外一个对象之中，这些对象以一条链的方式进行引用，形成一个聚合对象。</p><h4 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h4><p>用AOP装饰函数的技巧在实际开发中非常有用，无论是业务代码的编写，还是在框架层面，我们都可以把行为依照职责分成粒度更细的函数，随后通过装饰把他们合并在一起，这有助于我们编写一个松耦合和高复用性的系统。</p><h5 id="AOP的两个装饰函数"><a href="#AOP的两个装饰函数" class="headerlink" title="AOP的两个装饰函数"></a>AOP的两个装饰函数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before函数</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforeFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeFn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> _self.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// after函数</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">afterFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ret = _self.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    afterFn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="AOP应用实例一：数据上报"><a href="#AOP应用实例一：数据上报" class="headerlink" title="AOP应用实例一：数据上报"></a>AOP应用实例一：数据上报</h5><p>分离业务代码和数据统计代码，无论在什么语言中，都是AOP的经典应用之一。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btnLogin"</span>&gt;</span>点击打开登录浮层<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据上报</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span> (<span class="params">beforeFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> _self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span> (<span class="params">afterFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ret = _self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    afterFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> showLogin = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'打开登录浮层'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依次输出：按钮点击之前上报  打开登录浮层  按钮点击之后上报</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'btnLogin'</span>).onclick = showLogin.before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'按钮点击之前上报'</span>);</span><br><span class="line">&#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'按钮点击之后上报'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="AOP应用实例一：插件式表单"><a href="#AOP应用实例一：插件式表单" class="headerlink" title="AOP应用实例一：插件式表单"></a>AOP应用实例一：插件式表单</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"loginBtn"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插件式表单</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span> (<span class="params">beforeFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(beforeFn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>)===<span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="comment">// 未验证通过，不再执行原函数</span></span><br><span class="line">      <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> username = <span class="built_in">document</span>.getElementById(<span class="string">'username'</span>);</span><br><span class="line"><span class="keyword">var</span> password = <span class="built_in">document</span>.getElementById(<span class="string">'password'</span>);</span><br><span class="line"><span class="keyword">var</span> loginBtn = <span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>);</span><br><span class="line"><span class="comment">// 验证函数</span></span><br><span class="line"><span class="keyword">var</span> validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(username.value === <span class="string">''</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'用户名不能为空'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(password.value === <span class="string">''</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'密码不能为空'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 登录ajax</span></span><br><span class="line"><span class="keyword">var</span> formSubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> params = &#123;</span><br><span class="line">    username: username,</span><br><span class="line">    password: password</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'登录ajax...'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 登录按钮点击</span></span><br><span class="line">formSubmit = formSubmit.before(validate);</span><br><span class="line">loginBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  formSubmit();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p>::: tip<br>状态模式的关键是区分事物内部的状态，事物内部状态的改变往往会带来事物的行为改变。<br>:::</p><h4 id="初识状态模式"><a href="#初识状态模式" class="headerlink" title="初识状态模式"></a>初识状态模式</h4><p>我们想象这样一个场景：有一个电灯，电灯上面只有一个开关。当电灯开着的时候，我们按一下开关，电灯会切换到关闭状态;再按一次开关，电灯又将被打开。同一个开关按钮，在不同的状态下，表现出来的行为是不一样的。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 电灯类</span></span><br><span class="line"><span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state = <span class="string">'off'</span>;</span><br><span class="line">  <span class="keyword">this</span>.button = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化方法</span></span><br><span class="line">Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  button.innerHTML = <span class="string">'开关'</span>;</span><br><span class="line">  <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</span><br><span class="line">  <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    _self.buttonPresssed();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 开关点击</span></span><br><span class="line">Light.prototype.buttonPresssed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state == <span class="string">'off'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'on'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'开灯'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.state == <span class="string">'on'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'off'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> light = <span class="keyword">new</span> Light();</span><br><span class="line">light.init();</span><br></pre></td></tr></table></figure></p><p><strong>分析</strong>：现在看来，我们已经编写了一个强壮的状态机，这个状态机的逻辑既简单又缜密，看起来这段代码设计得无懈可击。但令人遗憾的是，这个世界上的电灯并非只有一种。许多酒店里有另外一种电灯，这种电灯也只有一种开关，但它的表现是：当第一次按下时，出现弱光;第二次按下时，出现强光；第三次按下时才是关闭电灯。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改写开关点击事件</span></span><br><span class="line">Light.prototype.buttonPresssed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state == <span class="string">'off'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'weakLight'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'弱光'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.state == <span class="string">'weakLight'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'strongLight'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'强光'</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.state == <span class="string">'strongLight'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'off'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>再次分析</strong>：以上代码存在如下的缺点</p><ol><li>开关点击事件中的代码，违反了开放-封闭原则，每次新增或者修改<code>light</code>的状态，都要改动开关点击事件中的代码</li><li>所有跟状态有关的行为，都被封装在<code>buttonPresssed</code>方法里，后续如果再扩展一种灯光的话，将十分难以维护。</li><li>状态的切换不明显，仅仅表现在对<code>state</code>变量的赋值。</li><li><code>buttonPresssed</code>方法里，对于状态的判断，仅仅是<code>if-else</code>的堆砌，不利于后续的维护和扩展</li></ol><h4 id="状态模式改写电灯程序"><a href="#状态模式改写电灯程序" class="headerlink" title="状态模式改写电灯程序"></a>状态模式改写电灯程序</h4><p>::: tip<br>状态模式的核心是区分对象的状态，将电灯程序中三种状态分别设计成单独的一个类，与此种状态有关的行为被封装在这个类的内部。<br>:::<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭</span></span><br><span class="line"><span class="keyword">var</span> OffLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.light = light;</span><br><span class="line">&#125;</span><br><span class="line">OffLightState.prototype.buttonPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'弱光'</span>);</span><br><span class="line">  <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.weakLightState);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 弱光</span></span><br><span class="line"><span class="keyword">var</span> WeakLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.light = light;</span><br><span class="line">&#125;</span><br><span class="line">WeakLightState.prototype.buttonPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'强光'</span>);</span><br><span class="line">  <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.strongLightState);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 强光</span></span><br><span class="line"><span class="keyword">var</span> StrongLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.light = light;</span><br><span class="line">&#125;</span><br><span class="line">StrongLightState.prototype.buttonPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'关闭'</span>);</span><br><span class="line">  <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.offLightState);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 电灯类</span></span><br><span class="line"><span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.offLightState = <span class="keyword">new</span> OffLightState(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.weakLightState = <span class="keyword">new</span> WeakLightState(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.strongLightState = <span class="keyword">new</span> StrongLightState(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.button = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</span><br><span class="line">  <span class="keyword">this</span>.button.innerHTML = <span class="string">'开关'</span>;</span><br><span class="line">  <span class="keyword">this</span>.currState = <span class="keyword">this</span>.offLightState;</span><br><span class="line">  <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    _self.currState.buttonPressed();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Light.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.currState = state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化测试</span></span><br><span class="line"><span class="keyword">var</span> light = <span class="keyword">new</span> Light();</span><br><span class="line">light.init();</span><br></pre></td></tr></table></figure></p><h4 id="状态模式的优缺点"><a href="#状态模式的优缺点" class="headerlink" title="状态模式的优缺点"></a>状态模式的优缺点</h4><p>现在我们已经大概掌握了状态模式，现在是时候来总结一下状态模式的优缺点了。<br><br><strong>优点</strong>：</p><ol><li>状态模式定义了状态和行为之间的关系，并将他们封装在一个类里。通过增加新的状态类，很容易增加新的状态和转换。</li><li>避免了<code>Context</code>无限膨胀，状态切换的逻辑被分布在状态类中，也去掉了<code>Context</code>中原本过多的条件分支</li><li>用对象代替字符串来记录当前状态，使得状态的切换更加一目了然。</li><li><code>Context</code>中的请求动作和状态类中封装的行为可以非常容易的独立变化而不影响。</li></ol><p><strong>缺点</strong>：</p><ol><li>状态模式会根据系统中多少种状态来定义多少个类，这将是一项枯燥和无味的过程</li><li>状态模式会将逻辑分散在各个状态类中，虽然可以避免条件分支语句判断，但也造成了逻辑分散，我们无法在一个地方就看出整个状态机的逻辑。<h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3>:::tip<br>适配器模式的作用是解决两个软件实体间的接口不兼容的问题，使用适配器模式之后，原本由于接口不兼容而不能工作的两个软件实体可以一起工作。<br>:::</li></ol><h4 id="适配器运用-地图渲染"><a href="#适配器运用-地图渲染" class="headerlink" title="适配器运用:地图渲染"></a>适配器运用:地图渲染</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 谷歌地图</span></span><br><span class="line"><span class="keyword">var</span> googleMap = &#123;</span><br><span class="line">  show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'开始渲染谷歌地图'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 百度地图</span></span><br><span class="line"><span class="keyword">var</span> baiduMap = &#123;</span><br><span class="line">  <span class="comment">// 地图渲染接口不兼容</span></span><br><span class="line">  display: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'开始渲染百度地图'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 百度地图适配器</span></span><br><span class="line"><span class="keyword">var</span> baiduMapAdapter = &#123;</span><br><span class="line">  show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> baiduMap.display();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 地图渲染</span></span><br><span class="line"><span class="keyword">var</span> renderMap = <span class="function"><span class="keyword">function</span>(<span class="params">map</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(map.show <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;</span><br><span class="line">    map.show();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 测试地图渲染</span></span><br><span class="line">renderMap(googleMap);       <span class="comment">// 开始渲染谷歌地图</span></span><br><span class="line">renderMap(baiduMapAdapter); <span class="comment">// 开始渲染百度地图</span></span><br></pre></td></tr></table></figure><h2 id="设计原则和编程技巧"><a href="#设计原则和编程技巧" class="headerlink" title="设计原则和编程技巧"></a>设计原则和编程技巧</h2><p>前辈们总结的这些设计原则通常指<strong>单一职责原则</strong>、<strong>里氏转换原则</strong>、<strong>依赖倒置原则</strong>、<strong>接口隔离原则</strong>、<strong>合成复用原则</strong>和<strong>最少知识原则</strong>。</p><h3 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h3><p>::: tip<br>单一职责原则(SRP)体现为：一个对象(方法)只做一件事情，它被广泛运用在代理模式、迭代器模式、单例模式和装饰者模式中。<br>:::<br>单一职责原则被定义为”引起变化的原因”，如果我们有两个动机去改写一个方法，那么这个方法就具有两个职责。每一个职责的变化都是一个轴线，如果一个人承担了过多的职责，那么在需求变迁的过程中，需要改写这个方法的可能性就越大。</p><h4 id="何时应该分离职责"><a href="#何时应该分离职责" class="headerlink" title="何时应该分离职责"></a>何时应该分离职责</h4><p><code>SRP</code>原则是所有原则中最简单也是最难正确运用的原则之一，要明确的是，并不是所有的职责都应该一一分离。</p><ol><li>一方面，如果随着需求的变化，有两个职责总是同时变化，那就不比分离他们。比如Ajax请求时，创建xhr对象和发送xhr请求几乎总是在一起，那么创建xhr对象的职责和发送xhr请求的职责就没有必要分开。</li><li>另一方面，职责的变化轴线仅当他们确定会发生变化时才具有意义，即使两个职责已经被耦合在一起，但他们还没有发生改变的征兆，那么也许没有必要主动分离他们，在代码需要重构的时候再进行分离也不迟。</li></ol><h4 id="SRP原则的优缺点"><a href="#SRP原则的优缺点" class="headerlink" title="SRP原则的优缺点"></a>SRP原则的优缺点</h4><p><strong>优点</strong>：降低了单个类或者对象的复杂度，按照职责把对象分解成更小的粒度，这有助于代码的复用，也有利于进行单元测试。当一个职责需要变更的时候，不会影响到其他的职责。<br><br><strong>缺点</strong>：最明显的是会增加编写代码的复杂度，当我们按照职责把对象分解成更小的粒度之后，实际上也增大了这些对象之间相互联系的难度。</p><h3 id="最少知识原则"><a href="#最少知识原则" class="headerlink" title="最少知识原则"></a>最少知识原则</h3><p>::: tip<br>最少知识原则(LKP)说的是一个软件实体应当尽可能少的于其他实体发生相互作用，它常用在中介者模式和外观模式中。<br>:::</p><h4 id="指导思想"><a href="#指导思想" class="headerlink" title="指导思想"></a>指导思想</h4><p>最少知识原则要求我们在设计程序时，应当尽量减少对象之间的交互。<br><br>如果两个对象之间不必彼此通信，那么这两个对象就不要发生直接的相互联系，常见的做法是引入一个第三者对象，来承担这些对象之间的通信作用。如果一些对象需要向另一些对象发送请求，可以通过第三者对象来转发这些请求。</p><h3 id="开放-封闭原则"><a href="#开放-封闭原则" class="headerlink" title="开放-封闭原则"></a>开放-封闭原则</h3><p>::: tip<br>开放-封闭原则(OCP)是最重要的一条原则，它的定义是：软件实体(类，模块，函数)等应该是可以扩展的，但是不可修改。<br>:::</p><h4 id="指导思想-1"><a href="#指导思想-1" class="headerlink" title="指导思想"></a>指导思想</h4><p>当需要改变一个程序的功能或者给这个程序增加新功能的时候，可以使用增加代码的方式，但是不允许改动程序的源代码。</p><h4 id="设计模式中的开放-封闭原则"><a href="#设计模式中的开放-封闭原则" class="headerlink" title="设计模式中的开放-封闭原则"></a>设计模式中的开放-封闭原则</h4><ol><li>发布-订阅模式</li><li>模板方法模式</li><li>策略模式</li><li>代理模式</li><li>职责连模式</li></ol><h3 id="代码重构"><a href="#代码重构" class="headerlink" title="代码重构"></a>代码重构</h3><p>::: tip<br>模式和重构之间有着一种与生俱来的关系，从某种角度来看，设计模式的目的就是为许多重构行为提供目标。<br>:::</p><h4 id="提炼函数"><a href="#提炼函数" class="headerlink" title="提炼函数"></a>提炼函数</h4><p>如果在函数中有一段代码可以被独立出来，那我们最好把这些代码放进另一个独立的函数中，这是一种很常见的优化工作，这样做的好处主要有以下几点：</p><ol><li>避免出现超大的函数</li><li>独立出来的函数有助于代码复用</li><li>独立出来的函数更容易被覆写。</li><li>独立出来的函数如果拥有一个良好的命名，它本身就起到了注释的作用。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提炼函数</span></span><br><span class="line"><span class="keyword">var</span> getUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ajax(<span class="string">'http://xxx.com/userInfo'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'userId:'</span> + data.userId);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'userName:'</span>+ data.userName);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'nickName:'</span>+data.nickName);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改写成</span></span><br><span class="line"><span class="keyword">var</span> getUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ajax(<span class="string">'http://xxx.com/userInfo'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    printDetails(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> printDetails = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'userId:'</span> + data.userId);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'userName:'</span>+ data.userName);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'nickName:'</span>+data.nickName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="合并重复的条件片段"><a href="#合并重复的条件片段" class="headerlink" title="合并重复的条件片段"></a>合并重复的条件片段</h4><p>如果一个函数体内有一些条件分支语句，而这些条件分支语句内部散步了一些重复的代码，那么就有必要进行合并去重工作。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> paging = <span class="function"><span class="keyword">function</span>(<span class="params">currPage</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(currPage&lt;<span class="number">0</span>) &#123;</span><br><span class="line">    currPage = <span class="number">0</span>;</span><br><span class="line">    jump(currPage);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(currPage &gt;= totalPage) &#123;</span><br><span class="line">    currPage = totalPage;</span><br><span class="line">    jump(currPage);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    jump(currPage);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改写成</span></span><br><span class="line"><span class="keyword">var</span> paging = <span class="function"><span class="keyword">function</span>(<span class="params">currPage</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(currPage&lt;<span class="number">0</span>) &#123;</span><br><span class="line">    currPage = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(currPage &gt;= totalPage) &#123;</span><br><span class="line">    currPage = totalPage;</span><br><span class="line">  &#125;</span><br><span class="line">  jump(currPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="把条件分支语句提炼成函数"><a href="#把条件分支语句提炼成函数" class="headerlink" title="把条件分支语句提炼成函数"></a>把条件分支语句提炼成函数</h4><p>在程序设计中，复杂的条件分支语句是导致程序难以阅读和理解的重要原因，而且容易导致一个庞大的函数。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据季节打折</span></span><br><span class="line"><span class="keyword">var</span> getPrice = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">if</span>(data.getMonth() &gt;=<span class="number">6</span> &amp;&amp; data.getMonth() &lt;= <span class="number">9</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> price * <span class="number">0.8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改写成</span></span><br><span class="line"><span class="keyword">var</span> isSummer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> data.getMonth() &gt;=<span class="number">6</span> &amp;&amp; data.getMonth() &lt;= <span class="number">9</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> getPrice = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(isSummer()) &#123;</span><br><span class="line">    <span class="keyword">return</span> price * <span class="number">0.8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="合理利用循环"><a href="#合理利用循环" class="headerlink" title="合理利用循环"></a>合理利用循环</h4><p>在函数体内，如果有些代码实际上负责的是一些重复性的工作，那么合理利用循环不仅可以完成同样的功能，还可以是代码量更少。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createXHR = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'MSXML2.XMLHttp.6.0'</span>);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'MSXML2.XMLHttp.3.0'</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'MSXML2.XMLHttp'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> xhr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改写成</span></span><br><span class="line"><span class="keyword">var</span> createXHR = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> versions = [<span class="string">'MSXML2.XMLHttp.6.0'</span>,<span class="string">'MSXML2.XMLHttp.3.0'</span>,<span class="string">'MSXML2.XMLHttp'</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>,version;version = version[i++];) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(version); </span><br><span class="line">    &#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="提前让函数退出代替嵌套条件分支"><a href="#提前让函数退出代替嵌套条件分支" class="headerlink" title="提前让函数退出代替嵌套条件分支"></a>提前让函数退出代替嵌套条件分支</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> del = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ret;</span><br><span class="line">  <span class="keyword">if</span>(!obj.isReadOnly) &#123;</span><br><span class="line">    <span class="keyword">if</span>(obj.isFolder) &#123;</span><br><span class="line">      ret = deleteFolder(obj);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(obj.isFile) &#123;</span><br><span class="line">      ret = deleteFile(obj);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改写成</span></span><br><span class="line"><span class="keyword">var</span> del = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(obj.isReadOnly) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(obj.isFolder) &#123;</span><br><span class="line">    <span class="keyword">return</span> deleteFolder(obj);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(obj.isFile) &#123;</span><br><span class="line">    <span class="keyword">return</span> deleteFile(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="传递对象参数代替过长的参数列表"><a href="#传递对象参数代替过长的参数列表" class="headerlink" title="传递对象参数代替过长的参数列表"></a>传递对象参数代替过长的参数列表</h4><p>有时候一个函数有可能接受多个参数，而参数的数量越多，函数就越难理解和使用。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> setUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params">id,name,address,sex,mobile,qq</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'id='</span>+id);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'name='</span>+name);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'address='</span>+address);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sex='</span>+sex);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'mobile='</span>+mobile);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'qq='</span>+qq);</span><br><span class="line">&#125;</span><br><span class="line">setUserInfo(<span class="number">1314</span>,<span class="string">'sven'</span>,<span class="string">'shenzhen'</span>,<span class="string">'male'</span>,<span class="string">'13886867272'</span>,<span class="string">'33223311'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改写成</span></span><br><span class="line"><span class="keyword">var</span> setUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params">userInfo</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'id='</span>+userInfo.id);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'name='</span>+userInfo.name);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'address='</span>+userInfo.address);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sex='</span>+userInfo.sex);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'mobile='</span>+userInfo.mobile);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'qq='</span>+userInfo.qq);</span><br><span class="line">&#125;</span><br><span class="line">setUserInfo(&#123;</span><br><span class="line">  id:<span class="number">1314</span>,</span><br><span class="line">  name:<span class="string">'sven'</span>,</span><br><span class="line">  address:<span class="string">'shenzhen'</span>,</span><br><span class="line">  sex:<span class="string">'male'</span>,</span><br><span class="line">  mobile:<span class="string">'13886867272'</span>,</span><br><span class="line">  qq:<span class="string">'33223311'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h4 id="合理使用链式调用"><a href="#合理使用链式调用" class="headerlink" title="合理使用链式调用"></a>合理使用链式调用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = &#123;</span><br><span class="line">  id: <span class="literal">null</span>,</span><br><span class="line">  name: <span class="literal">null</span>,</span><br><span class="line">  setId: <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  setName: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(User.setId(<span class="number">1314</span>).setName(<span class="string">'sven'</span>));</span><br></pre></td></tr></table></figure><p><strong>代码分析</strong>：链式调用的方式并不会造成太多阅读上的困难，也确实能省下一些字符和中间变量，但节省下来的字符数量同样是微不足道的。<br><br>链式调用带来的坏处就是在调试的时候非常不方便，如果有一条链有错误出现，必须得先把这条链拆开才能加上一些调试log或者断点，这样才能定位错误出现的地方。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js工具库licia（二）</title>
      <link href="/2022/02/17/js%E5%B7%A5%E5%85%B7%E5%BA%93licia%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2022/02/17/js%E5%B7%A5%E5%85%B7%E5%BA%93licia%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>licia使用文档(1.34.0)<br><a id="more"></a></p><h2 id><a href="#" class="headerlink" title="$"></a>$</h2><p>类似 jQuery 的 dom 操作库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace $ {<br>    class $ extends Select {<br>        find(selector: string): $;<br>        each(fn: types.AnyFn): $;<br>        offset(): $offset.IOffset;<br>        hide(): $;<br>        show(): $;<br>        first(): $;<br>        last(): $;<br>        get(index: number): Element;<br>        eq(index: number): $;<br>        on(event: string, selector: string, handler: types.AnyFn): $;<br>        on(event: string, handler: types.AnyFn): $;<br>        off(event: string, selector: string, handler: types.AnyFn): $;<br>        off(event: string, handler: types.AnyFn): $;<br>        html(): string;<br>        html(value: string): $;<br>        text(): string;<br>        text(value: string): $;<br>        val(): string;<br>        val(value: string): $;<br>        css(name: string): string;<br>        css(name: string, value: string): $;<br>        css(properties: types.PlainObj&lt;string | number&gt;): $;<br>        attr(name: string): string;<br>        attr(name: string, value: string): $;<br>        attr(attributes: types.PlainObj&lt;string&gt;): $;<br>        data(name: string): string;<br>        data(name: string, value: string): $;<br>        data(attributes: types.PlainObj&lt;string&gt;): $;<br>        rmAttr(name: string): $;<br>        remove(): $;<br>        addClass(name: string | string[]): $;<br>        rmClass(name: string): $;<br>        toggleClass(name: string): $;<br>        hasClass(name: string): boolean;<br>        parent(): $;<br>        append(content: string | Element): $;<br>        prepend(content: string | Element): $;<br>        before(content: string | Element): $;<br>        after(content: string | Element): $;<br>    }<br>}<br>declare function $(selector: string | Element | Document): $.$;</code><br></pre><br></details><h3 id="支持方法列表"><a href="#支持方法列表" class="headerlink" title="支持方法列表"></a>支持方法列表</h3><p>offset, hide, show, first, last, get, eq, on, off, html, text, val, css, attr,<br>data, rmAttr, remove, addClass, rmClass, toggleClass, hasClass, append, prepend,<br>before, after</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $btn = $(<span class="string">'#btn'</span>);</span><br><span class="line">$btn.html(<span class="string">'eustia'</span>);</span><br><span class="line">$btn.addClass(<span class="string">'btn'</span>);</span><br><span class="line">$btn.show();</span><br><span class="line">$btn.on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="attr"><a href="#attr" class="headerlink" title="$attr"></a>$attr</h2><p>操作元素属性。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace $attr {<br>    function remove(element: $safeEls.El, name: string): void;<br>}<br>function $attr(<br>    element: $safeEls.El,<br>    name: string,<br>    value: string<br>): void;<br>function $attr(<br>    element: $safeEls.El,<br>    attributes: types.PlainObj&lt;string&gt;<br>): void;<br>function $attr(element: $safeEls.El, name: string): string;</code><br></pre><br></details><p>获取元素集中第一个元素的指定属性值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>属性名</td></tr><tr><td>返回值</td><td>第一个元素的属性值</td></tr></tbody></table><p>设置元素集中一个或多个属性的值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>属性名</td></tr><tr><td>val</td><td>属性值</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>attributes</td><td>包含多个要设置属性-值对的对象</td></tr></tbody></table><h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><p>对元素集中的所有元素，移除指定的属性。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>属性名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$attr(<span class="string">'#test'</span>, <span class="string">'attr1'</span>, <span class="string">'test'</span>);</span><br><span class="line">$attr(<span class="string">'#test'</span>, <span class="string">'attr1'</span>); <span class="comment">// -&gt; test</span></span><br><span class="line">$attr.remove(<span class="string">'#test'</span>, <span class="string">'attr1'</span>);</span><br><span class="line">$attr(<span class="string">'#test'</span>, &#123;</span><br><span class="line">    attr1: <span class="string">'test'</span>,</span><br><span class="line">    attr2: <span class="string">'test'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="class"><a href="#class" class="headerlink" title="$class"></a>$class</h2><p>操作元素 class。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const $class: {<br>    add(element: $safeEls.El, name: string | string[]): void;<br>    has(element: $safeEls.El, name: string): boolean;<br>    toggle(element: $safeEls.El, name: string): void;<br>    remove(element: $safeEls.El, name: string): void;<br>};</code><br></pre><br></details><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><p>对元素集中的所有元素，添加指定的 class。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>names</td><td>添加的 class</td></tr></tbody></table><h3 id="has"><a href="#has" class="headerlink" title="has"></a>has</h3><p>判断元素集中是否有元素含有指定的 class。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>class 值</td></tr><tr><td>返回值</td><td>如果有，返回真</td></tr></tbody></table><h3 id="toggle"><a href="#toggle" class="headerlink" title="toggle"></a>toggle</h3><p>对于元素集中的每个元素，如果含有指定的 class 就将其删除，反之则添加。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>class 值</td></tr></tbody></table><h3 id="remove-1"><a href="#remove-1" class="headerlink" title="remove"></a>remove</h3><p>对于元素集中的所有元素，移除指定的 class。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>class 值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$<span class="class"><span class="keyword">class</span>.<span class="title">add</span>('#<span class="title">test</span>', '<span class="title">class1</span>')</span>;</span><br><span class="line">$class.add('#test', ['class1', 'class2']);</span><br><span class="line">$<span class="class"><span class="keyword">class</span>.<span class="title">has</span>('#<span class="title">test</span>', '<span class="title">class1</span>')</span>; <span class="comment">// -&gt; true</span></span><br><span class="line">$<span class="class"><span class="keyword">class</span>.<span class="title">remove</span>('#<span class="title">test</span>', '<span class="title">class1</span>')</span>;</span><br><span class="line">$<span class="class"><span class="keyword">class</span>.<span class="title">has</span>('#<span class="title">test</span>', '<span class="title">class1</span>')</span>; <span class="comment">// -&gt; false</span></span><br><span class="line">$<span class="class"><span class="keyword">class</span>.<span class="title">toggle</span>('#<span class="title">test</span>', '<span class="title">class1</span>')</span>;</span><br><span class="line">$<span class="class"><span class="keyword">class</span>.<span class="title">has</span>('#<span class="title">test</span>', '<span class="title">class1</span>')</span>; <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="css"><a href="#css" class="headerlink" title="$css"></a>$css</h2><p>操作元素样式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function $css(element: $safeEls.El, name: string): string;<br>function $css(<br>    element: $safeEls.El,<br>    name: string,<br>    val: string<br>): void;<br>function $css(<br>    element: $safeEls.El,<br>    properties: types.PlainObj&lt;string | number&gt;<br>): void;</code><br></pre><br></details><p>获取元素集中第一个元素的指定样式。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>样式名</td></tr><tr><td>返回值</td><td>样式值</td></tr></tbody></table><p>设置元素集中一个或多个样式的值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>name</td><td>样式名</td></tr><tr><td>val</td><td>样式值</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>properties</td><td>包含多个要设置样式-值对的对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$css(<span class="string">'#test'</span>, &#123;</span><br><span class="line">    color: <span class="string">'#fff'</span>,</span><br><span class="line">    background: <span class="string">'black'</span>,</span><br><span class="line">    opacity: <span class="number">0.5</span></span><br><span class="line">&#125;);</span><br><span class="line">$css(<span class="string">'#test'</span>, <span class="string">'display'</span>, <span class="string">'block'</span>);</span><br><span class="line">$css(<span class="string">'#test'</span>, <span class="string">'color'</span>); <span class="comment">// -&gt; #fff</span></span><br></pre></td></tr></table></figure><h2 id="data"><a href="#data" class="headerlink" title="$data"></a>$data</h2><p>同 $attr，自动给属性名加 data- 前缀。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function $data(<br>    element: $safeEls.El,<br>    name: string,<br>    value: string<br>): void;<br>function $data(<br>    element: $safeEls.El,<br>    attributes: types.PlainObj&lt;string&gt;<br>): void;<br>function $data(element: $safeEls.El, name: string): string;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data(<span class="string">'#test'</span>, <span class="string">'attr1'</span>, <span class="string">'eustia'</span>);</span><br></pre></td></tr></table></figure><h2 id="event"><a href="#event" class="headerlink" title="$event"></a>$event</h2><p>给指定 dom 元素绑定事件。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const $event: {<br>    on(<br>        element: $safeEls.El,<br>        event: string,<br>        selector: string,<br>        handler: types.AnyFn<br>    ): void;<br>    on(element: $safeEls.El, event: string, handler: types.AnyFn): void;<br>    off(<br>        element: $safeEls.El,<br>        event: string,<br>        selector: string,<br>        handler: types.AnyFn<br>    ): void;<br>    off(element: $safeEls.El, event: string, handler: types.AnyFn): void;<br>};</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickHandler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;</span><br><span class="line">$event.on(<span class="string">'#test'</span>, <span class="string">'click'</span>, clickHandler);</span><br><span class="line">$event.off(<span class="string">'#test'</span>, <span class="string">'click'</span>, clickHandler);</span><br></pre></td></tr></table></figure><h2 id="insert"><a href="#insert" class="headerlink" title="$insert"></a>$insert</h2><p>插入 html 到不同位置。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace $insert {<br>    type IInsert = (element: $safeEls.El, content: string | Element) =&gt; void;<br>}<br>const $insert: {<br>    before: $insert.IInsert;<br>    after: $insert.IInsert;<br>    append: $insert.IInsert;<br>    prepend: $insert.IInsert;<br>};</code><br></pre><br></details><h3 id="before"><a href="#before" class="headerlink" title="before"></a>before</h3><p>插入 html 到元素前。</p><h3 id="after"><a href="#after" class="headerlink" title="after"></a>after</h3><p>插入 html 到元素后。</p><h3 id="prepend"><a href="#prepend" class="headerlink" title="prepend"></a>prepend</h3><p>插入 html 到元素内部前。</p><h3 id="append"><a href="#append" class="headerlink" title="append"></a>append</h3><p>插入 html 到元素内部后。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>content</td><td>html 字符串或元素</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;div id="test"&gt;&lt;div class="mark"&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line">$insert.before(<span class="string">'#test'</span>, <span class="string">'&lt;div&gt;licia&lt;/div&gt;'</span>);</span><br><span class="line"><span class="comment">// -&gt; &lt;div&gt;licia&lt;/div&gt;&lt;div id="test"&gt;&lt;div class="mark"&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line">$insert.after(<span class="string">'#test'</span>, <span class="string">'&lt;div&gt;licia&lt;/div&gt;'</span>);</span><br><span class="line"><span class="comment">// -&gt; &lt;div id="test"&gt;&lt;div class="mark"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;licia&lt;/div&gt;</span></span><br><span class="line">$insert.prepend(<span class="string">'#test'</span>, <span class="string">'&lt;div&gt;licia&lt;/div&gt;'</span>);</span><br><span class="line"><span class="comment">// -&gt; &lt;div id="test"&gt;&lt;div&gt;licia&lt;/div&gt;&lt;div class="mark"&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line">$insert.append(<span class="string">'#test'</span>, <span class="string">'&lt;div&gt;licia&lt;/div&gt;'</span>);</span><br><span class="line"><span class="comment">// -&gt; &lt;div id="test"&gt;&lt;div class="mark"&gt;&lt;/div&gt;&lt;div&gt;licia&lt;/div&gt;&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><h2 id="offset"><a href="#offset" class="headerlink" title="$offset"></a>$offset</h2><p>获取元素在文档中的位置。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace $offset {<br>    interface IOffset {<br>        left: number;<br>        top: number;<br>        width: number;<br>        height: number;<br>    }<br>}<br>function $offset(element: $safeEls.El): $offset.IOffset;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr><tr><td>返回值</td><td>元素位置</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$offset(<span class="string">'#test'</span>); <span class="comment">// -&gt; &#123;left: 0, top: 0, width: 0, height: 0&#125;</span></span><br></pre></td></tr></table></figure><h2 id="property"><a href="#property" class="headerlink" title="$property"></a>$property</h2><p>设置或获取元素的 html， text，val 等值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace $property {<br>    interface IProperty {<br>        (element: $safeEls.El, value: string): void;<br>        (element: $safeEls.El): string;<br>    }<br>}<br>const $property: {<br>    html: $property.IProperty;<br>    val: $property.IProperty;<br>    text: $property.IProperty;<br>};</code><br></pre><br></details><h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><p>设置或获取元素的 html 值。</p><h3 id="text"><a href="#text" class="headerlink" title="text"></a>text</h3><p>设置或获取元素的 text 值。</p><h3 id="val"><a href="#val" class="headerlink" title="val"></a>val</h3><p>设置或获取元素的 val 值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$property.html(<span class="string">'#test'</span>, <span class="string">'licia'</span>);</span><br><span class="line">$property.html(<span class="string">'#test'</span>); <span class="comment">// -&gt; licia</span></span><br></pre></td></tr></table></figure><h2 id="remove-2"><a href="#remove-2" class="headerlink" title="$remove"></a>$remove</h2><p>移除指定元素集。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function $remove(element: $safeEls.El);</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$remove(<span class="string">'#test'</span>);</span><br></pre></td></tr></table></figure><h2 id="safeEls"><a href="#safeEls" class="headerlink" title="$safeEls"></a>$safeEls</h2><p>将值转换为数组，如果值为字符串，使用 querySelector 获取元素集。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace $safeEls {<br>    type El = Element | Element[] | NodeListOf&lt;Element&gt; | string;<br>}<br>function $safeEls(val: $safeEls.El): Element[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>元素集</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$safeEls(<span class="built_in">document</span>.querySelector(<span class="string">'.test'</span>));</span><br><span class="line">$safeEls(<span class="built_in">document</span>.querySelectorAll(<span class="string">'.test'</span>));</span><br><span class="line">$safeEls(<span class="string">'.test'</span>); <span class="comment">// -&gt; Array of elements with test class</span></span><br></pre></td></tr></table></figure><h2 id="show"><a href="#show" class="headerlink" title="$show"></a>$show</h2><p>显示元素。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function $show(element: $safeEls.El): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>目标元素集</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$show(<span class="string">'#test'</span>);</span><br></pre></td></tr></table></figure><h2 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h2><p>JavaScript 基准测试。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace Benchmark {<br>    interface IOptions {<br>        minTime?: number;<br>        maxTime?: number;<br>        minSamples?: number;<br>        delay?: number;<br>        name?: string;<br>    }<br>    interface IResult {<br>        name: string;<br>        mean: number;<br>        variance: number;<br>        deviation: number;<br>        sem: number;<br>        moe: number;<br>        rme: number;<br>        hz: number;<br>        sample: number[];<br>    }<br>}<br>class Benchmark {<br>    constructor(fn: types.AnyFn, options?: Benchmark.IOptions);<br>    run(): Promise&lt;Benchmark.IResult&gt;;<br>    static all(<br>        benches: Array&lt;types.AnyFn | Benchmark&gt;,<br>        options?: Benchmark.IOptions<br>    ): Promise&lt;Benchmark.IResult[]&gt;;<br>}</code><br></pre><br></details><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>要测试的代码</td></tr><tr><td>options</td><td>测试选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>minTime=50</td><td>用于减少误差的时间</td></tr><tr><td>maxTime=5000</td><td>测试运行最大时间</td></tr><tr><td>minSamples=5</td><td>最小样本数量</td></tr><tr><td>delay=5</td><td>测试周期间隔</td></tr><tr><td>name</td><td>测试名称</td></tr></tbody></table><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>运行基准测试，返回 promise。</p><h3 id="all"><a href="#all" class="headerlink" title="all"></a>all</h3><p>[static] 运行多个基准测试。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> benchmark = <span class="keyword">new</span> Benchmark(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        !!<span class="string">'Hello World!'</span>.match(<span class="regexp">/o/</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        maxTime: <span class="number">1500</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line">benchmark.run().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">String</span>(result));</span><br><span class="line">&#125;);</span><br><span class="line">Benchmark.all([</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">regExp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        /o/.test(<span class="string">'Hello World!'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">indexOf</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="string">'Hello World!'</span>.indexOf(<span class="string">'o'</span>) &gt; <span class="number">-1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">match</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        !!<span class="string">'Hello World!'</span>.match(<span class="regexp">/o/</span>);</span><br><span class="line">    &#125;</span><br><span class="line">]).then(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">String</span>(results));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Blob"><a href="#Blob" class="headerlink" title="Blob"></a>Blob</h2><p>如果支持 Blob，直接返回 Blob，否则使用 BlobBuilder 进行兼容。</p><h3 id="constructor"><a href="#constructor" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>parts</td><td>Blob 分片</td></tr><tr><td>options</td><td>选项</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([]);</span><br></pre></td></tr></table></figure><h2 id="BloomFilter"><a href="#BloomFilter" class="headerlink" title="BloomFilter"></a>BloomFilter</h2><p>布隆过滤器实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class BloomFilter {<br>    constructor(size?: number, k?: number);<br>    add(val: string): void;<br>    test(val: string): boolean;<br>}</code><br></pre><br></details><h3 id="constructor-1"><a href="#constructor-1" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>size=1024</td><td>桶数目</td></tr><tr><td>k=3</td><td>哈希函数数目</td></tr></tbody></table><h3 id="add-1"><a href="#add-1" class="headerlink" title="add"></a>add</h3><p>添加元素。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要加的值</td></tr></tbody></table><h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><p>检测元素是否在过滤器中。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果可能在返回真，如果绝对不在返回假</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bloom = <span class="keyword">new</span> BloomFilter(<span class="number">256</span>, <span class="number">3</span>);</span><br><span class="line">bloom.add(<span class="string">'Bruce Wayne'</span>);</span><br><span class="line">bloom.add(<span class="string">'Clark Kent'</span>);</span><br><span class="line">bloom.test(<span class="string">'Clark Kent'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">bloom.test(<span class="string">'Bruce Wayne'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">bloom.test(<span class="string">'Tony Stark'</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="Caseless"><a href="#Caseless" class="headerlink" title="Caseless"></a>Caseless</h2><p>修复对象的属性值时，无需关心键值的大小写情况。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Caseless {<br>    constructor(obj: any);<br>    getKey(key: string): string | void;<br>    set(key: string, val: any): void;<br>    get(key: string): any;<br>    remove(key: string): void;<br>    has(key: string): boolean;<br>}</code><br></pre><br></details><h3 id="constructor-2"><a href="#constructor-2" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr></tbody></table><h3 id="getKey"><a href="#getKey" class="headerlink" title="getKey"></a>getKey</h3><p>获取原始键值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>不区分大小写的键名</td></tr><tr><td>返回值</td><td>原始键值</td></tr></tbody></table><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>设置值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>不区分大小写的键名</td></tr><tr><td>val</td><td>要设置的值</td></tr></tbody></table><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p>获取值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>不区分大小写的键名</td></tr><tr><td>返回值</td><td>键值</td></tr></tbody></table><h3 id="remove-3"><a href="#remove-3" class="headerlink" title="remove"></a>remove</h3><p>移除值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>不区分大小写的键名</td></tr></tbody></table><h3 id="has-1"><a href="#has-1" class="headerlink" title="has"></a>has</h3><p>判断是否存在给定的键名。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>不区分大小写的键名</td></tr><tr><td>返回值</td><td>如果有，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> headers = &#123; <span class="string">'Content-Type'</span>: <span class="string">'text/javascript'</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> Caseless(headers);</span><br><span class="line">c.set(<span class="string">'content-type'</span>, <span class="string">'text/css'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(headers); <span class="comment">// -&gt; &#123; 'Content-Type': 'text/css' &#125;</span></span><br><span class="line">c.getKey(<span class="string">'content-type'</span>); <span class="comment">// -&gt; 'Content-Type'</span></span><br><span class="line">c.remove(<span class="string">'content-type'</span>);</span><br><span class="line">c.has(<span class="string">'content-type'</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><p>创建 JavaScript 类。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace Class {<br>    class Base {<br>        toString(): string;<br>    }<br>    class IConstructor extends Base {<br>        constructor(…args: any[]);<br>        static extend(methods: any, statics: any): IConstructor;<br>        static inherits(Class: types.AnyFn): void;<br>        static methods(methods: any): IConstructor;<br>        static statics(statics: any): IConstructor;<br>        [method: string]: any;<br>    }<br>}<br>function Class(methods: any, statics?: any): Class.IConstructor;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>methods</td><td>公有方法</td></tr><tr><td>statics</td><td>静态方法</td></tr><tr><td>返回值</td><td>用于创建实例的函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> People = Class(&#123;</span><br><span class="line">    initialize: <span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;,</span><br><span class="line">    introduce: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'I am '</span> + <span class="keyword">this</span>.name + <span class="string">', '</span> + <span class="keyword">this</span>.age + <span class="string">' years old.'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Student = People.extend(</span><br><span class="line">    &#123;</span><br><span class="line">        initialize: <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, school</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.callSuper(People, <span class="string">'initialize'</span>, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.school = school;</span><br><span class="line">        &#125;,</span><br><span class="line">        introduce: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="keyword">this</span>.callSuper(People, <span class="string">'introduce'</span>) +</span><br><span class="line">                <span class="string">'\n I study at '</span> +</span><br><span class="line">                <span class="keyword">this</span>.school +</span><br><span class="line">                <span class="string">'.'</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        is: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> obj <span class="keyword">instanceof</span> Student;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Student(<span class="string">'allen'</span>, <span class="number">17</span>, <span class="string">'Hogwarts'</span>);</span><br><span class="line">a.introduce(); <span class="comment">// -&gt; 'I am allen, 17 years old. \n I study at Hogwarts.'</span></span><br><span class="line">Student.is(a); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="Color"><a href="#Color" class="headerlink" title="Color"></a>Color</h2><p>颜色转换。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace Color {<br>    interface IColor {<br>        val: number[];<br>        model: string;<br>    }<br>}<br>class Color {<br>    constructor(color: string | Color.IColor);<br>    toRgb(): string;<br>    toHex(): string;<br>    toHsl(): string;<br>    static parse(colorStr: string): Color.IColor;<br>}</code><br></pre><br></details><h3 id="constructor-3"><a href="#constructor-3" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>color</td><td>要转换的颜色</td></tr></tbody></table><h3 id="toRgb"><a href="#toRgb" class="headerlink" title="toRgb"></a>toRgb</h3><p>获取颜色 rgb 格式。</p><h3 id="toHex"><a href="#toHex" class="headerlink" title="toHex"></a>toHex</h3><p>获取颜色十六进制格式。</p><h3 id="toHsl"><a href="#toHsl" class="headerlink" title="toHsl"></a>toHsl</h3><p>获取颜色 hsl 格式。</p><h3 id="parse"><a href="#parse" class="headerlink" title="parse"></a>parse</h3><p>【静态】将颜色字符串转换为含有值及颜色模型的对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>color</td><td>颜色字符串</td></tr><tr><td>返回值</td><td>含有值及颜色模型的对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Color.parse(<span class="string">'rgb(170, 287, 204, 0.5)'</span>); <span class="comment">// -&gt; &#123;val: [170, 187, 204, 0.5], model: 'rgb'&#125;</span></span><br><span class="line"><span class="keyword">const</span> color = <span class="keyword">new</span> Color(<span class="string">'#abc'</span>);</span><br><span class="line">color.toRgb(); <span class="comment">// -&gt; 'rgb(170, 187, 204)'</span></span><br><span class="line">color.toHsl(); <span class="comment">// -&gt; 'hsl(210, 25%, 73%)'</span></span><br></pre></td></tr></table></figure><h2 id="Delegator"><a href="#Delegator" class="headerlink" title="Delegator"></a>Delegator</h2><p>对象委托。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Delegator {<br>    constructor(host: object, target: object | string);<br>    method(name: string, target?: string): Delegator;<br>    getter(name: string, target?: string): Delegator;<br>    setter(name: string, target?: string): Delegator;<br>    access(name: string, target?: string): Delegator;<br>}</code><br></pre><br></details><h3 id="constructor-4"><a href="#constructor-4" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>host</td><td>宿主对象</td></tr><tr><td>target</td><td>委托目标</td></tr></tbody></table><h3 id="method"><a href="#method" class="headerlink" title="method"></a>method</h3><p>允许在宿主对象上访问目标方法。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>宿主方法名</td></tr><tr><td>target=name</td><td>目标方法名</td></tr></tbody></table><h3 id="getter"><a href="#getter" class="headerlink" title="getter"></a>getter</h3><p>创建 getter。</p><h3 id="setter"><a href="#setter" class="headerlink" title="setter"></a>setter</h3><p>创建 setter。</p><h3 id="access"><a href="#access" class="headerlink" title="access"></a>access</h3><p>创建 accessor，效果等于同时调用 setter 和 getter。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> host = &#123;</span><br><span class="line">    target: &#123;</span><br><span class="line">        a() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'a'</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        b: <span class="string">'b'</span>,</span><br><span class="line">        c: <span class="string">'c'</span>,</span><br><span class="line">        d: <span class="string">'d'</span>,</span><br><span class="line">        e() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'e'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> delegator = <span class="keyword">new</span> Delegator(host, <span class="string">'target'</span>);</span><br><span class="line">delegator</span><br><span class="line">    .method(<span class="string">'a'</span>)</span><br><span class="line">    .getter(<span class="string">'b'</span>)</span><br><span class="line">    .setter(<span class="string">'c'</span>)</span><br><span class="line">    .access(<span class="string">'d'</span>);</span><br><span class="line">host.a(); <span class="comment">// -&gt; 'a'</span></span><br><span class="line">host.b; <span class="comment">// -&gt; 'b'</span></span><br><span class="line">host.c = <span class="number">5</span>;</span><br><span class="line">host.target.c; <span class="comment">// -&gt; 5</span></span><br><span class="line">host.d; <span class="comment">// -&gt; 'd'</span></span><br><span class="line">host.d = <span class="number">5</span>;</span><br><span class="line">host.d; <span class="comment">// -&gt; 5</span></span><br></pre></td></tr></table></figure><h2 id="Dispatcher"><a href="#Dispatcher" class="headerlink" title="Dispatcher"></a>Dispatcher</h2><p>Flux 调度器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Dispatcher {<br>    dispatch(payload: any);<br>    register(cb: types.AnyFn): void;<br>    waitFor(ids: string[]): void;<br>    unregister(id: string): void;<br>    isDispatching(): boolean;<br>}</code><br></pre><br></details><p><a href="https://facebook.github.io/flux/docs/dispatcher.html" target="_blank" rel="noopener">相关文档</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dispatcher = <span class="keyword">new</span> Dispatcher();</span><br><span class="line"></span><br><span class="line">dispatcher.register(<span class="function"><span class="keyword">function</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (</span><br><span class="line">        payload.actionType</span><br><span class="line">        <span class="comment">// Do something</span></span><br><span class="line">    ) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatcher.dispatch(&#123;</span><br><span class="line">    actionType: <span class="string">'action'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Emitter"><a href="#Emitter" class="headerlink" title="Emitter"></a>Emitter</h2><p>提供观察者模式的 Event emitter 类。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Emitter {<br>    on(event: string, listener: types.AnyFn): Emitter;<br>    off(event: string, listener: types.AnyFn): Emitter;<br>    once(event: string, listener: types.AnyFn): Emitter;<br>    emit(event: string, …args: any[]): Emitter;<br>    removeAllListeners(event?: string): Emitter;<br>    static mixin(obj: any): any;<br>}</code><br></pre><br></details><h3 id="on"><a href="#on" class="headerlink" title="on"></a>on</h3><p>绑定事件。</p><h3 id="off"><a href="#off" class="headerlink" title="off"></a>off</h3><p>解绑事件。</p><h3 id="once"><a href="#once" class="headerlink" title="once"></a>once</h3><p>绑定只触发一次的事件。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>event</td><td>事件名称</td></tr><tr><td>listener</td><td>事件监听器</td></tr></tbody></table><h3 id="emit"><a href="#emit" class="headerlink" title="emit"></a>emit</h3><p>触发事件。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>event</td><td>事件名称</td></tr><tr><td>…args</td><td>传递给监听器的参数</td></tr></tbody></table><h3 id="removeAllListeners"><a href="#removeAllListeners" class="headerlink" title="removeAllListeners"></a>removeAllListeners</h3><p>解绑所有事件。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>event</td><td>事件名称</td></tr></tbody></table><h3 id="mixin"><a href="#mixin" class="headerlink" title="mixin"></a>mixin</h3><p>【静态】 将 Emitter 类的方法绑定到指定对象上去。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> Emitter();</span><br><span class="line">event.on(<span class="string">'test'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;);</span><br><span class="line">event.emit(<span class="string">'test'</span>, <span class="string">'licia'</span>); <span class="comment">// Logs out 'licia'.</span></span><br><span class="line">Emitter.mixin(&#123;&#125;);</span><br></pre></td></tr></table></figure><h2 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h2><p>Enum 类实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Enum {<br>    size: number;<br>    constructor(map: string[] | { [member: string]: any });<br>    [key: string]: any;<br>}</code><br></pre><br></details><h3 id="constructor-5"><a href="#constructor-5" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>字符串数组</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>键值对</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importance = <span class="keyword">new</span> Enum([</span><br><span class="line">    <span class="string">'NONE'</span>,</span><br><span class="line">    <span class="string">'TRIVIAL'</span>,</span><br><span class="line">    <span class="string">'REGULAR'</span>,</span><br><span class="line">    <span class="string">'IMPORTANT'</span>,</span><br><span class="line">    <span class="string">'CRITICAL'</span></span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> val = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (val === importance.CRITICAL) &#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="FileBlobStore"><a href="#FileBlobStore" class="headerlink" title="FileBlobStore"></a>FileBlobStore</h2><p>二进制文件存储。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class FileBlobStore extends Emitter {<br>    constructor(path: string, data?: types.PlainObj&lt;Buffer&gt;);<br>    set(key: string, buf: Buffer): void;<br>    set(values: types.PlainObj&lt;Buffer&gt;): void;<br>    get(key: string): Buffer | void;<br>    get(keys: string[]): types.PlainObj&lt;Buffer&gt;;<br>    remove(key: string): void;<br>    remove(keys: string[]): void;<br>    clear(): void;<br>    each(fn: (val: Buffer, key: string) =&gt; void): void;<br>    save(): void;<br>}</code><br></pre><br></details><p>API 基本与 Store 模块一致，主要不同点是只接收 Buffer 类型。</p><h3 id="save"><a href="#save" class="headerlink" title="save"></a>save</h3><p>保存内容到磁盘。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> FileBlobStore(<span class="string">'path/to/file'</span>);</span><br><span class="line">store.set(<span class="string">'name'</span>, Buffer.from(<span class="string">'licia'</span>));</span><br><span class="line">process.on(<span class="string">'exit'</span>, () =&gt; store.save());</span><br></pre></td></tr></table></figure><h2 id="FileStore"><a href="#FileStore" class="headerlink" title="FileStore"></a>FileStore</h2><h3 id="constructor-6"><a href="#constructor-6" class="headerlink" title="constructor"></a>constructor</h3><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class FileStore extends Store {<br>    constructor(path: string, data?: any);<br>}</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>存储文件路径</td></tr><tr><td>data</td><td>默认数据</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> FileStore(<span class="string">'path/to/file'</span>);</span><br><span class="line">store.set(<span class="string">'name'</span>, <span class="string">'licia'</span>);</span><br></pre></td></tr></table></figure><h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><p>哈希表实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class HashTable {<br>    constructor(size?: number);<br>    set(key: string, val: any): void;<br>    get(key: string): any;<br>    has(key: string): boolean;<br>    delete(key: string): void;<br>}</code><br></pre><br></details><h3 id="constructor-7"><a href="#constructor-7" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>size=32</td><td>桶数目</td></tr></tbody></table><h3 id="set-1"><a href="#set-1" class="headerlink" title="set"></a>set</h3><p>设置值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>键名</td></tr><tr><td>val</td><td>键值</td></tr></tbody></table><h3 id="get-1"><a href="#get-1" class="headerlink" title="get"></a>get</h3><p>获取值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>键名</td></tr><tr><td>返回值</td><td>键值</td></tr></tbody></table><h3 id="has-2"><a href="#has-2" class="headerlink" title="has"></a>has</h3><p>检查是否有指定值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>键名</td></tr><tr><td>返回值</td><td>如果值存在，返回真</td></tr></tbody></table><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p>删除值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hashTable = <span class="keyword">new</span> HashTable(<span class="number">128</span>);</span><br><span class="line">hashTable.set(<span class="string">'name'</span>, <span class="string">'redhoodsu'</span>);</span><br><span class="line">hashTable.get(<span class="string">'name'</span>); <span class="comment">// -&gt; 'redhoodsu'</span></span><br><span class="line">hashTable.has(<span class="string">'name'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">hashTable.delete(<span class="string">'name'</span>);</span><br><span class="line">hashTable.has(<span class="string">'name'</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h2><p>堆实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Heap {<br>    size: number;<br>    constructor(cmp?: types.AnyFn);<br>    clear(): void;<br>    add(item: any): number;<br>    poll(): any;<br>    peek(): any;<br>}</code><br></pre><br></details><h3 id="size"><a href="#size" class="headerlink" title="size"></a>size</h3><p>堆大小。</p><h3 id="constructor-8"><a href="#constructor-8" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>cmp</td><td>比较器</td></tr></tbody></table><h3 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h3><p>清空堆数据。</p><h3 id="add-2"><a href="#add-2" class="headerlink" title="add"></a>add</h3><p>往堆里添加元素。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>item</td><td>入堆元素</td></tr><tr><td>返回值</td><td>当前大小</td></tr></tbody></table><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><p>获取并删除堆的根元素。</p><h3 id="peek"><a href="#peek" class="headerlink" title="peek"></a>peek</h3><p>与 poll 一样，只是不删除。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> heap = <span class="keyword">new</span> Heap(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b - a;</span><br><span class="line">&#125;);</span><br><span class="line">heap.add(<span class="number">2</span>);</span><br><span class="line">heap.add(<span class="number">1</span>);</span><br><span class="line">heap.add(<span class="number">4</span>);</span><br><span class="line">heap.add(<span class="number">5</span>);</span><br><span class="line">heap.poll(); <span class="comment">// -&gt; 5</span></span><br><span class="line"><span class="built_in">console</span>.log(heap.size); <span class="comment">// -&gt; 4</span></span><br></pre></td></tr></table></figure><h2 id="HeapSnapshot"><a href="#HeapSnapshot" class="headerlink" title="HeapSnapshot"></a>HeapSnapshot</h2><p>V8 内存快照操作库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class HeapSnapshot {<br>    nodes: LinkedList;<br>    edges: LinkedList;<br>    constructor(profile: any);<br>}</code><br></pre><br></details><h3 id="constructor-9"><a href="#constructor-9" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>profile</td><td>要解析的内存快照</td></tr></tbody></table><h3 id="nodes"><a href="#nodes" class="headerlink" title="nodes"></a>nodes</h3><p>解析后的节点信息。</p><h3 id="edges"><a href="#edges" class="headerlink" title="edges"></a>edges</h3><p>解析后的边信息。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> data = fs.readFileSync(<span class="string">'path/to/heapsnapshot'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="keyword">const</span> heapSnapshot = <span class="keyword">new</span> HeapSnapshot(data);</span><br><span class="line"><span class="keyword">let</span> totalSize = <span class="number">0</span>;</span><br><span class="line">heapSnapshot.nodes.forEach(<span class="function"><span class="params">node</span> =&gt;</span> (totalSize += node.selfSize));</span><br><span class="line"><span class="built_in">console</span>.log(totalSize);</span><br></pre></td></tr></table></figure><h2 id="I18n"><a href="#I18n" class="headerlink" title="I18n"></a>I18n</h2><p>简单国际化库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class I18n {<br>    constructor(locale: string, langs: types.PlainObj&lt;any&gt;);<br>    set(locale: string, lang: types.PlainObj&lt;any&gt;): void;<br>    t(path: string | string[], data?: types.PlainObj&lt;any&gt;): string;<br>    locale(locale: string): void;<br>}</code><br></pre><br></details><h3 id="constructor-10"><a href="#constructor-10" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>locale</td><td>地区代码</td></tr><tr><td>langs</td><td>语言数据</td></tr></tbody></table><h3 id="set-2"><a href="#set-2" class="headerlink" title="set"></a>set</h3><p>添加语言或者向已有的语言新增键值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>locale</td><td>地区代码</td></tr><tr><td>lang</td><td>语言数据</td></tr></tbody></table><h3 id="locale"><a href="#locale" class="headerlink" title="locale"></a>locale</h3><p>设置当前地区。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>locale</td><td>地区代码</td></tr></tbody></table><h3 id="t"><a href="#t" class="headerlink" title="t"></a>t</h3><p>获取翻译文本。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>要获取文本的键值</td></tr><tr><td>data</td><td>要传递的数据</td></tr><tr><td>返回值</td><td>翻译文本</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> i18n = <span class="keyword">new</span> I18n(<span class="string">'en'</span>, &#123;</span><br><span class="line">    en: &#123;</span><br><span class="line">        welcome: <span class="string">'Hello, &#123;&#123;name&#125;&#125;!'</span>,</span><br><span class="line">        curTime(data) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'Current time is '</span> + data.time;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    cn: &#123;</span><br><span class="line">        welcome: <span class="string">'你好，&#123;&#123;name&#125;&#125;！'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">i18n.set(<span class="string">'cn'</span>, &#123;</span><br><span class="line">    curTime(data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'当前时间是 '</span> + data.time;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">i18n.t(<span class="string">'welcome'</span>, &#123; <span class="attr">name</span>: <span class="string">'licia'</span> &#125;); <span class="comment">// -&gt; 'Hello, licia!'</span></span><br><span class="line">i18n.locale(<span class="string">'cn'</span>);</span><br><span class="line">i18n.t(<span class="string">'curTime'</span>, &#123; <span class="attr">time</span>: <span class="string">'5:47 pm'</span> &#125;); <span class="comment">// -&gt; '当前时间是 5:47 pm'</span></span><br></pre></td></tr></table></figure><h2 id="JsonTransformer"><a href="#JsonTransformer" class="headerlink" title="JsonTransformer"></a>JsonTransformer</h2><p>JSON 转换器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class JsonTransformer {<br>    constructor(data: any);<br>    set(key: string, val: any): JsonTransformer;<br>    get(key?: string): any;<br>    map(from: string, to: string, fn: types.AnyFn): JsonTransformer;<br>    map(from: string, fn: types.AnyFn): JsonTransformer;<br>    filter(from: string, to: string, fn: types.AnyFn): JsonTransformer;<br>    filter(from: string, fn: types.AnyFn): JsonTransformer;<br>    remove(keys: string | string[]): JsonTransformer;<br>    compute(<br>        from: string | string[],<br>        to: string,<br>        fn: types.AnyFn<br>    ): JsonTransformer;<br>    compute(from: string, fn: types.AnyFn): JsonTransformer;<br>    toString(): string;<br>}</code><br></pre><br></details><h3 id="constructor-11"><a href="#constructor-11" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>data={}</td><td>目标 JSON 对象</td></tr></tbody></table><h3 id="set-3"><a href="#set-3" class="headerlink" title="set"></a>set</h3><p>设置属性值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>属性路径</td></tr><tr><td>val</td><td>值</td></tr></tbody></table><p>如果属性路径为空，整个对象将被值替换。</p><h3 id="get-2"><a href="#get-2" class="headerlink" title="get"></a>get</h3><p>获取属性值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>属性路径</td></tr><tr><td>返回值</td><td>指定值或整个对象</td></tr></tbody></table><h3 id="remove-4"><a href="#remove-4" class="headerlink" title="remove"></a>remove</h3><p>移除属性值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>属性路径</td></tr></tbody></table><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>数组 map 的快捷方式。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>from</td><td>源对象路径</td></tr><tr><td>to</td><td>目标对象路径</td></tr><tr><td>fn</td><td>真值检测函数</td></tr></tbody></table><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>数组 filter 的快捷方式。</p><h3 id="compute"><a href="#compute" class="headerlink" title="compute"></a>compute</h3><p>从多个属性值计算新值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>from</td><td>源属性路径</td></tr><tr><td>to</td><td>目标属性路径</td></tr><tr><td>fn</td><td>计算函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="keyword">new</span> JsonTransformer(&#123;</span><br><span class="line">    books: [</span><br><span class="line">        &#123;</span><br><span class="line">            title: <span class="string">'Book 1'</span>,</span><br><span class="line">            price: <span class="number">5</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            title: <span class="string">'Book 2'</span>,</span><br><span class="line">            price: <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    author: &#123;</span><br><span class="line">        lastname: <span class="string">'Su'</span>,</span><br><span class="line">        firstname: <span class="string">'RedHood'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">data.filter(<span class="string">'books'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">book</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> book.price &gt; <span class="number">5</span>;</span><br><span class="line">&#125;);</span><br><span class="line">data.compute(<span class="string">'author'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">author</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> author.firstname + author.lastname;</span><br><span class="line">&#125;);</span><br><span class="line">data.set(<span class="string">'count'</span>, data.get(<span class="string">'books'</span>).length);</span><br><span class="line">data.get(); <span class="comment">// -&gt; &#123;books: [&#123;title: 'Book 2', price: 10&#125;], author: 'RedHoodSu', count: 1&#125;</span></span><br></pre></td></tr></table></figure><h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><p>双向链表实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace LinkedList {<br>    class Node {<br>        value: any;<br>        prev: Node | null;<br>        next: Node | null;<br>    }<br>}<br>class LinkedList {<br>    size: number;<br>    head: LinkedList.Node;<br>    tail: LinkedList.Node;<br>    push(val: any): number;<br>    pop(): any;<br>    unshift(val: any): number;<br>    shift(): any;<br>    find(fn: types.AnyFn): LinkedList.Node | void;<br>    delNode(node: LinkedList.Node): void;<br>    forEach(iterator: types.AnyFn, ctx?: any);<br>    toArr(): any[];<br>}</code><br></pre><br></details><h3 id="size-1"><a href="#size-1" class="headerlink" title="size"></a>size</h3><p>链表大小。</p><h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>链表首结点。</p><h3 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h3><p>链表尾结点。</p><h3 id="push"><a href="#push" class="headerlink" title="push"></a>push</h3><p>向链表尾部添加值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要添加的值</td></tr><tr><td>返回值</td><td>链表大小</td></tr></tbody></table><h3 id="pop"><a href="#pop" class="headerlink" title="pop"></a>pop</h3><p>获取链表尾部值。</p><h3 id="unshift"><a href="#unshift" class="headerlink" title="unshift"></a>unshift</h3><p>向链表头部添加值。</p><h3 id="shift"><a href="#shift" class="headerlink" title="shift"></a>shift</h3><p>获取链表头部值。</p><h3 id="rmNode"><a href="#rmNode" class="headerlink" title="rmNode"></a>rmNode</h3><p>删除节点。</p><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><p>查找节点。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>真值检测函数</td></tr><tr><td>返回值</td><td>第一个通过的节点</td></tr></tbody></table><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><p>遍历链表。</p><h3 id="toArr"><a href="#toArr" class="headerlink" title="toArr"></a>toArr</h3><p>将链表转换成 JavaScript 数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> linkedList = <span class="keyword">new</span> LinkedList();</span><br><span class="line">linkedList.push(<span class="number">5</span>);</span><br><span class="line">linkedList.pop(); <span class="comment">// -&gt; 5</span></span><br></pre></td></tr></table></figure><h2 id="LocalStore"><a href="#LocalStore" class="headerlink" title="LocalStore"></a>LocalStore</h2><p>LocalStorage 存储。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class LocalStore extends Store {<br>    constructor(name: string, data?: {});<br>}</code><br></pre><br></details><p>继承自 Store 类。</p><h3 id="constructor-12"><a href="#constructor-12" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>LocalStorage 存储名</td></tr><tr><td>data</td><td>默认数据</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> LocalStore(<span class="string">'licia'</span>);</span><br><span class="line">store.set(<span class="string">'name'</span>, <span class="string">'licia'</span>);</span><br></pre></td></tr></table></figure><h2 id="Logger"><a href="#Logger" class="headerlink" title="Logger"></a>Logger</h2><p>带日志级别的简单日志库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Logger extends Emitter {<br>    name: string;<br>    formatter(type: string, argList: any[]): any[];<br>    constructor(name: string, level?: string | number);<br>    setLevel(level: string | number): Logger;<br>    getLevel(): number;<br>    trace(…args: any[]): Logger;<br>    debug(…args: any[]): Logger;<br>    info(…args: any[]): Logger;<br>    warn(…args: any[]): Logger;<br>    error(…args: any[]): Logger;<br>    static level: Enum;<br>}</code><br></pre><br></details><h3 id="constructor-13"><a href="#constructor-13" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>日志名称</td></tr><tr><td>level=DEBUG</td><td>日志级别</td></tr></tbody></table><h3 id="setLevel"><a href="#setLevel" class="headerlink" title="setLevel"></a>setLevel</h3><p>设置日志级别。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>level</td><td>日志级别</td></tr></tbody></table><h3 id="getLevel"><a href="#getLevel" class="headerlink" title="getLevel"></a>getLevel</h3><p>获取当前日志级别。</p><h3 id="trace，debug，info，warn，error"><a href="#trace，debug，info，warn，error" class="headerlink" title="trace，debug，info，warn，error"></a>trace，debug，info，warn，error</h3><p>打日志方法。</p><h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><p>TRACE，DEBUG，INFO，WARN，ERROR 和 SILENT。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="keyword">new</span> Logger(<span class="string">'licia'</span>, Logger.level.ERROR);</span><br><span class="line">logger.trace(<span class="string">'test'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Format output.</span></span><br><span class="line">logger.formatter = <span class="function"><span class="keyword">function</span>(<span class="params">type, argList</span>) </span>&#123;</span><br><span class="line">    argList.push(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> argList;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logger.on(<span class="string">'all'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">type, argList</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// It's not affected by log level.</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">logger.on(<span class="string">'debug'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">argList</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Affected by log level.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Lru"><a href="#Lru" class="headerlink" title="Lru"></a>Lru</h2><p>简单 LRU 缓存。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Lru {<br>    constructor(max: number);<br>    has(key: string): boolean;<br>    remove(key: string): void;<br>    get(key: string): any;<br>    set(key: string, val: any): void;<br>    clear(): void;<br>}</code><br></pre><br></details><h3 id="constructor-14"><a href="#constructor-14" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>max</td><td>最大缓存数</td></tr></tbody></table><h3 id="has-3"><a href="#has-3" class="headerlink" title="has"></a>has</h3><p>检查是否有缓存。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>缓存键名</td></tr><tr><td>返回值</td><td>如果有，返回真</td></tr></tbody></table><h3 id="remove-5"><a href="#remove-5" class="headerlink" title="remove"></a>remove</h3><p>删除缓存。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>缓存键名</td></tr></tbody></table><h3 id="get-3"><a href="#get-3" class="headerlink" title="get"></a>get</h3><p>获取缓存。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>缓存键名</td></tr><tr><td>返回值</td><td>缓存值</td></tr></tbody></table><h3 id="set-4"><a href="#set-4" class="headerlink" title="set"></a>set</h3><p>设置缓存。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>缓存键名</td></tr><tr><td>val</td><td>缓存值</td></tr></tbody></table><h3 id="clear-1"><a href="#clear-1" class="headerlink" title="clear"></a>clear</h3><p>清除所有缓存。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> Lru(<span class="number">50</span>);</span><br><span class="line">cache.set(<span class="string">'test'</span>, <span class="string">'licia'</span>);</span><br><span class="line">cache.get(<span class="string">'test'</span>); <span class="comment">// -&gt; 'licia'</span></span><br></pre></td></tr></table></figure><h2 id="MediaQuery"><a href="#MediaQuery" class="headerlink" title="MediaQuery"></a>MediaQuery</h2><p>CSS 媒体查询监听器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class MediaQuery extends Emitter {<br>    constructor(query: string);<br>    isMatch(): boolean;<br>}</code><br></pre><br></details><p>继承自 Emitter 类。</p><h3 id="constructor-15"><a href="#constructor-15" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>query</td><td>媒体查询字符串</td></tr></tbody></table><h3 id="isMatch"><a href="#isMatch" class="headerlink" title="isMatch"></a>isMatch</h3><p>如果媒体查询匹配，返回真。</p><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><h4 id="match"><a href="#match" class="headerlink" title="match"></a>match</h4><p>当媒体查询匹配时触发。</p><h4 id="unmatch"><a href="#unmatch" class="headerlink" title="unmatch"></a>unmatch</h4><p>与 match 事件相反。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mediaQuery = <span class="keyword">new</span> MediaQuery(<span class="string">'screen and (max-width:1000px)'</span>);</span><br><span class="line">mediaQuery.isMatch(); <span class="comment">// -&gt; false</span></span><br><span class="line">mediaQuery.on(<span class="string">'match'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="MutationObserver"><a href="#MutationObserver" class="headerlink" title="MutationObserver"></a>MutationObserver</h2><p>MutationObserver 安全版本，如果不支持，则什么也不做。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span>(<span class="params">mutations</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;);</span><br><span class="line">observer.observe(<span class="built_in">document</span>.documentElement);</span><br><span class="line">observer.disconnect();</span><br></pre></td></tr></table></figure><h2 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h2><p>优先队列实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class PriorityQueue {<br>    size: number;<br>    constructor(cmp?: types.AnyFn);<br>    clear(): void;<br>    enqueue(item: any): number;<br>    dequeue(): any;<br>    peek(): any;<br>}</code><br></pre><br></details><h3 id="size-2"><a href="#size-2" class="headerlink" title="size"></a>size</h3><p>队列大小。</p><h3 id="constructor-16"><a href="#constructor-16" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>cmp</td><td>比较器</td></tr></tbody></table><h3 id="clear-2"><a href="#clear-2" class="headerlink" title="clear"></a>clear</h3><p>清空队列。</p><h3 id="enqueue"><a href="#enqueue" class="headerlink" title="enqueue"></a>enqueue</h3><p>元素入列。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>item</td><td>入列元素</td></tr><tr><td>返回值</td><td>当前大小</td></tr></tbody></table><h3 id="dequeue"><a href="#dequeue" class="headerlink" title="dequeue"></a>dequeue</h3><p>获取并删除队列中拥有最高优先级的元素。</p><h3 id="peek-1"><a href="#peek-1" class="headerlink" title="peek"></a>peek</h3><p>同 dequeue，只是不删除。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> PriorityQueue(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.priority &gt; b.priority) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (a.priority === b.priority) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line">queue.enqueue(&#123;</span><br><span class="line">    priority: <span class="number">1000</span>,</span><br><span class="line">    value: <span class="string">'apple'</span></span><br><span class="line">&#125;);</span><br><span class="line">queue.enqueue(&#123;</span><br><span class="line">    priority: <span class="number">500</span>,</span><br><span class="line">    value: <span class="string">'orange'</span></span><br><span class="line">&#125;);</span><br><span class="line">queue.dequeue(); <span class="comment">// -&gt; &#123; priority: 1000, value: 'apple' &#125;</span></span><br></pre></td></tr></table></figure><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>轻量 Promise 实现。</p><p><a href="https://github.com/promises-aplus/promises-spec" target="_blank" rel="noopener">Promises 标准</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> req = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        req.open(<span class="string">'GET'</span>, url);</span><br><span class="line">        req.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            req.status == <span class="number">200</span></span><br><span class="line">                ? resolve(req.response)</span><br><span class="line">                : reject(<span class="built_in">Error</span>(req.statusText));</span><br><span class="line">        &#125;;</span><br><span class="line">        req.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            reject(<span class="built_in">Error</span>(<span class="string">'Network Error'</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        req.send();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span>('test.json').then(function(result) &#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="PseudoMap"><a href="#PseudoMap" class="headerlink" title="PseudoMap"></a>PseudoMap</h2><p>类似 es6 的 Map，不支持遍历器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const PseudoMap: typeof Map;</code><br></pre><br></details><p>只支持字符串键名，当 Map 存在时会直接使用 Map。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> PseudoMap();</span><br><span class="line">map.set(<span class="string">'1'</span>, <span class="number">1</span>);</span><br><span class="line">map.get(<span class="string">'1'</span>); <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure><h2 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h2><p>队列数据结构。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Queue {<br>    size: number;<br>    clear(): void;<br>    enqueue(item: any): number;<br>    dequeue(): any;<br>    peek(): any;<br>    forEach(iterator: types.AnyFn, context?: any): void;<br>    toArr(): any[];<br>}</code><br></pre><br></details><h3 id="size-3"><a href="#size-3" class="headerlink" title="size"></a>size</h3><p>队列大小。</p><h3 id="clear-3"><a href="#clear-3" class="headerlink" title="clear"></a>clear</h3><p>清空队列。</p><h3 id="enqueue-1"><a href="#enqueue-1" class="headerlink" title="enqueue"></a>enqueue</h3><p>元素入列。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>item</td><td>入列元素</td></tr><tr><td>返回值</td><td>当前大小</td></tr></tbody></table><h3 id="dequeue-1"><a href="#dequeue-1" class="headerlink" title="dequeue"></a>dequeue</h3><p>元素出列。</p><h3 id="peek-2"><a href="#peek-2" class="headerlink" title="peek"></a>peek</h3><p>获取第一个元素但不移除它。</p><h3 id="forEach-1"><a href="#forEach-1" class="headerlink" title="forEach"></a>forEach</h3><p>遍历队列。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>iterator</td><td>调用函数</td></tr><tr><td>ctx</td><td>*</td><td>函数上下文</td></tr></tbody></table><h3 id="toArr-1"><a href="#toArr-1" class="headerlink" title="toArr"></a>toArr</h3><p>将队列转换为 JavaScript 数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> Queue();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(queue.size); <span class="comment">// -&gt; 0</span></span><br><span class="line">queue.enqueue(<span class="number">2</span>);</span><br><span class="line">queue.enqueue(<span class="number">3</span>);</span><br><span class="line">queue.dequeue(); <span class="comment">// -&gt; 2</span></span><br><span class="line"><span class="built_in">console</span>.log(queue.size); <span class="comment">// -&gt; 1</span></span><br><span class="line">queue.peek(); <span class="comment">// -&gt; 3</span></span><br><span class="line"><span class="built_in">console</span>.log(queue.size); <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure><h2 id="QuickLru"><a href="#QuickLru" class="headerlink" title="QuickLru"></a>QuickLru</h2><p>不使用链表的 LRU 实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class QuickLru {<br>    constructor(max: number);<br>    has(key: string): boolean;<br>    remove(key: string): void;<br>    get(key: string): any;<br>    set(key: string, val: any): void;<br>    clear(): void;<br>}</code><br></pre><br></details><p>参考 <a href="https://github.com/dominictarr/hashlru#algorithm" target="_blank" rel="noopener">hashlru 算法</a>，空间占用相比使用链表更多。</p><p>API 与 Lru 模块保持一致。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> QuickLru(<span class="number">50</span>);</span><br><span class="line">cache.set(<span class="string">'test'</span>, <span class="string">'licia'</span>);</span><br><span class="line">cache.get(<span class="string">'test'</span>); <span class="comment">// -&gt; 'licia'</span></span><br></pre></td></tr></table></figure><h2 id="Readiness"><a href="#Readiness" class="headerlink" title="Readiness"></a>Readiness</h2><p>任务就绪回调管理。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Readiness {<br>    signal(tasks: string | string[]): void;<br>    isReady(tasks: string | string[]): boolean;<br>    ready(tasks: string | string[], fn?: types.AnyFn): Promise&lt;void&gt;;<br>}</code><br></pre><br></details><h3 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h3><p>设置任务为就绪状态。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tasks</td><td>就绪任务</td></tr></tbody></table><h3 id="ready"><a href="#ready" class="headerlink" title="ready"></a>ready</h3><p>注册任务就绪回调。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tasks</td><td>要监听的任务</td></tr><tr><td>fn</td><td>任务就绪时触发的回调函数</td></tr><tr><td>返回值</td><td>任务就绪时 resolve 的 Promise</td></tr></tbody></table><h3 id="isReady"><a href="#isReady" class="headerlink" title="isReady"></a>isReady</h3><p>检查任务是否准备就绪。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tasks</td><td>要检查的任务</td></tr><tr><td>返回值</td><td>任务准备就绪，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> readiness = <span class="keyword">new</span> Readiness();</span><br><span class="line">readiness.ready(<span class="string">'serverCreated'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;);</span><br><span class="line">readiness.signal(<span class="string">'serverCreated'</span>);</span><br><span class="line">readiness.isReady(<span class="string">'serverCreated'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="ReduceStore"><a href="#ReduceStore" class="headerlink" title="ReduceStore"></a>ReduceStore</h2><p>简单类 redux 状态管理。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class ReduceStore {<br>    constructor(reducer: types.AnyFn, initialState: any);<br>    subscribe(listener: types.AnyFn): types.AnyFn;<br>    dispatch(action: any): any;<br>    getState(): any;<br>}</code><br></pre><br></details><h3 id="constructor-17"><a href="#constructor-17" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>reducer</td><td>生成下一个状态的函数</td></tr><tr><td>initialState</td><td>初始状态</td></tr></tbody></table><h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><p>订阅状态改变事件。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>listener</td><td>回调函数</td></tr><tr><td>返回值</td><td>取消订阅函数</td></tr></tbody></table><h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><p>发出动作。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>action</td><td>描述改变内容的对象</td></tr><tr><td>返回值</td><td>传入对象</td></tr></tbody></table><h3 id="getState"><a href="#getState" class="headerlink" title="getState"></a>getState</h3><p>获取当前状态。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> ReduceStore(<span class="function"><span class="keyword">function</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">            <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span><br><span class="line">            <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(store.getState());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;); <span class="comment">// 1</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;); <span class="comment">// 2</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span> &#125;); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h2 id="ResizeSensor"><a href="#ResizeSensor" class="headerlink" title="ResizeSensor"></a>ResizeSensor</h2><p>检查元素的大小是否发生变化。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class ResizeSensor extends SingleEmitter {<br>    constructor(el: HTMLElement);<br>    destroy(): void;<br>}</code><br></pre><br></details><h3 id="constructor-18"><a href="#constructor-18" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>element</td><td>要监听大小的元素</td></tr></tbody></table><h3 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h3><p>停止监听大小变化事件。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> target = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span><br><span class="line"><span class="keyword">const</span> sensor = <span class="keyword">new</span> ResizeSensor(target);</span><br><span class="line">sensor.addListener(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Trigger if element's size changed.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><p>querySelectorAll 的简单包装类。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Select {<br>    constructor(selector: string | Element | Document);<br>    find(selector: string): Select;<br>    each(fn: types.AnyFn): Select;<br>}</code><br></pre><br></details><h3 id="constructor-19"><a href="#constructor-19" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>selector</td><td>选择器</td></tr></tbody></table><h3 id="find-1"><a href="#find-1" class="headerlink" title="find"></a>find</h3><p>查找子元素。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>selector</td><td>选择器</td></tr></tbody></table><h3 id="each"><a href="#each" class="headerlink" title="each"></a>each</h3><p>遍历匹配的元素。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>调用函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $test = <span class="keyword">new</span> Select(<span class="string">'#test'</span>);</span><br><span class="line">$test.find(<span class="string">'.test'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">idx, element</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Manipulate dom nodes</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h2><p>限制资源同时访问次数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Semaphore {<br>    constructor(counter?: number);<br>    wait(fn: () =&gt; void): void;<br>    signal(): void;<br>}</code><br></pre><br></details><h3 id="constructor-20"><a href="#constructor-20" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>counter=1</td><td>初始计数</td></tr></tbody></table><h3 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h3><p>等待计数器大于 0 时，执行函数。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>要执行的函数</td></tr></tbody></table><h3 id="signal-1"><a href="#signal-1" class="headerlink" title="signal"></a>signal</h3><p>执行队列中未执行任务。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sem = <span class="keyword">new</span> Semaphore(<span class="number">10</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line">    .createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        sem.wait(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            res.end(<span class="string">'.'</span>);</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> sem.signal(), <span class="number">500</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><h2 id="SessionStore"><a href="#SessionStore" class="headerlink" title="SessionStore"></a>SessionStore</h2><p>SessionStorage 存储。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class SessionStore extends Store {<br>    constructor(name: string, data?: any);<br>}</code><br></pre><br></details><p>继承自 Store 类。</p><h3 id="constructor-21"><a href="#constructor-21" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>SessionStorage 存储名</td></tr><tr><td>data</td><td>默认数据</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> SessionStore(<span class="string">'licia'</span>);</span><br><span class="line">store.set(<span class="string">'name'</span>, <span class="string">'licia'</span>);</span><br></pre></td></tr></table></figure><h2 id="SingleEmitter"><a href="#SingleEmitter" class="headerlink" title="SingleEmitter"></a>SingleEmitter</h2><p>与 Event emitter 类似，但仅有一种事件类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class SingleEmitter {<br>    addListener(listener: types.AnyFn): void;<br>    rmListener(listener: types.AnyFn): void;<br>    emit(…args: any[]): void;<br>    rmAllListeners(): void;<br>    static mixin(obj: any): void;<br>}</code><br></pre><br></details><h3 id="addListener"><a href="#addListener" class="headerlink" title="addListener"></a>addListener</h3><p>添加监听器。</p><h3 id="rmListener"><a href="#rmListener" class="headerlink" title="rmListener"></a>rmListener</h3><p>移除监听器。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>listener</td><td>事件监听器</td></tr></tbody></table><h3 id="rmAllListeners"><a href="#rmAllListeners" class="headerlink" title="rmAllListeners"></a>rmAllListeners</h3><p>移除所有监听器。</p><h3 id="emit-1"><a href="#emit-1" class="headerlink" title="emit"></a>emit</h3><p>触发监听器。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…args</td><td>传递给监听器的参数</td></tr></tbody></table><h3 id="mixin-1"><a href="#mixin-1" class="headerlink" title="mixin"></a>mixin</h3><p>【静态】将 SingleEmitter 类的方法绑定到指定对象上去。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> SingleEmitter();</span><br><span class="line">event.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;);</span><br><span class="line">event.emit(<span class="string">'licia'</span>); <span class="comment">// Logs out 'licia'.</span></span><br></pre></td></tr></table></figure><h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><p>WebSocket 类的简单包装。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Socket extends Emitter {<br>    constructor(<br>        url: string,<br>        options?: {<br>            protocols?: string | string[];<br>            reconnect?: boolean;<br>        }<br>    );<br>    send(message: any): void;<br>    close(code?: number, reason?: string): void;<br>    connect(): void;<br>}</code><br></pre><br></details><p>继续自 Emitter 类。</p><h3 id="constructor-22"><a href="#constructor-22" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>WebSocket 地址</td></tr><tr><td>options</td><td>连接选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>protocols</td><td>协议</td></tr><tr><td>reconnect=true</td><td>是否尝试重新连接</td></tr></tbody></table><h3 id="send"><a href="#send" class="headerlink" title="send"></a>send</h3><p>发送数据。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>message</td><td>要发送的数据</td></tr></tbody></table><h3 id="close"><a href="#close" class="headerlink" title="close"></a>close</h3><p>关闭 WebSocket 连接。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>code</td><td>状态码</td></tr><tr><td>reason</td><td>关闭原因</td></tr></tbody></table><h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><p>连接 WebSocket，初始化时就会被调用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> Socket(<span class="string">'ws://localhost:8001'</span>);</span><br><span class="line">ws.on(<span class="string">'open'</span>, e =&gt; ws.send(<span class="string">'Hello'</span>));</span><br></pre></td></tr></table></figure><h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><p>栈数据结构。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Stack {<br>    size: number;<br>    clear(): void;<br>    push(item: any): number;<br>    pop(): any;<br>    peek(): any;<br>    forEach(iterator: types.AnyFn, context?: any): void;<br>    toArr(): any[];<br>}</code><br></pre><br></details><h3 id="size-4"><a href="#size-4" class="headerlink" title="size"></a>size</h3><p>栈大小。</p><h3 id="clear-4"><a href="#clear-4" class="headerlink" title="clear"></a>clear</h3><p>清空栈。</p><h3 id="push-1"><a href="#push-1" class="headerlink" title="push"></a>push</h3><p>元素入栈。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>item</td><td>入栈元素</td></tr><tr><td>返回值</td><td>当前大小</td></tr></tbody></table><h3 id="pop-1"><a href="#pop-1" class="headerlink" title="pop"></a>pop</h3><p>元素出栈。</p><h3 id="peek-3"><a href="#peek-3" class="headerlink" title="peek"></a>peek</h3><p>获取最后一个元素但不移除它。</p><h3 id="forEach-2"><a href="#forEach-2" class="headerlink" title="forEach"></a>forEach</h3><p>遍历栈。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>iterator</td><td>调用函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr></tbody></table><h3 id="toArr-2"><a href="#toArr-2" class="headerlink" title="toArr"></a>toArr</h3><p>将栈转换为 JavaScript 数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stack = <span class="keyword">new</span> Stack();</span><br><span class="line"></span><br><span class="line">stack.push(<span class="number">2</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">stack.push(<span class="number">3</span>); <span class="comment">// -&gt; 2</span></span><br><span class="line">stack.pop(); <span class="comment">// -&gt; 3</span></span><br></pre></td></tr></table></figure><h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>简单状态机。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class State extends Emitter {<br>    constructor(initial: string, events: any);<br>    is(state: string): boolean;<br>    [event: string]: any;<br>}</code><br></pre><br></details><p>继承自 Emitter 类。</p><h3 id="constructor-23"><a href="#constructor-23" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>initial</td><td>初始状态</td></tr><tr><td>events</td><td>改变状态的事件</td></tr></tbody></table><h3 id="is"><a href="#is" class="headerlink" title="is"></a>is</h3><p>检查当前状态是否是指定状态。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>state</td><td>要检查的状态</td></tr><tr><td>返回值</td><td>如果是，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="keyword">new</span> State(<span class="string">'empty'</span>, &#123;</span><br><span class="line">    load: &#123; <span class="attr">from</span>: <span class="string">'empty'</span>, <span class="attr">to</span>: <span class="string">'pause'</span> &#125;,</span><br><span class="line">    play: &#123; <span class="attr">from</span>: <span class="string">'pause'</span>, <span class="attr">to</span>: <span class="string">'play'</span> &#125;,</span><br><span class="line">    pause: &#123; <span class="attr">from</span>: [<span class="string">'play'</span>, <span class="string">'empty'</span>], <span class="attr">to</span>: <span class="string">'pause'</span> &#125;,</span><br><span class="line">    unload: &#123; <span class="attr">from</span>: [<span class="string">'play'</span>, <span class="string">'pause'</span>], <span class="attr">to</span>: <span class="string">'empty'</span> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">state.is(<span class="string">'empty'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">state.load();</span><br><span class="line">state.is(<span class="string">'pause'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">state.on(<span class="string">'play'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(src); <span class="comment">// -&gt; 'eustia'</span></span><br><span class="line">&#125;);</span><br><span class="line">state.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, event</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Error handler</span></span><br><span class="line">&#125;);</span><br><span class="line">state.play(<span class="string">'eustia'</span>);</span><br></pre></td></tr></table></figure><h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>内存存储。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Store extends Emitter {<br>    constructor(data?: {});<br>    set(key: string, val: any): void;<br>    set(values: {}): void;<br>    get(key: string): any;<br>    get(keys: string[]): {};<br>    remove(key: string): void;<br>    remove(keys: string[]): void;<br>    clear(): void;<br>    each(fn: (…args: any[]) =&gt; void): void;<br>}</code><br></pre><br></details><p>继承自 Emitter 类。</p><h3 id="constructor-24"><a href="#constructor-24" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>data</td><td>初始数据</td></tr></tbody></table><h3 id="set-5"><a href="#set-5" class="headerlink" title="set"></a>set</h3><p>设置值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>键名</td></tr><tr><td>val</td><td>键值</td></tr></tbody></table><p>设置多个值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>values</td><td>包含多个键值对的对象</td></tr></tbody></table><p>该方法被调用时发触发 change 事件。</p><h3 id="get-4"><a href="#get-4" class="headerlink" title="get"></a>get</h3><p>获取值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>键名</td></tr><tr><td>返回值</td><td>键值</td></tr></tbody></table><p>获取多个值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>keys</td><td>键名列表</td></tr><tr><td>返回值</td><td>包含多个键值对的对象</td></tr></tbody></table><h3 id="remove-6"><a href="#remove-6" class="headerlink" title="remove"></a>remove</h3><p>移除值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>键名</td></tr></tbody></table><h3 id="clear-5"><a href="#clear-5" class="headerlink" title="clear"></a>clear</h3><p>清空数据。</p><h3 id="each-1"><a href="#each-1" class="headerlink" title="each"></a>each</h3><p>遍历数据。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>遍历函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Store(<span class="string">'test'</span>);</span><br><span class="line">store.set(<span class="string">'user'</span>, &#123; <span class="attr">name</span>: <span class="string">'licia'</span> &#125;);</span><br><span class="line">store.get(<span class="string">'user'</span>).name; <span class="comment">// -&gt; 'licia'</span></span><br><span class="line">store.clear();</span><br><span class="line">store.each(<span class="function"><span class="keyword">function</span>(<span class="params">val, key</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;);</span><br><span class="line">store.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">key, newVal, oldVal</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// It triggers whenever set is called.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h2><p>解析、处理和生成 Chrome Trace 格式数据。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace Trace {<br>    interface IEvent {<br>        name: string;<br>        cat: string;<br>        ph: string;<br>        ts: number;<br>        pid: number;<br>        tid: number;<br>        args: any;<br>        [key: string]: any;<br>    }<br>    class Process {<br>        constructor(id);<br>        id(): string;<br>        name(): string;<br>        addEvent(IEvent): void;<br>        rmEvent(IEvent): void;<br>        getThread(id: number): Thread;<br>        rmThread(id: number): void;<br>        threads(): Thread[];<br>        toJSON(): IEvent[];<br>    }<br>    class Thread {<br>        constructor(id, pid);<br>        id(): string;<br>        name(): string;<br>        addEvent(IEvent): void;<br>        rmEvent(IEvent): void;<br>        events(): IEvent[];<br>        toJSON(): IEvent[];<br>    }<br>}<br>class Trace {<br>    constructor(events: Trace.IEvent[]);<br>    addEvent(event: Trace.IEvent);<br>    rmEvent(event: Trace.IEvent);<br>    getProcess(id: number): Trace.Process;<br>    rmProcess(id: number): void;<br>    processes(): Trace.Process[];<br>    toJSON(): Trace.IEvent[];<br>}</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> data = fs.readFileSync(<span class="string">'path/to/trace'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="keyword">const</span> trace = <span class="keyword">new</span> Trace(<span class="built_in">JSON</span>.parse(data));</span><br><span class="line">trace.rmProcess(<span class="number">627</span>);</span><br><span class="line">fs.writeFileSync(</span><br><span class="line">    <span class="string">'path/to/trace'</span>,</span><br><span class="line">    <span class="built_in">JSON</span>.stringify(trace.toJSON()),</span><br><span class="line">    <span class="string">'utf8'</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="Tracing"><a href="#Tracing" class="headerlink" title="Tracing"></a>Tracing</h2><p>创建 chrome trace 格式数据。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Tracing {<br>    constructor(options?: {<br>        pid?: number;<br>        tid?: number;<br>        processName?: string;<br>        threadName?: string;<br>    });<br>    start(cat?: string): void;<br>    stop(): Trace.IEvent[];<br>    metadata(name: string, args: any): void;<br>    begin(cat: string, name: string, args?: any): void;<br>    end(args?: any): void;<br>    asyncBegin(cat: string, name: string, id?: string, args?: any): string;<br>    asyncEnd(id: string, args?: any): void;<br>    instant(<br>        cat: string,<br>        name: string,<br>        scope?: &#x27;g&#x27; | &#x27;p&#x27; | &#x27;t&#x27;,<br>        args?: any<br>    ): void;<br>    id(): string;<br>}</code><br></pre><br></details><h3 id="constructor-25"><a href="#constructor-25" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>录制选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>pid</td><td>进程 id</td></tr><tr><td>tid</td><td>线程 id</td></tr><tr><td>processName</td><td>进程名称</td></tr><tr><td>threadName</td><td>线程名称</td></tr></tbody></table><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><p>开始录制。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>cat</td><td>开启类别</td></tr></tbody></table><h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><p>停止录制并获取事件列表。</p><h3 id="begin"><a href="#begin" class="headerlink" title="begin"></a>begin</h3><p>记录开始事件。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>cat</td><td>事件类别</td></tr><tr><td>name</td><td>事件名称</td></tr><tr><td>args</td><td>参数</td></tr></tbody></table><h3 id="end"><a href="#end" class="headerlink" title="end"></a>end</h3><p>记录结束事件。</p><h3 id="asyncBegin"><a href="#asyncBegin" class="headerlink" title="asyncBegin"></a>asyncBegin</h3><p>记录异步开始事件。</p><h3 id="asyncEnd"><a href="#asyncEnd" class="headerlink" title="asyncEnd"></a>asyncEnd</h3><p>记录异步结束事件。</p><h3 id="instant"><a href="#instant" class="headerlink" title="instant"></a>instant</h3><p>记录 instant 事件。</p><h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><p>获取一个唯一 id。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> tracing = <span class="keyword">new</span> Tracing();</span><br><span class="line">tracing.start();</span><br><span class="line">tracing.begin(<span class="string">'cat'</span>, <span class="string">'name'</span>);</span><br><span class="line"><span class="comment">// Do something...</span></span><br><span class="line">tracing.end();</span><br><span class="line">fs.writeFileSync(</span><br><span class="line">    <span class="string">'path/to/trace'</span>,</span><br><span class="line">    <span class="built_in">JSON</span>.stringify(tracing.stop()),</span><br><span class="line">    <span class="string">'utf8'</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><p>字典树数据结构。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Trie {<br>    add(word: string): void;<br>    remove(word: string): void;<br>    has(word: string): boolean;<br>    words(prefix: string): string[];<br>    clear(): void;<br>}</code><br></pre><br></details><h3 id="add-3"><a href="#add-3" class="headerlink" title="add"></a>add</h3><p>添加单词到字典数。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>word</td><td>要添加的单词</td></tr></tbody></table><h3 id="remove-7"><a href="#remove-7" class="headerlink" title="remove"></a>remove</h3><p>从字典树中移除单词。</p><h3 id="has-4"><a href="#has-4" class="headerlink" title="has"></a>has</h3><p>检查字典树中是否存在单词。</p><h3 id="words"><a href="#words" class="headerlink" title="words"></a>words</h3><p>获取所有带指定前缀的单词。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>prefix</td><td>单词前缀</td></tr><tr><td>返回值</td><td>所有带指定前缀的单词</td></tr></tbody></table><h3 id="clear-6"><a href="#clear-6" class="headerlink" title="clear"></a>clear</h3><p>清除字典树中的所有单词。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trie = <span class="keyword">new</span> Trie();</span><br><span class="line">trie.add(<span class="string">'carpet'</span>);</span><br><span class="line">trie.add(<span class="string">'car'</span>);</span><br><span class="line">trie.add(<span class="string">'cat'</span>);</span><br><span class="line">trie.add(<span class="string">'cart'</span>);</span><br><span class="line">trie.has(<span class="string">'cat'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">trie.remove(<span class="string">'carpet'</span>);</span><br><span class="line">trie.has(<span class="string">'carpet'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">trie.words(<span class="string">'car'</span>); <span class="comment">// -&gt; ['car', 'cart']</span></span><br><span class="line">trie.clear();</span><br></pre></td></tr></table></figure><h2 id="Tween"><a href="#Tween" class="headerlink" title="Tween"></a>Tween</h2><p>JavaScript 补间动画库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Tween extends Emitter {<br>    constructor(target: any);<br>    to(props: any, duration?: number, ease?: string | Function): Tween;<br>    progress(): number;<br>    progress(progress: number): Tween;<br>    play(): Tween;<br>    pause(): Tween;<br>    paused(): boolean;<br>}</code><br></pre><br></details><p>继承自 Emitter 类。</p><h3 id="constructor-26"><a href="#constructor-26" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要补间的对象</td></tr></tbody></table><h3 id="to"><a href="#to" class="headerlink" title="to"></a>to</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>destination</td><td>目标属性值</td></tr><tr><td>duration</td><td>补间时长</td></tr><tr><td>ease</td><td>缓动函数</td></tr></tbody></table><h3 id="play"><a href="#play" class="headerlink" title="play"></a>play</h3><p>开始播放。</p><h3 id="pause"><a href="#pause" class="headerlink" title="pause"></a>pause</h3><p>暂停动画。</p><h3 id="paused"><a href="#paused" class="headerlink" title="paused"></a>paused</h3><p>检查动画是否暂停。</p><h3 id="progress"><a href="#progress" class="headerlink" title="progress"></a>progress</h3><p>设置或获取动画进度。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>progress</td><td>介于 0 到 1 之间的数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pos = &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tween = <span class="keyword">new</span> Tween(pos);</span><br><span class="line">tween</span><br><span class="line">    .on(<span class="string">'update'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(target.x, target.y);</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(target.x, target.y); <span class="comment">// -&gt; 100, 100</span></span><br><span class="line">    &#125;);</span><br><span class="line">tween.to(&#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">100</span> &#125;, <span class="number">1000</span>, <span class="string">'inElastic'</span>).play();</span><br></pre></td></tr></table></figure><h2 id="Url"><a href="#Url" class="headerlink" title="Url"></a>Url</h2><p>简单 url 操作库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace Url {<br>    interface IUrl {<br>        protocol: string;<br>        auth: string;<br>        hostname: string;<br>        hash: string;<br>        query: any;<br>        port: string;<br>        pathname: string;<br>        slashes: boolean;<br>    }<br>}<br>class Url {<br>    protocol: string;<br>    auth: string;<br>    hostname: string;<br>    hash: string;<br>    query: any;<br>    port: string;<br>    pathname: string;<br>    slashes: boolean;<br>    constructor(url?: string);<br>    setQuery(name: string, val: string | number): Url;<br>    setQuery(query: types.PlainObj&lt;string | number&gt;): Url;<br>    rmQuery(name: string | string[]): Url;<br>    toString(): string;<br>    static parse(url: string): Url.IUrl;<br>    static stringify(object: Url.IUrl): string;<br>}</code><br></pre><br></details><h3 id="constructor-27"><a href="#constructor-27" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url=location</td><td>url 地址</td></tr></tbody></table><h3 id="setQuery"><a href="#setQuery" class="headerlink" title="setQuery"></a>setQuery</h3><p>设置 query 值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>query 名</td></tr><tr><td>val</td><td>query 值</td></tr><tr><td>返回值</td><td>this</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>query</td><td>query 对象</td></tr><tr><td>返回值</td><td>this</td></tr></tbody></table><h3 id="rmQuery"><a href="#rmQuery" class="headerlink" title="rmQuery"></a>rmQuery</h3><p>移除 query 值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>query 名</td></tr><tr><td>返回值</td><td>this</td></tr></tbody></table><h3 id="parse-1"><a href="#parse-1" class="headerlink" title="parse"></a>parse</h3><p>【静态】将 url 解析成对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>url 地址</td></tr><tr><td>返回值</td><td>url 对象</td></tr></tbody></table><h3 id="stringify"><a href="#stringify" class="headerlink" title="stringify"></a>stringify</h3><p>【静态】将 url 对象转换为 url 地址。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>url 对象</td></tr><tr><td>返回值</td><td>url 地址</td></tr></tbody></table><p>url 对象包含以下属性值：</p><table><thead><tr><th>属性名</th><th>说明</th></tr></thead><tbody><tr><td>protocol</td><td>协议名，（如 http:）</td></tr><tr><td>slashes</td><td>协议名后是否有双斜杠</td></tr><tr><td>auth</td><td>身份验证（例如 用户名:密码）</td></tr><tr><td>hostname</td><td>Host 名，不带端口号</td></tr><tr><td>port</td><td>端口号</td></tr><tr><td>pathname</td><td>URL 路径</td></tr><tr><td>query</td><td>query 对象</td></tr><tr><td>hash</td><td>URL # 字符后边的部分，# 包含在内</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="keyword">new</span> Url(<span class="string">'http://example.com:8080?eruda=true'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(url.port); <span class="comment">// -&gt; '8080'</span></span><br><span class="line">url.query.foo = <span class="string">'bar'</span>;</span><br><span class="line">url.rmQuery(<span class="string">'eruda'</span>);</span><br><span class="line">url.toString(); <span class="comment">// -&gt; 'http://example.com:8080/?foo=bar'</span></span><br></pre></td></tr></table></figure><h2 id="Validator"><a href="#Validator" class="headerlink" title="Validator"></a>Validator</h2><p>对象属性值校验。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Validator {<br>    constructor(options: types.PlainObj&lt;any&gt;);<br>    validate(object: any): string | boolean;<br>    static plugins: any;<br>    static addPlugin(name: string, plugin: types.AnyFn): void;<br>}</code><br></pre><br></details><h3 id="constructor-28"><a href="#constructor-28" class="headerlink" title="constructor"></a>constructor</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>校验配置</td></tr></tbody></table><h3 id="validate"><a href="#validate" class="headerlink" title="validate"></a>validate</h3><p>校验对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>校验结果，true 表示通过</td></tr></tbody></table><h3 id="addPlugin"><a href="#addPlugin" class="headerlink" title="addPlugin"></a>addPlugin</h3><p>【静态】添加插件。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>插件名</td></tr><tr><td>plugin</td><td>校验函数</td></tr></tbody></table><h3 id="默认插件"><a href="#默认插件" class="headerlink" title="默认插件"></a>默认插件</h3><p>required，number，boolean，string 和 regexp。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Validator.addPlugin(<span class="string">'custom'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">val, key, config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">'string'</span> &amp;&amp; val.length === <span class="number">5</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> key + <span class="string">' should be a string with length 5'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> validator = <span class="keyword">new</span> Validator(&#123;</span><br><span class="line">    test: &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        custom: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">validator.validate(&#123;&#125;); <span class="comment">// -&gt; 'test is required'</span></span><br><span class="line">validator.validate(&#123; <span class="attr">test</span>: <span class="number">1</span> &#125;); <span class="comment">// -&gt; 'test should be a string with length 5';</span></span><br><span class="line">validator.validate(&#123; <span class="attr">test</span>: <span class="string">'licia'</span> &#125;); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="Wrr"><a href="#Wrr" class="headerlink" title="Wrr"></a>Wrr</h2><p>加权轮询调度算法实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">class Wrr {<br>    size: number;<br>    set(val: any, weight: number): void;<br>    get(val: any): number | void;<br>    remove(val: any): void;<br>    clear(): void;<br>    next(): any;<br>}</code><br></pre><br></details><h3 id="size-5"><a href="#size-5" class="headerlink" title="size"></a>size</h3><p>池大小。</p><h3 id="set-6"><a href="#set-6" class="headerlink" title="set"></a>set</h3><p>设置值和权重，如果值已存在则更新其权重。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要设置的值</td></tr><tr><td>weight</td><td>值的权重</td></tr></tbody></table><h3 id="get-5"><a href="#get-5" class="headerlink" title="get"></a>get</h3><p>获取指定值的权重。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要获取的值</td></tr><tr><td>返回值</td><td>值的权重</td></tr></tbody></table><h3 id="remove-8"><a href="#remove-8" class="headerlink" title="remove"></a>remove</h3><p>移除指定值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要移除的值</td></tr></tbody></table><h3 id="next"><a href="#next" class="headerlink" title="next"></a>next</h3><p>从池中获取下一个值。</p><h3 id="clear-7"><a href="#clear-7" class="headerlink" title="clear"></a>clear</h3><p>清除所有值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pool = <span class="keyword">new</span> Wrr();</span><br><span class="line">pool.set(<span class="string">'A'</span>, <span class="number">4</span>);</span><br><span class="line">pool.set(<span class="string">'B'</span>, <span class="number">8</span>);</span><br><span class="line">pool.set(<span class="string">'C'</span>, <span class="number">2</span>);</span><br><span class="line">pool.next();</span><br><span class="line">pool.remove(<span class="string">'A'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(pool.size); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="abbrev"><a href="#abbrev" class="headerlink" title="abbrev"></a>abbrev</h2><p>计算字符串集的缩写集合。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function abbrev(…names: string[]): types.PlainObj&lt;string&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>names</td><td>字符串集</td></tr><tr><td>返回值</td><td>缩写集合</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">abbrev(<span class="string">'lina'</span>, <span class="string">'luna'</span>);</span><br><span class="line"><span class="comment">// -&gt; &#123;li: 'lina', lin: 'lina', lina: 'lina', lu: 'luna', lun: 'luna', luna: 'luna'&#125;</span></span><br></pre></td></tr></table></figure><h2 id="after-1"><a href="#after-1" class="headerlink" title="after"></a>after</h2><p>创建一个函数，只有在调用 n 次后才会调用一次。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function after&lt;T extends types.AnyFn&gt;(n: number, fn: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>n</td><td>调用次数</td></tr><tr><td>fn</td><td>源函数</td></tr><tr><td>返回值</td><td>输出函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = after(<span class="number">5</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// -&gt; Only invoke after fn is called 5 times.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h2><p>执行异步 HTTP 请求。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace ajax {<br>    function get(<br>        url: string,<br>        data: string | {},<br>        success: types.AnyFn,<br>        dataType?: string<br>    ): XMLHttpRequest;<br>    function get(<br>        url: string,<br>        success: types.AnyFn,<br>        dataType?: string<br>    ): XMLHttpRequest;<br>    function post(<br>        url: string,<br>        data: string | {},<br>        success: types.AnyFn,<br>        dataType?: string<br>    ): XMLHttpRequest;<br>    function post(<br>        url: string,<br>        success: types.AnyFn,<br>        dataType?: string<br>    ): XMLHttpRequest;<br>}<br>function ajax(options: {<br>    type?: string;<br>    url: string;<br>    data?: string | {};<br>    dataType?: string;<br>    contentType?: string;<br>    success?: types.AnyFn;<br>    error?: types.AnyFn;<br>    complete?: types.AnyFn;<br>    timeout?: number;<br>}): XMLHttpRequest;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>Ajax 选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>type</td><td>请求类型</td></tr><tr><td>url</td><td>请求地址</td></tr><tr><td>data</td><td>请求数据</td></tr><tr><td>dataType=json</td><td>响应类型（json，xml）</td></tr><tr><td>contentType=application/x-www-form-urlencoded</td><td>请求内容类型</td></tr><tr><td>success</td><td>成功回调</td></tr><tr><td>error</td><td>失败回调</td></tr><tr><td>complete</td><td>结束回调</td></tr><tr><td>timeout</td><td>请求超时</td></tr></tbody></table><h3 id="get-6"><a href="#get-6" class="headerlink" title="get"></a>get</h3><p>type = GET 的快捷方式。</p><h3 id="post"><a href="#post" class="headerlink" title="post"></a>post</h3><p>type = POST 的快捷方式。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>请求地址</td></tr><tr><td>data</td><td>请求数据</td></tr><tr><td>success</td><td>成功回调</td></tr><tr><td>dataType</td><td>响应类型</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ajax(&#123;</span><br><span class="line">    url: <span class="string">'http://example.com'</span>,</span><br><span class="line">    data: &#123; <span class="attr">test</span>: <span class="string">'true'</span> &#125;,</span><br><span class="line">    error() &#123;&#125;,</span><br><span class="line">    success(data) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    dataType: <span class="string">'json'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ajax.get(<span class="string">'http://example.com'</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="allKeys"><a href="#allKeys" class="headerlink" title="allKeys"></a>allKeys</h2><p>获取对象的所有键名，包括自身的及继承的。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace allKeys {<br>    interface IOptions {<br>        prototype?: boolean;<br>        unenumerable?: boolean;<br>    }<br>}<br>function allKeys(<br>    obj: any,<br>    options: { symbol: true } &amp; allKeys.IOptions<br>): Array&lt;string | Symbol&gt;;<br>function allKeys(<br>    obj: any,<br>    options?: ({ symbol: false } &amp; allKeys.IOptions) | allKeys.IOptions<br>): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>options</td><td>选项</td></tr><tr><td>返回值</td><td>包含所有键名的数组</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>prototype=true</td><td>包含原型键名</td></tr><tr><td>unenumerable=false</td><td>包含不可枚举键名</td></tr><tr><td>symbol=false</td><td>包含 Symbol 键名</td></tr></tbody></table><p>Object 对象原型上的方法不会被获取到。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="built_in">Object</span>.create(&#123; <span class="attr">zero</span>: <span class="number">0</span> &#125;);</span><br><span class="line">obj.one = <span class="number">1</span>;</span><br><span class="line">allKeys(obj); <span class="comment">// -&gt; ['zero', 'one']</span></span><br></pre></td></tr></table></figure><h2 id="ansiColor"><a href="#ansiColor" class="headerlink" title="ansiColor"></a>ansiColor</h2><p>控制台颜色。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace ansiColor {<br>    type IFn = (str: string) =&gt; string;<br>}<br>const ansiColor: {<br>    black: ansiColor.IFn;<br>    red: ansiColor.IFn;<br>    green: ansiColor.IFn;<br>    yellow: ansiColor.IFn;<br>    blue: ansiColor.IFn;<br>    magenta: ansiColor.IFn;<br>    cyan: ansiColor.IFn;<br>    white: ansiColor.IFn;<br>    gray: ansiColor.IFn;<br>    grey: ansiColor.IFn;<br>    bgBlack: ansiColor.IFn;<br>    bgRed: ansiColor.IFn;<br>    bgGreen: ansiColor.IFn;<br>    bgYellow: ansiColor.IFn;<br>    bgBlue: ansiColor.IFn;<br>    bgMagenta: ansiColor.IFn;<br>    bgCyan: ansiColor.IFn;<br>    bgWhite: ansiColor.IFn;<br>    blackBright: ansiColor.IFn;<br>    redBright: ansiColor.IFn;<br>    greenBright: ansiColor.IFn;<br>    yellowBright: ansiColor.IFn;<br>    blueBright: ansiColor.IFn;<br>    magentaBright: ansiColor.IFn;<br>    cyanBright: ansiColor.IFn;<br>    whiteBright: ansiColor.IFn;<br>    bgBlackBright: ansiColor.IFn;<br>    bgRedBright: ansiColor.IFn;<br>    bgGreenBright: ansiColor.IFn;<br>    bgYellowBright: ansiColor.IFn;<br>    bgBlueBright: ansiColor.IFn;<br>    bgMagentaBright: ansiColor.IFn;<br>    bgCyanBright: ansiColor.IFn;<br>    bgWhiteBright: ansiColor.IFn;<br>};</code><br></pre><br></details><h3 id="支持颜色"><a href="#支持颜色" class="headerlink" title="支持颜色"></a>支持颜色</h3><p>black, red, green, yellow, blue, magenta, cyan, white, gray, grey</p><p>bgBlack, bgRed, bgGreen, bgYellow, bgBlue, bgMagenta, bgCyan, bgWhite,</p><p>blackBright, redBright, greenBright, yellowBright, blueBright, magentaBright, cyanBright, whiteBright</p><p>bgBlackBright, bgRedBright, bgGreenBright, bgYellowBright, bgBlueBright, bgMagentaBright, bgCyanBright, bgWhiteBright</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansiColor.red(<span class="string">'Warning'</span>);</span><br></pre></td></tr></table></figure><h2 id="arrToMap"><a href="#arrToMap" class="headerlink" title="arrToMap"></a>arrToMap</h2><p>将字符串列表转换为映射。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function arrToMap&lt;T&gt;(<br>    arr: string[],<br>    val?: T<br>): { [key: string]: T };</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>字符串列表</td></tr><tr><td>val=true</td><td>键值</td></tr><tr><td>返回值</td><td>映射</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> needPx = arrToMap([</span><br><span class="line">    <span class="string">'column-count'</span>,</span><br><span class="line">    <span class="string">'columns'</span>,</span><br><span class="line">    <span class="string">'font-weight'</span>,</span><br><span class="line">    <span class="string">'line-weight'</span>,</span><br><span class="line">    <span class="string">'opacity'</span>,</span><br><span class="line">    <span class="string">'z-index'</span>,</span><br><span class="line">    <span class="string">'zoom'</span></span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> key = <span class="string">'column-count'</span>;</span><br><span class="line"><span class="keyword">let</span> val = <span class="string">'5'</span>;</span><br><span class="line"><span class="keyword">if</span> (needPx[key]) val += <span class="string">'px'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(val); <span class="comment">// -&gt; '5px'</span></span><br></pre></td></tr></table></figure><h2 id="atob"><a href="#atob" class="headerlink" title="atob"></a>atob</h2><p>window.atob，运行在 node 环境时使用 Buffer 进行模拟。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function atob(str: string): string;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atob(<span class="string">'SGVsbG8gV29ybGQ='</span>); <span class="comment">// -&gt; 'Hello World'</span></span><br></pre></td></tr></table></figure><h2 id="average"><a href="#average" class="headerlink" title="average"></a>average</h2><p>获取数字的平均值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function average(…numbers: number[]): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>numbers</td><td>要计算的数字</td></tr><tr><td>返回值</td><td>平均值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">average(<span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>); <span class="comment">// -&gt; 3</span></span><br></pre></td></tr></table></figure><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>base64 编解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const base64: {<br>    encode(bytes: number[]): string;<br>    decode(str: string): number[];<br>};</code><br></pre><br></details><h3 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h3><p>将字节数组编码为 base64 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>bytes</td><td>字节数组</td></tr><tr><td>返回值</td><td>base64 编码的字符串</td></tr></tbody></table><h3 id="decode"><a href="#decode" class="headerlink" title="decode"></a>decode</h3><p>将 base64 字符串解码为字节数组。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>base64 编码的字符串</td></tr><tr><td>返回值</td><td>字节数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base64.encode([<span class="number">168</span>, <span class="number">174</span>, <span class="number">155</span>, <span class="number">255</span>]); <span class="comment">// -&gt; 'qK6b/w=='</span></span><br><span class="line">base64.decode(<span class="string">'qK6b/w=='</span>); <span class="comment">// -&gt; [168, 174, 155, 255]</span></span><br></pre></td></tr></table></figure><h2 id="before-1"><a href="#before-1" class="headerlink" title="before"></a>before</h2><p>创建一个函数，只能调用少于 n 次。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function before&lt;T extends types.AnyFn&gt;(n: number, fn: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>n</td><td>调用次数</td></tr><tr><td>fn</td><td>源函数</td></tr><tr><td>返回值</td><td>输出函数</td></tr></tbody></table><p>超过 n 次后再次调用函数将直接返回最后一次函数的调用结果。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = before(<span class="number">5</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">fn(); <span class="comment">// Allow function to be call 4 times at last.</span></span><br></pre></td></tr></table></figure><h2 id="binarySearch"><a href="#binarySearch" class="headerlink" title="binarySearch"></a>binarySearch</h2><p>二分查找实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function binarySearch(<br>    array: any[],<br>    val: any,<br>    cmp?: types.AnyFn<br>): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>array</td><td>目标数组</td></tr><tr><td>val</td><td>要查找的值</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>第一次出现的位置，如果没有，返回 -1</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">binarySearch([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">2</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">binarySearch([<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>); <span class="comment">// -&gt; -1</span></span><br><span class="line">binarySearch(</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            key: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            key: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    (a, b) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.key === b.key) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> a.key &lt; b.key ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">); <span class="comment">// -&gt; 0</span></span><br></pre></td></tr></table></figure><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>创建一个绑定到指定对象的函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function bind(<br>    fn: types.AnyFn,<br>    ctx: any,<br>    …args: any[]<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>ctx</td><td>绑定对象</td></tr><tr><td>args</td><td>可选参数</td></tr><tr><td>返回值</td><td>输出函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = bind(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">':'</span> + msg);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'eustia'</span> &#125;,</span><br><span class="line">    <span class="string">'I am a utility library.'</span></span><br><span class="line">);</span><br><span class="line">fn(); <span class="comment">// -&gt; 'eustia: I am a utility library.'</span></span><br></pre></td></tr></table></figure><h2 id="btoa"><a href="#btoa" class="headerlink" title="btoa"></a>btoa</h2><p>window.btoa，运行在 node 环境时使用 Buffer 进行模拟。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function btoa(str: string): string;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">btoa(<span class="string">'Hello World'</span>); <span class="comment">// -&gt; 'SGVsbG8gV29ybGQ='</span></span><br></pre></td></tr></table></figure><h2 id="bubbleSort"><a href="#bubbleSort" class="headerlink" title="bubbleSort"></a>bubbleSort</h2><p>冒泡排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function bubbleSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bubbleSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="bytesToStr"><a href="#bytesToStr" class="headerlink" title="bytesToStr"></a>bytesToStr</h2><p>将字节数组转换为字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function bytesToStr(bytes: number[], encoding?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>bytes</td><td>字节数组</td></tr><tr><td>encoding=utf8</td><td>字符串编码</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bytesToStr([<span class="number">108</span>, <span class="number">105</span>, <span class="number">99</span>, <span class="number">105</span>, <span class="number">97</span>]); <span class="comment">// -&gt; 'licia'</span></span><br></pre></td></tr></table></figure><h2 id="bytesToWords"><a href="#bytesToWords" class="headerlink" title="bytesToWords"></a>bytesToWords</h2><p>将字节数组转换为 32 位字长数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function bytesToWords(bytes: number[]): number[];</code><br></pre><br></details><p>在使用 CryptoJS 时会派上用处。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>bytes</td><td>字节数组</td></tr><tr><td>返回值</td><td>字长数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bytesToWords([<span class="number">0x12</span>, <span class="number">0x34</span>, <span class="number">0x56</span>, <span class="number">0x78</span>]); <span class="comment">// -&gt; [0x12345678]</span></span><br></pre></td></tr></table></figure><h2 id="cacheRequire"><a href="#cacheRequire" class="headerlink" title="cacheRequire"></a>cacheRequire</h2><p>缓存模块加载，提高应用启动速度。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function cacheRequire(options?: {<br>    dir?: string;<br>    requirePath?: boolean;<br>    code?: boolean;<br>    compileCache?: boolean;<br>}): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>缓存选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>dir</td><td>缓存文件夹</td></tr><tr><td>requirePath=true</td><td>Whether require path should be cached</td></tr><tr><td>code=false</td><td>Whether js code should be cached</td></tr><tr><td>compileCache=true</td><td>Whether compile cache should be used</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cacheRequire(&#123;</span><br><span class="line">    dir: <span class="string">'path/to/cache/dir'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="callbackify"><a href="#callbackify" class="headerlink" title="callbackify"></a>callbackify</h2><p>将返回 Promise 的函数转换为使用回调的函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function callbackify(fn: types.AnyFn): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>返回 Promise 的函数</td></tr><tr><td>返回值</td><td>使用回调的函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cbFn = callbackify(fn);</span><br><span class="line"></span><br><span class="line">cbFn(<span class="function"><span class="keyword">function</span>(<span class="params">err, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="camelCase"><a href="#camelCase" class="headerlink" title="camelCase"></a>camelCase</h2><p>将字符串转换为驼峰式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function camelCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>驼峰式字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">camelCase(<span class="string">'foo-bar'</span>); <span class="comment">// -&gt; fooBar</span></span><br><span class="line">camelCase(<span class="string">'foo bar'</span>); <span class="comment">// -&gt; fooBar</span></span><br><span class="line">camelCase(<span class="string">'foo_bar'</span>); <span class="comment">// -&gt; fooBar</span></span><br><span class="line">camelCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; fooBar</span></span><br></pre></td></tr></table></figure><h2 id="capitalize"><a href="#capitalize" class="headerlink" title="capitalize"></a>capitalize</h2><p>将字符串的第一个字符转换为大写，其余字符转换为小写。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function capitalize(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">capitalize(<span class="string">'rED'</span>); <span class="comment">// -&gt; Red</span></span><br></pre></td></tr></table></figure><h2 id="castPath"><a href="#castPath" class="headerlink" title="castPath"></a>castPath</h2><p>将值转换为属性路径数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function castPath(path: string | string[], obj?: any): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>要转换的值</td></tr><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>属性路径数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">castPath(<span class="string">'a.b.c'</span>); <span class="comment">// -&gt; ['a', 'b', 'c']</span></span><br><span class="line">castPath([<span class="string">'a'</span>]); <span class="comment">// -&gt; ['a']</span></span><br><span class="line">castPath(<span class="string">'a[0].b'</span>); <span class="comment">// -&gt; ['a', '0', 'b']</span></span><br><span class="line">castPath(<span class="string">'a.b.c'</span>, &#123; <span class="string">'a.b.c'</span>: <span class="literal">true</span> &#125;); <span class="comment">// -&gt; ['a.b.c']</span></span><br></pre></td></tr></table></figure><h2 id="centerAlign"><a href="#centerAlign" class="headerlink" title="centerAlign"></a>centerAlign</h2><p>字符串居中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function centerAlign(<br>    str: string | string[],<br>    width?: number<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>width</td><td>每行宽度</td></tr><tr><td>返回值</td><td>居中字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">centerAlign(<span class="string">'test'</span>, <span class="number">8</span>); <span class="comment">// -&gt; '  test'</span></span><br><span class="line">centerAlign(<span class="string">'test\nlines'</span>, <span class="number">8</span>); <span class="comment">// -&gt; '  test\n lines'</span></span><br><span class="line">centerAlign([<span class="string">'test'</span>, <span class="string">'lines'</span>], <span class="number">8</span>); <span class="comment">// -&gt; '  test\n lines'</span></span><br></pre></td></tr></table></figure><h2 id="char"><a href="#char" class="headerlink" title="char"></a>char</h2><p>根据指定的整数返回 unicode 编码为该整数的字符。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function char(num: number): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要转换的整数</td></tr><tr><td>返回值</td><td>对应字符</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">char(<span class="number">65</span>); <span class="comment">// -&gt; 'A'</span></span><br><span class="line">char(<span class="number">97</span>); <span class="comment">// -&gt; 'a'</span></span><br></pre></td></tr></table></figure><h2 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a>chunk</h2><p>将数组拆分为指定长度的子数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function chunk(arr: any[], size?: number): Array&lt;any[]&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>size=1</td><td>子数组的长度</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chunk([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">2</span>); <span class="comment">// -&gt; [[1, 2], [3, 4]]</span></span><br><span class="line">chunk([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">3</span>); <span class="comment">// -&gt; [[1, 2, 3], [4]]</span></span><br><span class="line">chunk([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// -&gt; [[1], [2], [3], [4]]</span></span><br></pre></td></tr></table></figure><h2 id="clamp"><a href="#clamp" class="headerlink" title="clamp"></a>clamp</h2><p>将数字限定于指定区间。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function clamp(n: number, lower: number, upper: number): number;<br>function clamp(n: number, upper: number): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>n</td><td>要处理的数字</td></tr><tr><td>lower</td><td>下限</td></tr><tr><td>upper</td><td>上限</td></tr><tr><td>返回值</td><td>限定后的数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">clamp(<span class="number">-10</span>, <span class="number">-5</span>, <span class="number">5</span>); <span class="comment">// -&gt; -5</span></span><br><span class="line">clamp(<span class="number">10</span>, <span class="number">-5</span>, <span class="number">5</span>); <span class="comment">// -&gt; 5</span></span><br><span class="line">clamp(<span class="number">2</span>, <span class="number">-5</span>, <span class="number">5</span>); <span class="comment">// -&gt; 2</span></span><br><span class="line">clamp(<span class="number">10</span>, <span class="number">5</span>); <span class="comment">// -&gt; 5</span></span><br><span class="line">clamp(<span class="number">2</span>, <span class="number">5</span>); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="className"><a href="#className" class="headerlink" title="className"></a>className</h2><p>合并 class。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function className(…names: any[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>names</td><td>要合并的 class</td></tr><tr><td>返回值</td><td>合并后的 class 字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">className(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>); <span class="comment">// -&gt; 'a b c'</span></span><br><span class="line">className(<span class="string">'a'</span>, <span class="literal">false</span>, <span class="string">'b'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">'c'</span>); <span class="comment">// -&gt; 'a b 1 c'</span></span><br><span class="line">className(<span class="string">'a'</span>, [<span class="string">'b'</span>, <span class="string">'c'</span>]); <span class="comment">// -&gt; 'a b c'</span></span><br><span class="line">className(<span class="string">'a'</span>, &#123; <span class="attr">b</span>: <span class="literal">false</span>, <span class="attr">c</span>: <span class="literal">true</span> &#125;); <span class="comment">// -&gt; 'a c'</span></span><br><span class="line">className(<span class="string">'a'</span>, [<span class="string">'b'</span>, <span class="string">'c'</span>, &#123; <span class="attr">d</span>: <span class="literal">true</span>, <span class="attr">e</span>: <span class="literal">false</span> &#125;]); <span class="comment">// -&gt; 'a b c d';</span></span><br></pre></td></tr></table></figure><h2 id="cliHelp"><a href="#cliHelp" class="headerlink" title="cliHelp"></a>cliHelp</h2><p>输出命令行帮助。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace cliHelp {<br>    interface IOption {<br>        name: string;<br>        shorthand?: string;<br>        desc: string;<br>    }<br>    interface ICommand {<br>        name: string;<br>        desc: string;<br>        usage: string | string[];<br>        options?: IOption[];<br>    }<br>    interface IData {<br>        name: string;<br>        usage: string | string[];<br>        commands: ICommand[];<br>    }<br>}<br>function cliHelp(data: cliHelp.IData | cliHelp.ICommand): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>data</td><td>帮助数据</td></tr><tr><td>返回值</td><td>命令行帮助</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test = &#123;</span><br><span class="line">    name: <span class="string">'test'</span>,</span><br><span class="line">    desc: <span class="string">'Generate test files'</span>,</span><br><span class="line">    usage: [<span class="string">'&lt;module-name&gt; [options]'</span>, <span class="string">'lpad --browser'</span>],</span><br><span class="line">    options: [</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'browser'</span>,</span><br><span class="line">            shorthand: <span class="string">'b'</span>,</span><br><span class="line">            desc: <span class="string">'True if test should run in a browser'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    name: <span class="string">'licia'</span>,</span><br><span class="line">    usage: <span class="string">'&lt;command&gt; [options]'</span>,</span><br><span class="line">    commands: [test]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">cliHelp(data);</span><br><span class="line">cliHelp(test);</span><br></pre></td></tr></table></figure><h2 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h2><p>对指定对象进行浅复制。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function clone&lt;T&gt;(val: T): T;</code><br></pre><br></details><p>任何嵌套的对象或数组只会拷贝其引用。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要克隆的值</td></tr><tr><td>返回值</td><td>克隆值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clone(&#123; <span class="attr">name</span>: <span class="string">'eustia'</span> &#125;); <span class="comment">// -&gt; &#123;name: 'eustia'&#125;</span></span><br></pre></td></tr></table></figure><h2 id="cloneDeep"><a href="#cloneDeep" class="headerlink" title="cloneDeep"></a>cloneDeep</h2><p>深复制。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function cloneDeep&lt;T&gt;(val: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要克隆的值</td></tr><tr><td>返回值</td><td>克隆值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = [&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">a</span>: <span class="number">2</span> &#125;];</span><br><span class="line"><span class="keyword">const</span> obj2 = cloneDeep(obj);</span><br><span class="line"><span class="built_in">console</span>.log(obj[<span class="number">0</span>] === obj2[<span class="number">1</span>]); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="cmpVersion"><a href="#cmpVersion" class="headerlink" title="cmpVersion"></a>cmpVersion</h2><p>比较版本号。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function cmpVersion(v1: string, v2: string): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>v1</td><td>版本号</td></tr><tr><td>v2</td><td>版本号</td></tr><tr><td>返回值</td><td>比较结果</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmpVersion(<span class="string">'1.1.8'</span>, <span class="string">'1.0.4'</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">cmpVersion(<span class="string">'1.0.2'</span>, <span class="string">'1.0.2'</span>); <span class="comment">// -&gt; 0</span></span><br><span class="line">cmpVersion(<span class="string">'2.0'</span>, <span class="string">'2.0.0'</span>); <span class="comment">// -&gt; 0</span></span><br><span class="line">cmpVersion(<span class="string">'3.0.1'</span>, <span class="string">'3.0.0.2'</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">cmpVersion(<span class="string">'1.1.1'</span>, <span class="string">'1.2.3'</span>); <span class="comment">// -&gt; -1</span></span><br></pre></td></tr></table></figure><h2 id="combine"><a href="#combine" class="headerlink" title="combine"></a>combine</h2><p>创建一个数组，用一个数组的值作为其键名，另一个数组的值作为其值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function combine(keys: string[], values: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>keys</td><td>键名数组</td></tr><tr><td>values</td><td>键值数组</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">combine([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; &#123;a: 1, b: 2, c: 3&#125;</span></span><br></pre></td></tr></table></figure><h2 id="compact"><a href="#compact" class="headerlink" title="compact"></a>compact</h2><p>返回数组的拷贝并移除其中的虚值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function compact(arr: any[]): any[];</code><br></pre><br></details><p>虚值包括 false，null，0，空字符串，undefined 和 NaN。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compact([<span class="number">0</span>, <span class="number">1</span>, <span class="literal">false</span>, <span class="number">2</span>, <span class="string">''</span>, <span class="number">3</span>]); <span class="comment">// -&gt; [1, 2, 3]</span></span><br></pre></td></tr></table></figure><h2 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h2><p>将多个函数组合成一个函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function compose(…fn: types.AnyFn[]): types.AnyFn;</code><br></pre><br></details><p>每个函数使用下一个函数的返回值作为参数。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…fn</td><td>要组合的函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> welcome = compose(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'hi: '</span> + name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name.toUpperCase() + <span class="string">'!'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">welcome(<span class="string">'licia'</span>); <span class="comment">// -&gt; 'hi: LICIA!'</span></span><br></pre></td></tr></table></figure><h2 id="compressImg"><a href="#compressImg" class="headerlink" title="compressImg"></a>compressImg</h2><p>使用 canvas 对图像进行压缩。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function compressImg(<br>    file: File | Blob | string,<br>    cb: types.AnyFn<br>): void;<br>function compressImg(<br>    file: File | Blob | string,<br>    options?: {<br>        maxWidth?: number;<br>        maxHeight?: number;<br>        width?: number;<br>        height?: number;<br>        mimeType?: string;<br>        quality?: number;<br>    },<br>    cb?: types.AnyFn<br>): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>file</td><td>图片文件或 url</td></tr><tr><td>options</td><td>选项</td></tr><tr><td>cb</td><td>回调</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>maxWidth</td><td>最大宽度</td></tr><tr><td>maxHeight</td><td>最大高度</td></tr><tr><td>width</td><td>输出图片宽度</td></tr><tr><td>height</td><td>输出图片高度</td></tr><tr><td>mimeType</td><td>Mine 类型</td></tr><tr><td>quality=0.8</td><td>图片质量，从 0 到 1</td></tr></tbody></table><p>为了保持图片比例，当宽度设置时高度将被忽略。</p><p>如果设置了宽高，最大宽度跟最大高度将被忽略。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> file = <span class="keyword">new</span> Blob([]);</span><br><span class="line">compressImg(</span><br><span class="line">    file,</span><br><span class="line">    &#123;</span><br><span class="line">        maxWidth: <span class="number">200</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">err, file</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h2><p>将多个数组合并成一个数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function concat(…args: Array&lt;any[]&gt;): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…arr</td><td>要合并的数组</td></tr><tr><td>返回值</td><td>合并后的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// -&gt; [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><h2 id="contain"><a href="#contain" class="headerlink" title="contain"></a>contain</h2><p>检查数组中是否有指定值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function contain(arr: any[] | {} | string, val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>target</td><td>目标对象</td></tr><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果有，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contain([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">1</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">contain(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, <span class="number">1</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">contain(<span class="string">'abc'</span>, <span class="string">'a'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="convertBase"><a href="#convertBase" class="headerlink" title="convertBase"></a>convertBase</h2><p>对数字进行进制转换。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function convertBase(<br>    num: number | string,<br>    from: number,<br>    to: number<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要转换的数字</td></tr><tr><td>from</td><td>源进制</td></tr><tr><td>to</td><td>目标进制</td></tr><tr><td>返回值</td><td>转换后的数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">convertBase(<span class="string">'10'</span>, <span class="number">2</span>, <span class="number">10</span>); <span class="comment">// -&gt; '2'</span></span><br><span class="line">convertBase(<span class="string">'ff'</span>, <span class="number">16</span>, <span class="number">2</span>); <span class="comment">// -&gt; '11111111'</span></span><br></pre></td></tr></table></figure><h2 id="convertBin"><a href="#convertBin" class="headerlink" title="convertBin"></a>convertBin</h2><p>二进制数据格式转换。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace convertBin {<br>    function blobToArrBuffer(blob: any): Promise&lt;ArrayBuffer&gt;;<br>}<br>function convertBin(bin: any, type: string): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>bin</td><td>源二进制数据</td></tr><tr><td>type</td><td>二进制类型</td></tr><tr><td>返回值</td><td>目标二进制数据</td></tr></tbody></table><h3 id="支持格式"><a href="#支持格式" class="headerlink" title="支持格式"></a>支持格式</h3><p>base64, ArrayBuffer, Array, Uint8Array, Blob(browser), Buffer(node)</p><p>因为将 Blob 转换为其它格式是个异步过程，所以你不能直接对它进行转换。</p><h3 id="blobToArrBuffer"><a href="#blobToArrBuffer" class="headerlink" title="blobToArrBuffer"></a>blobToArrBuffer</h3><p>将 Blob 类型转换为 ArrayBuffer 类型。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>blob</td><td>Blob 数据</td></tr><tr><td>返回值</td><td>ArrayBuffer promise</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">convertBin(<span class="string">'qK6b/w=='</span>, <span class="string">'Uint8Array'</span>); <span class="comment">// -&gt; [168, 174, 155, 255]</span></span><br><span class="line">convertBin.blobToArrBuffer(<span class="keyword">new</span> Blob([])).then(<span class="function"><span class="params">arrBuffer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>浏览器 cookie 操作库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace cookie {<br>    interface IOptions {<br>        path?: string;<br>        expires?: number;<br>        domain?: string;<br>        secure?: boolean;<br>    }<br>    interface ICookie {<br>        get(key: string, options?: cookie.IOptions): string;<br>        set(key: string, val: string, options?: cookie.IOptions): ICookie;<br>        remove(key: string, options?: cookie.IOptions): ICookie;<br>    }<br>}<br>const cookie: cookie.ICookie;</code><br></pre><br></details><h3 id="get-7"><a href="#get-7" class="headerlink" title="get"></a>get</h3><p>获取 cookie 值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>Cookie 键名</td></tr><tr><td>返回值</td><td>对应的 cookie 值</td></tr></tbody></table><h3 id="set-7"><a href="#set-7" class="headerlink" title="set"></a>set</h3><p>设置 cookie 值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>cookie 键名</td></tr><tr><td>val</td><td>cookie 值</td></tr><tr><td>options</td><td>cookie 选项</td></tr><tr><td>返回值</td><td>cookie 模块</td></tr></tbody></table><h3 id="remove-9"><a href="#remove-9" class="headerlink" title="remove"></a>remove</h3><p>移除 cookie 值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>Cookie 键名</td></tr><tr><td>options</td><td>Cookie 选项</td></tr><tr><td>返回值</td><td>cookie 模块</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cookie.set(<span class="string">'a'</span>, <span class="string">'1'</span>, &#123; <span class="attr">path</span>: <span class="string">'/'</span> &#125;);</span><br><span class="line">cookie.get(<span class="string">'a'</span>); <span class="comment">// -&gt; '1'</span></span><br><span class="line">cookie.remove(<span class="string">'a'</span>);</span><br></pre></td></tr></table></figure><h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><p>使用 document.execCommand 将文本拷贝到剪贴板。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function copy(text: string, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>text</td><td>要拷贝的文本</td></tr><tr><td>cb</td><td>可选回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy(<span class="string">'text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Handle errors.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="crc1"><a href="#crc1" class="headerlink" title="crc1"></a>crc1</h2><p>CRC1 算法实现。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function crc1(<br>    input: string | number[],<br>    previous?: number<br>): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>input</td><td>信息码</td></tr><tr><td>previous</td><td>用于累积计算的 CRC1 校验码</td></tr><tr><td>返回值</td><td>CRC1 校验码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crc1(<span class="string">'1234567890'</span>).toString(<span class="number">16</span>); <span class="comment">// -&gt; 'd'</span></span><br></pre></td></tr></table></figure><h2 id="crc16"><a href="#crc16" class="headerlink" title="crc16"></a>crc16</h2><p>CRC16 算法实现。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function crc16(<br>    input: string | number[],<br>    previous?: number<br>): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>input</td><td>信息码</td></tr><tr><td>previous</td><td>用于累积计算的 CRC16 校验码</td></tr><tr><td>返回值</td><td>CRC16 校验码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crc16(<span class="string">'1234567890'</span>).toString(<span class="number">16</span>); <span class="comment">// -&gt; 'c57a'</span></span><br></pre></td></tr></table></figure><h2 id="crc32"><a href="#crc32" class="headerlink" title="crc32"></a>crc32</h2><p>CRC32 算法实现。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function crc32(<br>    input: string | number[],<br>    previous?: number<br>): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>input</td><td>信息码</td></tr><tr><td>previous</td><td>用于累积计算的 CRC32 校验码</td></tr><tr><td>返回值</td><td>CRC32 校验码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crc32(<span class="string">'1234567890'</span>).toString(<span class="number">16</span>); <span class="comment">// -&gt; '261daee5'</span></span><br></pre></td></tr></table></figure><h2 id="crc8"><a href="#crc8" class="headerlink" title="crc8"></a>crc8</h2><p>CRC8 算法实现。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function crc8(<br>    input: string | number[],<br>    previous?: number<br>): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>input</td><td>信息码</td></tr><tr><td>previous</td><td>用于累积计算的 CRC8 校验码</td></tr><tr><td>返回值</td><td>CRC8 校验码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crc8(<span class="string">'1234567890'</span>).toString(<span class="number">16</span>); <span class="comment">// -&gt; '52'</span></span><br></pre></td></tr></table></figure><h2 id="create"><a href="#create" class="headerlink" title="create"></a>create</h2><p>创建对象并指定它的原型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function create(proto?: object): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>proto</td><td>新对象原型</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = create(&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(obj.a); <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure><h2 id="createAssigner"><a href="#createAssigner" class="headerlink" title="createAssigner"></a>createAssigner</h2><p>用于创建 extend，extendOwn 和 defaults 等模块。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function createAssigner(<br>    keysFn: types.AnyFn,<br>    defaults: boolean<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>keysFn</td><td>获取对象键名的函数</td></tr><tr><td>defaults</td><td>设置为真时不对值进行覆盖</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><h2 id="createUrl"><a href="#createUrl" class="headerlink" title="createUrl"></a>createUrl</h2><p>CreateObjectURL 的包裹函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function createUrl(<br>    data: any,<br>    options?: { type?: string }<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>data</td><td>数据</td></tr><tr><td>options</td><td>当数据不是 File 或者 Blob 对象时使用</td></tr><tr><td>返回值</td><td>Blob 地址</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createUrl(<span class="string">'test'</span>, &#123; <span class="attr">type</span>: <span class="string">'text/plain'</span> &#125;); <span class="comment">// -&gt; Blob url</span></span><br><span class="line">createUrl([<span class="string">'test'</span>, <span class="string">'test'</span>]);</span><br><span class="line">createUrl(<span class="keyword">new</span> Blob([]));</span><br><span class="line">createUrl(<span class="keyword">new</span> File([<span class="string">'test'</span>], <span class="string">'test.txt'</span>));</span><br></pre></td></tr></table></figure><h2 id="css-1"><a href="#css-1" class="headerlink" title="css"></a>css</h2><p>CSS 解析器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const css: {<br>    parse(css: string): object;<br>    stringify(stylesheet: object, options?: { indent?: string }): string;<br>};</code><br></pre><br></details><p>注释会被移除掉。</p><h3 id="parse-2"><a href="#parse-2" class="headerlink" title="parse"></a>parse</h3><p>将 CSS 字符串转换为 js 对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>css</td><td>CSS 字符串</td></tr><tr><td>返回值</td><td>js 对象</td></tr></tbody></table><h3 id="stringify-1"><a href="#stringify-1" class="headerlink" title="stringify"></a>stringify</h3><p>将 js 对象序列化成 CSS 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>stylesheet</td><td>要序列化的对象</td></tr><tr><td>options</td><td>序列化选项</td></tr><tr><td>返回值</td><td>CSS 字符串</td></tr></tbody></table><p>选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>indent=’  ‘</td><td>缩进</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stylesheet = css.parse(<span class="string">'.name &#123; background: #000; color: red; &#125;'</span>);</span><br><span class="line"><span class="comment">// &#123;type: 'stylesheet', rules: [&#123;type: 'rule', selector: '.name', declarations: [...]&#125;]&#125;</span></span><br><span class="line">css.stringify(stylesheet);</span><br></pre></td></tr></table></figure><h2 id="cssPriority"><a href="#cssPriority" class="headerlink" title="cssPriority"></a>cssPriority</h2><p>计算与比较 CSS 选择器/样式的优先级。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace cssPriority {<br>    function compare(p1: number[], p2: number[]): number;<br>}<br>function cssPriority(<br>    selector: string,<br>    options?: {<br>        important?: boolean;<br>        inlineStyle?: boolean;<br>        position?: number;<br>    }<br>): number[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>selector</td><td>CSS 选择器</td></tr><tr><td>options</td><td>样式额外信息</td></tr><tr><td>返回值</td><td>优先级数组</td></tr></tbody></table><p>优先级数组包括六个数字值。</p><ol><li>important 标识 </li><li>内联样式</li><li>ID 选择器</li><li>类选择器</li><li>类型选择器</li><li>样式位置</li></ol><h3 id="compare"><a href="#compare" class="headerlink" title="compare"></a>compare</h3><p>比较优先级。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>p1</td><td>优先级数组</td></tr><tr><td>p2</td><td>优先级数组</td></tr><tr><td>返回值</td><td>比较结果</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cssPriority(<span class="string">'a.button &gt; i.icon:before'</span>, &#123;</span><br><span class="line">    important: <span class="literal">true</span>,</span><br><span class="line">    inlineStyle: <span class="literal">false</span>,</span><br><span class="line">    position: <span class="number">100</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; [1, 0, 0, 2, 3, 100]</span></span><br></pre></td></tr></table></figure><h2 id="cssSupports"><a href="#cssSupports" class="headerlink" title="cssSupports"></a>cssSupports</h2><p>检查浏览器是否支持某项 CSS 特性。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function cssSupports(name: string, val?: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>Css 属性名</td></tr><tr><td>val</td><td>Css 属性值</td></tr><tr><td>返回值</td><td>如果支持，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cssSupports(<span class="string">'display'</span>, <span class="string">'flex'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">cssSupports(<span class="string">'display'</span>, <span class="string">'invalid'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">cssSupports(<span class="string">'text-decoration-line'</span>, <span class="string">'underline'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">cssSupports(<span class="string">'grid'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">cssSupports(<span class="string">'invalid'</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="curry"><a href="#curry" class="headerlink" title="curry"></a>curry</h2><p>函数柯里化。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function curry(fn: types.AnyFn): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = curry(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> add1 = add(<span class="number">1</span>);</span><br><span class="line">add1(<span class="number">2</span>); <span class="comment">// -&gt; 3</span></span><br></pre></td></tr></table></figure><h2 id="dateFormat"><a href="#dateFormat" class="headerlink" title="dateFormat"></a>dateFormat</h2><p>简单日期格式化。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function dateFormat(<br>    date: Date,<br>    mask: string,<br>    utc?: boolean,<br>    gmt?: boolean<br>): string;<br>function dateFormat(<br>    mask: string,<br>    utc?: boolean,<br>    gmt?: boolean<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>date=new Date</td><td>要格式化的日期对象</td></tr><tr><td>mask</td><td>日期掩码</td></tr><tr><td>utc=false</td><td>是否是 UTC</td></tr><tr><td>gmt=false</td><td>是否是 GMT</td></tr><tr><td>返回值</td><td>格式化日期</td></tr></tbody></table><table><thead><tr><th>掩码</th><th>说明</th></tr></thead><tbody><tr><td>d</td><td>月份天数，不补零</td></tr><tr><td>dd</td><td>月份天数，不足两位补零</td></tr><tr><td>ddd</td><td>星期几，简称</td></tr><tr><td>dddd</td><td>星期几，全称</td></tr><tr><td>m</td><td>月份，数字，不补零</td></tr><tr><td>mm</td><td>月份，数字，不足两位补零</td></tr><tr><td>mmm</td><td>月份，简称</td></tr><tr><td>mmmm</td><td>月份，全称</td></tr><tr><td>yy</td><td>年份，只显示后两位数字，不足两位补零</td></tr><tr><td>yyyy</td><td>年份，显示四位数字</td></tr><tr><td>h</td><td>小时，不补零 (12 小时制)</td></tr><tr><td>hh</td><td>小时，不足两位补零（12 小时制）</td></tr><tr><td>H</td><td>小时，不补零（24 小时制）</td></tr><tr><td>HH</td><td>小时，不足两位补零（24 小时制）</td></tr><tr><td>M</td><td>分钟，不补零</td></tr><tr><td>MM</td><td>分钟，不足两位补零</td></tr><tr><td>s</td><td>秒数，不补零</td></tr><tr><td>ss</td><td>秒数，不足两位补零</td></tr><tr><td>l L</td><td>毫秒，l 显示 3 位， L 显示 2 位</td></tr><tr><td>t</td><td>小写显示上午下午，a 或 p</td></tr><tr><td>tt</td><td>小写显示上午下午，am 或 pm</td></tr><tr><td>T</td><td>大写显示上午下午，A 或 P</td></tr><tr><td>TT</td><td>大写显示上午下午，AM 或 PM</td></tr><tr><td>Z</td><td>美国时区缩写，比如 EST 或 MDT</td></tr><tr><td>o</td><td>GMT/UTC 时区时差，比如 -0500 或 +0230</td></tr><tr><td>S</td><td>月份天数序数后缀 （st，nd，rd，或 th）</td></tr><tr><td>UTC:</td><td>是否是 UTC，必须写在最前面</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dateFormat(<span class="string">'isoDate'</span>); <span class="comment">// -&gt; 2016-11-19</span></span><br><span class="line">dateFormat(<span class="string">'yyyy-mm-dd HH:MM:ss'</span>); <span class="comment">// -&gt; 2016-11-19 19:00:04</span></span><br><span class="line">dateFormat(<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="string">'yyyy-mm-dd'</span>); <span class="comment">// -&gt; 2016-11-19</span></span><br></pre></td></tr></table></figure><h2 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h2><p>返回函数的防反跳版本。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function debounce&lt;T extends types.AnyFn&gt;(fn: T, wait: number): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>wait</td><td>延迟毫秒数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> calLayout = debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;, <span class="number">300</span>);</span><br><span class="line"><span class="comment">// $(window).resize(calLayout);</span></span><br></pre></td></tr></table></figure><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p>简单的 JavaScript 输出 debug 日志函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function debug(name: string): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>名称</td></tr><tr><td>返回值</td><td>打印格式化日志的函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> d = debug(<span class="string">'test'</span>);</span><br><span class="line">d(<span class="string">'doing lots of uninteresting work'</span>);</span><br><span class="line">d.enabled = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h2 id="deburr"><a href="#deburr" class="headerlink" title="deburr"></a>deburr</h2><p>转换拉丁语-1补充字母和拉丁语扩展字母-A为基本拉丁字母，并且去除组合变音标记。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function deburr(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>要处理的字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deburr(<span class="string">'déjà vu'</span>); <span class="comment">// -&gt; 'deja vu'</span></span><br></pre></td></tr></table></figure><h2 id="decodeUriComponent"><a href="#decodeUriComponent" class="headerlink" title="decodeUriComponent"></a>decodeUriComponent</h2><p>类似 decodeURIComponent 函数，只是输入不合法时不抛出错误并尽可能地对其进行解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function decodeUriComponent(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>要解码的字符串</td></tr><tr><td>返回值</td><td>解码后的字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">decodeUriComponent(<span class="string">'%%25%'</span>); <span class="comment">// -&gt; '%%%'</span></span><br><span class="line">decodeUriComponent(<span class="string">'%E0%A4%A'</span>); <span class="comment">// -&gt; '\xE0\xA4%A'</span></span><br></pre></td></tr></table></figure><h2 id="defaults"><a href="#defaults" class="headerlink" title="defaults"></a>defaults</h2><p>填充对象的默认值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function defaults(obj: any, …src: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>…src</td><td>提供默认值对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults(&#123; <span class="attr">name</span>: <span class="string">'RedHood'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'Unknown'</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;); <span class="comment">// -&gt; &#123;name: 'RedHood', age: 24&#125;</span></span><br></pre></td></tr></table></figure><h2 id="define"><a href="#define" class="headerlink" title="define"></a>define</h2><p>定义一个模块，需要跟 use 模块配合使用。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function define(<br>    name: string,<br>    requires: string[],<br>    method: types.AnyFn<br>): void;<br>function define(name: string, method: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>模块名</td></tr><tr><td>requires</td><td>依赖</td></tr><tr><td>method</td><td>模块主体函数</td></tr></tbody></table><p>模块主体函数只有被 use 模块使用时才会被执行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">'A'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'A'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">define(<span class="string">'B'</span>, [<span class="string">'A'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">A</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'B'</span> + A;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="defineProp"><a href="#defineProp" class="headerlink" title="defineProp"></a>defineProp</h2><p>Object.defineProperty(defineProperties) 的快捷方式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function defineProp&lt;T&gt;(<br>    obj: T,<br>    prop: string,<br>    descriptor: PropertyDescriptor<br>): T;<br>function defineProp&lt;T&gt;(<br>    obj: T,<br>    descriptor: PropertyDescriptorMap<br>): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要定义的对象</td></tr><tr><td>prop</td><td>属性路径</td></tr><tr><td>descriptor</td><td>属性描述</td></tr><tr><td>返回值</td><td>传入对象</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要定义的对象</td></tr><tr><td>prop</td><td>属性描述</td></tr><tr><td>返回值</td><td>传入对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">3</span> &#125;, <span class="attr">d</span>: <span class="number">4</span>, <span class="attr">e</span>: <span class="number">5</span> &#125;;</span><br><span class="line">defineProp(obj, <span class="string">'a'</span>, &#123;</span><br><span class="line">    <span class="keyword">get</span>: function() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.e * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// obj.a is equal to 10</span></span><br><span class="line">defineProp(obj, <span class="string">'b.c'</span>, &#123;</span><br><span class="line">    <span class="keyword">set</span>: function(val) &#123;</span><br><span class="line">        <span class="comment">// this is pointed to obj.b</span></span><br><span class="line">        <span class="keyword">this</span>.e = val;</span><br><span class="line">    &#125;.bind(obj)</span><br><span class="line">&#125;);</span><br><span class="line">obj.b.c = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// obj.a is equal to 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line">defineProp(obj2, &#123;</span><br><span class="line">    a: &#123;</span><br><span class="line">        <span class="keyword">get</span>: function() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    b: &#123;</span><br><span class="line">        <span class="keyword">set</span>: function(val) &#123;</span><br><span class="line">            <span class="keyword">this</span>.c = val / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// obj2.a is equal to 3</span></span><br><span class="line">obj2.b = <span class="number">4</span>;</span><br><span class="line"><span class="comment">// obj2.a is equal to 2</span></span><br></pre></td></tr></table></figure><h2 id="defined"><a href="#defined" class="headerlink" title="defined"></a>defined</h2><p>返回第一个不是未定义的参数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function defined(…args: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…args</td><td>参数列表</td></tr><tr><td>返回值</td><td>第一个定义了的参数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defined(<span class="literal">false</span>, <span class="number">2</span>, <span class="keyword">void</span> <span class="number">0</span>, <span class="number">100</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="delRequireCache"><a href="#delRequireCache" class="headerlink" title="delRequireCache"></a>delRequireCache</h2><p>删除 node.js require 缓存。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function delRequireCache(id: string): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>模块名或路径</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> licia = <span class="built_in">require</span>(<span class="string">'licia'</span>);</span><br><span class="line">licia.a = <span class="number">5</span>;</span><br><span class="line">delRequireCache(<span class="string">'licia'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'licia'</span>).a; <span class="comment">// -&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="delay"><a href="#delay" class="headerlink" title="delay"></a>delay</h2><p>在指定时长后执行函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function delay(<br>    fn: types.AnyFn,<br>    wait: number,<br>    …args: any[]<br>): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>wait</td><td>延迟的毫秒数</td></tr><tr><td>…args</td><td>绑定参数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delay(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(text);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">1000</span>,</span><br><span class="line">    <span class="string">'later'</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// -&gt; Logs 'later' after one second</span></span><br></pre></td></tr></table></figure><h2 id="delegate"><a href="#delegate" class="headerlink" title="delegate"></a>delegate</h2><p>事件委托。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const delegate: {<br>    add(el: Element, type: string, selector: string, cb: types.AnyFn): void;<br>    remove(el: Element, type: string, selector: string, cb: types.AnyFn): void;<br>};</code><br></pre><br></details><h3 id="add-4"><a href="#add-4" class="headerlink" title="add"></a>add</h3><p>添加事件委托。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>el</td><td>父元素</td></tr><tr><td>type</td><td>事件类型</td></tr><tr><td>selector</td><td>匹配选择器</td></tr><tr><td>cb</td><td>事件回调</td></tr></tbody></table><h3 id="remove-10"><a href="#remove-10" class="headerlink" title="remove"></a>remove</h3><p>移除事件委托。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickHandler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;</span><br><span class="line">delegate.add(container, <span class="string">'click'</span>, <span class="string">'.children'</span>, clickHandler);</span><br><span class="line">delegate.remove(container, <span class="string">'click'</span>, <span class="string">'.children'</span>, clickHandler);</span><br></pre></td></tr></table></figure><h2 id="deprecate"><a href="#deprecate" class="headerlink" title="deprecate"></a>deprecate</h2><p>Node.js util.deprecate 方法，支持浏览器。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function deprecate(fn: types.AnyFn, msg: string): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>即将废弃的方法</td></tr><tr><td>msg</td><td>调用警告</td></tr><tr><td>返回值</td><td>废弃方法，调用时会打印警告</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> obsoleteFn = deprecate(fn, <span class="string">'obsoleteFn is deprecated.'</span>);</span><br><span class="line">obsoleteFn();</span><br></pre></td></tr></table></figure><h2 id="detectBrowser"><a href="#detectBrowser" class="headerlink" title="detectBrowser"></a>detectBrowser</h2><p>使用 ua 检测浏览器信息。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function detectBrowser(<br>    ua?: string<br>): {<br>    name: string;<br>    version: number;<br>};</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>ua=navigator.userAgent</td><td>浏览器用户代理</td></tr><tr><td>返回值</td><td>包含名称和版本的对象</td></tr></tbody></table><p>支持浏览器：ie，chrome，edge，firefox，opera，safari，ios（mobile safari），android（android browser）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browser = detectBrowser();</span><br><span class="line"><span class="keyword">if</span> (browser.name === <span class="string">'ie'</span> &amp;&amp; browser.version &lt; <span class="number">9</span>) &#123;</span><br><span class="line">    <span class="comment">// Do something about old IE...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="detectMocha"><a href="#detectMocha" class="headerlink" title="detectMocha"></a>detectMocha</h2><p>检测是否有 mocha 测试框架在运行。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function detectMocha(): boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detectMocha(); <span class="comment">// -&gt; True if mocha is running.</span></span><br></pre></td></tr></table></figure><h2 id="detectOs"><a href="#detectOs" class="headerlink" title="detectOs"></a>detectOs</h2><p>使用 ua 检测操作系统。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function detectOs(ua?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>ua=navigator.userAgent</td><td>浏览器用户代理</td></tr><tr><td>返回值</td><td>操作系统名称</td></tr></tbody></table><p>支持操作系统: windows, os x, linux, ios, android, windows phone</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (detectOs() === <span class="string">'ios'</span>) &#123;</span><br><span class="line">    <span class="comment">// Do something about ios...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="difference"><a href="#difference" class="headerlink" title="difference"></a>difference</h2><p>创建一个数组，该数组的元素不存在于给定的其它数组中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function difference(arr: any[], …args: any[]): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>…args</td><td>要排除的元素</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">difference([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">4</span>, <span class="number">2</span>]); <span class="comment">// -&gt; [3, 1]</span></span><br></pre></td></tr></table></figure><h2 id="dotCase"><a href="#dotCase" class="headerlink" title="dotCase"></a>dotCase</h2><p>将字符串转换为点式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function dotCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>点式字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotCase(<span class="string">'fooBar'</span>); <span class="comment">// -&gt; foo.bar</span></span><br><span class="line">dotCase(<span class="string">'foo bar'</span>); <span class="comment">// -&gt; foo.bar</span></span><br></pre></td></tr></table></figure><h2 id="download"><a href="#download" class="headerlink" title="download"></a>download</h2><p>在浏览器端触发文件下载。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function download(<br>    data: Blob | File | string | any[],<br>    name: string,<br>    type?: string<br>): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>data</td><td>下载的数据</td></tr><tr><td>name</td><td>文件名</td></tr><tr><td>type=text/plain</td><td>数据类型</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">download(<span class="string">'test'</span>, <span class="string">'test.txt'</span>);</span><br></pre></td></tr></table></figure><h2 id="durationFormat"><a href="#durationFormat" class="headerlink" title="durationFormat"></a>durationFormat</h2><p>简单时间格式化。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function durationFormat(duration: number, mask?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>duration</td><td>要格式化的时间，单位为毫秒</td></tr><tr><td>mask=’hh:mm:ss’</td><td>时间掩码</td></tr><tr><td>返回值</td><td>格式化时间</td></tr></tbody></table><table><thead><tr><th>掩码</th><th>说明</th></tr></thead><tbody><tr><td>d</td><td>天数</td></tr><tr><td>h</td><td>小时数</td></tr><tr><td>m</td><td>分钟数</td></tr><tr><td>s</td><td>秒数</td></tr><tr><td>l</td><td>毫秒数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">durationFormat(<span class="number">12345678</span>); <span class="comment">// -&gt; '03:25:45'</span></span><br><span class="line">durationFormat(<span class="number">12345678</span>, <span class="string">'h:m:s:l'</span>); <span class="comment">// -&gt; '3:25:45:678'</span></span><br></pre></td></tr></table></figure><h2 id="each-2"><a href="#each-2" class="headerlink" title="each"></a>each</h2><p>遍历集合中的所有元素，用每个元素当做参数调用迭代器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function each&lt;T&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator: types.ListIterator&lt;T, void&gt;,<br>    ctx?: any<br>): types.List&lt;T&gt;;<br>function each&lt;T&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator: types.ObjectIterator&lt;T, void&gt;,<br>    ctx?: any<br>): types.Collection&lt;T&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标集合</td></tr><tr><td>iterator</td><td>迭代器</td></tr><tr><td>ctx</td><td>函数上下文</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">each(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">val, key</span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><h2 id="easing"><a href="#easing" class="headerlink" title="easing"></a>easing</h2><p>缓动函数，参考 <a href="http://jqueryui.com/" target="_blank" rel="noopener">http://jqueryui.com/</a> 。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const easing: {<br>    linear(percent: number): number;<br>    inQuad(percent: number): number;<br>    outQuad(percent: number): number;<br>    inOutQuad(percent: number): number;<br>    outInQuad(percent: number): number;<br>    inCubic(percent: number): number;<br>    outCubic(percent: number): number;<br>    inQuart(percent: number): number;<br>    outQuart(percent: number): number;<br>    inQuint(percent: number): number;<br>    outQuint(percent: number): number;<br>    inExpo(percent: number): number;<br>    outExpo(percent: number): number;<br>    inSine(percent: number): number;<br>    outSine(percent: number): number;<br>    inCirc(percent: number): number;<br>    outCirc(percent: number): number;<br>    inElastic(percent: number, elasticity?: number): number;<br>    outElastic(percent: number, elasticity?: number): number;<br>    inBack(percent: number): number;<br>    outBack(percent: number): number;<br>    inOutBack(percent: number): number;<br>    outInBack(percent: number): number;<br>    inBounce(percent: number): number;<br>    outBounce(percent: number): number;<br>};</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>percent</td><td>位于 0 到 1 之前的数字</td></tr><tr><td>返回值</td><td>计算结果</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">easing.linear(<span class="number">0.5</span>); <span class="comment">// -&gt; 0.5</span></span><br><span class="line">easing.inElastic(<span class="number">0.5</span>, <span class="number">500</span>); <span class="comment">// -&gt; 0.03125</span></span><br></pre></td></tr></table></figure><h2 id="emulateTouch"><a href="#emulateTouch" class="headerlink" title="emulateTouch"></a>emulateTouch</h2><p>在桌面端浏览器模拟 touch 事件。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function emulateTouch(el: Element): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>el</td><td>目标元素</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el = <span class="built_in">document</span>.querySelector(<span class="string">'#test'</span>);</span><br><span class="line">emulateTouch(el);</span><br><span class="line">el.addEventListener(<span class="string">'touchstart'</span>, () =&gt; &#123;&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h2 id="endWith"><a href="#endWith" class="headerlink" title="endWith"></a>endWith</h2><p>检查字符串是否以指定字符串结尾。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function endWith(str: string, suffix: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>目标字符串</td></tr><tr><td>suffix</td><td>字符串后缀</td></tr><tr><td>返回值</td><td>如果是后缀，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">endWith(<span class="string">'ab'</span>, <span class="string">'b'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h2><p>转义 HTML 字符串，替换 &amp;，&lt;，&gt;，”，`，和 ‘ 字符。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function escape(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">escape</span>(<span class="string">'You &amp; Me'</span>); <span class="comment">// -&gt; 'You &amp;amp; Me'</span></span><br></pre></td></tr></table></figure><h2 id="escapeJsStr"><a href="#escapeJsStr" class="headerlink" title="escapeJsStr"></a>escapeJsStr</h2><p>转义字符串为合法的 JavaScript 字符串字面量。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function escapeJsStr(str: string): string;</code><br></pre><br></details><p><a href="http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.4" target="_blank" rel="noopener">http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.4</a></p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeJsStr(<span class="string">'"\n'</span>); <span class="comment">// -&gt; '\\"\\\\n'</span></span><br></pre></td></tr></table></figure><h2 id="escapeRegExp"><a href="#escapeRegExp" class="headerlink" title="escapeRegExp"></a>escapeRegExp</h2><p>转义特殊字符用于 RegExp 构造函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function escapeRegExp(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeRegExp(<span class="string">'[licia]'</span>); <span class="comment">// -&gt; '\\[licia\\]'</span></span><br></pre></td></tr></table></figure><h2 id="evalCss"><a href="#evalCss" class="headerlink" title="evalCss"></a>evalCss</h2><p>加载 css 到页面中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function evalCss(css: string): HTMLStyleElement;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>css</td><td>css 代码</td></tr><tr><td>返回值</td><td>style 节点</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evalCss(<span class="string">'body&#123;background:#08c&#125;'</span>);</span><br></pre></td></tr></table></figure><h2 id="evalJs"><a href="#evalJs" class="headerlink" title="evalJs"></a>evalJs</h2><p>在指定的上下文执行 js 代码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function evalJs(js: string, ctx?: any): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>js</td><td>JavaScript 代码</td></tr><tr><td>ctx=global</td><td>上下文</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">evalJs(<span class="string">'5+2'</span>); <span class="comment">// -&gt; 7</span></span><br><span class="line">evalJs(<span class="string">'this.a'</span>, &#123; <span class="attr">a</span>: <span class="number">2</span> &#125;); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="every"><a href="#every" class="headerlink" title="every"></a>every</h2><p>检查是否集合中的所有元素都能通过真值检测。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function every&lt;T&gt;(<br>    object: types.List&lt;T&gt;,<br>    iterator?: types.ListIterator&lt;T, boolean&gt;,<br>    context?: any<br>): boolean;<br>function every&lt;T&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator?: types.ObjectIterator&lt;T, boolean&gt;,<br>    context?: any<br>): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>object</td><td>目标集合</td></tr><tr><td>iterator</td><td>真值检测函数</td></tr><tr><td>context</td><td>函数上下文</td></tr><tr><td>返回值</td><td>如果都能通过，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">every([<span class="number">2</span>, <span class="number">4</span>], <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="extend"><a href="#extend" class="headerlink" title="extend"></a>extend</h2><p>复制多个对象中的所有属性到目标对象上。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function extend(destination: any, …sources: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>destination</td><td>目标对象</td></tr><tr><td>…sources</td><td>源对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extend(&#123; <span class="attr">name</span>: <span class="string">'RedHood'</span> &#125;, &#123; <span class="attr">age</span>: <span class="number">24</span> &#125;); <span class="comment">// -&gt; &#123;name: 'RedHood', age: 24&#125;</span></span><br></pre></td></tr></table></figure><h2 id="extendDeep"><a href="#extendDeep" class="headerlink" title="extendDeep"></a>extendDeep</h2><p>类似 extend，但会递归进行扩展。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function extendDeep(destination: any, …sources: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>destination</td><td>目标对象</td></tr><tr><td>…sources</td><td>源对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">extendDeep(</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'RedHood'</span>,</span><br><span class="line">        family: &#123;</span><br><span class="line">            mother: <span class="string">'Jane'</span>,</span><br><span class="line">            father: <span class="string">'Jack'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        family: &#123;</span><br><span class="line">            brother: <span class="string">'Bruce'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// -&gt; &#123;name: 'RedHood', family: &#123;mother: 'Jane', father: 'Jack', brother: 'Bruce'&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="extendOwn"><a href="#extendOwn" class="headerlink" title="extendOwn"></a>extendOwn</h2><p>类似 extend，但只复制自己的属性，不包括原型链上的属性。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function extendOwn(destination: any, …sources: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>…sources</td><td>源对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extendOwn(&#123; <span class="attr">name</span>: <span class="string">'RedHood'</span> &#125;, &#123; <span class="attr">age</span>: <span class="number">24</span> &#125;); <span class="comment">// -&gt; &#123;name: 'RedHood', age: 24&#125;</span></span><br></pre></td></tr></table></figure><h2 id="extractBlockCmts"><a href="#extractBlockCmts" class="headerlink" title="extractBlockCmts"></a>extractBlockCmts</h2><p>从源码中提取块注释。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function extractBlockCmts(str: string): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源码</td></tr><tr><td>返回值</td><td>块注释</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extractBlockCmts(<span class="string">'\/*licia*\/'</span>); <span class="comment">// -&gt; ['licia']</span></span><br></pre></td></tr></table></figure><h2 id="extractUrls"><a href="#extractUrls" class="headerlink" title="extractUrls"></a>extractUrls</h2><p>从文本中提取 url。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function extractUrls(str: string): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>文本</td></tr><tr><td>返回值</td><td>url 列表</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str =</span><br><span class="line">    <span class="string">'[Official site: http://eustia.liriliri.io](http://eustia.liriliri.io)'</span>;</span><br><span class="line">extractUrls(str); <span class="comment">// -&gt; ['http://eustia.liriliri.io']</span></span><br></pre></td></tr></table></figure><h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h2><p>将 XMLHttpRequest 转换为 promise 的形式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace fetch {<br>    interface IResult {<br>        ok: boolean;<br>        status: number;<br>        statusText: string;<br>        url: string;<br>        clone(): IResult;<br>        text(): Promise&lt;string&gt;;<br>        json(): Promise&lt;any&gt;;<br>        xml(): Promise&lt;Document | null&gt;;<br>        blob(): Promise&lt;Blob&gt;;<br>        headers: {<br>            keys(): string[];<br>            entries(): Array&lt;string[]&gt;;<br>            get(name: string): string;<br>            has(name: string): boolean;<br>        };<br>    }<br>}<br>function fetch(<br>    url: string,<br>    options?: {<br>        method?: string;<br>        timeout?: number;<br>        headers?: types.PlainObj&lt;string&gt;;<br>        body?: any;<br>    }<br>): Promise&lt;fetch.IResult&gt;;</code><br></pre><br></details><p>注意：这并不是 fetch 的 pollyfill。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>请求地址</td></tr><tr><td>options</td><td>请求选项</td></tr><tr><td>返回值</td><td>请求 promise</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'test.json'</span>, &#123;</span><br><span class="line">    method: <span class="string">'GET'</span>,</span><br><span class="line">    timeout: <span class="number">3000</span>,</span><br><span class="line">    headers: &#123;&#125;,</span><br><span class="line">    body: <span class="string">''</span></span><br><span class="line">&#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="fibonacci"><a href="#fibonacci" class="headerlink" title="fibonacci"></a>fibonacci</h2><p>计算斐波那契数列中某位数字。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fibonacci(n: number): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>n</td><td>序号 n</td></tr><tr><td>返回值</td><td>斐波那契数列 n 位的数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fibonacci(<span class="number">1</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">fibonacci(<span class="number">3</span>); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="fileSize"><a href="#fileSize" class="headerlink" title="fileSize"></a>fileSize</h2><p>将字节数转换为易于阅读的形式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fileSize(bytes: number): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>bytes</td><td>文件字节大小</td></tr><tr><td>返回值</td><td>易于阅读的文件大小</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fileSize(<span class="number">5</span>); <span class="comment">// -&gt; '5'</span></span><br><span class="line">fileSize(<span class="number">1500</span>); <span class="comment">// -&gt; '1.46K'</span></span><br><span class="line">fileSize(<span class="number">1500000</span>); <span class="comment">// -&gt; '1.43M'</span></span><br><span class="line">fileSize(<span class="number">1500000000</span>); <span class="comment">// -&gt; '1.4G'</span></span><br><span class="line">fileSize(<span class="number">1500000000000</span>); <span class="comment">// -&gt; '1.36T'</span></span><br></pre></td></tr></table></figure><h2 id="fileType"><a href="#fileType" class="headerlink" title="fileType"></a>fileType</h2><p>使用幻数检测文件类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fileType(<br>    input: Buffer | ArrayBuffer | Uint8Array<br>):<br>    | {<br>          ext: string;<br>          mime: string;<br>      }<br>    | undefined;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>input</td><td>文件输入</td></tr><tr><td>返回值</td><td>包括扩展名和 mime 类型的对象</td></tr></tbody></table><h3 id="支持的文件类型"><a href="#支持的文件类型" class="headerlink" title="支持的文件类型"></a>支持的文件类型</h3><p>jpg, png, gif, webp, bmp, gz, zip, rar, pdf, exe</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> file = fs.readFileSync(<span class="string">'path/to/file'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fileType(file)); <span class="comment">// -&gt; &#123; ext: 'jpg', mime: 'image/jpeg' &#125;</span></span><br></pre></td></tr></table></figure><h2 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h2><p>在数组指定位置填充指定值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fill(<br>    list: any[],<br>    val: any,<br>    start?: number,<br>    end?: number<br>): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>list</td><td>源数组</td></tr><tr><td>val</td><td>填充数组的值</td></tr><tr><td>start=0</td><td>起始位置</td></tr><tr><td>end=arr.length</td><td>结束位置，不包括</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fill([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">'*'</span>); <span class="comment">// -&gt; ['*', '*', '*']</span></span><br><span class="line">fill([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">'*'</span>, <span class="number">1</span>, <span class="number">2</span>); <span class="comment">// -&gt; [1, '*', 3]</span></span><br></pre></td></tr></table></figure><h2 id="filter-1"><a href="#filter-1" class="headerlink" title="filter"></a>filter</h2><p>遍历集合中的每个元素，返回所有通过真值检测的元素组成的数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function filter&lt;T&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator: types.ListIterator&lt;T, boolean&gt;,<br>    context?: any<br>): T[];<br>function filter&lt;T&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator: types.ObjectIterator&lt;T, boolean&gt;,<br>    context?: any<br>): T[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要遍历的集合</td></tr><tr><td>predicate</td><td>真值检测函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>包含所有通过真值检测元素的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filter([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; [2, 4]</span></span><br></pre></td></tr></table></figure><h2 id="find-2"><a href="#find-2" class="headerlink" title="find"></a>find</h2><p>找到集合中第一个通过真值检测的元素。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function find&lt;T&gt;(<br>    object: types.List&lt;T&gt;,<br>    iterator: types.ListIterator&lt;T, boolean&gt;,<br>    context?: any<br>): T | undefined;<br>function find&lt;T&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator: types.ObjectIterator&lt;T, boolean&gt;,<br>    context?: any<br>): T | undefined;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>object</td><td>目标集合</td></tr><tr><td>iterator</td><td>真值检测函数</td></tr><tr><td>context</td><td>函数上下文</td></tr><tr><td>返回值</td><td>第一个通过的元素</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">find(</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'john'</span>,</span><br><span class="line">            age: <span class="number">24</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'jane'</span>,</span><br><span class="line">            age: <span class="number">23</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val.age === <span class="number">23</span>;</span><br><span class="line">    &#125;</span><br><span class="line">); <span class="comment">// -&gt; &#123;name: 'jane', age: 23&#125;</span></span><br></pre></td></tr></table></figure><h2 id="findIdx"><a href="#findIdx" class="headerlink" title="findIdx"></a>findIdx</h2><p>返回第一个通过真值检测元素在数组中的位置。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function findIdx(arr: any[], predicate: types.AnyFn): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标集合</td></tr><tr><td>predicate</td><td>真值检测函数</td></tr><tr><td>返回值</td><td>第一个符合条件元素的位置</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">findIdx(</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'john'</span>,</span><br><span class="line">            age: <span class="number">24</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'jane'</span>,</span><br><span class="line">            age: <span class="number">23</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val.age === <span class="number">23</span>;</span><br><span class="line">    &#125;</span><br><span class="line">); <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure><h2 id="findKey"><a href="#findKey" class="headerlink" title="findKey"></a>findKey</h2><p>返回对象中第一个通过真值检测的属性键名。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function findKey(<br>    obj: any,<br>    predicate: types.AnyFn,<br>    ctx?: any<br>): string | void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>predicate</td><td>真值检测函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>符合条件的键名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">findKey(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val === <span class="number">1</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; a</span></span><br></pre></td></tr></table></figure><h2 id="findLastIdx"><a href="#findLastIdx" class="headerlink" title="findLastIdx"></a>findLastIdx</h2><p>同 findIdx，只是查找顺序改为从后往前。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function findLastIdx(arr: any[], predicate: types.AnyFn): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标集合</td></tr><tr><td>predicate</td><td>真值检测函数</td></tr><tr><td>返回值</td><td>从后往前，第一个符合条件元素的位置</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">findLastIdx(</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'john'</span>,</span><br><span class="line">            age: <span class="number">24</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'jane'</span>,</span><br><span class="line">            age: <span class="number">23</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'kitty'</span>,</span><br><span class="line">            age: <span class="number">24</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val.age === <span class="number">24</span>;</span><br><span class="line">    &#125;</span><br><span class="line">); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="flatten"><a href="#flatten" class="headerlink" title="flatten"></a>flatten</h2><p>递归拍平数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function flatten(arr: any[]): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatten([<span class="string">'a'</span>, [<span class="string">'b'</span>, [<span class="string">'c'</span>]], <span class="string">'d'</span>, [<span class="string">'e'</span>]]); <span class="comment">// -&gt; ['a', 'b', 'c', 'd', 'e']</span></span><br></pre></td></tr></table></figure><h2 id="fnArgs"><a href="#fnArgs" class="headerlink" title="fnArgs"></a>fnArgs</h2><p>检验函数参数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fnArgs(types: string[], args: any): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>types</td><td>参数类型</td></tr><tr><td>args</td><td>Argument 对象</td></tr></tbody></table><p>如果检验失败，抛出异常。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    fnArgs([<span class="string">'number|string'</span>, <span class="string">'?Function'</span>, <span class="string">'...number'</span>], <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">15</span>);</span><br><span class="line">test(<span class="string">'test'</span>, () =&gt; &#123;&#125;);</span><br><span class="line">test(<span class="string">'test'</span>, () =&gt; &#123;&#125;, <span class="number">5</span>);</span><br><span class="line">test(); <span class="comment">// Throw error</span></span><br><span class="line">test(<span class="string">'test'</span>, <span class="string">'test'</span>); <span class="comment">// Throw error</span></span><br><span class="line">test(<span class="string">'test'</span>, () =&gt; &#123;&#125;, <span class="number">5</span>, <span class="string">'test'</span>); <span class="comment">// Throw error</span></span><br></pre></td></tr></table></figure><h2 id="fnParams"><a href="#fnParams" class="headerlink" title="fnParams"></a>fnParams</h2><p>获取函数的参数名列表。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fnParams(fn: types.AnyFn | string): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>目标函数</td></tr><tr><td>返回值</td><td>参数名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fnParams(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;&#125;); <span class="comment">// -&gt; ['a', 'b']</span></span><br></pre></td></tr></table></figure><h2 id="fnv1a"><a href="#fnv1a" class="headerlink" title="fnv1a"></a>fnv1a</h2><p>简单 FNV-1a 哈希算法实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fnv1a(str: string): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>目标字符串</td></tr><tr><td>返回值</td><td>哈希结果</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fnv1a(<span class="string">'test'</span>); <span class="comment">// -&gt; 2949673445</span></span><br></pre></td></tr></table></figure><h2 id="format"><a href="#format" class="headerlink" title="format"></a>format</h2><p>使用类似于 printf 的方式来格式化字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function format(str: string, …values: any[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>…values</td><td>替换占位符的值</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><h3 id="格式占位符"><a href="#格式占位符" class="headerlink" title="格式占位符"></a>格式占位符</h3><table><thead><tr><th>占位符</th><th>说明</th></tr></thead><tbody><tr><td>%s</td><td>字符串</td></tr><tr><td>%d, %i</td><td>整数</td></tr><tr><td>%f</td><td>浮点数</td></tr><tr><td>%o</td><td>对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(<span class="string">'%s_%s'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>); <span class="comment">// -&gt; 'foo_bar'</span></span><br></pre></td></tr></table></figure><h2 id="fraction"><a href="#fraction" class="headerlink" title="fraction"></a>fraction</h2><p>转换数字为分数形式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fraction(num: number): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>数字</td></tr><tr><td>返回值</td><td>对应的分数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fraction(<span class="number">1.2</span>); <span class="comment">// -&gt; '6/5'</span></span><br></pre></td></tr></table></figure><h2 id="freeze"><a href="#freeze" class="headerlink" title="freeze"></a>freeze</h2><p>Object.freeze 的快捷方式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function freeze&lt;T&gt;(obj: T): T;</code><br></pre><br></details><p>如果不支持 Object.freeze，使用 Object.defineProperties 进行模拟。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123; <span class="attr">b</span>: <span class="number">1</span> &#125;;</span><br><span class="line">freeze(a);</span><br><span class="line">a.b = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// -&gt; &#123;b: 1&#125;</span></span><br></pre></td></tr></table></figure><h2 id="freezeDeep"><a href="#freezeDeep" class="headerlink" title="freezeDeep"></a>freezeDeep</h2><p>递归进行 Object.freeze。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function freezeDeep&lt;T&gt;(obj: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123; <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">1</span> &#125; &#125;;</span><br><span class="line">freezeDeep(a);</span><br><span class="line">a.b.c = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// -&gt; &#123;b: &#123;c: 1&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h2><p>node.js fs 模块的 promise 版本。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const fs: {<br>    readFile(path: string, encoding: string): Promise&lt;string&gt;;<br>    readFile(path: string): Promise&lt;Buffer&gt;;<br>    exists(path: string): Promise&lt;boolean&gt;;<br>    unlink(path: string): Promise&lt;void&gt;;<br>    writeFile(path: string, data: string, options?: string): Promise&lt;void&gt;;<br>    writeFile(path: string, data: Buffer): Promise&lt;void&gt;;<br>    readdir(path: string): Promise&lt;string[]&gt;;<br>    rmdir(path: string): Promise&lt;void&gt;;<br>    [key: string]: any;<br>};</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'test.js'</span>)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Do something</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Handle errors</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="fullscreen"><a href="#fullscreen" class="headerlink" title="fullscreen"></a>fullscreen</h2><p>全屏接口封装。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace fullscreen {<br>    interface IFullscreen extends Emitter {<br>        request(el?: Element): void;<br>        exit(): void;<br>        toggle(el?: Element): void;<br>        isActive(): boolean;<br>        getEl(): Element | null;<br>        isEnabled(): boolean;<br>    }<br>}<br>const fullscreen: fullscreen.IFullscreen;</code><br></pre><br></details><h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><p>进入全屏。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>el</td><td>Element</td><td>全屏元素</td></tr></tbody></table><h3 id="exit"><a href="#exit" class="headerlink" title="exit"></a>exit</h3><p>退出全屏。</p><h3 id="toggle-1"><a href="#toggle-1" class="headerlink" title="toggle"></a>toggle</h3><p>切换全屏。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>el</td><td>全屏元素</td></tr></tbody></table><h3 id="isActive"><a href="#isActive" class="headerlink" title="isActive"></a>isActive</h3><p>是否全屏。</p><h3 id="getEl"><a href="#getEl" class="headerlink" title="getEl"></a>getEl</h3><p>获取全屏元素。</p><h3 id="isEnabled"><a href="#isEnabled" class="headerlink" title="isEnabled"></a>isEnabled</h3><p>是否可以进入全屏。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fullscreen.request();</span><br><span class="line">fullscreen.isActive(); <span class="comment">// -&gt; false, not a synchronous api</span></span><br><span class="line">fullscreen.on(<span class="string">'error'</span>, () =&gt; &#123;&#125;);</span><br><span class="line">fullscreen.on(<span class="string">'change'</span>, () =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><h2 id="fuzzySearch"><a href="#fuzzySearch" class="headerlink" title="fuzzySearch"></a>fuzzySearch</h2><p>模糊搜索。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function fuzzySearch(<br>    needle: string,<br>    haystack: any[],<br>    options?: {<br>        caseSensitive?: boolean;<br>        key?: string | string[];<br>    }<br>): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>needle</td><td>搜索字符串</td></tr><tr><td>haystacks</td><td>搜索集合</td></tr><tr><td>options</td><td>搜索选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>caseSensitive=false</td><td>是否大小写敏感</td></tr><tr><td>key</td><td>搜索项是对象时的字符串路径</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fuzzySearch(<span class="string">'lic'</span>, [<span class="string">'licia'</span>, <span class="string">'ll'</span>, <span class="string">'lic'</span>]); <span class="comment">// -&gt; ['lic', 'licia']</span></span><br><span class="line">fuzzySearch(</span><br><span class="line">    <span class="string">'alpha-test'</span>,</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'alpha-test-1'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'beta-test'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &#123;</span><br><span class="line">        key: <span class="string">'name'</span></span><br><span class="line">    &#125;</span><br><span class="line">); <span class="comment">// -&gt; [&#123; name: 'alpha-test-1' &#125;]</span></span><br></pre></td></tr></table></figure><h2 id="gcd"><a href="#gcd" class="headerlink" title="gcd"></a>gcd</h2><p>使用欧几里德算法求最大公约数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function gcd(a: number, b: number): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>a</td><td>要计算的数字</td></tr><tr><td>b</td><td>要计算的数字</td></tr><tr><td>返回值</td><td>最大公约数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcd(<span class="number">121</span>, <span class="number">44</span>); <span class="comment">// -&gt; 11</span></span><br></pre></td></tr></table></figure><h2 id="getPort"><a href="#getPort" class="headerlink" title="getPort"></a>getPort</h2><p>获取有效的 TCP 端口。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function getPort(<br>    port?: number | number[],<br>    host?: string<br>): Promise&lt;number&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>port</td><td>首选端口</td></tr><tr><td>host</td><td>地址</td></tr><tr><td>返回值</td><td>有效端口</td></tr></tbody></table><p>如果首选端口无法使用，将会返回一个有效的随机端口。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getPort([<span class="number">3000</span>, <span class="number">3001</span>], <span class="string">'127.0.0.1'</span>).then(<span class="function"><span class="params">port</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(port);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="getProto"><a href="#getProto" class="headerlink" title="getProto"></a>getProto</h2><p>获取对象的原型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function getProto(obj: any): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>对象原型，如果不存在，返回 null</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;&#125;;</span><br><span class="line">getProto(<span class="built_in">Object</span>.create(a)); <span class="comment">// -&gt; a</span></span><br></pre></td></tr></table></figure><h2 id="getUrlParam"><a href="#getUrlParam" class="headerlink" title="getUrlParam"></a>getUrlParam</h2><p>获取 url 参数值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function getUrlParam(<br>    name: string,<br>    url?: string<br>): string | undefined;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>参数名</td></tr><tr><td>url=location</td><td>目标 url</td></tr><tr><td>返回值</td><td>参数值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getUrlParam(<span class="string">'test'</span>, <span class="string">'http://example.com/?test=true'</span>); <span class="comment">// -&gt; 'true'</span></span><br></pre></td></tr></table></figure><h2 id="golangify"><a href="#golangify" class="headerlink" title="golangify"></a>golangify</h2><p>像 Go 一样处理错误。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function golangify&lt;T, U = Error&gt;(<br>    fn: (…args: any[]) =&gt; Promise&lt;T&gt;<br>): (…args: any[]) =&gt; Promise&lt;[T | undefined, U | null]&gt;;<br>function golangify&lt;T, U = Error&gt;(<br>    p: Promise&lt;T&gt;<br>): Promise&lt;[T | undefined, U | null]&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>返回 Promise 的函数</td></tr><tr><td>返回值</td><td>同上，但 Promise 的结果形式为 [result, error]</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>p</td><td>要转换的 Promise</td></tr><tr><td>返回值</td><td>目标 Promise，结果形式为 [result, error]</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> fnA = golangify(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'err'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> fnA(); <span class="comment">// -&gt; [undefined, Error]</span></span><br><span class="line">    <span class="keyword">let</span> fnB = golangify(<span class="keyword">async</span> num =&gt; num * <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">await</span> fnB(<span class="number">2</span>); <span class="comment">// -&gt; [4, null]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> golangify(<span class="built_in">Promise</span>.reject(<span class="built_in">Error</span>(<span class="string">'err'</span>))); <span class="comment">// -&gt; [undefined, Error]</span></span><br><span class="line">    <span class="keyword">await</span> golangify(<span class="built_in">Promise</span>.resolve(<span class="number">4</span>)); <span class="comment">// -&gt; [4, null]</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h2 id="h"><a href="#h" class="headerlink" title="h"></a>h</h2><p>创建 HTML 元素。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function h(<br>    tag: string,<br>    attrs?: types.PlainObj&lt;any&gt;,<br>    …child: Array&lt;string | HTMLElement&gt;<br>): HTMLElement;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tag</td><td>标签名</td></tr><tr><td>attrs</td><td>属性</td></tr><tr><td>…child</td><td>子节点</td></tr><tr><td>返回值</td><td>目标元素</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el = h(</span><br><span class="line">    <span class="string">'div#test.title'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        onclick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        title: <span class="string">'test'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'inner text'</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(el);</span><br></pre></td></tr></table></figure><h2 id="has-5"><a href="#has-5" class="headerlink" title="has"></a>has</h2><p>检查属性是否是对象自身的属性（原型链上的不算）。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function has(obj: {}, key: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>key</td><td>键名</td></tr><tr><td>返回值</td><td>如果是自身的属性，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">has(&#123; <span class="attr">one</span>: <span class="number">1</span> &#125;, <span class="string">'one'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="heapSort"><a href="#heapSort" class="headerlink" title="heapSort"></a>heapSort</h2><p>堆排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function heapSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heapSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="hex"><a href="#hex" class="headerlink" title="hex"></a>hex</h2><p>hex 编解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const hex: {<br>    encode(bytes: number[]): string;<br>    decode(str: string): number[];<br>};</code><br></pre><br></details><h3 id="encode-1"><a href="#encode-1" class="headerlink" title="encode"></a>encode</h3><p>将字节数组编码为 hex 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>bytes</td><td>字节数组</td></tr><tr><td>返回值</td><td>hex 编码的字符串</td></tr></tbody></table><h3 id="decode-1"><a href="#decode-1" class="headerlink" title="decode"></a>decode</h3><p>将 hex 字符串解码为字节数组。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>hex 编码的字符串</td></tr><tr><td>返回值</td><td>字节数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hex.encode([<span class="number">168</span>, <span class="number">174</span>, <span class="number">155</span>, <span class="number">255</span>]); <span class="comment">// -&gt; 'a8ae9bff'</span></span><br><span class="line">hex.decode(<span class="string">'a8ae9bff'</span>); <span class="comment">// -&gt; [168, 174, 155, 255]</span></span><br></pre></td></tr></table></figure><h2 id="highlight"><a href="#highlight" class="headerlink" title="highlight"></a>highlight</h2><p>高亮代码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function highlight(<br>    str: string,<br>    lang?: string,<br>    style?: {<br>        comment?: string;<br>        string?: string;<br>        number?: string;<br>        keyword?: string;<br>        operator?: string;<br>    }<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>代码字符串</td></tr><tr><td>lang=js</td><td>语言，js，html 或者 css</td></tr><tr><td>style</td><td>高亮样式</td></tr><tr><td>返回值</td><td>高亮后的 html 代码字符串</td></tr></tbody></table><p>可设置样式：</p><p>comment，string，number，keyword，operator</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">highlight(<span class="string">'const a = 5;'</span>, <span class="string">'js'</span>, &#123;</span><br><span class="line">    keyword: <span class="string">'color:#569cd6;'</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; '&lt;span class="keyword" style="color:#569cd6;"&gt;const&lt;/span&gt; a &lt;span class="operator" style="color:#994500;"&gt;=&lt;/span&gt; &lt;span class="number" style="color:#0086b3;"&gt;5&lt;/span&gt;;'</span></span><br></pre></td></tr></table></figure><h2 id="hookFn"><a href="#hookFn" class="headerlink" title="hookFn"></a>hookFn</h2><p>监听，修改函数参数和结果。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function hookFn&lt;T&gt;(<br>    fn: T,<br>    options: {<br>        before?: types.AnyFn;<br>        after?: types.AnyFn;<br>        error?: types.AnyFn;<br>    }<br>): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>要监听修改的函数</td></tr><tr><td>options</td><td>监听选项</td></tr><tr><td>返回值</td><td>包装后的函数</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>before</td><td>参数处理函数</td></tr><tr><td>after</td><td>结果处理函数</td></tr><tr><td>error</td><td>异常处理函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'a is bigger than 100'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> totalSum = <span class="number">0</span>;</span><br><span class="line">sum = hookFn(sum, &#123;</span><br><span class="line">    before(a, b) &#123;</span><br><span class="line">        <span class="keyword">return</span> [+a, +b];</span><br><span class="line">    &#125;,</span><br><span class="line">    after(result) &#123;</span><br><span class="line">        totalSum += result;</span><br><span class="line">        <span class="keyword">return</span> totalSum;</span><br><span class="line">    &#125;,</span><br><span class="line">    error() &#123;</span><br><span class="line">        <span class="keyword">return</span> totalSum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">sum(<span class="string">'2'</span>, <span class="string">'5'</span>); <span class="comment">// -&gt; 7</span></span><br></pre></td></tr></table></figure><h2 id="hotkey"><a href="#hotkey" class="headerlink" title="hotkey"></a>hotkey</h2><p>监听键盘触发对应的事件。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const hotkey: {<br>    on(key: string, listener: types.AnyFn): void;<br>    off(key: string, listener: types.AnyFn): void;<br>};</code><br></pre><br></details><h3 id="on-1"><a href="#on-1" class="headerlink" title="on"></a>on</h3><p>注册键盘按键监听器。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>按键</td></tr><tr><td>listener</td><td>监听器</td></tr></tbody></table><h3 id="off-1"><a href="#off-1" class="headerlink" title="off"></a>off</h3><p>注销监听器。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hotkey.on(<span class="string">'k'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'k is pressed'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyDown</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">hotkey.on(<span class="string">'shift+a, shift+b'</span>, keyDown);</span><br><span class="line">hotkey.off(<span class="string">'shift+a'</span>, keyDown);</span><br></pre></td></tr></table></figure><h2 id="hslToRgb"><a href="#hslToRgb" class="headerlink" title="hslToRgb"></a>hslToRgb</h2><p>将 hsl 格式的颜色值转换为 rgb 格式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function hslToRgb(hsl: number[]): number[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>hsl</td><td>hsl 值</td></tr><tr><td>返回值</td><td>rgb 值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hslToRgb([<span class="number">165</span>, <span class="number">59</span>, <span class="number">50</span>, <span class="number">0.8</span>]); <span class="comment">// -&gt; [52, 203, 165, 0.8]</span></span><br></pre></td></tr></table></figure><h2 id="html-1"><a href="#html-1" class="headerlink" title="html"></a>html</h2><p>HTML 解析器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const html: {<br>    parse(html: string): any[];<br>    stringify(tree: any[]): string;<br>};</code><br></pre><br></details><h3 id="parse-3"><a href="#parse-3" class="headerlink" title="parse"></a>parse</h3><p>将 HTML 字符串转换为 js 对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>html</td><td>HTML 字符串</td></tr><tr><td>返回值</td><td>js 对象</td></tr></tbody></table><h3 id="stringify-2"><a href="#stringify-2" class="headerlink" title="stringify"></a>stringify</h3><p>将 js 对象序列化成 HTML 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tree</td><td>要序列化的对象</td></tr><tr><td>返回值</td><td>HTML 字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = html.parse(<span class="string">'&lt;div id="name"&gt;licia&lt;/div&gt;'</span>);</span><br><span class="line"><span class="comment">// -&gt; [&#123;tag: 'div', attrs: &#123;id: 'name'&#125;, content: ['licia']&#125;]</span></span><br><span class="line">html.stringify(tree);</span><br></pre></td></tr></table></figure><h2 id="identity"><a href="#identity" class="headerlink" title="identity"></a>identity</h2><p>返回传入的第一个参数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function identity&lt;T&gt;(val: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>任何值</td></tr><tr><td>返回值</td><td>第一个参数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">identity(<span class="string">'a'</span>); <span class="comment">// -&gt; 'a'</span></span><br></pre></td></tr></table></figure><h2 id="idxOf"><a href="#idxOf" class="headerlink" title="idxOf"></a>idxOf</h2><p>返回指定值第一次在数组中出现的位置。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function idxOf(arr: any[], val: any, fromIdx?: number): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标数组</td></tr><tr><td>val</td><td>要查找的值</td></tr><tr><td>fromIdx=0</td><td>查找起始位置</td></tr><tr><td>返回值</td><td>第一次出现的位置，如果没有，返回 -1</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idxOf([<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>], <span class="number">2</span>, <span class="number">2</span>); <span class="comment">// -&gt; 3</span></span><br></pre></td></tr></table></figure><h2 id="indent"><a href="#indent" class="headerlink" title="indent"></a>indent</h2><p>对文本的每一行进行缩进处理。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function indent(<br>    str: string,<br>    char?: string,<br>    len?: number<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>char</td><td>缩进字符</td></tr><tr><td>len</td><td>缩进长度</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">indent(<span class="string">'foo\nbar'</span>, <span class="string">' '</span>, <span class="number">4</span>); <span class="comment">// -&gt; '    foo\n    bar'</span></span><br></pre></td></tr></table></figure><h2 id="inherits"><a href="#inherits" class="headerlink" title="inherits"></a>inherits</h2><p>使构造函数继承另一个构造函数原型链上的方法。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function inherits(<br>    Class: types.AnyFn,<br>    SuperClass: types.AnyFn<br>): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>Class</td><td>子类</td></tr><tr><td>SuperClass</td><td>父类</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._name = name;</span><br><span class="line">&#125;</span><br><span class="line">People.prototype = &#123;</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._name = name;</span><br><span class="line">&#125;</span><br><span class="line">inherits(Student, People);</span><br><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> Student(<span class="string">'RedHood'</span>);</span><br><span class="line">s.getName(); <span class="comment">// -&gt; 'RedHood'</span></span><br></pre></td></tr></table></figure><h2 id="ini"><a href="#ini" class="headerlink" title="ini"></a>ini</h2><p>ini 文件解析器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const ini: {<br>    parse(ini: string): any;<br>    stringify(<br>        obj: any,<br>        options?: {<br>            section?: string;<br>            whitespace: boolean;<br>        }<br>    ): string;<br>};</code><br></pre><br></details><h3 id="parse-4"><a href="#parse-4" class="headerlink" title="parse"></a>parse</h3><p>将 ini 文件转换为 js 对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>ini</td><td>ini 文件</td></tr><tr><td>返回值</td><td>js 对象</td></tr></tbody></table><h3 id="stringify-3"><a href="#stringify-3" class="headerlink" title="stringify"></a>stringify</h3><p>将 js 对象序列化成 ini 文件格式。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要序列化的对象</td></tr><tr><td>options</td><td>序列化选项</td></tr><tr><td>返回值</td><td>ini 文件</td></tr></tbody></table><p>选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>section</td><td>顶部名称</td></tr><tr><td>whitespace=false</td><td>是否在 = 周围添加空格</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = ini.parse(<span class="string">`</span></span><br><span class="line"><span class="string">; This is a comment</span></span><br><span class="line"><span class="string">library = licia</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[user.info]</span></span><br><span class="line"><span class="string">name = surunzi</span></span><br><span class="line"><span class="string">alias[] = redhoodsu</span></span><br><span class="line"><span class="string">alias[] = red</span></span><br><span class="line"><span class="string">`</span>); <span class="comment">// -&gt; &#123;library: 'licia', user: &#123;info: &#123;name: 'surunzi', alias: ['redhoodsu', 'red']&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">ini.stringify(config);</span><br></pre></td></tr></table></figure><h2 id="insertionSort"><a href="#insertionSort" class="headerlink" title="insertionSort"></a>insertionSort</h2><p>插入排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function insertionSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insertionSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="intersect"><a href="#intersect" class="headerlink" title="intersect"></a>intersect</h2><p>计算所有数组的交集。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function intersect(…arr: Array&lt;any[]&gt;): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…arr</td><td>源数组</td></tr><tr><td>返回值</td><td>交集</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intersect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>], [<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="intersectRange"><a href="#intersectRange" class="headerlink" title="intersectRange"></a>intersectRange</h2><p>计算两个区间的交集。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace intersectRange {<br>    interface IRange {<br>        start: number;<br>        end: number;<br>    }<br>}<br>function intersectRange(<br>    a: intersectRange.IRange,<br>    b: intersectRange.IRange<br>): intersectRange.IRange | void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>a</td><td>区间 a</td></tr><tr><td>b</td><td>区间 b</td></tr><tr><td>返回值</td><td>如果存在区间交集，返回它</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">intersectRange(&#123; <span class="attr">start</span>: <span class="number">0</span>, <span class="attr">end</span>: <span class="number">12</span> &#125;, &#123; <span class="attr">start</span>: <span class="number">11</span>, <span class="attr">end</span>: <span class="number">13</span> &#125;);</span><br><span class="line"><span class="comment">// -&gt; &#123;start: 11, end: 12&#125;</span></span><br><span class="line">intersectRange(&#123; <span class="attr">start</span>: <span class="number">0</span>, <span class="attr">end</span>: <span class="number">5</span> &#125;, &#123; <span class="attr">start</span>: <span class="number">6</span>, <span class="attr">end</span>: <span class="number">7</span> &#125;);</span><br><span class="line"><span class="comment">// -&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="invariant"><a href="#invariant" class="headerlink" title="invariant"></a>invariant</h2><p>Facebook 的 invariant 模块。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function invariant(<br>    condition: boolean,<br>    format?: string,<br>    a?: string,<br>    b?: string,<br>    c?: string,<br>    d?: string,<br>    e?: string,<br>    f?: string<br>): void;</code><br></pre><br></details><p><a href="https://github.com/zertosh/invariant" target="_blank" rel="noopener">相关文档</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">invariant(<span class="literal">true</span>, <span class="string">'This will not throw'</span>);</span><br><span class="line"><span class="comment">// No errors</span></span><br><span class="line">invariant(<span class="literal">false</span>, <span class="string">'This will throw an error with this message'</span>);</span><br><span class="line"><span class="comment">// Error: Invariant Violation: This will throw an error with this message</span></span><br></pre></td></tr></table></figure><h2 id="invert"><a href="#invert" class="headerlink" title="invert"></a>invert</h2><p>生成一个新对象，该对象的键名和键值进行调换。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function invert(obj: any): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>源对象</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><p>如果对象存在重复的键值，后面的值会覆盖前面的值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invert(&#123; <span class="attr">a</span>: <span class="string">'b'</span>, <span class="attr">c</span>: <span class="string">'d'</span>, <span class="attr">e</span>: <span class="string">'f'</span> &#125;); <span class="comment">// -&gt; &#123;b: 'a', d: 'c', f: 'e'&#125;</span></span><br></pre></td></tr></table></figure><h2 id="isAbsoluteUrl"><a href="#isAbsoluteUrl" class="headerlink" title="isAbsoluteUrl"></a>isAbsoluteUrl</h2><p>检查 url 是否是绝对地址。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isAbsoluteUrl(url: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>目标 url</td></tr><tr><td>返回值</td><td>如果是绝对地址，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isAbsoluteUrl(<span class="string">'http://www.surunzi.com'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isAbsoluteUrl(<span class="string">'//www.surunzi.com'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isAbsoluteUrl(<span class="string">'surunzi.com'</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isArgs"><a href="#isArgs" class="headerlink" title="isArgs"></a>isArgs</h2><p>检查值是否是参数类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isArgs(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是参数类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">isArgs(</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">arguments</span>;</span><br><span class="line">    &#125;)()</span><br><span class="line">); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isArr"><a href="#isArr" class="headerlink" title="isArr"></a>isArr</h2><p>检查值是否是数组类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isArr(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是数组类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isArr([]); <span class="comment">// -&gt; true</span></span><br><span class="line">isArr(&#123;&#125;); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isArrBuffer"><a href="#isArrBuffer" class="headerlink" title="isArrBuffer"></a>isArrBuffer</h2><p>检查值是否是 ArrayBuffer 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isArrBuffer(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 ArrayBuffer 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isArrBuffer(<span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isArrLike"><a href="#isArrLike" class="headerlink" title="isArrLike"></a>isArrLike</h2><p>检查值是否是类数组对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isArrLike(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是类数组对象，返回真</td></tr></tbody></table><p>对于函数，返回假。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isArrLike(<span class="string">'test'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isArrLike(<span class="built_in">document</span>.body.children); <span class="comment">// -&gt; true;</span></span><br><span class="line">isArrLike([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isAsyncFn"><a href="#isAsyncFn" class="headerlink" title="isAsyncFn"></a>isAsyncFn</h2><p>检查值是否是 Async 函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isAsyncFn(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Async 函数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isAsyncFn(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; false</span></span><br><span class="line">isAsyncFn(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; false</span></span><br><span class="line">isAsyncFn(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isBlob"><a href="#isBlob" class="headerlink" title="isBlob"></a>isBlob</h2><p>检查值是否是 Blob 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isBlob(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Blob 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isBlob(<span class="keyword">new</span> Blob([])); <span class="comment">// -&gt; true;</span></span><br><span class="line">isBlob([]); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isBool"><a href="#isBool" class="headerlink" title="isBool"></a>isBool</h2><p>检查值是否是布尔类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isBool(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是布尔类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isBool(<span class="literal">true</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isBool(<span class="literal">false</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isBool(<span class="number">1</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isBrowser"><a href="#isBrowser" class="headerlink" title="isBrowser"></a>isBrowser</h2><p>检测是否运行于浏览器环境。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const isBrowser: boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isBrowser); <span class="comment">// -&gt; true if running in a browser</span></span><br></pre></td></tr></table></figure><h2 id="isBuffer"><a href="#isBuffer" class="headerlink" title="isBuffer"></a>isBuffer</h2><p>检查值是否是 Buffer 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isBuffer(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Buffer 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isBuffer(<span class="keyword">new</span> Buffer(<span class="number">4</span>)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isClose"><a href="#isClose" class="headerlink" title="isClose"></a>isClose</h2><p>检查两个数字是否近似相等。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isClose(<br>    a: number,<br>    b: number,<br>    relTol?: number,<br>    absTol?: number<br>): boolean;</code><br></pre><br></details><p><code>abs(a-b) &lt;= max(relTol * max(abs(a), abs(b)), absTol)</code></p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>a</td><td>要比较的数字</td></tr><tr><td>b</td><td>要比较的数字</td></tr><tr><td>relTol=1e-9</td><td>相对误差</td></tr><tr><td>absTol=0</td><td>绝对误差</td></tr><tr><td>返回值</td><td>如果近似相等，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">isClose(<span class="number">1</span>, <span class="number">1.0000000001</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isClose(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isClose(<span class="number">1</span>, <span class="number">1.2</span>, <span class="number">0.3</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isClose(<span class="number">1</span>, <span class="number">1.2</span>, <span class="number">0.1</span>, <span class="number">0.3</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isCyclic"><a href="#isCyclic" class="headerlink" title="isCyclic"></a>isCyclic</h2><p>检查值是否存在循环引用。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isCyclic(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果存在循环引用，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">isCyclic(&#123;&#125;); <span class="comment">// -&gt; false</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line">obj.b = obj;</span><br><span class="line">isCyclic(obj); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isDarkMode"><a href="#isDarkMode" class="headerlink" title="isDarkMode"></a>isDarkMode</h2><p>检测是否暗黑模式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isDarkMode(): boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isDarkMode()); <span class="comment">// true if dark mode</span></span><br></pre></td></tr></table></figure><h2 id="isDataUrl"><a href="#isDataUrl" class="headerlink" title="isDataUrl"></a>isDataUrl</h2><p>检查字符串是否是有效的 Data Url。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isDataUrl(str: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>要检查的字符串</td></tr><tr><td>返回值</td><td>如果是有效的 Data Url，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isDataUrl(<span class="string">'http://eustia.liriliri.io'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isDataUrl(<span class="string">'data:text/plain;base64,SGVsbG8sIFdvcmxkIQ%3D%3D'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isDate"><a href="#isDate" class="headerlink" title="isDate"></a>isDate</h2><p>检查值是否是 Date 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isDate(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Date 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isDate(<span class="keyword">new</span> <span class="built_in">Date</span>()); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isDir"><a href="#isDir" class="headerlink" title="isDir"></a>isDir</h2><p>检查路径是否是文件夹。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isDir(path: string): Promise&lt;boolean&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>要检查的路径</td></tr><tr><td>返回值</td><td>如果是文件夹，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isDir(<span class="string">'/foo/bar'</span>);</span><br></pre></td></tr></table></figure><h2 id="isEl"><a href="#isEl" class="headerlink" title="isEl"></a>isEl</h2><p>检查值是否是 DOM 元素。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isEl(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 DOM 元素，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isEl(<span class="built_in">document</span>.body); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isEmail"><a href="#isEmail" class="headerlink" title="isEmail"></a>isEmail</h2><p>简单检查值是否是合法的邮件地址。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isEmail(val: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是合法的邮件地址，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isEmail(<span class="string">'surunzi@foxmail.com'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty"></a>isEmpty</h2><p>检查值是否是空对象或空数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isEmpty(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果为空，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isEmpty([]); <span class="comment">// -&gt; true</span></span><br><span class="line">isEmpty(&#123;&#125;); <span class="comment">// -&gt; true</span></span><br><span class="line">isEmpty(<span class="string">''</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isEqual"><a href="#isEqual" class="headerlink" title="isEqual"></a>isEqual</h2><p>对两个对象进行深度比较，如果相等，返回真。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isEqual(val: any, other: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要比较的对象</td></tr><tr><td>other</td><td>要比较的对象</td></tr><tr><td>返回值</td><td>如果相等，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isEqual([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isErr"><a href="#isErr" class="headerlink" title="isErr"></a>isErr</h2><p>检查值是否是 Error 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isErr(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Error 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isErr(<span class="keyword">new</span> <span class="built_in">Error</span>()); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isEven"><a href="#isEven" class="headerlink" title="isEven"></a>isEven</h2><p>检查数字是否是偶数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isEven(num: number): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要检查的数字</td></tr><tr><td>返回值</td><td>如果是偶数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isEven(<span class="number">0</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isEven(<span class="number">1</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isEven(<span class="number">2</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isFile"><a href="#isFile" class="headerlink" title="isFile"></a>isFile</h2><p>检查值是否是 File 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isFile(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 File 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isFile(<span class="keyword">new</span> File([<span class="string">'test'</span>], <span class="string">'test.txt'</span>, &#123; <span class="attr">type</span>: <span class="string">'text/plain'</span> &#125;)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isFinite"><a href="#isFinite" class="headerlink" title="isFinite"></a>isFinite</h2><p>检查值是否是有限数字。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isFinite(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是有限数字，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isFinite</span>(<span class="number">3</span>); <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">isFinite</span>(<span class="literal">Infinity</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isFn"><a href="#isFn" class="headerlink" title="isFn"></a>isFn</h2><p>检查值是否是函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isFn(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是函数，返回真</td></tr></tbody></table><p>Generator 函数返回真。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isFn(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; true</span></span><br><span class="line">isFn(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; true</span></span><br><span class="line">isFn(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isFullWidth"><a href="#isFullWidth" class="headerlink" title="isFullWidth"></a>isFullWidth</h2><p>检查值是否是全角字符。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isFullWidth(codePoint: number): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>codePoint</td><td>Unicode 码点</td></tr><tr><td>返回值</td><td>如果字符是全角，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">isFullWidth(<span class="string">'a'</span>.codePointAt(<span class="number">0</span>)); <span class="comment">// -&gt; false</span></span><br><span class="line">isFullWidth(<span class="string">','</span>.codePointAt(<span class="number">0</span>)); <span class="comment">// -&gt; false</span></span><br><span class="line">isFullWidth(<span class="string">'我'</span>.codePointAt(<span class="number">0</span>)); <span class="comment">// -&gt; true</span></span><br><span class="line">isFullWidth(<span class="string">'，'</span>.codePointAt(<span class="number">0</span>)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isGeneratorFn"><a href="#isGeneratorFn" class="headerlink" title="isGeneratorFn"></a>isGeneratorFn</h2><p>检查值是否是 Generator 函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isGeneratorFn(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Generator 函数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isGeneratorFn(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; true</span></span><br><span class="line">isGeneratorFn(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isHidden"><a href="#isHidden" class="headerlink" title="isHidden"></a>isHidden</h2><p>检查元素是否隐藏。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isHidden(<br>    el: Element,<br>    options?: {<br>        display?: boolean;<br>        visibility?: boolean;<br>        opacity?: boolean;<br>        size?: boolean;<br>        viewport?: boolean;<br>        overflow?: boolean;<br>    }<br>): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>el</td><td>目标元素</td></tr><tr><td>options</td><td>检查选项</td></tr><tr><td>返回值</td><td>如果元素隐藏，返回真</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>display=true</td><td>检查是否显示</td></tr><tr><td>visibility=false</td><td>检查 visibility css 属性</td></tr><tr><td>opacity=false</td><td>检查 opacity css 属性</td></tr><tr><td>size=false</td><td>检查宽高</td></tr><tr><td>viewport=false</td><td>检查是否在可视区域</td></tr><tr><td>overflow=false</td><td>检查是否因 overflow 隐藏</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isHidden(<span class="built_in">document</span>.createElement(<span class="string">'div'</span>)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isInt"><a href="#isInt" class="headerlink" title="isInt"></a>isInt</h2><p>检查值是否是整数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isInt(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是整数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isInt(<span class="number">5</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isInt(<span class="number">5.1</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isInt(&#123;&#125;); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isIp"><a href="#isIp" class="headerlink" title="isIp"></a>isIp</h2><p>检查值是否是 IP 地址。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace isIp {<br>    function v4(str: string): boolean;<br>    function v6(str: string): boolean;<br>}<br>function isIp(str: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>要检查的字符串</td></tr><tr><td>返回值</td><td>如果是 IP 地址，返回真</td></tr></tbody></table><h3 id="v4"><a href="#v4" class="headerlink" title="v4"></a>v4</h3><p>检查值是否是 IPv4 地址。</p><h3 id="v6"><a href="#v6" class="headerlink" title="v6"></a>v6</h3><p>检查值是否是 IPv6 地址。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">isIp(<span class="string">'192.168.191.1'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isIp(<span class="string">'1:2:3:4:5:6:7:8'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isIp(<span class="string">'test'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isIp.v4(<span class="string">'192.168.191.1'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isIp.v6(<span class="string">'1:2:3:4:5:6:7:8'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isJson"><a href="#isJson" class="headerlink" title="isJson"></a>isJson</h2><p>检查值是否是有效的 JSON。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isJson(val: string): boolean;</code><br></pre><br></details><p>该模块使用 <code>JSON.parse()</code> 和 <code>try... catch</code> 进行检测。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>JSON 字符串</td></tr><tr><td>返回值</td><td>如果是有效的 JSON，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isJson(<span class="string">'&#123;"a": 5&#125;'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isJson(<span class="string">"&#123;'a': 5&#125;"</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isLeapYear"><a href="#isLeapYear" class="headerlink" title="isLeapYear"></a>isLeapYear</h2><p>检查年份是否是闰年。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isLeapYear(year: number): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>year</td><td>要检查的年份</td></tr><tr><td>返回值</td><td>如果是闰年，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isLeapYear(<span class="number">2000</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isLeapYear(<span class="number">2002</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isMap"><a href="#isMap" class="headerlink" title="isMap"></a>isMap</h2><p>检查值是否是 Map 对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isMap(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Map 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isMap(<span class="keyword">new</span> <span class="built_in">Map</span>()); <span class="comment">// -&gt; true</span></span><br><span class="line">isMap(<span class="keyword">new</span> <span class="built_in">WeakMap</span>()); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isMatch-1"><a href="#isMatch-1" class="headerlink" title="isMatch"></a>isMatch</h2><p>检查对象所有键名和键值是否在指定的对象中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isMatch(obj: any, src: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>src</td><td>进行匹配的对象</td></tr><tr><td>返回值</td><td>如果匹配，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isMatch(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isMiniProgram"><a href="#isMiniProgram" class="headerlink" title="isMiniProgram"></a>isMiniProgram</h2><p>检测是否运行于微信小程序环境中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const isMiniProgram: boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isMiniProgram); <span class="comment">// -&gt; true if running in mini program.</span></span><br></pre></td></tr></table></figure><h2 id="isMobile"><a href="#isMobile" class="headerlink" title="isMobile"></a>isMobile</h2><p>使用 ua 检测是否运行于移动端浏览器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isMobile(ua?: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>ua=navigator.userAgent</td><td>浏览器用户代理</td></tr><tr><td>返回值</td><td>如果是移动端浏览器，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isMobile(navigator.userAgent);</span><br></pre></td></tr></table></figure><h2 id="isNaN"><a href="#isNaN" class="headerlink" title="isNaN"></a>isNaN</h2><p>检测值是否是 NaN。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isNaN(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 NaN，返回真</td></tr></tbody></table><p>跟全局 isNaN 不同的是，Undefined 不是 NaN。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isNaN</span>(<span class="number">0</span>); <span class="comment">// -&gt; false</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="literal">NaN</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isNative"><a href="#isNative" class="headerlink" title="isNative"></a>isNative</h2><p>检查值是否是原生函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isNative(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是原生函数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isNative(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; false</span></span><br><span class="line">isNative(<span class="built_in">Math</span>.min); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isNil"><a href="#isNil" class="headerlink" title="isNil"></a>isNil</h2><p>检查值是否是 null 或 undefined，等价于 value == null。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isNil(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 null 或 undefined，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">isNil(<span class="literal">null</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNil(<span class="keyword">void</span> <span class="number">0</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNil(<span class="literal">undefined</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNil(<span class="literal">false</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isNil(<span class="number">0</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isNil([]); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isNode"><a href="#isNode" class="headerlink" title="isNode"></a>isNode</h2><p>检测是否运行于 node 环境中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const isNode: boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isNode); <span class="comment">// -&gt; true if running in node</span></span><br></pre></td></tr></table></figure><h2 id="isNull"><a href="#isNull" class="headerlink" title="isNull"></a>isNull</h2><p>检查值是否是 Null 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isNull(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Null 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isNull(<span class="literal">null</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isNum"><a href="#isNum" class="headerlink" title="isNum"></a>isNum</h2><p>检测值是否是数字类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isNum(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是数字，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isNum(<span class="number">5</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNum(<span class="number">5.1</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNum(&#123;&#125;); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isNumeric"><a href="#isNumeric" class="headerlink" title="isNumeric"></a>isNumeric</h2><p>检查值是否是数字，包括数字字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isNumeric(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是数字，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">isNumeric(<span class="number">1</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNumeric(<span class="string">'1'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNumeric(<span class="built_in">Number</span>.MAX_VALUE); <span class="comment">// -&gt; true</span></span><br><span class="line">isNumeric(<span class="number">0xff</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isNumeric(<span class="string">''</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isNumeric(<span class="string">'1.1.1'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isNumeric(<span class="literal">NaN</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isObj"><a href="#isObj" class="headerlink" title="isObj"></a>isObj</h2><p>检查值是否是对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isObj(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是对象，返回真</td></tr></tbody></table><p><a href="http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-language-types" target="_blank" rel="noopener">标准定义</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isObj(&#123;&#125;); <span class="comment">// -&gt; true</span></span><br><span class="line">isObj([]); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isOdd"><a href="#isOdd" class="headerlink" title="isOdd"></a>isOdd</h2><p>检查数字是否是奇数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isOdd(num: number): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要检查的数字</td></tr><tr><td>返回值</td><td>如果是奇数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isOdd(<span class="number">0</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">isOdd(<span class="number">1</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isOdd(<span class="number">2</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isPlainObj"><a href="#isPlainObj" class="headerlink" title="isPlainObj"></a>isPlainObj</h2><p>检查值是否是用 Object 构造函数创建的对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isPlainObj(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 plain object，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isPlainObj(&#123;&#125;); <span class="comment">// -&gt; true</span></span><br><span class="line">isPlainObj([]); <span class="comment">// -&gt; false</span></span><br><span class="line">isPlainObj(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isPortFree"><a href="#isPortFree" class="headerlink" title="isPortFree"></a>isPortFree</h2><p>检查 TCP 端口是否可用。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isPortFree(<br>    port: number,<br>    host?: string<br>): Promise&lt;boolean&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>port</td><td>TCP 端口</td></tr><tr><td>host</td><td>地址</td></tr><tr><td>返回值</td><td>如果端口可用，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isPortFree(<span class="number">3000</span>).then(<span class="function"><span class="params">isFree</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="isPrime"><a href="#isPrime" class="headerlink" title="isPrime"></a>isPrime</h2><p>检查整数是否是质数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isPrime(num: number): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要检查的数字</td></tr><tr><td>返回值</td><td>如果是质数，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isPrime(<span class="number">11</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isPrime(<span class="number">8</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isPrimitive"><a href="#isPrimitive" class="headerlink" title="isPrimitive"></a>isPrimitive</h2><p>检测值是否是字符串，数字，布尔值或 null。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isPrimitive(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是原始类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isPrimitive(<span class="number">5</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isPrimitive(<span class="string">'abc'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isPrimitive(<span class="literal">false</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isPromise"><a href="#isPromise" class="headerlink" title="isPromise"></a>isPromise</h2><p>检查值是否是类 promise 对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isPromise(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是类 promise 对象，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isPromise(<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)); <span class="comment">// -&gt; true</span></span><br><span class="line">isPromise(&#123;&#125;); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isRegExp"><a href="#isRegExp" class="headerlink" title="isRegExp"></a>isRegExp</h2><p>检查值是否是正则类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isRegExp(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是正则类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isRegExp(<span class="regexp">/a/</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isRelative"><a href="#isRelative" class="headerlink" title="isRelative"></a>isRelative</h2><p>检查路径是否是相对路径。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isRelative(path: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>要检查的路径</td></tr><tr><td>返回值</td><td>如果是相对路径，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isRelative(<span class="string">'README.md'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isRetina"><a href="#isRetina" class="headerlink" title="isRetina"></a>isRetina</h2><p>判断是否运行在 retina 屏幕的设备上。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const isRetina: boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isRetina); <span class="comment">// -&gt; true if high DPR</span></span><br></pre></td></tr></table></figure><h2 id="isRunning"><a href="#isRunning" class="headerlink" title="isRunning"></a>isRunning</h2><p>检查进程是否运行中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isRunning(pid: number): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>pid</td><td>进程 id</td></tr><tr><td>返回值</td><td>如果进程运行中，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isRunning(<span class="number">123456</span>); <span class="comment">// true if running</span></span><br></pre></td></tr></table></figure><h2 id="isSet"><a href="#isSet" class="headerlink" title="isSet"></a>isSet</h2><p>检查值是否是 Set 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isSet(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Set 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isSet(<span class="keyword">new</span> <span class="built_in">Set</span>()); <span class="comment">// -&gt; true</span></span><br><span class="line">isSet(<span class="keyword">new</span> <span class="built_in">WeakSet</span>()); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isSorted"><a href="#isSorted" class="headerlink" title="isSorted"></a>isSorted</h2><p>检查数组是否有序。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isSorted(arr: any[], cmp?: types.AnyFn): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>如果数组有序，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isSorted([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; true</span></span><br><span class="line">isSorted([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isStr"><a href="#isStr" class="headerlink" title="isStr"></a>isStr</h2><p>检查值是否是字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isStr(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是字符串，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isStr(<span class="string">'licia'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isStream"><a href="#isStream" class="headerlink" title="isStream"></a>isStream</h2><p>检查值是否是 Node.js Stream 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isStream(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Node.js Stream 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="built_in">require</span>(<span class="string">'stream'</span>);</span><br><span class="line"></span><br><span class="line">isStream(<span class="keyword">new</span> stream.Stream()); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isSymbol"><a href="#isSymbol" class="headerlink" title="isSymbol"></a>isSymbol</h2><p>检查值是否是 Symbol 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isSymbol(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 Symbol 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isSymbol(<span class="built_in">Symbol</span>(<span class="string">'test'</span>)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isTypedArr"><a href="#isTypedArr" class="headerlink" title="isTypedArr"></a>isTypedArr</h2><p>检查值是否 TypedArray 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isTypedArr(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果值是 TypedArray 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isTypedArr([]); <span class="comment">// -&gt; false</span></span><br><span class="line">isTypedArr(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="number">8</span>)); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isUndef"><a href="#isUndef" class="headerlink" title="isUndef"></a>isUndef</h2><p>检查值是否是 undefined。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isUndef(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 undefined，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isUndef(<span class="keyword">void</span> <span class="number">0</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">isUndef(<span class="literal">null</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="isUrl"><a href="#isUrl" class="headerlink" title="isUrl"></a>isUrl</h2><p>简单检查值是否是有效的 url 地址。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isUrl(val: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是有效的 url 地址，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isUrl(<span class="string">'http://www.example.com?foo=bar&amp;param=test'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isWeakMap"><a href="#isWeakMap" class="headerlink" title="isWeakMap"></a>isWeakMap</h2><p>检查值是否是 WeakMap 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isWeakMap(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 WeakMap 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isWeakMap(<span class="keyword">new</span> <span class="built_in">Map</span>()); <span class="comment">// -&gt; false</span></span><br><span class="line">isWeakMap(<span class="keyword">new</span> <span class="built_in">WeakMap</span>()); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isWeakSet"><a href="#isWeakSet" class="headerlink" title="isWeakSet"></a>isWeakSet</h2><p>检查值是否是 WeakSet 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function isWeakSet(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要检查的值</td></tr><tr><td>返回值</td><td>如果是 WeakSet 类型，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isWeakSet(<span class="keyword">new</span> <span class="built_in">Set</span>()); <span class="comment">// -&gt; false</span></span><br><span class="line">isWeakSet(<span class="keyword">new</span> <span class="built_in">WeakSet</span>()); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="isWindows"><a href="#isWindows" class="headerlink" title="isWindows"></a>isWindows</h2><p>检测是否运行在 windows 操作系统上。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const isWindows: boolean;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isWindows); <span class="comment">// -&gt; true if running on windows</span></span><br></pre></td></tr></table></figure><h2 id="jsonClone"><a href="#jsonClone" class="headerlink" title="jsonClone"></a>jsonClone</h2><p>使用 JSON parse 和 stringify 方法对指定对象进行复制。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function jsonClone&lt;T&gt;(val: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要克隆的值</td></tr><tr><td>返回值</td><td>克隆值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jsonClone(&#123; <span class="attr">name</span>: <span class="string">'licia'</span> &#125;); <span class="comment">// -&gt; &#123; name: 'licia' &#125;</span></span><br></pre></td></tr></table></figure><h2 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h2><p>简单 jsonp 实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function jsonp(options: {<br>    url: string;<br>    data?: any;<br>    success?: types.AnyFn;<br>    param?: string;<br>    name?: string;<br>    error?: types.AnyFn;<br>    complete?: types.AnyFn;<br>    timeout?: number;<br>}): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>jsonp 选项</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>请求地址</td></tr><tr><td>data</td><td>请求数据</td></tr><tr><td>success</td><td>成功回调</td></tr><tr><td>param=callback</td><td>回调参数名</td></tr><tr><td>name</td><td>回调函数名</td></tr><tr><td>error</td><td>失败回调</td></tr><tr><td>complete</td><td>结束回调</td></tr><tr><td>timeout</td><td>请求超时</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jsonp(&#123;</span><br><span class="line">    url: <span class="string">'http://example.com'</span>,</span><br><span class="line">    data: &#123; <span class="attr">test</span>: <span class="string">'true'</span> &#125;,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="kebabCase"><a href="#kebabCase" class="headerlink" title="kebabCase"></a>kebabCase</h2><p>将字符串转换为短横线式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function kebabCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>短横线式字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kebabCase(<span class="string">'fooBar'</span>); <span class="comment">// -&gt; foo-bar</span></span><br><span class="line">kebabCase(<span class="string">'foo bar'</span>); <span class="comment">// -&gt; foo-bar</span></span><br><span class="line">kebabCase(<span class="string">'foo_bar'</span>); <span class="comment">// -&gt; foo-bar</span></span><br><span class="line">kebabCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; foo-bar</span></span><br></pre></td></tr></table></figure><h2 id="keyCode"><a href="#keyCode" class="headerlink" title="keyCode"></a>keyCode</h2><p>键码键名转换。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function keyCode(name: string): number;<br>function keyCode(code: number): string;</code><br></pre><br></details><p>获取键码对应的键名。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>code</td><td>键码</td></tr><tr><td>返回值</td><td>对应的键名</td></tr></tbody></table><p>获取键名对应的键码。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>键名</td></tr><tr><td>返回值</td><td>对应的键码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keyCode(<span class="number">13</span>); <span class="comment">// -&gt; 'enter'</span></span><br><span class="line">keyCode(<span class="string">'enter'</span>); <span class="comment">// -&gt; 13</span></span><br></pre></td></tr></table></figure><h2 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h2><p>返回包含对象自身可遍历所有键名的数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function keys(obj: any): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>所有键名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys(&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;); <span class="comment">// -&gt; ['a']</span></span><br></pre></td></tr></table></figure><h2 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h2><p>杀死进程。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function kill(pid: number): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>pid</td><td>进程 ID</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill(<span class="number">9420</span>);</span><br></pre></td></tr></table></figure><h2 id="last"><a href="#last" class="headerlink" title="last"></a>last</h2><p>获取数组的最后一个元素。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function last(arr: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标数组</td></tr><tr><td>返回值</td><td>数组的最后一个元素</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last([<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="lazyImport"><a href="#lazyImport" class="headerlink" title="lazyImport"></a>lazyImport</h2><p>模块懒加载，底层使用 Proxy。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function lazyImport&lt;T&gt;(<br>    importFn: (moduleId: string) =&gt; T,<br>    dirname?: string<br>): (moduleId: string) =&gt; T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>importFn</td><td>实际引入模块的方法</td></tr><tr><td>dirname</td><td>当前脚本所在目录</td></tr><tr><td>返回值</td><td>用于引入模块的新方法</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> r = lazyImport(<span class="built_in">require</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _ = r(<span class="string">'underscore'</span>);</span><br><span class="line"></span><br><span class="line">_.isNumber(<span class="number">5</span>);</span><br></pre></td></tr></table></figure><h2 id="lazyRequire"><a href="#lazyRequire" class="headerlink" title="lazyRequire"></a>lazyRequire</h2><p>模块懒加载。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function lazyRequire&lt;T&gt;(<br>    requireFn: (moduleId: string) =&gt; T<br>): (moduleId: string) =&gt; T;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> r = lazyRequire(<span class="built_in">require</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _ = r(<span class="string">'underscore'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// underscore is required only when _ is called.</span></span><br><span class="line">_().isNumber(<span class="number">5</span>);</span><br></pre></td></tr></table></figure><h2 id="levenshtein"><a href="#levenshtein" class="headerlink" title="levenshtein"></a>levenshtein</h2><p>计算字符串编辑距离，使用 levenshtein 算法。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function levenshtein(a: string, b: string): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>a</td><td>字符串 a</td></tr><tr><td>b</td><td>字符串 b</td></tr><tr><td>返回值</td><td>a 和 b 的字符串编辑距离</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">levenshtein(<span class="string">'cat'</span>, <span class="string">'cake'</span>); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="linkify"><a href="#linkify" class="headerlink" title="linkify"></a>linkify</h2><p>将文本中的 url 地址转换为超链接。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function linkify(str: string, hyperlink?: types.AnyFn): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>hyperlink</td><td>转换超链接函数</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">'Official site: http://eustia.liriliri.io'</span>;</span><br><span class="line">linkify(str); <span class="comment">// -&gt; 'Official site: &lt;a href="http://eustia.liriliri.io"&gt;http://eustia.liriliri.io&lt;/a&gt;'</span></span><br><span class="line">linkify(str, <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;a href="'</span> + url + <span class="string">'" target="_blank"&gt;'</span> + url + <span class="string">'&lt;/a&gt;'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="loadCss"><a href="#loadCss" class="headerlink" title="loadCss"></a>loadCss</h2><p>往页面插入样式链接。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function loadCss(src: string, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>src</td><td>样式文件地址</td></tr><tr><td>cb</td><td>加载完回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loadCss(<span class="string">'style.css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">isLoaded</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="loadImg"><a href="#loadImg" class="headerlink" title="loadImg"></a>loadImg</h2><p>加载指定地址的图片。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function loadImg(src: string, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>src</td><td>图片地址</td></tr><tr><td>cb</td><td>加载完回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loadImg(<span class="string">'http://eustia.liriliri.io/img.jpg'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, img</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(img.width, img.height);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="loadJs"><a href="#loadJs" class="headerlink" title="loadJs"></a>loadJs</h2><p>往页面插入脚本链接。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function loadJs(src: string, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>src</td><td>脚本地址</td></tr><tr><td>cb</td><td>加载完回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loadJs(<span class="string">'main.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">isLoaded</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="longest"><a href="#longest" class="headerlink" title="longest"></a>longest</h2><p>获取数组中最长的一项。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function longest(arr: string[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标数组</td></tr><tr><td>返回值</td><td>最长的一项</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">longest([<span class="string">'a'</span>, <span class="string">'abcde'</span>, <span class="string">'abc'</span>]); <span class="comment">// -&gt; 'abcde'</span></span><br></pre></td></tr></table></figure><h2 id="lowerCase"><a href="#lowerCase" class="headerlink" title="lowerCase"></a>lowerCase</h2><p>转换字符串为小写。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function lowerCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lowerCase(<span class="string">'TEST'</span>); <span class="comment">// -&gt; 'test'</span></span><br></pre></td></tr></table></figure><h2 id="lpad"><a href="#lpad" class="headerlink" title="lpad"></a>lpad</h2><p>对字符串进行左填充。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function lpad(str: string, len: number, chars?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>len</td><td>填充长度</td></tr><tr><td>chars</td><td>填充字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lpad(<span class="string">'a'</span>, <span class="number">5</span>); <span class="comment">// -&gt; '    a'</span></span><br><span class="line">lpad(<span class="string">'a'</span>, <span class="number">5</span>, <span class="string">'-'</span>); <span class="comment">// -&gt; '----a'</span></span><br><span class="line">lpad(<span class="string">'abc'</span>, <span class="number">3</span>, <span class="string">'-'</span>); <span class="comment">// -&gt; 'abc'</span></span><br><span class="line">lpad(<span class="string">'abc'</span>, <span class="number">5</span>, <span class="string">'ab'</span>); <span class="comment">// -&gt; 'ababc'</span></span><br></pre></td></tr></table></figure><h2 id="ltrim"><a href="#ltrim" class="headerlink" title="ltrim"></a>ltrim</h2><p>删除字符串头部指定字符或空格。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function ltrim(str: string, chars?: string | string[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>chars</td><td>删除字符</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ltrim(<span class="string">' abc  '</span>); <span class="comment">// -&gt; 'abc  '</span></span><br><span class="line">ltrim(<span class="string">'_abc_'</span>, <span class="string">'_'</span>); <span class="comment">// -&gt; 'abc_'</span></span><br><span class="line">ltrim(<span class="string">'_abc_'</span>, [<span class="string">'a'</span>, <span class="string">'_'</span>]); <span class="comment">// -&gt; 'bc_'</span></span><br></pre></td></tr></table></figure><h2 id="map-1"><a href="#map-1" class="headerlink" title="map"></a>map</h2><p>对集合的每个元素调用转换函数生成与之对应的数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function map&lt;T, TResult&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator: types.ListIterator&lt;T, TResult&gt;,<br>    context?: any<br>): TResult[];<br>function map&lt;T, TResult&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator: types.ObjectIterator&lt;T, TResult&gt;,<br>    context?: any<br>): TResult[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>object</td><td>源集合</td></tr><tr><td>iterator</td><td>转换函数</td></tr><tr><td>context</td><td>函数上下文</td></tr><tr><td>返回值</td><td>目标集合</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map([<span class="number">4</span>, <span class="number">8</span>], <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;); <span class="comment">// -&gt; [16, 64]</span></span><br></pre></td></tr></table></figure><h2 id="mapObj"><a href="#mapObj" class="headerlink" title="mapObj"></a>mapObj</h2><p>类似 map，但针对对象，生成一个新对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function mapObj&lt;T, TResult&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator: types.ObjectIterator&lt;T, TResult&gt;,<br>    context?: any<br>): types.Dictionary&lt;TResult&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>object</td><td>源对象</td></tr><tr><td>iterator</td><td>转换函数</td></tr><tr><td>context</td><td>函数上下文</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mapObj(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">val, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val + <span class="number">1</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; &#123;a: 2, b: 3&#125;</span></span><br></pre></td></tr></table></figure><h2 id="matcher"><a href="#matcher" class="headerlink" title="matcher"></a>matcher</h2><p>传入对象返回函数，如果传入参数中包含该对象则返回真。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function matcher(attrs: any): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>attrs</td><td>要匹配的对象</td></tr><tr><td>返回值</td><td>真值检测函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filter = <span class="built_in">require</span>(<span class="string">'licia/filter'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objects = [</span><br><span class="line">    &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">a</span>: <span class="number">4</span>, <span class="attr">b</span>: <span class="number">5</span>, <span class="attr">c</span>: <span class="number">6</span> &#125;</span><br><span class="line">];</span><br><span class="line">filter(objects, matcher(&#123; <span class="attr">a</span>: <span class="number">4</span>, <span class="attr">c</span>: <span class="number">6</span> &#125;)); <span class="comment">// -&gt; [&#123;a: 4, b: 5, c: 6&#125;]</span></span><br></pre></td></tr></table></figure><h2 id="max"><a href="#max" class="headerlink" title="max"></a>max</h2><p>获取数字中的最大值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function max(…num: number[]): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…num</td><td>要计算的数字</td></tr><tr><td>返回值</td><td>最大值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max(<span class="number">2.3</span>, <span class="number">1</span>, <span class="number">4.5</span>, <span class="number">2</span>); <span class="comment">// 4.5</span></span><br></pre></td></tr></table></figure><h2 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h2><p>MD5 算法实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function md5(msg: string | number[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>msg</td><td>密文</td></tr><tr><td>返回值</td><td>MD5 摘要</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="string">'licia'</span>); <span class="comment">// -&gt; 'e59f337d85e9a467f1783fab282a41d0'</span></span><br></pre></td></tr></table></figure><h2 id="memStorage"><a href="#memStorage" class="headerlink" title="memStorage"></a>memStorage</h2><p>Web Storage 接口的纯内存实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const memStorage: typeof window.localStorage;</code><br></pre><br></details><p>当 localStorage 或者 sessionStorage 无法使用时可以使用其作为替代。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> localStorage = <span class="built_in">window</span>.localStorage || memStorage;</span><br><span class="line">localStorage.setItem(<span class="string">'test'</span>, <span class="string">'licia'</span>);</span><br></pre></td></tr></table></figure><h2 id="memoize"><a href="#memoize" class="headerlink" title="memoize"></a>memoize</h2><p>缓存函数计算结果。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function memoize(<br>    fn: types.AnyFn,<br>    hashFn?: types.AnyFn<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>hashFn</td><td>计算缓存键名函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fibonacci = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &lt; <span class="number">2</span> ? n : fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="mergeArr"><a href="#mergeArr" class="headerlink" title="mergeArr"></a>mergeArr</h2><p>将数组合并到第一个数组里。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function mergeArr&lt;T, U&gt;(<br>    first: ArrayLike&lt;T&gt;,<br>    …arrays: ArrayLike&lt;U&gt;[]<br>): ArrayLike&lt;T | U&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>first</td><td>要修改的数组</td></tr><tr><td>arrays</td><td>合并到第一个数组的数组</td></tr><tr><td>返回值</td><td>第一个数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">mergeArr(a, [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// -&gt; [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure><h2 id="mergeSort"><a href="#mergeSort" class="headerlink" title="mergeSort"></a>mergeSort</h2><p>归并排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function mergeSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><p>注意：它不改变原数组。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mergeSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="meta"><a href="#meta" class="headerlink" title="meta"></a>meta</h2><p>meta 操作库，将 name 和 content 属性值转换为键值对。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace meta {<br>    function remove(nameList: string | string[]): void;<br>}<br>function meta(): {};<br>function meta(key: string): string;<br>function meta(keys: string[]): {};<br>function meta(key, value): void;<br>function meta(pairs: {}): void;</code><br></pre><br></details><p>获取指定 meta 值。如果忽略 meta 名，所有的 meta 键值对都被返回。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>meta 名</td></tr><tr><td>返回值</td><td>meta 值</td></tr></tbody></table><p>设置 meta 值。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>meta 名</td></tr><tr><td>content</td><td>meta 值</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>metas</td><td>包含所有 meta 键值对的对象</td></tr></tbody></table><h3 id="remove-11"><a href="#remove-11" class="headerlink" title="remove"></a>remove</h3><p>移除指定 meta。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>meta 名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;meta name="a" content="1"/&gt; &lt;meta name="b" content="2"/&gt; &lt;meta name="c" content="3"/&gt;</span></span><br><span class="line">meta(); <span class="comment">// -&gt; &#123;a: '1', b: '2', c: '3'&#125;</span></span><br><span class="line">meta(<span class="string">'a'</span>); <span class="comment">// -&gt; '1'</span></span><br><span class="line">meta([<span class="string">'a'</span>, <span class="string">'c'</span>]); <span class="comment">// -&gt; &#123;a: '1', c: '3'&#125;</span></span><br><span class="line">meta(<span class="string">'d'</span>, <span class="string">'4'</span>);</span><br><span class="line">meta(&#123;</span><br><span class="line">    d: <span class="string">'5'</span>,</span><br><span class="line">    e: <span class="string">'6'</span>,</span><br><span class="line">    f: <span class="string">'7'</span></span><br><span class="line">&#125;);</span><br><span class="line">meta.remove(<span class="string">'d'</span>);</span><br><span class="line">meta.remove([<span class="string">'e'</span>, <span class="string">'f'</span>]);</span><br></pre></td></tr></table></figure><h2 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h2><p>获取对象中所有方法名。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function methods(obj: any): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>方法名列表</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">methods(<span class="built_in">console</span>); <span class="comment">// -&gt; ['Console', 'assert', 'dir', ...]</span></span><br></pre></td></tr></table></figure><h2 id="mime"><a href="#mime" class="headerlink" title="mime"></a>mime</h2><p>常用 mime 类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function mime(name: string): string | undefined;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>扩展名</td></tr><tr><td>返回值</td><td>mime 类型</td></tr></tbody></table><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>mime 类型</td></tr><tr><td>返回值</td><td>扩展名</td></tr></tbody></table><p>该模块只包含常用的文件类型。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mime(<span class="string">'jpg'</span>); <span class="comment">// -&gt; 'image/jpeg'</span></span><br><span class="line">mime(<span class="string">'bmp'</span>); <span class="comment">// -&gt; 'image/bmp'</span></span><br><span class="line">mime(<span class="string">'video/mp4'</span>); <span class="comment">// -&gt; 'mp4'</span></span><br><span class="line">mime(<span class="string">'test'</span>); <span class="comment">// -&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="min"><a href="#min" class="headerlink" title="min"></a>min</h2><p>获取数字中的最小值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function min(…num: number[]): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…num</td><td>要计算的数字</td></tr><tr><td>返回值</td><td>最小值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min(<span class="number">2.3</span>, <span class="number">1</span>, <span class="number">4.5</span>, <span class="number">2</span>); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h2 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h2><p>递归地创建文件夹。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace mkdir {<br>    function sync(dir: string, mode?: number): void;<br>}<br>function mkdir(<br>    dir: string,<br>    mode?: number,<br>    cb?: types.AnyFn<br>): void;<br>function mkdir(dir: string, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>dir</td><td>文件夹路径</td></tr><tr><td>mode=0777</td><td>文件夹模式</td></tr><tr><td>cb</td><td>回调</td></tr></tbody></table><h3 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h3><p>同步版本。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir(<span class="string">'/tmp/foo/bar/baz'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">console</span>.log(<span class="string">'Done'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">mkdir.sync(<span class="string">'/tmp/foo2/bar/baz'</span>);</span><br></pre></td></tr></table></figure><h2 id="moment"><a href="#moment" class="headerlink" title="moment"></a>moment</h2><p>简单的类 moment.js 实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace moment {<br>    class M {<br>        constructor(value: string | Date);<br>        format(mask: string): string;<br>        isValid(): boolean;<br>        isLeapYear(): boolean;<br>        isSame(that: M): boolean;<br>        valueOf(): number;<br>        isBefore(that: M): boolean;<br>        isAfter(that: M): boolean;<br>        year(): number;<br>        year(number): M;<br>        month(): number;<br>        month(number): M;<br>        date(): number;<br>        date(number): M;<br>        hour(): number;<br>        hour(number): M;<br>        minute(): number;<br>        minute(number): M;<br>        second(): number;<br>        second(number): M;<br>        millisecond(): number;<br>        millisecond(number): M;<br>        unix(): number;<br>        clone(): M;<br>        toDate(): Date;<br>        toArray(): number[];<br>        toJSON(): string;<br>        toISOString(): string;<br>        toObject(): any;<br>        toString(): string;<br>        set(unit: string, num: number): M;<br>        startOf(unit: string): M;<br>        endOf(unit: string): M;<br>        daysInMonth(): number;<br>        add(num: number, unit: string): M;<br>        subtract(num: number, unit: string): M;<br>        diff(input: M | string | Date, unit: string, asFloat: boolean): number;<br>    }<br>}<br>function moment(value: string | Date): moment.M;</code><br></pre><br></details><p>它只支持一小部分的 moment.js api。</p><h3 id="可用方法"><a href="#可用方法" class="headerlink" title="可用方法"></a>可用方法</h3><p>format，isValid，isLeapYear，isSame，isBefore，isAfter，year，<br>month，date，hour，minute，second，millisecond，unix，clone，<br>toDate，toArray，toJSON，toISOString，toObject，toString，set，<br>startOf，endOf，add，subtract，diff</p><h3 id="不支持特性"><a href="#不支持特性" class="headerlink" title="不支持特性"></a>不支持特性</h3><p>时区以及 quarter 和 week 单位。</p><p>注意：格式化功能使用 dateFormat 模块，所以掩码格式并不完全与 moment.js 一致。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moment(<span class="string">'20180501'</span>).format(<span class="string">'yyyy-mm-dd'</span>); <span class="comment">// -&gt; '2018-05-01'</span></span><br></pre></td></tr></table></figure><h2 id="morphDom"><a href="#morphDom" class="headerlink" title="morphDom"></a>morphDom</h2><p>将 DOM 树变化成目标 DOM 树。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function morphDom(from: Node, to: Node | string): Node;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>from</td><td>原始 DOM 树</td></tr><tr><td>to</td><td>要变化的 DOM 树</td></tr><tr><td>返回值</td><td>变化后的 DOM 树</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el1 = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">el1.className = <span class="string">'test'</span>;</span><br><span class="line"><span class="keyword">const</span> el2 = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">el2.className = <span class="string">'licia'</span>;</span><br><span class="line">morphDom(el1, el2);</span><br><span class="line"><span class="built_in">console</span>.log(el1.className); <span class="comment">// -&gt; 'licia'</span></span><br></pre></td></tr></table></figure><h2 id="morse"><a href="#morse" class="headerlink" title="morse"></a>morse</h2><p>摩尔斯电码编解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const morse: {<br>    encode(txt: string): string;<br>    decode(morse: string): string;<br>};</code><br></pre><br></details><h3 id="encode-2"><a href="#encode-2" class="headerlink" title="encode"></a>encode</h3><p>将文本转换为摩尔斯电码。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>txt</td><td>要编码的文本</td></tr><tr><td>返回值</td><td>摩尔斯电码</td></tr></tbody></table><h3 id="decode-2"><a href="#decode-2" class="headerlink" title="decode"></a>decode</h3><p>将摩尔斯电码转换为文本。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>morse</td><td>摩尔斯电码</td></tr><tr><td>返回值</td><td>解码后的文本</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = morse.encode(<span class="string">'Hello, world.'</span>);</span><br><span class="line"><span class="comment">// -&gt; '.... . .-.. .-.. --- --..-- ....... .-- --- .-. .-.. -.. .-.-.-'</span></span><br><span class="line">morse.decode(str); <span class="comment">// -&gt; 'Hello, world.'</span></span><br></pre></td></tr></table></figure><h2 id="ms"><a href="#ms" class="headerlink" title="ms"></a>ms</h2><p>时长字符串与毫秒转换库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function ms(str: string): number;<br>function ms(num: number): string;</code><br></pre><br></details><p>转换时长字符串为毫秒。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>字符串格式</td></tr><tr><td>返回值</td><td>毫秒</td></tr></tbody></table><p>转换毫秒为时长字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>毫秒</td></tr><tr><td>返回值</td><td>字符串格式</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ms(<span class="string">'1s'</span>); <span class="comment">// -&gt; 1000</span></span><br><span class="line">ms(<span class="string">'1m'</span>); <span class="comment">// -&gt; 60000</span></span><br><span class="line">ms(<span class="string">'1.5h'</span>); <span class="comment">// -&gt; 5400000</span></span><br><span class="line">ms(<span class="string">'1d'</span>); <span class="comment">// -&gt; 86400000</span></span><br><span class="line">ms(<span class="string">'1y'</span>); <span class="comment">// -&gt; 31557600000</span></span><br><span class="line">ms(<span class="string">'1000'</span>); <span class="comment">// -&gt; 1000</span></span><br><span class="line">ms(<span class="number">1500</span>); <span class="comment">// -&gt; '1.5s'</span></span><br><span class="line">ms(<span class="number">60000</span>); <span class="comment">// -&gt; '1m'</span></span><br></pre></td></tr></table></figure><h2 id="naturalSort"><a href="#naturalSort" class="headerlink" title="naturalSort"></a>naturalSort</h2><p>以自然顺序排序数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function naturalSort&lt;T extends any[]&gt;(arr: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">naturalSort([<span class="string">'img12'</span>, <span class="string">'img11'</span>, <span class="string">'$img'</span>, <span class="string">'_img'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'12'</span>]);</span><br><span class="line"><span class="comment">// -&gt; ['1', '2', '12', '$img', 'img11', 'img12', '_img']</span></span><br><span class="line">naturalSort([<span class="number">2</span>, <span class="string">'1'</span>, <span class="number">13</span>]); <span class="comment">// -&gt; ['1', 2, 13]</span></span><br></pre></td></tr></table></figure><h2 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h2><p>创建一个将原函数结果取反的函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function negate&lt;T extends types.AnyFn&gt;(predicate: T): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>predicate</td><td>源函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">even</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>].filter(negate(even)); <span class="comment">// -&gt; [1, 3, 5]</span></span><br></pre></td></tr></table></figure><h2 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h2><p>能够同时运行在 node 和浏览器端的 next tick 实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function nextTick(cb: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>cb</td><td>调用函数</td></tr></tbody></table><p>如果支持 process.nextTick，则调用它，否则使用 setImmediate 或 setTimeout 进行兼容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="noop"><a href="#noop" class="headerlink" title="noop"></a>noop</h2><p>一个什么也不做的空函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function noop(): void;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noop(); <span class="comment">// Does nothing</span></span><br></pre></td></tr></table></figure><h2 id="normalizeHeader"><a href="#normalizeHeader" class="headerlink" title="normalizeHeader"></a>normalizeHeader</h2><p>标准化 HTTP 头部名。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function normalizeHeader(header: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>header</td><td>源头部名</td></tr><tr><td>返回值</td><td>目标头部名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">normalizeHeader(<span class="string">'content-type'</span>); <span class="comment">// -&gt; 'Content-Type'</span></span><br><span class="line">normalizeHeader(<span class="string">'etag'</span>); <span class="comment">// -&gt; 'ETag'</span></span><br></pre></td></tr></table></figure><h2 id="normalizePath"><a href="#normalizePath" class="headerlink" title="normalizePath"></a>normalizePath</h2><p>标准化文件路径中的斜杠。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function normalizePath(path: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>源路径</td></tr><tr><td>返回值</td><td>目标路径</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">normalizePath(<span class="string">'\\foo\\bar\\'</span>); <span class="comment">// -&gt; '/foo/bar/'</span></span><br><span class="line">normalizePath(<span class="string">'./foo//bar'</span>); <span class="comment">// -&gt; './foo/bar'</span></span><br></pre></td></tr></table></figure><h2 id="normalizePhone"><a href="#normalizePhone" class="headerlink" title="normalizePhone"></a>normalizePhone</h2><p>标准化电话号码为 E.164 格式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function normalizePhone(<br>    phone: string,<br>    options: {<br>        countryCode: number;<br>        trunkPrefix?: boolean;<br>    }<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>phone</td><td>电话号码</td></tr><tr><td>options</td><td>标准化选项</td></tr><tr><td>返回值</td><td>E.164 格式电话号码</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>countryCode</td><td>国家代码</td></tr><tr><td>trunkPrefix=false</td><td>如果本地格式有长途字冠，设为真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">normalizePhone(<span class="string">'13512345678'</span>, &#123;</span><br><span class="line">    countryCode: <span class="number">86</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; '+8613512345678'</span></span><br><span class="line">normalizePhone(<span class="string">'(415) 555-2671'</span>, &#123;</span><br><span class="line">    countryCode: <span class="number">1</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; '+14155552671'</span></span><br><span class="line">normalizePhone(<span class="string">'020 7183 8750'</span>, &#123;</span><br><span class="line">    countryCode: <span class="number">44</span>,</span><br><span class="line">    trunkPrefix: <span class="literal">true</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; '+442071838750'</span></span><br></pre></td></tr></table></figure><h2 id="notify"><a href="#notify" class="headerlink" title="notify"></a>notify</h2><p>Web Notifications 接口简单包装。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace notify {<br>    class Notification extends Emitter {<br>        constructor(title: string, options?: object);<br>        show(): void;<br>    }<br>}<br>function notify(title: string, options?: object): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>title</td><td>通知标题</td></tr><tr><td>options</td><td>通知选项</td></tr></tbody></table><p>你可以传入所有在 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification" target="_blank" rel="noopener">Web Notification</a> 中支持的选项。</p><h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><p>如果你想要监听并处理像 close，show，click 或者 error 等事件，使用这个类创建实例。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">notify(<span class="string">'licia'</span>, &#123;</span><br><span class="line">    body: <span class="string">'This is the notification content'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> notification = <span class="keyword">new</span> notify.Notification(<span class="string">'licia'</span>, &#123;</span><br><span class="line">    body: <span class="string">'This is the notification content'</span></span><br><span class="line">&#125;);</span><br><span class="line">notification.on(<span class="string">'error'</span>, err =&gt; <span class="built_in">console</span>.log(err));</span><br><span class="line">notification.on(<span class="string">'click'</span>, e =&gt; <span class="built_in">console</span>.log(e));</span><br><span class="line">notification.show();</span><br></pre></td></tr></table></figure><h2 id="now"><a href="#now" class="headerlink" title="now"></a>now</h2><p>获取当前时间戳。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function now(): number;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now(); <span class="comment">// -&gt; 1468826678701</span></span><br></pre></td></tr></table></figure><h2 id="objToStr"><a href="#objToStr" class="headerlink" title="objToStr"></a>objToStr</h2><p>Object.prototype.toString 的别名。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function objToStr(val: any): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>目标值</td></tr><tr><td>返回值</td><td>字符串表示</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objToStr(<span class="number">5</span>); <span class="comment">// -&gt; '[object Number]'</span></span><br></pre></td></tr></table></figure><h2 id="omit"><a href="#omit" class="headerlink" title="omit"></a>omit</h2><p>类似 pick，但结果相反。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function omit(<br>    obj: any,<br>    filter: string | string[] | Function<br>): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>源对象</td></tr><tr><td>filter</td><td>对象过滤器</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">omit(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, <span class="string">'a'</span>); <span class="comment">// -&gt; &#123;b: 2&#125;</span></span><br><span class="line">omit(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;, [<span class="string">'b'</span>, <span class="string">'c'</span>]); <span class="comment">// -&gt; &#123;a: 1&#125;</span></span><br><span class="line">omit(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">val, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; &#123;b: 2, d: 4&#125;</span></span><br></pre></td></tr></table></figure><h2 id="once-1"><a href="#once-1" class="headerlink" title="once"></a>once</h2><p>创建只能调用一次的函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function once(fn: types.AnyFn): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> initOnce = once(init);</span><br><span class="line">initOnce();</span><br><span class="line">initOnce(); <span class="comment">// -&gt; init is invoked once</span></span><br></pre></td></tr></table></figure><h2 id="open"><a href="#open" class="headerlink" title="open"></a>open</h2><p>打开 url 地址或文件。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function open(target: string): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>target</td><td>要打开的目标</td></tr><tr><td>返回值</td><td>子进程对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(<span class="string">'https://eustia.liriliri.io/'</span>);</span><br></pre></td></tr></table></figure><h2 id="openFile"><a href="#openFile" class="headerlink" title="openFile"></a>openFile</h2><p>在浏览器中打开文件选择框。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function openFile(options?: {<br>    accept?: string;<br>    multiple?: boolean;<br>}): Promise&lt;File[]&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>选项</td></tr><tr><td>返回值</td><td>文件列表</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>accept</td><td>文件类型</td></tr><tr><td>multiple=false</td><td>是否支持多选</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openFile(&#123; <span class="attr">multiple</span>: <span class="literal">true</span> &#125;).then(<span class="function"><span class="params">fileList</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(fileList);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="optimizeCb"><a href="#optimizeCb" class="headerlink" title="optimizeCb"></a>optimizeCb</h2><p>用于高效的函数上下文绑定。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function optimizeCb(<br>    fn: types.AnyFn,<br>    ctx: any,<br>    argCount?: number<br>): types.AnyFn;</code><br></pre><br></details><h2 id="ordinal"><a href="#ordinal" class="headerlink" title="ordinal"></a>ordinal</h2><p>转换数字为序数形式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function ordinal(num: number): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要转换的数字</td></tr><tr><td>返回值</td><td>目标序数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ordinal(<span class="number">1</span>); <span class="comment">// -&gt; '1st'</span></span><br><span class="line">ordinal(<span class="number">2</span>); <span class="comment">// -&gt; '2nd'</span></span><br></pre></td></tr></table></figure><h2 id="orientation"><a href="#orientation" class="headerlink" title="orientation"></a>orientation</h2><p>屏幕方向工具库。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace orientation {<br>    interface IOrientation extends Emitter {<br>        get(): string;<br>    }<br>}<br>const orientation: orientation.IOrientation;</code><br></pre><br></details><h3 id="on-2"><a href="#on-2" class="headerlink" title="on"></a>on</h3><p>绑定 change 事件。</p><h3 id="off-2"><a href="#off-2" class="headerlink" title="off"></a>off</h3><p>解绑 change 事件。</p><h3 id="get-8"><a href="#get-8" class="headerlink" title="get"></a>get</h3><p>获取当前屏幕方向（横屏 landscape 或 竖屏 portrait）。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">orientation.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">direction</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(direction); <span class="comment">// -&gt; 'portrait'</span></span><br><span class="line">&#125;);</span><br><span class="line">orientation.get(); <span class="comment">// -&gt; 'landscape'</span></span><br></pre></td></tr></table></figure><h2 id="pad"><a href="#pad" class="headerlink" title="pad"></a>pad</h2><p>对字符串进行左右填充。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function pad(str: string, len: number, chars?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>len</td><td>填充长度</td></tr><tr><td>chars</td><td>填充字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pad(<span class="string">'a'</span>, <span class="number">5</span>); <span class="comment">// -&gt; '  a  '</span></span><br><span class="line">pad(<span class="string">'a'</span>, <span class="number">5</span>, <span class="string">'-'</span>); <span class="comment">// -&gt; '--a--'</span></span><br><span class="line">pad(<span class="string">'abc'</span>, <span class="number">3</span>, <span class="string">'-'</span>); <span class="comment">// -&gt; 'abc'</span></span><br><span class="line">pad(<span class="string">'abc'</span>, <span class="number">5</span>, <span class="string">'ab'</span>); <span class="comment">// -&gt; 'babca'</span></span><br><span class="line">pad(<span class="string">'ab'</span>, <span class="number">5</span>, <span class="string">'ab'</span>); <span class="comment">// -&gt; 'ababa'</span></span><br></pre></td></tr></table></figure><h2 id="pairs"><a href="#pairs" class="headerlink" title="pairs"></a>pairs</h2><p>将对象转换为包含【键名，键值】对的数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function pairs(obj: any): Array&lt;any[]&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>键值对数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;); <span class="comment">// -&gt; [['a', 1], ['b', 2]]</span></span><br></pre></td></tr></table></figure><h2 id="parallel"><a href="#parallel" class="headerlink" title="parallel"></a>parallel</h2><p>同时执行多个函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function parallel(tasks: types.AnyFn[], cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tasks</td><td>函数数组</td></tr><tr><td>cb</td><td>结束回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">parallel(</span><br><span class="line">    [</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                cb(<span class="literal">null</span>, <span class="string">'one'</span>);</span><br><span class="line">            &#125;, <span class="number">200</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                cb(<span class="literal">null</span>, <span class="string">'two'</span>);</span><br><span class="line">            &#125;, <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// results -&gt; ['one', 'two']</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="parseArgs"><a href="#parseArgs" class="headerlink" title="parseArgs"></a>parseArgs</h2><p>命令行参数简单解析。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function parseArgs(<br>    args: string[],<br>    options: {<br>        names: any;<br>        shorthands: any;<br>    }<br>): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>args</td><td>参数数组</td></tr><tr><td>options</td><td>解析选项</td></tr><tr><td>返回值</td><td>解析结果</td></tr></tbody></table><h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>names</td><td>选项名及类型</td></tr><tr><td>shorthands</td><td>选项名缩写</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">parseArgs([<span class="string">'eustia'</span>, <span class="string">'--output'</span>, <span class="string">'util.js'</span>, <span class="string">'-w'</span>], &#123;</span><br><span class="line">    names: &#123;</span><br><span class="line">        output: <span class="string">'string'</span>,</span><br><span class="line">        watch: <span class="string">'boolean'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    shorthands: &#123;</span><br><span class="line">        output: <span class="string">'o'</span>,</span><br><span class="line">        watch: <span class="string">'w'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// -&gt; &#123;remain: ['eustia'], output: 'util.js', watch: true&#125;</span></span><br></pre></td></tr></table></figure><h2 id="parseHtml"><a href="#parseHtml" class="headerlink" title="parseHtml"></a>parseHtml</h2><p>HTML 解析器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function parseHtml(<br>    html: string,<br>    handlers: {<br>        start?: (tag: string, attrs: any, unary: boolean) =&gt; void;<br>        end?: (tag: string) =&gt; void;<br>        comment?: (text: string) =&gt; void;<br>        text?: (text: string) =&gt; void;<br>    }<br>): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>html</td><td>要解析的 HTML</td></tr><tr><td>handler</td><td>处理函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parseHtml(<span class="string">'&lt;div&gt;licia&lt;/div&gt;'</span>, &#123;</span><br><span class="line">    start: <span class="function">(<span class="params">tag, attrs, unary</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">    end: <span class="function"><span class="params">tag</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">    comment: <span class="function"><span class="params">text</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">    text: <span class="function"><span class="params">text</span> =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="partial"><a href="#partial" class="headerlink" title="partial"></a>partial</h2><p>返回局部填充参数的函数，与 bind 模块相似。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function partial(<br>    fn: types.AnyFn,<br>    …partials: any[]<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>…partials</td><td>局部填充参数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sub5 = partial(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b - a;</span><br><span class="line">&#125;, <span class="number">5</span>);</span><br><span class="line">sub5(<span class="number">20</span>); <span class="comment">// -&gt; 15</span></span><br></pre></td></tr></table></figure><h2 id="pascalCase"><a href="#pascalCase" class="headerlink" title="pascalCase"></a>pascalCase</h2><p>将字符串转换为帕斯卡式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function pascalCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>帕斯卡式字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pascalCase(<span class="string">'fooBar'</span>); <span class="comment">// -&gt; FooBar</span></span><br><span class="line">pascalCase(<span class="string">'foo bar'</span>); <span class="comment">// -&gt; FooBar</span></span><br><span class="line">pascalCase(<span class="string">'foo_bar'</span>); <span class="comment">// -&gt; FooBar</span></span><br><span class="line">pascalCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; FooBar</span></span><br></pre></td></tr></table></figure><h2 id="perfNow"><a href="#perfNow" class="headerlink" title="perfNow"></a>perfNow</h2><p>高精度时间戳。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function perfNow(): number;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> start = perfNow();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do something.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(perfNow() - start);</span><br></pre></td></tr></table></figure><h2 id="pick"><a href="#pick" class="headerlink" title="pick"></a>pick</h2><p>过滤对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function pick(<br>    object: any,<br>    filter: string | string[] | Function<br>): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>object</td><td>源对象</td></tr><tr><td>filter</td><td>对象过滤器</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pick(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, <span class="string">'a'</span>); <span class="comment">// -&gt; &#123;a: 1&#125;</span></span><br><span class="line">pick(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;, [<span class="string">'b'</span>, <span class="string">'c'</span>]); <span class="comment">// -&gt; &#123;b: 2, c: 3&#125;</span></span><br><span class="line">pick(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">val, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; &#123;a: 1, c: 3&#125;</span></span><br></pre></td></tr></table></figure><h2 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h2><p>将所有的 stream 流连接起来。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">import stream = require(&#x27;stream&#x27;);<br>function pipe(…streams: stream.Stream[]): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…streams</td><td>要连接的 stream 流</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> through = <span class="built_in">require</span>(<span class="string">'licia/through'</span>);</span><br><span class="line">pipe(</span><br><span class="line">    fs.createReadStream(<span class="string">'in.txt'</span>),</span><br><span class="line">    through(<span class="function"><span class="keyword">function</span>(<span class="params">chunk, enc, cb</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.push(chunk);</span><br><span class="line">        cb();</span><br><span class="line">    &#125;),</span><br><span class="line">    fs.createWriteStream(<span class="string">'out.txt'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="pluck"><a href="#pluck" class="headerlink" title="pluck"></a>pluck</h2><p>提取数组对象中指定属性值，返回一个数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function pluck(object: any, key: string | string[]): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标集合</td></tr><tr><td>key</td><td>属性路径</td></tr><tr><td>返回值</td><td>指定属性值列表</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stooges = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'moe'</span>, <span class="attr">age</span>: <span class="number">40</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'larry'</span>, <span class="attr">age</span>: <span class="number">50</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'curly'</span>, <span class="attr">age</span>: <span class="number">60</span> &#125;</span><br><span class="line">];</span><br><span class="line">pluck(stooges, <span class="string">'name'</span>); <span class="comment">// -&gt; ['moe', 'larry', 'curly']</span></span><br></pre></td></tr></table></figure><h2 id="precision"><a href="#precision" class="headerlink" title="precision"></a>precision</h2><p>获取数字的精度。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function precision(num: number): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>要检查的数字</td></tr><tr><td>返回值</td><td>精度</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">precision(<span class="number">1.234</span>); <span class="comment">// -&gt; 3;</span></span><br></pre></td></tr></table></figure><h2 id="prefetch"><a href="#prefetch" class="headerlink" title="prefetch"></a>prefetch</h2><p>预获取指定的 url。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function prefetch(url: string): Promise&lt;void&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>目标 url</td></tr></tbody></table><p>如果支持，它将使用<code>&lt;link rel=prefetch&gt;</code>进行预加载。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prefetch(<span class="string">'https://eustia.liriliri.io/'</span>);</span><br></pre></td></tr></table></figure><h2 id="prefix"><a href="#prefix" class="headerlink" title="prefix"></a>prefix</h2><p>给 css 属性名增加浏览器前缀。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace prefix {<br>    function dash(name: string): string;<br>}<br>function prefix(name: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>源属性名</td></tr><tr><td>返回值</td><td>目标属性名</td></tr></tbody></table><h3 id="dash"><a href="#dash" class="headerlink" title="dash"></a>dash</h3><p>同上，但返回短横线命名方式的版本。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">prefix(<span class="string">'text-emphasis'</span>); <span class="comment">// -&gt; 'WebkitTextEmphasis'</span></span><br><span class="line">prefix.dash(<span class="string">'text-emphasis'</span>); <span class="comment">// -&gt; '-webkit-text-emphasis'</span></span><br><span class="line">prefix(<span class="string">'color'</span>); <span class="comment">// -&gt; 'color'</span></span><br></pre></td></tr></table></figure><h2 id="promisify"><a href="#promisify" class="headerlink" title="promisify"></a>promisify</h2><p>转换使用回调的异步函数，使其返回 Promise。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function promisify(<br>    fn: types.AnyFn,<br>    multiArgs?: boolean<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>multiArgs=false</td><td>回调是否有多个结果</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><p>如果 multiArgs 设为真，返回的 Promise 会将回调的结果合并成一个数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readFile = promisify(fs.readFile);</span><br><span class="line">readFile(<span class="string">'test.js'</span>, <span class="string">'utf-8'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something with file content.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="property-1"><a href="#property-1" class="headerlink" title="property"></a>property</h2><p>返回一个函数，该函数返回任何传入对象的指定属性。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function property(path: string | string[]): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>属性路径</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: &#123; <span class="attr">b</span>: <span class="number">1</span> &#125; &#125;;</span><br><span class="line">property(<span class="string">'a'</span>)(obj); <span class="comment">// -&gt; &#123;b: 1&#125;</span></span><br><span class="line">property([<span class="string">'a'</span>, <span class="string">'b'</span>])(obj); <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure><h2 id="query"><a href="#query" class="headerlink" title="query"></a>query</h2><p>解析序列化 url 的 query 部分。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const query: {<br>    parse(str: string): any;<br>    stringify(object: any): string;<br>};</code><br></pre><br></details><h3 id="parse-5"><a href="#parse-5" class="headerlink" title="parse"></a>parse</h3><p>将 query 字符串解析成对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>query 字符串</td></tr><tr><td>返回值</td><td>query 对象</td></tr></tbody></table><h3 id="stringify-4"><a href="#stringify-4" class="headerlink" title="stringify"></a>stringify</h3><p>将对象序列化成 query 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>query 对象</td></tr><tr><td>返回值</td><td>query 字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">query.parse(<span class="string">'foo=bar&amp;eruda=true'</span>); <span class="comment">// -&gt; &#123;foo: 'bar', eruda: 'true'&#125;</span></span><br><span class="line">query.stringify(&#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">eruda</span>: <span class="string">'true'</span> &#125;); <span class="comment">// -&gt; 'foo=bar&amp;eruda=true'</span></span><br><span class="line">query.parse(<span class="string">'name=eruda&amp;name=eustia'</span>); <span class="comment">// -&gt; &#123;name: ['eruda', 'eustia']&#125;</span></span><br></pre></td></tr></table></figure><h2 id="quickSort"><a href="#quickSort" class="headerlink" title="quickSort"></a>quickSort</h2><p>快排实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function quickSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quickSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="raf"><a href="#raf" class="headerlink" title="raf"></a>raf</h2><p>requestAnimationFrame 快捷方式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace raf {<br>    function cancel(id: number): void;<br>}<br>function raf(cb: types.AnyFn): number;</code><br></pre><br></details><p>如果原生 requestAnimationFrame 不支持，使用 setTimeout 进行兼容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = raf(<span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Animation stuff</span></span><br><span class="line">    raf(tick);</span><br><span class="line">&#125;);</span><br><span class="line">raf.cancel(id);</span><br></pre></td></tr></table></figure><h2 id="random"><a href="#random" class="headerlink" title="random"></a>random</h2><p>在给定区间内生成随机数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function random(<br>    min: number,<br>    max?: number,<br>    floating?: boolean<br>): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>min</td><td>最小值</td></tr><tr><td>max</td><td>最大值</td></tr><tr><td>floating=false</td><td>是否允许浮点数</td></tr><tr><td>返回值</td><td>随机数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">random(<span class="number">1</span>, <span class="number">5</span>); <span class="comment">// -&gt; an integer between 0 and 5</span></span><br><span class="line">random(<span class="number">5</span>); <span class="comment">// -&gt; an integer between 0 and 5</span></span><br><span class="line">random(<span class="number">1.2</span>, <span class="number">5.2</span>, <span class="literal">true</span>); <span class="comment">/// -&gt; a floating-point number between 1.2 and 5.2</span></span><br></pre></td></tr></table></figure><h2 id="randomBytes"><a href="#randomBytes" class="headerlink" title="randomBytes"></a>randomBytes</h2><p>随机字节序列生成器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function randomBytes(size: number): Uint8Array;</code><br></pre><br></details><p>如果支持，使用 node 的 crypto 模块或浏览器的 crypto 对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>size</td><td>字节序列长度</td></tr><tr><td>返回值</td><td>随机字节序列</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">randomBytes(<span class="number">5</span>); <span class="comment">// -&gt; [55, 49, 153, 30, 122]</span></span><br></pre></td></tr></table></figure><h2 id="randomColor"><a href="#randomColor" class="headerlink" title="randomColor"></a>randomColor</h2><p>随机颜色生成器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function randomColor(): string;<br>function randomColor(options: {<br>    count?: number;<br>    hue?: number;<br>    lightness?: number;<br>    format?: string;<br>    seed?: number;<br>}): string | string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>options</td><td>随机选项</td></tr><tr><td>返回值</td><td>随机颜色</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>count=1</td><td>生成数</td></tr><tr><td>hue</td><td>色调，取值为 0 - 360</td></tr><tr><td>lightness</td><td>亮度，取值为 0 - 1</td></tr><tr><td>format=hex</td><td>颜色格式，hex，hsl 或者 rgb</td></tr><tr><td>seed</td><td>随机种子</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">randomColor(&#123;</span><br><span class="line">    count: <span class="number">2</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; ['#fed7f4', '#526498']</span></span><br></pre></td></tr></table></figure><h2 id="randomId"><a href="#randomId" class="headerlink" title="randomId"></a>randomId</h2><p>简单 id 生成器，类似于 nanoid。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function randomId(size?: number, symbols?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>size=21</td><td>id 长度</td></tr><tr><td>symbols</td><td>生成 id 字符，默认为 a-zA-Z0-9_-</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">randomId(); <span class="comment">// -&gt; 'oKpy4HwU8E6IvU5I03gyQ'</span></span><br><span class="line">randomId(<span class="number">5</span>); <span class="comment">// -&gt; 'sM6E9'</span></span><br><span class="line">randomId(<span class="number">5</span>, <span class="string">'abc'</span>); <span class="comment">// -&gt; 'cbbcb'</span></span><br></pre></td></tr></table></figure><h2 id="randomItem"><a href="#randomItem" class="headerlink" title="randomItem"></a>randomItem</h2><p>随机获取数组中的某项。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function randomItem(arr: any[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标数组</td></tr><tr><td>返回值</td><td>随机项</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">randomItem([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="range"><a href="#range" class="headerlink" title="range"></a>range</h2><p>创建整数数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function range(<br>    start: number,<br>    end?: number,<br>    step?: number<br>): number[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>start</td><td>起始值</td></tr><tr><td>end</td><td>结束值</td></tr><tr><td>step=1</td><td>相邻差</td></tr><tr><td>返回值</td><td>整数数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">range(<span class="number">5</span>); <span class="comment">// -&gt; [0, 1, 2, 3, 4]</span></span><br><span class="line">range(<span class="number">0</span>, <span class="number">5</span>, <span class="number">2</span>); <span class="comment">// -&gt; [0, 2, 4]</span></span><br></pre></td></tr></table></figure><h2 id="rc4"><a href="#rc4" class="headerlink" title="rc4"></a>rc4</h2><p>RC4 对称加密算法实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const rc4: {<br>    encrypt(key: string, str: string): string;<br>    decrypt(key: string, str: string): string;<br>};</code><br></pre><br></details><h3 id="encrypt"><a href="#encrypt" class="headerlink" title="encrypt"></a>encrypt</h3><p>RC4 加密，结果表示为 base64 字符串。</p><h3 id="decrypt"><a href="#decrypt" class="headerlink" title="decrypt"></a>decrypt</h3><p>RC4 解密，传入 base64 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>密钥</td></tr><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rc4.encrypt(<span class="string">'licia'</span>, <span class="string">'Hello world'</span>); <span class="comment">// -&gt; 'j9y2VpSfR3AdNN8='</span></span><br><span class="line">rc4.decrypt(<span class="string">'licia'</span>, <span class="string">'j9y2VpSfR3AdNN8='</span>); <span class="comment">// -&gt; 'Hello world'</span></span><br></pre></td></tr></table></figure><h2 id="ready-1"><a href="#ready-1" class="headerlink" title="ready"></a>ready</h2><p>dom 准备好时调用回调函数，类似于 jQuery 的 ready 方法。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function ready(fn: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>回调函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// It's safe to manipulate dom here.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>合并多个值成一个值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function reduce&lt;T, TResult&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator: types.MemoIterator&lt;T, TResult&gt;,<br>    memo?: TResult,<br>    context?: any<br>): TResult;<br>function reduce&lt;T, TResult&gt;(<br>    list: types.Dictionary&lt;T&gt;,<br>    iterator: types.MemoObjectIterator&lt;T, TResult&gt;,<br>    memo?: TResult,<br>    context?: any<br>): TResult;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标集合</td></tr><tr><td>iteratee=identity</td><td>合并函数</td></tr><tr><td>initial</td><td>初始值</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>合并值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">reduce(</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">sum, n</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sum + n;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">); <span class="comment">// -&gt; 6</span></span><br></pre></td></tr></table></figure><h2 id="reduceRight"><a href="#reduceRight" class="headerlink" title="reduceRight"></a>reduceRight</h2><p>类似于 reduce，只是从后往前合并。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function reduceRight&lt;T, TResult&gt;(<br>    list: types.Collection&lt;T&gt;,<br>    iterator: types.MemoIterator&lt;T, TResult&gt;,<br>    memo?: TResult,<br>    context?: any<br>): TResult;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">reduceRight(</span><br><span class="line">    [[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.concat(b);</span><br><span class="line">    &#125;,</span><br><span class="line">    []</span><br><span class="line">); <span class="comment">// -&gt; [3, 2, 1]</span></span><br></pre></td></tr></table></figure><h2 id="reject"><a href="#reject" class="headerlink" title="reject"></a>reject</h2><p>类似 filter，但结果相反。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function reject&lt;T&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator: types.ListIterator&lt;T, boolean&gt;,<br>    context?: any<br>): T[];<br>function reject&lt;T&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator: types.ObjectIterator&lt;T, boolean&gt;,<br>    context?: any<br>): T[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要遍历的集合</td></tr><tr><td>predicate</td><td>真值检测函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>包含所有未通过真值检测元素的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reject([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; [1, 3, 5]</span></span><br></pre></td></tr></table></figure><h2 id="remove-12"><a href="#remove-12" class="headerlink" title="remove"></a>remove</h2><p>移除集合中所有通过真值检测的元素，返回包含所有删除元素的数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function remove&lt;T, TResult&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator: types.ListIterator&lt;T, boolean&gt;,<br>    context?: any<br>): TResult[];</code><br></pre><br></details><p>与 filter 不同，该模块会改变原数组。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>list</td><td>要遍历的集合</td></tr><tr><td>iterator</td><td>真值检测函数</td></tr><tr><td>context</td><td>函数上下文</td></tr><tr><td>返回值</td><td>包含所有删除元素的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> evens = remove(arr, <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// -&gt; [1, 3, 5]</span></span><br><span class="line"><span class="built_in">console</span>.log(evens); <span class="comment">// -&gt; [2, 4]</span></span><br></pre></td></tr></table></figure><h2 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h2><p>重复字符串指定次数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function repeat(str: string, n: number): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>n</td><td>重复次数</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repeat(<span class="string">'a'</span>, <span class="number">3</span>); <span class="comment">// -&gt; 'aaa'</span></span><br><span class="line">repeat(<span class="string">'ab'</span>, <span class="number">2</span>); <span class="comment">// -&gt; 'abab'</span></span><br><span class="line">repeat(<span class="string">'*'</span>, <span class="number">0</span>); <span class="comment">// -&gt; ''</span></span><br></pre></td></tr></table></figure><h2 id="replaceAll"><a href="#replaceAll" class="headerlink" title="replaceAll"></a>replaceAll</h2><p>替换字符串中所有指定字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function replaceAll(<br>    str: string,<br>    substr: string,<br>    newSubstr: string<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>substr</td><td>被替换的子串</td></tr><tr><td>newSubstr</td><td>替换的子串</td></tr><tr><td>返回值</td><td>所有子串被替换后的新字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replaceAll(<span class="string">'hello world goodbye world'</span>, <span class="string">'world'</span>, <span class="string">'licia'</span>); <span class="comment">// -&gt; 'hello licia goodbye licia'</span></span><br></pre></td></tr></table></figure><h2 id="restArgs"><a href="#restArgs" class="headerlink" title="restArgs"></a>restArgs</h2><p>将给定序号后的参数合并成一个数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function restArgs(<br>    fn: types.AnyFn,<br>    startIndex?: number<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>function</td><td>源函数</td></tr><tr><td>startIndex</td><td>合并参数起始位置</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> paramArr = restArgs(<span class="function"><span class="keyword">function</span>(<span class="params">rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> rest;</span><br><span class="line">&#125;);</span><br><span class="line">paramArr(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// -&gt; [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure><h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><p>将数组元素颠倒，不改变原数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function reverse(arr: any[]): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reverse([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; [3, 2, 1]</span></span><br></pre></td></tr></table></figure><h2 id="rgbToHsl"><a href="#rgbToHsl" class="headerlink" title="rgbToHsl"></a>rgbToHsl</h2><p>将 rgb 格式的颜色值转换为 hsl 格式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function rgbToHsl(rgb: number[]): number[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>rgb</td><td>rgb 值</td></tr><tr><td>返回值</td><td>hsl 值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rgbToHsl([<span class="number">52</span>, <span class="number">203</span>, <span class="number">165</span>, <span class="number">0.8</span>]); <span class="comment">// -&gt; [165, 59, 50, 0.8]</span></span><br></pre></td></tr></table></figure><h2 id="ric"><a href="#ric" class="headerlink" title="ric"></a>ric</h2><p>requestIdleCallback 的快捷方式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace ric {<br>    function cancel(id: number): void;<br>}<br>function ric(cb: types.AnyFn): number;</code><br></pre><br></details><p>如果原生 requestIdleCallback 不支持，使用 setTimeout 进行兼容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = ric(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Called during a browser's idle periods</span></span><br><span class="line">&#125;);</span><br><span class="line">ric.cancel(id);</span><br></pre></td></tr></table></figure><h2 id="rmCookie"><a href="#rmCookie" class="headerlink" title="rmCookie"></a>rmCookie</h2><p>遍历所有可能的路径和域名将 cookie 删除。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function rmCookie(key: string): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>cookie 名</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmCookie(<span class="string">'test'</span>);</span><br></pre></td></tr></table></figure><h2 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h2><p>递归地删除文件夹。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function rmdir(dir: string, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>dir</td><td>文件夹路径</td></tr><tr><td>cb</td><td>回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rmdir(<span class="string">'/tmp/foo/bar/baz'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">console</span>.log(<span class="string">'Done'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>根对象引用，对于 nodeJs，取 <code>global</code> 对象，对于浏览器，取 <code>window</code> 对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const root: any;</code><br></pre><br></details><h2 id="rpad"><a href="#rpad" class="headerlink" title="rpad"></a>rpad</h2><p>对字符串进行右填充。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function rpad(str: string, len: number, chars?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>len</td><td>填充长度</td></tr><tr><td>chars</td><td>填充字符</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpad(<span class="string">'a'</span>, <span class="number">5</span>); <span class="comment">// -&gt; 'a    '</span></span><br><span class="line">rpad(<span class="string">'a'</span>, <span class="number">5</span>, <span class="string">'-'</span>); <span class="comment">// -&gt; 'a----'</span></span><br><span class="line">rpad(<span class="string">'abc'</span>, <span class="number">3</span>, <span class="string">'-'</span>); <span class="comment">// -&gt; 'abc'</span></span><br><span class="line">rpad(<span class="string">'abc'</span>, <span class="number">5</span>, <span class="string">'ab'</span>); <span class="comment">// -&gt; 'abcab'</span></span><br></pre></td></tr></table></figure><h2 id="rtrim"><a href="#rtrim" class="headerlink" title="rtrim"></a>rtrim</h2><p>删除字符串尾部指定字符或空格。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function rtrim(str: string, chars?: string | string[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>chars</td><td>删除字符</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rtrim(<span class="string">' abc  '</span>); <span class="comment">// -&gt; ' abc'</span></span><br><span class="line">rtrim(<span class="string">'_abc_'</span>, <span class="string">'_'</span>); <span class="comment">// -&gt; '_abc'</span></span><br><span class="line">rtrim(<span class="string">'_abc_'</span>, [<span class="string">'c'</span>, <span class="string">'_'</span>]); <span class="comment">// -&gt; '_ab'</span></span><br></pre></td></tr></table></figure><h2 id="safeCb"><a href="#safeCb" class="headerlink" title="safeCb"></a>safeCb</h2><p>创建回调函数，内部模块使用。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function safeCb(<br>    val?: any,<br>    ctx?: any,<br>    argCount?: number<br>): types.AnyFn;</code><br></pre><br></details><h2 id="safeDel"><a href="#safeDel" class="headerlink" title="safeDel"></a>safeDel</h2><p>删除对象属性。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function safeDel(obj: any, path: string | string[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>path</td><td>属性路径</td></tr><tr><td>返回值</td><td>删除值或 undefined</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: &#123; <span class="attr">aa</span>: &#123; <span class="attr">aaa</span>: <span class="number">1</span> &#125; &#125; &#125;;</span><br><span class="line">safeDel(obj, <span class="string">'a.aa.aaa'</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">safeDel(obj, [<span class="string">'a'</span>, <span class="string">'aa'</span>]); <span class="comment">// -&gt; &#123;&#125;</span></span><br><span class="line">safeDel(obj, <span class="string">'a.b'</span>); <span class="comment">// -&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="safeGet"><a href="#safeGet" class="headerlink" title="safeGet"></a>safeGet</h2><p>获取对象属性值，路径不存在时不报错。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function safeGet(obj: any, path: string | string[]): any;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>path</td><td>属性路径</td></tr><tr><td>返回值</td><td>属性值或 undefined</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: &#123; <span class="attr">aa</span>: &#123; <span class="attr">aaa</span>: <span class="number">1</span> &#125; &#125; &#125;;</span><br><span class="line">safeGet(obj, <span class="string">'a.aa.aaa'</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">safeGet(obj, [<span class="string">'a'</span>, <span class="string">'aa'</span>]); <span class="comment">// -&gt; &#123;aaa: 1&#125;</span></span><br><span class="line">safeGet(obj, <span class="string">'a.b'</span>); <span class="comment">// -&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="safeSet"><a href="#safeSet" class="headerlink" title="safeSet"></a>safeSet</h2><p>设置对象属性值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function safeSet(<br>    obj: any,<br>    path: string | string[],<br>    val: any<br>): void;</code><br></pre><br></details><p>如果路径的某一层不存在，将会创建一个空对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>path</td><td>属性路径</td></tr><tr><td>val</td><td>要设置的值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">safeSet(obj, <span class="string">'a.aa.aaa'</span>, <span class="number">1</span>); <span class="comment">// obj = &#123;a: &#123;aa: &#123;aaa: 1&#125;&#125;&#125;</span></span><br><span class="line">safeSet(obj, [<span class="string">'a'</span>, <span class="string">'aa'</span>], <span class="number">2</span>); <span class="comment">// obj = &#123;a: &#123;aa: 2&#125;&#125;</span></span><br><span class="line">safeSet(obj, <span class="string">'a.b'</span>, <span class="number">3</span>); <span class="comment">// obj = &#123;a: &#123;aa: 2, b: 3&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="safeStorage"><a href="#safeStorage" class="headerlink" title="safeStorage"></a>safeStorage</h2><p>安全地使用 storage，使其在旧浏览器及 safari 无痕模式下能正常运行。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function safeStorage(type?: string): typeof window.localStorage;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>type=’local’</td><td>模式，local 或 session</td></tr><tr><td>返回值</td><td>指定 storage</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> localStorage = safeStorage(<span class="string">'local'</span>);</span><br><span class="line">localStorage.setItem(<span class="string">'licia'</span>, <span class="string">'util'</span>);</span><br></pre></td></tr></table></figure><h2 id="sameOrigin"><a href="#sameOrigin" class="headerlink" title="sameOrigin"></a>sameOrigin</h2><p>检查两个 url 是否同源。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sameOrigin(url1: string, url2: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>url1</td><td>要检查的 url</td></tr><tr><td>url2</td><td>要检查的 url</td></tr><tr><td>返回值</td><td>同源，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">'http://example.com/a.html'</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">'http://example.com/b.html'</span>;</span><br><span class="line"><span class="keyword">const</span> url3 = <span class="string">'http://licia.liriliri.io'</span>;</span><br><span class="line">sameOrigin(url1, url2); <span class="comment">// -&gt; true</span></span><br><span class="line">sameOrigin(url1, url3); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="sample"><a href="#sample" class="headerlink" title="sample"></a>sample</h2><p>从集合中随机抽取部分样本。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sample(obj: any, n: number): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标集合</td></tr><tr><td>n</td><td>样本数量</td></tr><tr><td>返回值</td><td>样本</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sample([<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>], <span class="number">2</span>); <span class="comment">// -&gt; [2, 3]</span></span><br><span class="line">sample(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;, <span class="number">1</span>); <span class="comment">// -&gt; [2]</span></span><br></pre></td></tr></table></figure><h2 id="scrollTo"><a href="#scrollTo" class="headerlink" title="scrollTo"></a>scrollTo</h2><p>以动画的形式滚动到指定目标。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function scrollTo(<br>    target: Element | string | number,<br>    options: {<br>        tolerance?: number;<br>        duration?: number;<br>        easing?: string | Function;<br>        callback?: types.AnyFn;<br>    }<br>);</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>target</td><td>滚动目标</td></tr><tr><td>options</td><td>滚动选项</td></tr></tbody></table><h3 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h3><table><thead><tr><th>选项名</th><th>说明</th></tr></thead><tbody><tr><td>tolerance=0</td><td>偏移</td></tr><tr><td>duration=800</td><td>时长</td></tr><tr><td>easing=outQuart</td><td>缓动函数</td></tr><tr><td>callback=noop</td><td>结束回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scrollTo(<span class="string">'body'</span>, &#123;</span><br><span class="line">    tolerance: <span class="number">0</span>,</span><br><span class="line">    duration: <span class="number">800</span>,</span><br><span class="line">    easing: <span class="string">'outQuart'</span>,</span><br><span class="line">    callback: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="seedRandom"><a href="#seedRandom" class="headerlink" title="seedRandom"></a>seedRandom</h2><p>随机数生成器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function seedRandom(<br>    seed: number,<br>    min?: number,<br>    max?: number,<br>    floating?: boolean<br>): () =&gt; number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>seed</td><td>随机种子</td></tr><tr><td>min=0</td><td>最小值</td></tr><tr><td>max=1</td><td>最大值</td></tr><tr><td>floating=true</td><td>是否允许浮点数</td></tr><tr><td>返回值</td><td>生成随机数字序列的函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> random = seedRandom(<span class="number">19920719</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="literal">false</span>);</span><br><span class="line">random(); <span class="comment">// -&gt; 7</span></span><br><span class="line">random(); <span class="comment">// -&gt; 68</span></span><br></pre></td></tr></table></figure><h2 id="selectionSort"><a href="#selectionSort" class="headerlink" title="selectionSort"></a>selectionSort</h2><p>选择排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function selectionSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectionSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h2><p>CSS 选择器解析器。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace selector {<br>    interface IToken {<br>        type: string;<br>        value: string;<br>    }<br>}<br>const selector: {<br>    parse(selector: string): Array&lt;selector.IToken[]&gt;;<br>    stringify(selector: Array&lt;selector.IToken[]&gt;): string;<br>};</code><br></pre><br></details><h3 id="parse-6"><a href="#parse-6" class="headerlink" title="parse"></a>parse</h3><p>将 CSS 选择器转换为 js 对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>selector</td><td>CSS 选择器</td></tr><tr><td>返回值</td><td>js 对象</td></tr></tbody></table><h3 id="stringify-5"><a href="#stringify-5" class="headerlink" title="stringify"></a>stringify</h3><p>将 js 对象序列化成 CSS 选择器。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>groups</td><td>要序列化的对象</td></tr><tr><td>返回值</td><td>CSS 选择器</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> groups = selector.parse(<span class="string">'#test, input.user[name="licia"]'</span>);</span><br><span class="line"><span class="comment">// -&gt; [[&#123;type: 'id', value: 'test'&#125;],[&#123;type: 'tag', value: 'input'&#125;...]]</span></span><br><span class="line">selector.stringify(groups);</span><br></pre></td></tr></table></figure><h2 id="shebang"><a href="#shebang" class="headerlink" title="shebang"></a>shebang</h2><p>获取 shebang 命令。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function shebang(str: string): string | void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>要获取命令的文本</td></tr><tr><td>返回值</td><td>Shebang 命令</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shebang(<span class="string">'#!/usr/bin/env node'</span>); <span class="comment">// -&gt; '/usr/bin/env node'</span></span><br><span class="line">shebang(<span class="string">'#!/bin/bash'</span>); <span class="comment">// -&gt; '/bin/bash'</span></span><br><span class="line">shebang(<span class="string">'node'</span>); <span class="comment">// -&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="shellSort"><a href="#shellSort" class="headerlink" title="shellSort"></a>shellSort</h2><p>希尔排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function shellSort(arr: any[], cmp?: types.AnyFn): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>要排序的数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>有序数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellSort([<span class="number">2</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a>shuffle</h2><p>将数组中元素的顺序打乱。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function shuffle(arr: any[]): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shuffle([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; [3, 1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="size-6"><a href="#size-6" class="headerlink" title="size"></a>size</h2><p>获取对象的大小或类数组元素的长度。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function size(obj: any): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标集合</td></tr><tr><td>返回值</td><td>集合大小</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">size(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;); <span class="comment">// -&gt; 2</span></span><br><span class="line">size([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; 3</span></span><br></pre></td></tr></table></figure><h2 id="sizeof"><a href="#sizeof" class="headerlink" title="sizeof"></a>sizeof</h2><p>计算 js 对象大概的内存占用。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sizeof(obj: any): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要计算的对象</td></tr><tr><td>返回值</td><td>对象大小，单位是字节</td></tr></tbody></table><p>一个字符占用 2 字节，布尔值 4 字节，数字 8 字节。</p><p>对象键名当成字符串来计算。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sizeof(<span class="string">'a'</span>); <span class="comment">// -&gt; 2</span></span><br><span class="line">sizeof(<span class="number">8</span>); <span class="comment">// -&gt; 8</span></span><br><span class="line">sizeof(<span class="literal">false</span>); <span class="comment">// -&gt; 4</span></span><br><span class="line">sizeof(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; 0</span></span><br><span class="line">sizeof(&#123; <span class="attr">a</span>: <span class="string">'b'</span> &#125;); <span class="comment">// -&gt; 4</span></span><br></pre></td></tr></table></figure><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><p>使用 Promise 模拟暂停方法。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sleep(timeout: number): Promise&lt;void&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>timeout</td><td>暂停时长</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> sleep(<span class="number">2000</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h2 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h2><p>截取数组的一部分生成新数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function slice(<br>    array: any[],<br>    start?: number,<br>    end?: number<br>): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>array</td><td>目标数组</td></tr><tr><td>start=0</td><td>起始位置</td></tr><tr><td>end=array.length</td><td>结束位置，不包含</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">1</span>, <span class="number">2</span>); <span class="comment">// -&gt; [2]</span></span><br></pre></td></tr></table></figure><h2 id="slugify"><a href="#slugify" class="headerlink" title="slugify"></a>slugify</h2><p>Slug 化字符串。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function slugify(<br>    str: string,<br>    replacement?: { [index: string]: string }<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>replacement</td><td>自定义替换</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slugify(<span class="string">'I ♥ pony'</span>); <span class="comment">// -&gt; 'I-love-pony'</span></span><br><span class="line">slugify(<span class="string">'I ♥ pony'</span>, &#123; <span class="string">' '</span>: <span class="string">'_'</span> &#125;); <span class="comment">// -&gt; 'I_love_pony'</span></span><br></pre></td></tr></table></figure><h2 id="snakeCase"><a href="#snakeCase" class="headerlink" title="snakeCase"></a>snakeCase</h2><p>转换字符串为下划线式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function snakeCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>下划线式字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snakeCase(<span class="string">'fooBar'</span>); <span class="comment">// -&gt; foo_bar</span></span><br><span class="line">snakeCase(<span class="string">'foo bar'</span>); <span class="comment">// -&gt; foo_bar</span></span><br><span class="line">snakeCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; foo_bar</span></span><br></pre></td></tr></table></figure><h2 id="some"><a href="#some" class="headerlink" title="some"></a>some</h2><p>检查集合中是否有元素通过真值检测。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function some&lt;T&gt;(<br>    list: types.List&lt;T&gt;,<br>    iterator?: types.ListIterator&lt;T, boolean&gt;,<br>    context?: any<br>): boolean;<br>function some&lt;T&gt;(<br>    object: types.Dictionary&lt;T&gt;,<br>    iterator?: types.ObjectIterator&lt;T, boolean&gt;,<br>    context?: any<br>): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标集合</td></tr><tr><td>predicate</td><td>真值检测函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>如果有元素通过真值检测，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">some([<span class="number">2</span>, <span class="number">5</span>], <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="sortBy"><a href="#sortBy" class="headerlink" title="sortBy"></a>sortBy</h2><p>遍历集合中的元素，将其作为参数调用函数，并以得到的结果为依据对数组进行排序。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sortBy(<br>    arr: any,<br>    iterator?: types.AnyFn,<br>    ctx?: any<br>): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源集合</td></tr><tr><td>iteratee=identity</td><td>排序依据生成函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>排序后的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sortBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sin(num);</span><br><span class="line">&#125;); <span class="comment">// -&gt; [5, 4, 6, 3, 1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="sortKeys"><a href="#sortKeys" class="headerlink" title="sortKeys"></a>sortKeys</h2><p>排序对象的键名。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sortKeys(<br>    obj: object,<br>    options?: {<br>        deep?: boolean;<br>        comparator?: types.AnyFn;<br>    }<br>): object;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>要排序的对象</td></tr><tr><td>options</td><td>排序选项</td></tr><tr><td>返回值</td><td>排序后的对象</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>deep=false</td><td>是否递归</td></tr><tr><td>comparator</td><td>比较器</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sortKeys(</span><br><span class="line">    &#123; <span class="attr">b</span>: &#123; <span class="attr">d</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">1</span> &#125;, <span class="attr">a</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        deep: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">); <span class="comment">// -&gt; &#123;a: 0, b: &#123;c: 1, d: 2&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="spaceCase"><a href="#spaceCase" class="headerlink" title="spaceCase"></a>spaceCase</h2><p>将字符串转换为空格式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function spaceCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>空格式字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spaceCase(<span class="string">'fooBar'</span>); <span class="comment">// -&gt; foo bar</span></span><br><span class="line">spaceCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; foo bar</span></span><br><span class="line">spaceCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; foo bar</span></span><br></pre></td></tr></table></figure><h2 id="splitCase"><a href="#splitCase" class="headerlink" title="splitCase"></a>splitCase</h2><p>将不同命名式的字符串拆分成数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function splitCase(str: string): string[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>目标字符串</td></tr><tr><td>返回值</td><td>拆分成的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">splitCase(<span class="string">'foo-bar'</span>); <span class="comment">// -&gt; ['foo', 'bar']</span></span><br><span class="line">splitCase(<span class="string">'foo bar'</span>); <span class="comment">// -&gt; ['foo', 'bar']</span></span><br><span class="line">splitCase(<span class="string">'foo_bar'</span>); <span class="comment">// -&gt; ['foo', 'bar']</span></span><br><span class="line">splitCase(<span class="string">'foo.bar'</span>); <span class="comment">// -&gt; ['foo', 'bar']</span></span><br><span class="line">splitCase(<span class="string">'fooBar'</span>); <span class="comment">// -&gt; ['foo', 'bar']</span></span><br><span class="line">splitCase(<span class="string">'foo-Bar'</span>); <span class="comment">// -&gt; ['foo', 'bar']</span></span><br></pre></td></tr></table></figure><h2 id="splitPath"><a href="#splitPath" class="headerlink" title="splitPath"></a>splitPath</h2><p>将路径拆分为文件夹路径，文件名和扩展名。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function splitPath(<br>    path: string<br>): {<br>    dir: string;<br>    name: string;<br>    ext: string;<br>};</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>目标路径</td></tr><tr><td>返回值</td><td>包含文件夹路径，文件名和扩展名的对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">splitPath(<span class="string">'f:/foo/bar.txt'</span>); <span class="comment">// -&gt; &#123;dir: 'f:/foo/', name: 'bar.txt', ext: '.txt'&#125;</span></span><br><span class="line">splitPath(<span class="string">'/home/foo/bar.txt'</span>); <span class="comment">// -&gt; &#123;dir: '/home/foo/', name: 'bar.txt', ext: '.txt'&#125;</span></span><br></pre></td></tr></table></figure><h2 id="stackTrace"><a href="#stackTrace" class="headerlink" title="stackTrace"></a>stackTrace</h2><p>获取 v8 的 CallSite 对象。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stackTrace(): any[];</code><br></pre><br></details><p><a href="https://v8.dev/docs/stack-trace-api" target="_blank" rel="noopener">Stack trace 接口说明</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stackTrace(); <span class="comment">// -&gt; List of CallSite objects</span></span><br></pre></td></tr></table></figure><h2 id="startWith"><a href="#startWith" class="headerlink" title="startWith"></a>startWith</h2><p>检查字符串是否以指定字符串开头。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function startWith(str: string, prefix: string): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>目标字符串</td></tr><tr><td>prefix</td><td>字符串前缀</td></tr><tr><td>返回值</td><td>如果是前缀，返回真</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startWith(<span class="string">'ab'</span>, <span class="string">'a'</span>); <span class="comment">// -&gt; true</span></span><br></pre></td></tr></table></figure><h2 id="strHash"><a href="#strHash" class="headerlink" title="strHash"></a>strHash</h2><p>使用 djb2 算法进行字符串哈希。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function strHash(str: string): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>目标字符串</td></tr><tr><td>返回值</td><td>哈希结果</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strHash(<span class="string">'test'</span>); <span class="comment">// -&gt; 2090770981</span></span><br></pre></td></tr></table></figure><h2 id="strToBytes"><a href="#strToBytes" class="headerlink" title="strToBytes"></a>strToBytes</h2><p>将字符串转换为字节数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function strToBytes(str: string, encoding?: string): number[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>目标字符串</td></tr><tr><td>encoding=utf8</td><td>字符串编码</td></tr><tr><td>返回值</td><td>字节数组</td></tr></tbody></table><p>支持编码：utf8，hex，base64</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strToBytes(<span class="string">'licia'</span>); <span class="comment">// -&gt; [108, 105, 99, 105, 97]</span></span><br><span class="line">strToBytes(<span class="string">'qK6b/w=='</span>, <span class="string">'base64'</span>); <span class="comment">// -&gt; [168, 174, 155, 255]</span></span><br></pre></td></tr></table></figure><h2 id="strTpl"><a href="#strTpl" class="headerlink" title="strTpl"></a>strTpl</h2><p>简单的字符串模板。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function strTpl(str: string, data: types.PlainObj&lt;any&gt;): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>模板字符串</td></tr><tr><td>data</td><td>渲染数据</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strTpl(<span class="string">'Hello, &#123;&#123;name.first&#125;&#125;!'</span>, &#123; <span class="attr">name</span>: &#123; <span class="attr">first</span>: <span class="string">'licia'</span> &#125; &#125;); <span class="comment">// -&gt; 'Hello, licia!'</span></span><br></pre></td></tr></table></figure><h2 id="strWidth"><a href="#strWidth" class="headerlink" title="strWidth"></a>strWidth</h2><p>获取字符串的可见宽度。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function strWidth(str: string): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>要获取宽度的字符串</td></tr><tr><td>返回值</td><td>可见宽度</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strWidth(<span class="string">'Hello \nworld!'</span>); <span class="comment">// -&gt; 12</span></span><br><span class="line">strWidth(<span class="string">'\u001b[4m你好，世界！\u001b[0m'</span>); <span class="comment">// -&gt; 12</span></span><br></pre></td></tr></table></figure><h2 id="stringify-6"><a href="#stringify-6" class="headerlink" title="stringify"></a>stringify</h2><p>JSON 序列化，支持循环引用和函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stringify(obj: any, spaces?: number): string;</code><br></pre><br></details><p>undefined 被当作 null 处理。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>spaces</td><td>缩进</td></tr><tr><td>返回值</td><td>序列化后的字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stringify(&#123; <span class="attr">a</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125; &#125;); <span class="comment">// -&gt; '&#123;"a":"[Function function () &#123;&#125;]"&#125;'</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123;&#125; &#125;;</span><br><span class="line">obj.b = obj;</span><br><span class="line">stringify(obj); <span class="comment">// -&gt; '&#123;"a":1,"b":"[Circular ~]"&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="stringifyAll"><a href="#stringifyAll" class="headerlink" title="stringifyAll"></a>stringifyAll</h2><p>序列化对象，保留类型信息。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace stringifyAll {<br>    function parse(str: string): any;<br>}<br>function stringifyAll(<br>    obj: any,<br>    options?: {<br>        unenumerable?: boolean;<br>        symbol?: boolean;<br>        accessGetter?: boolean;<br>        timeout?: number;<br>        depth?: number;<br>        ignore?: any[];<br>    }<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>源对象</td></tr><tr><td>options</td><td>序列化选项</td></tr><tr><td>返回值</td><td>序列化后的字符串</td></tr></tbody></table><p>可用选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>unenumerable=false</td><td>包含不可枚举值</td></tr><tr><td>symbol=false</td><td>包含 Symbol 键名</td></tr><tr><td>accessGetter=false</td><td>获取 getter 值</td></tr><tr><td>timeout=0</td><td>序列化超时时间</td></tr><tr><td>depth=0</td><td>遍历对象的最大深度</td></tr><tr><td>ignore</td><td>忽略的对象</td></tr></tbody></table><p>超时后，所有未序列化的值都会变成 “Timeout”。</p><h3 id="parse-7"><a href="#parse-7" class="headerlink" title="parse"></a>parse</h3><p>将字符串反序列化回对象。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>序列化后的字符串</td></tr><tr><td>返回值</td><td>目标对象</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stringifyAll(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; '&#123;"value":"function test() &#123;&#125;","type":"Function",...&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="stripAnsi"><a href="#stripAnsi" class="headerlink" title="stripAnsi"></a>stripAnsi</h2><p>清除字符串中的 ansi 控制码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stripAnsi(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stripAnsi(<span class="string">'\u001b[4mcake\u001b[0m'</span>); <span class="comment">// -&gt; 'cake'</span></span><br></pre></td></tr></table></figure><h2 id="stripCmt"><a href="#stripCmt" class="headerlink" title="stripCmt"></a>stripCmt</h2><p>清除源码中的注释。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stripCmt(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源码</td></tr><tr><td>返回值</td><td>无注释代码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stripCmt(<span class="string">'// comment \n var a = 5; \/* comment2\n * comment3\n *\/'</span>); <span class="comment">// -&gt; ' var a = 5; '</span></span><br></pre></td></tr></table></figure><h2 id="stripColor"><a href="#stripColor" class="headerlink" title="stripColor"></a>stripColor</h2><p>清除字符串中的 ansi 颜色控制码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stripColor(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stripColor(<span class="string">'\u001b[31mred\u001b[39m'</span>); <span class="comment">// -&gt; 'red'</span></span><br></pre></td></tr></table></figure><h2 id="stripHtmlTag"><a href="#stripHtmlTag" class="headerlink" title="stripHtmlTag"></a>stripHtmlTag</h2><p>清除字符串中的 html 标签。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stripHtmlTag(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stripHtmlTag(<span class="string">'&lt;p&gt;Hello&lt;/p&gt;'</span>); <span class="comment">// -&gt; 'Hello'</span></span><br></pre></td></tr></table></figure><h2 id="stripIndent"><a href="#stripIndent" class="headerlink" title="stripIndent"></a>stripIndent</h2><p>清除多行文本的缩进。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stripIndent(str: string): string;<br>function stripIndent(<br>    literals: TemplateStringsArray,<br>    …placeholders: any[]<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><p>它可以像函数一样调用，也可以当成标签模板使用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stripIndent<span class="string">`</span></span><br><span class="line"><span class="string">    Test string</span></span><br><span class="line"><span class="string">        * item one</span></span><br><span class="line"><span class="string">        * item two</span></span><br><span class="line"><span class="string">`</span>; <span class="comment">// -&gt; 'Test string\n    * item one\n    * item two'</span></span><br></pre></td></tr></table></figure><h2 id="stripNum"><a href="#stripNum" class="headerlink" title="stripNum"></a>stripNum</h2><p>将数字转换为指定的精度。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function stripNum(num: number, precision?: number): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>源数字</td></tr><tr><td>precision=12</td><td>精度</td></tr><tr><td>返回值</td><td>目标数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stripNum(<span class="number">0.1</span> + <span class="number">0.2</span>); <span class="comment">// -&gt; 0.3</span></span><br></pre></td></tr></table></figure><h2 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h2><p>计算数字和。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function sum(…num: number[]): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…num</td><td>要计算的数字</td></tr><tr><td>返回值</td><td>数字和</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>); <span class="comment">// -&gt; 8</span></span><br></pre></td></tr></table></figure><h2 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h2><p>交换数组中的两项。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function swap(arr: any[], a: number, b: number): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>目标数组</td></tr><tr><td>a</td><td>序号一</td></tr><tr><td>b</td><td>序号二</td></tr><tr><td>返回值</td><td>数组本身</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">swap(arr, <span class="number">0</span>, <span class="number">1</span>); <span class="comment">// -&gt; [2, 1]</span></span><br></pre></td></tr></table></figure><h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><p>输出表格字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function table(rows: Array&lt;string[]&gt;): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>rows</td><td>表格数据</td></tr><tr><td>返回值</td><td>表格字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">table([</span><br><span class="line">    [<span class="string">''</span>, <span class="string">'firstName'</span>, <span class="string">'lastName'</span>],</span><br><span class="line">    [<span class="string">'daughter'</span>, <span class="string">'Emily'</span>, <span class="string">'Smith'</span>],</span><br><span class="line">    [<span class="string">'father'</span>, <span class="string">'John'</span>, <span class="string">'Smith'</span>],</span><br><span class="line">    [<span class="string">'mother'</span>, <span class="string">'Jane'</span>, <span class="string">'Smith'</span>]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h2 id="template"><a href="#template" class="headerlink" title="template"></a>template</h2><p>将模板字符串编译成函数用于渲染。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function template(str: string, util?: any): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>模板字符串</td></tr><tr><td>util</td><td>模板函数</td></tr><tr><td>返回值</td><td>编译后的模板函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">template(<span class="string">'Hello &lt;%= name %&gt;!'</span>)(&#123; <span class="attr">name</span>: <span class="string">'licia'</span> &#125;); <span class="comment">// -&gt; 'Hello licia!'</span></span><br><span class="line">template(<span class="string">'&lt;p&gt;&lt;%- name %&gt;&lt;/p&gt;'</span>)(&#123; <span class="attr">name</span>: <span class="string">'&lt;licia&gt;'</span> &#125;); <span class="comment">// -&gt; '&lt;p&gt;&amp;lt;licia&amp;gt;&lt;/p&gt;'</span></span><br><span class="line">template(<span class="string">'&lt;%if (echo) &#123;%&gt;Hello licia!&lt;%&#125;%&gt;'</span>)(&#123; <span class="attr">echo</span>: <span class="literal">true</span> &#125;); <span class="comment">// -&gt; 'Hello licia!'</span></span><br><span class="line">template(<span class="string">'&lt;p&gt;&lt;%= util["upperCase"](name) %&gt;&lt;/p&gt;'</span>, &#123;</span><br><span class="line">    upperCase: <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str.toLocaleUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(&#123; <span class="attr">name</span>: <span class="string">'licia'</span> &#125;); <span class="comment">// -&gt; '&lt;p&gt;LICIA&lt;/p&gt;'</span></span><br></pre></td></tr></table></figure><h2 id="throttle"><a href="#throttle" class="headerlink" title="throttle"></a>throttle</h2><p>返回函数的节流阀版本。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function throttle&lt;T extends types.AnyFn&gt;(fn: T, wait: number): T;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>wait</td><td>延迟毫秒数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> updatePos = throttle(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;, <span class="number">100</span>);</span><br><span class="line"><span class="comment">// $(window).scroll(updatePos);</span></span><br></pre></td></tr></table></figure><h2 id="through"><a href="#through" class="headerlink" title="through"></a>through</h2><p>stream Transform 类的简单包装。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">import stream = require(&#x27;stream&#x27;);<br>namespace through {<br>    interface ThroughConstructor extends stream.Transform {<br>        new (opts?: stream.DuplexOptions): stream.Transform;<br>        (opts?: stream.DuplexOptions): stream.Transform;<br>    }<br>    type TransformCallback = (err?: any, data?: any) =&gt; void;<br>    type TransformFunction = (<br>        this: stream.Transform,<br>        chunk: any,<br>        enc: string,<br>        callback: TransformCallback<br>    ) =&gt; void;<br>    type FlushCallback = (<br>        this: stream.Transform,<br>        flushCallback: () =&gt; void<br>    ) =&gt; void;<br>    function obj(<br>        transform?: TransformFunction,<br>        flush?: FlushCallback<br>    ): stream.Transform;<br>    function ctor(<br>        transform?: TransformFunction,<br>        flush?: FlushCallback<br>    ): ThroughConstructor;<br>    function ctor(<br>        opts?: stream.DuplexOptions,<br>        transform?: TransformFunction,<br>        flush?: FlushCallback<br>    ): ThroughConstructor;<br>}<br>function through(<br>    transform?: through.TransformFunction,<br>    flush?: through.FlushCallback<br>): stream.Transform;<br>function through(<br>    opts?: stream.DuplexOptions,<br>    transform?: through.TransformFunction,<br>    flush?: through.FlushCallback<br>): stream.Transform;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>opts={}</td><td>初始化流选项</td></tr><tr><td>transform</td><td>Transform 实现</td></tr><tr><td>flush</td><td>Flush 实现</td></tr></tbody></table><h3 id="obj"><a href="#obj" class="headerlink" title="obj"></a>obj</h3><p>设置 objectMode 为真的快捷方式。</p><h3 id="ctor"><a href="#ctor" class="headerlink" title="ctor"></a>ctor</h3><p>返回继承 Transform 的类。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.createReadStream(<span class="string">'in.txt'</span>)</span><br><span class="line">    .pipe(</span><br><span class="line">        through(<span class="function"><span class="keyword">function</span>(<span class="params">chunk, enc, cb</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// Do something to chunk</span></span><br><span class="line">            <span class="keyword">this</span>.push(chunk);</span><br><span class="line">            cb();</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">    .pipe(fs.createWriteStream(<span class="string">'out.txt'</span>));</span><br></pre></td></tr></table></figure><h2 id="timeAgo"><a href="#timeAgo" class="headerlink" title="timeAgo"></a>timeAgo</h2><p>将时间格式化成多久之前的形式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function timeAgo(<br>    date: Date | number,<br>    now?: Date | number<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>date</td><td>目标日期</td></tr><tr><td>now=new Date</td><td>当时日期</td></tr><tr><td>返回值</td><td>格式化时间表示</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">timeAgo(now - <span class="number">1000</span> * <span class="number">6</span>); <span class="comment">// -&gt; right now</span></span><br><span class="line">timeAgo(now + <span class="number">1000</span> * <span class="number">15</span>); <span class="comment">// -&gt; in 15 minutes</span></span><br><span class="line">timeAgo(now - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">5</span>, now); <span class="comment">// -&gt; 5 hours ago</span></span><br></pre></td></tr></table></figure><h2 id="timeTaken"><a href="#timeTaken" class="headerlink" title="timeTaken"></a>timeTaken</h2><p>获取函数的执行时间。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function timeTaken(fn: types.AnyFn): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>要计算执行时间的函数</td></tr><tr><td>返回值</td><td>执行时间，单位毫秒</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">timeTaken(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; Time taken to execute given function.</span></span><br></pre></td></tr></table></figure><h2 id="times"><a href="#times" class="headerlink" title="times"></a>times</h2><p>调用目标函数 n 次。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function times&lt;T&gt;(<br>    n: number,<br>    fn: (n: number) =&gt; T,<br>    ctx?: any<br>): T[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>n</td><td>调用次数</td></tr><tr><td>fn</td><td>目标函数</td></tr><tr><td>ctx</td><td>函数上下文</td></tr><tr><td>返回值</td><td>结果数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">times(<span class="number">3</span>, <span class="built_in">String</span>); <span class="comment">// -&gt; ['0', '1', '2']</span></span><br></pre></td></tr></table></figure><h2 id="toArr-3"><a href="#toArr-3" class="headerlink" title="toArr"></a>toArr</h2><p>将任意值转换为数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toArr(val: any): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>转换后的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">toArr(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;); <span class="comment">// -&gt; [&#123;a: 1, b: 2&#125;]</span></span><br><span class="line">toArr(<span class="string">'abc'</span>); <span class="comment">// -&gt; ['abc']</span></span><br><span class="line">toArr(<span class="number">1</span>); <span class="comment">// -&gt; [1]</span></span><br><span class="line">toArr(<span class="literal">null</span>); <span class="comment">// -&gt; []</span></span><br></pre></td></tr></table></figure><h2 id="toAsync"><a href="#toAsync" class="headerlink" title="toAsync"></a>toAsync</h2><p>让 generator 可以像 async/await 一样使用。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toAsync(fn: types.AnyFn): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>Generator 函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sleep = <span class="built_in">require</span>(<span class="string">'licia/sleep'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fn = toAsync(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> sleep(<span class="number">200</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'licia'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fn().then(<span class="function"><span class="params">str</span> =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure><h2 id="toBool"><a href="#toBool" class="headerlink" title="toBool"></a>toBool</h2><p>将任意值转换为布尔值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toBool(val: any): boolean;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>转换后的布尔值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">toBool(<span class="literal">true</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">toBool(<span class="literal">null</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">toBool(<span class="number">1</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">toBool(<span class="number">0</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">toBool(<span class="string">'0'</span>); <span class="comment">// -&gt; false</span></span><br><span class="line">toBool(<span class="string">'1'</span>); <span class="comment">// -&gt; true</span></span><br><span class="line">toBool(<span class="string">'false'</span>); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><h2 id="toDate"><a href="#toDate" class="headerlink" title="toDate"></a>toDate</h2><p>将任意值转换为日期类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toDate(val: any): Date;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>转换后的日期值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">toDate(<span class="string">'20180501'</span>);</span><br><span class="line">toDate(<span class="string">'2018-05-01'</span>);</span><br><span class="line">toDate(<span class="number">1525107450849</span>);</span><br></pre></td></tr></table></figure><h2 id="toEl"><a href="#toEl" class="headerlink" title="toEl"></a>toEl</h2><p>将 html 字符串转换为 dom 元素。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toEl(str: string): Element;</code><br></pre><br></details><p>必须只有一个根元素。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>html 字符串</td></tr><tr><td>返回值</td><td>html 元素</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toEl(<span class="string">'&lt;div&gt;test&lt;/div&gt;'</span>);</span><br></pre></td></tr></table></figure><h2 id="toInt"><a href="#toInt" class="headerlink" title="toInt"></a>toInt</h2><p>将任意值转换为整数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toInt(val: any): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>转换后的整数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toInt(<span class="number">1.1</span>); <span class="comment">// -&gt; 1</span></span><br><span class="line">toInt(<span class="literal">undefined</span>); <span class="comment">// -&gt; 0</span></span><br></pre></td></tr></table></figure><h2 id="toNum"><a href="#toNum" class="headerlink" title="toNum"></a>toNum</h2><p>将任意值转换为数字。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toNum(val: any): number;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>转换后的数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toNum(<span class="string">'5'</span>); <span class="comment">// -&gt; 5</span></span><br></pre></td></tr></table></figure><h2 id="toSrc"><a href="#toSrc" class="headerlink" title="toSrc"></a>toSrc</h2><p>将函数转换为源码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toSrc(fn: types.AnyFn): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>目标函数</td></tr><tr><td>返回值</td><td>源码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toSrc(<span class="built_in">Math</span>.min); <span class="comment">// -&gt; 'function min() &#123; [native code] &#125;'</span></span><br><span class="line">toSrc(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; 'function () &#123; &#125;'</span></span><br></pre></td></tr></table></figure><h2 id="toStr"><a href="#toStr" class="headerlink" title="toStr"></a>toStr</h2><p>将任意值转换为字符串。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function toStr(val: any): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>要转换的值</td></tr><tr><td>返回值</td><td>转换后的字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">toStr(<span class="literal">null</span>); <span class="comment">// -&gt; ''</span></span><br><span class="line">toStr(<span class="number">1</span>); <span class="comment">// -&gt; '1'</span></span><br><span class="line">toStr(<span class="literal">false</span>); <span class="comment">// -&gt; 'false'</span></span><br><span class="line">toStr([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// -&gt; '1,2,3'</span></span><br></pre></td></tr></table></figure><h2 id="topoSort"><a href="#topoSort" class="headerlink" title="topoSort"></a>topoSort</h2><p>拓扑排序实现。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function topoSort(edges: any[]): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>edges</td><td>依赖关系</td></tr><tr><td>返回值</td><td>排序后的数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">topoSort([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">2</span>]</span><br><span class="line">]); <span class="comment">// -&gt; [1, 3, 2]</span></span><br></pre></td></tr></table></figure><h2 id="trigger"><a href="#trigger" class="headerlink" title="trigger"></a>trigger</h2><p>触发浏览器事件。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function trigger(el: Element, type: string, options?: any);<br>function trigger(type: string, options?: any);</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>el=document</td><td>目标元素</td></tr><tr><td>type</td><td>事件类型</td></tr><tr><td>options</td><td>选项</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trigger(<span class="built_in">document</span>.getElementById(<span class="string">'test'</span>), <span class="string">'mouseup'</span>);</span><br><span class="line">trigger(<span class="string">'keydown'</span>, &#123; <span class="attr">keyCode</span>: <span class="number">65</span> &#125;);</span><br></pre></td></tr></table></figure><h2 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h2><p>删除字符串两边指定字符或空格。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function trim(str: string, chars?: string | string[]): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>chars</td><td>删除字符</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trim(<span class="string">' abc  '</span>); <span class="comment">// -&gt; 'abc'</span></span><br><span class="line">trim(<span class="string">'_abc_'</span>, <span class="string">'_'</span>); <span class="comment">// -&gt; 'abc'</span></span><br><span class="line">trim(<span class="string">'_abc_'</span>, [<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'_'</span>]); <span class="comment">// -&gt; 'b'</span></span><br></pre></td></tr></table></figure><h2 id="truncate"><a href="#truncate" class="headerlink" title="truncate"></a>truncate</h2><p>截取字符串，使其长度为指定值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function truncate(<br>    txt: string,<br>    width: number,<br>    options?: {<br>        ellipsis?: string;<br>        separator: string;<br>    }<br>): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>txt</td><td>要截取的字符串</td></tr><tr><td>width</td><td>最大字符串长度</td></tr><tr><td>options</td><td>选项</td></tr><tr><td>返回值</td><td>截取后的字符串</td></tr></tbody></table><p>选项：</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>ellipsis=’…’</td><td>表示截取掉部分的符号</td></tr><tr><td>separator</td><td>分隔符，尽可能使截取位置在该处</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">truncate(<span class="string">'ORA ORA ORA ORA ORA ORA'</span>, <span class="number">12</span>); <span class="comment">// -&gt; 'ORA ORA O...'</span></span><br><span class="line">truncate(<span class="string">'ORA ORA ORA ORA ORA ORA'</span>, <span class="number">10</span>, &#123;</span><br><span class="line">    separator: <span class="string">' '</span>,</span><br><span class="line">    ellipsis: <span class="string">'……'</span></span><br><span class="line">&#125;); <span class="comment">// -&gt; 'ORA ORA……'</span></span><br></pre></td></tr></table></figure><h2 id="tryIt"><a href="#tryIt" class="headerlink" title="tryIt"></a>tryIt</h2><p>在 try catch 块中运行函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function tryIt(fn: types.AnyFn, cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>目标函数</td></tr><tr><td>cb</td><td>回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tryIt(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Do something that might cause an error.</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><p>获取 JavaScript 对象的内部类型。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function type(val: any, lowerCase?: boolean): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>val</td><td>目标对象</td></tr><tr><td>lowerCase=true</td><td>是否小写</td></tr><tr><td>返回值</td><td>对象类型</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type(<span class="number">5</span>); <span class="comment">// -&gt; 'number'</span></span><br><span class="line">type(&#123;&#125;); <span class="comment">// -&gt; 'object'</span></span><br><span class="line">type(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;); <span class="comment">// -&gt; 'function'</span></span><br><span class="line">type([]); <span class="comment">// -&gt; 'array'</span></span><br><span class="line">type([], <span class="literal">false</span>); <span class="comment">// -&gt; 'Array'</span></span><br><span class="line">type(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;, <span class="literal">false</span>); <span class="comment">// -&gt; 'AsyncFunction'</span></span><br></pre></td></tr></table></figure><h2 id="types"><a href="#types" class="headerlink" title="types"></a>types</h2><p>仅用于生成 ts 定义文件。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">namespace types {<br>    interface Collection&lt;T&gt; {}<br>    interface List&lt;T&gt; extends Collection&lt;T&gt; {<br>        [index: number]: T;<br>        length: number;<br>    }<br>    interface ListIterator&lt;T, TResult&gt; {<br>        (value: T, index: number, list: List&lt;T&gt;): TResult;<br>    }<br>    interface Dictionary&lt;T&gt; extends Collection&lt;T&gt; {<br>        [index: string]: T;<br>    }<br>    interface ObjectIterator&lt;T, TResult&gt; {<br>        (element: T, key: string, list: Dictionary&lt;T&gt;): TResult;<br>    }<br>    interface MemoIterator&lt;T, TResult&gt; {<br>        (prev: TResult, curr: T, index: number, list: List&lt;T&gt;): TResult;<br>    }<br>    interface MemoObjectIterator&lt;T, TResult&gt; {<br>        (prev: TResult, curr: T, key: string, list: Dictionary&lt;T&gt;): TResult;<br>    }<br>    type Fn&lt;T&gt; = (…args: any[]) =&gt; T;<br>    type AnyFn = Fn&lt;any&gt;;<br>    type PlainObj&lt;T&gt; = { [name: string]: T };<br>}<br>const types: {};</code><br></pre><br></details><h2 id="ucs2"><a href="#ucs2" class="headerlink" title="ucs2"></a>ucs2</h2><p>UCS-2 编解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const ucs2: {<br>    encode(arr: number[]): string;<br>    decode(str: string): number[];<br>};</code><br></pre><br></details><h3 id="encode-3"><a href="#encode-3" class="headerlink" title="encode"></a>encode</h3><p>通过码点序列创建字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>码点序列</td></tr><tr><td>返回值</td><td>编码后的字符串</td></tr></tbody></table><h3 id="decode-3"><a href="#decode-3" class="headerlink" title="decode"></a>decode</h3><p>通过字符串创建码点序列。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>字符串</td></tr><tr><td>返回值</td><td>码点序列</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ucs2.encode([<span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x63</span>]); <span class="comment">// -&gt; 'abc'</span></span><br><span class="line">ucs2.decode(<span class="string">'abc'</span>); <span class="comment">// -&gt; [0x61, 0x62, 0x63]</span></span><br><span class="line"><span class="string">'𝌆'</span>.length; <span class="comment">// -&gt; 2</span></span><br><span class="line">ucs2.decode(<span class="string">'𝌆'</span>).length; <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure><h2 id="uncaught"><a href="#uncaught" class="headerlink" title="uncaught"></a>uncaught</h2><p>全局错误监听。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const uncaught: {<br>    start(): void;<br>    stop(): void;<br>    addListener(fn: (err: Error) =&gt; void): void;<br>    rmListener(fn: (err: Error) =&gt; void): void;<br>    rmAllListeners(): void;<br>};</code><br></pre><br></details><h3 id="start-1"><a href="#start-1" class="headerlink" title="start"></a>start</h3><p>开始监听错误。</p><h3 id="stop-1"><a href="#stop-1" class="headerlink" title="stop"></a>stop</h3><p>停止监听错误。</p><h3 id="addListener-1"><a href="#addListener-1" class="headerlink" title="addListener"></a>addListener</h3><p>添加监听器。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>错误监听器</td></tr></tbody></table><h3 id="rmListener-1"><a href="#rmListener-1" class="headerlink" title="rmListener"></a>rmListener</h3><p>移除监听器。</p><h3 id="rmAllListeners-1"><a href="#rmAllListeners-1" class="headerlink" title="rmAllListeners"></a>rmAllListeners</h3><p>移除所有监听器。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uncaught.start();</span><br><span class="line">uncaught.addListener(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Do something.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="unescape"><a href="#unescape" class="headerlink" title="unescape"></a>unescape</h2><p>和 escape 相反，转义 HTML 实体回去。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function unescape(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unescape</span>(<span class="string">'You &amp;amp; Me'</span>); <span class="comment">// -&gt; 'You &amp; Me'</span></span><br></pre></td></tr></table></figure><h2 id="union"><a href="#union" class="headerlink" title="union"></a>union</h2><p>返回传入所有数组的并集。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function union(…arr: Array&lt;any[]&gt;): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>…arr</td><td>要合并的数组</td></tr><tr><td>返回值</td><td>数组并集</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union([<span class="number">2</span>, <span class="number">1</span>], [<span class="number">4</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">// -&gt; [2, 1, 4]</span></span><br></pre></td></tr></table></figure><h2 id="uniqId"><a href="#uniqId" class="headerlink" title="uniqId"></a>uniqId</h2><p>生成全局唯一 id。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function uniqId(prefix?: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>prefix</td><td>id 前缀</td></tr><tr><td>返回值</td><td>全局唯一 id</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniqId(<span class="string">'eustia_'</span>); <span class="comment">// -&gt; 'eustia_xxx'</span></span><br></pre></td></tr></table></figure><h2 id="unique"><a href="#unique" class="headerlink" title="unique"></a>unique</h2><p>返回数组去重后的副本。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function unique(<br>    arr: any[],<br>    cmp?: (a: any, b: any) =&gt; boolean | number<br>): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>cmp</td><td>比较器</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unique([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>]); <span class="comment">// -&gt; [1, 2, 3]</span></span><br></pre></td></tr></table></figure><h2 id="universalify"><a href="#universalify" class="headerlink" title="universalify"></a>universalify</h2><p>使用异步函数同时支持 promise 及回调模式。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function universalify(<br>    fn: types.AnyFn,<br>    type: string<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>异步函数</td></tr><tr><td>type</td><td>源类型，promise 或 callback</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackFn</span>(<span class="params">str, cb</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        cb(<span class="literal">null</span>, str);</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fn = universalify(callbackFn, <span class="string">'callback'</span>);</span><br><span class="line">fn(<span class="string">'licia'</span>, (err, result) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// -&gt; 'licia'</span></span><br><span class="line">&#125;);</span><br><span class="line">fn(<span class="string">'licia'</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// -&gt; 'licia'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h2><p>与 zip 相反。 </p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">declare function unzip(arr: Array&lt;any[]&gt;): Array&lt;any[]&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unzip([</span><br><span class="line">    [<span class="string">'a'</span>, <span class="number">1</span>, <span class="literal">true</span>],</span><br><span class="line">    [<span class="string">'b'</span>, <span class="number">2</span>, <span class="literal">false</span>]</span><br><span class="line">]); <span class="comment">// -&gt; [['a', 'b'], [1, 2], [true, false]]</span></span><br></pre></td></tr></table></figure><h2 id="upperCase"><a href="#upperCase" class="headerlink" title="upperCase"></a>upperCase</h2><p>转换字符串为大写。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function upperCase(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upperCase(<span class="string">'test'</span>); <span class="comment">// -&gt; 'TEST'</span></span><br></pre></td></tr></table></figure><h2 id="upperFirst"><a href="#upperFirst" class="headerlink" title="upperFirst"></a>upperFirst</h2><p>将字符串的第一个字符转换为大写。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function upperFirst(str: string): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upperFirst(<span class="string">'red'</span>); <span class="comment">// -&gt; Red</span></span><br></pre></td></tr></table></figure><h2 id="use"><a href="#use" class="headerlink" title="use"></a>use</h2><p>使用 define 创建的模块。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function use(requires: string[], method: types.AnyFn): void;<br>function use(method: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>requires</td><td>依赖</td></tr><tr><td>method</td><td>要执行的代码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define('A', () =&gt; 'A');</span></span><br><span class="line">use([<span class="string">'A'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">A</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(A + <span class="string">'B'</span>); <span class="comment">// -&gt; 'AB'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="utf8"><a href="#utf8" class="headerlink" title="utf8"></a>utf8</h2><p>UTF-8 编解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const utf8: {<br>    encode(str: string): string;<br>    decode(str: string, safe?: boolean): string;<br>};</code><br></pre><br></details><h3 id="encode-4"><a href="#encode-4" class="headerlink" title="encode"></a>encode</h3><p>UTF-8 编码。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><h3 id="decode-4"><a href="#decode-4" class="headerlink" title="decode"></a>decode</h3><p>UTF-8 解码。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>str</td><td>源字符串</td></tr><tr><td>safe=false</td><td>如果设为真，不抛错误</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">utf8.encode(<span class="string">'\uD800\uDC00'</span>); <span class="comment">// -&gt;  '\xF0\x90\x80\x80'</span></span><br><span class="line">utf8.decode(<span class="string">'\xF0\x90\x80\x80'</span>); <span class="comment">// -&gt; '\uD800\uDC00'</span></span><br></pre></td></tr></table></figure><h2 id="uuid"><a href="#uuid" class="headerlink" title="uuid"></a>uuid</h2><p>生成符合 RFC4112 版本 4 协议的 uuid。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function uuid(): string;</code><br></pre><br></details><p>相关标准 <a href="http://www.ietf.org/rfc/rfc4122.txt" target="_blank" rel="noopener">RFC4122 4.4</a>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uuid(); <span class="comment">// -&gt; '53ce0497-6554-49e9-8d79-347406d2a88b'</span></span><br></pre></td></tr></table></figure><h2 id="values"><a href="#values" class="headerlink" title="values"></a>values</h2><p>返回对象所有的属性值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function values(obj: any): any[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>obj</td><td>目标对象</td></tr><tr><td>返回值</td><td>所有属性值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">values(&#123; <span class="attr">one</span>: <span class="number">1</span>, <span class="attr">two</span>: <span class="number">2</span> &#125;); <span class="comment">// -&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h2 id="viewportScale"><a href="#viewportScale" class="headerlink" title="viewportScale"></a>viewportScale</h2><p>获取窗口缩放比。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function viewportScale(): number;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewportScale(); <span class="comment">// -&gt; 3</span></span><br></pre></td></tr></table></figure><h2 id="vlq"><a href="#vlq" class="headerlink" title="vlq"></a>vlq</h2><p>vlq 编解码。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const vlq: {<br>    encode(number: number | number[]): string;<br>    decode(string: string): number[];<br>};</code><br></pre><br></details><h3 id="encode-5"><a href="#encode-5" class="headerlink" title="encode"></a>encode</h3><p>将数字编码为 vlq 字符串。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>number</td><td>源数字</td></tr><tr><td>返回值</td><td>目标字符串</td></tr></tbody></table><h3 id="decode-5"><a href="#decode-5" class="headerlink" title="decode"></a>decode</h3><p>将 vlq 字符串解码为数字。</p><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>string</td><td>源字符串</td></tr><tr><td>返回值</td><td>目标数字</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vlq.encode(<span class="number">123</span>); <span class="comment">// -&gt; '2H'</span></span><br><span class="line">vlq.encode([<span class="number">123</span>, <span class="number">456</span>, <span class="number">789</span>]); <span class="comment">// -&gt; '2HwcqxB'</span></span><br><span class="line">vlq.decode(<span class="string">'2H'</span>); <span class="comment">// -&gt; [123]</span></span><br><span class="line">vlq.decode(<span class="string">'2HwcqxB'</span>); <span class="comment">// -&gt; [123, 456, 789]</span></span><br></pre></td></tr></table></figure><h2 id="waitUntil"><a href="#waitUntil" class="headerlink" title="waitUntil"></a>waitUntil</h2><p>等待直到条件函数返回真值。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function waitUntil(<br>    condition: types.AnyFn,<br>    timeout?: number,<br>    interval?: number<br>): Promise&lt;any&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>condition</td><td>条件函数</td></tr><tr><td>timeout=0</td><td>超时</td></tr><tr><td>interval=250</td><td>等待间隔</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">5</span>;</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> (a = <span class="number">10</span>), <span class="number">500</span>);</span><br><span class="line">waitUntil(<span class="function"><span class="params">()</span> =&gt;</span> a === <span class="number">10</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a); <span class="comment">// -&gt; 10</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="waterfall"><a href="#waterfall" class="headerlink" title="waterfall"></a>waterfall</h2><p>按顺序执行函数序列。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function waterfall(tasks: types.AnyFn[], cb?: types.AnyFn): void;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>tasks</td><td>函数序列</td></tr><tr><td>cb</td><td>结束回调</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">waterfall(</span><br><span class="line">    [</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">            cb(<span class="literal">null</span>, <span class="string">'one'</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">arg1, cb</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// arg1 -&gt; 'one'</span></span><br><span class="line">            cb(<span class="literal">null</span>, <span class="string">'done'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// result -&gt; 'done'</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="wordWrap"><a href="#wordWrap" class="headerlink" title="wordWrap"></a>wordWrap</h2><p>按照指定长度对字符串进行折行处理。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function wordWrap(txt: string, width: number): string;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>txt</td><td>要折行的字符串</td></tr><tr><td>width</td><td>最大行宽度</td></tr><tr><td>返回值</td><td>折行后的字符串</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wordWrap(<span class="string">'Licia is a utility library.'</span>, <span class="number">10</span>);</span><br><span class="line"><span class="comment">// -&gt; 'Licia is \na utility \nlibrary.'</span></span><br></pre></td></tr></table></figure><h2 id="wordsToBytes"><a href="#wordsToBytes" class="headerlink" title="wordsToBytes"></a>wordsToBytes</h2><p>将 32 位字长数组转换为字节数组。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function wordsToBytes(words: number[]): number[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>words</td><td>字长数组</td></tr><tr><td>返回值</td><td>字节数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wordsToBytes([<span class="number">0x12345678</span>]); <span class="comment">// -&gt; [0x12, 0x34, 0x56, 0x78]</span></span><br></pre></td></tr></table></figure><h2 id="workerize"><a href="#workerize" class="headerlink" title="workerize"></a>workerize</h2><p>将函数运行在 worker 线程中。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function workerize(fn: types.AnyFn): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>源函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> worker = workerize(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;);</span><br><span class="line">worker(<span class="number">1</span>, <span class="number">2</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value); <span class="comment">// -&gt; 3</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="wrap"><a href="#wrap" class="headerlink" title="wrap"></a>wrap</h2><p>将函数封装到包裹函数里面, 并把它作为第一个参数传给包裹函数。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function wrap(<br>    fn: types.AnyFn,<br>    wrapper: types.AnyFn<br>): types.AnyFn;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>fn</td><td>要包裹的函数</td></tr><tr><td>wrapper</td><td>包裹函数</td></tr><tr><td>返回值</td><td>目标函数</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = wrap(<span class="built_in">escape</span>, <span class="function"><span class="keyword">function</span>(<span class="params">fn, text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;p&gt;'</span> + fn(text) + <span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">p(<span class="string">'You &amp; Me'</span>); <span class="comment">// -&gt; '&lt;p&gt;You &amp;amp; Me&lt;/p&gt;'</span></span><br></pre></td></tr></table></figure><h2 id="wx"><a href="#wx" class="headerlink" title="wx"></a>wx</h2><p>小程序 wx 对象的 promise 版本。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">const wx: any;</code><br></pre><br></details><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.getStorage(<span class="string">'test'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h2><p>使用 xpath 选择元素，不支持 IE。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function xpath(xpath: string): HTMLElement[];</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>xpath</td><td>Xpath</td></tr><tr><td>返回值</td><td>目标元素集</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xpath(<span class="string">'//html/body'</span>); <span class="comment">// -&gt; [body]</span></span><br></pre></td></tr></table></figure><h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><p>将每个数组中相应位置的值合并在一起。</p><details><br><summary>类型定义</summary><br><pre><br><code class="language-typescript">function zip(…arr: Array&lt;any[]&gt;): Array&lt;any[]&gt;;</code><br></pre><br></details><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>arr</td><td>源数组</td></tr><tr><td>返回值</td><td>目标数组</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip([<span class="string">'a'</span>, <span class="string">'b'</span>], [<span class="number">1</span>, <span class="number">2</span>], [<span class="literal">true</span>, <span class="literal">false</span>]); <span class="comment">// -&gt; [['a', 1, true], ['b', 2, false]]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js工具库licia（一）</title>
      <link href="/2022/02/17/js%E5%B7%A5%E5%85%B7%E5%BA%93licia%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2022/02/17/js%E5%B7%A5%E5%85%B7%E5%BA%93licia%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>licia工具库的代码文件<br><a id="more"></a><br>licia是一款很全的常用工具库，github地址<a href="https://github.com/liriliri/licia" target="_blank" rel="noopener">licia</a>。<br>由于直接下载licia源码，相关依赖一直没安装好，所以没有打包成功。直接用<code>npm i licia</code>安装，发现下载下来的是es6的源代码，于是笔者使用rollup打包，<a href="https://github.com/jinux7/study-collections/tree/master/licia-rollup" target="_blank" rel="noopener">licia-rollup</a>。<br>目前使用的licia版本是1.34.0。<br>相对应的使用文档也是1.34.0，<a href="/2022/02/17/js工具库licia（二）/">licia使用文档</a><br>下面贴出es模块形式源码一份，便于复制使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var commonjsGlobal=&quot;undefined&quot;!=typeof globalThis?globalThis:&quot;undefined&quot;!=typeof window?window:&quot;undefined&quot;!=typeof global?global:&quot;undefined&quot;!=typeof self?self:&#123;&#125;;function createCommonjsModule(fn,module)&#123;return fn(module=&#123;exports:&#123;&#125;&#125;,module.exports),module.exports&#125;var isUndef=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return void 0===val&#125;&#125;),objToStr=createCommonjsModule(function(module,exports)&#123;var ObjToStr=Object.prototype.toString;module.exports=function(val)&#123;return ObjToStr.call(val)&#125;&#125;),isNum=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Number]&quot;===objToStr(val)&#125;&#125;),isFn=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;val=objToStr(val);return&quot;[object Function]&quot;===val||&quot;[object GeneratorFunction]&quot;===val||&quot;[object AsyncFunction]&quot;===val&#125;&#125;),isArrLike=createCommonjsModule(function(module,exports)&#123;var MAX_ARR_IDX=Math.pow(2,53)-1;module.exports=function(val)&#123;if(!val)return!1;var len=val.length;return isNum(len)&amp;&amp;0&lt;=len&amp;&amp;len&lt;=MAX_ARR_IDX&amp;&amp;!isFn(val)&#125;&#125;),has=createCommonjsModule(function(module,exports)&#123;var hasOwnProp=Object.prototype.hasOwnProperty;module.exports=function(obj,key)&#123;return hasOwnProp.call(obj,key)&#125;&#125;),keys=createCommonjsModule(function(module,exports)&#123;exports=Object.keys||function(obj)&#123;var key,ret=[];for(key in obj)has(obj,key)&amp;&amp;ret.push(key);return ret&#125;,module.exports=exports&#125;),optimizeCb=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,ctx,argCount)&#123;if(isUndef(ctx))return fn;switch(null==argCount?3:argCount)&#123;case 1:return function(val)&#123;return fn.call(ctx,val)&#125;;case 3:return function(val,idx,collection)&#123;return fn.call(ctx,val,idx,collection)&#125;;case 4:return function(accumulator,val,idx,collection)&#123;return fn.call(ctx,accumulator,val,idx,collection)&#125;&#125;return function()&#123;return fn.apply(ctx,arguments)&#125;&#125;&#125;),each=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,iterator,ctx)&#123;if(iterator=optimizeCb(iterator,ctx),isArrLike(obj))for(i=0,len=obj.length;i&lt;len;i++)iterator(obj[i],i,obj);else for(var _keys=keys(obj),i=0,len=_keys.length;i&lt;len;i++)iterator(obj[_keys[i]],_keys[i],obj);return obj&#125;&#125;),createAssigner=createCommonjsModule(function(module,exports)&#123;module.exports=function(keysFn,defaults)&#123;return function(obj)&#123;return each(arguments,function(src,idx)&#123;0!==idx&amp;&amp;(idx=keysFn(src),each(idx,function(key)&#123;defaults&amp;&amp;!isUndef(obj[key])||(obj[key]=src[key])&#125;))&#125;),obj&#125;&#125;&#125;),isObj=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;var type=typeof val;return!!val&amp;&amp;(&quot;function&quot;==type||&quot;object&quot;==type)&#125;&#125;),getProto=createCommonjsModule(function(module,exports)&#123;var getPrototypeOf=Object.getPrototypeOf,ObjectCtr=&#123;&#125;.constructor;module.exports=function(obj)&#123;if(isObj(obj))&#123;if(getPrototypeOf)return getPrototypeOf(obj);var proto=obj.__proto__;return proto||null===proto?proto:isFn(obj.constructor)?obj.constructor.prototype:obj instanceof ObjectCtr?ObjectCtr.prototype:void 0&#125;&#125;&#125;),isArr=createCommonjsModule(function(module,exports)&#123;exports=Array.isArray||function(val)&#123;return&quot;[object Array]&quot;===objToStr(val)&#125;,module.exports=exports&#125;),extendOwn=createCommonjsModule(function(module,exports)&#123;exports=createAssigner(keys),module.exports=exports&#125;),isMatch=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,src)&#123;var _keys=keys(src),len=_keys.length;if(null==obj)return!len;obj=Object(obj);for(var i=0;i&lt;len;i++)&#123;var key=_keys[i];if(src[key]!==obj[key]||!(key in obj))return!1&#125;return!0&#125;&#125;),matcher=createCommonjsModule(function(module,exports)&#123;module.exports=function(attrs)&#123;return attrs=extendOwn(&#123;&#125;,attrs),function(obj)&#123;return isMatch(obj,attrs)&#125;&#125;&#125;),identity=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return val&#125;&#125;),castPath=createCommonjsModule(function(module,exports)&#123;var regPropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|([&quot;&apos;])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,regEscapeChar=/\\(\\)?/g;module.exports=function(str,obj)&#123;if(isArr(str))return str;if(obj&amp;&amp;has(obj,str))return[str];var ret=[];return str.replace(regPropName,function(match,number,quote,str)&#123;ret.push(quote?str.replace(regEscapeChar,&quot;$1&quot;):number||match)&#125;),ret&#125;&#125;),safeGet=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,path)&#123;for(var prop=(path=castPath(path,obj)).shift();!isUndef(prop);)&#123;if(null==(obj=obj[prop]))return;prop=path.shift()&#125;return obj&#125;&#125;),property=createCommonjsModule(function(module,exports)&#123;module.exports=function(path)&#123;return isArr(path)?function(obj)&#123;return safeGet(obj,path)&#125;:(key=path,function(obj)&#123;return null==obj?void 0:obj[key]&#125;);var key&#125;&#125;),safeCb=createCommonjsModule(function(module,exports)&#123;module.exports=function(val,ctx,argCount)&#123;return null==val?identity:isFn(val)?optimizeCb(val,ctx,argCount):(isObj(val)&amp;&amp;!isArr(val)?matcher:property)(val)&#125;&#125;),filter=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,predicate,ctx)&#123;var ret=[];return predicate=safeCb(predicate,ctx),each(obj,function(val,idx,list)&#123;predicate(val,idx,list)&amp;&amp;ret.push(val)&#125;),ret&#125;&#125;),unique=createCommonjsModule(function(module,exports)&#123;function isEqual(a,b)&#123;return a===b&#125;module.exports=function(arr,cmp)&#123;return cmp=cmp||isEqual,filter(arr,function(item,idx,arr)&#123;for(var len=arr.length;++idx&lt;len;)if(cmp(item,arr[idx]))return!1;return!0&#125;)&#125;&#125;),allKeys=createCommonjsModule(function(module,exports)&#123;var getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols;module.exports=function(obj)&#123;var _ref=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,_ref$prototype=_ref.prototype,prototype=void 0===_ref$prototype||_ref$prototype,_ref$prototype=_ref.unenumerable,_ref$prototype=void 0!==_ref$prototype&amp;&amp;_ref$prototype,_ref=_ref.symbol,symbol=void 0!==_ref&amp;&amp;_ref,ret=[];if((_ref$prototype||symbol)&amp;&amp;getOwnPropertyNames)&#123;var getKeys=keys;for(_ref$prototype&amp;&amp;getOwnPropertyNames&amp;&amp;(getKeys=getOwnPropertyNames);ret=ret.concat(getKeys(obj)),symbol&amp;&amp;getOwnPropertySymbols&amp;&amp;(ret=ret.concat(getOwnPropertySymbols(obj))),prototype&amp;&amp;(obj=getProto(obj))&amp;&amp;obj!==Object.prototype;);ret=unique(ret)&#125;else if(prototype)for(var key in obj)ret.push(key);else ret=keys(obj);return ret&#125;&#125;),extend=createCommonjsModule(function(module,exports)&#123;exports=createAssigner(allKeys),module.exports=exports&#125;),map=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,iterator,ctx)&#123;iterator=safeCb(iterator,ctx);for(var _keys=!isArrLike(obj)&amp;&amp;keys(obj),len=(_keys||obj).length,results=Array(len),i=0;i&lt;len;i++)&#123;var curKey=_keys?_keys[i]:i;results[i]=iterator(obj[curKey],curKey,obj)&#125;return results&#125;&#125;),isStr=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object String]&quot;===objToStr(val)&#125;&#125;),toArr=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return val?isArr(val)?val:isArrLike(val)&amp;&amp;!isStr(val)?map(val):[val]:[]&#125;&#125;),create=createCommonjsModule(function(module,exports)&#123;var objCreate=Object.create;module.exports=function(proto)&#123;return isObj(proto)?objCreate?objCreate(proto):(noop.prototype=proto,new noop):&#123;&#125;;function noop()&#123;&#125;&#125;&#125;),inherits=createCommonjsModule(function(module,exports)&#123;module.exports=function(Class,SuperClass)&#123;Class.prototype=create(SuperClass.prototype)&#125;&#125;),isMiniProgram=createCommonjsModule(function(module,exports)&#123;exports=&quot;undefined&quot;!=typeof wx&amp;&amp;isFn(wx.openLocation),module.exports=exports&#125;),Class=createCommonjsModule(function(module,exports)&#123;var Base=(exports=function(methods,statics)&#123;return Base.extend(methods,statics)&#125;).Base=function makeClass(parent,methods,statics)&#123;statics=statics||&#123;&#125;;var className=methods.className||safeGet(methods,&quot;initialize.name&quot;)||&quot;&quot;,ctor=(delete methods.className,function()&#123;var args=toArr(arguments);return this.initialize&amp;&amp;this.initialize.apply(this,args)||this&#125;);if(!isMiniProgram)try&#123;ctor=new Function(&quot;toArr&quot;,&quot;return function &quot;+className+&quot;()&#123;var args = toArr(arguments);return this.initialize ? this.initialize.apply(this, args) || this : this;&#125;;&quot;)(toArr)&#125;catch(e)&#123;&#125;return inherits(ctor,parent),(ctor.prototype.constructor=ctor).extend=function(methods,statics)&#123;return makeClass(ctor,methods,statics)&#125;,ctor.inherits=function(Class)&#123;inherits(ctor,Class)&#125;,ctor.methods=function(methods)&#123;return extend(ctor.prototype,methods),ctor&#125;,ctor.statics=function(statics)&#123;return extend(ctor,statics),ctor&#125;,ctor.methods(methods).statics(statics),ctor&#125;(Object,&#123;className:&quot;Base&quot;,callSuper:function(parent,name,args)&#123;return parent.prototype[name].apply(this,args)&#125;,toString:function()&#123;return this.constructor.name&#125;&#125;);module.exports=exports&#125;),Class_1=Class.Base,restArgs=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,startIdx)&#123;return startIdx=null==startIdx?fn.length-1:+startIdx,function()&#123;for(var len=Math.max(arguments.length-startIdx,0),rest=new Array(len),i=0;i&lt;len;i++)rest[i]=arguments[i+startIdx];switch(startIdx)&#123;case 0:return fn.call(this,rest);case 1:return fn.call(this,arguments[0],rest);case 2:return fn.call(this,arguments[0],arguments[1],rest)&#125;var args=new Array(startIdx+1);for(i=0;i&lt;startIdx;i++)args[i]=arguments[i];return args[startIdx]=rest,fn.apply(this,args)&#125;&#125;&#125;),mergeArr=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(first,arrays)&#123;for(var end=first.length,i=0,len=arrays.length;i&lt;len;i++)for(var arr=arrays[i],j=0,_len=arr.length;j&lt;_len;j++)first[end++]=arr[j];return first.length=end,first&#125;),module.exports=exports&#125;),Select=createCommonjsModule(function(module,exports)&#123;var rootSelect=new(exports=Class(&#123;className:&quot;Select&quot;,initialize:function(selector)&#123;return this.length=0,selector?isStr(selector)?rootSelect.find(selector):void(selector.nodeType&amp;&amp;(this[0]=selector,this.length=1)):this&#125;,find:function(selector)&#123;var ret=new exports;return this.each(function()&#123;mergeArr(ret,this.querySelectorAll(selector))&#125;),ret&#125;,each:function(fn)&#123;return each(this,function(element,idx)&#123;fn.call(element,idx,element)&#125;),this&#125;&#125;))(document);module.exports=exports&#125;),$safeEls=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return toArr(isStr(val)?new Select(val):val)&#125;&#125;),$offset=createCommonjsModule(function(module,exports)&#123;module.exports=function(els)&#123;els=(els=$safeEls(els))[0].getBoundingClientRect();return&#123;left:els.left+window.pageXOffset,top:els.top+window.pageYOffset,width:Math.round(els.width),height:Math.round(els.height)&#125;&#125;&#125;),$show=createCommonjsModule(function(module,exports)&#123;var elDisplay=&#123;&#125;;module.exports=function(els)&#123;els=$safeEls(els),each(els,function(el)&#123;!function(el)&#123;return&quot;none&quot;==getComputedStyle(el,&quot;&quot;).getPropertyValue(&quot;display&quot;)&#125;(el)||(el.style.display=function(elName)&#123;var el,display;elDisplay[elName]||(el=document.createElement(elName),document.documentElement.appendChild(el),display=getComputedStyle(el,&quot;&quot;).getPropertyValue(&quot;display&quot;),el.parentNode.removeChild(el),&quot;none&quot;==display&amp;&amp;(display=&quot;block&quot;),elDisplay[elName]=display);return elDisplay[elName]&#125;(el.nodeName))&#125;)&#125;&#125;),splitCase=createCommonjsModule(function(module,exports)&#123;var regUpperCase=/([A-Z])/g,regSeparator=/[_.\- ]+/g,regTrim=/(^-)|(-$)/g;module.exports=function(str)&#123;return(str=str.replace(regUpperCase,&quot;-$1&quot;).toLowerCase().replace(regSeparator,&quot;-&quot;).replace(regTrim,&quot;&quot;)).split(&quot;-&quot;)&#125;&#125;),kebabCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return splitCase(str).join(&quot;-&quot;)&#125;&#125;),idxOf=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,val,fromIdx)&#123;return Array.prototype.indexOf.call(arr,val,fromIdx)&#125;&#125;),values=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;var ret=[];return each(obj,function(val)&#123;ret.push(val)&#125;),ret&#125;&#125;),contain=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,val)&#123;return isStr(arr)?-1&lt;arr.indexOf(val):(isArrLike(arr)||(arr=values(arr)),0&lt;=idxOf(arr,val))&#125;&#125;),memoize=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,hashFn)&#123;function memoize(key)&#123;var cache=memoize.cache,address=&quot;&quot;+(hashFn?hashFn.apply(this,arguments):key);return has(cache,address)||(cache[address]=fn.apply(this,arguments)),cache[address]&#125;return memoize.cache=&#123;&#125;,memoize&#125;&#125;),camelCase=createCommonjsModule(function(module,exports)&#123;function capitalize(val,idx)&#123;this[idx]=val.replace(/\w/,function(match)&#123;return match.toUpperCase()&#125;)&#125;module.exports=function(str)&#123;var str=splitCase(str),ret=str[0];return str.shift(),str.forEach(capitalize,str),ret+=str.join(&quot;&quot;)&#125;&#125;),upperFirst=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return str.length&lt;1?str:str[0].toUpperCase()+str.slice(1)&#125;&#125;),prefix=createCommonjsModule(function(module,exports)&#123;(exports=memoize(function(name)&#123;if(name=name.replace(regPrefixes,&quot;&quot;),name=camelCase(name),has(style,name))return name;for(var i=prefixes.length;i--;)&#123;var prefixName=prefixes[i]+upperFirst(name);if(has(style,prefixName))return prefixName&#125;return name&#125;)).dash=memoize(function(name)&#123;name=exports(name);return(regPrefixes.test(name)?&quot;-&quot;:&quot;&quot;)+kebabCase(name)&#125;);var prefixes=[&quot;O&quot;,&quot;ms&quot;,&quot;Moz&quot;,&quot;Webkit&quot;],regPrefixes=/^(O)|(ms)|(Moz)|(Webkit)|(-o-)|(-ms-)|(-moz-)|(-webkit-)/g,style=document.createElement(&quot;p&quot;).style;module.exports=exports&#125;),prefix_1=prefix.dash,$css=createCommonjsModule(function(module,exports)&#123;var cssNumProps=[&quot;column-count&quot;,&quot;columns&quot;,&quot;font-weight&quot;,&quot;line-weight&quot;,&quot;opacity&quot;,&quot;z-index&quot;,&quot;zoom&quot;];module.exports=function(nodes,name,val)&#123;if(nodes=$safeEls(nodes),isUndef(val)&amp;&amp;isStr(name))return function(node,name)&#123;return node.style[prefix(name)]||getComputedStyle(node,&quot;&quot;).getPropertyValue(name)&#125;(nodes[0],name);var css=name;isObj(css)||((css=&#123;&#125;)[name]=val),function(nodes,css)&#123;each(nodes,function(node)&#123;var cssText=&quot;;&quot;;each(css,function(val,key)&#123;key=prefix.dash(key),cssText+=key+&quot;:&quot;+function(key,val)&#123;return isNum(val)&amp;&amp;!contain(cssNumProps,kebabCase(key))?val+&quot;px&quot;:val&#125;(key,val)+&quot;;&quot;&#125;),node.style.cssText+=cssText&#125;)&#125;(nodes,css)&#125;&#125;),$attr=createCommonjsModule(function(module,exports)&#123;(exports=function(els,name,val)&#123;if(els=$safeEls(els),isUndef(val)&amp;&amp;isStr(name))return function(el,name)&#123;return el.getAttribute(name)&#125;(els[0],name);var attrs=name;isObj(attrs)||((attrs=&#123;&#125;)[name]=val),function(els,attrs)&#123;each(els,function(el)&#123;each(attrs,function(val,name)&#123;el.setAttribute(name,val)&#125;)&#125;)&#125;(els,attrs)&#125;).remove=function(els,names)&#123;els=$safeEls(els),names=toArr(names),each(els,function(node)&#123;each(names,function(name)&#123;node.removeAttribute(name)&#125;)&#125;)&#125;,module.exports=exports&#125;),$attr_1=$attr.remove,$property=createCommonjsModule(function(module,exports)&#123;function propFactory(name)&#123;return function(nodes,val)&#123;var node=(nodes=$safeEls(nodes))[0];if(isUndef(val))return node?node[name]:&quot;&quot;;node&amp;&amp;each(nodes,function(node)&#123;node[name]=val&#125;)&#125;&#125;exports=&#123;html:propFactory(&quot;innerHTML&quot;),text:propFactory(&quot;textContent&quot;),val:propFactory(&quot;value&quot;)&#125;,module.exports=exports&#125;),last=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;var len=arr?arr.length:0;if(len)return arr[len-1]&#125;&#125;),$remove=createCommonjsModule(function(module,exports)&#123;module.exports=function(els)&#123;els=$safeEls(els),each(els,function(el)&#123;var parent=el.parentNode;parent&amp;&amp;parent.removeChild(el)&#125;)&#125;&#125;),$data=createCommonjsModule(function(module,exports)&#123;module.exports=function(nodes,name,val)&#123;var dataName=name;return isStr(name)&amp;&amp;(dataName=&quot;data-&quot;+name),isObj(name)&amp;&amp;(dataName=&#123;&#125;,each(name,function(val,key)&#123;dataName[&quot;data-&quot;+key]=val&#125;)),$attr(nodes,dataName,val)&#125;&#125;),delegate=createCommonjsModule(function(module,exports)&#123;function retTrue()&#123;return!0&#125;function retFalse()&#123;return!1&#125;function trigger(e)&#123;for(var handler,j,matched,handlers=this.events[e.type],handlerQueue=function(e,handlers)&#123;var selector,matches,handler,i,current=e.target,ret=[],delegateCount=handlers.delegateCount;if(current.nodeType)for(;current!==this;current=current.parentNode||this)&#123;for(matches=[],i=0;i&lt;delegateCount;i++)handler=handlers[i],selector=handler.selector+&quot; &quot;,void 0===matches[selector]&amp;&amp;(matches[selector]=contain(this.querySelectorAll(selector),current)),matches[selector]&amp;&amp;matches.push(handler);matches.length&amp;&amp;ret.push(&#123;el:current,handlers:matches&#125;)&#125;delegateCount&lt;handlers.length&amp;&amp;ret.push(&#123;el:this,handlers:handlers.slice(delegateCount)&#125;);return ret&#125;.call(this,e,handlers),i=(e=new exports.Event(e),0);(matched=handlerQueue[i++])&amp;&amp;!e.isPropagationStopped();)for(e.curTarget=matched.el,j=0;(handler=matched.handlers[j++])&amp;&amp;!e.isImmediatePropagationStopped();)!1===handler.handler.apply(matched.el,[e])&amp;&amp;(e.preventDefault(),e.stopPropagation())&#125;exports=&#123;add:function(el,type,selector,fn)&#123;var handlers,fn=&#123;selector:selector,handler:fn&#125;;el.events||(el.events=&#123;&#125;),(handlers=el.events[type])||((handlers=el.events[type]=[]).delegateCount=0,el.addEventListener(type,function()&#123;trigger.apply(el,arguments)&#125;,!1)),selector?handlers.splice(handlers.delegateCount++,0,fn):handlers.push(fn)&#125;,remove:function(el,type,selector,fn)&#123;el=el.events;if(el&amp;&amp;el[type])for(var handler,handlers=el[type],i=handlers.length;i--;)handler=handlers[i],selector&amp;&amp;handler.selector!=selector||handler.handler!=fn||(handlers.splice(i,1),handler.selector&amp;&amp;handlers.delegateCount--)&#125;,Event:Class(&#123;className:&quot;Event&quot;,initialize:function(e)&#123;this.origEvent=e&#125;,isDefaultPrevented:retFalse,isPropagationStopped:retFalse,isImmediatePropagationStopped:retFalse,preventDefault:function()&#123;var e=this.origEvent;this.isDefaultPrevented=retTrue,e&amp;&amp;e.preventDefault&amp;&amp;e.preventDefault()&#125;,stopPropagation:function()&#123;var e=this.origEvent;this.isPropagationStopped=retTrue,e&amp;&amp;e.stopPropagation&amp;&amp;e.stopPropagation()&#125;,stopImmediatePropagation:function()&#123;var e=this.origEvent;this.isImmediatePropagationStopped=retTrue,e&amp;&amp;e.stopImmediatePropagation&amp;&amp;e.stopImmediatePropagation(),this.stopPropagation()&#125;&#125;)&#125;,module.exports=exports&#125;),$event=createCommonjsModule(function(module,exports)&#123;function eventFactory(type)&#123;return function(nodes,event,selector,handler)&#123;nodes=$safeEls(nodes),isUndef(handler)&amp;&amp;(handler=selector,selector=void 0),each(nodes,function(node)&#123;delegate[type](node,event,selector,handler)&#125;)&#125;&#125;exports=&#123;on:eventFactory(&quot;add&quot;),off:eventFactory(&quot;remove&quot;)&#125;,module.exports=exports&#125;),some=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,predicate,ctx)&#123;predicate=safeCb(predicate,ctx);for(var _keys=!isArrLike(obj)&amp;&amp;keys(obj),len=(_keys||obj).length,i=0;i&lt;len;i++)&#123;var key=_keys?_keys[i]:i;if(predicate(obj[key],key,obj))return!0&#125;return!1&#125;&#125;),$class=createCommonjsModule(function(module,exports)&#123;function safeName(name)&#123;return isStr(name)?name.split(/\s+/):toArr(name)&#125;exports=&#123;add:function(els,name)&#123;els=$safeEls(els);var names=safeName(name);each(els,function(el)&#123;var classList=[];each(names,function(name)&#123;exports.has(el,name)||classList.push(name)&#125;),0!==classList.length&amp;&amp;(el.className+=(el.className?&quot; &quot;:&quot;&quot;)+classList.join(&quot; &quot;))&#125;)&#125;,has:function(els,name)&#123;els=$safeEls(els);var regName=new RegExp(&quot;(^|\\s)&quot;+name+&quot;(\\s|$)&quot;);return some(els,function(el)&#123;return regName.test(el.className)&#125;)&#125;,toggle:function(els,name)&#123;els=$safeEls(els),each(els,function(el)&#123;if(!exports.has(el,name))return exports.add(el,name);exports.remove(el,name)&#125;)&#125;,remove:function(els,name)&#123;els=$safeEls(els);var names=safeName(name);each(els,function(el)&#123;each(names,function(name)&#123;el.classList.remove(name)&#125;)&#125;)&#125;&#125;,module.exports=exports&#125;),$insert=createCommonjsModule(function(module,exports)&#123;function insertFactory(type)&#123;return function(nodes,val)&#123;nodes=$safeEls(nodes),each(nodes,function(node)&#123;if(isStr(val))node.insertAdjacentHTML(type,val);else&#123;var parentNode=node.parentNode;switch(type)&#123;case&quot;beforebegin&quot;:parentNode&amp;&amp;parentNode.insertBefore(val,node);break;case&quot;afterend&quot;:parentNode&amp;&amp;parentNode.insertBefore(val,node.nextSibling);break;case&quot;beforeend&quot;:node.appendChild(val);break;case&quot;afterbegin&quot;:node.prepend(val)&#125;&#125;&#125;)&#125;&#125;exports=&#123;before:insertFactory(&quot;beforebegin&quot;),after:insertFactory(&quot;afterend&quot;),append:insertFactory(&quot;beforeend&quot;),prepend:insertFactory(&quot;afterbegin&quot;)&#125;,module.exports=exports&#125;),$=createCommonjsModule(function(module,exports)&#123;exports=function(selector)&#123;return new Select(selector)&#125;,Select.methods(&#123;offset:function()&#123;return $offset(this)&#125;,hide:function()&#123;return this.css(&quot;display&quot;,&quot;none&quot;)&#125;,show:function()&#123;return $show(this),this&#125;,first:function()&#123;return exports(this[0])&#125;,last:function()&#123;return exports(last(this))&#125;,get:function(idx)&#123;return this[idx]&#125;,eq:function(idx)&#123;return exports(this[idx])&#125;,on:function(event,selector,handler)&#123;return $event.on(this,event,selector,handler),this&#125;,off:function(event,selector,handler)&#123;return $event.off(this,event,selector,handler),this&#125;,html:function(val)&#123;var result=$property.html(this,val);return isUndef(val)?result:this&#125;,text:function(val)&#123;var result=$property.text(this,val);return isUndef(val)?result:this&#125;,val:function(val)&#123;var result=$property.val(this,val);return isUndef(val)?result:this&#125;,css:function(name,val)&#123;var result=$css(this,name,val);return isGetter(name,val)?result:this&#125;,attr:function(name,val)&#123;var result=$attr(this,name,val);return isGetter(name,val)?result:this&#125;,data:function(name,val)&#123;var result=$data(this,name,val);return isGetter(name,val)?result:this&#125;,rmAttr:function(name)&#123;return $attr.remove(this,name),this&#125;,remove:function()&#123;return $remove(this),this&#125;,addClass:function(name)&#123;return $class.add(this,name),this&#125;,rmClass:function(name)&#123;return $class.remove(this,name),this&#125;,toggleClass:function(name)&#123;return $class.toggle(this,name),this&#125;,hasClass:function(name)&#123;return $class.has(this,name)&#125;,parent:function()&#123;return exports(this[0].parentNode)&#125;,append:function(val)&#123;return $insert.append(this,val),this&#125;,prepend:function(val)&#123;return $insert.prepend(this,val),this&#125;,before:function(val)&#123;return $insert.before(this,val),this&#125;,after:function(val)&#123;return $insert.after(this,val),this&#125;&#125;);var isGetter=function(name,val)&#123;return isUndef(val)&amp;&amp;isStr(name)&#125;;module.exports=exports&#125;),defaults=createCommonjsModule(function(module,exports)&#123;exports=createAssigner(allKeys,!0),module.exports=exports&#125;),slice=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,start,end)&#123;for(var len=arr.length,ret=(start=null==start?0:start&lt;0?Math.max(len+start,0):Math.min(start,len),end=null==end?len:end&lt;0?Math.max(len+end,0):Math.min(end,len),[]);start&lt;end;)ret.push(arr[start++]);return ret&#125;&#125;),partial=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(fn,partials)&#123;return function()&#123;var args=[];return args=(args=args.concat(partials)).concat(toArr(arguments)),fn.apply(this,args)&#125;&#125;),module.exports=exports&#125;),before=createCommonjsModule(function(module,exports)&#123;module.exports=function(n,fn)&#123;var memo;return function()&#123;return 0&lt;--n&amp;&amp;(memo=fn.apply(this,arguments)),n&lt;=1&amp;&amp;(fn=null),memo&#125;&#125;&#125;),once=createCommonjsModule(function(module,exports)&#123;exports=partial(before,2),module.exports=exports&#125;),clone=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;return isObj(obj)?isArr(obj)?obj.slice():extend(&#123;&#125;,obj):obj&#125;&#125;),Emitter=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._events=this._events||&#123;&#125;&#125;,on:function(event,listener)&#123;return this._events[event]=this._events[event]||[],this._events[event].push(listener),this&#125;,off:function(event,listener)&#123;var events=this._events;if(has(events,event))return listener=events[event].indexOf(listener),-1&lt;listener&amp;&amp;events[event].splice(listener,1),this&#125;,once:function(event,listener)&#123;return this.on(event,once(listener)),this&#125;,emit:function(event)&#123;var args,events,_this=this;if(has(this._events,event))return args=slice(arguments,1),events=clone(this._events[event]),each(events,function(val)&#123;return val.apply(_this,args)&#125;,this),this&#125;,removeAllListeners:function(event)&#123;return event?delete this._events[event]:this._events=&#123;&#125;,this&#125;&#125;,&#123;mixin:function(obj)&#123;each([&quot;on&quot;,&quot;off&quot;,&quot;once&quot;,&quot;emit&quot;,&quot;removeAllListeners&quot;],function(val)&#123;obj[val]=exports.prototype[val]&#125;),obj._events=obj._events||&#123;&#125;&#125;&#125;),module.exports=exports&#125;),State=createCommonjsModule(function(module,exports)&#123;exports=Emitter.extend(&#123;className:&quot;State&quot;,initialize:function(initial,events)&#123;this.callSuper(Emitter,&quot;initialize&quot;),this.current=initial;var self=this;each(events,function(event,key)&#123;self[key]=function(name,event)&#123;var from=toArr(event.from),to=event.to;return function()&#123;var args=toArr(arguments);args.unshift(name),some(from,function(val)&#123;return this.current===val&#125;,this)?(this.current=to,this.emit.apply(this,args)):this.emit(&quot;error&quot;,new Error(this.current+&quot; =&gt; &quot;+to+&quot; error&quot;),name)&#125;&#125;(key,event)&#125;)&#125;,is:function(state)&#123;return this.current===state&#125;&#125;),module.exports=exports&#125;),bind=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(fn,ctx,args)&#123;return restArgs(function(callArgs)&#123;return fn.apply(ctx,args.concat(callArgs))&#125;)&#125;),module.exports=exports&#125;),nextTick=createCommonjsModule(function(module,exports)&#123;function ensureCallable(fn)&#123;if(&quot;function&quot;!=typeof fn)throw new TypeError(fn+&quot; is not a function&quot;);return fn&#125;exports=&quot;object&quot;==typeof process&amp;&amp;process.nextTick?process.nextTick:&quot;function&quot;==typeof setImmediate?function(cb)&#123;setImmediate(ensureCallable(cb))&#125;:function(cb)&#123;setTimeout(ensureCallable(cb),0)&#125;,module.exports=exports&#125;),noop=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;&#125;&#125;),_Promise=createCommonjsModule(function(module,exports)&#123;var Promise=exports=Class(&#123;initialize:function(fn)&#123;if(!isObj(this))throw new TypeError(&quot;Promises must be constructed via new&quot;);if(!isFn(fn))throw new TypeError(fn+&quot; is not a function&quot;);var self=this;function assignVal(val)&#123;self._value=val&#125;this._state=new State(&quot;pending&quot;,&#123;fulfill:&#123;from:&quot;pending&quot;,to:&quot;fulfilled&quot;&#125;,reject:&#123;from:&quot;pending&quot;,to:&quot;rejected&quot;&#125;,adopt:&#123;from:&quot;pending&quot;,to:&quot;adopted&quot;&#125;&#125;).on(&quot;fulfill&quot;,assignVal).on(&quot;reject&quot;,assignVal).on(&quot;adopt&quot;,assignVal),this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)&#125;,catch:function(onRejected)&#123;return this.then(null,onRejected)&#125;,then:function(onFulfilled,onRejected)&#123;var promise=new Promise(noop);return handle(this,new Handler(onFulfilled,onRejected,promise)),promise&#125;&#125;,&#123;all:function(arr)&#123;var args=toArr(arr);return new Promise(function(resolve,reject)&#123;if(0===args.length)return resolve([]);var remaining=args.length;for(var i=0;i&lt;args.length;i++)!function res(i,val)&#123;try&#123;if(val&amp;&amp;(isObj(val)||isFn(val)))&#123;var then=val.then;if(isFn(then))return void then.call(val,function(val)&#123;res(i,val)&#125;,reject)&#125;args[i]=val,0==--remaining&amp;&amp;resolve(args)&#125;catch(e)&#123;reject(e)&#125;&#125;(i,args[i])&#125;)&#125;,resolve:function(val)&#123;return val&amp;&amp;isObj(val)&amp;&amp;val.constructor===Promise?val:new Promise(function(resolve)&#123;resolve(val)&#125;)&#125;,reject:function(val)&#123;return new Promise(function(resolve,reject)&#123;reject(val)&#125;)&#125;,race:function(values)&#123;return new Promise(function(resolve,reject)&#123;for(var i=0,len=values.length;i&lt;len;i++)values[i].then(resolve,reject)&#125;)&#125;&#125;),Handler=Class(&#123;initialize:function(onFulfilled,onRejected,promise)&#123;this.onFulfilled=isFn(onFulfilled)?onFulfilled:null,this.onRejected=isFn(onRejected)?onRejected:null,this.promise=promise&#125;&#125;);function reject(self,err)&#123;self._state.reject(err),finale(self)&#125;function resolve(self,val)&#123;try&#123;if(val===self)throw new TypeError(&quot;A promise cannot be resolved with itself&quot;);if(val&amp;&amp;(isObj(val)||isFn(val)))&#123;var then=val.then;if(val instanceof Promise)return self._state.adopt(val),finale(self);if(isFn(then))return doResolve(bind(then,val),self)&#125;self._state.fulfill(val),finale(self)&#125;catch(e)&#123;reject(self,e)&#125;&#125;function finale(self)&#123;for(var i=0,len=self._deferreds.length;i&lt;len;i++)handle(self,self._deferreds[i]);self._deferreds=null&#125;function handle(self,deferred)&#123;for(;self._state.is(&quot;adopted&quot;);)self=self._value;if(self._state.is(&quot;pending&quot;))return self._deferreds.push(deferred);self._handled=!0,nextTick(function()&#123;var ret,isFulfilled=self._state.is(&quot;fulfilled&quot;),cb=isFulfilled?deferred.onFulfilled:deferred.onRejected;if(null===cb)return(isFulfilled?resolve:reject)(deferred.promise,self._value);try&#123;ret=cb(self._value)&#125;catch(e)&#123;return reject(deferred.promise,e)&#125;resolve(deferred.promise,ret)&#125;)&#125;function doResolve(fn,self)&#123;var done=!1;try&#123;fn(function(val)&#123;done||(done=!0,resolve(self,val))&#125;,function(reason)&#123;done||(done=!0,reject(self,reason))&#125;)&#125;catch(e)&#123;if(done)return;done=!0,reject(self,e)&#125;&#125;module.exports=exports&#125;),now=createCommonjsModule(function(module,exports)&#123;exports=Date.now||function()&#123;return(new Date).getTime()&#125;,module.exports=exports&#125;),isBrowser=createCommonjsModule(function(module,exports)&#123;exports=&quot;object&quot;==typeof window&amp;&amp;&quot;object&quot;==typeof document&amp;&amp;9===document.nodeType,module.exports=exports&#125;),root=createCommonjsModule(function(module,exports)&#123;exports=isBrowser?window:commonjsGlobal,module.exports=exports&#125;),perfNow=createCommonjsModule(function(module,exports)&#123;var getNanoSeconds,loadTime,performance=root.performance,process=root.process;exports=performance&amp;&amp;performance.now?function()&#123;return performance.now()&#125;:process&amp;&amp;process.hrtime?(loadTime=(getNanoSeconds=function()&#123;var hr=process.hrtime();return 1e9*hr[0]+hr[1]&#125;)()-1e9*process.uptime(),function()&#123;return(getNanoSeconds()-loadTime)/1e6&#125;):(loadTime=now(),function()&#123;return now()-loadTime&#125;),module.exports=exports&#125;),delay=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(fn,wait,args)&#123;return setTimeout(function()&#123;return fn.apply(null,args)&#125;,wait)&#125;),module.exports=exports&#125;),average=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var arr=arguments,sum=0,len=arr.length,i=0;i&lt;len;i++)sum+=arr[i];return sum/len&#125;&#125;),reduce=createCommonjsModule(function(module,exports)&#123;function createReduce(dir)&#123;return function(obj,iterator,initial,ctx)&#123;var key;if(iterator=optimizeCb(iterator,ctx),isArrLike(obj))for(len=obj.length,i=0&lt;dir?0:len-1,isUndef(initial)&amp;&amp;(initial=obj[i],i+=dir);i&lt;len&amp;&amp;0&lt;=i;i+=dir)initial=iterator(initial,obj[i],i,obj);else&#123;var _keys=keys(obj),len=_keys.length,i=0&lt;dir?0:len-1;for(isUndef(initial)&amp;&amp;(initial=obj[_keys[i]],i+=dir);i&lt;len&amp;&amp;0&lt;=i;i+=dir)initial=iterator(initial,obj[key=_keys[i]],key,obj)&#125;return initial&#125;&#125;(exports=createReduce(1)).create=createReduce,module.exports=exports&#125;),reduce_1=reduce.create,stripAnsi=createCommonjsModule(function(module,exports)&#123;var regAnsi=/[\u001b\u009b][[()#;?]*(?:[0-9]&#123;1,4&#125;(?:;[0-9]&#123;0,4&#125;)*)?[0-9A-ORZcf-nqry=&gt;&lt;]/g;module.exports=function(str)&#123;return str.replace(regAnsi,&quot;&quot;)&#125;&#125;),isInt=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return isNum(val)&amp;&amp;val%1==0&#125;&#125;),isFullWidth=createCommonjsModule(function(module,exports)&#123;module.exports=function(c)&#123;return!!isInt(c)&amp;&amp;(4352&lt;=c&amp;&amp;(c&lt;=4447||9001===c||9002===c||11904&lt;=c&amp;&amp;c&lt;=12871&amp;&amp;12351!==c||12880&lt;=c&amp;&amp;c&lt;=19903||19968&lt;=c&amp;&amp;c&lt;=42182||43360&lt;=c&amp;&amp;c&lt;=43388||44032&lt;=c&amp;&amp;c&lt;=55203||63744&lt;=c&amp;&amp;c&lt;=64255||65040&lt;=c&amp;&amp;c&lt;=65049||65072&lt;=c&amp;&amp;c&lt;=65131||65281&lt;=c&amp;&amp;c&lt;=65376||65504&lt;=c&amp;&amp;c&lt;=65510||110592&lt;=c&amp;&amp;c&lt;=110593||127488&lt;=c&amp;&amp;c&lt;=127569||131072&lt;=c&amp;&amp;c&lt;=262141))&#125;&#125;),strWidth=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;for(var width=0,i=0,len=(str=stripAnsi(str)).length;i&lt;len;i++)&#123;var c=str.codePointAt(i);c&lt;=31||127===c||(width+=isFullWidth(c)?2:1)&#125;return width&#125;&#125;),repeat=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,n)&#123;var ret=&quot;&quot;;if(n&lt;1)return&quot;&quot;;for(;0&lt;n;)1&amp;n&amp;&amp;(ret+=str),n&gt;&gt;=1,str+=str;return ret&#125;&#125;),mapObj=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,iterator,ctx)&#123;iterator=safeCb(iterator,ctx);for(var _keys=keys(obj),len=_keys.length,ret=&#123;&#125;,i=0;i&lt;len;i++)&#123;var curKey=_keys[i];ret[curKey]=iterator(obj[curKey],curKey,obj)&#125;return ret&#125;&#125;),cloneDeep=createCommonjsModule(function(module,exports)&#123;module.exports=exports=function(obj)&#123;return isArr(obj)?obj.map(exports):isObj(obj)&amp;&amp;!isFn(obj)?mapObj(obj,exports):obj&#125;&#125;),table=createCommonjsModule(function(module,exports)&#123;function loopData(rows,handler)&#123;for(var i=0,len=rows.length;i&lt;len;i++)for(var row=rows[i],j=0,_len=row.length;j&lt;_len;j++)&#123;var data=handler(row[j],i,j);data&amp;&amp;(row[j]=data)&#125;&#125;function renderBorder(type,options)&#123;var border=options.border,options=options.columns,left=border[type+&quot;Left&quot;],right=border[type+&quot;Right&quot;],body=border[type+&quot;Body&quot;],border=border[type+&quot;Join&quot;],left=left+(left=map(options,function(column)&#123;return repeat(body,column.width)&#125;).join(border))+right;return&quot;bottom&quot;!==type&amp;&amp;(left+=&quot;\n&quot;),left&#125;var defBorder=&#123;topBody:&quot;─&quot;,topJoin:&quot;┬&quot;,topLeft:&quot;┌&quot;,topRight:&quot;┐&quot;,bottomBody:&quot;─&quot;,bottomJoin:&quot;┴&quot;,bottomLeft:&quot;└&quot;,bottomRight:&quot;┘&quot;,bodyLeft:&quot;│&quot;,bodyRight:&quot;│&quot;,bodyJoin:&quot;│&quot;,joinBody:&quot;─&quot;,joinLeft:&quot;├&quot;,joinRight:&quot;┤&quot;,joinJoin:&quot;┼&quot;&#125;;module.exports=function(rows)&#123;rows=cloneDeep(rows);var options=&#123;border:defBorder&#125;;return options.columns=function(rows)&#123;var columns=[];return loopData(rows,function(data,row,column)&#123;columns[column]=columns[column]||&#123;width:2,paddingLeft:1,paddingRight:1&#125;;data=strWidth(data)+1+1;data&gt;columns[column].width&amp;&amp;(columns[column].width=data)&#125;),columns&#125;(rows),function(rows,options)&#123;for(var columnCount=options.columns.length,i=0,len=rows.length;i&lt;len;i++)for(;rows[i].length&lt;columnCount;)rows[i].push(&quot;&quot;);loopData(rows,function(data,row,column)&#123;var column=options.columns[column],paddingLeft=column.paddingLeft,width=column.width,column=column.paddingRight;return repeat(&quot; &quot;,paddingLeft)+data+repeat(&quot; &quot;,width-strWidth(data)-column)&#125;)&#125;(rows,options),function(rows,options)&#123;var ret=&quot;&quot;;return ret+=renderBorder(&quot;top&quot;,options),each(rows,function(row,idx)&#123;ret+=function(columns,options)&#123;options=options.border;return options.bodyLeft+columns.join(options.bodyJoin)+options.bodyRight+&quot;\n&quot;&#125;(row,options),idx===rows.length-1?ret+=renderBorder(&quot;bottom&quot;,options):ret+=renderBorder(&quot;join&quot;,options)&#125;),ret&#125;(rows,options)&#125;&#125;),toStr=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return null==val?&quot;&quot;:val.toString()&#125;&#125;),Benchmark=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(fn)&#123;var options=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;;defaults(options,defOpts),this._fn=fn,this._isRunning=!1,this._options=options&#125;,run:function()&#123;var _this=this;if(this._isRunning)return this._pendingPromise;this._reset(),this._isRunning=!0;var options=this._options,pendingPromise=new _Promise(function(resolve,reject)&#123;function runSample()&#123;var initCount=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:1;delay(function()&#123;_this._runSample(initCount).then(function(_ref)&#123;var period=_ref.period,_ref=_ref.count,sample=_this._sample;sample.push(period),perfNow()-_this._timeStamp&lt;options.maxTime||sample.length&lt;options.minSamples?runSample(_ref):resolve(_this._calcResult())&#125;).catch(function(err)&#123;reject(err)&#125;)&#125;,options.delay)&#125;runSample()&#125;);function complete()&#123;this._isRunning=!1,delete this._pendingPromise&#125;return pendingPromise.then(complete).catch(complete),this._pendingPromise=pendingPromise&#125;,_reset:function()&#123;this._timeStamp=perfNow(),this._sample=[]&#125;,_calcResult:function()&#123;var sample=this._sample,result=&#123;sample:sample,toString:function()&#123;var hz=this.hz,rme=this.rme,name=this.name,size=this.sample.length;return&quot;&quot;.concat(name,&quot; x &quot;).concat(formatNumber(hz.toFixed(hz&lt;100?2:0)),&quot; ops/sec ±&quot;).concat(rme.toFixed(2),&quot;% (&quot;).concat(size,&quot; run&quot;).concat(1===size?&quot;&quot;:&quot;s&quot;,&quot; sampled)&quot;)&#125;&#125;,size=sample.length;result.name=this._options.name||this._fn.name||&quot;anonymous&quot;,result.mean=average.apply(null,sample),result.variance=reduce(sample,function(sum,x)&#123;return sum+Math.pow(x-result.mean,2)&#125;,0)/(size-1)||0,result.deviation=Math.sqrt(result.variance),result.sem=result.deviation/Math.sqrt(size);sample=tTable[Math.round(size-1)||1]||tTable.infinity;return result.moe=result.sem*sample,result.rme=result.moe/result.mean*100||0,result.hz=1e3/result.mean,result&#125;,_runSample:function(count)&#123;var _this2=this,options=this._options,minTime=options.minTime;return new _Promise(function(resolve,reject)&#123;function runCycle(count)&#123;delay(function()&#123;var elapsed=0;try&#123;elapsed=_this2._runCycle(count)&#125;catch(e)&#123;return reject(e)&#125;var period=elapsed/count;elapsed&lt;minTime?(0===elapsed?count*=100:count+=Math.ceil((minTime-elapsed)/period),runCycle(count)):resolve(&#123;count:count,period:period&#125;)&#125;,options.delay)&#125;runCycle(count)&#125;)&#125;,_runCycle:function(count)&#123;for(var fn=this._fn,now=perfNow();count--;)fn();return perfNow()-now&#125;&#125;,&#123;all:function(benches,options)&#123;var promises=[];return each(benches,function(bench)&#123;bench instanceof exports||(bench=new exports(bench,options)),promises.push(bench.run())&#125;),_Promise.all(promises).then(function(results)&#123;return results.toString=function()&#123;var data=map(results,function(_ref2,idx)&#123;var name=_ref2.name,sample=_ref2.sample,hz=_ref2.hz,_ref2=_ref2.rme,columns=[],sample=sample.length;return columns.push(toStr(idx+1),name||&quot;anonymous&quot;,formatNumber(hz.toFixed(hz&lt;100?2:0)),&quot;±&quot;.concat(_ref2.toFixed(2),&quot;%&quot;),&quot;&quot;.concat(sample,&quot; run&quot;).concat(1===sample?&quot;&quot;:&quot;s&quot;)),columns&#125;);return data.unshift([&quot;index&quot;,&quot;name&quot;,&quot;ops/sec&quot;,&quot;rme&quot;,&quot;sampled&quot;]),table(data)&#125;,results&#125;)&#125;&#125;);var defOpts=&#123;minTime:50,maxTime:5e3,minSamples:5,delay:5,name:&quot;&quot;&#125;,tTable=&#123;1:12.706,2:4.303,3:3.182,4:2.776,5:2.571,6:2.447,7:2.365,8:2.306,9:2.262,10:2.228,11:2.201,12:2.179,13:2.16,14:2.145,15:2.131,16:2.12,17:2.11,18:2.101,19:2.093,20:2.086,21:2.08,22:2.074,23:2.069,24:2.064,25:2.06,26:2.056,27:2.052,28:2.048,29:2.045,30:2.042,infinity:1.96&#125;;function formatNumber(number)&#123;return(number=String(number).split(&quot;.&quot;))[0].replace(/(?=(?:\d&#123;3&#125;)+$)(?!\b)/g,&quot;,&quot;)+(number[1]?&quot;.&quot;+number[1]:&quot;&quot;)&#125;module.exports=exports&#125;),Blob$1=createCommonjsModule(function(module,exports)&#123;exports=root.Blob||function(parts,options)&#123;options=options||&#123;&#125;;var blobBuilder=new BlobBuilder;return each(parts,function(part)&#123;blobBuilder.append(part)&#125;),options.type?blobBuilder.getBlob(options.type):blobBuilder.getBlob()&#125;;var BlobBuilder=root.BlobBuilder||root.WebKitBlobBuilder||root.MSBlobBuilder||root.MozBlobBuilder;module.exports=exports&#125;),fill=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,val,start,end)&#123;var len=arr.length;if(!len)return[];for(isUndef(end)&amp;&amp;(end=len),isUndef(start)&amp;&amp;(start=0);start&lt;end;)arr[start++]=val;return arr&#125;&#125;),fnv1a=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;for(var ret=2166136261,i=0,len=str.length;i&lt;len;i++)ret=(ret^=str.charCodeAt(i))+((ret&lt;&lt;1)+(ret&lt;&lt;4)+(ret&lt;&lt;7)+(ret&lt;&lt;8)+(ret&lt;&lt;24));return ret&gt;&gt;&gt;0&#125;&#125;),strHash=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;for(var hash=5381,i=str.length;i;)hash=(hash&lt;&lt;5)+hash+str.charCodeAt(--i);return hash&gt;&gt;&gt;0&#125;&#125;),BloomFilter=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;var size=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:1024,k=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:3;this._buckets=fill(new Array(size),0),this._k=k,this._size=size&#125;,add:function(val)&#123;var _this=this;each(this._locations(val),function(location)&#123;return _this._buckets[location]=1&#125;)&#125;,test:function(val)&#123;var _this2=this;return!some(this._locations(val),function(location)&#123;return 0===_this2._buckets[location]&#125;)&#125;,_locations:function(val)&#123;for(var ret=[],size=this._size,a=fnv1a(val),b=strHash(val),i=0;i&lt;this._k;i++)ret[i]=(a+b*i)%size;return console.log(ret),ret&#125;&#125;),module.exports=exports&#125;),lowerCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return toStr(str).toLocaleLowerCase()&#125;&#125;),Caseless=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(obj)&#123;this._target=obj&#125;,set:function(key,val)&#123;var name=this.getKey(key);this._target[key=name?name:key]=val&#125;,get:function(key)&#123;if(key=this.getKey(key))return this._target[key]&#125;,getKey:function(key)&#123;for(var name=lowerCase(key),_keys=keys(this._target),i=0,len=_keys.length;i&lt;len;i++)&#123;var _key=_keys[i];if(lowerCase(_key)===name)return _key&#125;&#125;,remove:function(key)&#123;delete this._target[this.getKey(key)]&#125;,has:function(key)&#123;return!!this.getKey(key)&#125;&#125;),module.exports=exports&#125;),clamp=createCommonjsModule(function(module,exports)&#123;module.exports=function(n,lower,upper)&#123;return isUndef(upper)&amp;&amp;(upper=lower,lower=void 0),!isUndef(lower)&amp;&amp;n&lt;lower?lower:upper&lt;n?upper:n&#125;&#125;),rgbToHsl=createCommonjsModule(function(module,exports)&#123;var mMin=Math.min,mMax=Math.max,round=Math.round;module.exports=function(rgb)&#123;var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=mMin(r,g,b),max=mMax(r,g,b),delta=max-min,b=max===min?0:r===max?(g-b)/delta:g===max?2+(b-r)/delta:4+(r-g)/delta,r=((b=mMin(60*b,360))&lt;0&amp;&amp;(b+=360),(min+max)/2),g=max===min?0:r&lt;=.5?delta/(max+min):delta/(2-max-min),delta=[round(b),round(100*g),round(100*r)];return rgb[3]&amp;&amp;(delta[3]=rgb[3]),delta&#125;&#125;),hslToRgb=createCommonjsModule(function(module,exports)&#123;var round=Math.round;module.exports=function(hsl)&#123;var t3,val,h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100,ret=[];if(hsl[3]&amp;&amp;(ret[3]=hsl[3]),0==s)return val=round(255*l),ret[0]=ret[1]=ret[2]=val,ret;for(var t2,t1=2*l-(t2=l&lt;.5?l*(1+s):l+s-l*s),i=0;i&lt;3;i++)(t3=h+1/3*-(i-1))&lt;0&amp;&amp;t3++,1&lt;t3&amp;&amp;t3--,ret[i]=round(255*(val=6*t3&lt;1?t1+6*(t2-t1)*t3:2*t3&lt;1?t2:3*t3&lt;2?t1+(t2-t1)*(2/3-t3)*6:t1));return ret&#125;&#125;),isOdd=createCommonjsModule(function(module,exports)&#123;module.exports=function(num)&#123;return!!isInt(num)&amp;&amp;num%2!=0&#125;&#125;),hex=createCommonjsModule(function(module,exports)&#123;module.exports=&#123;encode:function(bytes)&#123;for(var hex=[],i=0,len=bytes.length;i&lt;len;i++)&#123;var byte=bytes[i];hex.push((byte&gt;&gt;&gt;4).toString(16)),hex.push((15&amp;byte).toString(16))&#125;return hex.join(&quot;&quot;)&#125;,decode:function(str)&#123;var bytes=[],len=str.length;isOdd(len)&amp;&amp;len--;for(var i=0;i&lt;len;i+=2)bytes.push(parseInt(str.substr(i,2),16));return bytes&#125;&#125;&#125;),Color=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(color)&#123;isStr(color)&amp;&amp;(color=exports.parse(color)),this.model=color.model,this.val=color.val&#125;,toRgb:function()&#123;var val=this.val,prefix=&quot;rgba&quot;;return 1===(val=&quot;hsl&quot;===this.model?hslToRgb(val):val)[3]&amp;&amp;(prefix=&quot;rgb&quot;,val=val.slice(0,3)),prefix+&quot;(&quot;+val.join(&quot;, &quot;)+&quot;)&quot;&#125;,toHex:function()&#123;var val=this.val,val=(&quot;hsl&quot;===this.model&amp;&amp;(val=hslToRgb(val)),hex.encode(val.slice(0,3)));return&quot;#&quot;+(val=val[0]===val[1]&amp;&amp;val[2]===val[3]&amp;&amp;val[4]===val[5]?val[0]+val[2]+val[5]:val)&#125;,toHsl:function()&#123;var val=this.val,prefix=&quot;hsla&quot;;return 1===(val=&quot;rgb&quot;===this.model?rgbToHsl(val):val)[3]&amp;&amp;(prefix=&quot;hsl&quot;,val=val.slice(0,3)),val[1]=val[1]+&quot;%&quot;,val[2]=val[2]+&quot;%&quot;,prefix+&quot;(&quot;+val.join(&quot;, &quot;)+&quot;)&quot;&#125;&#125;,&#123;parse:function(colorStr)&#123;var i,match,val=[0,0,0,1],model=&quot;rgb&quot;;if(match=colorStr.match(regHexAbbr))for(match=match[1],i=0;i&lt;3;i++)val[i]=parseInt(match[i]+match[i],16);else if(match=colorStr.match(regHex))for(match=match[1],i=0;i&lt;3;i++)&#123;var i2=2*i;val[i]=parseInt(match.slice(i2,2+i2),16)&#125;else if(match=colorStr.match(regRgba))&#123;for(i=0;i&lt;3;i++)val[i]=parseInt(match[i+1],0);match[4]&amp;&amp;(val[3]=parseFloat(match[4]))&#125;else if(match=colorStr.match(regRgbaPer))&#123;for(i=0;i&lt;3;i++)val[i]=Math.round(2.55*parseFloat(match[i+1]));match[4]&amp;&amp;(val[3]=parseFloat(match[4]))&#125;else(match=colorStr.match(regHsla))&amp;&amp;(model=&quot;hsl&quot;,val=[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(parseFloat(match[4]),0,1)]);return&#123;val:val,model:model&#125;&#125;&#125;);var regHexAbbr=/^#([a-fA-F0-9]&#123;3&#125;)$/,regHex=/^#([a-fA-F0-9]&#123;6&#125;)$/,regRgba=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d.]+)\s*)?\)$/,regRgbaPer=/^rgba?\(\s*([+-]?[\d.]+)%\s*,\s*([+-]?[\d.]+)%\s*,\s*([+-]?[\d.]+)%\s*(?:,\s*([+-]?[\d.]+)\s*)?\)$/,regHsla=/^hsla?\(\s*([+-]?\d*[.]?\d+)(?:deg)?\s*,\s*([+-]?[\d.]+)%\s*,\s*([+-]?[\d.]+)%\s*(?:,\s*([+-]?[\d.]+)\s*)?\)$/;module.exports=exports&#125;),defineProp_1=createCommonjsModule(function(module,exports)&#123;function defineProp(obj,prop,descriptor)&#123;for(var path=castPath(prop,obj),lastProp=path.pop();prop=path.shift();)obj[prop]||(obj[prop]=&#123;&#125;),obj=obj[prop];Object.defineProperty(obj,lastProp,descriptor)&#125;module.exports=function(obj,prop,descriptor)&#123;return isStr(prop)?defineProp(obj,prop,descriptor):isObj(prop)&amp;&amp;each(prop,function(descriptor,prop)&#123;defineProp(obj,prop,descriptor)&#125;),obj&#125;&#125;),Delegator=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(host,target)&#123;this._host=host,isStr(target)&amp;&amp;(target=safeGet(host,target)),this._target=target&#125;,method:function(name,targetName)&#123;var target=this._target,fn=target[targetName||name];return this._host[name]=function()&#123;return fn.apply(target,arguments)&#125;,this&#125;,getter:function(name,targetName)&#123;var target=this._target;return targetName=targetName||name,defineProp_1(this._host,name,&#123;get:function()&#123;return target[targetName]&#125;,configurable:!0&#125;),this&#125;,setter:function(name,targetName)&#123;var target=this._target;return targetName=targetName||name,defineProp_1(this._host,name,&#123;set:function(val)&#123;return target[targetName]=val&#125;,configurable:!0&#125;),this&#125;,access:function(name,targetName)&#123;return this.getter(name,targetName).setter(name,targetName)&#125;&#125;),module.exports=exports&#125;),uniqId=createCommonjsModule(function(module,exports)&#123;var idCounter=0;module.exports=function(prefix)&#123;var id=++idCounter+&quot;&quot;;return prefix?prefix+id:id&#125;&#125;),Dispatcher=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._callbacks=&#123;&#125;,this._isDispatching=!1,this._isHandled=&#123;&#125;,this._isPending=&#123;&#125;&#125;,dispatch:function(payload)&#123;for(var id in this._startDispatching(payload),this._callbacks)this._isPending[id]||this._invokeCb(id);this._stopDispatching()&#125;,register:function(cb)&#123;var id=uniqId(&quot;ID_&quot;);return this._callbacks[id]=cb,id&#125;,waitFor:function(ids)&#123;for(var i=0,len=ids.length;i&lt;len;i++)&#123;var id=ids[i];this._isPending[id]||this._invokeCb(id)&#125;&#125;,unregister:function(id)&#123;delete this._callbacks[id]&#125;,isDispatching:function()&#123;return this._isDispatching&#125;,_startDispatching:function(payload)&#123;for(var id in this._callbacks)this._isPending[id]=!1,this._isHandled[id]=!1;this._pendingPayload=payload,this._isDispatching=!0&#125;,_stopDispatching:function()&#123;delete this._pendingPayload,this._isDispatching=!1&#125;,_invokeCb:function(id)&#123;this._isPending[id]=!0,this._callbacks[id](this._pendingPayload),this._isHandled[id]=!0&#125;&#125;),module.exports=exports&#125;),freeze=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;return Object.freeze?Object.freeze(obj):(keys(obj).forEach(function(prop)&#123;Object.getOwnPropertyDescriptor(obj,prop).configurable&amp;&amp;Object.defineProperty(obj,prop,&#123;writable:!1,configurable:!1&#125;)&#125;),obj)&#125;&#125;),Enum=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(map)&#123;isArr(map)?(this.size=map.length,each(map,function(member,val)&#123;this[member]=val&#125;,this)):(this.size=keys(map).length,each(map,function(val,member)&#123;this[member]=val&#125;,this)),freeze(this)&#125;&#125;),module.exports=exports&#125;),LinkedList=createCommonjsModule(function(module,exports)&#123;var Node=(exports=Class(&#123;initialize:function()&#123;this.tail=null,this.head=null,this.size=0&#125;,push:function(val)&#123;val=new Node(val,this.tail,null,this);return this.tail=val,this.head=this.head||val,this.size++,this.size&#125;,pop:function()&#123;var node;if(this.tail)return node=this.tail,this.tail=node.prev,this.tail?this.tail.next=null:this.head=null,this.size--,node.value&#125;,unshift:function(val)&#123;val=new Node(val,null,this.head,this);return this.head=val,this.tail=this.tail||val,this.size++,this.size&#125;,shift:function()&#123;var node;if(this.head)return node=this.head,this.head=node.next,this.head?this.head.prev=null:this.tail=null,this.size--,node.value&#125;,rmNode:function(node)&#123;if(node.list!==this)throw Error(&quot;Node does not belong to this list&quot;);var next=node.next,prev=node.prev;next&amp;&amp;(next.prev=prev),prev&amp;&amp;(prev.next=next),node===this.head&amp;&amp;(this.head=next),node===this.tail&amp;&amp;(this.tail=prev),node.list=null,node.prev=null,node.next=null,this.size--&#125;,find:function(fn)&#123;for(var current=this.head;null!==current;0)&#123;if(fn(current.value))return current;current=current.next&#125;&#125;,forEach:function(iterator,ctx)&#123;ctx=1&lt;arguments.length?ctx:this;for(var i=0,current=this.head;null!==current;i++)iterator.call(ctx,current.value,i,this),current=current.next&#125;,toArr:function()&#123;for(var arr=new Array(this.size),i=0,current=this.head;null!==current;i++)arr[i]=current.value,current=current.next;return arr&#125;&#125;)).Node=Class(&#123;initialize:function(val,prev,next,list)&#123;this.value=val,this.list=list,prev?(prev.next=this).prev=prev:this.prev=null,next?(next.prev=this).next=next:this.next=null&#125;&#125;);module.exports=exports&#125;),LinkedList_1=LinkedList.Node,HashTable=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._buckets=map(Array(0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:32),function()&#123;return new LinkedList&#125;),this._keys=&#123;&#125;&#125;,set:function(key,val)&#123;var keyHash=this._hash(key),keyHash=(this._keys[key]=keyHash,this._buckets[keyHash]),node=keyHash.find(function(val)&#123;return val.key===key&#125;);node?node.value.value=val:keyHash.push(&#123;key:key,value:val&#125;)&#125;,get:function(key)&#123;var node=this._buckets[this._hash(key)].find(function(val)&#123;return val.key===key&#125;);if(node)return node.value.value&#125;,has:function(key)&#123;return has(this._keys,key)&#125;,delete:function(key)&#123;var keyHash=this._hash(key),keyHash=(delete this._keys[key],this._buckets[keyHash]),node=keyHash.find(function(val)&#123;return val.key===key&#125;);node&amp;&amp;keyHash.rmNode(node)&#125;,_hash:function(key)&#123;return strHash(key)%this._buckets.length&#125;&#125;),module.exports=exports&#125;),swap=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,a,b)&#123;var tmp=arr[a];return arr[a]=arr[b],arr[b]=tmp,arr&#125;&#125;),isSorted=createCommonjsModule(function(module,exports)&#123;(exports=function(arr)&#123;for(var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:exports.defComparator,i=0,len=arr.length;i&lt;len-1;i++)if(0&lt;cmp(arr[i],arr[i+1]))return!1;return!0&#125;).defComparator=function(a,b)&#123;return a&lt;b?-1:b&lt;a?1:0&#125;,module.exports=exports&#125;),isSorted_1=isSorted.defComparator,Heap=createCommonjsModule(function(module,exports)&#123;function parentIdx(idx)&#123;return Math.floor((idx-1)/2)&#125;function rightChildIdx(idx)&#123;return 2*idx+2&#125;exports=Class(&#123;initialize:function()&#123;var cmp=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:isSorted.defComparator;this._cmp=cmp,this.clear()&#125;,clear:function()&#123;this._data=[],this.size=0&#125;,add:function(item)&#123;return this._data.push(item),this.size++,this._heapifyUp(this.size-1),this.size&#125;,poll:function()&#123;var item,data=this._data;if(0&lt;this.size)return item=data[0],data[0]=data[this.size-1],this.size--,this._heapifyDown(0),item&#125;,peek:function()&#123;if(0&lt;this.size)return this._data[0]&#125;,_heapifyUp:function(idx)&#123;for(var data=this._data,parent=parentIdx(idx);0&lt;idx&amp;&amp;0&lt;this._cmp(data[parent],data[idx]);)swap(data,parent,idx),parent=parentIdx(idx=parent)&#125;,_heapifyDown:function(idx)&#123;for(var size=this.size,cmp=this._cmp,data=this._data;2*idx+1&lt;size;)&#123;var smallerIdx=2*idx+1,rightChild=2*idx+2;if(rightChild&lt;size&amp;&amp;cmp(data[rightChildIdx],data[smallerIdx])&lt;0&amp;&amp;(smallerIdx=rightChild),cmp(data[idx],data[smallerIdx])&lt;0)break;swap(data,idx,smallerIdx),idx=smallerIdx&#125;&#125;&#125;),module.exports=exports&#125;),toBool=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return isStr(val)?&quot;0&quot;!==(val=val.toLowerCase())&amp;&amp;&quot;&quot;!==val&amp;&amp;&quot;false&quot;!==val:!!val&#125;&#125;),HeapSnapshot=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(profile)&#123;isStr(profile)&amp;&amp;(profile=JSON.parse(profile)),this.nodes=new LinkedList,this.edges=new LinkedList;var meta=profile.snapshot.meta;this.nodeFields=map(meta.node_fields,camelCase),this.nodeTypes=meta.node_types[this.nodeFields.indexOf(&quot;type&quot;)],this.edgeFields=map(meta.edge_fields,camelCase),this.edgeTypes=meta.edge_types[this.edgeFields.indexOf(&quot;type&quot;)],this._init(profile)&#125;,_init:function(profile)&#123;for(var _this=this,nodes=profile.nodes,edges=profile.edges,strings=profile.strings,profile=this.nodeFields,edgeFields=this.edgeFields,curEdgeIdx=0,nodeFieldCount=profile.length,edgeFieldCount=edgeFields.length,nodeMap=&#123;&#125;,i=0,len=nodes.length;i&lt;len;i+=nodeFieldCount)&#123;var node=new Node(this);node.init(nodes.slice(i,i+nodeFieldCount),strings),this.nodes.push(node),nodeMap[i]=node&#125;this.nodes.forEach(function(node)&#123;for(var edgeCount=node.edgeCount,maxEdgeIdx=(delete node.edgeCount,curEdgeIdx+edgeCount*edgeFieldCount),_i=curEdgeIdx;_i&lt;maxEdgeIdx;_i+=edgeFieldCount)&#123;var edge=new Edge(_this,node);edge.init(edges.slice(_i,_i+edgeFieldCount),strings,nodeMap),_this.edges.push(edge)&#125;curEdgeIdx=maxEdgeIdx&#125;)&#125;&#125;);var Node=Class(&#123;initialize:function(heapSnapshot)&#123;this._heapSnapshot=heapSnapshot&#125;,init:function(fields,strings)&#123;var _this2=this,heapSnapshot=this._heapSnapshot,nodeFields=heapSnapshot.nodeFields,nodeTypes=heapSnapshot.nodeTypes;each(nodeFields,function(field,idx)&#123;var val=fields[idx];switch(field)&#123;case&quot;name&quot;:val=strings[val];break;case&quot;detachedness&quot;:val=toBool(val);break;case&quot;type&quot;:val=nodeTypes[val]&#125;_this2[field]=val&#125;)&#125;&#125;),Edge=Class(&#123;initialize:function(heapSnapshot,fromNode)&#123;this._heapSnapshot=heapSnapshot,this.fromNode=fromNode&#125;,init:function(fields,strings,nodeMap)&#123;var _this3=this,heapSnapshot=this._heapSnapshot,edgeFields=heapSnapshot.edgeFields,edgeTypes=heapSnapshot.edgeTypes;each(edgeFields,function(field,idx)&#123;var val=fields[idx];switch(field)&#123;case&quot;nameOrIndex&quot;:val=strings[val];break;case&quot;type&quot;:val=edgeTypes[val];break;case&quot;toNode&quot;:val=nodeMap[val]&#125;_this3[field]=val&#125;)&#125;&#125;);module.exports=exports&#125;),strTpl=createCommonjsModule(function(module,exports)&#123;var regSep=/&#123;&#123;(.*?)&#125;&#125;/g;module.exports=function(str,data)&#123;return str.replace(regSep,function(match,key)&#123;return toStr(safeGet(data,key))&#125;)&#125;&#125;),I18n=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(locale,langs)&#123;this._locale=locale,this._langs=langs&#125;,set:function(locale,lang)&#123;this._langs[locale]?extend(this._langs[locale],lang):this._langs[locale]=lang&#125;,t:function(path,data)&#123;var val=&quot;&quot;,lang=this._langs[this._locale];return lang?(val=safeGet(lang,path),data&amp;&amp;(isStr(val)?val=strTpl(val,data):isFn(val)&amp;&amp;(val=val(data))),val||&quot;&quot;):&quot;&quot;&#125;,locale:function(locale)&#123;this._locale=locale&#125;&#125;),module.exports=exports&#125;),isSymbol=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;symbol&quot;==typeof val&#125;&#125;),safeSet=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,path,val)&#123;for(var lastProp=(path=castPath(path,obj)).pop(),prop=path.shift();!isUndef(prop);)&#123;if(&quot;__proto__&quot;===(prop=isStr(prop)||isSymbol(prop)?prop:toStr(prop))||&quot;constructor&quot;===prop||&quot;prototype&quot;===prop)return;obj[prop]||(obj[prop]=&#123;&#125;),obj=obj[prop],prop=path.shift()&#125;obj[lastProp]=val&#125;&#125;),safeDel=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,path)&#123;var prop,ret;for(path=castPath(path,obj);prop=path.shift();)if(ret=obj[prop],0===path.length&amp;&amp;delete obj[prop],isUndef(obj=ret))return;return ret&#125;&#125;),JsonTransformer=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;className:&quot;JsonTransformer&quot;,initialize:function(data)&#123;this._data=data||&#123;&#125;&#125;,set:function(key,val)&#123;return 1===arguments.length?this._data=key:safeSet(this._data,key,val),this&#125;,get:function(key)&#123;return null==key?this._data:safeGet(this._data,key)&#125;,map:function(from,to,fn)&#123;return isFn(from)?this.set(map(this._data,from,this)):(isFn(to)&amp;&amp;(fn=to,to=from),this.set(to,map(this.get(from),fn,this)))&#125;,filter:function(from,to,fn)&#123;return isFn(from)?this.set(filter(this._data,from,this)):(isFn(to)&amp;&amp;(fn=to,to=from),this.set(to,filter(this.get(from),fn,this)))&#125;,remove:function(keys)&#123;keys=toArr(keys);var data=this._data;return each(keys,function(key)&#123;safeDel(data,key)&#125;),this&#125;,compute:function(from,to,fn)&#123;return isFn(from)?this.set(from.call(this,this._data)):isFn(to)?this.set(from,to.call(this,this.get(from))):(from=map(toArr(from),function(key)&#123;return safeGet(this._data,key)&#125;,this),this.set(to,fn.apply(this,from)))&#125;,toString:function()&#123;return JSON.stringify(this._data)&#125;&#125;),module.exports=exports&#125;),Store=createCommonjsModule(function(module,exports)&#123;exports=Emitter.extend(&#123;initialize:function(data)&#123;this.callSuper(Emitter,&quot;initialize&quot;,arguments),this._data=data||&#123;&#125;,this.save(this._data)&#125;,set:function(key,val)&#123;isStr(key)?(data=&#123;&#125;)[key]=val:isObj(key)&amp;&amp;(data=key);var data,self=this;each(data,function(val,key)&#123;var oldVal=self._data[key];self._data[key]=val,self.emit(&quot;change&quot;,key,val,oldVal)&#125;),this.save(this._data)&#125;,get:function(key)&#123;var data=this._data;if(isStr(key))return data[key];var ret=&#123;&#125;;return each(key,function(val)&#123;ret[val]=data[val]&#125;),ret&#125;,remove:function(key)&#123;key=toArr(key);var data=this._data;each(key,function(val)&#123;delete data[val]&#125;),this.save(data)&#125;,clear:function()&#123;this._data=&#123;&#125;,this.save(this._data)&#125;,each:function(fn)&#123;each(this._data,fn)&#125;,save:function(data)&#123;this._data=data&#125;&#125;),module.exports=exports&#125;),memStorage=createCommonjsModule(function(module,exports)&#123;var keys$1=keys,cloak=(exports=&#123;getItem:function(key)&#123;return(API_KEYS[key]?cloak:this)[key]||null&#125;,setItem:function(key,val)&#123;API_KEYS[key]?cloak[key]=val:this[key]=val&#125;,removeItem:function(key)&#123;API_KEYS[key]?delete cloak[key]:delete this[key]&#125;,key:function(i)&#123;var keys=enumerableKeys();return 0&lt;=i&amp;&amp;i&lt;keys.length?keys[i]:null&#125;,clear:function()&#123;for(var key,keys=uncloakedKeys(),i=0;key=keys[i];i++)delete this[key];for(var _key,keys=keys$1(cloak),_i=0;_key=keys[_i];_i++)delete cloak[_key]&#125;&#125;,Object.defineProperty(exports,&quot;length&quot;,&#123;enumerable:!1,configurable:!0,get:function()&#123;return enumerableKeys().length&#125;&#125;),&#123;&#125;),API_KEYS=&#123;getItem:1,setItem:1,removeItem:1,key:1,clear:1,length:1&#125;;function enumerableKeys()&#123;return uncloakedKeys().concat(keys$1(cloak))&#125;function uncloakedKeys()&#123;return keys$1(exports).filter(function(key)&#123;return!API_KEYS[key]&#125;)&#125;module.exports=exports&#125;),safeStorage=createCommonjsModule(function(module,exports)&#123;module.exports=function(type)&#123;var ret;switch(type=type||&quot;local&quot;)&#123;case&quot;local&quot;:ret=window.localStorage;break;case&quot;session&quot;:ret=window.sessionStorage&#125;try&#123;var x=&quot;test-localStorage-&quot;+Date.now(),y=(ret.setItem(x,x),ret.getItem(x));if(ret.removeItem(x),y!==x)throw new Error&#125;catch(e)&#123;return memStorage&#125;return ret&#125;&#125;),isArgs=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Arguments]&quot;===objToStr(val)&#125;&#125;),isEmpty=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return null==val||(isArrLike(val)&amp;&amp;(isArr(val)||isStr(val)||isArgs(val))?0===val.length:0===keys(val).length)&#125;&#125;),_isNaN=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return isNum(val)&amp;&amp;val!==+val&#125;&#125;),isBuffer=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return null!=val&amp;&amp;(!!val._isBuffer||val.constructor&amp;&amp;isFn(val.constructor.isBuffer)&amp;&amp;val.constructor.isBuffer(val))&#125;&#125;),type=createCommonjsModule(function(module,exports)&#123;var regObj=/^\[object\s+(.*?)]$/;module.exports=function(val)&#123;var ret,lower=!(1&lt;arguments.length&amp;&amp;void 0!==arguments[1])||arguments[1];return null===val&amp;&amp;(ret=&quot;Null&quot;),void 0===val&amp;&amp;(ret=&quot;Undefined&quot;),_isNaN(val)&amp;&amp;(ret=&quot;NaN&quot;),(ret=(ret=isBuffer(val)?&quot;Buffer&quot;:ret)||(ret=objToStr(val).match(regObj))&amp;&amp;ret[1])?lower?lowerCase(ret):ret:&quot;&quot;&#125;&#125;),isRegExp=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object RegExp]&quot;===objToStr(val)&#125;&#125;),stringify=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,spaces)&#123;return JSON.stringify(obj,(stack=[],keys=[],function(key,val)&#123;var pos;return 0&lt;stack.length?(-1&lt;(pos=stack.indexOf(this))?(stack.splice(pos+1),keys.splice(pos,1/0,key)):(stack.push(this),keys.push(key)),-1&lt;(pos=stack.indexOf(val))&amp;&amp;(val=stack[0]===val?&quot;[Circular ~]&quot;:&quot;[Circular ~.&quot;+keys.slice(0,pos).join(&quot;.&quot;)+&quot;]&quot;)):stack.push(val),isRegExp(val)||isFn(val)?val=&quot;[&quot;+upperFirst(type(val))+&quot; &quot;+toStr(val)+&quot;]&quot;:isUndef(val)&amp;&amp;(val=null),val&#125;),spaces);var stack,keys&#125;&#125;),LocalStore=createCommonjsModule(function(module,exports)&#123;var localStorage=safeStorage(&quot;local&quot;);exports=Store.extend(&#123;initialize:function(name,data)&#123;this._name=name,data=data||&#123;&#125;;name=localStorage.getItem(name);try&#123;name=JSON.parse(name)&#125;catch(e)&#123;name=&#123;&#125;&#125;isObj(name)||(name=&#123;&#125;),data=defaults(name,data),this.callSuper(Store,&quot;initialize&quot;,[data])&#125;,save:function(data)&#123;if(isEmpty(data))return localStorage.removeItem(this._name);localStorage.setItem(this._name,stringify(data))&#125;&#125;),module.exports=exports&#125;),Logger=createCommonjsModule(function(module,exports)&#123;exports=Emitter.extend(&#123;initialize:function(name,level)&#123;this.name=name,this.setLevel(isUndef(level)?exports.level.DEBUG:level),this.callSuper(Emitter,&quot;initialize&quot;,arguments)&#125;,setLevel:function(level)&#123;return isStr(level)?(level=exports.level[level.toUpperCase()])&amp;&amp;(this._level=level):isNum(level)&amp;&amp;(this._level=level),this&#125;,getLevel:function()&#123;return this._level&#125;,formatter:function(type,argList)&#123;return argList&#125;,trace:function()&#123;return this._log(&quot;trace&quot;,arguments)&#125;,debug:function()&#123;return this._log(&quot;debug&quot;,arguments)&#125;,info:function()&#123;return this._log(&quot;info&quot;,arguments)&#125;,warn:function()&#123;return this._log(&quot;warn&quot;,arguments)&#125;,error:function()&#123;return this._log(&quot;error&quot;,arguments)&#125;,_log:function(type,argList)&#123;return 0===(argList=toArr(argList)).length?this:(this.emit(&quot;all&quot;,type,clone(argList)),exports.level[type.toUpperCase()]&lt;this._level||(this.emit(type,clone(argList)),(&quot;debug&quot;===type?console.log:console[type]).apply(console,this.formatter(type,argList))),this)&#125;&#125;,&#123;level:new Enum(&#123;TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5&#125;)&#125;),module.exports=exports&#125;),PseudoMap=createCommonjsModule(function(module,exports)&#123;exports=root.Map||Class(&#123;initialize:function(data)&#123;this.clear();var self=this;defineProp_1(this,&quot;size&quot;,&#123;get:function()&#123;return keys(self._data).length&#125;,set:function()&#123;&#125;,enumerable:!0,configurable:!0&#125;),data instanceof exports?data.forEach(function(val,key)&#123;this.set(key,val)&#125;,this):isArr(data)&amp;&amp;each(data,function(val)&#123;this.set(val[0],val[1])&#125;,this)&#125;,forEach:function(fn,ctx)&#123;each(this._data,function(val,key)&#123;fn.call(this,val,key)&#125;,ctx)&#125;,has:function(key)&#123;return!isUndef(this._data[key])&#125;,get:function(key)&#123;return this._data[key]&#125;,set:function(key,val)&#123;this._data[key]=val&#125;,delete:function(key)&#123;delete this._data[key]&#125;,clear:function()&#123;this._data=&#123;&#125;&#125;&#125;),module.exports=exports&#125;),Lru=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(max)&#123;this._max=max,this._list=new LinkedList,this._map=new PseudoMap&#125;,has:function(key)&#123;return this._map.has(key)&#125;,remove:function(key)&#123;var node,map=this._map;this.has(key)&amp;&amp;(node=map.get(key),this._list.rmNode(node),map.delete(key))&#125;,get:function(key)&#123;var node,ret,list=this._list,map=this._map;return this.has(key)&amp;&amp;(ret=(node=map.get(key)).value.val,list.rmNode(node),list.unshift(node.value),map.set(key,list.head)),ret&#125;,set:function(key,val)&#123;var node,list=this._list,map=this._map;this.has(key)?(node=map.get(key),list.rmNode(node),list.unshift(&#123;key:key,val:val&#125;),map.set(key,list.head)):(list.unshift(&#123;key:key,val:val&#125;),map.set(key,list.head),list.size&gt;this._max&amp;&amp;(node=list.pop(),map.delete(node.key)))&#125;,clear:function()&#123;this._map=new PseudoMap,this._list=new LinkedList&#125;&#125;),module.exports=exports&#125;),MediaQuery=createCommonjsModule(function(module,exports)&#123;exports=Emitter.extend(&#123;className:&quot;MediaQuery&quot;,initialize:function(query)&#123;var _this=this;this.callSuper(Emitter,&quot;initialize&quot;),this._mql=window.matchMedia(query),this._mql.addListener(function()&#123;_this.emit(_this.isMatch()?&quot;match&quot;:&quot;unmatch&quot;)&#125;)&#125;,isMatch:function()&#123;return this._mql.matches&#125;&#125;),module.exports=exports&#125;),MutationObserver=createCommonjsModule(function(module,exports)&#123;exports=(exports=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)||Class(&#123;initialize:function()&#123;&#125;,observe:function()&#123;&#125;,disconnect:function()&#123;&#125;,takeRecords:function()&#123;&#125;&#125;),module.exports=exports&#125;),wrap=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,wrapper)&#123;return partial(wrapper,fn)&#125;&#125;),PriorityQueue=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;var cmp=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:isSorted.defComparator;this._heap=new Heap(wrap(cmp,function(fn,a,b)&#123;return-1*fn(a,b)&#125;)),this.size=0&#125;,clear:function()&#123;this._heap.clear(),this.size=0&#125;,enqueue:function(item)&#123;return this._heap.add(item),this.size++,this.size&#125;,dequeue:function()&#123;var item=this._heap.poll();if(item)return this.size--,item&#125;,peek:function()&#123;return this._heap.peek()&#125;&#125;),module.exports=exports&#125;),Queue=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this.clear()&#125;,clear:function()&#123;this._items=[],this.size=0&#125;,enqueue:function(item)&#123;return this._items.push(item),++this.size&#125;,dequeue:function()&#123;if(this.size)return this.size--,this._items.shift()&#125;,peek:function()&#123;if(this.size)return this._items[0]&#125;,forEach:function(iterator,ctx)&#123;ctx=1&lt;arguments.length?ctx:this;for(var items=this._items,i=0,size=this.size;i&lt;size;i++)iterator.call(ctx,items[i],i,this)&#125;,toArr:function()&#123;return this._items.slice(0)&#125;&#125;),module.exports=exports&#125;),QuickLru=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(max)&#123;this._max=max,this._cache=&#123;&#125;,this._oldCache=&#123;&#125;,this._size=0&#125;,has:function(key)&#123;return!isUndef(this._cache[key])||!isUndef(this._oldCache[key])&#125;,remove:function(key)&#123;isUndef(this._cache[key])||(this._cache[key]=void 0),isUndef(this._oldCache[key])||(this._oldCache[key]=void 0)&#125;,get:function(key)&#123;if(!isUndef(this._cache[key]))return this._cache[key];var val=this._oldCache[key];return isUndef(val)?void 0:(this._update(key,val),val)&#125;,set:function(key,val)&#123;isUndef(this._cache[key])?this._update(key,val):this._cache[key]=val&#125;,clear:function()&#123;this._cache=&#123;&#125;,this._oldCache=&#123;&#125;&#125;,_update:function(key,val)&#123;this._cache[key]=val,this._size++,this._size&gt;this._max&amp;&amp;(this._size=0,this._oldCache=this._cache,this._cache=&#123;&#125;)&#125;&#125;),module.exports=exports&#125;),Readiness=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._promises=&#123;&#125;,this._resolves=&#123;&#125;,this._states=&#123;&#125;&#125;,signal:function(tasks)&#123;var states=this._states;each(this._getPromises(toArr(tasks)),function(val)&#123;val.state||(states[val.task]=!0,val.resolve())&#125;)&#125;,isReady:function(tasks)&#123;return!some(this._getPromises(toArr(tasks)),function(val)&#123;return!val.state&#125;)&#125;,ready:function(tasks)&#123;var fn=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:noop;return Promise.all(map(this._getPromises(toArr(tasks)),function(val)&#123;return val.promise&#125;)).then(fn)&#125;,_getPromises:function(tasks)&#123;var promises=this._promises,resolves=this._resolves,states=this._states;return map(tasks,function(task)&#123;return promises[task]||(promises[task]=new Promise(function(resolve)&#123;resolves[task]=resolve,states[task]=!1&#125;)),&#123;task:task,promise:promises[task],resolve:resolves[task],state:states[task]&#125;&#125;)&#125;&#125;),module.exports=exports&#125;),remove=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,iterator,ctx)&#123;for(var ret=[],i=(iterator=safeCb(iterator,ctx),-1),len=arr.length;++i&lt;len;)&#123;var val=arr[i];iterator(val,i,arr)&amp;&amp;(ret.push(val),arr.splice(i,1))&#125;return ret&#125;&#125;),ReduceStore=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function(reducer,initialState)&#123;this._reducer=reducer,this._state=initialState,this._curListeners=[],this._nextListeners=this._curListeners&#125;,subscribe:function(listener)&#123;var isSubscribed=!0,self=(this._ensureCanMutateNextListeners(),this._nextListeners.push(listener),this);return function()&#123;isSubscribed&amp;&amp;(isSubscribed=!1,self._ensureCanMutateNextListeners(),remove(self._nextListeners,function(val)&#123;return val===listener&#125;))&#125;&#125;,dispatch:function(action)&#123;this._state=this._reducer(this._state,action);for(var listeners=this._curListeners=this._nextListeners,i=0,len=listeners.length;i&lt;len;i++)listeners[i]();return action&#125;,getState:function()&#123;return this._state&#125;,_ensureCanMutateNextListeners:function()&#123;this._nextListeners===this._curListeners&amp;&amp;(this._nextListeners=clone(this._curListeners))&#125;&#125;),module.exports=exports&#125;),SingleEmitter=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._listeners=[]&#125;,addListener:function(listener)&#123;this._listeners.push(listener)&#125;,rmListener:function(listener)&#123;listener=this._listeners.indexOf(listener);-1&lt;listener&amp;&amp;this._listeners.splice(listener,1)&#125;,rmAllListeners:function()&#123;this._listeners=[]&#125;,emit:function()&#123;var _this=this,args=toArr(arguments),listeners=clone(this._listeners);each(listeners,function(listener)&#123;return listener.apply(_this,args)&#125;,this)&#125;&#125;,&#123;mixin:function(obj)&#123;each([&quot;addListener&quot;,&quot;rmListener&quot;,&quot;emit&quot;,&quot;rmAllListeners&quot;],function(val)&#123;obj[val]=exports.prototype[val]&#125;),obj._listeners=obj._listeners||[]&#125;&#125;),module.exports=exports&#125;),isEl=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return!(!val||1!==val.nodeType)&#125;&#125;),startWith=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,prefix)&#123;return 0===str.indexOf(prefix)&#125;&#125;),h=createCommonjsModule(function(module,exports)&#123;module.exports=function(tag,attrs)&#123;for(var _len=arguments.length,children=new Array(2&lt;_len?_len-2:0),_key=2;_key&lt;_len;_key++)children[_key-2]=arguments[_key];(isEl(attrs)||isStr(attrs))&amp;&amp;(children.unshift(attrs),attrs=null),attrs=attrs||&#123;&#125;;var _parseTag=function(tag)&#123;for(var tagName=&quot;div&quot;,id=&quot;&quot;,classes=[],words=[],word=&quot;&quot;,i=0,len=tag.length;i&lt;len;i++)&#123;var c=tag[i];&quot;#&quot;===c||&quot;.&quot;===c?(words.push(word),word=c):word+=c&#125;words.push(word);for(var _i=0,_len2=words.length;_i&lt;_len2;_i++)(word=words[_i])&amp;&amp;(startWith(word,&quot;#&quot;)?id=word.slice(1):startWith(word,&quot;.&quot;)?classes.push(word.slice(1)):tagName=word);return&#123;tagName:tagName,id:id,classes:classes&#125;&#125;(tag),tagName=_parseTag.tagName,id=_parseTag.id,_parseTag=_parseTag.classes,el=document.createElement(tagName);return id&amp;&amp;el.setAttribute(&quot;id&quot;,id),$class.add(el,_parseTag),each(children,function(child)&#123;isStr(child)?el.appendChild(document.createTextNode(child)):isEl(child)&amp;&amp;el.appendChild(child)&#125;),each(attrs,function(val,key)&#123;isStr(val)?el.setAttribute(key,val):isFn(val)&amp;&amp;startWith(key,&quot;on&quot;)?el.addEventListener(key.slice(2),val,!1):&quot;style&quot;===key&amp;&amp;$css(el,val)&#125;),el&#125;&#125;),ResizeSensor=createCommonjsModule(function(module,exports)&#123;exports=root.ResizeObserver?SingleEmitter.extend(&#123;initialize:function(el)&#123;var _this=this;if(el._resizeSensor)return el._resizeSensor;this.callSuper(SingleEmitter,&quot;initialize&quot;);var resizeObserver=new root.ResizeObserver(function()&#123;return _this.emit()&#125;);resizeObserver.observe(el),(el._resizeSensor=this)._resizeObserver=resizeObserver,this._el=el&#125;,destroy:function()&#123;var el=this._el;el._resizeSensor&amp;&amp;(this.rmAllListeners(),delete el._resizeSensor,this._resizeObserver.unobserve(el))&#125;&#125;):SingleEmitter.extend(&#123;initialize:function(el)&#123;if(el._resizeSensor)return el._resizeSensor;this.callSuper(SingleEmitter,&quot;initialize&quot;),(this._el=el)._resizeSensor=this,contain([&quot;absolute&quot;,&quot;relative&quot;,&quot;fixed&quot;,&quot;sticky&quot;],$css(el,&quot;position&quot;))||$css(el,&quot;position&quot;,&quot;relative&quot;),this._appendResizeSensor(),this._bindEvent()&#125;,destroy:function()&#123;var el=this._el;el._resizeSensor&amp;&amp;(this.rmAllListeners(),delete el._resizeSensor,el.removeChild(this._resizeSensorEl))&#125;,_appendResizeSensor:function()&#123;var el=this._el,style=&#123;pointerEvents:&quot;none&quot;,position:&quot;absolute&quot;,left:&quot;0px&quot;,top:&quot;0px&quot;,right:&quot;0px&quot;,bottom:&quot;0px&quot;,overflow:&quot;hidden&quot;,zIndex:&quot;-1&quot;,visibility:&quot;hidden&quot;,maxWidth:&quot;100%&quot;&#125;,styleChild=&#123;position:&quot;absolute&quot;,left:&quot;0px&quot;,top:&quot;0px&quot;,transition:&quot;0s&quot;&#125;,expandChildEl=h(&quot;div&quot;,&#123;style:styleChild&#125;),expandEl=h(&quot;div.resize-sensor-expand&quot;,&#123;style:style&#125;,expandChildEl),styleChild=h(&quot;div.resize-sensor-shrink&quot;,&#123;style:style&#125;,h(&quot;div&quot;,&#123;style:extend(&#123;width:&quot;200%&quot;,height:&quot;200%&quot;&#125;,styleChild)&#125;)),style=h(&quot;div.resize-sensor&quot;,&#123;dir:&quot;ltr&quot;,style:style&#125;,expandEl,styleChild);this._expandEl=expandEl,this._expandChildEl=expandChildEl,this._shrinkEl=styleChild,this._resizeSensorEl=style,el.appendChild(style),this._resetExpandShrink()&#125;,_bindEvent:function()&#123;var _this2=this;$event.on(this._expandEl,&quot;scroll&quot;,function()&#123;return _this2._onScroll()&#125;),$event.on(this._shrinkEl,&quot;scroll&quot;,function()&#123;return _this2._onScroll()&#125;)&#125;,_onScroll:function()&#123;this.emit(),this._resetExpandShrink()&#125;,_resetExpandShrink:function()&#123;var el=this._el,width=el.offsetWidth,el=el.offsetHeight;$css(this._expandChildEl,&#123;width:width+10,height:el+10&#125;),extend(this._expandEl,&#123;scrollLeft:width+10,scrollTop:el+10&#125;),extend(this._shrinkEl,&#123;scrollLeft:width+10,scrollTop:el+10&#125;)&#125;&#125;),module.exports=exports&#125;),Semaphore=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._counter=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:1,this._tasks=new Queue&#125;,wait:function(fn)&#123;if(0&lt;this._counter)return this._counter--,fn();this._tasks.enqueue(fn)&#125;,signal:function()&#123;var task=this._tasks.dequeue();if(task)return task();this._counter++&#125;&#125;),module.exports=exports&#125;),SessionStore=createCommonjsModule(function(module,exports)&#123;var sessionStorage=safeStorage(&quot;session&quot;);exports=Store.extend(&#123;initialize:function(name,data)&#123;this._name=name,data=data||&#123;&#125;;name=sessionStorage.getItem(name);try&#123;name=JSON.parse(name)&#125;catch(e)&#123;name=&#123;&#125;&#125;isObj(name)||(name=&#123;&#125;),data=defaults(name,data),this.callSuper(Store,&quot;initialize&quot;,[data])&#125;,save:function(data)&#123;if(isEmpty(data))return sessionStorage.removeItem(this._name);sessionStorage.setItem(this._name,stringify(data))&#125;&#125;),module.exports=exports&#125;),Socket=createCommonjsModule(function(module,exports)&#123;exports=Emitter.extend(&#123;initialize:function(url)&#123;var options=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;;this.callSuper(Emitter,&quot;initialize&quot;),defaults(options,defOpts),this._options=options,this._url=url,this.connect()&#125;,send:function(message)&#123;this._ws.send(message)&#125;,close:function(code,reason)&#123;this._ws.close(code||1e3,reason)&#125;,connect:function()&#123;var _this=this,options=this._options,ws=new WebSocket(this._url,options.protocols);ws.onmessage=function(e)&#123;return _this.emit(&quot;message&quot;,e)&#125;,ws.onopen=function(e)&#123;return _this.emit(&quot;open&quot;,e)&#125;,ws.onclose=function(e)&#123;var code=e.code;1e3!==code&amp;&amp;1001!==code&amp;&amp;1005!==code&amp;&amp;options.reconnect&amp;&amp;_this.connect(),_this.emit(&quot;close&quot;,e)&#125;,ws.onerror=function(e)&#123;e&amp;&amp;&quot;ECONNREFUSED&quot;===e.code&amp;&amp;options.reconnect?_this.connect():_this.emit(&quot;error&quot;,e)&#125;,this._ws=ws&#125;&#125;);var defOpts=&#123;protocols:[],reconnect:!0&#125;;module.exports=exports&#125;),reverse=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;var len=arr.length,ret=Array(len);len--;for(var i=0;i&lt;=len;i++)ret[len-i]=arr[i];return ret&#125;&#125;),Stack=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this.clear()&#125;,clear:function()&#123;this._items=[],this.size=0&#125;,push:function(item)&#123;return this._items.push(item),++this.size&#125;,pop:function()&#123;if(this.size)return this.size--,this._items.pop()&#125;,peek:function()&#123;return this._items[this.size-1]&#125;,forEach:function(iterator,ctx)&#123;ctx=1&lt;arguments.length?ctx:this;for(var items=this._items,i=this.size-1,j=0;0&lt;=i;i--,j++)iterator.call(ctx,items[i],j,this)&#125;,toArr:function()&#123;return reverse(this._items)&#125;&#125;),module.exports=exports&#125;),Trace=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;var _this=this,events=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:[];this._processes=&#123;&#125;,each(events,function(event)&#123;return _this.addEvent(event)&#125;)&#125;,addEvent:function(event)&#123;this.getProcess(event.pid).addEvent(event)&#125;,rmEvent:function(event)&#123;this.getProcess(event.pid).rmEvent(event)&#125;,getProcess:function(id)&#123;var process=this._processes[id];return process||(process=new Process(id),this._processes[id]=process),process&#125;,rmProcess:function(id)&#123;delete this._processes[id]&#125;,processes:function()&#123;return map(this._processes)&#125;,toJSON:function()&#123;var events=[];return each(this.processes(),function(process)&#123;events.push.apply(events,process.toJSON())&#125;),events&#125;&#125;);var Process=Class(&#123;initialize:function(id)&#123;this._id=id,this._name=&quot;&quot;,this._threads=&#123;&#125;,this._metadata=&#123;&#125;&#125;,id:function()&#123;return this._id&#125;,name:function()&#123;return this._name&#125;,addEvent:function(event)&#123;&quot;__metadata&quot;!==event.cat||(&quot;process_name&quot;===event.name&amp;&amp;(this._name=event.args.name),0!==event.tid)?this.getThread(event.tid).addEvent(event):this._metadata[event.name]=event.args&#125;,rmEvent:function(event)&#123;this.getThread(event.tid).rmEvent(event)&#125;,getThread:function(id)&#123;var thread=this._threads[id];return thread||(thread=new Thread(id,this.id()),this._threads[id]=thread),thread&#125;,rmThread:function(id)&#123;delete this._threads[id]&#125;,threads:function()&#123;return map(this._threads)&#125;,toJSON:function()&#123;var _this2=this,events=[];return each(this._metadata,function(args,name)&#123;events.push(createMetaEvent(_this2._id,0,name,args))&#125;),each(this.threads(),function(thread)&#123;events.push.apply(events,thread.toJSON())&#125;),events&#125;&#125;),Thread=Class(&#123;initialize:function(id,pid)&#123;this._id=id,this._pid=pid,this._name=&quot;&quot;,this._events=[],this._metadata=&#123;&#125;&#125;,id:function()&#123;return this._id&#125;,name:function()&#123;return this._name&#125;,addEvent:function(event)&#123;if(&quot;__metadata&quot;===event.cat)return&quot;thread_name&quot;===event.name&amp;&amp;(this._name=event.args.name),void(this._metadata[event.name]=event.args);this._events.push(event)&#125;,rmEvent:function(event)&#123;var events=this._events;events.splice(events.indexOf(event),1)&#125;,events:function()&#123;return map(this._events)&#125;,toJSON:function()&#123;var _this3=this,events=[];return each(this._metadata,function(args,name)&#123;events.push(createMetaEvent(_this3._pid,_this3._id,name,args))&#125;),each(this.events(),function(event)&#123;events.push(event)&#125;),events&#125;&#125;);function createMetaEvent(pid,tid,name,args)&#123;return&#123;args:args,cat:&quot;__metadata&quot;,name:name,ph:&quot;M&quot;,pid:pid,tid:tid,ts:0&#125;&#125;module.exports=exports&#125;),isNode=createCommonjsModule(function(module,exports)&#123;exports=&quot;undefined&quot;!=typeof process&amp;&amp;&quot;[object process]&quot;===objToStr(process),module.exports=exports&#125;),ltrim=createCommonjsModule(function(module,exports)&#123;var regSpace=/^\s+/;module.exports=function(str,chars)&#123;if(null==chars)return str.trimLeft?str.trimLeft():str.replace(regSpace,&quot;&quot;);for(var i,c,start=0,len=str.length,charLen=chars.length,found=!0;found&amp;&amp;start&lt;len;)for(found=!1,i=-1,c=str.charAt(start);++i&lt;charLen;)if(c===chars[i])&#123;found=!0,start++;break&#125;return len&lt;=start?&quot;&quot;:str.substr(start,len)&#125;&#125;),rtrim=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,chars)&#123;if(null==chars)&#123;if(str.trimRight)return str.trimRight();chars=&quot; \r\n\t\f\v&quot;&#125;for(var i,c,end=str.length-1,charLen=chars.length,found=!0;found&amp;&amp;0&lt;=end;)for(found=!1,i=-1,c=str.charAt(end);++i&lt;charLen;)if(c===chars[i])&#123;found=!0,end--;break&#125;return 0&lt;=end?str.substring(0,end+1):&quot;&quot;&#125;&#125;),trim=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,chars)&#123;return null==chars&amp;&amp;str.trim?str.trim():ltrim(rtrim(str,chars),chars)&#125;&#125;),intersect=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var ret=[],args=toArr(arguments),argsLen=args.length,i=0,len=arr.length;i&lt;len;i++)&#123;var item=arr[i];if(!contain(ret,item))&#123;for(var j=1;j&lt;argsLen&amp;&amp;contain(args[j],item);j++);j===argsLen&amp;&amp;ret.push(item)&#125;&#125;return ret&#125;&#125;),convertBase=createCommonjsModule(function(module,exports)&#123;module.exports=function(num,from,to)&#123;return parseInt(num,from).toString(to)&#125;&#125;),Tracing=createCommonjsModule(function(module,exports)&#123;var defPid=0,defTid=0,id=0;if(isNode)&#123;defPid=process.pid;try&#123;defTid=eval(&quot;require&quot;)(&quot;worker_threads&quot;).threadId&#125;catch(e)&#123;&#125;&#125;exports=Class(&#123;initialize:function()&#123;var _ref=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:&#123;&#125;,_ref$pid=_ref.pid,_ref$pid=void 0===_ref$pid?defPid:_ref$pid,_ref$tid=_ref.tid,_ref$tid=void 0===_ref$tid?defTid:_ref$tid,_ref$processName=_ref.processName,_ref$processName=void 0===_ref$processName?&quot;Process&quot;:_ref$processName,_ref=_ref.threadName,_ref=void 0===_ref?&quot;Thread&quot;:_ref;this._pid=_ref$pid,this._tid=_ref$tid,this._processName=_ref$processName,this._threadName=_ref&#125;,start:function()&#123;this._targetCat=processCat(0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:&quot;&quot;),isEmpty(this._targetCat)||this._targetCat.push(&quot;__metadata&quot;),this._traceEventStack=new Stack,this._asyncEventMap=&#123;&#125;,this._trace=new Trace,this.metadata(&quot;process_name&quot;,&#123;name:this._processName&#125;,&#123;tid:0,ts:0&#125;),this.metadata(&quot;thread_name&quot;,&#123;name:this._threadName&#125;,&#123;ts:0&#125;)&#125;,stop:function()&#123;var trace=this._trace;if(!trace)throw Error(&quot;Need to call start first&quot;);return delete this._targetCat,delete this._traceEventStack,delete this._asyncEventMap,delete this._trace,trace.toJSON()&#125;,metadata:function(name,args,extra)&#123;this._addEvent(&quot;__metadata&quot;,name,Phase.Metadata,args,extra)&#125;,begin:function(cat,name)&#123;this._traceEventStack&amp;&amp;this._traceEventStack.push(&#123;cat:cat,name:name,args:2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:&#123;&#125;,ts:this._getCurTs()&#125;)&#125;,end:function(args)&#123;if(this._traceEventStack)&#123;var beginEvent=this._traceEventStack.pop();if(!beginEvent)throw Error(&quot;Need to call begin first&quot;);var cat=beginEvent.cat,name=beginEvent.name,ts=beginEvent.ts;args=extend(beginEvent.args,args),this._addEvent(cat,name,Phase.Complete,args,&#123;dur:this._getCurTs()-ts,ts:ts&#125;)&#125;&#125;,asyncBegin:function(cat,name)&#123;var id=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:this.id(),args=3&lt;arguments.length&amp;&amp;void 0!==arguments[3]?arguments[3]:&#123;&#125;;return this._asyncEventMap&amp;&amp;(this._asyncEventMap[id]=&#123;cat:cat,name:name&#125;,this._addEvent(cat,name,Phase.NestableAsyncBegin,args,&#123;id:id&#125;)),id&#125;,asyncEnd:function(id)&#123;var args=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;;if(this._asyncEventMap)&#123;var asyncBeginEvent=this._asyncEventMap[id];if(!asyncBeginEvent)throw Error(&quot;Need to call async begin first&quot;);var cat=asyncBeginEvent.cat,asyncBeginEvent=asyncBeginEvent.name;delete this._asyncEventMap[id],this._addEvent(cat,asyncBeginEvent,Phase.NestableAsyncEnd,args,&#123;id:id&#125;)&#125;&#125;,instant:function(cat,name)&#123;var scope=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:&quot;t&quot;;this._addEvent(cat,name,Phase.Instant,3&lt;arguments.length?arguments[3]:void 0,&#123;s:scope&#125;)&#125;,id:function()&#123;return&quot;0x&quot;+convertBase(id++,10,16)&#125;,_addEvent:function(cat,name,ph)&#123;var args=3&lt;arguments.length&amp;&amp;void 0!==arguments[3]?arguments[3]:&#123;&#125;,extra=4&lt;arguments.length&amp;&amp;void 0!==arguments[4]?arguments[4]:&#123;&#125;;if(this._trace)&#123;var targetCat=this._targetCat;if(!isEmpty(targetCat))&#123;var catArr=processCat(cat);if(isEmpty(intersect(catArr,targetCat)))return&#125;catArr=extend(&#123;name:name,cat:cat,ph:ph,ts:this._getCurTs(),pid:this._pid,tid:this._tid,args:args&#125;,extra);this._trace.addEvent(catArr)&#125;&#125;,_getCurTs:function()&#123;return Math.round(1e3*perfNow())&#125;&#125;);var Phase=&#123;Begin:&quot;B&quot;,End:&quot;E&quot;,Complete:&quot;X&quot;,Instant:&quot;I&quot;,NestableAsyncBegin:&quot;b&quot;,NestableAsyncEnd:&quot;e&quot;,Metadata:&quot;M&quot;&#125;;function processCat(cat)&#123;return&quot;&quot;===(cat=trim(cat))?[]:map(cat.split(&quot;,&quot;),trim)&#125;module.exports=exports&#125;),Trie=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this.clear()&#125;,add:function(word)&#123;var edges=this._edges,node=this._root;this._wordsInSubtree[node]++;for(var i=0,len=word.length;i&lt;len;i++)&#123;var edge=word[i],next=edges[node][edge];next||(this._freeNodes.length?next=this._freeNodes.pop():(next=this._idx++,this._isWord.push(!1),this._wordsInSubtree.push(0),edges.push(&#123;&#125;)),edges[node][edge]=next),this._wordsInSubtree[next]++,node=next&#125;this._isWord[node]=!0&#125;,remove:function(word)&#123;if(this.has(word))&#123;var node=this._root;this._wordsInSubtree[node]--;for(var i=0,len=word.length;i&lt;len;i++)&#123;var edge=word[i],next=this._edges[node][edge];--this._wordsInSubtree[next]||(delete this._edges[node][edge],this._freeNodes.push(next)),node=next&#125;this._isWord[node]=!1&#125;&#125;,has:function(word)&#123;for(var node=this._root,i=0,len=word.length;i&lt;len;i++)if(!(node=this._edges[node][word[i]]))return!1;return this._isWord[node]&#125;,words:function(prefix)&#123;for(var node=this._root,i=0,len=prefix.length;i&lt;len;i++)if(!(node=this._edges[node][prefix[i]]))return[];var result=[];return this._dfs(node,prefix,result),result&#125;,clear:function()&#123;this._idx=1,this._root=0,this._edges=[&#123;&#125;],this._isWord=[!1],this._wordsInSubtree=[0],this._freeNodes=[]&#125;,_dfs:function(node,prefix,result)&#123;var _this=this,node=(this._isWord[node]&amp;&amp;result.push(prefix),this._edges[node]);each(node,function(node,edge)&#123;return _this._dfs(node,prefix+edge,result)&#125;)&#125;&#125;),module.exports=exports&#125;),easing=createCommonjsModule(function(module,exports)&#123;exports.linear=function(t)&#123;return t&#125;;var pow=Math.pow,sqrt=Math.sqrt,sin=Math.sin,min=Math.min,asin=Math.asin,PI=Math.PI,fns=&#123;sine:function(t)&#123;return 1+sin(PI/2*t-PI/2)&#125;,circ:function(t)&#123;return 1-sqrt(1-t*t)&#125;,elastic:function(t,m)&#123;if(0===t||1===t)return t;var m=1-min(m=m||DEFAULT_ELASTICITY,998)/1e3,t=+t-1,s=m/(2*PI)*asin(1);return-(pow(2,10*t)*sin(2*PI*(t-s)/m))&#125;,back:function(t)&#123;return t*t*(3*t-2)&#125;,bounce:function(t)&#123;for(var pow2,bounce=4;t&lt;((pow2=pow(2,--bounce))-1)/11;);return 1/pow(4,3-bounce)-7.5625*pow((3*pow2-2)/22-t,2)&#125;&#125;,DEFAULT_ELASTICITY=(each([&quot;quad&quot;,&quot;cubic&quot;,&quot;quart&quot;,&quot;quint&quot;,&quot;expo&quot;],function(name,i)&#123;fns[name]=function(t)&#123;return pow(t,i+2)&#125;&#125;),400);each(fns,function(fn,name)&#123;name=upperFirst(name),exports[&quot;in&quot;+name]=fn,exports[&quot;out&quot;+name]=function(t,m)&#123;return 1-fn(1-t,m)&#125;,exports[&quot;inOut&quot;+name]=function(t,m)&#123;return t&lt;.5?fn(2*t,m)/2:1-fn(-2*t+2,m)/2&#125;,exports[&quot;outIn&quot;+name]=function(t,m)&#123;return t&lt;.5?(1-fn(1-2*t,m))/2:(fn(2*t-1,m)+1)/2&#125;&#125;),module.exports=exports&#125;),easing_1=easing.linear,raf_1=createCommonjsModule(function(module,exports)&#123;var lastTime=0;if(isBrowser)for(var raf=window.requestAnimationFrame,cancel=window.cancelAnimationFrame,vendors=[&quot;ms&quot;,&quot;moz&quot;,&quot;webkit&quot;,&quot;o&quot;],i=0,len=vendors.length;i&lt;len&amp;&amp;!raf;i++)raf=window[vendors[i]+&quot;RequestAnimationFrame&quot;],cancel=window[vendors[i]+&quot;CancelAnimationFrame&quot;]||window[vendors[i]+&quot;CancelRequestAnimationFrame&quot;];(raf=raf||function(cb)&#123;var curTime=now(),timeToCall=Math.max(0,16-(curTime-lastTime)),id=setTimeout(function()&#123;cb(curTime+timeToCall)&#125;,timeToCall);return lastTime=curTime+timeToCall,id&#125;).cancel=cancel=cancel||function(id)&#123;clearTimeout(id)&#125;,exports=raf,module.exports=exports&#125;),Tween=createCommonjsModule(function(module,exports)&#123;exports=Emitter.extend(&#123;className:&quot;Tween&quot;,initialize:function(target)&#123;this.callSuper(Emitter,&quot;initialize&quot;,arguments),this._target=target,this._dest=&#123;&#125;,this._duration=0,this._progress=0,this._origin=&#123;&#125;,this._diff=&#123;&#125;,this._ease=easing.linear,this._state=new State(&quot;pause&quot;,&#123;play:&#123;from:&quot;pause&quot;,to:&quot;play&quot;&#125;,pause:&#123;from:&quot;play&quot;,to:&quot;pause&quot;&#125;&#125;)&#125;,to:function(props,duration,ease)&#123;var origin=&#123;&#125;,target=this._target,diff=&#123;&#125;;return ease=ease||this._ease,this._dest=props,this._duration=duration||this._duration,this._ease=isFn(ease)?ease:easing[ease],each(props,function(val,key)&#123;origin[key]=target[key],diff[key]=val-origin[key]&#125;),this._origin=origin,this._diff=diff,this&#125;,progress:function(progress)&#123;var ease=this._ease,target=this._target,origin=this._origin,diff=this._diff,dest=this._dest;return null!=progress?(progress=progress&lt;1?progress:1,this._progress=progress,each(dest,function(val,key)&#123;target[key]=origin[key]+diff[key]*ease(progress)&#125;),this.emit(&quot;update&quot;,target),this):this._progress&#125;,play:function()&#123;var startTime,progress,duration,target,self,state=this._state;if(!state.is(&quot;play&quot;))return state.play(),startTime=now(),progress=this._progress,duration=this._duration*(1-progress),target=this._target,self=this,raf_1(function render()&#123;if(!state.is(&quot;pause&quot;))&#123;var time=now();if(self.progress(progress+(time-startTime)/duration),1===self._progress)return state.pause(),void self.emit(&quot;end&quot;,target);raf_1(render)&#125;&#125;),this&#125;,pause:function()&#123;var state=this._state;if(!state.is(&quot;pause&quot;))return state.pause(),this&#125;,paused:function()&#123;return this._state.is(&quot;pause&quot;)&#125;&#125;),module.exports=exports&#125;),query=createCommonjsModule(function(module,exports)&#123;exports=&#123;parse:function(str)&#123;var ret=&#123;&#125;;return str=trim(str).replace(regIllegalChars,&quot;&quot;),each(str.split(&quot;&amp;&quot;),function(param)&#123;var param=param.split(&quot;=&quot;),key=param.shift(),param=0&lt;param.length?param.join(&quot;=&quot;):null,key=decodeURIComponent(key),param=decodeURIComponent(param);isUndef(ret[key])?ret[key]=param:isArr(ret[key])?ret[key].push(param):ret[key]=[ret[key],param]&#125;),ret&#125;,stringify:function(obj,arrKey)&#123;return filter(map(obj,function(val,key)&#123;return isObj(val)&amp;&amp;isEmpty(val)?&quot;&quot;:isArr(val)?exports.stringify(val,key):(arrKey?encodeURIComponent(arrKey):encodeURIComponent(key))+&quot;=&quot;+encodeURIComponent(val)&#125;),function(str)&#123;return 0&lt;str.length&#125;).join(&quot;&amp;&quot;)&#125;&#125;;var regIllegalChars=/^(\?|#|&amp;)/g;module.exports=exports&#125;),Url=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;className:&quot;Url&quot;,initialize:function(url)&#123;!url&amp;&amp;isBrowser&amp;&amp;(url=window.location.href),extend(this,exports.parse(url||&quot;&quot;))&#125;,setQuery:function(name,val)&#123;var query=this.query;return isObj(name)?each(name,function(val,key)&#123;query[key]=toStr(val)&#125;):query[name]=toStr(val),this&#125;,rmQuery:function(name)&#123;var query=this.query;return isArr(name)||(name=toArr(name)),each(name,function(key)&#123;delete query[key]&#125;),this&#125;,toString:function()&#123;return exports.stringify(this)&#125;&#125;,&#123;parse:function(url)&#123;var ret=&#123;protocol:&quot;&quot;,auth:&quot;&quot;,hostname:&quot;&quot;,hash:&quot;&quot;,query:&#123;&#125;,port:&quot;&quot;,pathname:&quot;&quot;,slashes:!1&#125;,rest=trim(url),url=!1,proto=rest.match(regProto);if(proto&amp;&amp;(proto=proto[0],ret.protocol=proto.toLowerCase(),rest=rest.substr(proto.length)),proto&amp;&amp;(url=&quot;//&quot;===rest.substr(0,2))&amp;&amp;(rest=rest.slice(2),ret.slashes=!0),url)&#123;for(var proto=rest,hostEnd=-1,i=0,len=hostEndingChars.length;i&lt;len;i++)&#123;var pos=rest.indexOf(hostEndingChars[i]);-1!==pos&amp;&amp;(-1===hostEnd||pos&lt;hostEnd)&amp;&amp;(hostEnd=pos)&#125;-1&lt;hostEnd&amp;&amp;(proto=rest.slice(0,hostEnd),rest=rest.slice(hostEnd));url=proto.lastIndexOf(&quot;@&quot;),url=(-1!==url&amp;&amp;(ret.auth=decodeURIComponent(proto.slice(0,url)),proto=proto.slice(url+1)),(ret.hostname=proto).match(regPort));url&amp;&amp;(&quot;:&quot;!==(url=url[0])&amp;&amp;(ret.port=url.substr(1)),ret.hostname=proto.substr(0,proto.length-url.length))&#125;proto=rest.indexOf(&quot;#&quot;),-1!==proto&amp;&amp;(ret.hash=rest.substr(proto),rest=rest.slice(0,proto)),url=rest.indexOf(&quot;?&quot;);return-1!==url&amp;&amp;(ret.query=query.parse(rest.substr(url+1)),rest=rest.slice(0,url)),ret.pathname=rest||&quot;/&quot;,ret&#125;,stringify:function(obj)&#123;var ret=obj.protocol+(obj.slashes?&quot;//&quot;:&quot;&quot;)+(obj.auth?encodeURIComponent(obj.auth)+&quot;@&quot;:&quot;&quot;)+obj.hostname+(obj.port?&quot;:&quot;+obj.port:&quot;&quot;)+obj.pathname;return isEmpty(obj.query)||(ret+=&quot;?&quot;+query.stringify(obj.query)),obj.hash&amp;&amp;(ret+=obj.hash),ret&#125;&#125;);var regProto=/^([a-z0-9.+-]+:)/i,regPort=/:[0-9]*$/,hostEndingChars=[&quot;/&quot;,&quot;?&quot;,&quot;#&quot;];module.exports=exports&#125;),isBool=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return!0===val||!1===val&#125;&#125;),Validator=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;className:&quot;Validator&quot;,initialize:function(options)&#123;this._options=options,this._optKeys=keys(options)&#125;,validate:function(obj)&#123;obj=obj||&#123;&#125;;for(var options=this._options,objKeys=this._optKeys,i=0,len=objKeys.length;i&lt;len;i++)&#123;var key=objKeys[i],key=this._validateVal(safeGet(obj,key),options[key],key);if(!0!==key)return key&#125;return!0&#125;,_validateVal:function(val,rules,objKey)&#123;var plugins=exports.plugins;if(isFn(rules))return rules(val);for(var ruleKeys=keys(rules),i=0,len=ruleKeys.length;i&lt;len;i++)&#123;var key=ruleKeys[i],config=rules[key],result=!0,key=(isFn(config)&amp;&amp;(result=config(val,objKey)),plugins[key]);if(!0!==(result=key?key(val,objKey,config):result))return result&#125;return!0&#125;&#125;,&#123;plugins:&#123;required:function(val,key,config)&#123;return!config||!isUndef(val)||key+&quot; is required&quot;&#125;,number:function(val,key,config)&#123;return!(config&amp;&amp;!isUndef(val)&amp;&amp;!isNum(val))||key+&quot; should be a number&quot;&#125;,boolean:function(val,key,config)&#123;return!(config&amp;&amp;!isUndef(val)&amp;&amp;!isBool(val))||key+&quot; should be a boolean&quot;&#125;,string:function(val,key,config)&#123;return!(config&amp;&amp;!isUndef(val)&amp;&amp;!isStr(val))||key+&quot; should be a string&quot;&#125;,regexp:function(val,key,config)&#123;return!(isStr(val)&amp;&amp;!config.test(val))||key+&quot; should match given regexp &quot;+config.toString()&#125;&#125;,addPlugin:function(name,plugin)&#123;exports.plugins[name]=plugin&#125;&#125;),module.exports=exports&#125;),max=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var arr=arguments,ret=arr[0],i=1,len=arr.length;i&lt;len;i++)ret&lt;arr[i]&amp;&amp;(ret=arr[i]);return ret&#125;&#125;),gcd=createCommonjsModule(function(module,exports)&#123;module.exports=exports=function(a,b)&#123;return 0===b?a:exports(b,a%b)&#125;&#125;),Wrr=createCommonjsModule(function(module,exports)&#123;exports=Class(&#123;initialize:function()&#123;this._peers=[]&#125;,set:function(val,weight)&#123;for(var peers=this._peers,size=this.size,i=0;i&lt;size;i++)&#123;var peer=peers[i];if(peer.val===val)return peer.weight=weight,void this._reset()&#125;peers.push(&#123;val:val,weight:weight&#125;),this._reset()&#125;,get:function(val)&#123;for(var peers=this._peers,size=this.size,i=0;i&lt;size;i++)&#123;var peer=peers[i];if(peer.val===val)return peer.weight&#125;&#125;,remove:function(val)&#123;this._peers=filter(this._peers,function(peer)&#123;return peer.val!==val&#125;),this._reset()&#125;,next:function()&#123;var peers=this._peers,size=this.size;if(0!==size)for(;;)&#123;if(this._i=(this._i+1)%size,0===this._i&amp;&amp;(this._cw=this._cw-this._gcdS,this._cw&lt;=0&amp;&amp;(this._cw=this._maxS)),0===this._cw)return;if(peers[this._i].weight&gt;=this._cw)return peers[this._i].val&#125;&#125;,clear:function()&#123;this._peers=[],this._reset()&#125;,_reset:function()&#123;var peers=this._peers,peers=(this.size=peers.length,map(peers,function(peer)&#123;return peer.weight&#125;));this._i=-1,this._cw=0,this._maxS=max.apply(null,peers),this._gcdS=reduce(peers,function(prev,weight)&#123;return gcd(prev,weight)&#125;,0)&#125;&#125;),module.exports=exports&#125;),abbrev=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(names)&#123;for(var ret=&#123;&#125;,idleMap=&#123;&#125;,i=0,len=(names=names.sort(isSorted.defComparator)).length;i&lt;len;i++)&#123;var str=names[i],nextStr=names[i+1]||&quot;&quot;;if(str!==nextStr)for(var start=!1,abbrev=&quot;&quot;,j=0,strLen=str.length;j&lt;strLen;j++)abbrev+=str[j],(start=start||str[j]===nextStr[j]&amp;&amp;j!==strLen-1?start:!0)?ret[abbrev]||idleMap[abbrev]||(ret[abbrev]=str):idleMap[abbrev]=str&#125;return ret&#125;),module.exports=exports&#125;),after=createCommonjsModule(function(module,exports)&#123;module.exports=function(n,fn)&#123;return function()&#123;if(--n&lt;1)return fn.apply(this,arguments)&#125;&#125;&#125;),ajax=createCommonjsModule(function(module,exports)&#123;function parseArgs(url,data,success,dataType)&#123;return isFn(data)&amp;&amp;(dataType=success,success=data,data=&#123;&#125;),&#123;url:url,data:data,success:success,dataType:dataType&#125;&#125;(exports=function(options)&#123;defaults(options,exports.setting);var abortTimeout,type=options.type,url=options.url,data=options.data,dataType=options.dataType,success=options.success,error=options.error,timeout=options.timeout,complete=options.complete,xhr=options.xhr();return xhr.onreadystatechange=function()&#123;if(4===xhr.readyState)&#123;clearTimeout(abortTimeout);var status=xhr.status;if(200&lt;=status&amp;&amp;status&lt;300||304===status)&#123;status=xhr.responseText,&quot;xml&quot;===dataType&amp;&amp;(status=xhr.responseXML);try&#123;&quot;json&quot;===dataType&amp;&amp;(status=JSON.parse(status))&#125;catch(e)&#123;&#125;success(status,xhr)&#125;else error(xhr);complete(xhr)&#125;&#125;,&quot;GET&quot;===type?(data=query.stringify(data),url+=-1&lt;url.indexOf(&quot;?&quot;)?&quot;&amp;&quot;+data:&quot;?&quot;+data):&quot;application/x-www-form-urlencoded&quot;===options.contentType?isObj(data)&amp;&amp;(data=query.stringify(data)):&quot;application/json&quot;===options.contentType&amp;&amp;isObj(data)&amp;&amp;(data=JSON.stringify(data)),xhr.open(type,url,!0),xhr.setRequestHeader(&quot;Content-Type&quot;,options.contentType),0&lt;timeout&amp;&amp;(abortTimeout=setTimeout(function()&#123;xhr.onreadystatechange=noop,xhr.abort(),error(xhr,&quot;timeout&quot;),complete(xhr)&#125;,timeout)),xhr.send(&quot;GET&quot;===type?null:data),xhr&#125;).setting=&#123;type:&quot;GET&quot;,success:noop,error:noop,complete:noop,dataType:&quot;json&quot;,contentType:&quot;application/x-www-form-urlencoded&quot;,data:&#123;&#125;,xhr:function()&#123;return new XMLHttpRequest&#125;,timeout:0&#125;,exports.get=function()&#123;return exports(parseArgs.apply(null,arguments))&#125;,exports.post=function()&#123;var options=parseArgs.apply(null,arguments);return options.type=&quot;POST&quot;,exports(options)&#125;,module.exports=exports&#125;),ajax_1=ajax.setting,ajax_2=ajax.get,ajax_3=ajax.post,arrToMap=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,val)&#123;isUndef(val)&amp;&amp;(val=!0);var _isFn=isFn(val),ret=&#123;&#125;;return each(arr,function(key)&#123;ret[key]=_isFn?val(key):val&#125;),ret&#125;&#125;),base64=createCommonjsModule(function(module,exports)&#123;exports=&#123;encode:function(bytes)&#123;var ret=[],len=bytes.length,remain=len%3;len-=remain;for(var num,tmp,i=0;i&lt;len;i+=3)ret.push((num=(bytes[i]&lt;&lt;16)+(bytes[i+1]&lt;&lt;8)+bytes[i+2],code[num&gt;&gt;18&amp;63]+code[num&gt;&gt;12&amp;63]+code[num&gt;&gt;6&amp;63]+code[63&amp;num]));return len=bytes.length,1==remain?(tmp=bytes[len-1],ret.push(code[tmp&gt;&gt;2]),ret.push(code[tmp&lt;&lt;4&amp;63]),ret.push(&quot;==&quot;)):2==remain&amp;&amp;(tmp=(bytes[len-2]&lt;&lt;8)+bytes[len-1],ret.push(code[tmp&gt;&gt;10]),ret.push(code[tmp&gt;&gt;4&amp;63]),ret.push(code[tmp&lt;&lt;2&amp;63]),ret.push(&quot;=&quot;)),ret.join(&quot;&quot;)&#125;,decode:function(str)&#123;for(var str2,str3,str4,tmp,remain=0,ret=(&quot;=&quot;===str[(len=str.length)-2]?remain=2:&quot;=&quot;===str[len-1]&amp;&amp;(remain=1),new Array(3*len/4-remain)),len=0&lt;remain?len-4:len,i=0,j=0;i&lt;len;i+=4)&#123;str1=str[i],str2=str[i+1],str3=str[i+2],str4=str[i+3];var str1=codeMap[str1.charCodeAt(0)]&lt;&lt;18|codeMap[str2.charCodeAt(0)]&lt;&lt;12|codeMap[str3.charCodeAt(0)]&lt;&lt;6|codeMap[str4.charCodeAt(0)];ret[j++]=str1&gt;&gt;16&amp;255,ret[j++]=str1&gt;&gt;8&amp;255,ret[j++]=255&amp;str1&#125;return 2===remain?(tmp=codeMap[str.charCodeAt(i)]&lt;&lt;2|codeMap[str.charCodeAt(i+1)]&gt;&gt;4,ret[j++]=255&amp;tmp):1===remain&amp;&amp;(tmp=codeMap[str.charCodeAt(i)]&lt;&lt;10|codeMap[str.charCodeAt(i+1)]&lt;&lt;4|codeMap[str.charCodeAt(i+2)]&gt;&gt;2,ret[j++]=tmp&gt;&gt;8&amp;255,ret[j++]=255&amp;tmp),ret&#125;&#125;;for(var codeMap=[],code=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;,i=0,len=code.length;i&lt;len;i++)codeMap[code.charCodeAt(i)]=i;module.exports=exports&#125;),atob=createCommonjsModule(function(module,exports)&#123;exports=isNode?function(str)&#123;return new Buffer(str,&quot;base64&quot;).toString(&quot;binary&quot;)&#125;:root.atob||function(str)&#123;return map(base64.decode(str),function(c)&#123;return String.fromCharCode(c)&#125;).join(&quot;&quot;)&#125;,module.exports=exports&#125;),binarySearch=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,val)&#123;for(var cmp=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:isSorted.defComparator,startIdx=0,endIdx=arr.length-1;startIdx&lt;=endIdx;)&#123;var middleIdx=startIdx+Math.floor((endIdx-startIdx)/2),middleVal=arr[middleIdx];if(0===cmp(middleVal,val))return middleIdx;cmp(middleVal,val)&lt;0?startIdx=middleIdx+1:endIdx=middleIdx-1&#125;return-1&#125;&#125;),btoa=createCommonjsModule(function(module,exports)&#123;exports=isNode?function(str)&#123;return new Buffer(str,&quot;binary&quot;).toString(&quot;base64&quot;)&#125;:root.btoa||function(str)&#123;return base64.encode(map(str,function(c)&#123;return c.charCodeAt(0)&#125;))&#125;,module.exports=exports&#125;),bubbleSort=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator,i=0,len=arr.length;i&lt;len;i++)for(var j=i;0&lt;j;j--)cmp(arr[j],arr[j-1])&lt;0&amp;&amp;swap(arr,j,j-1);return arr&#125;&#125;),chunk=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,size)&#123;var ret=[];size=size||1;for(var i=0,len=Math.ceil(arr.length/size);i&lt;len;i++)&#123;var start=i*size;ret.push(arr.slice(start,start+size))&#125;return ret&#125;&#125;),ucs2=createCommonjsModule(function(module,exports)&#123;module.exports=&#123;encode:function(arr)&#123;return arr.length&lt;32768?String.fromCodePoint.apply(String,arr):map(chunk(arr,32767),function(nums)&#123;return String.fromCodePoint.apply(String,nums)&#125;).join(&quot;&quot;)&#125;,decode:function(str)&#123;for(var ret=[],i=0,len=str.length;i&lt;len;)&#123;var tail,c=str.charCodeAt(i++);55296&lt;=c&amp;&amp;c&lt;=56319&amp;&amp;i&lt;len?56320==(64512&amp;(tail=str.charCodeAt(i++)))?ret.push(((1023&amp;c)&lt;&lt;10)+(1023&amp;tail)+65536):(ret.push(c),i--):ret.push(c)&#125;return ret&#125;&#125;&#125;),utf8=createCommonjsModule(function(module,exports)&#123;var byteArr,byteIdx,byteCount,codePoint,bytesSeen,bytesNeeded,lowerBoundary,upperBoundary,fromCharCode=String.fromCharCode;function goBack()&#123;var start=byteIdx-bytesSeen-1;return byteIdx=1+start,bytesSeen=bytesNeeded=codePoint=0,lowerBoundary=128,upperBoundary=191,byteArr[start]&#125;module.exports=&#123;encode:function(str)&#123;for(var codePoints=ucs2.decode(str),byteArr=&quot;&quot;,i=0,len=codePoints.length;i&lt;len;i++)byteArr+=function(codePoint)&#123;if(0==(4294967168&amp;codePoint))return fromCharCode(codePoint);var count,offset,ret=&quot;&quot;;0==(4294965248&amp;codePoint)?(count=1,offset=192):0==(4294901760&amp;codePoint)?(count=2,offset=224):0==(4292870144&amp;codePoint)&amp;&amp;(count=3,offset=240);ret+=fromCharCode((codePoint&gt;&gt;6*count)+offset);for(;0&lt;count;)ret+=fromCharCode(128|63&amp;codePoint&gt;&gt;6*(count-1)),count--;return ret&#125;(codePoints[i]);return byteArr&#125;,decode:function(str,safe)&#123;byteArr=ucs2.decode(str),byteIdx=0,byteCount=byteArr.length,bytesNeeded=bytesSeen=codePoint=0,lowerBoundary=128,upperBoundary=191;for(var tmp,codePoints=[];!1!==(tmp=function(safe)&#123;for(;;)&#123;if(byteCount&lt;=byteIdx&amp;&amp;bytesNeeded)&#123;if(safe)return goBack();throw new Error(&quot;Invalid byte index&quot;)&#125;if(byteIdx===byteCount)return!1;var tmp,byte=byteArr[byteIdx];if(byteIdx++,bytesNeeded)&#123;if(byte&lt;lowerBoundary||upperBoundary&lt;byte)&#123;if(safe)return byteIdx--,goBack();throw new Error(&quot;Invalid continuation byte&quot;)&#125;if(lowerBoundary=128,upperBoundary=191,codePoint=codePoint&lt;&lt;6|63&amp;byte,++bytesSeen===bytesNeeded)return tmp=codePoint,bytesSeen=bytesNeeded=codePoint=0,tmp&#125;else&#123;if(0==(128&amp;byte))return byte;if(192==(224&amp;byte))bytesNeeded=1,codePoint=31&amp;byte;else if(224==(240&amp;byte))224===byte&amp;&amp;(lowerBoundary=160),237===byte&amp;&amp;(upperBoundary=159),bytesNeeded=2,codePoint=15&amp;byte;else&#123;if(240!=(248&amp;byte))&#123;if(safe)return goBack();throw new Error(&quot;Invalid UTF-8 detected&quot;)&#125;240===byte&amp;&amp;(lowerBoundary=144),244===byte&amp;&amp;(upperBoundary=143),bytesNeeded=3,codePoint=7&amp;byte&#125;&#125;&#125;&#125;(safe));)codePoints.push(tmp);return ucs2.encode(codePoints)&#125;&#125;&#125;),bytesToStr=createCommonjsModule(function(module,exports)&#123;module.exports=function(bytes)&#123;var encoding=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&quot;utf8&quot;;if(&quot;hex&quot;===encoding)return hex.encode(bytes);if(&quot;base64&quot;===encoding)return base64.encode(bytes);for(var str=[],i=0,len=bytes.length;i&lt;len;i++)str.push(String.fromCharCode(bytes[i]));return str=str.join(&quot;&quot;),str=&quot;utf8&quot;===encoding?utf8.decode(str):str&#125;&#125;),bytesToWords=createCommonjsModule(function(module,exports)&#123;module.exports=function(bytes)&#123;for(var words=[],i=0,len=bytes.length;i&lt;len;i++)words[i&gt;&gt;&gt;2]|=bytes[i]&lt;&lt;24-i%4*8;return words&#125;&#125;),callbackify=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn)&#123;return restArgs(function(args)&#123;var cb=args.pop();fn.apply(this,args).then(function(value)&#123;cb(null,value)&#125;,function(err)&#123;null===err&amp;&amp;(err=new Error),cb(err)&#125;)&#125;)&#125;&#125;),capitalize=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return str.charAt(0).toUpperCase()+str.substring(1).toLowerCase()&#125;&#125;),size=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;return(isArrLike(obj)?obj:keys(obj)).length&#125;&#125;),longest=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;if(!(arr.length&lt;1))&#123;for(var ret=arr[0],retSize=size(arr[0]),i=1,len=arr.length;i&lt;len;i++)&#123;var elSize=size(arr[i]);retSize&lt;elSize&amp;&amp;(ret=arr[i],retSize=elSize)&#125;return ret&#125;&#125;&#125;),lpad=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,len,chars)&#123;var strLen=(str=toStr(str)).length;return chars=chars||&quot; &quot;,str=strLen&lt;len?(repeat(chars,len-strLen)+str).slice(-len):str&#125;&#125;),centerAlign=createCommonjsModule(function(module,exports)&#123;var regLineBreak=/\n/g,floor=Math.floor;module.exports=function(str,width)&#123;var ret=str;return isArr(ret)||(ret=ret.split(regLineBreak)),isUndef(width)&amp;&amp;(width=longest(str)),(ret=map(ret,function(str)&#123;var len=str.length;return lpad(str,floor((width-len)/2)+len)&#125;)).join(&quot;\n&quot;)&#125;&#125;),char_1=createCommonjsModule(function(module,exports)&#123;module.exports=function(num)&#123;return String.fromCodePoint(num)&#125;&#125;),className=createCommonjsModule(function(module,exports)&#123;module.exports=exports=function()&#123;var ret=[];return each(arguments,function(arg)&#123;if(arg)return isStr(arg)||isNum(arg)?ret.push(arg):isArr(arg)?ret.push(exports.apply(null,arg)):void(isObj(arg)&amp;&amp;each(arg,function(val,key)&#123;val&amp;&amp;ret.push(key)&#125;))&#125;),ret.join(&quot; &quot;)&#125;&#125;),_escape=createCommonjsModule(function(module,exports)&#123;var map=(exports=function(str)&#123;return regTest.test(str)?str.replace(regReplace,replaceFn):str&#125;).map=&#123;&quot;&amp;&quot;:&quot;&amp;amp;&quot;,&quot;&lt;&quot;:&quot;&amp;lt;&quot;,&quot;&gt;&quot;:&quot;&amp;gt;&quot;,&apos;&quot;&apos;:&quot;&amp;quot;&quot;,&quot;&apos;&quot;:&quot;&amp;#x27;&quot;,&quot;`&quot;:&quot;&amp;#x60;&quot;&#125;,regSrc=&quot;(?:&quot;+keys(map).join(&quot;|&quot;)+&quot;)&quot;,regTest=new RegExp(regSrc),regReplace=new RegExp(regSrc,&quot;g&quot;),replaceFn=function(match)&#123;return map[match]&#125;;module.exports=exports&#125;),_escape_1=_escape.map,escapeJsStr=createCommonjsModule(function(module,exports)&#123;var regEscapeChars=/[&quot;&apos;\\\n\r\u2028\u2029]/g;module.exports=function(str)&#123;return toStr(str).replace(regEscapeChars,function(char)&#123;switch(char)&#123;case&apos;&quot;&apos;:case&quot;&apos;&quot;:case&quot;\\&quot;:return&quot;\\&quot;+char;case&quot;\n&quot;:return&quot;\\n&quot;;case&quot;\r&quot;:return&quot;\\r&quot;;case&quot;\u2028&quot;:return&quot;\\u2028&quot;;case&quot;\u2029&quot;:return&quot;\\u2029&quot;&#125;&#125;)&#125;&#125;),template=createCommonjsModule(function(module,exports)&#123;var regMatcher=/&lt;%-([\s\S]+?)%&gt;|&lt;%=([\s\S]+?)%&gt;|&lt;%([\s\S]+?)%&gt;|$/g;module.exports=function(str,util)&#123;util?defaults(util,&#123;escape:_escape&#125;):util=&quot;object&quot;==typeof _?_:&#123;escape:_escape&#125;;var index=0,src=&quot;__p+=&apos;&quot;,render=(str.replace(regMatcher,function(match,escape,interpolate,evaluate,offset)&#123;return src+=escapeJsStr(str.slice(index,offset)),index=offset+match.length,escape?src+=&quot;&apos;+\n((__t=(&quot;.concat(escape,&quot;))==null?&apos;&apos;:util.escape(__t))+\n&apos;&quot;):interpolate?src+=&quot;&apos;+\n((__t=(&quot;.concat(interpolate,&quot;))==null?&apos;&apos;:__t)+\n&apos;&quot;):evaluate&amp;&amp;(src+=&quot;&apos;;\n&quot;.concat(evaluate,&quot;\n__p+=&apos;&quot;)),match&#125;),src+=&quot;&apos;;\n&quot;,src=&quot;with(obj||&#123;&#125;)&#123;\n&quot;.concat(src,&quot;&#125;\n&quot;),src=&quot;var __t,__p=&apos;&apos;,__j=Array.prototype.join,print=function()&#123;__p+=__j.call(arguments,&apos;&apos;);&#125;;\n&quot;.concat(src,&quot;return __p;\n&quot;),new Function(&quot;obj&quot;,&quot;util&quot;,src));return function(data)&#123;return render.call(null,data,util)&#125;&#125;&#125;),rpad=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,len,chars)&#123;var strLen=(str=toStr(str)).length;return chars=chars||&quot; &quot;,str=strLen&lt;len?(str+repeat(chars,len-strLen)).slice(0,len):str&#125;&#125;),ansiColor=createCommonjsModule(function(module,exports)&#123;function genColor(codes)&#123;const open=`[$&#123;codes[0]&#125;m`,close=`[$&#123;codes[1]&#125;m`;return input=&gt;open+input+close&#125;exports=&#123;black:genColor([0,0]),red:genColor([31,39]),green:genColor([32,39]),yellow:genColor([33,39]),blue:genColor([34,39]),magenta:genColor([35,39]),cyan:genColor([36,39]),white:genColor([37,39]),gray:genColor([90,39]),grey:genColor([90,39]),bgBlack:genColor([40,49]),bgRed:genColor([41,49]),bgGreen:genColor([42,49]),bgYellow:genColor([43,49]),bgBlue:genColor([44,49]),bgMagenta:genColor([45,49]),bgCyan:genColor([46,49]),bgWhite:genColor([47,49]),blackBright:genColor([90,39]),redBright:genColor([91,39]),greenBright:genColor([92,39]),yellowBright:genColor([93,39]),blueBright:genColor([94,39]),magentaBright:genColor([95,39]),cyanBright:genColor([96,39]),whiteBright:genColor([97,39]),bgBlackBright:genColor([100,49]),bgRedBright:genColor([101,49]),bgGreenBright:genColor([102,49]),bgYellowBright:genColor([103,49]),bgBlueBright:genColor([104,49]),bgMagentaBright:genColor([105,49]),bgCyanBright:genColor([106,49]),bgWhiteBright:genColor([107,49])&#125;,module.exports=exports&#125;),cliHelp=createCommonjsModule(function(module,exports)&#123;exports=function(data)&#123;if((data=cloneDeep(data)).usage=toArr(data.usage),data.commands)return cmdNameWidths=map(data.commands,function(command)&#123;return strWidth(command.name)&#125;),data.maxNameWidth=max.apply(null,cmdNameWidths),helpTpl(data);each(data.options,function(option)&#123;option.name=(option.shorthand?&quot;-&quot;+option.shorthand+&quot;, &quot;:&quot;    &quot;)+&quot;--&quot;+option.name&#125;);var cmdNameWidths=map(data.options,function(option)&#123;return strWidth(option.name)&#125;);return data.maxNameWidth=max.apply(null,cmdNameWidths),cmdTpl(data)&#125;;var tplUtil=&#123;each:each,rpad:function(text,len)&#123;return rpad(text,len,&quot; &quot;)&#125;&#125;,cmdTpl=(each([&quot;yellow&quot;,&quot;green&quot;,&quot;cyan&quot;,&quot;red&quot;,&quot;white&quot;,&quot;magenta&quot;],function(color)&#123;tplUtil[color]=function(text)&#123;return ansiColor[color](text)&#125;&#125;),template([&quot;Usage:&quot;,&quot;&quot;,&quot;&lt;% util.each(usage, function (value) &#123; %&gt;  &lt;%=util.cyan(name)%&gt; &lt;%=value%&gt;&lt;%=&apos;\\n&apos;%&gt;&lt;% &#125;); %&gt;&quot;,&quot;&lt;% if (options) &#123; %&gt;Options:&quot;,&quot;&quot;,&quot;&lt;%     util.each(options, function (option) &#123; %&gt;  &lt;%=util.yellow(util.rpad(option.name, maxNameWidth))%&gt; &lt;%=option.desc%&gt;&lt;%=&apos;\\n&apos;%&gt;&lt;% &#125;); %&gt;&quot;,&quot;&lt;% &#125; %&gt;Description:&quot;,&quot;&quot;,&quot;  &lt;%=desc%&gt;&quot;].join(&quot;\n&quot;),tplUtil)),helpTpl=template([&quot;Usage:&quot;,&quot;&quot;,&quot;&lt;% util.each(usage, function (value) &#123; %&gt;  &lt;%=util.cyan(name)%&gt; &lt;%=value%&gt;&lt;%=&apos;\\n&apos;%&gt;&lt;% &#125;); %&gt;&quot;,&quot;Commands:&quot;,&quot;&quot;,&quot;&lt;% util.each(commands, function (command) &#123; %&gt;  &lt;%=util.yellow(util.rpad(command.name, maxNameWidth))%&gt; &lt;%=command.desc%&gt;&lt;%=&apos;\\n&apos;%&gt;&lt;% &#125;); %&gt;&quot;,&quot;Run &apos;&lt;%=util.cyan(name + &apos; help &lt;command&gt;&apos;)%&gt;&apos; for more information on a specific command&quot;].join(&quot;\n&quot;),tplUtil);module.exports=exports&#125;),toNum=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return isNum(val)?val:(isObj(val)&amp;&amp;(temp=isFn(val.valueOf)?val.valueOf():val,val=isObj(temp)?temp+&quot;&quot;:temp),!isStr(val)&amp;&amp;0===val?val:+val);var temp&#125;&#125;),toInt=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return val?(val=toNum(val))-val%1:0===val?val:0&#125;&#125;),cmpVersion=createCommonjsModule(function(module,exports)&#123;module.exports=function(v1,v2)&#123;v1=v1.split(&quot;.&quot;),v2=v2.split(&quot;.&quot;);for(var len=max(v1.length,v2.length),i=0;i&lt;len;i++)&#123;var num1=toInt(v1[i]),num2=toInt(v2[i]);if(num2&lt;num1)return 1;if(num1&lt;num2)return-1&#125;return 0&#125;&#125;),combine=createCommonjsModule(function(module,exports)&#123;module.exports=function(keys,values)&#123;for(var ret=&#123;&#125;,i=0,len=keys.length;i&lt;len;i++)ret[keys[i]]=values[i];return ret&#125;&#125;),compact=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;return filter(arr,function(val)&#123;return!!val&#125;)&#125;&#125;),compose=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(fnList)&#123;return function()&#123;for(var i=fnList.length-1,result=fnList[i].apply(this,arguments);i--;)result=fnList[i].call(this,result);return result&#125;&#125;),module.exports=exports&#125;),loadImg=createCommonjsModule(function(module,exports)&#123;module.exports=function(src,cb)&#123;cb=cb||noop;var img=new Image;img.onload=function()&#123;cb(null,img)&#125;,img.onerror=function(err)&#123;cb(err)&#125;,img.src=src&#125;&#125;),isBlob=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Blob]&quot;===objToStr(val)&#125;&#125;),isFile=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object File]&quot;===objToStr(val)&#125;&#125;),createUrl=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;type:&quot;text/plain&quot;&#125;;module.exports=function(data,options)&#123;return defaults(options=options||&#123;&#125;,defOpts),isBlob(data)||isFile(data)||(data=new Blob$1(toArr(data),options)),URL.createObjectURL(data)&#125;&#125;),compressImg=createCommonjsModule(function(module,exports)&#123;var defOptions=&#123;maxWidth:1/0,maxHeight:1/0,quality:.8&#125;,floor=Math.floor;module.exports=function(file,options,cb)&#123;isFn(options)&amp;&amp;(cb=options,options=&#123;&#125;),cb=cb||noop,defaults(options=options||&#123;&#125;,defOptions),options.mimeType=options.mimeType||file.type,isStr(file)?options.isUrl=!0:file=createUrl(file),loadImg(file,function(err,img)&#123;if(err)return cb(err);!function(img,options,cb)&#123;var canvas=document.createElement(&quot;canvas&quot;),ctx=canvas.getContext(&quot;2d&quot;),width=img.width,height=img.height,ratio=width/height,maxWidth=options.maxWidth,maxHeight=options.maxHeight;options.width||options.height?options.width?(width=options.width,height=width/ratio):options.height&amp;&amp;(height=options.height,width=height*ratio):(maxWidth&lt;width&amp;&amp;(height=(width=maxWidth)/ratio),maxHeight&lt;height&amp;&amp;(width=(height=maxHeight)*ratio));width=floor(width),height=floor(height),canvas.width=width,canvas.height=height,ctx.drawImage(img,0,0,width,height),URL&amp;&amp;options.isUrl&amp;&amp;URL.revokeObjectURL(img.src);if(canvas.toBlob)try&#123;canvas.toBlob(function(file)&#123;cb(null,file)&#125;,options.mimeType,options.quality)&#125;catch(e)&#123;cb(e)&#125;else cb(new Error(&quot;Canvas toBlob is not supported&quot;))&#125;(img,options,cb)&#125;)&#125;&#125;),concat=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var args=toArr(arguments),ret=[],i=0,len=args.length;i&lt;len;i++)ret=ret.concat(toArr(args[i]));return ret&#125;&#125;),isArrBuffer=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object ArrayBuffer]&quot;===objToStr(val)&#125;&#125;),convertBin=createCommonjsModule(function(module,exports)&#123;(exports=function(bin,t)&#123;if(t=lowerCase(t),isStr(bin))result=new Uint8Array(base64.decode(bin));else if(isArrBuffer(bin))bin=bin.slice(0),result=new Uint8Array(bin);else if(isArr(bin))result=new Uint8Array(bin);else if(&quot;uint8array&quot;===type(bin))result=bin.slice(0);else if(isBuffer(bin))for(var result=new Uint8Array(bin.length),i=0;i&lt;bin.length;i++)result[i]=bin[i];if(result)switch(t)&#123;case&quot;base64&quot;:result=base64.encode(result);break;case&quot;arraybuffer&quot;:result=result.buffer;break;case&quot;array&quot;:result=[].slice.call(result);break;case&quot;buffer&quot;:result=Buffer.from(result);break;case&quot;blob&quot;:result=new Blob([result.buffer])&#125;return result&#125;).blobToArrBuffer=function(blob)&#123;return new Promise(function(resolve,reject)&#123;var fileReader=new FileReader;fileReader.onload=function(e)&#123;resolve(e.target.result)&#125;,fileReader.onerror=function(err)&#123;reject(err)&#125;,fileReader.readAsArrayBuffer(blob)&#125;)&#125;,module.exports=exports&#125;),convertBin_1=convertBin.blobToArrBuffer,decodeUriComponent=createCommonjsModule(function(module,exports)&#123;function hexToInt(numStr)&#123;return+(&quot;0x&quot;+numStr)&#125;var regMatcher=/(%[a-f0-9]&#123;2&#125;)+/gi;module.exports=function(str)&#123;try&#123;return decodeURIComponent(str)&#125;catch(e)&#123;var matches=str.match(regMatcher);return matches?(each(matches,function(match)&#123;str=str.replace(match,function(str)&#123;str=str.split(&quot;%&quot;).slice(1);var bytes=map(str,hexToInt);return str=ucs2.encode(bytes),str=utf8.decode(str,!0)&#125;(match))&#125;),str):str&#125;&#125;&#125;),cookie=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;path:&quot;/&quot;&#125;;function setCookie(key,val,options)&#123;var expires;if(!isUndef(val))return options=defaults(options=options||&#123;&#125;,defOpts),isNum(options.expires)&amp;&amp;((expires=new Date).setMilliseconds(expires.getMilliseconds()+864e5*options.expires),options.expires=expires),val=encodeURIComponent(val),key=encodeURIComponent(key),document.cookie=[key,&quot;=&quot;,val,options.expires&amp;&amp;&quot;; expires=&quot;+options.expires.toUTCString(),options.path&amp;&amp;&quot;; path=&quot;+options.path,options.domain&amp;&amp;&quot;; domain=&quot;+options.domain,options.secure?&quot;; secure&quot;:&quot;&quot;].join(&quot;&quot;),exports;for(var cookies=document.cookie?document.cookie.split(&quot;; &quot;):[],result=key?void 0:&#123;&#125;,i=0,len=cookies.length;i&lt;len;i++)&#123;var parts=(c=cookies[i]).split(&quot;=&quot;),name=decodeUriComponent(parts.shift()),c=parts.join(&quot;=&quot;);if(c=decodeUriComponent(c),key===name)&#123;result=c;break&#125;key||(result[name]=c)&#125;return result&#125;exports=&#123;get:setCookie,set:setCookie,remove:function(key,options)&#123;return(options=options||&#123;&#125;).expires=-1,setCookie(key,&quot;&quot;,options)&#125;&#125;,module.exports=exports&#125;),copy=createCommonjsModule(function(module,exports)&#123;module.exports=function(text,cb)&#123;cb=cb||noop;var el=document.createElement(&quot;textarea&quot;),body=document.body;extend(el.style,&#123;fontSize:&quot;12pt&quot;,border:&quot;0&quot;,padding:&quot;0&quot;,margin:&quot;0&quot;,position:&quot;absolute&quot;,left:&quot;-9999px&quot;&#125;),el.value=text,body.appendChild(el),el.setAttribute(&quot;readonly&quot;,&quot;&quot;),el.select(),el.setSelectionRange(0,text.length);try&#123;document.execCommand(&quot;copy&quot;),cb()&#125;catch(e)&#123;cb(e)&#125;finally&#123;body.removeChild(el)&#125;&#125;&#125;),strToBytes=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;var encoding=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&quot;utf8&quot;;if(&quot;hex&quot;===encoding)return hex.decode(str);if(&quot;base64&quot;===encoding)return base64.decode(str);for(var bytes=[],i=0,len=(str=&quot;utf8&quot;===encoding?utf8.encode(str):str).length;i&lt;len;i++)bytes.push(255&amp;str.charCodeAt(i));return bytes&#125;&#125;),crc1=createCommonjsModule(function(module,exports)&#123;(exports=function(input,previous)&#123;return exports.signed(input,previous)&gt;&gt;&gt;0&#125;).signed=function(input,previous)&#123;for(var previous=~~previous,accum=0,i=0,len=(input=isStr(input)?strToBytes(input):input).length;i&lt;len;i++)accum+=input[i];return(previous+=accum%256)%256&#125;,module.exports=exports&#125;),crc1_1=crc1.signed,crc16=createCommonjsModule(function(module,exports)&#123;var TABLE=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];&quot;undefined&quot;!=typeof Int32Array&amp;&amp;(TABLE=new Int32Array(TABLE)),(exports=function(input,previous)&#123;return exports.signed(input,previous)&gt;&gt;&gt;0&#125;).signed=function(input,previous)&#123;for(var crc=~~previous,i=0,len=(input=isStr(input)?strToBytes(input):input).length;i&lt;len;i++)var byte=input[i],crc=65535&amp;(TABLE[255&amp;(crc^byte)]^crc&gt;&gt;8);return crc&#125;,module.exports=exports&#125;),crc16_1=crc16.signed,crc32=createCommonjsModule(function(module,exports)&#123;for(var TABLE=[],n=0;n&lt;256;n++)&#123;for(var c=n,k=0;k&lt;8;k++)1&amp;c?c=3988292384^c&gt;&gt;&gt;1:c&gt;&gt;&gt;=1;TABLE[n]=c&gt;&gt;&gt;0&#125;&quot;undefined&quot;!=typeof Int32Array&amp;&amp;(TABLE=new Int32Array(TABLE)),(exports=function(input,previous)&#123;return exports.signed(input,previous)&gt;&gt;&gt;0&#125;).signed=function(input,previous)&#123;for(var crc=0===previous?0:-1^~~previous,i=0,len=(input=isStr(input)?strToBytes(input):input).length;i&lt;len;i++)var byte=input[i],crc=TABLE[255&amp;(crc^byte)]^crc&gt;&gt;&gt;8;return-1^crc&#125;,module.exports=exports&#125;),crc32_1=crc32.signed,crc8=createCommonjsModule(function(module,exports)&#123;var TABLE=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];&quot;undefined&quot;!=typeof Int32Array&amp;&amp;(TABLE=new Int32Array(TABLE)),(exports=function(input,previous)&#123;return exports.signed(input,previous)&gt;&gt;&gt;0&#125;).signed=function(input,previous)&#123;for(var crc=~~previous,i=0,len=(input=isStr(input)?strToBytes(input):input).length;i&lt;len;i++)var byte=input[i],crc=255&amp;TABLE[255&amp;(crc^byte)];return crc&#125;,module.exports=exports&#125;),crc8_1=crc8.signed,css=createCommonjsModule(function(module,exports)&#123;exports=&#123;parse:function(css)&#123;return new Parser(css).parse()&#125;,stringify:function(stylesheet,options)&#123;return new Compiler(stylesheet,options).compile()&#125;&#125;;var regComments=/(\/\*[\s\S]*?\*\/)/gi,regOpen=/^&#123;\s*/,regClose=/^&#125;/,regWhitespace=/^\s*/,regProperty=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,regValue=/^((?:&apos;(?:\\&apos;|.)*?&apos;|&quot;(?:\\&quot;|.)*?&quot;|\([^)]*?\)|[^&#125;;])+)/,regSelector=/^([^&#123;]+)/,regSemicolon=/^[;\s]*/,regColon=/^:\s*/,regMedia=/^@media *([^&#123;]+)/,regKeyframes=/^@([-\w]+)?keyframes\s*/,regFontFace=/^@font-face\s*/,regSupports=/^@supports *([^&#123;]+)/,regIdentifier=/^([-\w]+)\s*/,regKeyframeSelector=/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/,regComma=/^,\s*/,Parser=Class(&#123;initialize:function(css)&#123;this.input=stripCmt(css),this.open=this._createMatcher(regOpen),this.close=this._createMatcher(regClose),this.whitespace=this._createMatcher(regWhitespace),this.atImport=this._createAtRule(&quot;import&quot;),this.atCharset=this._createAtRule(&quot;charset&quot;),this.atNamespace=this._createAtRule(&quot;namespace&quot;)&#125;,parse:function()&#123;return this.stylesheet()&#125;,stylesheet:function()&#123;return&#123;type:&quot;stylesheet&quot;,rules:this.rules()&#125;&#125;,rules:function()&#123;var rule,rules=[];for(this.whitespace();this.input.length&amp;&amp;&quot;&#125;&quot;!==this.input[0]&amp;&amp;(rule=this.atRule()||this.rule());)rules.push(rule),this.whitespace();return rules&#125;,atRule:function()&#123;if(&quot;@&quot;===this.input[0])return this.atKeyframes()||this.atMedia()||this.atSupports()||this.atImport()||this.atCharset()||this.atNamespace()||this.atFontFace()&#125;,atKeyframes:function()&#123;if(matched=this.match(regKeyframes))&#123;var vendor=matched[1]||&quot;&quot;;if(!(matched=this.match(regIdentifier)))throw Error(&quot;@keyframes missing name&quot;);var matched=matched[1];if(!this.open())throw Error(&quot;@keyframes missing &apos;&#123;&apos;&quot;);for(var keyframe,keyframes=[];keyframe=this.keyframe();)keyframes.push(keyframe);if(!this.close())throw Error(&quot;@keyframes missing &apos;&#125;&apos;&quot;);return&#123;type:&quot;keyframes&quot;,name:matched,vendor:vendor,keyframes:keyframes&#125;&#125;&#125;,keyframe:function()&#123;for(var matched,selector=[];matched=this.match(regKeyframeSelector);)selector.push(matched[1]),this.match(regComma);if(selector.length)return this.whitespace(),&#123;type:&quot;keyframe&quot;,selector:selector.join(&quot;, &quot;),declarations:this.declarations()&#125;&#125;,atSupports:function()&#123;var matched=this.match(regSupports);if(matched)&#123;matched=trim(matched[1]);if(!this.open())throw Error(&quot;@supports missing &apos;&#123;&apos;&quot;);var rules=this.rules();if(!this.close())throw Error(&quot;@supports missing &apos;&#125;&apos;&quot;);return&#123;type:&quot;supports&quot;,supports:matched,rules:rules&#125;&#125;&#125;,atFontFace:function()&#123;if(this.match(regFontFace))&#123;if(!this.open())throw Error(&quot;@font-face missing &apos;&#123;&apos;&quot;);for(var declaration,declarations=[];declaration=this.declaration();)declarations.push(declaration);if(!this.close())throw Error(&quot;@font-face missing &apos;&#125;&apos;&quot;);return&#123;type:&quot;font-face&quot;,declarations:declarations&#125;&#125;&#125;,atMedia:function()&#123;var matched=this.match(regMedia);if(matched)&#123;matched=trim(matched[1]);if(!this.open())throw Error(&quot;@media missing &apos;&#123;&apos;&quot;);this.whitespace();var rules=this.rules();if(!this.close())throw Error(&quot;@media missing &apos;&#125;&apos;&quot;);return&#123;type:&quot;media&quot;,media:matched,rules:rules&#125;&#125;&#125;,rule:function()&#123;var selector=this.selector();if(!selector)throw Error(&quot;missing selector&quot;);return&#123;type:&quot;rule&quot;,selector:selector,declarations:this.declarations()&#125;&#125;,declarations:function()&#123;var declaration,declarations=[];if(!this.open())throw Error(&quot;missing &apos;&#123;&apos;&quot;);for(this.whitespace();declaration=this.declaration();)declarations.push(declaration);if(!this.close())throw Error(&quot;missing &apos;&#125;&apos;&quot;);return this.whitespace(),declarations&#125;,declaration:function()&#123;var property=this.match(regProperty);if(property)&#123;if(property=trim(property[0]),!this.match(regColon))throw Error(&quot;property missing &apos;:&apos;&quot;);var value=this.match(regValue);return this.match(regSemicolon),this.whitespace(),&#123;type:&quot;declaration&quot;,property:property,value:value?trim(value[0]):&quot;&quot;&#125;&#125;&#125;,selector:function()&#123;var matched=this.match(regSelector);if(matched)return trim(matched[0])&#125;,match:function(reg)&#123;reg=reg.exec(this.input);if(reg)return this.input=this.input.slice(reg[0].length),reg&#125;,_createMatcher:function(reg)&#123;var _this=this;return function()&#123;return _this.match(reg)&#125;&#125;,_createAtRule:function(name)&#123;var reg=new RegExp(&quot;^@&quot;+name+&quot;\\s*([^;]+);&quot;);return function()&#123;var ret,matched=this.match(reg);if(matched)return ret=&#123;type:name&#125;,ret[name]=trim(matched[1]),ret&#125;&#125;&#125;),Compiler=Class(&#123;initialize:function(input)&#123;var options=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;;defaults(options,&#123;indent:&quot;  &quot;&#125;),this.input=input,this.indentLevel=0,this.indentation=options.indent&#125;,compile:function()&#123;return this.stylesheet(this.input)&#125;,stylesheet:function(node)&#123;return this.mapVisit(node.rules,&quot;\n\n&quot;)&#125;,media:function(node)&#123;return&quot;@media &quot;+node.media+&quot; &#123;\n&quot;+this.indent(1)+this.mapVisit(node.rules,&quot;\n\n&quot;)+this.indent(-1)+&quot;\n&#125;&quot;&#125;,keyframes:function(node)&#123;return&quot;@&quot;.concat(node.vendor,&quot;keyframes &quot;)+node.name+&quot; &#123;\n&quot;+this.indent(1)+this.mapVisit(node.keyframes,&quot;\n&quot;)+this.indent(-1)+&quot;\n&#125;&quot;&#125;,supports:function(node)&#123;return&quot;@supports &quot;+node.supports+&quot; &#123;\n&quot;+this.indent(1)+this.mapVisit(node.rules,&quot;\n\n&quot;)+this.indent(-1)+&quot;\n&#125;&quot;&#125;,keyframe:function(node)&#123;return this.rule(node)&#125;,mapVisit:function(nodes,delimiter)&#123;for(var str=&quot;&quot;,i=0,len=nodes.length;i&lt;len;i++)&#123;var node=nodes[i];str+=this[camelCase(node.type)](node),delimiter&amp;&amp;i&lt;len-1&amp;&amp;(str+=delimiter)&#125;return str&#125;,fontFace:function(node)&#123;return&quot;@font-face &#123;\n&quot;+this.indent(1)+this.mapVisit(node.declarations,&quot;\n&quot;)+this.indent(-1)+&quot;\n&#125;&quot;&#125;,rule:function(node)&#123;return this.indent()+node.selector+&quot; &#123;\n&quot;+this.indent(1)+this.mapVisit(node.declarations,&quot;\n&quot;)+this.indent(-1)+&quot;\n&quot;+this.indent()+&quot;&#125;&quot;&#125;,declaration:function(node)&#123;return this.indent()+node.property+&quot;: &quot;+node.value+&quot;;&quot;&#125;,import:function(node)&#123;return&quot;@import &quot;.concat(node.import,&quot;;&quot;)&#125;,charset:function(node)&#123;return&quot;@charset &quot;.concat(node.charset,&quot;;&quot;)&#125;,namespace:function(node)&#123;return&quot;@namespace &quot;.concat(node.namespace,&quot;;&quot;)&#125;,indent:function(level)&#123;return level?(this.indentLevel+=level,&quot;&quot;):repeat(this.indentation,this.indentLevel)&#125;&#125;),stripCmt=function(str)&#123;return str.replace(regComments,&quot;&quot;)&#125;;module.exports=exports&#125;),selector=createCommonjsModule(function(module,exports)&#123;var whitespace=&quot;[\\x20\\t\\r\\n\\f]&quot;,identifier=&quot;(?:\\\\[\\da-fA-F]&#123;1,6&#125;&quot;.concat(whitespace,&quot;?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+&quot;),attributes=&quot;\\[&quot;.concat(whitespace,&quot;*(&quot;).concat(identifier,&quot;)(?:&quot;).concat(whitespace,&quot;*([*^$|!~]?=)&quot;).concat(whitespace,&quot;*(?:&apos;((?:\\\\.|[^\\\\&apos;])*)&apos;|\&quot;((?:\\\\.|[^\\\\\&quot;])*)\&quot;|(&quot;).concat(identifier,&quot;))|)&quot;).concat(whitespace,&quot;*\\]&quot;),pseudos=&quot;::?(&quot;.concat(identifier,&quot;)(?:\\(((&apos;((?:\\\\.|[^\\\\&apos;])*)&apos;|\&quot;((?:\\\\.|[^\\\\\&quot;])*)\&quot;)|((?:\\\\.|[^\\\\()[\\]]|&quot;).concat(attributes,&quot;)*)|.*)\\)|)&quot;),regComma=new RegExp(&quot;^&quot;.concat(whitespace,&quot;*,&quot;).concat(whitespace,&quot;*&quot;)),regCombinators=new RegExp(&quot;^&quot;.concat(whitespace,&quot;*([&gt;+~]|&quot;).concat(whitespace,&quot;)&quot;).concat(whitespace,&quot;*&quot;)),matchExpr=&#123;id:&#123;reg:new RegExp(&quot;^#(&quot;.concat(identifier,&quot;)&quot;)),value:function(raw)&#123;return raw.slice(1)&#125;,toStr:function(value)&#123;return&quot;#&quot;.concat(value)&#125;&#125;,class:&#123;reg:new RegExp(&quot;^\\.(&quot;.concat(identifier,&quot;)&quot;)),value:function(raw)&#123;return raw.slice(1)&#125;,toStr:function(value)&#123;return&quot;.&quot;.concat(value)&#125;&#125;,tag:&#123;reg:new RegExp(&quot;^(&quot;.concat(identifier,&quot;|[*])&quot;)),value:identity&#125;,attribute:&#123;reg:new RegExp(&quot;^&quot;.concat(attributes)),value:function(raw)&#123;return raw.slice(1,raw.length-1)&#125;,toStr:function(value)&#123;return&quot;[&quot;.concat(value,&quot;]&quot;)&#125;&#125;,pseudo:&#123;reg:new RegExp(&quot;^&quot;.concat(pseudos)),value:identity&#125;&#125;;each(matchExpr,function(item)&#123;item.value||(item.value=identity),item.toStr||(item.toStr=identity)&#125;),module.exports=&#123;parse:function(selector)&#123;selector=trim(selector);for(var tokens,match,matched,groups=[];selector&amp;&amp;(matched&amp;&amp;!(match=regComma.exec(selector))||(match&amp;&amp;(selector=selector.slice(match[0].length)),tokens=[],groups.push(tokens)),matched=!1,(match=regCombinators.exec(selector))&amp;&amp;(matched=match.shift(),selector=selector.slice(matched.length),matched=(matched=trim(matched))||&quot; &quot;,tokens.push(&#123;value:matched,type:&quot;combinator&quot;&#125;)),each(matchExpr,function(_ref,type)&#123;var reg=_ref.reg,_ref=_ref.value;(match=reg.exec(selector))&amp;&amp;(matched=match.shift(),selector=selector.slice(matched.length),matched=trim(matched),tokens.push(&#123;value:_ref(matched),type:type&#125;))&#125;),matched););return groups&#125;,stringify:function(groups)&#123;return map(groups,function(group)&#123;return(group=map(group,function(_ref2)&#123;var type=_ref2.type,_ref2=_ref2.value;return&quot;combinator&quot;===type?&quot; &quot;===_ref2?_ref2:&quot; &quot;.concat(_ref2,&quot; &quot;):matchExpr[type].toStr(_ref2)&#125;)).join(&quot;&quot;)&#125;).join(&quot;, &quot;)&#125;&#125;&#125;),cssPriority=createCommonjsModule(function(module,exports)&#123;var PSEUDO_ELEMS=[&quot;first-letter&quot;,&quot;last-letter&quot;,&quot;first-line&quot;,&quot;last-line&quot;,&quot;first-child&quot;,&quot;last-child&quot;,&quot;before&quot;,&quot;after&quot;];(exports=function(sel)&#123;var _ref=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,_ref$important=_ref.important,_ref$inlineStyle=_ref.inlineStyle,_ref$inlineStyle=void 0!==_ref$inlineStyle&amp;&amp;_ref$inlineStyle,_ref=_ref.position,ret=[0,0,0,0,0,void 0===_ref?0:_ref],_ref=(void 0!==_ref$important&amp;&amp;_ref$important&amp;&amp;(ret[0]=1),_ref$inlineStyle&amp;&amp;(ret[1]=1),selector.parse(sel)[0]);return each(_ref,function(_ref2)&#123;var type=_ref2.type,value=_ref2.value;switch(type)&#123;case&quot;id&quot;:ret[2]++;break;case&quot;class&quot;:case&quot;attribute&quot;:ret[3]++;break;case&quot;pseudo&quot;:contain(PSEUDO_ELEMS,value.replace(/:/g,&quot;&quot;))?ret[4]++:startWith(value,&quot;::&quot;)||ret[3]++;break;case&quot;tag&quot;:&quot;*&quot;!==value&amp;&amp;ret[4]++&#125;&#125;),ret&#125;).compare=function(p1,p2)&#123;return cmpVersion(p1.join(&quot;.&quot;),p2.join(&quot;.&quot;))&#125;,module.exports=exports&#125;),cssPriority_1=cssPriority.compare,cssSupports=createCommonjsModule(function(module,exports)&#123;exports=memoize(function(name,value)&#123;return isUndef(value)?(name=camelCase(name),!isUndef(style[name])):(style.cssText=&quot;&quot;,style.cssText=name+&quot;:&quot;+value,!!style.length)&#125;,function(name,value)&#123;return name+&quot; &quot;+value&#125;);var style=document.createElement(&quot;p&quot;).style;module.exports=exports&#125;),curry=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn)&#123;var len=fn.length;return function curriedFn()&#123;var args=toArr(arguments);return args.length&lt;len?function()&#123;return curriedFn.apply(null,args.concat(toArr(arguments)))&#125;:fn.apply(null,args)&#125;&#125;&#125;),isDate=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Date]&quot;===objToStr(val)&#125;&#125;),dateFormat=createCommonjsModule(function(module,exports)&#123;var padZero=function(str)&#123;var len=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:2;return lpad(toStr(str),len,&quot;0&quot;)&#125;,regToken=/d&#123;1,4&#125;|m&#123;1,4&#125;|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|&quot;[^&quot;]*&quot;|&apos;[^&apos;]*&apos;/g,regTimezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d&#123;4&#125;)?)\b/g,regNum=/\d/,regTimezoneClip=/[^-+\dA-Z]/g;(exports=function(date,mask,utc,gmt)&#123;1===arguments.length&amp;&amp;isStr(date)&amp;&amp;!regNum.test(date)&amp;&amp;(mask=date,date=void 0),date=date||new Date,isDate(date)||(date=new Date(date));var maskSlice=(mask=toStr(exports.masks[mask]||mask||exports.masks.default)).slice(0,4),maskSlice=(&quot;UTC:&quot;!==maskSlice&amp;&amp;&quot;GMT:&quot;!==maskSlice||(mask=mask.slice(4),utc=!0,&quot;GMT:&quot;===maskSlice&amp;&amp;(gmt=!0)),utc?&quot;getUTC&quot;:&quot;get&quot;),d=date[maskSlice+&quot;Date&quot;](),D=date[maskSlice+&quot;Day&quot;](),m=date[maskSlice+&quot;Month&quot;](),y=date[maskSlice+&quot;FullYear&quot;](),H=date[maskSlice+&quot;Hours&quot;](),M=date[maskSlice+&quot;Minutes&quot;](),s=date[maskSlice+&quot;Seconds&quot;](),maskSlice=date[maskSlice+&quot;Milliseconds&quot;](),o=utc?0:date.getTimezoneOffset(),flags=&#123;d:d,dd:padZero(d),ddd:exports.i18n.dayNames[D],dddd:exports.i18n.dayNames[D+7],m:m+1,mm:padZero(m+1),mmm:exports.i18n.monthNames[m],mmmm:exports.i18n.monthNames[m+12],yy:toStr(y).slice(2),yyyy:y,h:H%12||12,hh:padZero(H%12||12),H:H,HH:padZero(H),M:M,MM:padZero(M),s:s,ss:padZero(s),l:padZero(maskSlice,3),L:padZero(Math.round(maskSlice/10)),t:H&lt;12?&quot;a&quot;:&quot;p&quot;,tt:H&lt;12?&quot;am&quot;:&quot;pm&quot;,T:H&lt;12?&quot;A&quot;:&quot;P&quot;,TT:H&lt;12?&quot;AM&quot;:&quot;PM&quot;,Z:gmt?&quot;GMT&quot;:utc?&quot;UTC&quot;:(toStr(date).match(regTimezone)||[&quot;&quot;]).pop().replace(regTimezoneClip,&quot;&quot;),o:(0&lt;o?&quot;-&quot;:&quot;+&quot;)+padZero(100*Math.floor(Math.abs(o)/60)+Math.abs(o)%60,4),S:[&quot;th&quot;,&quot;st&quot;,&quot;nd&quot;,&quot;rd&quot;][3&lt;d%10?0:(d%100-d%10!=10)*d%10]&#125;;return mask.replace(regToken,function(match)&#123;return match in flags?flags[match]:match.slice(1,match.length-1)&#125;)&#125;).masks=&#123;default:&quot;ddd mmm dd yyyy HH:MM:ss&quot;,shortDate:&quot;m/d/yy&quot;,mediumDate:&quot;mmm d, yyyy&quot;,longDate:&quot;mmmm d, yyyy&quot;,fullDate:&quot;dddd, mmmm d, yyyy&quot;,shortTime:&quot;h:MM TT&quot;,mediumTime:&quot;h:MM:ss TT&quot;,longTime:&quot;h:MM:ss TT Z&quot;,isoDate:&quot;yyyy-mm-dd&quot;,isoTime:&quot;HH:MM:ss&quot;,isoDateTime:&quot;yyyy-mm-dd&apos;T&apos;HH:MM:sso&quot;,isoUtcDateTime:&quot;UTC:yyyy-mm-dd&apos;T&apos;HH:MM:ss&apos;Z&apos;&quot;,expiresHeaderFormat:&quot;ddd, dd mmm yyyy HH:MM:ss Z&quot;&#125;,exports.i18n=&#123;dayNames:[&quot;Sun&quot;,&quot;Mon&quot;,&quot;Tue&quot;,&quot;Wed&quot;,&quot;Thu&quot;,&quot;Fri&quot;,&quot;Sat&quot;,&quot;Sunday&quot;,&quot;Monday&quot;,&quot;Tuesday&quot;,&quot;Wednesday&quot;,&quot;Thursday&quot;,&quot;Friday&quot;,&quot;Saturday&quot;],monthNames:[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;,&quot;January&quot;,&quot;February&quot;,&quot;March&quot;,&quot;April&quot;,&quot;May&quot;,&quot;June&quot;,&quot;July&quot;,&quot;August&quot;,&quot;September&quot;,&quot;October&quot;,&quot;November&quot;,&quot;December&quot;]&#125;,module.exports=exports&#125;),dateFormat_1=dateFormat.masks,dateFormat_2=dateFormat.i18n,debounce=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,wait,immediate)&#123;var timeout;return function()&#123;var ctx=this,args=arguments;immediate||clearTimeout(timeout),immediate&amp;&amp;timeout||(timeout=setTimeout(function()&#123;timeout=null,fn.apply(ctx,args)&#125;,wait))&#125;&#125;&#125;),format=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(str,values)&#123;for(var ret=&quot;&quot;,i=0,len=str.length;i&lt;len;i++)&#123;var c=str[i];if(&quot;%&quot;===c&amp;&amp;0!==values.length)&#123;i++;var val=values.shift();switch(str[i])&#123;case&quot;i&quot;:case&quot;d&quot;:ret+=toInt(val);break;case&quot;f&quot;:ret+=toNum(val);break;case&quot;s&quot;:ret+=toStr(val);break;case&quot;o&quot;:ret+=function(obj)&#123;try&#123;return JSON.stringify(obj)&#125;catch(err)&#123;return&quot;[Error Stringify]&quot;&#125;&#125;(val);break;default:i--,values.unshift(val),ret+=c&#125;&#125;else ret+=c&#125;return ret&#125;),module.exports=exports&#125;),ms=createCommonjsModule(function(module,exports)&#123;exports=function(str)&#123;var match;if(isStr(str))return(match=str.match(regStrTime))?toNum(match[1])*factor[match[2]||&quot;ms&quot;]:0;for(var num=str,suffix=&quot;ms&quot;,i=0,len=suffixList.length;i&lt;len;i++)if(num&gt;=factor[suffixList[i]])&#123;suffix=suffixList[i];break&#125;return+(num/factor[suffix]).toFixed(2)+suffix&#125;;var factor=&#123;ms:1,s:1e3&#125;,suffixList=(factor.m=60*factor.s,factor.h=60*factor.m,factor.d=24*factor.h,factor.y=365.25*factor.d,[&quot;y&quot;,&quot;d&quot;,&quot;h&quot;,&quot;m&quot;,&quot;s&quot;]),regStrTime=/^((?:\d+)?\.?\d+) *(s|m|h|d|y)?$/;module.exports=exports&#125;),debug=createCommonjsModule(function(module,exports)&#123;var browserColors=[&quot;#0000CC&quot;,&quot;#0000FF&quot;,&quot;#0033CC&quot;,&quot;#0033FF&quot;,&quot;#0066CC&quot;,&quot;#0066FF&quot;,&quot;#0099CC&quot;,&quot;#0099FF&quot;,&quot;#00CC00&quot;,&quot;#00CC33&quot;,&quot;#00CC66&quot;,&quot;#00CC99&quot;,&quot;#00CCCC&quot;,&quot;#00CCFF&quot;,&quot;#3300CC&quot;,&quot;#3300FF&quot;,&quot;#3333CC&quot;,&quot;#3333FF&quot;,&quot;#3366CC&quot;,&quot;#3366FF&quot;,&quot;#3399CC&quot;,&quot;#3399FF&quot;,&quot;#33CC00&quot;,&quot;#33CC33&quot;,&quot;#33CC66&quot;,&quot;#33CC99&quot;,&quot;#33CCCC&quot;,&quot;#33CCFF&quot;,&quot;#6600CC&quot;,&quot;#6600FF&quot;,&quot;#6633CC&quot;,&quot;#6633FF&quot;,&quot;#66CC00&quot;,&quot;#66CC33&quot;,&quot;#9900CC&quot;,&quot;#9900FF&quot;,&quot;#9933CC&quot;,&quot;#9933FF&quot;,&quot;#99CC00&quot;,&quot;#99CC33&quot;,&quot;#CC0000&quot;,&quot;#CC0033&quot;,&quot;#CC0066&quot;,&quot;#CC0099&quot;,&quot;#CC00CC&quot;,&quot;#CC00FF&quot;,&quot;#CC3300&quot;,&quot;#CC3333&quot;,&quot;#CC3366&quot;,&quot;#CC3399&quot;,&quot;#CC33CC&quot;,&quot;#CC33FF&quot;,&quot;#CC6600&quot;,&quot;#CC6633&quot;,&quot;#CC9900&quot;,&quot;#CC9933&quot;,&quot;#CCCC00&quot;,&quot;#CCCC33&quot;,&quot;#FF0000&quot;,&quot;#FF0033&quot;,&quot;#FF0066&quot;,&quot;#FF0099&quot;,&quot;#FF00CC&quot;,&quot;#FF00FF&quot;,&quot;#FF3300&quot;,&quot;#FF3333&quot;,&quot;#FF3366&quot;,&quot;#FF3399&quot;,&quot;#FF33CC&quot;,&quot;#FF33FF&quot;,&quot;#FF6600&quot;,&quot;#FF6633&quot;,&quot;#FF9900&quot;,&quot;#FF9933&quot;,&quot;#FFCC00&quot;,&quot;#FFCC33&quot;],terminalColors=[&quot;black&quot;,&quot;red&quot;,&quot;green&quot;,&quot;yellow&quot;,&quot;blue&quot;,&quot;magenta&quot;,&quot;cyan&quot;,&quot;white&quot;,&quot;gray&quot;,&quot;grey&quot;,&quot;blackBright&quot;,&quot;redBright&quot;,&quot;greenBright&quot;,&quot;yellowBright&quot;,&quot;blueBright&quot;,&quot;magentaBright&quot;,&quot;cyanBright&quot;,&quot;whiteBright&quot;];module.exports=function(name)&#123;var prevTime;function debug()&#123;var duration,cur,args,style;debug.enabled&amp;&amp;(args=toArr(arguments),cur=now(),duration=ms(cur-(prevTime||cur)),prevTime=cur,cur=format.apply(null,args),args=debug.color,isBrowser?(style=&quot;color:&quot;+args,console.log(&quot;%c&quot;+name+&quot; %c&quot;+cur+&quot; %c+&quot;+duration,style,&quot;color:inherit&quot;,style)):console.log(ansiColor[args](name)+&quot;: &quot;+cur+ansiColor[args](&quot; +&quot;+duration)))&#125;return debug.enabled=!0,debug.color=function(name)&#123;name=strHash(name);return isBrowser?browserColors[name%browserColors.length]:terminalColors[name%terminalColors.length]&#125;(name),debug&#125;&#125;),deburr=createCommonjsModule(function(module,exports)&#123;var regComboMark=/[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]/g,regLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,deburredLetters=&#123;&quot;À&quot;:&quot;A&quot;,&quot;Á&quot;:&quot;A&quot;,&quot;Â&quot;:&quot;A&quot;,&quot;Ã&quot;:&quot;A&quot;,&quot;Ä&quot;:&quot;A&quot;,&quot;Å&quot;:&quot;A&quot;,&quot;à&quot;:&quot;a&quot;,&quot;á&quot;:&quot;a&quot;,&quot;â&quot;:&quot;a&quot;,&quot;ã&quot;:&quot;a&quot;,&quot;ä&quot;:&quot;a&quot;,&quot;å&quot;:&quot;a&quot;,&quot;Ç&quot;:&quot;C&quot;,&quot;ç&quot;:&quot;c&quot;,&quot;Ð&quot;:&quot;D&quot;,&quot;ð&quot;:&quot;d&quot;,&quot;È&quot;:&quot;E&quot;,&quot;É&quot;:&quot;E&quot;,&quot;Ê&quot;:&quot;E&quot;,&quot;Ë&quot;:&quot;E&quot;,&quot;è&quot;:&quot;e&quot;,&quot;é&quot;:&quot;e&quot;,&quot;ê&quot;:&quot;e&quot;,&quot;ë&quot;:&quot;e&quot;,&quot;Ì&quot;:&quot;I&quot;,&quot;Í&quot;:&quot;I&quot;,&quot;Î&quot;:&quot;I&quot;,&quot;Ï&quot;:&quot;I&quot;,&quot;ì&quot;:&quot;i&quot;,&quot;í&quot;:&quot;i&quot;,&quot;î&quot;:&quot;i&quot;,&quot;ï&quot;:&quot;i&quot;,&quot;Ñ&quot;:&quot;N&quot;,&quot;ñ&quot;:&quot;n&quot;,&quot;Ò&quot;:&quot;O&quot;,&quot;Ó&quot;:&quot;O&quot;,&quot;Ô&quot;:&quot;O&quot;,&quot;Õ&quot;:&quot;O&quot;,&quot;Ö&quot;:&quot;O&quot;,&quot;Ø&quot;:&quot;O&quot;,&quot;ò&quot;:&quot;o&quot;,&quot;ó&quot;:&quot;o&quot;,&quot;ô&quot;:&quot;o&quot;,&quot;õ&quot;:&quot;o&quot;,&quot;ö&quot;:&quot;o&quot;,&quot;ø&quot;:&quot;o&quot;,&quot;Ù&quot;:&quot;U&quot;,&quot;Ú&quot;:&quot;U&quot;,&quot;Û&quot;:&quot;U&quot;,&quot;Ü&quot;:&quot;U&quot;,&quot;ù&quot;:&quot;u&quot;,&quot;ú&quot;:&quot;u&quot;,&quot;û&quot;:&quot;u&quot;,&quot;ü&quot;:&quot;u&quot;,&quot;Ý&quot;:&quot;Y&quot;,&quot;ý&quot;:&quot;y&quot;,&quot;ÿ&quot;:&quot;y&quot;,&quot;Æ&quot;:&quot;Ae&quot;,&quot;æ&quot;:&quot;ae&quot;,&quot;Þ&quot;:&quot;Th&quot;,&quot;þ&quot;:&quot;th&quot;,&quot;ß&quot;:&quot;ss&quot;,&quot;Ā&quot;:&quot;A&quot;,&quot;Ă&quot;:&quot;A&quot;,&quot;Ą&quot;:&quot;A&quot;,&quot;ā&quot;:&quot;a&quot;,&quot;ă&quot;:&quot;a&quot;,&quot;ą&quot;:&quot;a&quot;,&quot;Ć&quot;:&quot;C&quot;,&quot;Ĉ&quot;:&quot;C&quot;,&quot;Ċ&quot;:&quot;C&quot;,&quot;Č&quot;:&quot;C&quot;,&quot;ć&quot;:&quot;c&quot;,&quot;ĉ&quot;:&quot;c&quot;,&quot;ċ&quot;:&quot;c&quot;,&quot;č&quot;:&quot;c&quot;,&quot;Ď&quot;:&quot;D&quot;,&quot;Đ&quot;:&quot;D&quot;,&quot;ď&quot;:&quot;d&quot;,&quot;đ&quot;:&quot;d&quot;,&quot;Ē&quot;:&quot;E&quot;,&quot;Ĕ&quot;:&quot;E&quot;,&quot;Ė&quot;:&quot;E&quot;,&quot;Ę&quot;:&quot;E&quot;,&quot;Ě&quot;:&quot;E&quot;,&quot;ē&quot;:&quot;e&quot;,&quot;ĕ&quot;:&quot;e&quot;,&quot;ė&quot;:&quot;e&quot;,&quot;ę&quot;:&quot;e&quot;,&quot;ě&quot;:&quot;e&quot;,&quot;Ĝ&quot;:&quot;G&quot;,&quot;Ğ&quot;:&quot;G&quot;,&quot;Ġ&quot;:&quot;G&quot;,&quot;Ģ&quot;:&quot;G&quot;,&quot;ĝ&quot;:&quot;g&quot;,&quot;ğ&quot;:&quot;g&quot;,&quot;ġ&quot;:&quot;g&quot;,&quot;ģ&quot;:&quot;g&quot;,&quot;Ĥ&quot;:&quot;H&quot;,&quot;Ħ&quot;:&quot;H&quot;,&quot;ĥ&quot;:&quot;h&quot;,&quot;ħ&quot;:&quot;h&quot;,&quot;Ĩ&quot;:&quot;I&quot;,&quot;Ī&quot;:&quot;I&quot;,&quot;Ĭ&quot;:&quot;I&quot;,&quot;Į&quot;:&quot;I&quot;,&quot;İ&quot;:&quot;I&quot;,&quot;ĩ&quot;:&quot;i&quot;,&quot;ī&quot;:&quot;i&quot;,&quot;ĭ&quot;:&quot;i&quot;,&quot;į&quot;:&quot;i&quot;,&quot;ı&quot;:&quot;i&quot;,&quot;Ĵ&quot;:&quot;J&quot;,&quot;ĵ&quot;:&quot;j&quot;,&quot;Ķ&quot;:&quot;K&quot;,&quot;ķ&quot;:&quot;k&quot;,&quot;ĸ&quot;:&quot;k&quot;,&quot;Ĺ&quot;:&quot;L&quot;,&quot;Ļ&quot;:&quot;L&quot;,&quot;Ľ&quot;:&quot;L&quot;,&quot;Ŀ&quot;:&quot;L&quot;,&quot;Ł&quot;:&quot;L&quot;,&quot;ĺ&quot;:&quot;l&quot;,&quot;ļ&quot;:&quot;l&quot;,&quot;ľ&quot;:&quot;l&quot;,&quot;ŀ&quot;:&quot;l&quot;,&quot;ł&quot;:&quot;l&quot;,&quot;Ń&quot;:&quot;N&quot;,&quot;Ņ&quot;:&quot;N&quot;,&quot;Ň&quot;:&quot;N&quot;,&quot;Ŋ&quot;:&quot;N&quot;,&quot;ń&quot;:&quot;n&quot;,&quot;ņ&quot;:&quot;n&quot;,&quot;ň&quot;:&quot;n&quot;,&quot;ŋ&quot;:&quot;n&quot;,&quot;Ō&quot;:&quot;O&quot;,&quot;Ŏ&quot;:&quot;O&quot;,&quot;Ő&quot;:&quot;O&quot;,&quot;ō&quot;:&quot;o&quot;,&quot;ŏ&quot;:&quot;o&quot;,&quot;ő&quot;:&quot;o&quot;,&quot;Ŕ&quot;:&quot;R&quot;,&quot;Ŗ&quot;:&quot;R&quot;,&quot;Ř&quot;:&quot;R&quot;,&quot;ŕ&quot;:&quot;r&quot;,&quot;ŗ&quot;:&quot;r&quot;,&quot;ř&quot;:&quot;r&quot;,&quot;Ś&quot;:&quot;S&quot;,&quot;Ŝ&quot;:&quot;S&quot;,&quot;Ş&quot;:&quot;S&quot;,&quot;Š&quot;:&quot;S&quot;,&quot;ś&quot;:&quot;s&quot;,&quot;ŝ&quot;:&quot;s&quot;,&quot;ş&quot;:&quot;s&quot;,&quot;š&quot;:&quot;s&quot;,&quot;Ţ&quot;:&quot;T&quot;,&quot;Ť&quot;:&quot;T&quot;,&quot;Ŧ&quot;:&quot;T&quot;,&quot;ţ&quot;:&quot;t&quot;,&quot;ť&quot;:&quot;t&quot;,&quot;ŧ&quot;:&quot;t&quot;,&quot;Ũ&quot;:&quot;U&quot;,&quot;Ū&quot;:&quot;U&quot;,&quot;Ŭ&quot;:&quot;U&quot;,&quot;Ů&quot;:&quot;U&quot;,&quot;Ű&quot;:&quot;U&quot;,&quot;Ų&quot;:&quot;U&quot;,&quot;ũ&quot;:&quot;u&quot;,&quot;ū&quot;:&quot;u&quot;,&quot;ŭ&quot;:&quot;u&quot;,&quot;ů&quot;:&quot;u&quot;,&quot;ű&quot;:&quot;u&quot;,&quot;ų&quot;:&quot;u&quot;,&quot;Ŵ&quot;:&quot;W&quot;,&quot;ŵ&quot;:&quot;w&quot;,&quot;Ŷ&quot;:&quot;Y&quot;,&quot;ŷ&quot;:&quot;y&quot;,&quot;Ÿ&quot;:&quot;Y&quot;,&quot;Ź&quot;:&quot;Z&quot;,&quot;Ż&quot;:&quot;Z&quot;,&quot;Ž&quot;:&quot;Z&quot;,&quot;ź&quot;:&quot;z&quot;,&quot;ż&quot;:&quot;z&quot;,&quot;ž&quot;:&quot;z&quot;,&quot;Ĳ&quot;:&quot;IJ&quot;,&quot;ĳ&quot;:&quot;ij&quot;,&quot;Œ&quot;:&quot;Oe&quot;,&quot;œ&quot;:&quot;oe&quot;,&quot;ŉ&quot;:&quot;&apos;n&quot;,&quot;ſ&quot;:&quot;s&quot;&#125;;module.exports=function(str)&#123;return str.replace(regLatin,function(key)&#123;return deburredLetters[key]&#125;).replace(regComboMark,&quot;&quot;)&#125;&#125;),define_1=createCommonjsModule(function(module,exports)&#123;var modules=(exports=function(name,requires,method)&#123;2===arguments.length&amp;&amp;(method=requires,requires=[]),function(name,requires,method)&#123;modules[name]=&#123;requires:toArr(requires),body:method&#125;&#125;(name,requires,method)&#125;)._modules=&#123;&#125;;module.exports=exports&#125;),define_2=define_1._modules,defined=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var i=0,len=arguments.length;i&lt;len;i++)if(!isUndef(arguments[i]))return arguments[i]&#125;&#125;),deprecate=createCommonjsModule(function(module,exports)&#123;var localStorage;exports=isNode?eval(&quot;require&quot;)(&quot;util&quot;).deprecate:(localStorage=root.localStorage||memStorage,function(fn,msg)&#123;if(localStorage.getItem(&quot;noDeprecation&quot;))return fn;var warned=!1;function deprecated()&#123;warned||(warned=!0,console.warn(msg));for(var _len=arguments.length,args=new Array(_len),_key=0;_key&lt;_len;_key++)args[_key]=arguments[_key];return fn.apply(this,args)&#125;return Object.setPrototypeOf(deprecated,fn),fn.prototype&amp;&amp;(deprecated.prototype=fn.prototype),deprecated&#125;),module.exports=exports&#125;),detectBrowser=createCommonjsModule(function(module,exports)&#123;exports=function(ua)&#123;var ieVer=getVer(ua=(ua=ua||(isBrowser?navigator.userAgent:&quot;&quot;)).toLowerCase(),&quot;msie &quot;);if(ieVer)return&#123;version:ieVer,name:&quot;ie&quot;&#125;;if(regIe11.test(ua))return&#123;version:11,name:&quot;ie&quot;&#125;;for(var i=0,len=browsers.length;i&lt;len;i++)&#123;var name=browsers[i],match=ua.match(regBrowsers[name]);if(null!=match)return match=toInt(match[1].split(&quot;.&quot;)[0]),&#123;name:name,version:match=&quot;opera&quot;===name?getVer(ua,&quot;version/&quot;)||match:match&#125;&#125;return&#123;name:&quot;unknown&quot;,version:-1&#125;&#125;;var regBrowsers=&#123;edge:/edge\/([0-9._]+)/,firefox:/firefox\/([0-9.]+)(?:\s|$)/,opera:/opera\/([0-9.]+)(?:\s|$)/,android:/android\s([0-9.]+)/,ios:/version\/([0-9._]+).*mobile.*safari.*/,safari:/version\/([0-9._]+).*safari/,chrome:/(?!chrom.*opr)chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/&#125;,regIe11=/trident\/7\./,browsers=keys(regBrowsers);function getVer(ua,mark)&#123;var idx=ua.indexOf(mark);if(-1&lt;idx)return toInt(ua.substring(idx+mark.length,ua.indexOf(&quot;.&quot;,idx)))&#125;module.exports=exports&#125;),detectMocha=createCommonjsModule(function(module,exports)&#123;var methods=[&quot;afterEach&quot;,&quot;after&quot;,&quot;beforeEach&quot;,&quot;before&quot;,&quot;describe&quot;,&quot;it&quot;];module.exports=function()&#123;for(var i=0,len=methods.length;i&lt;len;i++)&#123;var method=methods[i];if(&quot;function&quot;!=typeof root[method])return!1&#125;return!0&#125;&#125;),detectOs=createCommonjsModule(function(module,exports)&#123;module.exports=function(ua)&#123;return ua=(ua=ua||(isBrowser?navigator.userAgent:&quot;&quot;)).toLowerCase(),detect(&quot;windows phone&quot;)?&quot;windows phone&quot;:detect(&quot;win&quot;)?&quot;windows&quot;:detect(&quot;android&quot;)?&quot;android&quot;:detect(&quot;ipad&quot;)||detect(&quot;iphone&quot;)||detect(&quot;ipod&quot;)?&quot;ios&quot;:detect(&quot;mac&quot;)?&quot;os x&quot;:detect(&quot;linux&quot;)?&quot;linux&quot;:&quot;unknown&quot;;function detect(keyword)&#123;return-1&lt;ua.indexOf(keyword)&#125;&#125;&#125;),flatten=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;return function flat(arr,res)&#123;var cur,len=arr.length,i=-1;for(;len--;)cur=arr[++i],isArr(cur)?flat(cur,res):res.push(cur);return res&#125;(arr,[])&#125;&#125;),difference=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(arr,args)&#123;return args=flatten(args),filter(arr,function(val)&#123;return!contain(args,val)&#125;)&#125;),module.exports=exports&#125;),dotCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return splitCase(str).join(&quot;.&quot;)&#125;&#125;),download=createCommonjsModule(function(module,exports)&#123;module.exports=function(data,name,type)&#123;type=type||&quot;text/plain&quot;;var el=document.createElement(&quot;a&quot;);el.setAttribute(&quot;href&quot;,createUrl(data,&#123;type:type&#125;)),el.setAttribute(&quot;download&quot;,name),el.addEventListener(&quot;click&quot;,function(e)&#123;e.stopImmediatePropagation()&#125;),document.body.appendChild(el),el.click(),document.body.removeChild(el)&#125;&#125;),durationFormat=createCommonjsModule(function(module,exports)&#123;var floor=Math.floor,padZero=function(str)&#123;var len=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:2;return lpad(toStr(str),len,&quot;0&quot;)&#125;,regToken=/d&#123;1,2&#125;|h&#123;1,2&#125;|m&#123;1,2&#125;|s&#123;1,2&#125;|l&#123;1,2&#125;|&quot;[^&quot;]*&quot;|&apos;[^&apos;]*&apos;/g;module.exports=function(duration)&#123;var mask=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&quot;hh:mm:ss&quot;,d=(duration=toInt(duration),floor(duration/864e5)),h=floor(duration/36e5)%24,m=floor(duration/6e4)%60,s=floor(duration/1e3)%60,l=floor(duration)%1e3,flags=&#123;d:d,h:h,hh:padZero(h),m:m,mm:padZero(m),s:s,ss:padZero(s),l:l,ll:padZero(l,3)&#125;;return mask.replace(regToken,function(match)&#123;return match in flags?flags[match]:match.slice(1,match.length-1)&#125;)&#125;&#125;),trigger=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;bubbles:!0,cancelable:!0&#125;;module.exports=function(el,type,opts)&#123;isStr(el)&amp;&amp;(opts=type,type=el,el=document),defaults(opts=opts||&#123;&#125;,defOpts);var event=document.createEvent(&quot;Event&quot;);event.initEvent(type,opts.bubbles,opts.cancelable),delete opts.bubbles,delete opts.cancelable,extend(event,opts),el.dispatchEvent(event)&#125;&#125;),emulateTouch=createCommonjsModule(function(module,exports)&#123;var hasTouchSupport=&quot;ontouchstart&quot;in root;function onMouse(type)&#123;return function(e)&#123;1===e.which&amp;&amp;trigger(e.target,type,&#123;altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,touches:getActiveTouches(e),targetTouches:getActiveTouches(e),changedTouches:createTouchList(e)&#125;)&#125;&#125;function getActiveTouches(e)&#123;return&quot;mouseup&quot;==e.type?createTouchList():createTouchList(e)&#125;function Touch(target,identifier,pos,deltaX,deltaY)&#123;deltaX=deltaX||0,deltaY=deltaY||0,this.identifier=identifier,this.target=target,this.clientX=pos.clientX+deltaX,this.clientY=pos.clientY+deltaY,this.screenX=pos.screenX+deltaX,this.screenY=pos.screenY+deltaY,this.pageX=pos.pageX+deltaX,this.pageY=pos.pageY+deltaY&#125;function createTouchList(e)&#123;var touchList=[];return touchList.item=function(index)&#123;return this[index]||null&#125;,e&amp;&amp;touchList.push(new Touch(e.target,1,e,0,0)),touchList&#125;module.exports=function()&#123;var el=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:document;hasTouchSupport||el._isEmulated||(el._isEmulated=!0,el.addEventListener(&quot;mousedown&quot;,onMouse(&quot;touchstart&quot;),!0),el.addEventListener(&quot;mousemove&quot;,onMouse(&quot;touchmove&quot;),!0),el.addEventListener(&quot;mouseup&quot;,onMouse(&quot;touchend&quot;),!0))&#125;&#125;),endWith=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,suffix)&#123;var idx=str.length-suffix.length;return 0&lt;=idx&amp;&amp;str.indexOf(suffix,idx)===idx&#125;&#125;),escapeRegExp=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return str.replace(/\W/g,&quot;\\$&amp;&quot;)&#125;&#125;),evalCss=createCommonjsModule(function(module,exports)&#123;module.exports=function(css)&#123;var style=document.createElement(&quot;style&quot;);return style.textContent=css,style.type=&quot;text/css&quot;,document.head.appendChild(style),style&#125;&#125;),evalJs=createCommonjsModule(function(module,exports)&#123;module.exports=function(js,ctx)&#123;ctx=ctx||root;try&#123;return new Function(&quot;return (&quot;+js+&quot;);&quot;).call(ctx)&#125;catch(e)&#123;try&#123;return new Function(&quot;return &quot;+js).call(ctx)&#125;catch(e)&#123;return new Function(js).call(ctx)&#125;&#125;&#125;&#125;),every=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,predicate,ctx)&#123;predicate=safeCb(predicate,ctx);for(var _keys=!isArrLike(obj)&amp;&amp;keys(obj),len=(_keys||obj).length,i=0;i&lt;len;i++)&#123;var curKey=_keys?_keys[i]:i;if(!predicate(obj[curKey],curKey,obj))return!1&#125;return!0&#125;&#125;),isPlainObj=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;if(!isObj(val))return!1;var ctor=val.constructor;return!!isFn(ctor)&amp;&amp;(!!has(ctor.prototype,&quot;isPrototypeOf&quot;)&amp;&amp;(!isArr(val)&amp;&amp;!isFn(val)))&#125;&#125;),extendDeep=createCommonjsModule(function(module,exports)&#123;module.exports=exports=function(obj)&#123;for(var i=0,ret=obj,len=arguments.length;++i&lt;len;)obj=arguments[i],isPlainObj(ret)&amp;&amp;isPlainObj(obj)?each(obj,function(val,key)&#123;&quot;__proto__&quot;!==key&amp;&amp;&quot;constructor&quot;!==key&amp;&amp;&quot;prototype&quot;!==key&amp;&amp;(ret[key]=exports(ret[key],obj[key]))&#125;):ret=cloneDeep(obj);return ret&#125;&#125;),extractBlockCmts=createCommonjsModule(function(module,exports)&#123;var regBlockCmt=/(\/\*[\s\S]*?\*\/)/gm;module.exports=function(str)&#123;str=str.match(regBlockCmt);return str?map(str,function(comment)&#123;return trim(map(comment.split(&quot;\n&quot;),function(line)&#123;return trim(line).replace(/^\/\*+|\*+\/$|^\*+/g,&quot;&quot;)&#125;).join(&quot;\n&quot;))&#125;):[]&#125;&#125;),extractUrls=createCommonjsModule(function(module,exports)&#123;var regUrl=/((https?)|(ftp)):\/\/[\w.]+[^ \f\n\r\t\v&quot;\\&lt;&gt;[\]\u2100-\uFFFF(),]*/gi;module.exports=function(str)&#123;str=toArr(str.match(regUrl));return unique(map(str,function(url)&#123;return trim(url)&#125;))&#125;&#125;),fetch=createCommonjsModule(function(module,exports)&#123;var Promise=root.Promise,regHeaders=/^(.*?):\s*([\s\S]*?)$/gm;(exports=function(url,options)&#123;return defaults(options=options||&#123;&#125;,exports.setting),new Promise(function(resolve,reject)&#123;var xhr=options.xhr(),headers=options.headers,body=options.body,timeout=options.timeout;xhr.withCredentials=&quot;include&quot;==options.credentials,xhr.onload=function()&#123;clearTimeout(void 0),resolve(function getRes(xhr)&#123;var keys=[];var all=[];var headers=&#123;&#125;;var header;xhr.getAllResponseHeaders().replace(regHeaders,function(m,key,val)&#123;key=key.toLowerCase(),keys.push(key),all.push([key,val]),header=headers[key],headers[key]=header?header+&quot;,&quot;+val:val&#125;);return&#123;ok:200&lt;=xhr.status&amp;&amp;xhr.status&lt;400,status:xhr.status,statusText:xhr.statusText,url:xhr.responseURL,clone:function()&#123;return getRes(xhr)&#125;,text:function()&#123;return Promise.resolve(xhr.responseText)&#125;,json:function()&#123;return Promise.resolve(xhr.responseText).then(JSON.parse)&#125;,xml:function()&#123;return Promise.resolve(xhr.responseXML)&#125;,blob:function()&#123;return Promise.resolve(new Blob([xhr.response]))&#125;,headers:&#123;keys:function()&#123;return keys&#125;,entries:function()&#123;return all&#125;,get:function(name)&#123;return headers[name.toLowerCase()]&#125;,has:function(name)&#123;return has(headers,name)&#125;&#125;&#125;&#125;(xhr))&#125;,xhr.onerror=reject,xhr.open(options.method,url,!0),each(headers,function(val,key)&#123;xhr.setRequestHeader(key,val)&#125;),0&lt;timeout&amp;&amp;setTimeout(function()&#123;xhr.onload=noop,xhr.abort(),reject(Error(&quot;timeout&quot;))&#125;,timeout),xhr.send(body)&#125;)&#125;).setting=&#123;method:&quot;GET&quot;,headers:&#123;&#125;,timeout:0,xhr:function()&#123;return new XMLHttpRequest&#125;&#125;,module.exports=exports&#125;),fetch_1=fetch.setting,fibonacci=createCommonjsModule(function(module,exports)&#123;exports=memoize(function(n)&#123;return n&lt;2?n:exports(n-1)+exports(n-2)&#125;),module.exports=exports&#125;),fileSize=createCommonjsModule(function(module,exports)&#123;var suffixList=[&quot;&quot;,&quot;K&quot;,&quot;M&quot;,&quot;G&quot;,&quot;T&quot;];module.exports=function(bytes)&#123;if(bytes&lt;=0)return&quot;0&quot;;var suffixIdx=Math.floor(Math.log(bytes)/Math.log(1024));return+(bytes/Math.pow(2,10*suffixIdx)).toFixed(2)+suffixList[suffixIdx]&#125;&#125;),mime=createCommonjsModule(function(module,exports)&#123;var exts=&#123;&quot;image/jpeg&quot;:[&quot;jpeg&quot;,&quot;jpg&quot;],&quot;image/png&quot;:[&quot;png&quot;],&quot;image/gif&quot;:[&quot;gif&quot;],&quot;image/webp&quot;:[&quot;webp&quot;],&quot;image/tiff&quot;:[&quot;tif&quot;,&quot;tiff&quot;],&quot;image/bmp&quot;:[&quot;bmp&quot;],&quot;image/vnd.adobe.photoshop&quot;:[&quot;psd&quot;],&quot;image/svg+xml&quot;:[&quot;svg&quot;],&quot;audio/mp4&quot;:[&quot;m4a&quot;,&quot;mp4a&quot;],&quot;audio/midi&quot;:[&quot;midi&quot;],&quot;audio/mpeg&quot;:[&quot;mpga&quot;,&quot;mp2&quot;,&quot;mp2a&quot;,&quot;mp3&quot;,&quot;m2a&quot;,&quot;m3a&quot;],&quot;audio/ogg&quot;:[&quot;ogg&quot;],&quot;audio/wav&quot;:[&quot;wav&quot;],&quot;video/mp4&quot;:[&quot;mp4&quot;,&quot;mp4v&quot;,&quot;mpg4&quot;],&quot;video/x-matroska&quot;:[&quot;mkv&quot;],&quot;video/webm&quot;:[&quot;webm&quot;],&quot;video/x-msvideo&quot;:[&quot;avi&quot;],&quot;video/quicktime&quot;:[&quot;qt&quot;,&quot;mov&quot;],&quot;video/mpeg&quot;:[&quot;mpeg&quot;,&quot;mpg&quot;,&quot;mpe&quot;,&quot;m1v&quot;,&quot;m2v&quot;],&quot;video/3gpp&quot;:[&quot;3gp&quot;,&quot;3gpp&quot;],&quot;text/css&quot;:[&quot;css&quot;],&quot;text/html&quot;:[&quot;html&quot;,&quot;htm&quot;,&quot;shtml&quot;],&quot;text/yaml&quot;:[&quot;yaml&quot;,&quot;yml&quot;],&quot;text/csv&quot;:[&quot;csv&quot;],&quot;text/markdown&quot;:[&quot;markdown&quot;,&quot;md&quot;],&quot;text/plain&quot;:[&quot;txt&quot;,&quot;text&quot;,&quot;conf&quot;,&quot;log&quot;,&quot;ini&quot;],&quot;font/ttf&quot;:[&quot;ttf&quot;],&quot;font/woff&quot;:[&quot;woff&quot;],&quot;font/woff2&quot;:[&quot;woff2&quot;],&quot;application/zip&quot;:[&quot;zip&quot;],&quot;application/x-tar&quot;:[&quot;tar&quot;],&quot;application/x-rar-compressed&quot;:[&quot;rar&quot;],&quot;application/gzip&quot;:[&quot;gz&quot;],&quot;application/x-7z-compressed&quot;:[&quot;7z&quot;],&quot;application/octet-stream&quot;:[&quot;bin&quot;,&quot;so&quot;,&quot;exe&quot;,&quot;dll&quot;,&quot;dmg&quot;,&quot;iso&quot;,&quot;msi&quot;],&quot;application/epub+zip&quot;:[&quot;epub&quot;],&quot;application/javascript&quot;:[&quot;js&quot;],&quot;application/json&quot;:[&quot;json&quot;],&quot;application/msword&quot;:[&quot;doc&quot;,&quot;docx&quot;,&quot;dot&quot;,&quot;dotx&quot;],&quot;application/vnd.ms-excel&quot;:[&quot;xls&quot;,&quot;xlsx&quot;,&quot;xla&quot;,&quot;xlt&quot;],&quot;application/vnd.ms-powerpoint&quot;:[&quot;ppt&quot;,&quot;pptx&quot;,&quot;pps&quot;,&quot;pot&quot;],&quot;application/pdf&quot;:[&quot;pdf&quot;],&quot;application/wasm&quot;:[&quot;wasm&quot;],&quot;application/xml&quot;:[&quot;xml&quot;],&quot;application/xml-dtd&quot;:[&quot;dtd&quot;]&#125;,mimeTypes=&#123;&#125;;each(exts,function(ext,mimeType)&#123;each(ext,function(e)&#123;mimeTypes[e]=mimeType&#125;)&#125;),module.exports=function(name)&#123;return(-1&lt;name.indexOf(&quot;/&quot;)?function(name)&#123;if(exts[name])return exts[name][0]&#125;:function(name)&#123;return mimeTypes[name]&#125;)(name)||void 0&#125;&#125;),fileType=createCommonjsModule(function(module,exports)&#123;function _slicedToArray(arr,i)&#123;return function(arr)&#123;if(Array.isArray(arr))return arr&#125;(arr)||function(arr,i)&#123;if(&quot;undefined&quot;!=typeof Symbol&amp;&amp;Symbol.iterator in Object(arr))&#123;var _arr=[],_n=!0,_d=!1,_e=void 0;try&#123;for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&amp;&amp;(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);&#125;catch(err)&#123;_d=!0,_e=err&#125;finally&#123;try&#123;_n||null==_i.return||_i.return()&#125;finally&#123;if(_d)throw _e&#125;&#125;return _arr&#125;&#125;(arr,i)||function(o,minLen)&#123;if(o)&#123;if(&quot;string&quot;==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return&quot;Map&quot;===(n=&quot;Object&quot;===n&amp;&amp;o.constructor?o.constructor.name:n)||&quot;Set&quot;===n?Array.from(o):&quot;Arguments&quot;===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0&#125;&#125;(arr,i)||function()&#123;throw new TypeError(&quot;Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.&quot;)&#125;()&#125;function _arrayLikeToArray(arr,len)&#123;(null==len||len&gt;arr.length)&amp;&amp;(len=arr.length);for(var i=0,arr2=new Array(len);i&lt;len;i++)arr2[i]=arr[i];return arr2&#125;var types=[[&quot;jpg&quot;,[255,216,255]],[&quot;png&quot;,[137,80,78,71,13,10,26,10]],[&quot;gif&quot;,[71,73,70]],[&quot;webp&quot;,[87,69,66,80],8],[&quot;bmp&quot;,[66,77]],[&quot;gz&quot;,[31,139,8]],[&quot;zip&quot;,function(input)&#123;return check(input,[80,75])&amp;&amp;(3===input[2]||5===input[2]||7===input[2])&amp;&amp;(4===input[3]||6===input[3]||8===input[3])&#125;],[&quot;rar&quot;,function(input)&#123;return check(input,[82,97,114,33,26,7])&amp;&amp;(0===input[6]||1===input[6])&#125;],[&quot;pdf&quot;,[37,80,68,70]],[&quot;exe&quot;,[77,90]]];function check(input,magic,argument_2)&#123;for(var offset=2&lt;arguments.length&amp;&amp;void 0!==argument_2?argument_2:0,i=0,len=magic.length;i&lt;len;i++)if(input[offset+i]!==magic[i])return!1;return!0&#125;module.exports=function(input)&#123;&quot;uint8array&quot;!==type(input)&amp;&amp;(input=new Uint8Array(input));for(var i=0,len=types.length;i&lt;len;i++)&#123;var _type2=_slicedToArray(types[i],3),ext=_type2[0],magic=_type2[1],_type2=_type2[2];if(isFn(magic))&#123;if(magic(input))return&#123;ext:ext,mime:mime(ext)&#125;&#125;else if(check(input,magic,_type2))return&#123;ext:ext,mime:mime(ext)&#125;&#125;&#125;&#125;),findKey=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,predicate,ctx)&#123;predicate=safeCb(predicate,ctx);for(var key,_keys=keys(obj),i=0,len=_keys.length;i&lt;len;i++)if(predicate(obj[key=_keys[i]],key,obj))return key&#125;&#125;),findIdx=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,predicate,ctx,dir)&#123;dir=dir||1,predicate=safeCb(predicate,ctx);for(var len=arr.length,i=0&lt;dir?0:len-1;0&lt;=i&amp;&amp;i&lt;len;)&#123;if(predicate(arr[i],i,arr))return i;i+=dir&#125;return-1&#125;&#125;),find=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,predicate,ctx)&#123;predicate=(isArrLike(obj)?findIdx:findKey)(obj,predicate,ctx);if(!isUndef(predicate)&amp;&amp;-1!==predicate)return obj[predicate]&#125;&#125;),findLastIdx=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr,predicate,ctx)&#123;return findIdx(arr,predicate,ctx,-1)&#125;&#125;),fnArgs=createCommonjsModule(function(module,exports)&#123;function validateArg(value,types,num)&#123;for(var isValid=!1,i=0,len=types.length;i&lt;len;i++)&#123;var t=lowerCase(types[i]);if(&quot;any&quot;===t||&quot;object&quot;===t&amp;&amp;isObj(value)||type(value)===t)&#123;isValid=!0;break&#125;&#125;if(!isValid)throw TypeError(&quot;Argument &quot;.concat(num,&quot; should be type &quot;).concat(types.join(&quot;|&quot;)))&#125;module.exports=function(types,args)&#123;for(var argsLen=args.length,typesLen=types.length,minLen=typesLen,maxLen=typesLen,i=0;i&lt;typesLen;i++)&#123;var _type=types[i].split(&quot;|&quot;);startWith(_type[0],&quot;?&quot;)&amp;&amp;(_type[0]=_type[0].slice(1),minLen===typesLen&amp;&amp;(minLen=i)),i===typesLen-1&amp;&amp;startWith(_type[0],&quot;...&quot;)&amp;&amp;(maxLen=1/0,_type[0]=_type[0].slice(3),minLen===typesLen&amp;&amp;(minLen=i)),types[i]=_type&#125;if(argsLen&lt;minLen)throw Error(&quot;Expected at least &quot;.concat(minLen,&quot; args but got &quot;).concat(argsLen));if(maxLen&lt;argsLen)throw Error(&quot;Expected at most &quot;.concat(maxLen,&quot; args but got &quot;).concat(argsLen));for(var _i=0;_i&lt;argsLen;_i++)&#123;var arg=args[_i];validateArg(arg,typesLen&lt;=_i?last(types):types[_i],_i)&#125;&#125;&#125;),isNil=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return null==val&#125;&#125;),toSrc=createCommonjsModule(function(module,exports)&#123;var fnToStr=Function.prototype.toString;module.exports=function(fn)&#123;if(isNil(fn))return&quot;&quot;;try&#123;return fnToStr.call(fn)&#125;catch(e)&#123;&#125;try&#123;return fn+&quot;&quot;&#125;catch(e)&#123;&#125;return&quot;&quot;&#125;&#125;),stripCmt=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;for(var mode=&#123;singleQuote:!1,doubleQuote:!1,regex:!1,blockComment:!1,lineComment:!1,condComp:!1&#125;,i=0,l=(str=(&quot;__&quot;+str+&quot;__&quot;).split(&quot;&quot;)).length;i&lt;l;i++)mode.regex?&quot;/&quot;===str[i]&amp;&amp;&quot;\\&quot;!==str[i-1]&amp;&amp;(mode.regex=!1):mode.singleQuote?&quot;&apos;&quot;===str[i]&amp;&amp;&quot;\\&quot;!==str[i-1]&amp;&amp;(mode.singleQuote=!1):mode.doubleQuote?&apos;&quot;&apos;===str[i]&amp;&amp;&quot;\\&quot;!==str[i-1]&amp;&amp;(mode.doubleQuote=!1):mode.blockComment?(&quot;*&quot;===str[i]&amp;&amp;&quot;/&quot;===str[i+1]&amp;&amp;(str[i+1]=&quot;&quot;,mode.blockComment=!1),str[i]=&quot;&quot;):mode.lineComment?(&quot;\n&quot;===str[i+1]&amp;&amp;(mode.lineComment=!1),str[i]=&quot;&quot;):(mode.doubleQuote=&apos;&quot;&apos;===str[i],mode.singleQuote=&quot;&apos;&quot;===str[i],&quot;/&quot;===str[i]&amp;&amp;(&quot;*&quot;!==str[i+1]?&quot;/&quot;!==str[i+1]?mode.regex=!0:(str[i]=&quot;&quot;,mode.lineComment=!0):(str[i]=&quot;&quot;,mode.blockComment=!0)));return str.join(&quot;&quot;).slice(2,-2)&#125;&#125;),fnParams=createCommonjsModule(function(module,exports)&#123;var regArgNames=/[^\s,]+/g;module.exports=function(fn)&#123;var open,fn=stripCmt(isStr(fn)?fn:toSrc(fn)),close=startWith(fn,&quot;async&quot;)||startWith(fn,&quot;function&quot;)||startWith(fn,&quot;(&quot;)?(open=fn.indexOf(&quot;(&quot;)+1,fn.indexOf(&quot;)&quot;)):(open=0,fn.indexOf(&quot;=&gt;&quot;)),fn=fn.slice(open,close);return null===(fn=fn.match(regArgNames))?[]:fn&#125;&#125;),precision=createCommonjsModule(function(module,exports)&#123;var regExponential=/^(-?\d?\.?\d+)e([+-]\d)+/;module.exports=function(num)&#123;var coefficient=(num=num.toExponential().match(regExponential))[1],num=parseInt(num[2],10),coefficient=(coefficient.split(&quot;.&quot;)[1]||&quot;&quot;).length-num;return coefficient&lt;0?0:coefficient&#125;&#125;),fraction=createCommonjsModule(function(module,exports)&#123;var abs=Math.abs,pow=Math.pow;module.exports=function(num)&#123;if(0===num)return&quot;0&quot;;var _precision=precision(num),num=num*(_precision=pow(10,_precision)),_gcd=abs(gcd(num,_precision));return(num/=_gcd)+&quot;/&quot;+(_precision/=_gcd)&#125;&#125;),freezeDeep=createCommonjsModule(function(module,exports)&#123;module.exports=exports=function(obj)&#123;return freeze(obj),keys(obj).forEach(function(prop)&#123;prop=obj[prop];isObj(prop)&amp;&amp;!Object.isFrozen(prop)&amp;&amp;exports(prop)&#125;),obj&#125;&#125;),fullscreen=createCommonjsModule(function(module,exports)&#123;for(var fn,fnMap=[[&quot;requestFullscreen&quot;,&quot;exitFullscreen&quot;,&quot;fullscreenElement&quot;,&quot;fullscreenEnabled&quot;,&quot;fullscreenchange&quot;,&quot;fullscreenerror&quot;],[&quot;webkitRequestFullscreen&quot;,&quot;webkitExitFullscreen&quot;,&quot;webkitFullscreenElement&quot;,&quot;webkitFullscreenEnabled&quot;,&quot;webkitfullscreenchange&quot;,&quot;webkitfullscreenerror&quot;],[&quot;mozRequestFullScreen&quot;,&quot;mozCancelFullScreen&quot;,&quot;mozFullScreenElement&quot;,&quot;mozFullScreenEnabled&quot;,&quot;mozfullscreenchange&quot;,&quot;mozfullscreenerror&quot;],[&quot;msRequestFullscreen&quot;,&quot;msExitFullscreen&quot;,&quot;msFullscreenElement&quot;,&quot;msFullscreenEnabled&quot;,&quot;MSFullscreenChange&quot;,&quot;MSFullscreenError&quot;]],i=0,len=fnMap.length;i&lt;len&amp;&amp;!((fn=fnMap[i])[1]in document);i++);exports=&#123;request:function()&#123;(0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:document.documentElement)[fn[0]]()&#125;,exit:function()&#123;document[fn[1]]()&#125;,toggle:function()&#123;var el=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:document.documentElement;this.isActive()?this.exit():this.request(el)&#125;,isActive:function()&#123;return toBool(this.getEl())&#125;,isEnabled:function()&#123;return toBool(document[fn[3]])&#125;,getEl:function()&#123;return document[fn[2]]&#125;&#125;,Emitter.mixin(exports),document.addEventListener(fn[4],function()&#123;exports.emit(&quot;change&quot;)&#125;),document.addEventListener(fn[5],function()&#123;exports.emit(&quot;error&quot;)&#125;),module.exports=exports&#125;),levenshtein=createCommonjsModule(function(module,exports)&#123;var vector=[],bChars=[];module.exports=function(a,b)&#123;if(a===b)return 0;a.length&gt;b.length&amp;&amp;(tmp=a,a=b,b=tmp);var tmp,aLen=a.length,bLen=b.length;if(!aLen)return bLen;if(!bLen)return aLen;for(;0&lt;aLen&amp;&amp;a.charCodeAt(aLen-1)===b.charCodeAt(bLen-1);)aLen--,bLen--;if(!aLen)return bLen;for(var start=0;start&lt;aLen&amp;&amp;a.charCodeAt(start)===b.charCodeAt(start);)start++;if(bLen-=start,!(aLen-=start))return bLen;for(var above,current=0,i=0;i&lt;bLen;)bChars[i]=b.charCodeAt(start+i),vector[i]=++i;for(var _i=0;_i&lt;aLen;_i++)for(var left=_i,current=_i+1,charA=a.charCodeAt(start+_i),j=0;j&lt;bLen;j++)above=current,current=left,left=vector[j],charA!==bChars[j]&amp;&amp;(above&lt;(current=left&lt;current?left:current)&amp;&amp;(current=above),current++),vector[j]=current;return current&#125;&#125;),pluck=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,key)&#123;return map(obj,property(key))&#125;&#125;),fuzzySearch=createCommonjsModule(function(module,exports)&#123;module.exports=function(needle,haystacks)&#123;var options=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:&#123;&#125;;return options.caseSensitive||(needle=needle.toLowerCase()),haystacks=map(haystacks,function(haystack)&#123;var string=function(haystack,options)&#123;return isStr(haystack)?haystack:safeGet(haystack,options.key)||&quot;&quot;&#125;(haystack,options);return options.caseSensitive||(string=string.toLowerCase()),&#123;value:haystack,levenshtein:levenshtein(needle,string),string:string&#125;&#125;),(haystacks=filter(haystacks,function(haystack)&#123;return function(needle,haystack)&#123;var hLen=haystack.length,nLen=needle.length;if(hLen&lt;nLen)return!1;if(nLen===hLen)return needle===haystack;for(var i=0,j=0;i&lt;nLen;i++)&#123;for(var c=needle.charCodeAt(i),has=!1;j&lt;hLen;)if(haystack.charCodeAt(j++)===c)&#123;has=!0;break&#125;if(!has)return!1&#125;return!0&#125;(needle,haystack.string)&#125;)).sort(function(a,b)&#123;return a.levenshtein-b.levenshtein&#125;),pluck(haystacks,&quot;value&quot;)&#125;&#125;),getUrlParam=createCommonjsModule(function(module,exports)&#123;module.exports=function(name,url)&#123;return new Url(url).query[name]&#125;&#125;),golangify=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn)&#123;return isFn(fn)?restArgs(function(args)&#123;return fn.apply(this,args).then(function(v)&#123;return[v,null]&#125;).catch(function(err)&#123;return[void 0,err]&#125;)&#125;):fn.then(function(v)&#123;return[v,null]&#125;).catch(function(err)&#123;return[void 0,err]&#125;)&#125;&#125;),heapSort=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator,heap=new Heap(cmp),len=arr.length,i=0;i&lt;len;i++)heap.add(arr[i]);for(var _i=0;_i&lt;len;_i++)arr[_i]=heap.poll();return arr&#125;&#125;),highlight=createCommonjsModule(function(module,exports)&#123;exports=function(str)&#123;var lang=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&quot;js&quot;,style=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:&#123;&#125;,subLangSi=(defaults(style,defStyle),str=str.replace(/&lt;/g,&quot;&amp;lt;&quot;).replace(/&gt;/g,&quot;&amp;gt;&quot;),lang=language[lang],0),subLangs=[],levels=(each(lang,function(val)&#123;val.language&amp;&amp;(str=str.replace(val.re,function($1,$2)&#123;return $2?(subLangs[subLangSi++]=exports($2,val.language,style),$1.replace($2,&quot;___subtmpl&quot;+(subLangSi-1)+&quot;___&quot;)):$1&#125;))&#125;),each(lang,function(val,key)&#123;language[val.language]||(str=str.replace(val.re,&quot;___&quot;+key+&quot;___$1___end&quot;+key+&quot;___&quot;))&#125;),[]);return str=str.replace(/___(?!subtmpl)\w+?___/g,function($0)&#123;var end=&quot;end&quot;===$0.substr(3,3),tag=(end?$0.substr(6):$0.substr(3)).replace(/_/g,&quot;&quot;),lastTag=0&lt;levels.length?levels[levels.length-1]:null;return!end&amp;&amp;(null==lastTag||tag==lastTag||null!=lastTag&amp;&amp;lang[lastTag]&amp;&amp;null!=lang[lastTag].embed&amp;&amp;-1&lt;lang[lastTag].embed.indexOf(tag))?(levels.push(tag),$0):end&amp;&amp;tag==lastTag?(levels.pop(),$0):&quot;&quot;&#125;),each(lang,function(val,key)&#123;var s=style[val.style]?&apos; style=&quot;&apos;.concat(style[val.style],&apos;&quot;&apos;):&quot;&quot;;str=str.replace(new RegExp(&quot;___end&quot;+key+&quot;___&quot;,&quot;g&quot;),&quot;&lt;/span&gt;&quot;).replace(new RegExp(&quot;___&quot;+key+&quot;___&quot;,&quot;g&quot;),&apos;&lt;span class=&quot;&apos;.concat(val.style,&apos;&quot;&apos;).concat(s,&quot;&gt;&quot;))&#125;),each(lang,function(val)&#123;val.language&amp;&amp;(str=str.replace(/___subtmpl\d+___/g,function($tmpl)&#123;$tmpl=parseInt($tmpl.replace(/___subtmpl(\d+)___/,&quot;$1&quot;),10);return subLangs[$tmpl]&#125;))&#125;),str&#125;;var defStyle=&#123;comment:&quot;color:#63a35c;&quot;,string:&quot;color:#183691;&quot;,number:&quot;color:#0086b3;&quot;,keyword:&quot;color:#a71d5d;&quot;,operator:&quot;color:#994500;&quot;&#125;,language=&#123;js:&#123;comment:&#123;re:/(\/\/.*|\/\*([\s\S]*?)\*\/)/g,style:&quot;comment&quot;&#125;,string:&#123;re:/((&apos;.*?&apos;)|(&quot;.*?&quot;))/g,style:&quot;string&quot;&#125;,numbers:&#123;re:/(-?(\d+|\d+\.\d+|\.\d+))/g,style:&quot;number&quot;&#125;,keywords:&#123;re:/(?:\b)(function|for|foreach|while|if|else|elseif|switch|break|as|return|this|class|self|default|var|const|let|false|true|null|undefined)(?:\b)/gi,style:&quot;keyword&quot;&#125;,operator:&#123;re:/(\+|-|\/|\*|%|=|&amp;lt;|&amp;gt;|\||\?|\.)/g,style:&quot;operator&quot;&#125;&#125;&#125;;language.html=&#123;comment:&#123;re:/(&amp;lt;!--([\s\S]*?)--&amp;gt;)/g,style:&quot;comment&quot;&#125;,tag:&#123;re:/(&amp;lt;\/?\w(.|\n)*?\/?&amp;gt;)/g,style:&quot;keyword&quot;,embed:[&quot;string&quot;]&#125;,string:language.js.string,css:&#123;re:/(?:&amp;lt;style.*?&amp;gt;)([\s\S]*)?(?:&amp;lt;\/style&amp;gt;)/gi,language:&quot;css&quot;&#125;,script:&#123;re:/(?:&amp;lt;script.*?&amp;gt;)([\s\S]*?)(?:&amp;lt;\/script&amp;gt;)/gi,language:&quot;js&quot;&#125;&#125;,language.css=&#123;comment:language.js.comment,string:language.js.string,numbers:&#123;re:/((-?(\d+|\d+\.\d+|\.\d+)(%|px|em|pt|in)?)|#[0-9a-fA-F]&#123;3&#125;[0-9a-fA-F]&#123;3&#125;)/g,style:&quot;number&quot;&#125;,keywords:&#123;re:/(@\w+|:?:\w+|[a-z-]+:)/g,style:&quot;keyword&quot;&#125;&#125;,module.exports=exports&#125;),isErr=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Error]&quot;===objToStr(val)&#125;&#125;),hookFn=createCommonjsModule(function(module,exports)&#123;var defOptions=&#123;before:noop,after:noop,error:noop&#125;;module.exports=function(fn,options)&#123;return defaults(options,defOptions),function()&#123;var args=toArr(arguments),newArgs=options.before.apply(this,args);isArr(newArgs)&amp;&amp;(args=newArgs);try&#123;var result=fn.apply(this,args),newResult=options.after.call(this,result);return result=newResult?newResult:result&#125;catch(e)&#123;newArgs=options.error(e);if(newArgs)&#123;if(isErr(newArgs))throw newArgs;return newArgs&#125;throw e&#125;&#125;&#125;&#125;),invert=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;var ret=&#123;&#125;;return each(obj,function(val,key)&#123;ret[val]=key&#125;),ret&#125;&#125;),keyCode=createCommonjsModule(function(module,exports)&#123;exports=function(val)&#123;return(isStr(val)?codeMap:nameMap)[val]&#125;;for(var codeMap=&#123;backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,&quot;pause/break&quot;:19,&quot;caps lock&quot;:20,esc:27,space:32,&quot;page up&quot;:33,&quot;page down&quot;:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,windows:91,&quot;right windows&quot;:92,&quot;windows menu&quot;:93,&quot;numpad *&quot;:106,&quot;numpad +&quot;:107,&quot;numpad -&quot;:109,&quot;numpad .&quot;:110,&quot;numpad /&quot;:111,&quot;num lock&quot;:144,&quot;scroll lock&quot;:145,&quot;;&quot;:186,&quot;=&quot;:187,&quot;,&quot;:188,&quot;-&quot;:189,&quot;.&quot;:190,&quot;/&quot;:191,&quot;`&quot;:192,&quot;[&quot;:219,&quot;\\&quot;:220,&quot;]&quot;:221,&quot;&apos;&quot;:222&#125;,i=97;i&lt;123;i++)codeMap[String.fromCharCode(i)]=i-32;for(var _i=48;_i&lt;58;_i++)codeMap[_i-48]=_i;for(var _i2=1;_i2&lt;13;_i2++)codeMap[&quot;f&quot;+_i2]=_i2+111;for(var _i3=0;_i3&lt;10;_i3++)codeMap[&quot;numpad &quot;+_i3]=_i3+96;var nameMap=invert(codeMap);module.exports=exports&#125;),hotkey=createCommonjsModule(function(module,exports)&#123;exports=&#123;on:function(keys,listener)&#123;keys=keys.split(regComma),each(keys,function(key)&#123;emitter.on(normalizeKey(key),listener)&#125;)&#125;,off:function(keys,listener)&#123;keys=keys.split(regComma),each(keys,function(key)&#123;emitter.off(normalizeKey(key),listener)&#125;)&#125;&#125;;var emitter=new Emitter;function normalizeKey(keyStr)&#123;keyStr=keyStr.split(regPlus),keyStr=map(keyStr,function(key)&#123;return trim(key)&#125;);return(keyStr=unique(keyStr)).sort(),keyStr.join(&quot;+&quot;)&#125;document.addEventListener(&quot;keydown&quot;,function(e)&#123;var keys=[];e.ctrlKey&amp;&amp;keys.push(&quot;ctrl&quot;),e.shiftKey&amp;&amp;keys.push(&quot;shift&quot;),keys.push(keyCode(e.keyCode)),emitter.emit(normalizeKey(keys.join(&quot;+&quot;)),e)&#125;);var regComma=/,/g,regPlus=/\+/g;module.exports=exports&#125;),parseHtml=createCommonjsModule(function(module,exports)&#123;exports=function(html,handler)&#123;for(var stack=[],lastHtml=html;html;)&#123;var execRes,_text2,_match,_text,text=!0;if(last(stack)&amp;&amp;SPECIAL[last(stack)]?((execRes=new RegExp(&quot;&lt;/&quot;.concat(last(stack),&quot;[^&gt;]*&gt;&quot;)).exec(html))&amp;&amp;(_text2=html.substring(0,execRes.index),html=html.substring(execRes.index+execRes[0].length),_text2&amp;&amp;handler.text&amp;&amp;handler.text(_text2)),parseEndTag(0,last(stack))):(startWith(html,&quot;\x3c!--&quot;)?0&lt;=(execRes=html.indexOf(&quot;--\x3e&quot;))&amp;&amp;(handler.comment&amp;&amp;handler.comment(html.substring(4,execRes)),html=html.substring(execRes+3),text=!1):startWith(html,&quot;&lt;!&quot;)?(_text2=html.match(regDoctype))&amp;&amp;(handler.text&amp;&amp;handler.text(html.substring(0,_text2[0].length)),html=html.substring(_text2[0].length),text=!1):startWith(html,&quot;&lt;/&quot;)?(_match=html.match(regEndTag))&amp;&amp;(html=html.substring(_match[0].length),_match[0].replace(regEndTag,parseEndTag),text=!1):!startWith(html,&quot;&lt;&quot;)||(_match=html.match(regStartTag))&amp;&amp;(html=html.substring(_match[0].length),_match[0].replace(regStartTag,parseStartTag),text=!1),text&amp;&amp;(_text=(text=html.indexOf(&quot;&lt;&quot;))&lt;0?html:html.substring(0,text),html=text&lt;0?&quot;&quot;:html.substring(text),handler.text&amp;&amp;handler.text(_text))),lastHtml===html)throw Error(&quot;Parse Error: &quot;+html);lastHtml=html&#125;function parseStartTag(tag,tagName,rest,unary)&#123;var attrs;tagName=lowerCase(tagName),(unary=!!unary)||stack.push(tagName),handler.start&amp;&amp;(attrs=&#123;&#125;,rest.replace(regAttr,function(all,$1,$2,$3,$4)&#123;attrs[$1]=$2||$3||$4||&quot;&quot;&#125;),handler.start(tagName,attrs,unary))&#125;function parseEndTag(tag,tagName)&#123;var pos;if(tagName=lowerCase(tagName))for(pos=stack.length-1;0&lt;=pos&amp;&amp;stack[pos]!==tagName;pos--);else pos=0;if(0&lt;=pos)&#123;for(var i=stack.length-1;pos&lt;=i;i--)handler.end&amp;&amp;handler.end(stack[i]);stack.length=pos&#125;&#125;parseEndTag()&#125;;var regDoctype=/^&lt;!\s*doctype((?:\s+[\w:]+(?:\s*=\s*(?:(?:&quot;[^&quot;]*&quot;)|(?:&apos;[^&apos;]*&apos;)|[^&gt;\s]+))?)*)\s*(\/?)&gt;/i,regEndTag=/^&lt;\/([-A-Za-z0-9_]+)[^&gt;]*&gt;/,regStartTag=/^&lt;([-A-Za-z0-9_]+)((?:\s+[-A-Za-z0-9_:@.]+(?:\s*=\s*(?:(?:&quot;[^&quot;]*&quot;)|(?:&apos;[^&apos;]*&apos;)|[^&gt;\s]+))?)*)\s*(\/?)&gt;/i,regAttr=/([-A-Za-z0-9_:@.]+)(?:\s*=\s*(?:(?:&quot;((?:\\.|[^&quot;])*)&quot;)|(?:&apos;((?:\\.|[^&apos;])*)&apos;)|([^&gt;\s]+)))?/g,SPECIAL=arrToMap(&quot;script,style&quot;.split(&quot;,&quot;));module.exports=exports&#125;),html=createCommonjsModule(function(module,exports)&#123;module.exports=&#123;parse:function(html)&#123;var ret=[],stack=new Stack;return parseHtml(html,&#123;start:function(tag,attrs)&#123;attrs=mapObj(attrs,function(val)&#123;return val.replace(/&amp;quot;/g,&apos;&quot;&apos;)&#125;),stack.push(&#123;tag:tag,attrs:attrs&#125;)&#125;,end:function()&#123;var lastNode,node=stack.pop();stack.size?(lastNode=stack.peek(),isArr(lastNode.content)||(lastNode.content=[]),lastNode.content.push(node)):ret.push(node)&#125;,comment:function(text)&#123;var text=&quot;\x3c!--&quot;.concat(text,&quot;--\x3e&quot;),lastNode=stack.peek();lastNode?(lastNode.content||(lastNode.content=[]),lastNode.content.push(text)):ret.push(text)&#125;,text:function(text)&#123;var lastNode=stack.peek();lastNode?(lastNode.content||(lastNode.content=[]),lastNode.content.push(text)):ret.push(text)&#125;&#125;),ret&#125;,stringify:function stringify(tree)&#123;var ret=&quot;&quot;;return isArr(tree)?each(tree,function(node)&#123;return ret+=stringify(node)&#125;):isStr(tree)?ret=tree:(ret+=&quot;&lt;&quot;.concat(tree.tag),each(tree.attrs,function(val,key)&#123;return ret+=&quot; &quot;.concat(key,&apos;=&quot;&apos;).concat(val.replace(/&quot;/g,&quot;&amp;quot;&quot;),&apos;&quot;&apos;)&#125;),ret+=&quot;&gt;&quot;,tree.content&amp;&amp;(ret+=stringify(tree.content)),ret+=&quot;&lt;/&quot;.concat(tree.tag,&quot;&gt;&quot;)),ret&#125;&#125;&#125;),indent=createCommonjsModule(function(module,exports)&#123;var regLineBegin=/^(?!\s*$)/gm;module.exports=function(str,char,len)&#123;return isNum(char)&amp;&amp;(len=char,char=&quot; &quot;),isUndef(len)&amp;&amp;(len=4),isUndef(char)&amp;&amp;(char=&quot; &quot;),char=repeat(char,len),str.replace(regLineBegin,char)&#125;&#125;),ini=createCommonjsModule(function(module,exports)&#123;var regSection=/^\[([^\]]*)\]$/i,regKeyVal=/^([^=]+)(=(.*))?$/i,regComment=/^\s*[;#]/;module.exports=&#123;parse:function(ini)&#123;var ret=&#123;&#125;,section=ret;return each(ini.split(&quot;\n&quot;),function(line)&#123;if((line=trim(line))&amp;&amp;!line.match(regComment))&#123;var _key,match=line.match(regSection);if(match&amp;&amp;match[1])return _key=match[1],section=safeGet(ret,_key)||&#123;&#125;,safeSet(ret,_key,section);(match=line.match(regKeyVal))&amp;&amp;(_key=trim(match[1]),&quot;null&quot;===(line=&quot;false&quot;===(line=&quot;true&quot;===(line=!match[2]||trim(match[3]))?!0:line)?!1:line)&amp;&amp;(line=null),endWith(_key,&quot;[]&quot;)&amp;&amp;(_key=_key.substring(0,_key.length-2),section[_key]||(section[_key]=[])),isArr(section[_key])?section[_key].push(line):section[_key]=line)&#125;&#125;),ret&#125;,stringify:function stringify(obj)&#123;var options=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,ret=&quot;&quot;,section=options.section,separator=options.whitespace?&quot; = &quot;:&quot;=&quot;,children=[];return each(obj,function(val,key)&#123;isArr(val)?each(val,function(item)&#123;ret+=&quot;&quot;.concat(key,&quot;[]&quot;).concat(separator).concat(item,&quot;\n&quot;)&#125;):isObj(val)?children.push(&#123;key:key,val:val&#125;):ret+=&quot;&quot;.concat(key).concat(separator).concat(val,&quot;\n&quot;)&#125;),section&amp;&amp;ret&amp;&amp;(ret=&quot;[&quot;.concat(section,&quot;]\n&quot;)+ret),section=section?section+&quot;.&quot;:&quot;&quot;,each(children,function(child)&#123;(child=stringify(child.val,&#123;section:section+child.key,whitespace:options.whitespace&#125;))&amp;&amp;(ret&amp;&amp;(ret+=&quot;\n&quot;),ret+=child)&#125;),ret&#125;&#125;&#125;),insertionSort=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator,i=1,len=arr.length;i&lt;len;i++)for(var j=i;0&lt;j&amp;&amp;cmp(arr[j],arr[j-1])&lt;0;j--)swap(arr,j,j-1);return arr&#125;&#125;),intersectRange=createCommonjsModule(function(module,exports)&#123;module.exports=function(a,b)&#123;var min=a.start&lt;b.start?a:b,b=min===a?b:a;if(!(min.end&lt;b.start))return&#123;start:b.start,end:(min.end&lt;b.end?min:b).end&#125;&#125;&#125;),invariant=createCommonjsModule(function(module,exports)&#123;module.exports=function(condition,format,a,b,c,d,e,f)&#123;var args,argIndex,error,process=root.process||&#123;env:&#123;NODE_ENV:&quot;development&quot;&#125;&#125;;if(&quot;production&quot;!==process.env.NODE_ENV&amp;&amp;void 0===format)throw new Error(&quot;invariant requires an error message argument&quot;);if(!condition)throw void 0===format?error=new Error(&quot;Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.&quot;):(args=[a,b,c,d,e,f],argIndex=0,(error=new Error(format.replace(/%s/g,function()&#123;return args[argIndex++]&#125;))).name=&quot;Invariant Violation&quot;),error.framesToPop=1,error&#125;&#125;),isAbsoluteUrl=createCommonjsModule(function(module,exports)&#123;var regAbsolute=/^[a-z][a-z0-9+.-]*:/;module.exports=function(url)&#123;return regAbsolute.test(url)&#125;&#125;),isAsyncFn=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object AsyncFunction]&quot;===objToStr(val)&#125;&#125;),isClose=createCommonjsModule(function(module,exports)&#123;var abs=Math.abs,max=Math.max;module.exports=function(a,b,relTol,absTol)&#123;return isNum(relTol)||(relTol=1e-9),isNum(absTol)||(absTol=0),abs(a-b)&lt;=max(relTol*max(abs(a),abs(b)),absTol)&#125;&#125;),isCyclic=createCommonjsModule(function(module,exports)&#123;exports=function(val,parents)&#123;if(!isObj(val))return!1;if(parents&amp;&amp;parents.contains(val))return!0;parents=new Node(val,parents);for(var _keys=keys(val),i=0,len=_keys.length;i&lt;len;i++)if(exports(val[_keys[i]],parents))return!0;return!1&#125;;var Node=Class(&#123;initialize:function(val,next)&#123;this.val=val,this.next=next&#125;,contains:function(val)&#123;for(var cursor=this;cursor;)&#123;if(cursor.val===val)return!0;cursor=cursor.next&#125;return!1&#125;&#125;);module.exports=exports&#125;),isDarkMode=createCommonjsModule(function(module,exports)&#123;var m=new MediaQuery(&quot;(prefers-color-scheme: dark)&quot;);module.exports=function()&#123;return m.isMatch()&#125;&#125;),isDataUrl=createCommonjsModule(function(module,exports)&#123;var regDataUrl=/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.&#123;&#125;|~`]+=[a-z0-9-.!#$%*+.&#123;&#125;|~`]+)*)?(;base64)?,([a-z0-9!$&amp;&apos;,()*+;=\-._~:@/?%\s]*?)$/i;module.exports=function(str)&#123;return regDataUrl.test(trim(str))&#125;&#125;),isEmail=createCommonjsModule(function(module,exports)&#123;var regEmail=/.+@.+\..+/;module.exports=function(val)&#123;return regEmail.test(val)&#125;&#125;),isEqual=createCommonjsModule(function(module,exports)&#123;function eq(a,b,aStack,bStack)&#123;if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;if(a!=a)return b!=b;var type=typeof a;return(&quot;function&quot;==type||&quot;object&quot;==type||&quot;object&quot;==typeof b)&amp;&amp;function(a,b,aStack,bStack)&#123;var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className)&#123;case&quot;[object RegExp]&quot;:case&quot;[object String]&quot;:return&quot;&quot;+a==&quot;&quot;+b;case&quot;[object Number]&quot;:return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case&quot;[object Date]&quot;:case&quot;[object Boolean]&quot;:return+a==+b&#125;if(!(className=&quot;[object Array]&quot;===className))&#123;if(&quot;object&quot;!=typeof a||&quot;object&quot;!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&amp;&amp;!(isFn(aCtor)&amp;&amp;aCtor instanceof aCtor&amp;&amp;isFn(bCtor)&amp;&amp;bCtor instanceof bCtor)&amp;&amp;&quot;constructor&quot;in a&amp;&amp;&quot;constructor&quot;in b)return!1&#125;bStack=bStack||[];for(var length=(aStack=aStack||[]).length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),className)&#123;if((length=a.length)!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1&#125;else&#123;var key,_keys=keys(a),length=_keys.length;if(keys(b).length!==length)return!1;for(;length--;)if(key=_keys[length],!has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1&#125;return aStack.pop(),bStack.pop(),!0&#125;(a,b,aStack,bStack)&#125;module.exports=function(a,b)&#123;return eq(a,b)&#125;&#125;),isEven=createCommonjsModule(function(module,exports)&#123;module.exports=function(num)&#123;return!!isInt(num)&amp;&amp;num%2==0&#125;&#125;),_isFinite=createCommonjsModule(function(module,exports)&#123;var nativeIsFinite=root.isFinite,nativeIsNaN=root.isNaN;module.exports=function(val)&#123;return nativeIsFinite(val)&amp;&amp;!nativeIsNaN(parseFloat(val))&#125;&#125;),isGeneratorFn=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object GeneratorFunction]&quot;===objToStr(val)&#125;&#125;),isHidden=createCommonjsModule(function(module,exports)&#123;var getComputedStyle=root.getComputedStyle,document=root.document;function isOutside(clientRect,containerRect)&#123;return clientRect.right&lt;containerRect.left||clientRect.left&gt;containerRect.right||clientRect.bottom&lt;containerRect.top||clientRect.top&gt;containerRect.bottom&#125;module.exports=function(el)&#123;var _ref=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,_ref$display=_ref.display,_ref$visibility=_ref.visibility,_ref$visibility=void 0!==_ref$visibility&amp;&amp;_ref$visibility,_ref$opacity=_ref.opacity,_ref$opacity=void 0!==_ref$opacity&amp;&amp;_ref$opacity,_ref$size=_ref.size,_ref$size=void 0!==_ref$size&amp;&amp;_ref$size,_ref$viewport=_ref.viewport,_ref$viewport=void 0!==_ref$viewport&amp;&amp;_ref$viewport,_ref=_ref.overflow,_ref=void 0!==_ref&amp;&amp;_ref;if(void 0===_ref$display||_ref$display)return null===el.offsetParent;_ref$display=getComputedStyle(el);if(_ref$visibility&amp;&amp;&quot;hidden&quot;===_ref$display.visibility)return!0;if(_ref$opacity)&#123;if(&quot;0&quot;===_ref$display.opacity)return!0;for(var cur=el;cur=cur.parentElement;)if(&quot;0&quot;===getComputedStyle(cur).opacity)return!0&#125;var clientRect=el.getBoundingClientRect();if(_ref$size&amp;&amp;(0===clientRect.width||0===clientRect.height))return!0;if(_ref$viewport)return isOutside(clientRect,&#123;top:0,left:0,right:document.documentElement.clientWidth,bottom:document.documentElement.clientHeight&#125;);if(_ref)for(var _cur=el;_cur=_cur.parentElement;)&#123;var _overflow=getComputedStyle(_cur).overflow;if(&quot;scroll&quot;===_overflow||&quot;hidden&quot;===_overflow)if(isOutside(clientRect,_cur.getBoundingClientRect()))return!0&#125;return!1&#125;&#125;),isIp=createCommonjsModule(function(module,exports)&#123;exports=function(str)&#123;return exports.v4(str)||exports.v6(str)&#125;;var v4=&quot;(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d))&#123;3&#125;&quot;,regV4=new RegExp(&quot;^&quot;.concat(v4,&quot;$&quot;)),v6seg=&quot;[a-fA-F\\d]&#123;1,4&#125;&quot;,v4=[&quot;(&quot;,&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;7&#125;(?:&quot;).concat(v6seg,&quot;|:)|&quot;),&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;6&#125;(?:&quot;).concat(v4,&quot;|:&quot;).concat(v6seg,&quot;|:)|&quot;),&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;5&#125;(?::&quot;).concat(v4,&quot;|(:&quot;).concat(v6seg,&quot;)&#123;1,2&#125;|:)|&quot;),&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;4&#125;(?:(:&quot;).concat(v6seg,&quot;)&#123;0,1&#125;:&quot;).concat(v4,&quot;|(:&quot;).concat(v6seg,&quot;)&#123;1,3&#125;|:)|&quot;),&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;3&#125;(?:(:&quot;).concat(v6seg,&quot;)&#123;0,2&#125;:&quot;).concat(v4,&quot;|(:&quot;).concat(v6seg,&quot;)&#123;1,4&#125;|:)|&quot;),&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;2&#125;(?:(:&quot;).concat(v6seg,&quot;)&#123;0,3&#125;:&quot;).concat(v4,&quot;|(:&quot;).concat(v6seg,&quot;)&#123;1,5&#125;|:)|&quot;),&quot;(?:&quot;.concat(v6seg,&quot;:)&#123;1&#125;(?:(:&quot;).concat(v6seg,&quot;)&#123;0,4&#125;:&quot;).concat(v4,&quot;|(:&quot;).concat(v6seg,&quot;)&#123;1,6&#125;|:)|&quot;),&quot;(?::((?::&quot;.concat(v6seg,&quot;)&#123;0,5&#125;:&quot;).concat(v4,&quot;|(?::&quot;).concat(v6seg,&quot;)&#123;1,7&#125;|:))&quot;),&quot;)(%[0-9a-zA-Z]&#123;1,&#125;)?&quot;].join(&quot;&quot;),regV6=new RegExp(&quot;^&quot;.concat(v4,&quot;$&quot;));exports.v4=function(str)&#123;return regV4.test(str)&#125;,exports.v6=function(str)&#123;return regV6.test(str)&#125;,module.exports=exports&#125;),isIp_1=isIp.v4,isIp_2=isIp.v6,isJson=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;try&#123;return JSON.parse(val),!0&#125;catch(e)&#123;return!1&#125;&#125;&#125;),isLeapYear=createCommonjsModule(function(module,exports)&#123;module.exports=function(year)&#123;return year%400==0||year%4==0&amp;&amp;year%100!=0&#125;&#125;),isMap=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Map]&quot;===objToStr(val)&#125;&#125;),isMobile=createCommonjsModule(function(module,exports)&#123;var regMobileAll=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,regMobileFour=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i;exports=memoize(function(ua)&#123;return ua=ua||(isBrowser?navigator.userAgent:&quot;&quot;),regMobileAll.test(ua)||regMobileFour.test(ua.substr(0,4))&#125;),module.exports=exports&#125;),isNative=createCommonjsModule(function(module,exports)&#123;exports=function(val)&#123;return!!isObj(val)&amp;&amp;(isFn(val)?regIsNative:regIsHostCtor).test(toSrc(val))&#125;;var hasOwnProperty=Object.prototype.hasOwnProperty,regIsNative=new RegExp(&quot;^&quot;+toSrc(hasOwnProperty).replace(/[\\^$.*+?()[\]&#123;&#125;|]/g,&quot;\\$&amp;&quot;).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,&quot;$1.*?&quot;)+&quot;$&quot;),regIsHostCtor=/^\[object .+?Constructor\]$/;module.exports=exports&#125;),isNull=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return null===val&#125;&#125;),isNumeric=createCommonjsModule(function(module,exports)&#123;var regComma=/,/g;module.exports=function(val)&#123;return isStr(val)&amp;&amp;(val=val.replace(regComma,&quot;&quot;)),!_isNaN(parseFloat(val))&amp;&amp;_isFinite(val)&amp;&amp;!isArr(val)&#125;&#125;),isPrime=createCommonjsModule(function(module,exports)&#123;module.exports=function(num)&#123;for(var boundary=Math.floor(Math.sqrt(num)),i=2;i&lt;=boundary;i++)if(num%i==0)return!1;return 2&lt;=num&#125;&#125;),isPrimitive=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;var type=typeof val;return null==val||&quot;function&quot;!=type&amp;&amp;&quot;object&quot;!=type&#125;&#125;),isPromise=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return isObj(val)&amp;&amp;isFn(val.then)&amp;&amp;isFn(val.catch)&#125;&#125;),isRelative=createCommonjsModule(function(module,exports)&#123;var regAbsolute=/^([a-z]+:)?[\\/]/i;module.exports=function(path)&#123;return!regAbsolute.test(path)&#125;&#125;),isRetina=createCommonjsModule(function(module,exports)&#123;exports=isBrowser&amp;&amp;(1.25&lt;window.devicePixelRatio||window.matchMedia&amp;&amp;window.matchMedia(&quot;(-webkit-min-device-pixel-ratio: 1.25), (min--moz-device-pixel-ratio: 1.25), (-o-min-device-pixel-ratio: 5/4), (min-resolution: 1.25dppx)&quot;).matches),module.exports=exports&#125;),isSet=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object Set]&quot;===objToStr(val)&#125;&#125;),isTypedArr=createCommonjsModule(function(module,exports)&#123;exports=function(val)&#123;return!!map[objToStr(val)]&#125;;var map=&#123;&#125;;each([&quot;Int8Array&quot;,&quot;Int16Array&quot;,&quot;Int32Array&quot;,&quot;Uint8Array&quot;,&quot;Uint8ClampedArray&quot;,&quot;Uint16Array&quot;,&quot;Uint32Array&quot;,&quot;Float32Array&quot;,&quot;Float64Array&quot;],function(val)&#123;map[&quot;[object &quot;+val+&quot;]&quot;]=!0&#125;),module.exports=exports&#125;),isUrl=createCommonjsModule(function(module,exports)&#123;var regUrl=/^(?:\w+:)?\/\/([^\s.]+\.\S&#123;2&#125;|localhost[:?\d]*)\S*$/;module.exports=function(val)&#123;return regUrl.test(val)&#125;&#125;),isWeakMap=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object WeakMap]&quot;===objToStr(val)&#125;&#125;),isWeakSet=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return&quot;[object WeakSet]&quot;===objToStr(val)&#125;&#125;),jsonClone=createCommonjsModule(function(module,exports)&#123;module.exports=function(val)&#123;return JSON.parse(JSON.stringify(val))&#125;&#125;),loadJs=createCommonjsModule(function(module,exports)&#123;module.exports=function(src,cb)&#123;var script=document.createElement(&quot;script&quot;);script.src=src,script.onload=function()&#123;var isNotLoaded=script.readyState&amp;&amp;&quot;complete&quot;!=script.readyState&amp;&amp;&quot;loaded&quot;!=script.readyState;cb&amp;&amp;cb(!isNotLoaded)&#125;,script.onerror=function()&#123;cb(!1)&#125;,document.body.appendChild(script)&#125;&#125;),jsonp=createCommonjsModule(function(module,exports)&#123;(exports=function(options)&#123;defaults(options,exports.settings);var timer,name=options.name||uniqId(&quot;jsonp&quot;),param=options.param,timeout=options.timeout,error=options.error,success=options.success,complete=options.complete,data=options.data,options=options.url,isTimeout=!1;0&lt;timeout&amp;&amp;(timer=setTimeout(function()&#123;isTimeout=!0,error(new Error(&quot;Timeout&quot;)),complete()&#125;,timeout)),window[name]=function(data)&#123;success(data),complete(),window[name]=noop&#125;,data[param]=name,data=query.stringify(data),options+=-1&lt;options.indexOf(&quot;?&quot;)?&quot;&amp;&quot;+data:&quot;?&quot;+data,loadJs(options,function(isLoaded)&#123;isTimeout||(timer&amp;&amp;clearTimeout(timer),isLoaded||(error(new Error),complete()))&#125;)&#125;).settings=&#123;data:&#123;&#125;,param:&quot;callback&quot;,success:noop,error:noop,complete:noop,timeout:0&#125;,module.exports=exports&#125;),jsonp_1=jsonp.settings,linkify=createCommonjsModule(function(module,exports)&#123;function defHyperlink(url)&#123;return&apos;&lt;a href=&quot;&apos;+url+&apos;&quot;&gt;&apos;+url+&quot;&lt;/a&gt;&quot;&#125;module.exports=function(str,hyperlink)&#123;hyperlink=hyperlink||defHyperlink;var urlList=extractUrls(str);return each(urlList,function(url)&#123;str=str.replace(new RegExp(escapeRegExp(url),&quot;g&quot;),hyperlink)&#125;),str&#125;&#125;),loadCss=createCommonjsModule(function(module,exports)&#123;module.exports=function(src,cb)&#123;cb=cb||noop;var link=document.createElement(&quot;link&quot;);link.rel=&quot;stylesheet&quot;,link.type=&quot;text/css&quot;,link.onerror=function()&#123;cb(!1)&#125;,link.onload=function()&#123;cb(!0)&#125;,link.href=src,document.head.appendChild(link)&#125;&#125;),wordsToBytes=createCommonjsModule(function(module,exports)&#123;module.exports=function(words)&#123;for(var bytes=[],b=0,len=32*words.length;b&lt;len;b+=8)bytes.push(words[b&gt;&gt;&gt;5]&gt;&gt;&gt;24-b%32&amp;255);return bytes&#125;&#125;),md5=createCommonjsModule(function(module,exports)&#123;function FF(a,b,c,d,x,s,t)&#123;a=a+(b&amp;c|~b&amp;d)+(x&gt;&gt;&gt;0)+t;return(a&lt;&lt;s|a&gt;&gt;&gt;32-s)+b&#125;function GG(a,b,c,d,x,s,t)&#123;a=a+(b&amp;d|c&amp;~d)+(x&gt;&gt;&gt;0)+t;return(a&lt;&lt;s|a&gt;&gt;&gt;32-s)+b&#125;function HH(a,b,c,d,x,s,t)&#123;a=a+(b^c^d)+(x&gt;&gt;&gt;0)+t;return(a&lt;&lt;s|a&gt;&gt;&gt;32-s)+b&#125;function II(a,b,c,d,x,s,t)&#123;a=a+(c^(b|~d))+(x&gt;&gt;&gt;0)+t;return(a&lt;&lt;s|a&gt;&gt;&gt;32-s)+b&#125;function rotl(n,b)&#123;return n&lt;&lt;b|n&gt;&gt;&gt;32-b&#125;module.exports=function(msg)&#123;isStr(msg)&amp;&amp;(msg=strToBytes(msg));for(var m=bytesToWords(msg),msg=8*msg.length,a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i&lt;m.length;i++)m[i]=16711935&amp;(m[i]&lt;&lt;8|m[i]&gt;&gt;&gt;24)|4278255360&amp;(m[i]&lt;&lt;24|m[i]&gt;&gt;&gt;8);m[msg&gt;&gt;&gt;5]|=128&lt;&lt;msg%32,m[14+(64+msg&gt;&gt;&gt;9&lt;&lt;4)]=msg;for(var _i=0;_i&lt;m.length;_i+=16)&#123;var aa=a,bb=b,cc=c,dd=d,a=FF(a,b,c,d,m[_i+0],7,-680876936),d=FF(d,a,b,c,m[_i+1],12,-389564586),c=FF(c,d,a,b,m[_i+2],17,606105819),b=FF(b,c,d,a,m[_i+3],22,-1044525330);a=FF(a,b,c,d,m[_i+4],7,-176418897),d=FF(d,a,b,c,m[_i+5],12,1200080426),c=FF(c,d,a,b,m[_i+6],17,-1473231341),b=FF(b,c,d,a,m[_i+7],22,-45705983),a=FF(a,b,c,d,m[_i+8],7,1770035416),d=FF(d,a,b,c,m[_i+9],12,-1958414417),c=FF(c,d,a,b,m[_i+10],17,-42063),b=FF(b,c,d,a,m[_i+11],22,-1990404162),a=FF(a,b,c,d,m[_i+12],7,1804603682),d=FF(d,a,b,c,m[_i+13],12,-40341101),c=FF(c,d,a,b,m[_i+14],17,-1502002290),a=GG(a,b=FF(b,c,d,a,m[_i+15],22,1236535329),c,d,m[_i+1],5,-165796510),d=GG(d,a,b,c,m[_i+6],9,-1069501632),c=GG(c,d,a,b,m[_i+11],14,643717713),b=GG(b,c,d,a,m[_i+0],20,-373897302),a=GG(a,b,c,d,m[_i+5],5,-701558691),d=GG(d,a,b,c,m[_i+10],9,38016083),c=GG(c,d,a,b,m[_i+15],14,-660478335),b=GG(b,c,d,a,m[_i+4],20,-405537848),a=GG(a,b,c,d,m[_i+9],5,568446438),d=GG(d,a,b,c,m[_i+14],9,-1019803690),c=GG(c,d,a,b,m[_i+3],14,-187363961),b=GG(b,c,d,a,m[_i+8],20,1163531501),a=GG(a,b,c,d,m[_i+13],5,-1444681467),d=GG(d,a,b,c,m[_i+2],9,-51403784),c=GG(c,d,a,b,m[_i+7],14,1735328473),a=HH(a,b=GG(b,c,d,a,m[_i+12],20,-1926607734),c,d,m[_i+5],4,-378558),d=HH(d,a,b,c,m[_i+8],11,-2022574463),c=HH(c,d,a,b,m[_i+11],16,1839030562),b=HH(b,c,d,a,m[_i+14],23,-35309556),a=HH(a,b,c,d,m[_i+1],4,-1530992060),d=HH(d,a,b,c,m[_i+4],11,1272893353),c=HH(c,d,a,b,m[_i+7],16,-155497632),b=HH(b,c,d,a,m[_i+10],23,-1094730640),a=HH(a,b,c,d,m[_i+13],4,681279174),d=HH(d,a,b,c,m[_i+0],11,-358537222),c=HH(c,d,a,b,m[_i+3],16,-722521979),b=HH(b,c,d,a,m[_i+6],23,76029189),a=HH(a,b,c,d,m[_i+9],4,-640364487),d=HH(d,a,b,c,m[_i+12],11,-421815835),c=HH(c,d,a,b,m[_i+15],16,530742520),a=II(a,b=HH(b,c,d,a,m[_i+2],23,-995338651),c,d,m[_i+0],6,-198630844),d=II(d,a,b,c,m[_i+7],10,1126891415),c=II(c,d,a,b,m[_i+14],15,-1416354905),b=II(b,c,d,a,m[_i+5],21,-57434055),a=II(a,b,c,d,m[_i+12],6,1700485571),d=II(d,a,b,c,m[_i+3],10,-1894986606),c=II(c,d,a,b,m[_i+10],15,-1051523),b=II(b,c,d,a,m[_i+1],21,-2054922799),a=II(a,b,c,d,m[_i+8],6,1873313359),d=II(d,a,b,c,m[_i+15],10,-30611744),c=II(c,d,a,b,m[_i+6],15,-1560198380),b=II(b,c,d,a,m[_i+13],21,1309151649),a=II(a,b,c,d,m[_i+4],6,-145523070),d=II(d,a,b,c,m[_i+11],10,-1120210379),c=II(c,d,a,b,m[_i+2],15,718787259),b=II(b,c,d,a,m[_i+9],21,-343485551),a=a+aa&gt;&gt;&gt;0,b=b+bb&gt;&gt;&gt;0,c=c+cc&gt;&gt;&gt;0,d=d+dd&gt;&gt;&gt;0&#125;return hex.encode(wordsToBytes(function endian(n)&#123;if(n.constructor==Number)return 16711935&amp;rotl(n,8)|4278255360&amp;rotl(n,24);for(var i=0;i&lt;n.length;i++)n[i]=endian(n[i]);return n&#125;([a,b,c,d])))&#125;&#125;),mergeSort=createCommonjsModule(function(module,exports)&#123;exports=function(arr)&#123;var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator;if(arr.length&lt;=1)return arr;var middle=floor(arr.length/2),left=arr.slice(0,middle),middle=arr.slice(middle);return function(left,right,cmp)&#123;var ret=[],i=0,j=0;for(;i&lt;left.length&amp;&amp;j&lt;right.length;)cmp(left[i],right[j])&lt;0?ret.push(left[i++]):ret.push(right[j++]);for(;i&lt;left.length;)ret.push(left[i++]);for(;j&lt;right.length;)ret.push(right[j++]);return ret&#125;(exports(left,cmp),exports(middle,cmp),cmp)&#125;;var floor=Math.floor;module.exports=exports&#125;),meta=createCommonjsModule(function(module,exports)&#123;(exports=function(name,content)&#123;if(isUndef(name))return ret=&#123;&#125;,metaEach(function(name,content)&#123;ret[name]=content&#125;),ret;var ret;if(isStr(name)&amp;&amp;isUndef(content)||isArr(name))return function(name)&#123;&#123;var ret;&#123;if(!isStr(name))return ret=&#123;&#125;,metaEach(function(key,val)&#123;contain(name,key)&amp;&amp;(ret[key]=val)&#125;),ret;var meta=selectMeta(name);if(meta)return meta.getAttribute(&quot;content&quot;)&#125;&#125;&#125;(name);var metas=name;isObj(metas)||((metas=&#123;&#125;)[name]=content),function(metas)&#123;each(metas,function(content,name)&#123;var meta=selectMeta(name);if(meta)return meta.setAttribute(&quot;content&quot;,content);(meta=doc.createElement(&quot;meta&quot;)).setAttribute(&quot;name&quot;,name),meta.setAttribute(&quot;content&quot;,content),doc.head.appendChild(meta)&#125;)&#125;(metas)&#125;).remove=function(nameList)&#123;nameList=toArr(nameList),each(nameList,function(name)&#123;name=selectMeta(name);name&amp;&amp;doc.head.removeChild(name)&#125;)&#125;;var doc=document;function metaEach(fn)&#123;var metaList=doc.querySelectorAll(&quot;meta&quot;);each(metaList,function(meta)&#123;var name=meta.getAttribute(&quot;name&quot;),meta=meta.getAttribute(&quot;content&quot;);name&amp;&amp;meta&amp;&amp;fn(name,meta)&#125;)&#125;function selectMeta(name)&#123;return doc.querySelector(&apos;meta[name=&quot;&apos;+name+&apos;&quot;]&apos;)&#125;module.exports=exports&#125;),meta_1=meta.remove,methods=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;var key,ret=[];for(key in obj)isFn(obj[key])&amp;&amp;ret.push(key);return ret.sort()&#125;&#125;),min=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var arr=arguments,ret=arr[0],i=1,len=arr.length;i&lt;len;i++)arr[i]&lt;ret&amp;&amp;(ret=arr[i]);return ret&#125;&#125;),toDate=createCommonjsModule(function(module,exports)&#123;var regDate=/^(\d&#123;4&#125;)-?(\d&#123;2&#125;)-?(\d&#123;1,2&#125;)$/;module.exports=function(val)&#123;if(!val)return new Date;if(isDate(val))return val;if(isStr(val))&#123;var match=val.match(regDate);if(match)return new Date(match[1],match[2]-1,match[3])&#125;return new Date(val)&#125;&#125;),moment=createCommonjsModule(function(module,exports)&#123;exports=function(val)&#123;return new Moment(val)&#125;;var Moment=Class(&#123;initialize:function(val)&#123;this._d=toDate(val),this._init()&#125;,_init:function()&#123;var d=this._d;return extend(this,&#123;_year:d.getFullYear(),_month:d.getMonth(),_date:d.getDate(),_hour:d.getHours(),_minute:d.getMinutes(),_second:d.getSeconds(),_millisecond:d.getMilliseconds()&#125;),this&#125;,format:function(mask)&#123;return dateFormat(this._d,mask)&#125;,isValid:function()&#123;return!(&quot;Invalid Date&quot;===this._d.toString())&#125;,isLeapYear:function()&#123;return isLeapYear(this._year)&#125;,isSame:function(that)&#123;return this.valueOf()===that.valueOf()&#125;,valueOf:function()&#123;return this._d.getTime()&#125;,isBefore:function(that)&#123;return this.valueOf()&lt;that.valueOf()&#125;,isAfter:function(that)&#123;return this.valueOf()&gt;that.valueOf()&#125;,year:makeGetSet(&quot;year&quot;),month:makeGetSet(&quot;month&quot;),date:makeGetSet(&quot;date&quot;),hour:makeGetSet(&quot;hour&quot;),minute:makeGetSet(&quot;minute&quot;),second:makeGetSet(&quot;second&quot;),millisecond:makeGetSet(&quot;millisecond&quot;),unix:function()&#123;return floor(this.valueOf()/1e3)&#125;,clone:function()&#123;return new Moment(this)&#125;,toDate:function()&#123;return new Date(this._d)&#125;,toArray:function()&#123;return[this._year,this._month,this._date,this._hour,this._minute,this._second,this._millisecond]&#125;,toJSON:function()&#123;return this.toISOString()&#125;,toISOString:function()&#123;return this.toDate().toISOString()&#125;,toObject:function()&#123;return&#123;years:this._year,months:this._month,date:this._date,hours:this._hour,minutes:this._minute,seconds:this._second,milliseconds:this._millisecond&#125;&#125;,toString:function()&#123;return this._d.toUTCString()&#125;,set:function(unit,num)&#123;var d=this._d;switch(unit=normalizeUnit(unit))&#123;case&quot;year&quot;:d.setFullYear(num);break;case&quot;month&quot;:d.setMonth(num);break;case&quot;date&quot;:d.setDate(num);break;case&quot;hour&quot;:d.setHours(num);break;case&quot;minute&quot;:d.setMinutes(num);break;case&quot;second&quot;:d.setSeconds(num);break;case&quot;millisecond&quot;:d.setMilliseconds(num)&#125;return this._init()&#125;,startOf:function(unit)&#123;switch(unit=normalizeUnit(unit))&#123;case&quot;year&quot;:this.month(0);case&quot;month&quot;:this.date(1);case&quot;day&quot;:case&quot;date&quot;:this.hour(0);case&quot;hour&quot;:this.minute(0);case&quot;minute&quot;:this.second(0);case&quot;second&quot;:this.millisecond(0)&#125;return this&#125;,endOf:function(unit)&#123;return this.startOf(unit).add(1,unit).subtract(1,&quot;ms&quot;)&#125;,daysInMonth:function()&#123;return this.clone().endOf(&quot;month&quot;).date()&#125;,add:createAdder(1),subtract:createAdder(-1),diff:function(input,unit,asFloat)&#123;var ret,that=input instanceof Moment?input:new Moment(input),diff=this-that;switch(unit=normalizeUnit(unit))&#123;case&quot;year&quot;:ret=monthDiff(this,that)/12;break;case&quot;month&quot;:ret=monthDiff(this,that);break;case&quot;second&quot;:ret=diff/1e3;break;case&quot;minute&quot;:ret=diff/6e4;break;case&quot;hour&quot;:ret=diff/36e5;break;case&quot;day&quot;:ret=diff/864e5;break;default:ret=diff&#125;return asFloat?ret:(input=ret)&lt;0?ceil(input)||0:floor(input)&#125;&#125;),floor=Math.floor,ceil=Math.ceil;var unitShorthandMap=&#123;y:&quot;year&quot;,M:&quot;month&quot;,D:&quot;date&quot;,d:&quot;day&quot;,h:&quot;hour&quot;,m:&quot;minute&quot;,s:&quot;second&quot;,ms:&quot;millisecond&quot;&#125;,regEndS=/s$/;function normalizeUnit(unit)&#123;return unit=toStr(unit),unitShorthandMap[unit]||unit.toLowerCase().replace(regEndS,&quot;&quot;)&#125;function makeGetSet(unit)&#123;return function(num)&#123;return isNil(num)?this[&quot;_&quot;+unit]:this.set(unit,num)&#125;&#125;function createAdder(dir)&#123;return function(num,unit)&#123;if(&quot;month&quot;===(unit=normalizeUnit(unit)))return this.month(this._month+dir*num);if(&quot;year&quot;===unit)return this.year(this._year+dir*num);num=function(num,unit)&#123;return ms(num+msMap[unit])&#125;(num,unit);return this._d=new Date(this.valueOf()+dir*num),this._init()&#125;&#125;var msMap=&#123;day:&quot;d&quot;,hour:&quot;h&quot;,minute:&quot;m&quot;,second:&quot;s&quot;,millisecond:&quot;&quot;&#125;;function monthDiff(a,b)&#123;var wholeMonthDiff=12*(b.year()-a.year())+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,&quot;months&quot;),b=b-anchor&lt;0?(b-anchor)/(anchor-a.clone().add(wholeMonthDiff-1,&quot;months&quot;)):(b-anchor)/(a.clone().add(1+wholeMonthDiff,&quot;months&quot;)-anchor);return-(wholeMonthDiff+b)||0&#125;module.exports=exports&#125;),toEl=createCommonjsModule(function(module,exports)&#123;var range,doc=document;exports=function(str)&#123;var fragment=doc.createElement(&quot;body&quot;);return fragment.innerHTML=str,fragment.childNodes[0]&#125;,doc.createRange&amp;&amp;doc.body&amp;&amp;((range=doc.createRange()).selectNode(doc.body),range.createContextualFragment&amp;&amp;(exports=function(str)&#123;return range.createContextualFragment(str).childNodes[0]&#125;)),module.exports=exports&#125;),morphDom=createCommonjsModule(function(module,exports)&#123;var ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8;function morphEl(from,to)&#123;!function(from,to)&#123;var attrs=to.attributes,removedAttrNames=(each(attrs,function(_ref)&#123;var name=_ref.name,_ref=_ref.value;from.getAttribute(name)!==_ref&amp;&amp;from.setAttribute(name,_ref)&#125;),attrs=from.attributes,[]);each(attrs,function(_ref2)&#123;_ref2=_ref2.name;isNull(to.getAttribute(_ref2))&amp;&amp;removedAttrNames.push(_ref2)&#125;),each(removedAttrNames,function(name)&#123;return from.removeAttribute(name)&#125;)&#125;(from,to),function(from,to)&#123;var toNextSibling,fromNextSibling,curToChild=to.firstChild,curFromChild=from.firstChild;outer:for(;curToChild;)&#123;for(toNextSibling=curToChild.nextSibling;curFromChild;)&#123;fromNextSibling=curFromChild.nextSibling;var isCompatible=!1,curFromType=curFromChild.nodeType,curToType=curToChild.nodeType;if(curFromType===curToType&amp;&amp;(curFromType===ELEMENT_NODE?curFromChild.nodeName===curToChild.nodeName&amp;&amp;(isCompatible=!0,morphEl(curFromChild,curToChild)):curFromType!==TEXT_NODE&amp;&amp;curFromType!==COMMENT_NODE||(isCompatible=!0,curFromChild.nodeValue!==curToChild.nodeValue&amp;&amp;(curFromChild.nodeValue=curToChild.nodeValue))),isCompatible)&#123;curToChild=toNextSibling,curFromChild=fromNextSibling;continue outer&#125;from.removeChild(curFromChild),curFromChild=fromNextSibling&#125;from.appendChild(curToChild),curFromChild=fromNextSibling,curToChild=toNextSibling&#125;if(curFromChild)for(;curFromChild;)fromNextSibling=curFromChild.nextSibling,from.removeChild(curFromChild),curFromChild=fromNextSibling&#125;(from,to)&#125;module.exports=function(from,to)&#123;isStr(to)&amp;&amp;(to=toEl(to));var morphed=from,morphedType=morphed.nodeType;if(morphedType===to.nodeType)&#123;if(morphedType===ELEMENT_NODE)morphed.nodeName!==to.nodeName&amp;&amp;function(from,to)&#123;var curChild=from.firstChild;for(;curChild;)&#123;var nextChild=curChild.nextSibling;to.appendChild(curChild),curChild=nextChild&#125;&#125;(from,morphed=h(to.nodeName));else if(morphedType===TEXT_NODE||morphedType===COMMENT_NODE)return morphed.nodeValue!==to.nodeValue&amp;&amp;(morphed.nodeValue=to.nodeValue),morphed&#125;else morphed=to;return morphed!==to&amp;&amp;morphEl(morphed,to),from.parentNode&amp;&amp;from.parentNode.replaceChild(morphed,from),morphed&#125;&#125;),upperCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return toStr(str).toLocaleUpperCase()&#125;&#125;),morse=createCommonjsModule(function(module,exports)&#123;exports=&#123;encode:function(txt)&#123;for(var len=txt.length,ret=Array(len),i=0;i&lt;len;i++)&#123;var c=upperCase(txt[i]);ret[i]=map[c]||&quot;?&quot;&#125;return ret.join(&quot; &quot;)&#125;,decode:function(morse)&#123;for(var ret=morse.split(&quot; &quot;),i=0,len=ret.length;i&lt;len;i++)ret[i]=decodeMap[ret[i]]||&quot; &quot;;return ret.join(&quot;&quot;)&#125;&#125;;var map=&#123;A:&quot;.-&quot;,B:&quot;-...&quot;,C:&quot;-.-.&quot;,D:&quot;-..&quot;,E:&quot;.&quot;,F:&quot;..-.&quot;,G:&quot;--.&quot;,H:&quot;....&quot;,I:&quot;..&quot;,J:&quot;.---&quot;,K:&quot;-.-&quot;,L:&quot;.-..&quot;,M:&quot;--&quot;,N:&quot;-.&quot;,O:&quot;---&quot;,P:&quot;.--.&quot;,Q:&quot;--.-&quot;,R:&quot;.-.&quot;,S:&quot;...&quot;,T:&quot;-&quot;,U:&quot;..-&quot;,V:&quot;...-&quot;,W:&quot;.--&quot;,X:&quot;-..-&quot;,Y:&quot;-.--&quot;,Z:&quot;--..&quot;,&quot;Á&quot;:&quot;.--.-&quot;,&quot;Ä&quot;:&quot;.-.-&quot;,&quot;É&quot;:&quot;..-..&quot;,&quot;Ñ&quot;:&quot;--.--&quot;,&quot;Ö&quot;:&quot;---.&quot;,&quot;Ü&quot;:&quot;..--&quot;,1:&quot;.----&quot;,2:&quot;..---&quot;,3:&quot;...--&quot;,4:&quot;....-&quot;,5:&quot;.....&quot;,6:&quot;-....&quot;,7:&quot;--...&quot;,8:&quot;---..&quot;,9:&quot;----.&quot;,0:&quot;-----&quot;,&quot;,&quot;:&quot;--..--&quot;,&quot;.&quot;:&quot;.-.-.-&quot;,&quot;?&quot;:&quot;..--..&quot;,&quot;;&quot;:&quot;-.-.-&quot;,&quot;:&quot;:&quot;---...&quot;,&quot;/&quot;:&quot;-..-.&quot;,&quot;-&quot;:&quot;-....-&quot;,&quot;&apos;&quot;:&quot;.----.&quot;,&quot;()&quot;:&quot;-.--.-&quot;,_:&quot;..--.-&quot;,&quot;@&quot;:&quot;.--.-.&quot;,&quot; &quot;:&quot;.......&quot;&#125;,decodeMap=invert(map);module.exports=exports&#125;),naturalSort=createCommonjsModule(function(module,exports)&#123;function naturalOrderComparator(a,b)&#123;if(a=toStr(a),b=toStr(b),startWith(a,&quot;_&quot;)&amp;&amp;!startWith(b,&quot;_&quot;))return 1;if(startWith(b,&quot;_&quot;)&amp;&amp;!startWith(a,&quot;_&quot;))return-1;for(var chunka,chunkb,bnum,chunk=/^\d+|^\D+/;;)&#123;if(!a)return b?-1:0;if(!b)return 1;if(chunka=a.match(chunk)[0],chunkb=b.match(chunk)[0],anum=!root.isNaN(chunka),bnum=!root.isNaN(chunkb),anum&amp;&amp;!bnum)return-1;if(bnum&amp;&amp;!anum)return 1;if(anum&amp;&amp;bnum)&#123;var anum=chunka-chunkb;if(anum)return anum;if(chunka.length!==chunkb.length)return+chunka||+chunkb?chunkb.length-chunka.length:chunka.length-chunkb.length&#125;else if(chunka!==chunkb)return chunka&lt;chunkb?-1:1;a=a.substring(chunka.length),b=b.substring(chunkb.length)&#125;&#125;module.exports=function(arr)&#123;return arr.sort(naturalOrderComparator)&#125;&#125;),negate=createCommonjsModule(function(module,exports)&#123;module.exports=function(predicate)&#123;return function()&#123;return!predicate.apply(this,arguments)&#125;&#125;&#125;),normalizeHeader=createCommonjsModule(function(module,exports)&#123;var specialHeaders=&#123;&quot;content-md5&quot;:&quot;Content-MD5&quot;,dnt:&quot;DNT&quot;,etag:&quot;ETag&quot;,&quot;last-event-id&quot;:&quot;Last-Event-ID&quot;,tcn:&quot;TCN&quot;,te:&quot;TE&quot;,&quot;www-authenticate&quot;:&quot;WWW-Authenticate&quot;,&quot;x-dnsprefetch-control&quot;:&quot;X-DNSPrefetch-Control&quot;&#125;;module.exports=function(header)&#123;return specialHeaders[header.toLowerCase()]||map(header.split(&quot;-&quot;),capitalize).join(&quot;-&quot;)&#125;&#125;),normalizePath=createCommonjsModule(function(module,exports)&#123;var regSlashes=/[\\/]+/g;module.exports=function(path)&#123;return path.replace(regSlashes,&quot;/&quot;)&#125;&#125;),normalizePhone=createCommonjsModule(function(module,exports)&#123;var regPlusSign=/^\+/,regNotDigit=/\D/g,regTrunkPrefix=/^\d/;module.exports=function(phone,options)&#123;phone=trim(phone);var countryCode=options.countryCode,options=options.trunkPrefix,options=void 0!==options&amp;&amp;options,plusSign=regPlusSign.test(phone);return phone=phone.replace(regNotDigit,&quot;&quot;),plusSign&amp;&amp;(phone=phone.replace(new RegExp(&quot;^&quot;.concat(countryCode)),&quot;&quot;)),options&amp;&amp;(phone=phone.replace(regTrunkPrefix,&quot;&quot;)),&quot;+&quot;.concat(countryCode+phone)&#125;&#125;),notify=createCommonjsModule(function(module,exports)&#123;var Notification=root.Notification;(exports=function(title,options)&#123;new exports.Notification(title,options).show()&#125;).Notification=Emitter.extend(&#123;initialize:function(title)&#123;this._options=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,this._title=title,this.callSuper(Emitter,&quot;initialize&quot;,arguments)&#125;,handleEvent:function(e)&#123;this.emit(e.type,e)&#125;,show:function()&#123;var _this=this;if(!Notification)return this.emit(&quot;error&quot;,Error(&quot;Notification is not supported&quot;));&quot;granted&quot;===Notification.permission?this._show():Notification.requestPermission(function(permission)&#123;switch(permission)&#123;case&quot;granted&quot;:_this._show();break;case&quot;denied&quot;:_this.emit(&quot;error&quot;,Error(&quot;Notification permission is denied&quot;))&#125;&#125;)&#125;,_show:function()&#123;var _this2=this,notification=new Notification(this._title,this._options);each([&quot;show&quot;,&quot;close&quot;,&quot;click&quot;],function(type)&#123;notification.addEventListener(type,_this2,!1)&#125;)&#125;&#125;),module.exports=exports&#125;),notify_1=notify.Notification,pick=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,filter,omit)&#123;isStr(filter)&amp;&amp;(filter=[filter]),isArr(filter)&amp;&amp;(keys=filter,filter=function(val,key)&#123;return contain(keys,key)&#125;);var keys,ret=&#123;&#125;;return each(obj,omit?function(val,key)&#123;filter(val,key)||(ret[key]=val)&#125;:function(val,key)&#123;filter(val,key)&amp;&amp;(ret[key]=val)&#125;),ret&#125;&#125;),omit=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,filter)&#123;return pick(obj,filter,!0)&#125;&#125;),openFile=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;var options=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:&#123;&#125;;return new Promise(function(resolve)&#123;var input=document.createElement(&quot;input&quot;);input.style.position=&quot;fixed&quot;,input.style.bottom=&quot;0&quot;,input.style.left=&quot;0&quot;,input.style.visibility=&quot;hidden&quot;,input.setAttribute(&quot;type&quot;,&quot;file&quot;),options.accept&amp;&amp;input.setAttribute(&quot;accept&quot;,options.accept),options.multiple&amp;&amp;input.setAttribute(&quot;multiple&quot;,&quot;&quot;),document.body.appendChild(input),input.addEventListener(&quot;change&quot;,function()&#123;document.body.removeChild(input),resolve(input.files)&#125;),input.click()&#125;)&#125;&#125;),ordinal=createCommonjsModule(function(module,exports)&#123;module.exports=function(num)&#123;var j=num%10,k=num%100;return num+(3==j&amp;&amp;13!=k?&quot;rd&quot;:2==j&amp;&amp;12!=k?&quot;nd&quot;:1==j&amp;&amp;11!=k?&quot;st&quot;:&quot;th&quot;)&#125;&#125;),orientation=createCommonjsModule(function(module,exports)&#123;var screen=window.screen;exports=&#123;get:function()&#123;if(screen)&#123;var orientation=safeGet(screen,&quot;orientation.type&quot;);if(orientation)return orientation.split(&quot;-&quot;).shift()&#125;return window.innerWidth&gt;window.innerHeight?&quot;landscape&quot;:&quot;portrait&quot;&#125;&#125;,Emitter.mixin(exports),window.addEventListener(&quot;orientationchange&quot;,function()&#123;setTimeout(function()&#123;exports.emit(&quot;change&quot;,exports.get())&#125;,200)&#125;,!1),module.exports=exports&#125;),pad=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,len,chars)&#123;var strLen=(str=toStr(str)).length;return chars=chars||&quot; &quot;,str=strLen&lt;len?(str=(chars=repeat(chars,Math.ceil((len-strLen)/2)))+str+chars).substr(Math.ceil((str.length-len)/2),len):str&#125;&#125;),pairs=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;for(var _keys=keys(obj),len=_keys.length,ret=Array(len),i=0;i&lt;len;i++)ret[i]=[_keys[i],obj[_keys[i]]];return ret&#125;&#125;),parallel=createCommonjsModule(function(module,exports)&#123;module.exports=function(tasks,cb)&#123;cb=cb||noop;var results=[],pending=tasks.length;if(!pending)return done(null);function done(err)&#123;nextTick(function()&#123;cb(err,results),cb=noop&#125;)&#125;each(tasks,function(task,i)&#123;task(function(err,result)&#123;!function(i,err,result)&#123;results[i]=result,0!=--pending&amp;&amp;!err||done(err)&#125;(i,err,result)&#125;)&#125;)&#125;&#125;),parseArgs=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;names:&#123;&#125;,shorthands:&#123;&#125;&#125;,regDoubleDash=/^--(.+)/,regSingleDash=/^-([^-]+)/,regDashStart=/^-/;module.exports=function(args,opts)&#123;defaults(opts=opts||&#123;&#125;,defOpts);for(var type,names=opts.names,shorthands=invert(opts.shorthands),remain=[],ret=&#123;remain:remain&#125;,i=0,len=args.length;i&lt;len;i++)&#123;var arg=args[i],nextArg=args[i+1],match=arg.match(regDoubleDash);if(match)name=match[1],(type=names[name])?nextArg&amp;&amp;!regDashStart.test(nextArg)?(setArg(name,nextArg),i++):&quot;boolean&quot;===type&amp;&amp;(setArg(name,!0),i++):remain.push(arg);else if(match=arg.match(regSingleDash))for(var letters=match[1],j=0;j&lt;letters.length;j++)&#123;var name,letter=letters[j];(name=shorthands[letter])&amp;&amp;&quot;boolean&quot;===(type=names[name])&amp;&amp;setArg(shorthands[letter],!0)&#125;else remain.push(arg)&#125;function setArg(name,val)&#123;switch(names[name])&#123;case&quot;number&quot;:val=toNum(val);break;case&quot;boolean&quot;:val=toBool(val)&#125;ret[name]=val&#125;return ret&#125;&#125;),pascalCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return upperFirst(camelCase(str))&#125;&#125;),prefetch=createCommonjsModule(function(module,exports)&#123;var link=document.createElement(&quot;link&quot;),link=(link.relList||&#123;&#125;).supports&amp;&amp;link.relList.supports(&quot;prefetch&quot;);module.exports=link?function(url)&#123;return new Promise(function(resolve,reject)&#123;var link=document.createElement(&quot;link&quot;);link.rel=&quot;prefetch&quot;,link.href=url,link.onload=resolve,link.onerror=reject,document.head.appendChild(link)&#125;)&#125;:function(url)&#123;return new Promise(function(resolve,reject)&#123;var req=new XMLHttpRequest;req.open(&quot;GET&quot;,url,req.withCredentials=!0),req.onload=function()&#123;(200===req.status?resolve:reject)()&#125;,req.send()&#125;)&#125;&#125;),promisify=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,multiArgs)&#123;return restArgs(function(args)&#123;return new root.Promise(function(resolve,reject)&#123;args.push(restArgs(function(err,values)&#123;return err?reject(err):multiArgs?void resolve(values):resolve(values[0])&#125;)),fn.apply(this,args)&#125;)&#125;)&#125;&#125;),quickSort_1=createCommonjsModule(function(module,exports)&#123;function partition(arr,left,right,cmp)&#123;for(var pivot=arr[floor((right+left)/2)];left&lt;=right;)&#123;for(;cmp(arr[left],pivot)&lt;0;)left++;for(;0&lt;cmp(arr[right],pivot);)right--;left&lt;=right&amp;&amp;(swap(arr,left,right),left++,right--)&#125;return left&#125;var floor=Math.floor;module.exports=function(arr)&#123;var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator;return function quickSort(arr,left,right,cmp)&#123;if(arr.length&lt;=1)return arr;var idx=partition(arr,left,right,cmp);left&lt;idx-1&amp;&amp;quickSort(arr,left,idx-1,cmp);idx&lt;right&amp;&amp;quickSort(arr,idx,right,cmp);return arr&#125;(arr,0,arr.length-1,cmp)&#125;&#125;),random=createCommonjsModule(function(module,exports)&#123;module.exports=function(min,max,floating)&#123;null==max&amp;&amp;(max=min,min=0);var rand=Math.random();return floating||min%1||max%1?Math.min(min+rand*(max-min+parseFloat(&quot;1e-&quot;+((rand+&quot;&quot;).length-1))),max):min+Math.floor(rand*(max-min+1))&#125;&#125;),randomBytes=createCommonjsModule(function(module,exports)&#123;var crypto;exports=function(size)&#123;for(var ret=new Uint8Array(size),i=0;i&lt;size;i++)ret[i]=random(0,255);return ret&#125;,isBrowser?(crypto=window.crypto||window.msCrypto,crypto&amp;&amp;(exports=function(size)&#123;size=new Uint8Array(size);return crypto.getRandomValues(size),size&#125;)):isNode&amp;&amp;(crypto=eval(&quot;require&quot;)(&quot;crypto&quot;),exports=function(size)&#123;return crypto.randomBytes(size)&#125;),module.exports=exports&#125;),seedRandom=createCommonjsModule(function(module,exports)&#123;module.exports=function(seed)&#123;var min=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:0,max=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:1,floating=!(3&lt;arguments.length&amp;&amp;void 0!==arguments[3])||arguments[3];return function()&#123;var rnd=min+(seed=(9301*seed+49297)%233280)/233280*(max-min);return floating?rnd:Math.floor(rnd)&#125;&#125;&#125;),randomColor=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;count:1,format:&quot;hex&quot;&#125;;module.exports=exports=function()&#123;var options=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:&#123;&#125;,count=(defaults(options,defOpts),options.count),randomH=options.randomH,randomL=options.randomL,randomS=options.randomS;if(isFn(randomH)||(seed=options.seed||random(0,1e5),randomH=seedRandom(seed,0,360,!1),randomL=seedRandom(seed+1,0,1),randomS=seedRandom(seed+2,0,1)),1&lt;count)&#123;for(var colors=[],i=0;i&lt;count;i++)colors.push(exports(defaults(&#123;count:1,randomH:randomH,randomL:randomL,randomS:randomS&#125;,options)));return colors&#125;var seed=options.hue||randomH(),lightness=options.lightness||randomL().toFixed(2),saturation=options.saturation||randomS().toFixed(2),color=new Color(&#123;val:[seed,Math.round(100*saturation),Math.round(100*lightness)],model:&quot;hsl&quot;&#125;);switch(options.format)&#123;case&quot;hsl&quot;:return color.toHsl();case&quot;rgb&quot;:return color.toRgb();default:return color.toHex()&#125;&#125;&#125;),randomId=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var size=0&lt;arguments.length&amp;&amp;void 0!==arguments[0]?arguments[0]:21,symbols=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&quot;ModuleSymbhasOwnPr-0123456789ABCDEFGHIJKLNQRTUVWXYZ_cfgijkpqtvxz&quot;,id=&quot;&quot;,len=symbols.length,bytes=randomBytes(21);0&lt;size--;)id+=symbols[bytes[size]%len];return id&#125;&#125;),randomItem=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;return arr[random(0,arr.length-1)]&#125;&#125;),range=createCommonjsModule(function(module,exports)&#123;module.exports=function(start,end,step)&#123;null==end&amp;&amp;(end=start||0,start=0),step=step||(end&lt;start?-1:1);for(var len=Math.max(Math.ceil((end-start)/step),0),ret=Array(len),i=0;i&lt;len;i++,start+=step)ret[i]=start;return ret&#125;&#125;),rc4_1=createCommonjsModule(function(module,exports)&#123;function rc4(key,str,decrypt)&#123;key=strToBytes(key),str=decrypt?base64.decode(str):strToBytes(str);for(var x,result=[],s=[],j=0,i=0,i=0;i&lt;256;i++)s[i]=i;for(i=0;i&lt;256;i++)j=(j+s[i]+key[i%key.length])%256,x=s[i],s[i]=s[j],s[j]=x;for(var j=i=0,y=0,len=str.length;y&lt;len;y++)j=(j+s[i=(i+1)%256])%256,x=s[i],s[i]=s[j],s[j]=x,result.push(str[y]^s[(s[i]+s[j])%256]);return decrypt?bytesToStr(result):base64.encode(result)&#125;module.exports=&#123;encrypt:function(key,str)&#123;return rc4(key,str,!1)&#125;,decrypt:function(key,str)&#123;return rc4(key,str,!0)&#125;&#125;&#125;),ready=createCommonjsModule(function(module,exports)&#123;var listener,fns=[],doc=document,hack=doc.documentElement.doScroll,loaded=(hack?/^loaded|^c/:/^loaded|^i|^c/).test(doc.readyState);loaded||doc.addEventListener(&quot;DOMContentLoaded&quot;,listener=function()&#123;for(doc.removeEventListener(&quot;DOMContentLoaded&quot;,listener),loaded=1;listener=fns.shift();)listener()&#125;),module.exports=function(fn)&#123;loaded?setTimeout(fn,0):fns.push(fn)&#125;&#125;),reduceRight=createCommonjsModule(function(module,exports)&#123;exports=reduce.create(-1),module.exports=exports&#125;),reject=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,predicate,ctx)&#123;return predicate=safeCb(negate(predicate),ctx),filter(obj,predicate)&#125;&#125;),replaceAll=createCommonjsModule(function(module,exports)&#123;module.exports=function(str,substr,newSubstr)&#123;return str.replace(new RegExp(escapeRegExp(substr),&quot;g&quot;),newSubstr)&#125;&#125;),ric=createCommonjsModule(function(module,exports)&#123;(exports=root.requestIdleCallback||function(cb)&#123;var start=now();return setTimeout(function()&#123;cb(&#123;didTimeout:!1,timeRemaining:function()&#123;return Math.max(0,50-(now()-start))&#125;&#125;)&#125;,1)&#125;).cancel=root.cancelIdleCallback||function(id)&#123;clearTimeout(id)&#125;,module.exports=exports&#125;),ric_1=ric.cancel,rmCookie=createCommonjsModule(function(module,exports)&#123;module.exports=function(key)&#123;var path,location=window.location,hostname=location.hostname,location=location.pathname,hostNames=hostname.split(&quot;.&quot;),pathNames=location.split(&quot;/&quot;),domain=&quot;&quot;,pathLen=pathNames.length;if(!del())for(var i=hostNames.length-1;0&lt;=i;i--)&#123;var hostName=hostNames[i];if(&quot;&quot;!==hostName)&#123;if(del(&#123;domain:domain=&quot;&quot;===domain?hostName:hostName+&quot;.&quot;+domain,path:path=&quot;/&quot;&#125;)||del(&#123;domain:domain&#125;))return;for(var j=0;j&lt;pathLen;j++)&#123;var pathName=pathNames[j];if(&quot;&quot;!==pathName)&#123;if(del(&#123;domain:domain,path:path+=pathName&#125;)||del(&#123;path:path&#125;))return;if(del(&#123;domain:domain,path:path+=&quot;/&quot;&#125;)||del(&#123;path:path&#125;))return&#125;&#125;&#125;&#125;function del(options)&#123;return cookie.remove(key,options=options||&#123;&#125;),!cookie.get(key)&#125;&#125;&#125;),sameOrigin=createCommonjsModule(function(module,exports)&#123;module.exports=function(url1,url2)&#123;return url1=new Url(url1),url2=new Url(url2),url1.port=0|url1.port||(&quot;https&quot;===url1.protocol?443:80),url2.port=0|url2.port||(&quot;https&quot;===url2.protocol?443:80),url1.protocol===url2.protocol&amp;&amp;url1.hostname===url2.hostname&amp;&amp;url1.port===url2.port&#125;&#125;),sample=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,n)&#123;for(var sample=(isArrLike(obj)?clone:values)(obj),obj=sample.length,last=(n=Math.max(Math.min(n,obj),0),obj-1),i=0;i&lt;n;i++)&#123;var rand=random(i,last);swap(sample,i,rand)&#125;return sample.slice(0,n)&#125;&#125;),scrollTo=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;tolerance:0,duration:800,easing:&quot;outQuart&quot;,callback:noop&#125;;module.exports=function(target,options)&#123;defaults(options=options||&#123;&#125;,defOpts),isNum(target)||(target=$offset(target).top),new Tween(&#123;y:window.pageYOffset&#125;).on(&quot;update&quot;,function(target)&#123;window.scroll(0,target.y)&#125;).on(&quot;end&quot;,function()&#123;options.callback()&#125;).to(&#123;y:target-options.tolerance&#125;,options.duration,options.easing).play()&#125;&#125;),selectionSort=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator,i=0,len=arr.length;i&lt;len;i++)&#123;for(var min=i,j=i+1;j&lt;len;j++)cmp(arr[j],arr[min])&lt;0&amp;&amp;(min=j);i!=min&amp;&amp;swap(arr,i,min)&#125;return arr&#125;&#125;),shebang=createCommonjsModule(function(module,exports)&#123;var regShebang=/^#!(.*)/;module.exports=function(str)&#123;str=str.match(regShebang);if(str)return trim(str[1])&#125;&#125;),shellSort=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var cmp=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:isSorted.defComparator,len=arr.length,gap=Math.floor(len/2);0&lt;gap;)&#123;for(var i=gap;i&lt;=len-gap;i++)for(var j=i;0&lt;j&amp;&amp;cmp(arr[j],arr[j-gap])&lt;0;j-=gap)swap(arr,j,j-gap);gap=Math.floor(gap/2)&#125;return arr&#125;&#125;),shuffle=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj)&#123;return sample(obj,1/0)&#125;&#125;),sizeof_1=createCommonjsModule(function(module,exports)&#123;var strSize=2,boolSize=4,numSize=8;module.exports=function(obj)&#123;return function sizeof(obj,_ref)&#123;var values=_ref.values;_ref=typeof obj;if(&quot;string&quot;==_ref)return obj.length*strSize;if(&quot;number&quot;==_ref)return numSize;if(&quot;boolean&quot;==_ref)return boolSize;var size=0;if(&quot;object&quot;==_ref&amp;&amp;!isNull(obj))&#123;if(-1&lt;values.indexOf(obj))return 0;if(values.push(obj),isArr(obj))for(var i=0,len=obj.length;i&lt;len;i++)size+=sizeof(obj[i],&#123;values:values&#125;);else for(var _keys=keys(obj),_i=0,_len=_keys.length;_i&lt;_len;_i++)&#123;var key=_keys[_i];size=(size+=key.length*strSize)+sizeof(obj[key],&#123;values:values&#125;)&#125;&#125;if(isBuffer(obj))return obj.length;return size&#125;(obj,&#123;values:[]&#125;)&#125;&#125;),sleep=createCommonjsModule(function(module,exports)&#123;module.exports=function(timeout)&#123;return new Promise(function(resolve)&#123;return setTimeout(resolve,timeout)&#125;)&#125;&#125;),slugify=createCommonjsModule(function(module,exports)&#123;exports=function(str)&#123;var replacement=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;;return defaults(replacement,defReplacement),reduce(str,function(result,char)&#123;return result+(replacement[char]||char)&#125;,&quot;&quot;).replace(regForbidden,&quot;&quot;)&#125;;var regForbidden=/[^\w\s$*_+~.()&apos;&quot;!\-:@]/g,defReplacement=&#123;&#125;;each(&quot;$ dollar,% percent,&amp; and,&lt; less,&gt; greater,| or,¢ cent,£ pound,¤ currency,¥ yen,© (c),ª a,® (r),º o,À A,Á A,Â A,Ã A,Ä A,Å A,Æ AE,Ç C,È E,É E,Ê E,Ë E,Ì I,Í I,Î I,Ï I,Ð D,Ñ N,Ò O,Ó O,Ô O,Õ O,Ö O,Ø O,Ù U,Ú U,Û U,Ü U,Ý Y,Þ TH,ß ss,à a,á a,â a,ã a,ä a,å a,æ ae,ç c,è e,é e,ê e,ë e,ì i,í i,î i,ï i,ð d,ñ n,ò o,ó o,ô o,õ o,ö o,ø o,ù u,ú u,û u,ü u,ý y,þ th,ÿ y,Ā A,ā a,Ă A,ă a,Ą A,ą a,Ć C,ć c,Č C,č c,Ď D,ď d,Đ DJ,đ dj,Ē E,ē e,Ė E,ė e,Ę e,ę e,Ě E,ě e,Ğ G,ğ g,Ģ G,ģ g,Ĩ I,ĩ i,Ī i,ī i,Į I,į i,İ I,ı i,Ķ k,ķ k,Ļ L,ļ l,Ľ L,ľ l,Ł L,ł l,Ń N,ń n,Ņ N,ņ n,Ň N,ň n,Ő O,ő o,Œ OE,œ oe,Ŕ R,ŕ r,Ř R,ř r,Ś S,ś s,Ş S,ş s,Š S,š s,Ţ T,ţ t,Ť T,ť t,Ũ U,ũ u,Ū u,ū u,Ů U,ů u,Ű U,ű u,Ų U,ų u,Ź Z,ź z,Ż Z,ż z,Ž Z,ž z,ƒ f,Ơ O,ơ o,Ư U,ư u,ǈ LJ,ǉ lj,ǋ NJ,ǌ nj,Ș S,ș s,Ț T,ț t,˚ o,Ά A,Έ E,Ή H,Ί I,Ό O,Ύ Y,Ώ W,ΐ i,Α A,Β B,Γ G,Δ D,Ε E,Ζ Z,Η H,Θ 8,Ι I,Κ K,Λ L,Μ M,Ν N,Ξ 3,Ο O,Π P,Ρ R,Σ S,Τ T,Υ Y,Φ F,Χ X,Ψ PS,Ω W,Ϊ I,Ϋ Y,ά a,έ e,ή h,ί i,ΰ y,α a,β b,γ g,δ d,ε e,ζ z,η h,θ 8,ι i,κ k,λ l,μ m,ν n,ξ 3,ο o,π p,ρ r,ς s,σ s,τ t,υ y,φ f,χ x,ψ ps,ω w,ϊ i,ϋ y,ό o,ύ y,ώ w,Ё Yo,Ђ DJ,Є Ye,І I,Ї Yi,Ј J,Љ LJ,Њ NJ,Ћ C,Џ DZ,А A,Б B,В V,Г G,Д D,Е E,Ж Zh,З Z,И I,Й J,К K,Л L,М M,Н N,О O,П P,Р R,С S,Т T,У U,Ф F,Х H,Ц C,Ч Ch,Ш Sh,Щ Sh,Ъ U,Ы Y,Ь ,Э E,Ю Yu,Я Ya,а a,б b,в v,г g,д d,е e,ж zh,з z,и i,й j,к k,л l,м m,н n,о o,п p,р r,с s,т t,у u,ф f,х h,ц c,ч ch,ш sh,щ sh,ъ u,ы y,ь ,э e,ю yu,я ya,ё yo,ђ dj,є ye,і i,ї yi,ј j,љ lj,њ nj,ћ c,џ dz,Ґ G,ґ g,฿ baht,ა a,ბ b,გ g,დ d,ე e,ვ v,ზ z,თ t,ი i,კ k,ლ l,მ m,ნ n,ო o,პ p,ჟ zh,რ r,ს s,ტ t,უ u,ფ f,ქ k,ღ gh,ყ q,შ sh,ჩ ch,ც ts,ძ dz,წ ts,ჭ ch,ხ kh,ჯ j,ჰ h,ẞ SS,Ạ A,ạ a,Ả A,ả a,Ấ A,ấ a,Ầ A,ầ a,Ẩ A,ẩ a,Ẫ A,ẫ a,Ậ A,ậ a,Ắ A,ắ a,Ằ A,ằ a,Ẳ A,ẳ a,Ẵ A,ẵ a,Ặ A,ặ a,Ẹ E,ẹ e,Ẻ E,ẻ e,Ẽ E,ẽ e,Ế E,ế e,Ề E,ề e,Ể E,ể e,Ễ E,ễ e,Ệ E,ệ e,Ỉ I,ỉ i,Ị I,ị i,Ọ O,ọ o,Ỏ O,ỏ o,Ố O,ố o,Ồ O,ồ o,Ổ O,ổ o,Ỗ O,ỗ o,Ộ O,ộ o,Ớ O,ớ o,Ờ O,ờ o,Ở O,ở o,Ỡ O,ỡ o,Ợ O,ợ o,Ụ U,ụ u,Ủ U,ủ u,Ứ U,ứ u,Ừ U,ừ u,Ử U,ử u,Ữ U,ữ u,Ự U,ự u,Ỳ Y,ỳ y,Ỵ Y,ỵ y,Ỷ Y,ỷ y,Ỹ Y,ỹ y,‘ &apos;,’ &apos;,“ \&quot;,” \&quot;,† +,• *,… ...,₠ ecu,₢ cruzeiro,₣ french franc,₤ lira,₥ mill,₦ naira,₧ peseta,₨ rupee,₩ won,₪ new shequel,₫ dong,€ euro,₭ kip,₮ tugrik,₯ drachma,₰ penny,₱ peso,₲ guarani,₳ austral,₴ hryvnia,₵ cedi,₹ indian rupee,₽ russian ruble,₿ bitcoin,℠ sm,™ tm,∂ d,∆ delta,∑ sum,∞ infinity,♥ love,元 yuan,円 yen,﷼ rial&quot;.split(&quot;,&quot;),function(item)&#123;item=item.split(&quot; &quot;),defReplacement[item[0]]=item[1]&#125;),defReplacement[&quot; &quot;]=&quot;-&quot;,module.exports=exports&#125;),snakeCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return splitCase(str).join(&quot;_&quot;)&#125;&#125;),sortBy=createCommonjsModule(function(module,exports)&#123;module.exports=function(obj,iteratee,ctx)&#123;iteratee=safeCb(iteratee,ctx);var idx=0;return pluck(map(obj,function(val,key)&#123;return&#123;val:val,idx:idx++,criteria:iteratee(val,key,obj)&#125;&#125;).sort(function(left,right)&#123;var a=left.criteria,b=right.criteria;if(a!==b)&#123;if(b&lt;a||isUndef(a))return 1;if(a&lt;b||isUndef(b))return-1&#125;return left.idx-right.idx&#125;),&quot;val&quot;)&#125;&#125;),sortKeys=createCommonjsModule(function(module,exports)&#123;var defOpts=&#123;deep:!(exports=function(obj)&#123;var options=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,deep=(defaults(options,defOpts),options.deep),comparator=options.comparator,visited=[],visitedResult=[];return function sort(obj)&#123;var result,idx=visited.indexOf(obj);if(-1&lt;idx)return visitedResult[idx];if(isArr(obj))&#123;result=[],visited.push(obj),visitedResult.push(result);for(var i=0,len=obj.length;i&lt;len;i++)&#123;var value=obj[i];deep&amp;&amp;isObj(value)?result[i]=sort(value):result[i]=value&#125;&#125;else&#123;result=&#123;&#125;,visited.push(obj),visitedResult.push(result);for(var _keys=keys(obj).sort(comparator),_i=0,_len=_keys.length;_i&lt;_len;_i++)&#123;var key=_keys[_i],_value=obj[key];deep&amp;&amp;isObj(_value)?result[key]=sort(_value):result[key]=_value&#125;&#125;return result&#125;(obj)&#125;),comparator:isSorted.defComparator&#125;;module.exports=exports&#125;),spaceCase=createCommonjsModule(function(module,exports)&#123;module.exports=function(str)&#123;return splitCase(str).join(&quot; &quot;)&#125;&#125;),splitPath=createCommonjsModule(function(module,exports)&#123;var regSplit=/^([\s\S]*?)((?:\.&#123;1,2&#125;|[^\\/]+?|)(\.[^./\\]*|))(?:[\\/]*)$/;module.exports=function(path)&#123;path=path.match(regSplit);return&#123;dir:path[1],name:path[2],ext:path[3]&#125;&#125;&#125;),stackTrace=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;var orig=Error.prepareStackTrace,stack=(Error.prepareStackTrace=function(_,stack)&#123;return stack&#125;,(new Error).stack.slice(1));return Error.prepareStackTrace=orig,stack&#125;&#125;),stringifyAll=createCommonjsModule(function(module,exports)&#123;function iterateObj(name,keys,obj,options)&#123;var parts=[];return each(keys,function(key)&#123;var val,descriptor=Object.getOwnPropertyDescriptor(obj,key),hasGetter=descriptor&amp;&amp;descriptor.get,hasSetter=descriptor&amp;&amp;descriptor.set;if(!options.accessGetter&amp;&amp;hasGetter)val=&quot;(...)&quot;;else try&#123;if(val=obj[key],contain(options.ignore,val))return;isPromise(val)&amp;&amp;val.catch(function()&#123;&#125;)&#125;catch(e)&#123;val=e.message&#125;parts.push(&quot;&quot;.concat(wrapKey(key),&quot;:&quot;).concat(exports(val,options))),hasGetter&amp;&amp;parts.push(&quot;&quot;.concat(wrapKey(&quot;get &quot;+toStr(key)),&quot;:&quot;).concat(exports(descriptor.get,options))),hasSetter&amp;&amp;parts.push(&quot;&quot;.concat(wrapKey(&quot;set &quot;+toStr(key)),&quot;:&quot;).concat(exports(descriptor.set,options)))&#125;),&apos;&quot;&apos;.concat(name,&apos;&quot;:&#123;&apos;)+parts.join(&quot;,&quot;)+&quot;&#125;&quot;&#125;function wrapKey(key)&#123;return&apos;&quot;&apos;.concat(escapeJsonStr(key),&apos;&quot;&apos;)&#125;function wrapStr(str)&#123;return&apos;&quot;&apos;.concat(escapeJsonStr(toStr(str)),&apos;&quot;&apos;)&#125;function escapeJsonStr(str)&#123;return escapeJsStr(str).replace(/\\&apos;/g,&quot;&apos;&quot;).replace(/\t/g,&quot;\\t&quot;)&#125;exports=function(obj)&#123;var _ref=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:&#123;&#125;,self=_ref.self,_ref$startTime=_ref.startTime,_ref$startTime=void 0===_ref$startTime?now():_ref$startTime,_ref$timeout=_ref.timeout,_ref$timeout=void 0===_ref$timeout?0:_ref$timeout,_ref$depth=_ref.depth,_ref$depth=void 0===_ref$depth?0:_ref$depth,_ref$curDepth=_ref.curDepth,_ref$curDepth=void 0===_ref$curDepth?1:_ref$curDepth,_ref$visitor=_ref.visitor,_ref$visitor=void 0===_ref$visitor?new Visitor:_ref$visitor,_ref$unenumerable=_ref.unenumerable,_ref$unenumerable=void 0!==_ref$unenumerable&amp;&amp;_ref$unenumerable,_ref$symbol=_ref.symbol,_ref$symbol=void 0!==_ref$symbol&amp;&amp;_ref$symbol,_ref$accessGetter=_ref.accessGetter,_ref=_ref.ignore,_ref=void 0===_ref?[]:_ref,json=&quot;&quot;,_ref$accessGetter=&#123;visitor:_ref$visitor,unenumerable:_ref$unenumerable,symbol:_ref$symbol,accessGetter:void 0!==_ref$accessGetter&amp;&amp;_ref$accessGetter,depth:_ref$depth,curDepth:_ref$curDepth+1,timeout:_ref$timeout,startTime:_ref$startTime,ignore:_ref&#125;,t=type(obj,!1);if(&quot;String&quot;===t)json=wrapStr(obj);else if(&quot;Number&quot;===t)json=toStr(obj),endWith(json,&quot;Infinity&quot;)&amp;&amp;(json=&apos;&#123;&quot;value&quot;:&quot;&apos;.concat(json,&apos;&quot;,&quot;type&quot;:&quot;Number&quot;&#125;&apos;));else if(&quot;NaN&quot;===t)json=&apos;&#123;&quot;value&quot;:&quot;NaN&quot;,&quot;type&quot;:&quot;Number&quot;&#125;&apos;;else if(&quot;Boolean&quot;===t)json=obj?&quot;true&quot;:&quot;false&quot;;else if(&quot;Null&quot;===t)json=&quot;null&quot;;else if(&quot;Undefined&quot;===t)json=&apos;&#123;&quot;type&quot;:&quot;Undefined&quot;&#125;&apos;;else if(&quot;Symbol&quot;===t)&#123;var val=&quot;Symbol&quot;;try&#123;val=toStr(obj)&#125;catch(e)&#123;&#125;json=&apos;&#123;&quot;value&quot;:&apos;.concat(wrapStr(val),&apos;,&quot;type&quot;:&quot;Symbol&quot;&#125;&apos;)&#125;else&#123;if(_ref$timeout&amp;&amp;now()-_ref$startTime&gt;_ref$timeout)return wrapStr(&quot;Timeout&quot;);if(_ref$depth&amp;&amp;_ref$depth&lt;_ref$curDepth)return wrapStr(&quot;&#123;...&#125;&quot;);var id,json=&quot;&#123;&quot;,val=[],_ref$startTime=_ref$visitor.get(obj);_ref$startTime?(id=_ref$startTime.id,val.push(&apos;&quot;reference&quot;:&apos;.concat(id))):(id=_ref$visitor.set(obj),val.push(&apos;&quot;id&quot;:&apos;.concat(id))),val.push(&apos;&quot;type&quot;:&quot;&apos;.concat(t,&apos;&quot;&apos;)),endWith(t,&quot;Function&quot;)?val.push(&apos;&quot;value&quot;:&apos;.concat(wrapStr(toSrc(obj)))):&quot;RegExp&quot;===t&amp;&amp;val.push(&apos;&quot;value&quot;:&apos;.concat(wrapStr(obj))),_ref$startTime||((_ref$timeout=keys(obj)).length&amp;&amp;val.push(iterateObj(&quot;enumerable&quot;,_ref$timeout,self||obj,_ref$accessGetter)),!_ref$unenumerable||(_ref$depth=difference(allKeys(obj,&#123;prototype:!1,unenumerable:!0&#125;),_ref$timeout)).length&amp;&amp;val.push(iterateObj(&quot;unenumerable&quot;,_ref$depth,self||obj,_ref$accessGetter)),!_ref$symbol||(_ref$curDepth=filter(allKeys(obj,&#123;prototype:!1,symbol:!0&#125;),function(key)&#123;return&quot;symbol&quot;==typeof key&#125;)).length&amp;&amp;val.push(iterateObj(&quot;symbol&quot;,_ref$curDepth,self||obj,_ref$accessGetter)),(_ref$visitor=getProto(obj))&amp;&amp;!contain(_ref,_ref$visitor)&amp;&amp;(id=&apos;&quot;proto&quot;:&apos;.concat(exports(_ref$visitor,extend(_ref$accessGetter,&#123;self:self||obj&#125;))),val.push(id))),json+=val.join(&quot;,&quot;)+&quot;&#125;&quot;&#125;return json&#125;;var Visitor=Class(&#123;initialize:function()&#123;this.id=1,this.visited=[]&#125;,set:function(val)&#123;var visited=this.visited,id=this.id;return visited.push(&#123;id:id,val:val&#125;),this.id++,id&#125;,get:function(val)&#123;for(var visited=this.visited,i=0,len=visited.length;i&lt;len;i++)&#123;var obj=visited[i];if(val===obj.val)return obj&#125;return!1&#125;&#125;);function retTimeout()&#123;return&quot;Timeout&quot;&#125;function strToRegExp(str)&#123;var lastSlash=str.lastIndexOf(&quot;/&quot;);return new RegExp(str.slice(1,lastSlash),str.slice(lastSlash+1))&#125;exports.parse=function(str)&#123;var map=&#123;&#125;,str=function parse(obj,options)&#123;var map=options.map;if(!isObj(obj))return obj;var id=obj.id,type=obj.type,value=obj.value,proto=obj.proto,reference=obj.reference;var enumerable=obj.enumerable,unenumerable=obj.unenumerable;if(reference)return obj;&#123;if(&quot;Number&quot;===type)return&quot;Infinity&quot;===value?Number.POSITIVE_INFINITY:&quot;-Infinity&quot;===value?Number.NEGATIVE_INFINITY:NaN;if(&quot;Undefined&quot;===type)return&#125;var newObj;&quot;Function&quot;===type?((newObj=function()&#123;&#125;).toString=function()&#123;return value&#125;,proto&amp;&amp;Object.setPrototypeOf(newObj,parse(proto,options))):newObj=&quot;RegExp&quot;===type?strToRegExp(value):&quot;Object&quot;!==type?(reference=isMiniProgram?function()&#123;&#125;:new Function(type,&quot;&quot;),proto&amp;&amp;(reference.prototype=parse(proto,options)),new reference):create(proto?parse(proto,options):null);var defineProps=&#123;&#125;;&#123;var len;enumerable&amp;&amp;(isArrLike(enumerable)&amp;&amp;(len=enumerable.length,delete enumerable.length),enumerable=pick(enumerable,function(value,key)&#123;return!handleGetterSetter(enumerable,value,key)&#125;),each(enumerable,function(value,key)&#123;var defineProp=defineProps[key]||&#123;&#125;;defineProp.get||(newObj[key]=parse(value,options))&#125;),len&amp;&amp;(newObj.length=len))&#125;unenumerable&amp;&amp;(unenumerable=pick(unenumerable,function(value,key)&#123;return!handleGetterSetter(unenumerable,value,key)&#125;),each(unenumerable,function(value,key)&#123;var _reference,defineProp=defineProps[key]||&#123;&#125;;defineProp.get||(value=parse(value,options),isObj(value)&amp;&amp;value.reference?(_reference=value.reference,value=function()&#123;return map[_reference]&#125;,defineProp.get=value):defineProp.value=value),defineProp.enumerable=!1,defineProps[key]=defineProp&#125;));defineProp_1(newObj,defineProps);function handleGetterSetter(obj,val,key)&#123;key=toStr(key);var isGetterAndSetter=!1;return each([&quot;get&quot;,&quot;set&quot;],function(type)&#123;var realKey;startWith(key,type+&quot; &quot;)&amp;&amp;(realKey=key.replace(type+&quot; &quot;,&quot;&quot;),obj[realKey]&amp;&amp;(val=parse(val,options),safeSet(defineProps,[realKey,type],val=&quot;Timeout&quot;===val?retTimeout:val),isGetterAndSetter=!0))&#125;),isGetterAndSetter&#125;map[id]=newObj;return newObj&#125;(JSON.parse(str),&#123;map:map&#125;);return function(map)&#123;each(map,function(obj)&#123;for(var enumerableKeys=keys(obj),i=0,len=enumerableKeys.length;i&lt;len;i++)&#123;var reference,key=enumerableKeys[i];!isObj(obj[key])||(reference=obj[key].reference)&amp;&amp;map[reference]&amp;&amp;(obj[key]=map[reference])&#125;var proto=getProto(obj);proto&amp;&amp;proto.reference&amp;&amp;map[proto.reference]&amp;&amp;Object.setPrototypeOf(obj,map[proto.reference])&#125;)&#125;(map),str&#125;,module.exports=exports&#125;),stringifyAll_1=stringifyAll.parse,stripColor=createCommonjsModule(function(module,exports)&#123;var regColor=/\x1B\[([0-9]&#123;1,2&#125;(;[0-9]&#123;1,2&#125;)?)?[m|K]/g;module.exports=function(str)&#123;return str.replace(regColor,&quot;&quot;)&#125;&#125;),stripHtmlTag=createCommonjsModule(function(module,exports)&#123;var regHtmlTag=/&lt;[^&gt;]*&gt;/g;module.exports=function(str)&#123;return str.replace(regHtmlTag,&quot;&quot;)&#125;&#125;),stripIndent=createCommonjsModule(function(module,exports)&#123;var regStartSpaces=/^(\s+)\S+/;module.exports=function(literals)&#123;isStr(literals)&amp;&amp;(literals=toArr(literals));for(var str=&quot;&quot;,_len=arguments.length,placeholders=new Array(1&lt;_len?_len-1:0),_key=1;_key&lt;_len;_key++)placeholders[_key-1]=arguments[_key];for(var i=0,len=literals.length;i&lt;len;i++)str+=literals[i],placeholders[i]&amp;&amp;(str+=placeholders[i]);for(var lines=str.split(&quot;\n&quot;),indentLens=[],_i=0,_len2=lines.length;_i&lt;_len2;_i++)&#123;var _indent=lines[_i].match(regStartSpaces);_indent&amp;&amp;indentLens.push(_indent[1].length)&#125;var indent=0&lt;indentLens.length?min.apply(null,indentLens):0;return trim(map(lines,function(line)&#123;return&quot; &quot;===line[0]?line.slice(indent):line&#125;).join(&quot;\n&quot;))&#125;&#125;),stripNum=createCommonjsModule(function(module,exports)&#123;module.exports=function(num)&#123;return parseFloat(num.toPrecision(1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:12))&#125;&#125;),sum=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;for(var arr=arguments,ret=0,i=0,len=arr.length;i&lt;len;i++)ret+=arr[i];return ret&#125;&#125;),throttle=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,wait)&#123;return debounce(fn,wait,!0)&#125;&#125;),timeAgo=createCommonjsModule(function(module,exports)&#123;exports=function(date,now)&#123;isDate(date)||(date=new Date(date)),now=now||new Date;for(var i=0,now=0&lt;(diff=((now=isDate(now)?now:new Date(now))-date)/1e3),diff=Math.abs(diff);diff&gt;=secArr[i]&amp;&amp;i&lt;secArrLen;)diff/=secArr[i],i++;return(0===(i*=2)?9:1)&lt;(diff=toInt(diff))&amp;&amp;(i+=1),function(diff,i,ago)&#123;return exports.i18n[i][ago?0:1].replace(&quot;%s&quot;,diff)&#125;(diff,i,now)&#125;;var secArr=[60,60,24,7,365/7/12,12],secArrLen=secArr.length;exports.i18n=[[&quot;just now&quot;,&quot;right now&quot;],[&quot;%s seconds ago&quot;,&quot;in %s seconds&quot;],[&quot;1 minute ago&quot;,&quot;in 1 minute&quot;],[&quot;%s minutes ago&quot;,&quot;in %s minutes&quot;],[&quot;1 hour ago&quot;,&quot;in 1 hour&quot;],[&quot;%s hours ago&quot;,&quot;in %s hours&quot;],[&quot;1 day ago&quot;,&quot;in 1 day&quot;],[&quot;%s days ago&quot;,&quot;in %s days&quot;],[&quot;1 week ago&quot;,&quot;in 1 week&quot;],[&quot;%s weeks ago&quot;,&quot;in %s weeks&quot;],[&quot;1 month ago&quot;,&quot;in 1 month&quot;],[&quot;%s months ago&quot;,&quot;in %s months&quot;],[&quot;1 year ago&quot;,&quot;in 1 year&quot;],[&quot;%s years ago&quot;,&quot;in %s years&quot;]],module.exports=exports&#125;),timeAgo_1=timeAgo.i18n,timeTaken=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn)&#123;var start=perfNow();return fn(),perfNow()-start&#125;&#125;),times=createCommonjsModule(function(module,exports)&#123;module.exports=function(n,fn,ctx)&#123;var ret=Array(Math.max(0,n));fn=optimizeCb(fn,ctx,1);for(var i=0;i&lt;n;i++)ret[i]=fn(i);return ret&#125;&#125;),toAsync=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn)&#123;if(!isGeneratorFn(fn))throw new TypeError(&quot;Expected a generator function&quot;);return function()&#123;var _this=this,args=toArr(arguments);return new Promise(function(resolve,reject)&#123;var generator=fn.apply(_this,args);function onFulfilled(res)&#123;var ret;try&#123;ret=generator.next(res)&#125;catch(e)&#123;return reject(e)&#125;next(ret)&#125;function onRejected(err)&#123;var ret;try&#123;ret=generator.throw(err)&#125;catch(e)&#123;return reject(e)&#125;next(ret)&#125;function next(ret)&#123;return ret.done?resolve(ret.value):isPromise(ret.value)?ret.value.then(onFulfilled,onRejected):onRejected(new TypeError(&quot;You may only yield a promise, &quot;.concat(toStr(ret.value),&quot; is passed&quot;)))&#125;onFulfilled()&#125;)&#125;&#125;&#125;),topoSort=createCommonjsModule(function(module,exports)&#123;module.exports=function(edges)&#123;return function(nodes,edges)&#123;var cursor=nodes.length,sorted=new Array(cursor),visited=&#123;&#125;,i=cursor;for(;i--;)visited[i]||!function visit(node,i,predecessors)&#123;if(0&lt;=predecessors.indexOf(node))throw new Error(&quot;Cyclic dependency: &quot;+JSON.stringify(node));if(visited[i])return;visited[i]=!0;var outgoing=edges.filter(function(edge)&#123;return edge[0]===node&#125;);if(i=outgoing.length)&#123;var preds=predecessors.concat(node);do&#123;var child=outgoing[--i][1];visit(child,nodes.indexOf(child),preds)&#125;while(i)&#125;sorted[--cursor]=node&#125;(nodes[i],i,[]);return sorted&#125;(function(arr)&#123;for(var ret=[],i=0,len=arr.length;i&lt;len;i++)&#123;var edge=arr[i];ret.indexOf(edge[0])&lt;0&amp;&amp;ret.push(edge[0]),ret.indexOf(edge[1])&lt;0&amp;&amp;ret.push(edge[1])&#125;return ret&#125;(edges),edges)&#125;&#125;),truncate=createCommonjsModule(function(module,exports)&#123;var defOptions=&#123;ellipsis:&quot;...&quot;&#125;;module.exports=function(txt,width)&#123;var options=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:&#123;&#125;,ellipsis=(defaults(options,defOptions),options.ellipsis),options=options.separator;if(txt.length&lt;width)return txt;var end=width-ellipsis.length;if(end&lt;1)return ellipsis;var ret=txt.slice(0,end);return isUndef(options)||txt.indexOf(options,end)===end||-1&lt;(end=ret.lastIndexOf(options))&amp;&amp;(ret=ret.slice(0,end)),ret+ellipsis&#125;&#125;),tryIt=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,cb)&#123;cb=cb||noop;try&#123;cb(null,fn())&#125;catch(e)&#123;return void cb(e)&#125;&#125;&#125;),types=createCommonjsModule(function(module,exports)&#123;module.exports=&#123;&#125;&#125;),uncaught=createCommonjsModule(function(module,exports)&#123;var isOn=!1;function callListeners(err)&#123;isOn&amp;&amp;exports.emit(err)&#125;exports=&#123;start:function()&#123;isOn=!0&#125;,stop:function()&#123;isOn=!1&#125;&#125;,SingleEmitter.mixin(exports),isBrowser?(window.addEventListener(&quot;error&quot;,function(event)&#123;callListeners(event.error)&#125;),window.addEventListener(&quot;unhandledrejection&quot;,function(e)&#123;callListeners(e.reason)&#125;)):(process.on(&quot;uncaughtException&quot;,callListeners),process.on(&quot;unhandledRejection&quot;,callListeners)),module.exports=exports&#125;),_unescape=createCommonjsModule(function(module,exports)&#123;exports=function(str)&#123;return regTest.test(str)?str.replace(regReplace,replaceFn):str&#125;;var map=invert(_escape.map),regSrc=&quot;(?:&quot;+keys(map).join(&quot;|&quot;)+&quot;)&quot;,regTest=new RegExp(regSrc),regReplace=new RegExp(regSrc,&quot;g&quot;);function replaceFn(match)&#123;return map[match]&#125;module.exports=exports&#125;),union=createCommonjsModule(function(module,exports)&#123;exports=restArgs(function(arrays)&#123;return unique(flatten(arrays))&#125;),module.exports=exports&#125;),universalify=createCommonjsModule(function(module,exports)&#123;module.exports=function(fn,type)&#123;var callbackFn,promiseFn;return&quot;callback&quot;===type?promiseFn=promisify(callbackFn=fn):callbackFn=callbackify(promiseFn=fn),function()&#123;for(var _len=arguments.length,args=new Array(_len),_key=0;_key&lt;_len;_key++)args[_key]=arguments[_key];if(!isFn(last(args)))return promiseFn.apply(this,args);callbackFn.apply(this,args)&#125;&#125;&#125;),unzip=createCommonjsModule(function(module,exports)&#123;module.exports=function(arr)&#123;for(var len=max.apply(null,map(arr,function(arr)&#123;return arr.length&#125;)),ret=Array(len),i=0;i&lt;len;i++)ret[i]=pluck(arr,i);return ret&#125;&#125;),use=createCommonjsModule(function(module,exports)&#123;var modules=define_1._modules,requireMarks=&#123;&#125;;module.exports=function(requires,method)&#123;null==method&amp;&amp;(method=requires,requires=[]),requires=map(toArr(requires),function req(name)&#123;if(has(requireMarks,name))return modules[name];var requires=modules[name].requires;var body=modules[name].body;var len=requires.length;for(var i=0;i&lt;len;i++)requires[i]=req(requires[i]);body=body.apply(null,requires);body&amp;&amp;(modules[name]=body);requireMarks[name]=!0;return modules[name]&#125;),method.apply(null,requires)&#125;&#125;),uuid=createCommonjsModule(function(module,exports)&#123;exports=function()&#123;var b=randomBytes(16);return b[6]=15&amp;b[6]|64,b[8]=63&amp;b[8]|128,hexBytes[b[0]]+hexBytes[b[1]]+hexBytes[b[2]]+hexBytes[b[3]]+&quot;-&quot;+hexBytes[b[4]]+hexBytes[b[5]]+&quot;-&quot;+hexBytes[b[6]]+hexBytes[b[7]]+&quot;-&quot;+hexBytes[b[8]]+hexBytes[b[9]]+&quot;-&quot;+hexBytes[b[10]]+hexBytes[b[11]]+hexBytes[b[12]]+hexBytes[b[13]]+hexBytes[b[14]]+hexBytes[b[15]]&#125;;for(var hexBytes=[],i=0;i&lt;256;i++)hexBytes[i]=(i+256).toString(16).substr(1);module.exports=exports&#125;),viewportScale=createCommonjsModule(function(module,exports)&#123;module.exports=function()&#123;if(!(viewport=meta(&quot;viewport&quot;)))return 1;var viewport=map(viewport.split(&quot;,&quot;),function(val)&#123;return trim(val)&#125;),minScale=.25,maxScale=5,initialScale=1,viewport=(each(viewport,function(val)&#123;var key=(val=val.split(&quot;=&quot;))[0];val=val[1],&quot;initial-scale&quot;===key&amp;&amp;(initialScale=+val),&quot;maximum-scale&quot;===key&amp;&amp;(maxScale=+val),&quot;minimum-scale&quot;===key&amp;&amp;(minScale=+val)&#125;),clamp(initialScale,minScale,maxScale));return _isNaN(viewport)?1:viewport&#125;&#125;),vlq=createCommonjsModule(function(module,exports)&#123;exports=&#123;encode:function(arr)&#123;for(var ret=&quot;&quot;,i=0,len=(arr=toArr(arr)).length;i&lt;len;i++)ret+=function(value)&#123;var ret=&quot;&quot;;value=function(value)&#123;return value&lt;0?1+(-value&lt;&lt;1):value&lt;&lt;1&#125;(value);do&#123;var digit=value&amp;VLQ_BASE_MASK&#125;while(0&lt;(value&gt;&gt;&gt;=VLQ_BASE_SHIFT)&amp;&amp;(digit|=VLQ_CONTINUATION_BIT),ret+=intToChar[digit],0&lt;value);return ret&#125;(arr[i]);return ret&#125;,decode:function(str)&#123;for(var ret=[],i=0,len=str.length;i&lt;len;)&#123;var value=0,shift=0;do&#123;var digit=charToInt[str[i++]],continuation=0!=(digit&amp;VLQ_CONTINUATION_BIT)&#125;while(value+=(digit&amp;=VLQ_BASE_MASK)&lt;&lt;shift,shift+=VLQ_BASE_SHIFT,continuation);ret.push(function(value)&#123;var negate=1==(1&amp;value);return value&gt;&gt;=1,negate?-value:value&#125;(value))&#125;return ret&#125;&#125;;for(var charToInt=&#123;&#125;,intToChar=&#123;&#125;,chars=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;,i=0,len=chars.length;i&lt;len;i++)charToInt[chars[i]]=i,intToChar[i]=chars[i];var VLQ_BASE_SHIFT=5,VLQ_BASE=1&lt;&lt;VLQ_BASE_SHIFT,VLQ_BASE_MASK=VLQ_BASE-1,VLQ_CONTINUATION_BIT=VLQ_BASE;module.exports=exports&#125;),waitUntil=createCommonjsModule(function(module,exports)&#123;module.exports=function(condition)&#123;var timeout=1&lt;arguments.length&amp;&amp;void 0!==arguments[1]?arguments[1]:0,interval=2&lt;arguments.length&amp;&amp;void 0!==arguments[2]?arguments[2]:250;return new Promise(function(resolve,reject)&#123;var startTime=now(),pollCondition=function()&#123;new Promise(function(resolve,reject)&#123;try&#123;resolve(condition())&#125;catch(e)&#123;reject(e)&#125;&#125;).then(function(val)&#123;var elapsed=now()-startTime;val?resolve(val):timeout&amp;&amp;timeout&lt;=elapsed?reject(Error(&quot;Wait timed out after &quot;.concat(timeout,&quot; ms&quot;))):setTimeout(pollCondition,interval)&#125;,reject)&#125;;pollCondition()&#125;)&#125;&#125;),waterfall=createCommonjsModule(function(module,exports)&#123;module.exports=function(tasks,cb)&#123;cb=cb||noop;var current=0,taskCb=restArgs(function(err,args)&#123;++current&gt;=tasks.length||err?(args.unshift(err),nextTick(function()&#123;cb.apply(null,args)&#125;)):(args.push(taskCb),tasks[current].apply(null,args))&#125;);tasks.length?tasks[0](taskCb):nextTick(function()&#123;cb()&#125;)&#125;&#125;),wordWrap=createCommonjsModule(function(module,exports)&#123;var regWordBoundary=/(\S+\s+)/;module.exports=function(txt,width)&#123;txt=txt.split(&quot;\n&quot;);return map(txt,function(line)&#123;return function(txt,width)&#123;txt=reduce(txt.split(regWordBoundary),function(chunks,word)&#123;return&quot;&quot;===trim(word)||(word.length&gt;width?chunks=concat(chunks,word.match(new RegExp(&quot;.&#123;1,&quot;.concat(width,&quot;&#125;&quot;),&quot;g&quot;))):chunks.push(word)),chunks&#125;,[]);return reduce(txt,function(lines,chunk)&#123;var lastLine=last(lines);return lastLine.length+chunk.length&gt;width?(&quot;&quot;===trim(lastLine)&amp;&amp;lines.pop(),lines.push(chunk)):lines[lines.length-1]=lastLine+chunk,lines&#125;,[txt.shift()]).join(&quot;\n&quot;)&#125;(line,width)&#125;).join(&quot;\n&quot;)&#125;&#125;),workerize=createCommonjsModule(function(module,exports)&#123;function isPromise(val)&#123;return!!val&amp;&amp;(&quot;object&quot;==typeof val||&quot;function&quot;==typeof val)&amp;&amp;&quot;function&quot;==typeof val.then&amp;&amp;&quot;function&quot;==typeof val.catch&#125;module.exports=function(fn)&#123;var promises=&#123;&#125;,fn=[toSrc(isPromise),&quot;onmessage=(&quot;,toSrc(function(fn)&#123;return function(e)&#123;var value,data=e.data,id=data[0],data=data[1];try&#123;isPromise(value=fn.apply(fn,data))?value.then(function(value)&#123;postMessage([id,null,value])&#125;,function(err)&#123;postMessage([id,err.message])&#125;):postMessage([id,null,value])&#125;catch(e)&#123;postMessage([id,e.message])&#125;&#125;&#125;),&quot;)(&quot;+toSrc(fn)+&quot;)&quot;].join(&quot;\n&quot;),worker=new Worker(createUrl(fn));return worker.onmessage=function(e)&#123;var e=e.data,id=e[0],err=e[1],e=e[2];isStr(err)&amp;&amp;(err=new Error(err)),promises[id](err,e),delete promises[id]&#125;,restArgs(function(args)&#123;var id=uniqId(&quot;workerize&quot;);return new root.Promise(function(resolve,reject)&#123;promises[id]=function(err,value)&#123;if(err)return reject(err);resolve(value)&#125;,worker.postMessage([id,args])&#125;)&#125;)&#125;&#125;),xpath=createCommonjsModule(function(module,exports)&#123;module.exports=function(xpath)&#123;for(var ret=[],nodesSnapshot=document.evaluate(xpath,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),i=0;i&lt;nodesSnapshot.snapshotLength;i++)ret.push(nodesSnapshot.snapshotItem(i));return ret&#125;&#125;),zip=createCommonjsModule(function(module,exports)&#123;exports=restArgs(unzip),module.exports=exports&#125;),$$1=$,$attr$1=$attr,$class$1=$class,$css$1=$css,$data$1=$data,$event$1=$event,$insert$1=$insert,$offset$1=$offset,$property$1=$property,$remove$1=$remove,$safeEls$1=$safeEls,$show$1=$show,Benchmark$1=Benchmark,Blob$2=Blob$1,BloomFilter$1=BloomFilter,Caseless$1=Caseless,Class$1=Class,Color$1=Color,Delegator$1=Delegator,Dispatcher$1=Dispatcher,Emitter$1=Emitter,Enum$1=Enum,HashTable$1=HashTable,Heap$1=Heap,HeapSnapshot$1=HeapSnapshot,I18n$1=I18n,JsonTransformer$1=JsonTransformer,LinkedList$1=LinkedList,LocalStore$1=LocalStore,Logger$1=Logger,Lru$1=Lru,MediaQuery$1=MediaQuery,MutationObserver$1=MutationObserver,PriorityQueue$1=PriorityQueue,Promise$1=_Promise,PseudoMap$1=PseudoMap,Queue$1=Queue,QuickLru$1=QuickLru,Readiness$1=Readiness,ReduceStore$1=ReduceStore,ResizeSensor$1=ResizeSensor,Select$1=Select,Semaphore$1=Semaphore,SessionStore$1=SessionStore,SingleEmitter$1=SingleEmitter,Socket$1=Socket,Stack$1=Stack,State$1=State,Store$1=Store,Trace$1=Trace,Tracing$1=Tracing,Trie$1=Trie,Tween$1=Tween,Url$1=Url,Validator$1=Validator,Wrr$1=Wrr,abbrev$1=abbrev,after$1=after,ajax$1=ajax,allKeys$1=allKeys,arrToMap$1=arrToMap,atob$1=atob,average$1=average,base64$1=base64,before$1=before,binarySearch$1=binarySearch,bind$1=bind,btoa$1=btoa,bubbleSort$1=bubbleSort,bytesToStr$1=bytesToStr,bytesToWords$1=bytesToWords,callbackify$1=callbackify,camelCase$1=camelCase,capitalize$1=capitalize,castPath$1=castPath,centerAlign$1=centerAlign,char_1$1=char_1,chunk$1=chunk,clamp$1=clamp,className$1=className,cliHelp$1=cliHelp,clone$1=clone,cloneDeep$1=cloneDeep,cmpVersion$1=cmpVersion,combine$1=combine,compact$1=compact,compose$1=compose,compressImg$1=compressImg,concat$1=concat,contain$1=contain,convertBase$1=convertBase,convertBin$1=convertBin,cookie$1=cookie,copy$1=copy,crc1$1=crc1,crc16$1=crc16,crc32$1=crc32,crc8$1=crc8,create$1=create,createAssigner$1=createAssigner,createUrl$1=createUrl,css$1=css,cssPriority$1=cssPriority,cssSupports$1=cssSupports,curry$1=curry,dateFormat$1=dateFormat,debounce$1=debounce,debug$1=debug,deburr$1=deburr,decodeUriComponent$1=decodeUriComponent,defaults$1=defaults,define=define_1,defineProp=defineProp_1,defined$1=defined,delay$1=delay,delegate$1=delegate,deprecate$1=deprecate,detectBrowser$1=detectBrowser,detectMocha$1=detectMocha,detectOs$1=detectOs,difference$1=difference,dotCase$1=dotCase,download$1=download,durationFormat$1=durationFormat,each$1=each,easing$1=easing,emulateTouch$1=emulateTouch,endWith$1=endWith,escape=_escape,escapeJsStr$1=escapeJsStr,escapeRegExp$1=escapeRegExp,evalCss$1=evalCss,evalJs$1=evalJs,every$1=every,extend$1=extend,extendDeep$1=extendDeep,extendOwn$1=extendOwn,extractBlockCmts$1=extractBlockCmts,extractUrls$1=extractUrls,fetch$1=fetch,fibonacci$1=fibonacci,fileSize$1=fileSize,fileType$1=fileType,fill$1=fill,filter$1=filter,find$1=find,findIdx$1=findIdx,findKey$1=findKey,findLastIdx$1=findLastIdx,flatten$1=flatten,fnArgs$1=fnArgs,fnParams$1=fnParams,fnv1a$1=fnv1a,format$1=format,fraction$1=fraction,freeze$1=freeze,freezeDeep$1=freezeDeep,fullscreen$1=fullscreen,fuzzySearch$1=fuzzySearch,gcd$1=gcd,getProto$1=getProto,getUrlParam$1=getUrlParam,golangify$1=golangify,h$1=h,has$1=has,heapSort$1=heapSort,hex$1=hex,highlight$1=highlight,hookFn$1=hookFn,hotkey$1=hotkey,hslToRgb$1=hslToRgb,html$1=html,identity$1=identity,idxOf$1=idxOf,indent$1=indent,inherits$1=inherits,ini$1=ini,insertionSort$1=insertionSort,intersect$1=intersect,intersectRange$1=intersectRange,invariant$1=invariant,invert$1=invert,isAbsoluteUrl$1=isAbsoluteUrl,isArgs$1=isArgs,isArr$1=isArr,isArrBuffer$1=isArrBuffer,isArrLike$1=isArrLike,isAsyncFn$1=isAsyncFn,isBlob$1=isBlob,isBool$1=isBool,isBrowser$1=isBrowser,isBuffer$1=isBuffer,isClose$1=isClose,isCyclic$1=isCyclic,isDarkMode$1=isDarkMode,isDataUrl$1=isDataUrl,isDate$1=isDate,isEl$1=isEl,isEmail$1=isEmail,isEmpty$1=isEmpty,isEqual$1=isEqual,isErr$1=isErr,isEven$1=isEven,isFile$1=isFile,isFinite=_isFinite,isFn$1=isFn,isFullWidth$1=isFullWidth,isGeneratorFn$1=isGeneratorFn,isHidden$1=isHidden,isInt$1=isInt,isIp$1=isIp,isJson$1=isJson,isLeapYear$1=isLeapYear,isMap$1=isMap,isMatch$1=isMatch,isMiniProgram$1=isMiniProgram,isMobile$1=isMobile,isNaN=_isNaN,isNative$1=isNative,isNil$1=isNil,isNode$1=isNode,isNull$1=isNull,isNum$1=isNum,isNumeric$1=isNumeric,isObj$1=isObj,isOdd$1=isOdd,isPlainObj$1=isPlainObj,isPrime$1=isPrime,isPrimitive$1=isPrimitive,isPromise$1=isPromise,isRegExp$1=isRegExp,isRelative$1=isRelative,isRetina$1=isRetina,isSet$1=isSet,isSorted$1=isSorted,isStr$1=isStr,isSymbol$1=isSymbol,isTypedArr$1=isTypedArr,isUndef$1=isUndef,isUrl$1=isUrl,isWeakMap$1=isWeakMap,isWeakSet$1=isWeakSet,jsonClone$1=jsonClone,jsonp$1=jsonp,kebabCase$1=kebabCase,keyCode$1=keyCode,keys$1=keys,last$1=last,levenshtein$1=levenshtein,linkify$1=linkify,loadCss$1=loadCss,loadImg$1=loadImg,loadJs$1=loadJs,longest$1=longest,lowerCase$1=lowerCase,lpad$1=lpad,ltrim$1=ltrim,map$1=map,mapObj$1=mapObj,matcher$1=matcher,max$1=max,md5$1=md5,memStorage$1=memStorage,memoize$1=memoize,mergeArr$1=mergeArr,mergeSort$1=mergeSort,meta$1=meta,methods$1=methods,mime$1=mime,min$1=min,moment$1=moment,morphDom$1=morphDom,morse$1=morse,ms$1=ms,naturalSort$1=naturalSort,negate$1=negate,nextTick$1=nextTick,noop$1=noop,normalizeHeader$1=normalizeHeader,normalizePath$1=normalizePath,normalizePhone$1=normalizePhone,notify$1=notify,now$1=now,objToStr$1=objToStr,omit$1=omit,once$1=once,openFile$1=openFile,optimizeCb$1=optimizeCb,ordinal$1=ordinal,orientation$1=orientation,pad$1=pad,pairs$1=pairs,parallel$1=parallel,parseArgs$1=parseArgs,parseHtml$1=parseHtml,partial$1=partial,pascalCase$1=pascalCase,perfNow$1=perfNow,pick$1=pick,pluck$1=pluck,precision$1=precision,prefetch$1=prefetch,prefix$1=prefix,promisify$1=promisify,property$1=property,query$1=query,quickSort=quickSort_1,raf=raf_1,random$1=random,randomBytes$1=randomBytes,randomColor$1=randomColor,randomId$1=randomId,randomItem$1=randomItem,range$1=range,rc4=rc4_1,ready$1=ready,reduce$1=reduce,reduceRight$1=reduceRight,reject$1=reject,remove$1=remove,repeat$1=repeat,replaceAll$1=replaceAll,restArgs$1=restArgs,reverse$1=reverse,rgbToHsl$1=rgbToHsl,ric$1=ric,rmCookie$1=rmCookie,root$1=root,rpad$1=rpad,rtrim$1=rtrim,safeCb$1=safeCb,safeDel$1=safeDel,safeGet$1=safeGet,safeSet$1=safeSet,safeStorage$1=safeStorage,sameOrigin$1=sameOrigin,sample$1=sample,scrollTo$1=scrollTo,seedRandom$1=seedRandom,selectionSort$1=selectionSort,selector$1=selector,shebang$1=shebang,shellSort$1=shellSort,shuffle$1=shuffle,size$1=size,sizeof=sizeof_1,sleep$1=sleep,slice$1=slice,slugify$1=slugify,snakeCase$1=snakeCase,some$1=some,sortBy$1=sortBy,sortKeys$1=sortKeys,spaceCase$1=spaceCase,splitCase$1=splitCase,splitPath$1=splitPath,stackTrace$1=stackTrace,startWith$1=startWith,strHash$1=strHash,strToBytes$1=strToBytes,strTpl$1=strTpl,strWidth$1=strWidth,stringify$1=stringify,stringifyAll$1=stringifyAll,stripAnsi$1=stripAnsi,stripCmt$1=stripCmt,stripColor$1=stripColor,stripHtmlTag$1=stripHtmlTag,stripIndent$1=stripIndent,stripNum$1=stripNum,sum$1=sum,swap$1=swap,table$1=table,template$1=template,throttle$1=throttle,timeAgo$1=timeAgo,timeTaken$1=timeTaken,times$1=times,toArr$1=toArr,toAsync$1=toAsync,toBool$1=toBool,toDate$1=toDate,toEl$1=toEl,toInt$1=toInt,toNum$1=toNum,toSrc$1=toSrc,toStr$1=toStr,topoSort$1=topoSort,trigger$1=trigger,trim$1=trim,truncate$1=truncate,tryIt$1=tryIt,type$1=type,types$1=types,ucs2$1=ucs2,uncaught$1=uncaught,unescape=_unescape,union$1=union,uniqId$1=uniqId,unique$1=unique,universalify$1=universalify,unzip$1=unzip,upperCase$1=upperCase,upperFirst$1=upperFirst,use$1=use,utf8$1=utf8,uuid$1=uuid,values$1=values,viewportScale$1=viewportScale,vlq$1=vlq,waitUntil$1=waitUntil,waterfall$1=waterfall,wordWrap$1=wordWrap,wordsToBytes$1=wordsToBytes,workerize$1=workerize,wrap$1=wrap,xpath$1=xpath,zip$1=zip,browser=&#123;$:$$1,$attr:$attr$1,$class:$class$1,$css:$css$1,$data:$data$1,$event:$event$1,$insert:$insert$1,$offset:$offset$1,$property:$property$1,$remove:$remove$1,$safeEls:$safeEls$1,$show:$show$1,Benchmark:Benchmark$1,Blob:Blob$2,BloomFilter:BloomFilter$1,Caseless:Caseless$1,Class:Class$1,Color:Color$1,Delegator:Delegator$1,Dispatcher:Dispatcher$1,Emitter:Emitter$1,Enum:Enum$1,HashTable:HashTable$1,Heap:Heap$1,HeapSnapshot:HeapSnapshot$1,I18n:I18n$1,JsonTransformer:JsonTransformer$1,LinkedList:LinkedList$1,LocalStore:LocalStore$1,Logger:Logger$1,Lru:Lru$1,MediaQuery:MediaQuery$1,MutationObserver:MutationObserver$1,PriorityQueue:PriorityQueue$1,Promise:Promise$1,PseudoMap:PseudoMap$1,Queue:Queue$1,QuickLru:QuickLru$1,Readiness:Readiness$1,ReduceStore:ReduceStore$1,ResizeSensor:ResizeSensor$1,Select:Select$1,Semaphore:Semaphore$1,SessionStore:SessionStore$1,SingleEmitter:SingleEmitter$1,Socket:Socket$1,Stack:Stack$1,State:State$1,Store:Store$1,Trace:Trace$1,Tracing:Tracing$1,Trie:Trie$1,Tween:Tween$1,Url:Url$1,Validator:Validator$1,Wrr:Wrr$1,abbrev:abbrev$1,after:after$1,ajax:ajax$1,allKeys:allKeys$1,arrToMap:arrToMap$1,atob:atob$1,average:average$1,base64:base64$1,before:before$1,binarySearch:binarySearch$1,bind:bind$1,btoa:btoa$1,bubbleSort:bubbleSort$1,bytesToStr:bytesToStr$1,bytesToWords:bytesToWords$1,callbackify:callbackify$1,camelCase:camelCase$1,capitalize:capitalize$1,castPath:castPath$1,centerAlign:centerAlign$1,char:char_1$1,chunk:chunk$1,clamp:clamp$1,className:className$1,cliHelp:cliHelp$1,clone:clone$1,cloneDeep:cloneDeep$1,cmpVersion:cmpVersion$1,combine:combine$1,compact:compact$1,compose:compose$1,compressImg:compressImg$1,concat:concat$1,contain:contain$1,convertBase:convertBase$1,convertBin:convertBin$1,cookie:cookie$1,copy:copy$1,crc1:crc1$1,crc16:crc16$1,crc32:crc32$1,crc8:crc8$1,create:create$1,createAssigner:createAssigner$1,createUrl:createUrl$1,css:css$1,cssPriority:cssPriority$1,cssSupports:cssSupports$1,curry:curry$1,dateFormat:dateFormat$1,debounce:debounce$1,debug:debug$1,deburr:deburr$1,decodeUriComponent:decodeUriComponent$1,defaults:defaults$1,define:define,defineProp:defineProp,defined:defined$1,delay:delay$1,delegate:delegate$1,deprecate:deprecate$1,detectBrowser:detectBrowser$1,detectMocha:detectMocha$1,detectOs:detectOs$1,difference:difference$1,dotCase:dotCase$1,download:download$1,durationFormat:durationFormat$1,each:each$1,easing:easing$1,emulateTouch:emulateTouch$1,endWith:endWith$1,escape:escape,escapeJsStr:escapeJsStr$1,escapeRegExp:escapeRegExp$1,evalCss:evalCss$1,evalJs:evalJs$1,every:every$1,extend:extend$1,extendDeep:extendDeep$1,extendOwn:extendOwn$1,extractBlockCmts:extractBlockCmts$1,extractUrls:extractUrls$1,fetch:fetch$1,fibonacci:fibonacci$1,fileSize:fileSize$1,fileType:fileType$1,fill:fill$1,filter:filter$1,find:find$1,findIdx:findIdx$1,findKey:findKey$1,findLastIdx:findLastIdx$1,flatten:flatten$1,fnArgs:fnArgs$1,fnParams:fnParams$1,fnv1a:fnv1a$1,format:format$1,fraction:fraction$1,freeze:freeze$1,freezeDeep:freezeDeep$1,fullscreen:fullscreen$1,fuzzySearch:fuzzySearch$1,gcd:gcd$1,getProto:getProto$1,getUrlParam:getUrlParam$1,golangify:golangify$1,h:h$1,has:has$1,heapSort:heapSort$1,hex:hex$1,highlight:highlight$1,hookFn:hookFn$1,hotkey:hotkey$1,hslToRgb:hslToRgb$1,html:html$1,identity:identity$1,idxOf:idxOf$1,indent:indent$1,inherits:inherits$1,ini:ini$1,insertionSort:insertionSort$1,intersect:intersect$1,intersectRange:intersectRange$1,invariant:invariant$1,invert:invert$1,isAbsoluteUrl:isAbsoluteUrl$1,isArgs:isArgs$1,isArr:isArr$1,isArrBuffer:isArrBuffer$1,isArrLike:isArrLike$1,isAsyncFn:isAsyncFn$1,isBlob:isBlob$1,isBool:isBool$1,isBrowser:isBrowser$1,isBuffer:isBuffer$1,isClose:isClose$1,isCyclic:isCyclic$1,isDarkMode:isDarkMode$1,isDataUrl:isDataUrl$1,isDate:isDate$1,isEl:isEl$1,isEmail:isEmail$1,isEmpty:isEmpty$1,isEqual:isEqual$1,isErr:isErr$1,isEven:isEven$1,isFile:isFile$1,isFinite:isFinite,isFn:isFn$1,isFullWidth:isFullWidth$1,isGeneratorFn:isGeneratorFn$1,isHidden:isHidden$1,isInt:isInt$1,isIp:isIp$1,isJson:isJson$1,isLeapYear:isLeapYear$1,isMap:isMap$1,isMatch:isMatch$1,isMiniProgram:isMiniProgram$1,isMobile:isMobile$1,isNaN:isNaN,isNative:isNative$1,isNil:isNil$1,isNode:isNode$1,isNull:isNull$1,isNum:isNum$1,isNumeric:isNumeric$1,isObj:isObj$1,isOdd:isOdd$1,isPlainObj:isPlainObj$1,isPrime:isPrime$1,isPrimitive:isPrimitive$1,isPromise:isPromise$1,isRegExp:isRegExp$1,isRelative:isRelative$1,isRetina:isRetina$1,isSet:isSet$1,isSorted:isSorted$1,isStr:isStr$1,isSymbol:isSymbol$1,isTypedArr:isTypedArr$1,isUndef:isUndef$1,isUrl:isUrl$1,isWeakMap:isWeakMap$1,isWeakSet:isWeakSet$1,jsonClone:jsonClone$1,jsonp:jsonp$1,kebabCase:kebabCase$1,keyCode:keyCode$1,keys:keys$1,last:last$1,levenshtein:levenshtein$1,linkify:linkify$1,loadCss:loadCss$1,loadImg:loadImg$1,loadJs:loadJs$1,longest:longest$1,lowerCase:lowerCase$1,lpad:lpad$1,ltrim:ltrim$1,map:map$1,mapObj:mapObj$1,matcher:matcher$1,max:max$1,md5:md5$1,memStorage:memStorage$1,memoize:memoize$1,mergeArr:mergeArr$1,mergeSort:mergeSort$1,meta:meta$1,methods:methods$1,mime:mime$1,min:min$1,moment:moment$1,morphDom:morphDom$1,morse:morse$1,ms:ms$1,naturalSort:naturalSort$1,negate:negate$1,nextTick:nextTick$1,noop:noop$1,normalizeHeader:normalizeHeader$1,normalizePath:normalizePath$1,normalizePhone:normalizePhone$1,notify:notify$1,now:now$1,objToStr:objToStr$1,omit:omit$1,once:once$1,openFile:openFile$1,optimizeCb:optimizeCb$1,ordinal:ordinal$1,orientation:orientation$1,pad:pad$1,pairs:pairs$1,parallel:parallel$1,parseArgs:parseArgs$1,parseHtml:parseHtml$1,partial:partial$1,pascalCase:pascalCase$1,perfNow:perfNow$1,pick:pick$1,pluck:pluck$1,precision:precision$1,prefetch:prefetch$1,prefix:prefix$1,promisify:promisify$1,property:property$1,query:query$1,quickSort:quickSort,raf:raf,random:random$1,randomBytes:randomBytes$1,randomColor:randomColor$1,randomId:randomId$1,randomItem:randomItem$1,range:range$1,rc4:rc4,ready:ready$1,reduce:reduce$1,reduceRight:reduceRight$1,reject:reject$1,remove:remove$1,repeat:repeat$1,replaceAll:replaceAll$1,restArgs:restArgs$1,reverse:reverse$1,rgbToHsl:rgbToHsl$1,ric:ric$1,rmCookie:rmCookie$1,root:root$1,rpad:rpad$1,rtrim:rtrim$1,safeCb:safeCb$1,safeDel:safeDel$1,safeGet:safeGet$1,safeSet:safeSet$1,safeStorage:safeStorage$1,sameOrigin:sameOrigin$1,sample:sample$1,scrollTo:scrollTo$1,seedRandom:seedRandom$1,selectionSort:selectionSort$1,selector:selector$1,shebang:shebang$1,shellSort:shellSort$1,shuffle:shuffle$1,size:size$1,sizeof:sizeof,sleep:sleep$1,slice:slice$1,slugify:slugify$1,snakeCase:snakeCase$1,some:some$1,sortBy:sortBy$1,sortKeys:sortKeys$1,spaceCase:spaceCase$1,splitCase:splitCase$1,splitPath:splitPath$1,stackTrace:stackTrace$1,startWith:startWith$1,strHash:strHash$1,strToBytes:strToBytes$1,strTpl:strTpl$1,strWidth:strWidth$1,stringify:stringify$1,stringifyAll:stringifyAll$1,stripAnsi:stripAnsi$1,stripCmt:stripCmt$1,stripColor:stripColor$1,stripHtmlTag:stripHtmlTag$1,stripIndent:stripIndent$1,stripNum:stripNum$1,sum:sum$1,swap:swap$1,table:table$1,template:template$1,throttle:throttle$1,timeAgo:timeAgo$1,timeTaken:timeTaken$1,times:times$1,toArr:toArr$1,toAsync:toAsync$1,toBool:toBool$1,toDate:toDate$1,toEl:toEl$1,toInt:toInt$1,toNum:toNum$1,toSrc:toSrc$1,toStr:toStr$1,topoSort:topoSort$1,trigger:trigger$1,trim:trim$1,truncate:truncate$1,tryIt:tryIt$1,type:type$1,types:types$1,ucs2:ucs2$1,uncaught:uncaught$1,unescape:unescape,union:union$1,uniqId:uniqId$1,unique:unique$1,universalify:universalify$1,unzip:unzip$1,upperCase:upperCase$1,upperFirst:upperFirst$1,use:use$1,utf8:utf8$1,uuid:uuid$1,values:values$1,viewportScale:viewportScale$1,vlq:vlq$1,waitUntil:waitUntil$1,waterfall:waterfall$1,wordWrap:wordWrap$1,wordsToBytes:wordsToBytes$1,workerize:workerize$1,wrap:wrap$1,xpath:xpath$1,zip:zip$1&#125;,$nux=Object.freeze(&#123;__proto__:null,default:browser,__moduleExports:browser,$:$$1,$attr:$attr$1,$class:$class$1,$css:$css$1,$data:$data$1,$event:$event$1,$insert:$insert$1,$offset:$offset$1,$property:$property$1,$remove:$remove$1,$safeEls:$safeEls$1,$show:$show$1,Benchmark:Benchmark$1,Blob:Blob$2,BloomFilter:BloomFilter$1,Caseless:Caseless$1,Class:Class$1,Color:Color$1,Delegator:Delegator$1,Dispatcher:Dispatcher$1,Emitter:Emitter$1,Enum:Enum$1,HashTable:HashTable$1,Heap:Heap$1,HeapSnapshot:HeapSnapshot$1,I18n:I18n$1,JsonTransformer:JsonTransformer$1,LinkedList:LinkedList$1,LocalStore:LocalStore$1,Logger:Logger$1,Lru:Lru$1,MediaQuery:MediaQuery$1,MutationObserver:MutationObserver$1,PriorityQueue:PriorityQueue$1,Promise:Promise$1,PseudoMap:PseudoMap$1,Queue:Queue$1,QuickLru:QuickLru$1,Readiness:Readiness$1,ReduceStore:ReduceStore$1,ResizeSensor:ResizeSensor$1,Select:Select$1,Semaphore:Semaphore$1,SessionStore:SessionStore$1,SingleEmitter:SingleEmitter$1,Socket:Socket$1,Stack:Stack$1,State:State$1,Store:Store$1,Trace:Trace$1,Tracing:Tracing$1,Trie:Trie$1,Tween:Tween$1,Url:Url$1,Validator:Validator$1,Wrr:Wrr$1,abbrev:abbrev$1,after:after$1,ajax:ajax$1,allKeys:allKeys$1,arrToMap:arrToMap$1,atob:atob$1,average:average$1,base64:base64$1,before:before$1,binarySearch:binarySearch$1,bind:bind$1,btoa:btoa$1,bubbleSort:bubbleSort$1,bytesToStr:bytesToStr$1,bytesToWords:bytesToWords$1,callbackify:callbackify$1,camelCase:camelCase$1,capitalize:capitalize$1,castPath:castPath$1,centerAlign:centerAlign$1,char:char_1$1,chunk:chunk$1,clamp:clamp$1,className:className$1,cliHelp:cliHelp$1,clone:clone$1,cloneDeep:cloneDeep$1,cmpVersion:cmpVersion$1,combine:combine$1,compact:compact$1,compose:compose$1,compressImg:compressImg$1,concat:concat$1,contain:contain$1,convertBase:convertBase$1,convertBin:convertBin$1,cookie:cookie$1,copy:copy$1,crc1:crc1$1,crc16:crc16$1,crc32:crc32$1,crc8:crc8$1,create:create$1,createAssigner:createAssigner$1,createUrl:createUrl$1,css:css$1,cssPriority:cssPriority$1,cssSupports:cssSupports$1,curry:curry$1,dateFormat:dateFormat$1,debounce:debounce$1,debug:debug$1,deburr:deburr$1,decodeUriComponent:decodeUriComponent$1,defaults:defaults$1,define:define,defineProp:defineProp,defined:defined$1,delay:delay$1,delegate:delegate$1,deprecate:deprecate$1,detectBrowser:detectBrowser$1,detectMocha:detectMocha$1,detectOs:detectOs$1,difference:difference$1,dotCase:dotCase$1,download:download$1,durationFormat:durationFormat$1,each:each$1,easing:easing$1,emulateTouch:emulateTouch$1,endWith:endWith$1,escape:escape,escapeJsStr:escapeJsStr$1,escapeRegExp:escapeRegExp$1,evalCss:evalCss$1,evalJs:evalJs$1,every:every$1,extend:extend$1,extendDeep:extendDeep$1,extendOwn:extendOwn$1,extractBlockCmts:extractBlockCmts$1,extractUrls:extractUrls$1,fetch:fetch$1,fibonacci:fibonacci$1,fileSize:fileSize$1,fileType:fileType$1,fill:fill$1,filter:filter$1,find:find$1,findIdx:findIdx$1,findKey:findKey$1,findLastIdx:findLastIdx$1,flatten:flatten$1,fnArgs:fnArgs$1,fnParams:fnParams$1,fnv1a:fnv1a$1,format:format$1,fraction:fraction$1,freeze:freeze$1,freezeDeep:freezeDeep$1,fullscreen:fullscreen$1,fuzzySearch:fuzzySearch$1,gcd:gcd$1,getProto:getProto$1,getUrlParam:getUrlParam$1,golangify:golangify$1,h:h$1,has:has$1,heapSort:heapSort$1,hex:hex$1,highlight:highlight$1,hookFn:hookFn$1,hotkey:hotkey$1,hslToRgb:hslToRgb$1,html:html$1,identity:identity$1,idxOf:idxOf$1,indent:indent$1,inherits:inherits$1,ini:ini$1,insertionSort:insertionSort$1,intersect:intersect$1,intersectRange:intersectRange$1,invariant:invariant$1,invert:invert$1,isAbsoluteUrl:isAbsoluteUrl$1,isArgs:isArgs$1,isArr:isArr$1,isArrBuffer:isArrBuffer$1,isArrLike:isArrLike$1,isAsyncFn:isAsyncFn$1,isBlob:isBlob$1,isBool:isBool$1,isBrowser:isBrowser$1,isBuffer:isBuffer$1,isClose:isClose$1,isCyclic:isCyclic$1,isDarkMode:isDarkMode$1,isDataUrl:isDataUrl$1,isDate:isDate$1,isEl:isEl$1,isEmail:isEmail$1,isEmpty:isEmpty$1,isEqual:isEqual$1,isErr:isErr$1,isEven:isEven$1,isFile:isFile$1,isFinite:isFinite,isFn:isFn$1,isFullWidth:isFullWidth$1,isGeneratorFn:isGeneratorFn$1,isHidden:isHidden$1,isInt:isInt$1,isIp:isIp$1,isJson:isJson$1,isLeapYear:isLeapYear$1,isMap:isMap$1,isMatch:isMatch$1,isMiniProgram:isMiniProgram$1,isMobile:isMobile$1,isNaN:isNaN,isNative:isNative$1,isNil:isNil$1,isNode:isNode$1,isNull:isNull$1,isNum:isNum$1,isNumeric:isNumeric$1,isObj:isObj$1,isOdd:isOdd$1,isPlainObj:isPlainObj$1,isPrime:isPrime$1,isPrimitive:isPrimitive$1,isPromise:isPromise$1,isRegExp:isRegExp$1,isRelative:isRelative$1,isRetina:isRetina$1,isSet:isSet$1,isSorted:isSorted$1,isStr:isStr$1,isSymbol:isSymbol$1,isTypedArr:isTypedArr$1,isUndef:isUndef$1,isUrl:isUrl$1,isWeakMap:isWeakMap$1,isWeakSet:isWeakSet$1,jsonClone:jsonClone$1,jsonp:jsonp$1,kebabCase:kebabCase$1,keyCode:keyCode$1,keys:keys$1,last:last$1,levenshtein:levenshtein$1,linkify:linkify$1,loadCss:loadCss$1,loadImg:loadImg$1,loadJs:loadJs$1,longest:longest$1,lowerCase:lowerCase$1,lpad:lpad$1,ltrim:ltrim$1,map:map$1,mapObj:mapObj$1,matcher:matcher$1,max:max$1,md5:md5$1,memStorage:memStorage$1,memoize:memoize$1,mergeArr:mergeArr$1,mergeSort:mergeSort$1,meta:meta$1,methods:methods$1,mime:mime$1,min:min$1,moment:moment$1,morphDom:morphDom$1,morse:morse$1,ms:ms$1,naturalSort:naturalSort$1,negate:negate$1,nextTick:nextTick$1,noop:noop$1,normalizeHeader:normalizeHeader$1,normalizePath:normalizePath$1,normalizePhone:normalizePhone$1,notify:notify$1,now:now$1,objToStr:objToStr$1,omit:omit$1,once:once$1,openFile:openFile$1,optimizeCb:optimizeCb$1,ordinal:ordinal$1,orientation:orientation$1,pad:pad$1,pairs:pairs$1,parallel:parallel$1,parseArgs:parseArgs$1,parseHtml:parseHtml$1,partial:partial$1,pascalCase:pascalCase$1,perfNow:perfNow$1,pick:pick$1,pluck:pluck$1,precision:precision$1,prefetch:prefetch$1,prefix:prefix$1,promisify:promisify$1,property:property$1,query:query$1,quickSort:quickSort,raf:raf,random:random$1,randomBytes:randomBytes$1,randomColor:randomColor$1,randomId:randomId$1,randomItem:randomItem$1,range:range$1,rc4:rc4,ready:ready$1,reduce:reduce$1,reduceRight:reduceRight$1,reject:reject$1,remove:remove$1,repeat:repeat$1,replaceAll:replaceAll$1,restArgs:restArgs$1,reverse:reverse$1,rgbToHsl:rgbToHsl$1,ric:ric$1,rmCookie:rmCookie$1,root:root$1,rpad:rpad$1,rtrim:rtrim$1,safeCb:safeCb$1,safeDel:safeDel$1,safeGet:safeGet$1,safeSet:safeSet$1,safeStorage:safeStorage$1,sameOrigin:sameOrigin$1,sample:sample$1,scrollTo:scrollTo$1,seedRandom:seedRandom$1,selectionSort:selectionSort$1,selector:selector$1,shebang:shebang$1,shellSort:shellSort$1,shuffle:shuffle$1,size:size$1,sizeof:sizeof,sleep:sleep$1,slice:slice$1,slugify:slugify$1,snakeCase:snakeCase$1,some:some$1,sortBy:sortBy$1,sortKeys:sortKeys$1,spaceCase:spaceCase$1,splitCase:splitCase$1,splitPath:splitPath$1,stackTrace:stackTrace$1,startWith:startWith$1,strHash:strHash$1,strToBytes:strToBytes$1,strTpl:strTpl$1,strWidth:strWidth$1,stringify:stringify$1,stringifyAll:stringifyAll$1,stripAnsi:stripAnsi$1,stripCmt:stripCmt$1,stripColor:stripColor$1,stripHtmlTag:stripHtmlTag$1,stripIndent:stripIndent$1,stripNum:stripNum$1,sum:sum$1,swap:swap$1,table:table$1,template:template$1,throttle:throttle$1,timeAgo:timeAgo$1,timeTaken:timeTaken$1,times:times$1,toArr:toArr$1,toAsync:toAsync$1,toBool:toBool$1,toDate:toDate$1,toEl:toEl$1,toInt:toInt$1,toNum:toNum$1,toSrc:toSrc$1,toStr:toStr$1,topoSort:topoSort$1,trigger:trigger$1,trim:trim$1,truncate:truncate$1,tryIt:tryIt$1,type:type$1,types:types$1,ucs2:ucs2$1,uncaught:uncaught$1,unescape:unescape,union:union$1,uniqId:uniqId$1,unique:unique$1,universalify:universalify$1,unzip:unzip$1,upperCase:upperCase$1,upperFirst:upperFirst$1,use:use$1,utf8:utf8$1,uuid:uuid$1,values:values$1,viewportScale:viewportScale$1,vlq:vlq$1,waitUntil:waitUntil$1,waterfall:waterfall$1,wordWrap:wordWrap$1,wordsToBytes:wordsToBytes$1,workerize:workerize$1,wrap:wrap$1,xpath:xpath$1,zip:zip$1&#125;);export default $nux;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在浏览器控制台安装js库</title>
      <link href="/2021/12/30/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%AE%89%E8%A3%85js%E5%BA%93/"/>
      <url>/2021/12/30/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%AE%89%E8%A3%85js%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<p>根据js库名，在浏览器控制台临时安装此js库<br><a id="more"></a></p><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// 存储原始传入的名称</span><br><span class="line">let pkg_name_origin = null;</span><br><span class="line">const npmInstall = (originName) =&gt; &#123;</span><br><span class="line">  // Trim string</span><br><span class="line">  const name = originName.trim();</span><br><span class="line">  pkg_name_origin = name;</span><br><span class="line">  // 三种引入方式</span><br><span class="line">  // 如果是一个有效的URL，直接通过&lt;script /&gt;标签插入</span><br><span class="line">  if (/^https?:\/\//.test(name)) return injectScript(name);</span><br><span class="line">  // 如果指定了版本，尝试使用unpkg加载</span><br><span class="line">  if (name.indexOf(&apos;@&apos;) !== -1) return unpkg(name);</span><br><span class="line">  // 否则，尝试使用cdnjs搜索</span><br><span class="line">  return cdnjs(name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 在页面中插入&lt;script /&gt;标签</span><br><span class="line">const injectScript = (url) =&gt; &#123;</span><br><span class="line">  const script = document.createElement(&apos;script&apos;);</span><br><span class="line">  script.src = url;</span><br><span class="line">  script.onload = () =&gt; &#123;</span><br><span class="line">    console.log(pkg_name_origin, &apos; 安装成功。&apos;);</span><br><span class="line">  &#125;;</span><br><span class="line">  script.onerror = () =&gt; &#123;</span><br><span class="line">    console.log(pkg_name_origin, &apos; 安装失败。&apos;);</span><br><span class="line">  &#125;;</span><br><span class="line">  document.body.appendChild(script);</span><br><span class="line">  // document.body.removeChild(script);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const unpkg = (name) =&gt; &#123;</span><br><span class="line">  injectScript(`https://unpkg.com/$&#123;name&#125;`);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const cdnjs = async (name) =&gt; &#123;</span><br><span class="line">  const searchPromise = await fetch(</span><br><span class="line">    `https://api.cdnjs.com/libraries?search=$&#123;name&#125;`,</span><br><span class="line">    // 不显示referrer的任何信息在请求头中</span><br><span class="line">    &#123; referrerPolicy: &apos;no-referrer&apos; &#125;</span><br><span class="line">  );</span><br><span class="line">  const &#123; results, total &#125; = await searchPromise.json();</span><br><span class="line">  if (total === 0) &#123;</span><br><span class="line">    console.error(&apos;Sorry, &apos;, name, &apos; not found, please try another keyword.&apos;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 取结果中最相关的一条</span><br><span class="line">  const &#123; name: exactName, latest: url &#125; = results[0];</span><br><span class="line">  if (name !== exactName) &#123;</span><br><span class="line">    console.log(name, &apos; not found, import &apos;, exactName, &apos; instead.&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">  // 通过&lt;script /&gt;标签插入</span><br><span class="line">  injectScript(url);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npmInstall(&apos;jquery&apos;);</span><br><span class="line">npmInstall(&apos;axios&apos;);</span><br><span class="line">npmInstall(&apos;moment.js&apos;);</span><br><span class="line">npmInstall(&apos;loadsh.js&apos;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js屏幕录制</title>
      <link href="/2021/12/13/js%E5%B1%8F%E5%B9%95%E5%BD%95%E5%88%B6/"/>
      <url>/2021/12/13/js%E5%B1%8F%E5%B9%95%E5%BD%95%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>javascript屏幕录制<br><a id="more"></a><br>新版本浏览器支持js的屏幕录制功能，用到了navigator.mediaDevices.getDisplayMedia方法和MediaRecorder类。<br>demo:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;js屏幕录制&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;video class=&quot;video&quot; width=&quot;600px&quot; controls&gt;&lt;/video&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button class=&quot;record-btn&quot;&gt;record&lt;/button&gt;</span><br><span class="line">    &lt;button class=&quot;stop-btn&quot; style=&quot;display: none;&quot;&gt;stop&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  let mediaRecorder, stream;</span><br><span class="line">  let btnRecord = document.querySelector(&quot;.record-btn&quot;)</span><br><span class="line">  let btnStop = document.querySelector(&quot;.stop-btn&quot;)</span><br><span class="line">  </span><br><span class="line">  btnRecord.addEventListener(&quot;click&quot;, async function () &#123;</span><br><span class="line">    btnStop.style.display = &apos;block&apos;;</span><br><span class="line">    btnRecord.style.display = &apos;none&apos;;</span><br><span class="line"></span><br><span class="line">    stream = await navigator.mediaDevices.getDisplayMedia(&#123; </span><br><span class="line">      video: true</span><br><span class="line">    &#125;) </span><br><span class="line">    // 需要更好的浏览器支持 </span><br><span class="line">    const mime = MediaRecorder.isTypeSupported(&quot;video/webm; codecs=vp9&quot;)  </span><br><span class="line">               ? &quot;video/webm; codecs=vp9&quot; </span><br><span class="line">               : &quot;video/webm&quot;</span><br><span class="line">    mediaRecorder = new MediaRecorder(stream, &#123; </span><br><span class="line">        mimeType: mime </span><br><span class="line">    &#125;) </span><br><span class="line">    </span><br><span class="line">    let chunks = [] </span><br><span class="line">    mediaRecorder.addEventListener(&apos;dataavailable&apos;, function(e) &#123; </span><br><span class="line">        chunks.push(e.data) </span><br><span class="line">    &#125;) </span><br><span class="line">    </span><br><span class="line">    mediaRecorder.addEventListener(&apos;stop&apos;, function()&#123; </span><br><span class="line">      let blob = new Blob(chunks, &#123; </span><br><span class="line">          type: chunks[0].type </span><br><span class="line">      &#125;) </span><br><span class="line">      let url = URL.createObjectURL(blob) </span><br><span class="line">  </span><br><span class="line">      let video = document.querySelector(&quot;video&quot;) </span><br><span class="line">      video.src = url </span><br><span class="line">  </span><br><span class="line">      let a = document.createElement(&apos;a&apos;) </span><br><span class="line">      a.href = url </span><br><span class="line">      a.download = &apos;video.webm&apos;</span><br><span class="line">      a.click()</span><br><span class="line">    &#125;) </span><br><span class="line">    // 必须手动启动 </span><br><span class="line">    mediaRecorder.start() </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  btnStop.addEventListener(&apos;click&apos;, function(evt) &#123;</span><br><span class="line">    btnStop.style.display = &apos;none&apos;;</span><br><span class="line">    btnRecord.style.display = &apos;block&apos;;</span><br><span class="line">    // 隐藏记录的图标</span><br><span class="line">    stream.getTracks() // get all tracks from the MediaStream</span><br><span class="line">    .forEach( track =&gt; track.stop() ); // stop each of them</span><br><span class="line"></span><br><span class="line">    mediaRecorder.stop();</span><br><span class="line">  &#125;, false);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js正则几个知识点总结</title>
      <link href="/2021/11/05/js%E6%AD%A3%E5%88%99%E5%87%A0%E4%B8%AA%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
      <url>/2021/11/05/js%E6%AD%A3%E5%88%99%E5%87%A0%E4%B8%AA%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>javascript几个容易忘记知识点总结<br><a id="more"></a></p><h1 id="js正则几个知识点总结"><a href="#js正则几个知识点总结" class="headerlink" title="js正则几个知识点总结"></a>js正则几个知识点总结</h1><p>正则中有几个知识点笔者经常忘记，记录下。</p><p><img src="/2021/11/05/js正则几个知识点总结/1.jpg" alt="正则表达式的方法"></p><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="模式匹配的用法-x"><a href="#模式匹配的用法-x" class="headerlink" title="模式匹配的用法(x)"></a>模式匹配的用法(x)</h3><blockquote><p>模式匹配主要用来匹配某一类字符串并记住匹配项.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;xuxi is xuxi is&apos;</span><br><span class="line">let reg = /(xuxi) (is) \1 \2/g</span><br><span class="line">reg.test(str)  // true    (1)</span><br><span class="line">str.replace(reg, &apos;$1 $2&apos;)  // xuxi is  (2)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> 其中括号被称为捕获括号, 模式中的 \1 和 \2 表示第一个和第二个被捕获括号匹配的子字符串，即 xuxi 和 is，匹配了原字符串中的后两个单词, 因此(1)中运行的结果为true. 当我们在字符串中使用replace时, 我们可以使用$1, $2这样的方式获取第n个匹配项,并用来替换字符串. 如(2)中的运行结果.</p><h3 id="非捕获括号的模式匹配-x"><a href="#非捕获括号的模式匹配-x" class="headerlink" title="非捕获括号的模式匹配(?:x)"></a>非捕获括号的模式匹配(?:x)</h3><blockquote><p>主要用来匹配某一类字符串但不记住匹配项.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;xuxixuxi&apos;</span><br><span class="line">let reg = /(?:xuxi)&#123;1,2&#125;/g</span><br><span class="line">reg.test(str)  // true    (1)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> 其中(?:)被称为非捕获括号, 我们可以使用它匹配一组字符但是并不记住该字符,一般用来判断某类字符是否存在于某字符串中.</p><h3 id="先行断言x-y"><a href="#先行断言x-y" class="headerlink" title="先行断言x(?=y)"></a>先行断言x(?=y)</h3><blockquote><p>先行断言: 匹配’x’仅仅当’x’后面跟着’y’.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;王者融化&apos;</span><br><span class="line">let reg = /王(?=者)/</span><br><span class="line">reg.test(str)  // true    (1)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> /王(?=者)/会匹配到”王”仅当它后面跟着”者”.但是”者”不属于匹配结果的一部分.</p><h3 id="后行断言-lt-y-x"><a href="#后行断言-lt-y-x" class="headerlink" title="后行断言(?&lt;=y)x"></a>后行断言(?&lt;=y)x</h3><blockquote><p>后行断言: 匹配’x’仅当’x’前面是’y’.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;xuxiA&apos;</span><br><span class="line">let reg = /(?&lt;=xuxi)A/</span><br><span class="line">reg.test(str)  // true    (1)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> /(?&lt;=xuxi)A/会匹配到A仅当它前面为xuxi.但是xuxi不属于匹配结果的一部分.</p><h3 id="正向否定查找x-y"><a href="#正向否定查找x-y" class="headerlink" title="正向否定查找x(?!y)"></a>正向否定查找x(?!y)</h3><blockquote><p>正向否定查找: 仅仅当’x’后面不跟着’y’时匹配’x’.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;3.1415&apos;</span><br><span class="line">let reg = /\d+(?!\.)/</span><br><span class="line">reg.exec(str)  // [1415]   (1)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> 其中/\d+(?!.)/匹配一个或多个数字,当且仅当它后面没有小数点时, 所以(1)中执行后会匹配到1415而不是3.1415</p><h3 id="反向否定查找-lt-y-x"><a href="#反向否定查找-lt-y-x" class="headerlink" title="反向否定查找(?&lt;!y)x"></a>反向否定查找(?&lt;!y)x</h3><blockquote><p>反向否定查找: 仅仅当’x’前面不是’y’时匹配’x’.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;3.1415&apos;</span><br><span class="line">let reg = /(?&lt;!\.)\d+/</span><br><span class="line">reg.exec(str)  // [3]    (1)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> /(?&lt;!.)\d+/匹配一个数字,当且仅当前面字符不是.时,此时将匹配3.</p><h3 id="字符集合和反向字符集合的用法-xyz-xyz"><a href="#字符集合和反向字符集合的用法-xyz-xyz" class="headerlink" title="字符集合和反向字符集合的用法 xyz / ^xyz"></a>字符集合和反向字符集合的用法 <a href="一个字符集合。匹配方括号中的任意字符，包括转义序列。你可以使用破折号（-）来指定一个字符范围。">xyz</a> / <a href="一个反向字符集。也就是说，它匹配任何没有包含在方括号中的字符。你可以使用破折号（-）来指定一个字符范围。任何普通字符在这里都是起作用的">^xyz</a></h3><blockquote></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;abcd&apos;</span><br><span class="line">let reg1 = /[a-c]+/</span><br><span class="line">let reg2 = /[^d]$/</span><br><span class="line">reg1.test(str)  // true    (1)</span><br><span class="line">reg2.test(str)  // false    (2)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> (1)中将返回true因为字符串中包含a-c中的字符, (2)中奖返回false, 因为字符串结尾为d, 但正则reg2需要匹配结尾不为d的字符串.</p><h3 id="词边界和非单词边界匹配-b-B"><a href="#词边界和非单词边界匹配-b-B" class="headerlink" title="词边界和非单词边界匹配\b\B"></a>词边界和非单词边界匹配\b\B</h3><blockquote><p>\b 匹配一个词的边界。一个词的边界就是一个词不被另外一个“字”字符跟随的位置或者前面跟其他“字”字符的位置，例如在字母和空格之间。注意，匹配中不包括匹配的字边界。换句话说，一个匹配的词的边界的内容的长度是0。<br>\B 匹配一个非单词边界。匹配如下几种情况：(1)字符串第一个字符为非“字”字符 (2)字符串最后一个字符为非“字”字符 (3)两个单词字符之间 (4)两个非单词字符之间 (5)空字符串</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;xuxi&apos;</span><br><span class="line">let reg1 = /xi\b/</span><br><span class="line">let reg2 = /xu\B/</span><br><span class="line">reg1.exec(str)  // [xi]    (1)</span><br><span class="line">reg2.exec(str)  // [xu]    (2)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> (1)中匹配到了单词边界,即xi, 为该字符串的末尾.(2)中应为xu为非单词边界,所以会被其匹配到.</p><h3 id="空白字符-非空白字符匹配-s-S"><a href="#空白字符-非空白字符匹配-s-S" class="headerlink" title="空白字符/非空白字符匹配\s\S"></a>空白字符/非空白字符匹配\s\S</h3><blockquote><p>\s: 匹配一个空白字符，包括空格、制表符、换页符和换行符.<br>\S: 匹配一个非空白字符</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let str = &apos;xuxi is&apos;</span><br><span class="line">let reg1 = /.*\s/g</span><br><span class="line">let reg2 = /\S\w*/g</span><br><span class="line">reg1.exec(str)  // [xuxi ]    (1)</span><br><span class="line">reg2.exec(str)  // [xuxi]    (2)</span><br></pre></td></tr></table></figure><p><strong>解释:</strong> (1)和(2)中执行之后都将匹配xuxi, 一个是空白字符之前的匹配, 一个是非空白字符的匹配.</p><h3 id="单字字符-非单字字符匹配-w-W"><a href="#单字字符-非单字字符匹配-w-W" class="headerlink" title="单字字符/非单字字符匹配\w/W"></a>单字字符/非单字字符匹配\w/W</h3><blockquote><p>\w: 匹配一个单字字符（字母、数字或者下划线）。等价于 [A-Za-z0-9_]。<br>\W: 匹配一个非单字字符。等价于 [^A-Za-z0-9_]</p></blockquote><h3 id="贪婪模式和非贪婪模式"><a href="#贪婪模式和非贪婪模式" class="headerlink" title="贪婪模式和非贪婪模式"></a>贪婪模式和非贪婪模式</h3><blockquote><p>贪婪模式：正则表达式趋向于匹配最大长度。<br>非贪婪模式：正则表达式趋向于匹配最小长度，即一旦匹配到结果就结束。<br>默认是贪婪模式。<br>若 量词 后面添加 问号(?)，则是非贪婪模式。量词 包括以下4种：<br>{m, n}：匹配 m 到 n 个，包含 m、n。<br>{N} –&gt; 匹配N次<br>{M, N} –&gt; 匹配M到N次<br>{M,} –&gt; 匹配至少M次<br>{,N} –&gt; 匹配至多N次<br>*：匹配任意多个，包括0个。<br>+：匹配1到多个。<br>?：0或1个。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str = &quot;abcaxc&quot;;</span><br><span class="line">Pattern p1 = &quot;ab.*c&quot;;  # 贪婪模式，匹配结果是：abcaxc</span><br><span class="line">Pattern p2 = &quot;ab.*?c&quot;;  # 量词*后面添加?，是非贪婪模式，匹配结果：abc</span><br></pre></td></tr></table></figure><h2 id="常用案例"><a href="#常用案例" class="headerlink" title="常用案例"></a>常用案例</h2><h3 id="去除字符串内指定元素的标签"><a href="#去除字符串内指定元素的标签" class="headerlink" title="去除字符串内指定元素的标签"></a>去除字符串内指定元素的标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function trimTag(tagName, htmlStr) &#123;</span><br><span class="line">  let reg = new RegExp(`&lt;$&#123;tagName&#125;(\\s.*)*&gt;(\\n|.)*&lt;\\/$&#123;tagName&#125;&gt;`, &quot;g&quot;)</span><br><span class="line">  return htmlStr.replace(reg, &apos;&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="短横线命名转驼峰命名"><a href="#短横线命名转驼峰命名" class="headerlink" title="短横线命名转驼峰命名"></a>短横线命名转驼峰命名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 短横线转驼峰命名, flag = 0为小驼峰, 1为大驼峰</span><br><span class="line">function toCamelCase(str, flag = 0) &#123;</span><br><span class="line">  if(flag) &#123;</span><br><span class="line">    return str[0].toUpperCase() + str.slice(1).replace(/-(\w)/g, ($0, $1) =&gt; $1.toUpperCase())</span><br><span class="line">  &#125;else &#123;</span><br><span class="line">    return str.replace(/-(\w)/g, ($0, $1) =&gt; $1.toUpperCase())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="去除字符串中的空格符"><a href="#去除字符串中的空格符" class="headerlink" title="去除字符串中的空格符"></a>去除字符串中的空格符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function trimAll(str) &#123;</span><br><span class="line">  return str.replace(/\s*/g,&quot;&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判断指定格式的数据输入合法性"><a href="#判断指定格式的数据输入合法性" class="headerlink" title="判断指定格式的数据输入合法性"></a>判断指定格式的数据输入合法性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function numCheck(str, specialNum) &#123;</span><br><span class="line">  if(str.indexOf(&apos;,&apos;) &gt; -1) &#123;</span><br><span class="line">      return str.splite(&apos;,&apos;).every(item=&gt;this.numCheck(item));</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      return str.split(specialNum).length === 2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="去除url参数字符串中值为空的字段"><a href="#去除url参数字符串中值为空的字段" class="headerlink" title="去除url参数字符串中值为空的字段"></a>去除url参数字符串中值为空的字段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 去除url参数字符串中值为空的字段</span><br><span class="line">const trimParmas = (parmaStr:string = &apos;&apos;) =&gt; &#123;</span><br><span class="line">  return parmaStr.replace(/((\w*?)=&amp;|(&amp;\w*?=)$)/g, &apos;&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="将浏览器参数字符串转化为参数对象"><a href="#将浏览器参数字符串转化为参数对象" class="headerlink" title="将浏览器参数字符串转化为参数对象"></a>将浏览器参数字符串转化为参数对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function unParams(params = &apos;?a=1&amp;b=2&amp;c=3&apos;) &#123;</span><br><span class="line">  let obj = &#123;&#125;</span><br><span class="line">  params &amp;&amp; params.replace(/((\w*)=([\.a-z0-9A-Z]*)?)?/g, (m,a,b,c) =&gt; &#123;</span><br><span class="line">    if(b || c) obj[b] = c</span><br><span class="line">  &#125;)</span><br><span class="line">  return obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算字符串字节数"><a href="#计算字符串字节数" class="headerlink" title="计算字符串字节数"></a>计算字符串字节数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 计算字符串字节数</span><br><span class="line"> * @param str</span><br><span class="line"> * @desc 一个中文占2个字节, 一个英文占一个字节</span><br><span class="line"> */</span><br><span class="line">function computeStringByte(str) &#123;</span><br><span class="line">  let size = 0,</span><br><span class="line">  strArr = str.split(&apos;&apos;),</span><br><span class="line">  reg = /[\u4e00-\u9fa5]/   // 判断是否为中文</span><br><span class="line">  for(let i = strArr.length; i--; i&gt;=0) &#123;</span><br><span class="line">    if(reg.test(strArr[i])) &#123;</span><br><span class="line">      size+= 2</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">      size += 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return size</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="匹配是否包含中文字符"><a href="#匹配是否包含中文字符" class="headerlink" title="匹配是否包含中文字符"></a>匹配是否包含中文字符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function hasCn(str) &#123;</span><br><span class="line">  let reg = /[\u4e00-\u9fa5]/g</span><br><span class="line">  return reg.test(str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现搜索联想功能"><a href="#实现搜索联想功能" class="headerlink" title="实现搜索联想功能"></a>实现搜索联想功能</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function searchLink(keyword) &#123;</span><br><span class="line">  // 模拟后端返回数据</span><br><span class="line">  let list = [&apos;abc&apos;, &apos;ab&apos;, &apos;a&apos;, &apos;bcd&apos;, &apos;edf&apos;, &apos;abd&apos;];</span><br><span class="line">  let reg = new RegExp(keyword, &apos;i&apos;);</span><br><span class="line">  return list.filter(item =&gt; reg.test(item))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这里内容都比较简单，系统学习请<a href="https://github.com/jinux7/study-collections/tree/master/%E6%AD%A3%E5%88%99%E5%B0%8F%E5%86%8C" target="_blank" rel="noopener">点击这里学习</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 正则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js加减乘除精度处理</title>
      <link href="/2021/11/02/js%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E7%B2%BE%E5%BA%A6%E5%A4%84%E7%90%86/"/>
      <url>/2021/11/02/js%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E7%B2%BE%E5%BA%A6%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>js对加减乘除精度不准确的处理函数<br><a id="more"></a></p><h1 id="js加减乘除精度处理"><a href="#js加减乘除精度处理" class="headerlink" title="js加减乘除精度处理"></a>js加减乘除精度处理</h1><p>javascript在处理加减乘除的时候是有精度不准确问题的，<a href="/2019/07/04/js中小数精度问题/">详情这里查看</a>。<br>日常开发中，如果为了保持精度准确，需要自己封装些方法。</p><h2 id="简单的封装"><a href="#简单的封装" class="headerlink" title="简单的封装"></a>简单的封装</h2><h3 id="加法"><a href="#加法" class="headerlink" title="加法"></a>加法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> ** 加法函数，用来得到精确的加法结果</span><br><span class="line"> ** 说明：javascript的加法结果会有误差，在两个浮点数相加的时候会比较明显。这个函数返回较为精确的加法结果。</span><br><span class="line"> ** 调用：accAdd(arg1,arg2)</span><br><span class="line"> ** 返回值：arg1加上arg2的精确结果</span><br><span class="line"> **/</span><br><span class="line">function accAdd(arg1, arg2) &#123;</span><br><span class="line">    let r1, r2, m</span><br><span class="line">    try &#123;</span><br><span class="line">        r1 = arg1.toString().split(&apos;.&apos;)[1].length</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        r1 = 0</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        r2 = arg2.toString().split(&apos;.&apos;)[1].length</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        r2 = 0</span><br><span class="line">    &#125;</span><br><span class="line">    m = Math.pow(10, Math.max(r1, r2))</span><br><span class="line">    return (arg1 * m + arg2 * m) / m</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="减法"><a href="#减法" class="headerlink" title="减法"></a>减法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> ** 减法函数，用来得到精确的减法结果</span><br><span class="line"> ** 说明：javascript的减法结果会有误差，在两个浮点数相减的时候会比较明显。这个函数返回较为精确的减法结果。</span><br><span class="line"> ** 调用：accSub(arg1,arg2)</span><br><span class="line"> ** 返回值：arg1加上arg2的精确结果</span><br><span class="line"> **/</span><br><span class="line">function accSub(arg1, arg2) &#123;</span><br><span class="line">  var r1, r2, m, n;</span><br><span class="line">  try &#123;</span><br><span class="line">    r1 = arg1.toString().split(&quot;.&quot;)[1].length;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    r1 = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  try &#123;</span><br><span class="line">    r2 = arg2.toString().split(&quot;.&quot;)[1].length;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    r2 = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  m = Math.pow(10, Math.max(r1, r2)); //last modify by deeka //动态控制精度长度</span><br><span class="line">  n = r1 &gt;= r2 ? r1 : r2;</span><br><span class="line">  return ((arg1 * m - arg2 * m) / m).toFixed(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="乘法"><a href="#乘法" class="headerlink" title="乘法"></a>乘法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> ** 乘法函数，用来得到精确的乘法结果</span><br><span class="line"> ** 说明：javascript的乘法结果会有误差，在两个浮点数相乘的时候会比较明显。这个函数返回较为精确的乘法结果。</span><br><span class="line"> ** 调用：accMul(arg1,arg2)</span><br><span class="line"> ** 返回值：arg1乘以 arg2的精确结果</span><br><span class="line"> **/</span><br><span class="line"> </span><br><span class="line">function accMul(arg1, arg2) &#123;</span><br><span class="line">    let m = 0</span><br><span class="line">    let s1 = arg1.toString()</span><br><span class="line">    let s2 = arg2.toString()</span><br><span class="line">    try &#123;</span><br><span class="line">        m += s1.split(&apos;.&apos;)[1] ? s1.split(&apos;.&apos;)[1].length : &apos;&apos;</span><br><span class="line">    &#125; catch (e) &#123;&#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        m += s2.split(&apos;.&apos;)[1] ? s2.split(&apos;.&apos;)[1].length : &apos;&apos;</span><br><span class="line">    &#125; catch (e) &#123;&#125;</span><br><span class="line">    return (Number(s1.replace(&apos;.&apos;, &apos;&apos;)) * Number(s2.replace(&apos;.&apos;, &apos;&apos;))) / Math.pow(10, m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="除法"><a href="#除法" class="headerlink" title="除法"></a>除法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> ** 除法函数，用来得到精确的除法结果</span><br><span class="line"> ** 说明：javascript的除法结果会有误差，在两个浮点数相除的时候会比较明显。这个函数返回较为精确的除法结果。</span><br><span class="line"> ** 调用：accDiv(arg1,arg2)</span><br><span class="line"> ** 返回值：arg1除以arg2的精确结果</span><br><span class="line"> **/</span><br><span class="line">function accDiv(arg1, arg2) &#123;</span><br><span class="line">    let t1 = 0</span><br><span class="line">    let t2 = 0</span><br><span class="line">    let r1</span><br><span class="line">    let r2</span><br><span class="line">    try &#123;</span><br><span class="line">        t1 = arg1.toString().split(&apos;.&apos;)[1].length</span><br><span class="line">    &#125; catch (e) &#123;&#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        t2 = arg2.toString().split(&apos;.&apos;)[1].length</span><br><span class="line">    &#125; catch (e) &#123;&#125;</span><br><span class="line">    r1 = Number(arg1.toString().replace(&apos;.&apos;, &apos;&apos;))</span><br><span class="line">    r2 = Number(arg2.toString().replace(&apos;.&apos;, &apos;&apos;))</span><br><span class="line">    return (r1 / r2) * Math.pow(10, t2 - t1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是加减乘除的精度处理方法，下面列举几个有关数字处理的js库，除了精度以外，还有很多方便的方法。</p><h2 id="js中number处理库"><a href="#js中number处理库" class="headerlink" title="js中number处理库"></a>js中number处理库</h2><h3 id="big-js"><a href="#big-js" class="headerlink" title="big.js"></a>big.js</h3><p><a href="https://github.com/favio41/big-js#readme" target="_blank" rel="noopener">文档</a></p><h3 id="bignumber-js"><a href="#bignumber-js" class="headerlink" title="bignumber.js"></a>bignumber.js</h3><p><a href="https://mikemcl.github.io/bignumber.js/" target="_blank" rel="noopener">文档</a></p><h3 id="decimal-js"><a href="#decimal-js" class="headerlink" title="decimal.js"></a>decimal.js</h3><p><a href="https://github.com/MikeMcl/decimal.js#readme" target="_blank" rel="noopener">文档</a></p><h3 id="Math-js"><a href="#Math-js" class="headerlink" title="Math.js"></a>Math.js</h3><p><a href="https://mathjs.org/" target="_blank" rel="noopener">文档</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript实现AOP（面向切面编程）</title>
      <link href="/2021/09/23/JavaScript%E5%AE%9E%E7%8E%B0AOP%EF%BC%88%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%EF%BC%89/"/>
      <url>/2021/09/23/JavaScript%E5%AE%9E%E7%8E%B0AOP%EF%BC%88%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>javascript实现切面编程<br><a id="more"></a></p><h1 id="JavaScript实现AOP（面向切面编程）"><a href="#JavaScript实现AOP（面向切面编程）" class="headerlink" title="JavaScript实现AOP（面向切面编程）"></a>JavaScript实现AOP（面向切面编程）</h1><h2 id="什么是AOP"><a href="#什么是AOP" class="headerlink" title="什么是AOP"></a>什么是AOP</h2><p>AOP(面向切面编程)的主要作用是把一些跟核心业务逻辑模块无关的功能抽离出来，这些跟业务逻辑无关的功能通常包括日志统计、安全控制、异常处理等。把这些功能抽离出来之后， 再通过“动态织入”的方式掺入业务逻辑模块中。</p><h2 id="AOP能给我们带来什么好处"><a href="#AOP能给我们带来什么好处" class="headerlink" title="AOP能给我们带来什么好处"></a>AOP能给我们带来什么好处</h2><p>AOP的好处首先是可以保持业务逻辑模块的纯净和高内聚性，其次是可以很方便地复用日志统计等功能模块。</p><h2 id="JavaScript实现AOP"><a href="#JavaScript实现AOP" class="headerlink" title="JavaScript实现AOP"></a>JavaScript实现AOP</h2><p>在 JavaScript 中实现 AOP，都是指把一个函数“动态织入”到另外一个函数之中，具体的实现技术有很多，下面我用扩展 Function.prototype 来做到这一点。请看下面代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.before = function (beforefn) &#123;</span><br><span class="line">  var _self = this;    //保存原函数引用</span><br><span class="line">  return function () &#123; //返回包含了原函数和新函数的&quot;代理函数&quot;</span><br><span class="line">    beforefn.apply(this, arguments); //执行新函数，修正this</span><br><span class="line">    return _self.apply(this, arguments); //执行原函数</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Function.prototype.after = function (afterfn) &#123;</span><br><span class="line">  var _self = this;</span><br><span class="line">  return function () &#123;</span><br><span class="line">    var ret = _self.apply(this, arguments);</span><br><span class="line">    afterfn.apply(this, arguments);</span><br><span class="line">    return ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var func = function () &#123;</span><br><span class="line">  console.log(&quot;2&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func = </span><br><span class="line">func.before(function () &#123;</span><br><span class="line">  console.log(&quot;1&quot;);</span><br><span class="line">&#125;).after(function () &#123;</span><br><span class="line">  console.log(&quot;3&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">func();</span><br></pre></td></tr></table></figure></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>实现切面编程的方式很多，这种方式简洁易懂，容易理解。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack-threejs-FontLoader</title>
      <link href="/2021/09/13/webpack-threejs-FontLoader/"/>
      <url>/2021/09/13/webpack-threejs-FontLoader/</url>
      
        <content type="html"><![CDATA[<p>webpack和threejs配合使用的一些小问题<br><a id="more"></a></p><h1 id="webpack-threejs-FontLoader"><a href="#webpack-threejs-FontLoader" class="headerlink" title="webpack-threejs-FontLoader"></a>webpack-threejs-FontLoader</h1><p>在webpack的项目中使用threejs，new THREE.FontLoader()这个threejs的字体类，有一个方法load，正常的写法是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loader.load( &apos;font/&apos; + fontName + &apos;_&apos; + fontWeight + &apos;.typeface.json&apos;, function ( response ) &#123;</span><br><span class="line">  font = response;</span><br><span class="line">  refreshText();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>可以看出，load这个方法是在js运行时执行的，这时候要载入的json文件的路径就是一个问题。<br>目前有2种方法可以解决。</p><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>配置public文件夹，可以使用copy-webpack-plugin这个插件，之后的字体加载路径就是public下font字体的路径了。</p><h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>利用import将json文件加载，加载后的是一个json对象，再将这个json对象转换成blob对象，再利用URL.createObjectURL(blob)生成一个url的内存。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import ziti from &apos;./assets/font/optimer_bold.typeface.json&apos;;</span><br><span class="line">const loader = new THREE.FontLoader();</span><br><span class="line">  const blob = new Blob([JSON.stringify(ziti)], &#123;</span><br><span class="line">    type: &apos;application/json&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">  loader.load(URL.createObjectURL(blob), function ( response ) &#123;</span><br><span class="line">    font = response;</span><br><span class="line">    refreshText();</span><br><span class="line">  &#125; );</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
            <tag> threejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs-require-cache</title>
      <link href="/2021/09/08/nodejs-require-cache/"/>
      <url>/2021/09/08/nodejs-require-cache/</url>
      
        <content type="html"><![CDATA[<p>nodejs中require缓存处理<br><a id="more"></a></p><h1 id="nodejs-require-cache"><a href="#nodejs-require-cache" class="headerlink" title="nodejs-require-cache"></a>nodejs-require-cache</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>在使用nodejs的require一个模块的时候，这个模块已经被缓存了起来，如果再次require这个模块，是从缓存中取出的。<br>这个有点像设计模式里的单例模式，只有这么一个实例，无论new多少个实例出来，返回的都是第一次的实例。<br>如果有这样的一个需求：<br>引入一个模块后，对这个模块里的内容进行了更改，正常来说再次引入这个模块，里边的内容是已经更改过的，但不想要改过的，想要一个新的，该如何处理呢？<br>这里需要了解下require的cache。</p><h2 id="实例demo"><a href="#实例demo" class="headerlink" title="实例demo"></a>实例demo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// a.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  name: &apos;a&apos;,</span><br><span class="line">  count: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// b.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  name: &apos;b&apos;,</span><br><span class="line">  count: 10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line">var a = require(&apos;./a&apos;);</span><br><span class="line">var b = require(&apos;./b&apos;);</span><br><span class="line">console.log(&apos;a moule---&gt;&apos;, a.count);</span><br><span class="line">console.log(&apos;b moule---&gt;&apos;, b.count);</span><br><span class="line">a.count = 5;</span><br><span class="line">b.count = 20;</span><br><span class="line">console.log(&apos;a plus 5 moule---&gt;&apos;, a.count);</span><br><span class="line">console.log(&apos;b plus 20 moule---&gt;&apos;, b.count);</span><br><span class="line">var newA = require(&apos;./a&apos;);</span><br><span class="line">var NewB = require(&apos;./b&apos;);</span><br><span class="line">console.log(&apos;new a moudle---&gt;&apos;, newA.count);</span><br><span class="line">console.log(&apos;new b moudle---&gt;&apos;, NewB.count);</span><br><span class="line">// 进行cache处理</span><br><span class="line">console.log(Object.prototype.toString.call(require.cache)); // require.cache是一个对象</span><br><span class="line">Object.keys(require.cache).forEach(key=&gt; &#123;</span><br><span class="line">  console.log(require.resolve(key)); // require.resolve(key)可以把相对路径转成绝对路径，使用更安全</span><br><span class="line">  // require.resolve(&apos;./a.js&apos;);</span><br><span class="line">  if(key.includes(&apos;a.js&apos;)) &#123;</span><br><span class="line">      delete require.cache[require.resolve(key)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(require.cache);</span><br><span class="line">var cacheA = require(&apos;./a&apos;);</span><br><span class="line">var cacheB = require(&apos;./b&apos;);</span><br><span class="line">console.log(&apos;new a moudle cache---&gt;&apos;, cacheA.count);</span><br><span class="line">console.log(&apos;new b moudle cache---&gt;&apos;, cacheB.count);</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>require.cache包含了当前所有的缓存模块，是一个对象{},key是文件路径<br>require.resolve(‘./a.js’),可以将相对路径转成绝对路径，key就是一个绝对路径<br>delete require.cache[key],清除掉了对应路径的缓存模块</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg-icon原理解析</title>
      <link href="/2021/09/07/svg-icon%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"/>
      <url>/2021/09/07/svg-icon%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>svg-icon在html中使用原理<br><a id="more"></a></p><h1 id="svg-icon原理解析"><a href="#svg-icon原理解析" class="headerlink" title="svg-icon原理解析"></a>svg-icon原理解析</h1><p>最近发现svg-icon在vue中使用频率很高，一些管理系统的模板都已经把它集成进去了。<br>svg-icon在vue中是如何工作的呢？<br>1) 首先，需要一些svg的图形文件<br>2) 在代码中把这些svg文件require进去<br>3) 使用svg-sprite-loader这个webpack插件，它可以把svg文件以标签形式插入到html中<br>4) 创建一个vue的svg-icon组件，用来显示svg图形，其实不创建组件直接写svg标签代码也可以<br>5) 使用vue的svg-icon组件来展示图形<br>以上就是使用步骤，下面贴出一套svg的原生demo：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;svg-icon&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; style=&quot;position: absolute; width: 0; height: 0&quot; id=&quot;__SVG_SPRITE_NODE__&quot;&gt;</span><br><span class="line">    &lt;symbol xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 128 128&quot; id=&quot;icon-tree-table&quot;&gt;&lt;path d=&quot;M44.8 0h79.543C126.78 0 128 1.422 128 4.267v23.466c0 2.845-1.219 4.267-3.657 4.267H44.8c-2.438 0-3.657-1.422-3.657-4.267V4.267C41.143 1.422 42.362 0 44.8 0zm22.857 48h56.686c2.438 0 3.657 1.422 3.657 4.267v23.466c0 2.845-1.219 4.267-3.657 4.267H67.657C65.22 80 64 78.578 64 75.733V52.267C64 49.422 65.219 48 67.657 48zm0 48h56.686c2.438 0 3.657 1.422 3.657 4.267v23.466c0 2.845-1.219 4.267-3.657 4.267H67.657C65.22 128 64 126.578 64 123.733v-23.466C64 97.422 65.219 96 67.657 96zM50.286 68.267c2.02 0 3.657-1.91 3.657-4.267 0-2.356-1.638-4.267-3.657-4.267H17.37V32h6.4c2.02 0 3.658-1.91 3.658-4.267V4.267C27.429 1.91 25.79 0 23.77 0H3.657C1.637 0 0 1.91 0 4.267v23.466C0 30.09 1.637 32 3.657 32h6.4v80c0 2.356 1.638 4.267 3.657 4.267h36.572c2.02 0 3.657-1.91 3.657-4.267 0-2.356-1.638-4.267-3.657-4.267H17.37V68.267h32.915z&quot;&gt;&lt;/path&gt;&lt;/symbol&gt;</span><br><span class="line">    &lt;symbol xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 128 128&quot; id=&quot;icon-tree&quot;&gt;&lt;path d=&quot;M126.713 90.023c.858.985 1.287 2.134 1.287 3.447v29.553c0 1.423-.429 2.6-1.287 3.53-.858.93-1.907 1.395-3.146 1.395H97.824c-1.145 0-2.146-.465-3.004-1.395-.858-.93-1.287-2.107-1.287-3.53V93.47c0-.875.19-1.696.572-2.462.382-.766.906-1.368 1.573-1.806a3.84 3.84 0 0 1 2.146-.657h9.725V69.007a3.84 3.84 0 0 0-.43-1.806 3.569 3.569 0 0 0-1.143-1.313 2.714 2.714 0 0 0-1.573-.492h-36.47v23.149h9.725c1.144 0 2.145.492 3.004 1.478.858.985 1.287 2.134 1.287 3.447v29.553c0 .876-.191 1.696-.573 2.463-.38.766-.905 1.368-1.573 1.806a3.84 3.84 0 0 1-2.145.656H51.915a3.84 3.84 0 0 1-2.145-.656c-.668-.438-1.216-1.04-1.645-1.806a4.96 4.96 0 0 1-.644-2.463V93.47c0-1.313.43-2.462 1.288-3.447.858-.986 1.907-1.478 3.146-1.478h9.582v-23.15h-37.9c-.953 0-1.74.356-2.359 1.068-.62.711-.93 1.56-.93 2.544v19.538h9.726c1.239 0 2.264.492 3.074 1.478.81.985 1.216 2.134 1.216 3.447v29.553c0 1.423-.405 2.6-1.216 3.53-.81.93-1.835 1.395-3.074 1.395H4.29c-.476 0-.93-.082-1.358-.246a4.1 4.1 0 0 1-1.144-.657 4.658 4.658 0 0 1-.93-1.067 5.186 5.186 0 0 1-.643-1.395 5.566 5.566 0 0 1-.215-1.56V93.47c0-.437.048-.875.143-1.313a3.95 3.95 0 0 1 .429-1.15c.19-.328.429-.656.715-.984.286-.329.572-.602.858-.821.286-.22.62-.383 1.001-.493.382-.11.763-.164 1.144-.164h9.726V61.619c0-.985.31-1.833.93-2.544.619-.712 1.358-1.068 2.216-1.068h44.335V39.62h-9.582c-1.24 0-2.288-.492-3.146-1.477a5.09 5.09 0 0 1-1.287-3.448V5.14c0-1.423.429-2.627 1.287-3.612.858-.985 1.907-1.477 3.146-1.477h25.743c.763 0 1.478.246 2.145.739a5.17 5.17 0 0 1 1.573 1.888c.382.766.573 1.587.573 2.462v29.553c0 1.313-.43 2.463-1.287 3.448-.859.985-1.86 1.477-3.004 1.477h-9.725v18.389h42.762c.954 0 1.74.355 2.36 1.067.62.711.93 1.56.93 2.545v26.925h9.582c1.239 0 2.288.492 3.146 1.478z&quot;&gt;&lt;/path&gt;&lt;/symbol&gt;</span><br><span class="line">    &lt;symbol xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 130 130&quot; id=&quot;icon-user&quot;&gt;&lt;path d=&quot;M63.444 64.996c20.633 0 37.359-14.308 37.359-31.953 0-17.649-16.726-31.952-37.359-31.952-20.631 0-37.36 14.303-37.358 31.952 0 17.645 16.727 31.953 37.359 31.953zM80.57 75.65H49.434c-26.652 0-48.26 18.477-48.26 41.27v2.664c0 9.316 21.608 9.325 48.26 9.325H80.57c26.649 0 48.256-.344 48.256-9.325v-2.663c0-22.794-21.605-41.271-48.256-41.271z&quot; stroke=&quot;#979797&quot;&gt;&lt;/path&gt;&lt;/symbol&gt;</span><br><span class="line">    &lt;symbol xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 128 110&quot; id=&quot;icon-wechat&quot;&gt;&lt;path d=&quot;M86.635 33.334c1.467 0 2.917.113 4.358.283C87.078 14.392 67.58.111 45.321.111 20.44.111.055 17.987.055 40.687c0 13.104 6.781 23.863 18.115 32.209l-4.527 14.352 15.82-8.364c5.666 1.182 10.207 2.395 15.858 2.395 1.42 0 2.829-.073 4.227-.189-.886-3.19-1.398-6.53-1.398-9.996 0-20.845 16.98-37.76 38.485-37.76zm-24.34-12.936c3.407 0 5.665 2.363 5.665 5.954 0 3.576-2.258 5.97-5.666 5.97-3.392 0-6.795-2.395-6.795-5.97 0-3.591 3.403-5.954 6.795-5.954zM30.616 32.323c-3.393 0-6.818-2.395-6.818-5.971 0-3.591 3.425-5.954 6.818-5.954 3.392 0 5.65 2.363 5.65 5.954 0 3.576-2.258 5.97-5.65 5.97z&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M127.945 70.52c0-19.075-18.108-34.623-38.448-34.623-21.537 0-38.5 15.548-38.5 34.623 0 19.108 16.963 34.622 38.5 34.622 4.508 0 9.058-1.2 13.584-2.395l12.414 7.167-3.404-11.923c9.087-7.184 15.854-16.712 15.854-27.471zm-50.928-5.97c-2.254 0-4.53-2.362-4.53-4.773 0-2.378 2.276-4.771 4.53-4.771 3.422 0 5.665 2.393 5.665 4.771 0 2.41-2.243 4.773-5.665 4.773zm24.897 0c-2.24 0-4.498-2.362-4.498-4.773 0-2.378 2.258-4.771 4.498-4.771 3.392 0 5.665 2.393 5.665 4.771 0 2.41-2.273 4.773-5.665 4.773z&quot;&gt;&lt;/path&gt;&lt;/symbol&gt;</span><br><span class="line">    &lt;symbol xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 128 128&quot; id=&quot;icon-zip&quot;&gt;&lt;path d=&quot;M78.527 116.793c.178.008.348.024.527.024h40.233c4.711-.005 8.53-3.677 8.534-8.21V18.895c-.004-4.532-3.823-8.204-8.534-8.209H79.054c-.179 0-.353.016-.527.024V0L0 10.082v107.406l78.527 10.342v-11.037zm0-101.362c.174-.024.348-.052.527-.052h40.233c2.018 0 3.659 1.578 3.659 3.52v89.713c-.003 1.942-1.64 3.517-3.659 3.519H79.054c-.179 0-.353-.028-.527-.052V15.431zM30.262 75.757l-18.721-.46V72.37l11.3-16.673v-.148l-10.266.164v-4.51l17.504-.44v3.264L18.696 70.76v.144l11.566.176v4.678zm9.419.231l-5.823-.144V50.671l5.823-.144v25.461zm22.255-11.632c-2.168 1.922-5.353 2.76-9.02 2.736-.702.004-1.402-.04-2.097-.131v9.303l-5.997-.148V50.743c1.852-.352 4.473-.647 8.218-.743 3.838-.096 6.608.539 8.48 1.913 1.807 1.306 3.032 3.5 3.032 6.112s-.926 4.833-2.612 6.331h-.004zM53.36 54.45c-.856-.01-1.71.083-2.541.275v7.682c.523.116 1.167.152 2.06.152 3.301-.004 5.36-1.614 5.36-4.314 0-2.425-1.772-3.843-4.875-3.791l-.004-.004zm39.847-37.066h9.564v3.795h-9.564v-3.795zm-9.568 5.68h9.564v3.8h-9.564v-3.8zm9.568 6.216h9.564v3.799h-9.564V29.28zm0 12h9.564v3.794h-9.564V41.28zm-9.568-6.096h9.564v3.795h-9.564v-3.795zm9.472 47.064c2.512 0 4.921-.96 6.697-2.67 1.776-1.708 2.773-4.026 2.772-6.442l-1.748-15.263c0-5.033-2.492-9.112-7.725-9.112-5.232 0-7.72 4.079-7.72 9.112l-1.752 15.263c-.001 2.417.996 4.735 2.773 6.444 1.777 1.71 4.187 2.669 6.7 2.668h.003zm-3.135-16.75h6.27v12.743h-6.27V65.5z&quot;&gt;&lt;/path&gt;&lt;/symbol&gt;</span><br><span class="line">  &lt;/svg&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;svg&gt;</span><br><span class="line">        &lt;use xlink:href=&quot;#icon-tree-table&quot;&gt;&lt;/use&gt;</span><br><span class="line">      &lt;/svg&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;svg&gt;</span><br><span class="line">        &lt;use xlink:href=&quot;#icon-tree&quot;&gt;&lt;/use&gt;</span><br><span class="line">      &lt;/svg&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;svg&gt;</span><br><span class="line">        &lt;use xlink:href=&quot;#icon-user&quot;&gt;&lt;/use&gt;</span><br><span class="line">      &lt;/svg&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;svg&gt;</span><br><span class="line">        &lt;use xlink:href=&quot;#icon-wechat&quot;&gt;&lt;/use&gt;</span><br><span class="line">      &lt;/svg&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;svg&gt;</span><br><span class="line">        &lt;use xlink:href=&quot;#icon-zip&quot;&gt;&lt;/use&gt;</span><br><span class="line">      &lt;/svg&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web图形 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MutationObserver、IntersectionObserver、ResizeObserver</title>
      <link href="/2021/08/19/MutationObserver%E3%80%81IntersectionObserver%E3%80%81ResizeObserver/"/>
      <url>/2021/08/19/MutationObserver%E3%80%81IntersectionObserver%E3%80%81ResizeObserver/</url>
      
        <content type="html"><![CDATA[<p>MutationObserver、IntersectionObserver、ResizeObserver简单使用<br><a id="more"></a></p><h2 id="MutationObserver、IntersectionObserver、ResizeObserver"><a href="#MutationObserver、IntersectionObserver、ResizeObserver" class="headerlink" title="MutationObserver、IntersectionObserver、ResizeObserver"></a>MutationObserver、IntersectionObserver、ResizeObserver</h2><h3 id="MutationObserver"><a href="#MutationObserver" class="headerlink" title="MutationObserver"></a>MutationObserver</h3><p>用于监控DOM节点的变化，如 属性变化、子节点增删改、子树的变化等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 1、选择需要观察变动的节点</span><br><span class="line">const targetNode = document.getElementById(&apos;some-id&apos;);</span><br><span class="line">// 2、观察器的配置（需要观察什么变动）</span><br><span class="line">const config = &#123; attributes: true, childList: true, subtree: true &#125;;</span><br><span class="line">// 3、当观察到变动时执行的回调函数</span><br><span class="line">const callback = function(mutationsList, observer) &#123;</span><br><span class="line">    for(let mutation of mutationsList) &#123;</span><br><span class="line">        if (mutation.type === &apos;childList&apos;) &#123;</span><br><span class="line">            console.log(&apos;A child node has been added or removed.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (mutation.type === &apos;attributes&apos;) &#123;</span><br><span class="line">            console.log(&apos;The &apos; + mutation.attributeName + &apos; attribute was modified.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// 4、创建一个观察器实例并传入回调函数</span><br><span class="line">const observer = new MutationObserver(callback);</span><br><span class="line">// 5、以上述配置开始观察目标节点</span><br><span class="line">observer.observe(targetNode, config);</span><br><span class="line">// 6、之后，可停止观察</span><br><span class="line">observer.disconnect();</span><br></pre></td></tr></table></figure></p><p><a href="https://www.bookstack.cn/read/javascript-tutorial/docs-dom-mutationobserver.md" target="_blank" rel="noopener">详细解释</a></p><h3 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h3><p>目标元素是否进入视口区域(交叉观察器)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 图片懒加载的例子</span><br><span class="line">function callback(entry) &#123;</span><br><span class="line">  if(entry[0].isIntersecting) &#123;   // 出现在可视区内(默认 viewport)</span><br><span class="line">    entry[0].target.src = entry[0].target.dataset.src;</span><br><span class="line">    observer.unobserve(entry[0].target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">var observer = new IntersectionObserver(callback); // 这里可以指定第二个参数做些定制化配置</span><br><span class="line">var img = document.getElementById(&apos;img&apos;);</span><br><span class="line">observer.observe(img);</span><br></pre></td></tr></table></figure></p><p><a href="https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html" target="_blank" rel="noopener">详细解释</a></p><h3 id="ResizeObserver"><a href="#ResizeObserver" class="headerlink" title="ResizeObserver"></a>ResizeObserver</h3><p>专门用来观察DOM元素的尺寸是否发生了变化，不光是窗体resize<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var ro = new ResizeObserver( entries =&gt; &#123;</span><br><span class="line">  for (let entry of entries) &#123;</span><br><span class="line">    const cr = entry.contentRect;</span><br><span class="line">    console.log(&apos;Element:&apos;, entry.target);</span><br><span class="line">    console.log(`Element size: $&#123;cr.width&#125;px x $&#123;cr.height&#125;px`);</span><br><span class="line">    console.log(`Element padding: $&#123;cr.top&#125;px ; $&#123;cr.left&#125;px`);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">// 观察一个或多个元素</span><br><span class="line">ro.observe(eleZxx);</span><br></pre></td></tr></table></figure></p><p>注意：观测的是 contentRect，只有 content 改变（margin,padding不行）才会触发回调<br>用途：<br>1、原生resize行为的检测，如 textarea 的拉升<br>2、 感知交互行为的发生（无埋点方案？）<br>3、感知元素是否显示或隐藏（MutationObserver 有时做不到）<br><a href="https://www.zhangxinxu.com/wordpress/2020/03/dom-resize-api-resizeobserver/" target="_blank" rel="noopener">详细解释</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript错误类型</title>
      <link href="/2021/07/23/javascript%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B/"/>
      <url>/2021/07/23/javascript%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>javascript错误类型<br><a id="more"></a></p><h1 id="ECMA-262规范定义的七种错误类型："><a href="#ECMA-262规范定义的七种错误类型：" class="headerlink" title="ECMA-262规范定义的七种错误类型："></a>ECMA-262规范定义的七种错误类型：</h1><ul><li>Error</li><li>EvalError</li><li>RangeError</li><li>ReferenceError</li><li>SyntaxError</li><li>TypeError</li><li>URIError</li></ul><h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><p>Error是所有错误的基类，其他错误都继承自该类型</p><h2 id="EvalError"><a href="#EvalError" class="headerlink" title="EvalError"></a>EvalError</h2><p>EvalError对象表示全局函数eval()中发生的错误。如果eval()中没有错误，则不会抛出该错误。可以通过构造函数创建这个对象的实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">  throw new EvalError(&apos;make EvalError&apos;);</span><br><span class="line">&#125;catch(err) &#123;</span><br><span class="line">  console.log(err instanceof EvalError);</span><br><span class="line">  console.log(err.message);</span><br><span class="line">  console.log(err.name);</span><br><span class="line">  console.log(err.stack);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="RangeError"><a href="#RangeError" class="headerlink" title="RangeError"></a>RangeError</h2><p>RangeError对象表示当一个值不在允许值的集合或范围内时出现错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var arr = [];</span><br><span class="line">arr.length = -1;</span><br></pre></td></tr></table></figure></p><h2 id="ReferenceError"><a href="#ReferenceError" class="headerlink" title="ReferenceError"></a>ReferenceError</h2><p>当引用不存在的变量时，该对象表示错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var str = abc;</span><br></pre></td></tr></table></figure></p><h2 id="SyntaxError"><a href="#SyntaxError" class="headerlink" title="SyntaxError"></a>SyntaxError</h2><p>当JavaScript引擎在解析代码时遇到不符合该语言语法的标记或标记顺序时，将引发该异常<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var str = &apos;abc&apos;； // 这里的分号是中文分号</span><br></pre></td></tr></table></figure></p><h2 id="TypeError"><a href="#TypeError" class="headerlink" title="TypeError"></a>TypeError</h2><p>传递给函数的操作数或实参与该操作符或函数期望的类型不兼容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function fn(arr) &#123;</span><br><span class="line">    arr.map(item=&gt; item);</span><br><span class="line">&#125;</span><br><span class="line">fn(123);</span><br></pre></td></tr></table></figure></p><h2 id="URIError"><a href="#URIError" class="headerlink" title="URIError"></a>URIError</h2><p>当全局URI处理函数以错误的方式使用时<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.decodeURIComponent(&apos;%&apos;);</span><br></pre></td></tr></table></figure></p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>以上只是简单的介绍了js中的7种错误类型，还有更详细的错误处理请看<a href="/2020/02/27/前端异常处理/">前端异常处理</a>。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>工作中常用代码片段</title>
      <link href="/2021/07/12/%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/"/>
      <url>/2021/07/12/%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</url>
      
        <content type="html"><![CDATA[<p>工作中常用代码片段<br><a id="more"></a><br>记录些工作中常用到的代码片段，便于CV使用，提高效率</p><h2 id="根据日期对象获取格式化日期字符串"><a href="#根据日期对象获取格式化日期字符串" class="headerlink" title="根据日期对象获取格式化日期字符串"></a>根据日期对象获取格式化日期字符串</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const getYrarMonthDay = date=&gt; &#123;</span><br><span class="line">  let year = date.getFullYear();</span><br><span class="line">  let month = date.getMonth() + 1;</span><br><span class="line">  month = month&gt;9?month:&apos;0&apos;+month;</span><br><span class="line">  let day = date.getDate();</span><br><span class="line">  return year + &apos;-&apos; + month + &apos;-&apos; + day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="解析url中的参数"><a href="#解析url中的参数" class="headerlink" title="解析url中的参数"></a>解析url中的参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const urlQuery2Object = url=&gt; &#123;</span><br><span class="line">    url = !url ? window.location.href : url;</span><br><span class="line">    if(url.indexOf(&apos;?&apos;) === -1) &#123;</span><br><span class="line">        return &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    var search = url[0] === &apos;?&apos; ? url.substr(1) : url.substring(url.lastIndexOf(&apos;?&apos;) + 1);</span><br><span class="line">    if (search === &apos;&apos;) &#123;</span><br><span class="line">        return &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    search = search.split(&apos;&amp;&apos;);</span><br><span class="line">    var query = &#123;&#125;;</span><br><span class="line">    for (var i = 0; i &lt; search.length; i++) &#123;</span><br><span class="line">        var pair = search[i].split(&apos;=&apos;);</span><br><span class="line">        query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || &apos;&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    return query;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="触发input的选择获取文件"><a href="#触发input的选择获取文件" class="headerlink" title="触发input的选择获取文件"></a>触发input的选择获取文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const triggerInputFile = function(callBack) &#123;</span><br><span class="line">  return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        let nInput = document.createElement(&apos;input&apos;);</span><br><span class="line">        nInput.setAttribute(&apos;type&apos;, &apos;file&apos;);</span><br><span class="line">        nInput.setAttribute(&apos;accept&apos;, &apos;image/png,image/jpg,image/jpeg&apos;);</span><br><span class="line">        document.body.appendChild(nInput);</span><br><span class="line">        nInput.addEventListener(&apos;change&apos;, (ev)=&gt; &#123;</span><br><span class="line">        if(ev.target.files[0].size &gt; 1024*1024*2) &#123;</span><br><span class="line">            alert(&apos;图片大小不得超过2M&apos;);</span><br><span class="line">            return void 0;</span><br><span class="line">        &#125;</span><br><span class="line">        resolve(ev);</span><br><span class="line">        document.body.removeChild(nInput);</span><br><span class="line">        &#125;, false);</span><br><span class="line">        nInput.click();</span><br><span class="line">      &#125;catch(err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">      &#125;      </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="获取宿主浏览器环境"><a href="#获取宿主浏览器环境" class="headerlink" title="获取宿主浏览器环境"></a>获取宿主浏览器环境</h2><p><a href="/2021/06/08/h5移动端判断宿主平台/">详细内容可异步这里</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const getPlatformOs = ()=&gt; &#123;</span><br><span class="line">  return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      var u = navigator.userAgent;</span><br><span class="line">      var ua = navigator.userAgent.toLowerCase();</span><br><span class="line">      // 判断是否在微信内置浏览器打开</span><br><span class="line">      if(ua.match(/MicroMessenger/i) == &quot;micromessenger&quot;) &#123;</span><br><span class="line">        resolve(&apos;weixin&apos;)</span><br><span class="line">        return void 0; </span><br><span class="line">      &#125;</span><br><span class="line">      // 判断安卓</span><br><span class="line">      if(u.indexOf(&quot;Android&quot;) &gt; -1 || u.indexOf(&quot;Linux&quot;) &gt; -1) &#123;</span><br><span class="line">        resolve(&apos;android&apos;)</span><br><span class="line">        return void 0;</span><br><span class="line">      &#125;</span><br><span class="line">      // 判断iOS</span><br><span class="line">      if(!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)) &#123;</span><br><span class="line">        resolve(&apos;ios&apos;);</span><br><span class="line">        return void 0;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;catch(err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="判断宿主环境是否是微信小程序"><a href="#判断宿主环境是否是微信小程序" class="headerlink" title="判断宿主环境是否是微信小程序"></a>判断宿主环境是否是微信小程序</h2><p><a href="/2021/06/08/h5移动端判断宿主平台/">详细内容可异步这里</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const isWeiApp = ()=&gt; &#123;</span><br><span class="line">  return new Promise(function(resolve, reject) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">      var ua = navigator.userAgent.toLowerCase();</span><br><span class="line">      if(ua.match(/MicroMessenger/i)==&quot;micromessenger&quot;) &#123;</span><br><span class="line">          wx.miniProgram.getEnv((res)=&gt;&#123;</span><br><span class="line">            if (res.miniprogram) &#123;</span><br><span class="line">              resolve(true);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">              resolve(false);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">        resolve(false);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;catch(err) &#123;</span><br><span class="line">      reject(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="复制内容到剪贴板"><a href="#复制内容到剪贴板" class="headerlink" title="复制内容到剪贴板"></a>复制内容到剪贴板</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function copyToBoard(value) &#123;</span><br><span class="line">  const element = document.createElement(&apos;textarea&apos;)</span><br><span class="line">  document.body.appendChild(element)</span><br><span class="line">  element.value = value</span><br><span class="line">  element.select()</span><br><span class="line">  if (document.execCommand(&apos;copy&apos;)) &#123;</span><br><span class="line">      document.execCommand(&apos;copy&apos;)</span><br><span class="line">      document.body.removeChild(element)</span><br><span class="line">      return true</span><br><span class="line">  &#125;</span><br><span class="line">  document.body.removeChild(element)</span><br><span class="line">  return false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="对象转化为FormData对象"><a href="#对象转化为FormData对象" class="headerlink" title="对象转化为FormData对象"></a>对象转化为FormData对象</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function getFormData(object) &#123;</span><br><span class="line">  const formData = new FormData()</span><br><span class="line">  Object.keys(object).forEach(key =&gt; &#123;</span><br><span class="line">      const value = object[key]</span><br><span class="line">      if (Array.isArray(value)) &#123;</span><br><span class="line">          value.forEach((subValue, i) =&gt;</span><br><span class="line">              formData.append(key + `[$&#123;i&#125;]`, subValue)</span><br><span class="line">          )</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">          formData.append(key, object[key])</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  return formData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="睡眠sleep"><a href="#睡眠sleep" class="headerlink" title="睡眠sleep"></a>睡眠sleep</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sleep(time) &#123;</span><br><span class="line">  return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">    setTimeout(()=&gt; &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// demo 发送验证码</span><br><span class="line">async onSendCode() &#123;</span><br><span class="line">  let num = 60;</span><br><span class="line">  while(num&gt;0) &#123;</span><br><span class="line">    num--;</span><br><span class="line">    this.form.codeBtnStr = num;</span><br><span class="line">    await sleep(1000);</span><br><span class="line">  &#125;</span><br><span class="line">  this.form.codeBtnStr = &apos;发送验证码&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// 方法1：</span><br><span class="line">// fileBlob必须是Blob格式文件，axios请求中设置responseType: &apos;blob&apos;</span><br><span class="line">// fileName文件名</span><br><span class="line">downloadFile(fileBlob, fileName) &#123;</span><br><span class="line">  let reader = new FileReader();</span><br><span class="line">    reader.readAsDataURL(fileBlob);</span><br><span class="line">    reader.onload = evt=&gt; &#123;</span><br><span class="line">      let body = document.body;</span><br><span class="line">      let a = document.createElement(&apos;a&apos;);</span><br><span class="line">      a.download = fileName;</span><br><span class="line">      a.href = evt.target.result;</span><br><span class="line">      body.append(a);</span><br><span class="line">      a.click();</span><br><span class="line">      body.removeChild(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 方法2：</span><br><span class="line">downloadFile(fileBlob, fileName) &#123;</span><br><span class="line">  let url = window.URL.createObjectURL(fileBlob);</span><br><span class="line">  let body = document.body;</span><br><span class="line">  let a = document.createElement(&apos;a&apos;);</span><br><span class="line">  a.download = fileName;</span><br><span class="line">  a.href = url;</span><br><span class="line">  body.append(a);</span><br><span class="line">  a.click();</span><br><span class="line">  body.removeChild(a);</span><br><span class="line">  window.URL.revokeObjectURL(url); //释放掉blob对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h2><p>当接口请求失败后，每间隔几秒，再重发几次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/* </span><br><span class="line">* @param &#123;function&#125; fn - 方法名</span><br><span class="line">* @param &#123;number&#125; delay - 延迟的时间</span><br><span class="line">* @param &#123;number&#125; times - 重发的次数</span><br><span class="line">*/</span><br><span class="line">function retry(fn, delay, times) &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    function func() &#123;</span><br><span class="line">      Promise.resolve(fn()).then(res =&gt; &#123;</span><br><span class="line">          resolve(res);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(err =&gt; &#123;</span><br><span class="line">          // 接口失败后，判断剩余次数不为0时，继续重发</span><br><span class="line">          if (times !== 0) &#123;</span><br><span class="line">            setTimeout(func, delay);</span><br><span class="line">            times--;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            reject(err);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    func();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="控制请求最大并发数"><a href="#控制请求最大并发数" class="headerlink" title="控制请求最大并发数"></a>控制请求最大并发数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 控制并发数</span><br><span class="line"> * @param &#123;array&#125; list - 请求列表</span><br><span class="line"> * @param &#123;number&#125; num - 最大并发数</span><br><span class="line"> */</span><br><span class="line">function control(list, num) &#123;</span><br><span class="line">  function fn() &#123;</span><br><span class="line">    if (!list.length) return;</span><br><span class="line">    // 从任务数 和 num 中 取最小值，兼容并发数num &gt; list.length的情况</span><br><span class="line">    let max = Math.min(list.length, num);</span><br><span class="line">    for (let i = 0; i &lt; max; i++) &#123;</span><br><span class="line">      let f = list.shift();</span><br><span class="line">      num--;</span><br><span class="line">      // 请求完成后，num++</span><br><span class="line">      f.finally(() =&gt; &#123;</span><br><span class="line">        num++;</span><br><span class="line">        fn();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fn();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>express中间件</title>
      <link href="/2021/06/25/express%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
      <url>/2021/06/25/express%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>express的中间件简单实现<br><a id="more"></a><br>在使用express时，中间件是必须使用的，有时候需要自己写一个中间件，express是如何实现中间件的呢，下面一个简单的实现demo。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&apos;http&apos;);</span><br><span class="line"></span><br><span class="line">function express() &#123;</span><br><span class="line"></span><br><span class="line">    var funcs = []; // 待执行的中间件数组</span><br><span class="line"></span><br><span class="line">    var app = function (req, res) &#123;</span><br><span class="line">        var i = 0;</span><br><span class="line"></span><br><span class="line">        function next() &#123;</span><br><span class="line">            var task = funcs[i++];  // 取出中间件数组里的下一个函数</span><br><span class="line">            if (!task) &#123;    // 如果函数不存在,return</span><br><span class="line">                return void 0;</span><br><span class="line">            &#125;</span><br><span class="line">            task(req, res, next);   // 否则,执行下一个函数</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 使用中间件函数</span><br><span class="line">    app.use = function (task) &#123;</span><br><span class="line">        funcs.push(task);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return app;    // 返回实例</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 下面是测试case</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line">http.createServer(app).listen(&apos;3000&apos;, function () &#123;</span><br><span class="line">    console.log(&apos;listening 3000....&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function middlewareA(req, res, next) &#123;</span><br><span class="line">    console.log(&apos;middlewareA before next()&apos;);</span><br><span class="line">    next();</span><br><span class="line">    console.log(&apos;middlewareA after next()&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function middlewareB(req, res, next) &#123;</span><br><span class="line">    console.log(&apos;middlewareB before next()&apos;);</span><br><span class="line">    next();</span><br><span class="line">    console.log(&apos;middlewareB after next()&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function middlewareC(req, res, next) &#123;</span><br><span class="line">    console.log(&apos;middlewareC before next()&apos;);</span><br><span class="line">    next();</span><br><span class="line">    console.log(&apos;middlewareC after next()&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(middlewareA);</span><br><span class="line">app.use(middlewareB);</span><br><span class="line">app.use(middlewareC);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端音视频，多媒体领域主流框架</title>
      <link href="/2021/06/22/%E5%89%8D%E7%AB%AF%E9%9F%B3%E8%A7%86%E9%A2%91%EF%BC%8C%E5%A4%9A%E5%AA%92%E4%BD%93%E9%A2%86%E5%9F%9F%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/"/>
      <url>/2021/06/22/%E5%89%8D%E7%AB%AF%E9%9F%B3%E8%A7%86%E9%A2%91%EF%BC%8C%E5%A4%9A%E5%AA%92%E4%BD%93%E9%A2%86%E5%9F%9F%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<p>前端音视频，多媒体领域主流框架介绍<br><a id="more"></a></p><h2 id="flv-js"><a href="#flv-js" class="headerlink" title="flv.js"></a>flv.js</h2><ul><li>基于http的flv的流媒体协议，通过纯js实现了flv的封装，使flv格式能够在web浏览器上播放</li></ul><h2 id="hls-js"><a href="#hls-js" class="headerlink" title="hls.js"></a>hls.js</h2><ul><li>hls是http live stream协议开发，利用media source extension 用于实现hls，在web浏览器上播放的一款js播放库</li><li>苹果提出，被移动端设备广泛支持，广泛应用在直播场景中</li></ul><h2 id="video-js"><a href="#video-js" class="headerlink" title="video.js"></a>video.js</h2><ul><li>基于html5播放器，同时支持h5和flash播放，拥有超过100个插件可以使用</li><li>可以满足hls代时格式的播放，</li><li>支持定制主题，字符扩展等不同需求，在世界范围拥有大量应用场景</li></ul><h2 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h2><ul><li>是一套领先的多媒体框架，是一套开源且跨平台的多媒体解决方案</li><li>提供了音视频的编码解码转码封装解封装流媒体滤镜等功能</li><li>可以基于ffmpeg和web—实现浏览器的js播放器，并且扩展浏览器端的其他音视频能力</li><li>在node模块也是非常实用的模块，这模块简化了ffmpeg复杂的命令操作，配合文件的上传和视频中的处理变得非常方便</li></ul><h2 id="obs"><a href="#obs" class="headerlink" title="obs"></a>obs</h2><ul><li>用于录制和网络直播的自由开源软件包</li><li>使用C和C++编辑,t提供实时语言和设备捕获，场景组成，编码录制和广播</li><li>数据传输主要通过实时的消息协议rtmp完成可以发送到任何支持rtmp的目的地,包括网易，youtube，facebook等主流媒体网站</li></ul><h2 id="mlt"><a href="#mlt" class="headerlink" title="mlt"></a>mlt</h2><ul><li>用于多种app非线性的视频编辑以及且不限于桌面领域，他同样适用于Andriod，iOS的平台​</li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5移动端判断宿主平台</title>
      <link href="/2021/06/08/h5%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%88%A4%E6%96%AD%E5%AE%BF%E4%B8%BB%E5%B9%B3%E5%8F%B0/"/>
      <url>/2021/06/08/h5%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%88%A4%E6%96%AD%E5%AE%BF%E4%B8%BB%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<p>h5移动端判断宿主平台<br><a id="more"></a><br>笔者在h5页面开发中，需要适配android,ios的webview，微信内置浏览器和微信小程序，在不同的平台下做不同逻辑操作。<br>笔者总结了一个简单的判别这四种平台的方法，见下方代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;h5移动端判断宿主平台&lt;/title&gt;</span><br><span class="line">    &lt;!--判断是否是微信小程序的话，需要引入--&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;https://res.wx.qq.com/open/js/jweixin-1.3.2.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;h5移动端判断宿主平台&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  /**</span><br><span class="line">   * @desc 获取当前移动端的宿主平台</span><br><span class="line">   * @return &#123; String &#125; weiapp weixin android ios pc</span><br><span class="line">   */</span><br><span class="line">  function getOs() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      var ua = navigator.userAgent.toLowerCase();</span><br><span class="line">      if(ua.match(/MicroMessenger/i)==&quot;micromessenger&quot;) &#123;</span><br><span class="line">          wx.miniProgram.getEnv((res)=&gt;&#123;</span><br><span class="line">            if(res.miniprogram) &#123;</span><br><span class="line">              resolve(&apos;weiapp&apos;);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">              resolve(&apos;weixin&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;else if(ua.indexOf(&quot;android&quot;) &gt; -1 || ua.indexOf(&quot;linux&quot;) &gt; -1) &#123;</span><br><span class="line">        resolve(&apos;android&apos;);</span><br><span class="line">      &#125;else if(!!ua.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/i)) &#123;</span><br><span class="line">        resolve(&apos;ios&apos;);</span><br><span class="line">      &#125;else &#123;</span><br><span class="line">        resolve(&apos;pc&apos;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  // 使用</span><br><span class="line">  async function getCurrentPlatform() &#123;</span><br><span class="line">    var os = await getOs();</span><br><span class="line">    alert(os);</span><br><span class="line">  &#125;</span><br><span class="line">  getCurrentPlatform();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>html页面可见性监测</title>
      <link href="/2021/05/28/html%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%81%E6%80%A7%E7%9B%91%E6%B5%8B/"/>
      <url>/2021/05/28/html%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%81%E6%80%A7%E7%9B%91%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<p>html页面可见性监测处理<br><a id="more"></a><br>项目开发中会有这样的需求，当前页面最小化，或被其它应用挡住，或者tab切换时，为了更好的用户体验（特别是游戏场景），页面的性能考虑，需要做相关处理。</p><h2 id="Page-Visibility-API"><a href="#Page-Visibility-API" class="headerlink" title="Page Visibility API"></a>Page Visibility API</h2><p><a href="http://www.ruanyifeng.com/blog/2018/10/page_visibility_api.html" target="_blank" rel="noopener">阮一峰教程</a>，这篇文章写的很详细，可以参考。<br><a href="https://github.com/jinux7/study-collections/blob/master/%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%81%E6%80%A7%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%91%E5%90%AC/demo2.html" target="_blank" rel="noopener">demo</a></p><h2 id="focus-blur"><a href="#focus-blur" class="headerlink" title="focus blur"></a>focus blur</h2><p>利用focus和blur来模拟页面的隐藏和显示，虽说不够严谨，但是有些简单的需求还是可以应付的。<br><a href="https://github.com/jinux7/study-collections/blob/master/%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%81%E6%80%A7%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%91%E5%90%AC/demo1.html" target="_blank" rel="noopener">demo</a></p><h2 id="项目应用"><a href="#项目应用" class="headerlink" title="项目应用"></a>项目应用</h2><p>一个app的h5项目，需求：进入首页浏览内容，当点击下一步按钮时，如果发现当前状态是未登录，则跳转至app的登陆页面，登陆后再切回到首页。这里使用了页面可见性，当从app的登陆页回到h5的首页时，利用可见性事件完成一系列动作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(&apos;visibilitychange&apos;, (evt) =&gt; &#123;</span><br><span class="line">  if (document.visibilityState === &apos;visible&apos;) &#123;</span><br><span class="line">    if(this.isFromLogin) &#123; // 从h5页面跳转到app的登陆页面之前，把它设置成true，回到这个页面时知道要去操作哪个功能</span><br><span class="line">      location.reload();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, false)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>无所不能的Array reduce</title>
      <link href="/2021/05/25/%E6%97%A0%E6%89%80%E4%B8%8D%E8%83%BD%E7%9A%84Array-reduce/"/>
      <url>/2021/05/25/%E6%97%A0%E6%89%80%E4%B8%8D%E8%83%BD%E7%9A%84Array-reduce/</url>
      
        <content type="html"><![CDATA[<p>Array的reduce方法分析<br><a id="more"></a><br>Array有很多实例方法，reduce,map,filter,find,some,every…<br>这里，基础是reduce，可以利用它去实现其它所有方法。<br>我们先来看看reduce如何使用：</p><h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><h3 id="reduce的使用"><a href="#reduce的使用" class="headerlink" title="reduce的使用"></a>reduce的使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// api</span><br><span class="line">Array.prototype.reduce = function(callback, initialValue) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// Accumulator (acc) (累计器) 如果传入了initialValue,Accumulator的初始值就是initialValue,没传入就是数组的第一个值</span><br><span class="line">// Current Value (cur) (当前值)</span><br><span class="line">// Current Index (idx) (当前索引)如果传入了initialValue,索引从0开始,没传入从1开始</span><br><span class="line">// Source Array (src) (源数组)</span><br><span class="line">const callback = function(acc, cur, idx, src) &#123;</span><br><span class="line">  return someVal;</span><br><span class="line">&#125;</span><br><span class="line">// demo</span><br><span class="line">let arr = [1,2,3,4,5,6,7,8,9,10];</span><br><span class="line">let sum = arr.reduce(function(acc, cur, idx, src) &#123;</span><br><span class="line">  return acc + cur;</span><br><span class="line">&#125;, 0);</span><br><span class="line">console.log(sum); // 55</span><br></pre></td></tr></table></figure><h3 id="reduce方法的实现"><a href="#reduce方法的实现" class="headerlink" title="reduce方法的实现"></a>reduce方法的实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.myReduce = function (callback, initVal) &#123;</span><br><span class="line">  for (let i = 0; i &lt; this.length; i++) &#123;       </span><br><span class="line">    initVal = callback(initVal, this[i], i, this)     </span><br><span class="line">  &#125;     </span><br><span class="line">  return initVal </span><br><span class="line">&#125;</span><br><span class="line">// initVal不传的时候，改进版</span><br><span class="line">Array.prototype.myReduce = function(callback, initVal) &#123;</span><br><span class="line">  let arr = this;</span><br><span class="line">  let i = initVal?0:1;</span><br><span class="line">  initVal = initVal || arr[0];</span><br><span class="line">  for(;i&lt;arr.length; i++) &#123;</span><br><span class="line">    initVal = callback(initVal, arr[i], i, arr);</span><br><span class="line">  &#125;</span><br><span class="line">  return initVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="利用reduce实现其它方法"><a href="#利用reduce实现其它方法" class="headerlink" title="利用reduce实现其它方法"></a>利用reduce实现其它方法</h2><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.myMap = function(callback) &#123;</span><br><span class="line">  let tempArr = [];</span><br><span class="line">  this.reduce(function(pre, cur, index) &#123;</span><br><span class="line">    tempArr.push(callback(cur, index));</span><br><span class="line">  &#125;, this[0]);</span><br><span class="line">  return tempArr;</span><br><span class="line">&#125;</span><br><span class="line">let arr = [1,2,3,4,5];</span><br><span class="line">let newArr = arr.myMap((item, index)=&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    val: item,</span><br><span class="line">    num: index + 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(newArr);</span><br></pre></td></tr></table></figure><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.myFilter = function(callback) &#123;</span><br><span class="line">  let tempArr = [];</span><br><span class="line">  this.reduce(function(pre, cur, index) &#123;</span><br><span class="line">    if(callback(cur, index)) tempArr.push(cur);</span><br><span class="line">  &#125;, this[0]);</span><br><span class="line">  return tempArr;</span><br><span class="line">&#125;</span><br><span class="line">let arr = [1,2,3,4,5,6,7,8,9,10,11,12];</span><br><span class="line">let newArr = arr.filter((item, index)=&gt; &#123;</span><br><span class="line">  return item%2===0&amp;&amp;item%3===0;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(newArr);</span><br></pre></td></tr></table></figure><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.myFind = function(callback) &#123;</span><br><span class="line">  let target = null;</span><br><span class="line">  this.reduce(function(pre, cur, index) &#123;</span><br><span class="line">    if(callback(cur, index)&amp;&amp;!target) target = cur;</span><br><span class="line">  &#125;, this[0]);</span><br><span class="line">  return target;</span><br><span class="line">&#125;</span><br><span class="line">let arr = [1,2,3,4,5,6,7,8,9,10,11,12];</span><br><span class="line">let newArr = arr.myFind((item, index)=&gt; &#123;</span><br><span class="line">  return item &gt; 3;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(newArr);</span><br></pre></td></tr></table></figure><h3 id="some"><a href="#some" class="headerlink" title="some"></a>some</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.mySome = function(callback) &#123;</span><br><span class="line">  let bResult = false;</span><br><span class="line">  this.reduce(function(pre, cur, index) &#123;</span><br><span class="line">    callback(cur, index)&amp;&amp;(bResult=true);</span><br><span class="line">  &#125;, this[0]);</span><br><span class="line">  return bResult;</span><br><span class="line">&#125;</span><br><span class="line">let arr = [1,2,3,4,5,6,7,8,9,10,11,12];</span><br><span class="line">let result = arr.mySome((item, index)=&gt; &#123;</span><br><span class="line">  return item &gt; 11;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(result);</span><br></pre></td></tr></table></figure><h3 id="every"><a href="#every" class="headerlink" title="every"></a>every</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.myEvery = function(callback) &#123;</span><br><span class="line">  let bResult = false;</span><br><span class="line">  this.reduce(function(pre, cur, index) &#123;</span><br><span class="line">    !callback(cur, index)&amp;&amp;(bResult=true);</span><br><span class="line">  &#125;, this[0]);</span><br><span class="line">  return !bResult;</span><br><span class="line">&#125;</span><br><span class="line">let arr = [1,2,3,4,5,6,7,8,9,10,11,12];</span><br><span class="line">let result = arr.myEvery((item, index)=&gt; &#123;</span><br><span class="line">  return item &gt; 1;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(result);</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实不用reduce也可以实现，但是利用reduce来实现，侧面反映了reduce功能的强大，在实际项目中灵活运用reduce，会事半功倍哦。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js-animate</title>
      <link href="/2021/05/08/js-animate/"/>
      <url>/2021/05/08/js-animate/</url>
      
        <content type="html"><![CDATA[<p>js控制css animate动画<br><a id="more"></a><br>Animate.css这个动画库很好，使用也很方便，<a href="https://animate.style/" target="_blank" rel="noopener">点击进入</a>。<br>今天笔者用另外一种方式来使用，写一段js代码来控制一个元素来执行多个动画效果。<br><a href="https://github.com/jinux7/study-collections/tree/master/animation%E5%8A%A8%E7%94%BB" target="_blank" rel="noopener">demo</a></p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>判断上传图片格式类型</title>
      <link href="/2021/04/08/%E5%88%A4%E6%96%AD%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%B1%BB%E5%9E%8B/"/>
      <url>/2021/04/08/%E5%88%A4%E6%96%AD%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>判断图片的具体格式类型<br><a id="more"></a><br>日常开发中，对上传图片或文件的格式判断，来处理是否符合要求。<br>本例是利用FileReader的readAsArrayBuffer方法，来处理文件格式的。<br>无论是本地上传的文件或者是网络请求获取的文件，只要类型是Blob or File格式，都可以进行判断。<br>代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function getFileMimeType(file) &#123;</span><br><span class="line">  const map = &#123;</span><br><span class="line">    &apos;FFD8FFE0&apos;: &apos;jpg&apos;,</span><br><span class="line">    &apos;89504E47&apos;: &apos;png&apos;,</span><br><span class="line">    &apos;47494638&apos;: &apos;gif&apos;,</span><br><span class="line">    &quot;52494646&quot;: &apos;webp&apos;</span><br><span class="line">  &#125;</span><br><span class="line">  const reader = new FileReader();</span><br><span class="line">  reader.readAsArrayBuffer(file);</span><br><span class="line">  return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">    reader.onload = (event)=&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        let array = new Uint8Array(event.target.result);</span><br><span class="line">        array = array.slice(0, 4);</span><br><span class="line">        let arr = [...array]</span><br><span class="line">        let key = arr.map(item=&gt; item.toString(16)</span><br><span class="line">            .toUpperCase()</span><br><span class="line">            .padStart(2, &apos;0&apos;))</span><br><span class="line">            .join(&apos;&apos;)</span><br><span class="line">        resolve(map[key])</span><br><span class="line">      &#125; catch(e) &#123;</span><br><span class="line">          reject(e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片处理 </tag>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器F12调试工具监测</title>
      <link href="/2021/04/01/%E6%B5%8F%E8%A7%88%E5%99%A8F12%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%9B%91%E6%B5%8B/"/>
      <url>/2021/04/01/%E6%B5%8F%E8%A7%88%E5%99%A8F12%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%9B%91%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<p>浏览器F12调试工具弹出时的监测<br><a id="more"></a><br>最近笔者在浏览别人的网站时，发现一个酷炫的效果，于是职业习惯的驱使，F12,元素检查，不过，这时候页面弹出debug，什么情况？原来，作者不想让别人剽窃他的代码。<br>这个功能是怎么做到的呢？<br>笔者上网查了下，都是一些大神搞得hack方式，具体代码啥意思，大家也不清楚，贴一个比较简单而且自测兼容性比较好的代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;F12监测&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  setInterval(function() &#123;</span><br><span class="line">    check()</span><br><span class="line">  &#125;, 2000);</span><br><span class="line">  var check = function() &#123;</span><br><span class="line">    function doCheck(a) &#123;</span><br><span class="line">      if ((&quot;&quot; + a/a)[&quot;length&quot;] !== 1 || a % 20 === 0) &#123;</span><br><span class="line">        (function() &#123;&#125;</span><br><span class="line">        [&quot;constructor&quot;](&quot;debugger&quot;)())</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        (function() &#123;&#125;</span><br><span class="line">        [&quot;constructor&quot;](&quot;debugger&quot;)())</span><br><span class="line">      &#125;</span><br><span class="line">      doCheck(++a)</span><br><span class="line">    &#125; </span><br><span class="line">    try &#123;</span><br><span class="line">      doCheck(0)</span><br><span class="line">    &#125; catch (err) &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">check();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>再贴两个专门监测的插件库：</p><ul><li><a href="https://github.com/sindresorhus/devtools-detect" target="_blank" rel="noopener">devtools-detect1</a></li><li><a href="https://github.com/AepKill/devtools-detector" target="_blank" rel="noopener">devtools-detect2</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue ssr 初探</title>
      <link href="/2021/03/31/vue-ssr-%E5%88%9D%E6%8E%A2/"/>
      <url>/2021/03/31/vue-ssr-%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<p>初探vue服务器端渲染<br><a id="more"></a><br>目前，使用vue的单页面应用，在开发中使用频繁，但是，vue ssr后端渲染一直没有应用过，好处不用说，解决了vue的spa应用很多不利之处。今天，笔者不想写太多，只是把这两天的学习感悟总结下。<br>【<a href="https://ssr.vuejs.org/zh/" target="_blank" rel="noopener">Vue SSR 指南</a>】,这个指南是vue ssr的官网，内容很全，但是只有部分代码示例，不是一个完整项目的代码，所以笔者在网上找了两个简单，容易入门的代码示例。【<a href="https://github.com/jinux7/study-collections/tree/master/vue-ssr/" target="_blank" rel="noopener">代码示例</a>】<br>上面的vue ssr官网和代码示例，是基于vue-server-renderer这个插件完成的，需要从零开始搭建，还是相当麻烦的，这种方式笔者认为适合学习vue ssr的原理，或者是简单的小型项目中，如果是大型项目，可以使用现有的vue ssr框架Nuxt,因为后端渲染相对spa来说还是相对复杂的，多了一个服务器的技术场景，而且好多业务也是两者都有交集，各种坑会很多。所以建议大型项目使用成熟的Nuxt来做。【<a href="https://www.nuxtjs.cn/" target="_blank" rel="noopener">Nuxt官网</a>】<br>最后，总结下笔者理解的服务端渲染:</p><blockquote><p>首先在服务器端要准备好客户端渲染代码（spa）和服务器端代码（ssr），浏览器发起页面的请求（比如首页，也可以是其它页），服务端直接返回带有内容的页面，这样在浏览器可以马上看到渲染后的内容，而且体积还小。在页面的尾部，请求客户端的js等文件，当客户端的js文件加载完成后，会偷偷的执行，等用户再想浏览其它页面的时候，客户端的spa代码已经接管完成，不会再向服务器端发起请求，这时就是一个单纯的spa应用了。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>理解BFC,IFC,GFC和FFC</title>
      <link href="/2021/03/29/%E7%90%86%E8%A7%A3BFC-IFC-GFC%E5%92%8CFFC/"/>
      <url>/2021/03/29/%E7%90%86%E8%A7%A3BFC-IFC-GFC%E5%92%8CFFC/</url>
      
        <content type="html"><![CDATA[<p>BFC,IFC,IFC,FFF是什么<br><a id="more"></a></p><h1 id="理解BFC-IFC-GFC和FFC"><a href="#理解BFC-IFC-GFC和FFC" class="headerlink" title="理解BFC,IFC,GFC和FFC"></a>理解BFC,IFC,GFC和FFC</h1><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>BFC,IFC,GFC,FFC是什么，主要解决的什么问题，哪些元素会生成BFC？本文主要针对这几个问题来了解。<br>在解释之前，需要先介绍 Box、Formatting Context的概念<br>Box: CSS布局的基本单位</p><p>Box 是 CSS 布局的对象和基本单位， 直观点来说，就是一个页面是由很多个 Box 组成的。元素的类型和 display 属性，决定了这个 Box 的类型。 不同类型的 Box， 会参与不同的 Formatting Context（一个决定如何渲染文档的容器），因此Box内的元素会以不同的方式渲染。让我们看看有哪些盒子：</p><blockquote><p>block-level box:<br>display 属性为 block, list-item, table 的元素，会生成 block-level box。并且参与 block fomatting context；</p></blockquote><blockquote><p>inline-level box:<br>display 属性为 inline, inline-block, inline-table 的元素，会生成 inline-level box。并且参与 inline formatting context；</p></blockquote><blockquote><p>run-in box:<br>display 属性为flex,grid,如果 run-in box 包含 block box，那么这个 run-in box 也成为 block box<br>如果紧跟在 run-in box 之后的兄弟节点是 block box，那么这个 run-in box 就会做为此 block box 里的 inline box，run-in box 不能进入已经一个已经以 run-in box 开头的块内，也不能进入本身就是 display:run-in; 的块内,否则，run-in box 成为 block box</p></blockquote><p>Formatting context<br>Formatting context 是 W3C CSS2.1 规范中的一个概念。它是页面中的一块渲染区域，并且有一套渲染规则，它决定了其子元素将如何定位，以及和其他元素的关系和相互作用。最常见的 Formatting context 有 Block fomatting context (简称BFC)和 Inline formatting context (简称IFC)。</p><h2 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h2><p>BFC(Block formatting context)直译为”块级格式化上下文”。它是一个独立的渲染区域，只有Block-level box参与， 它规定了内部的Block-level Box如何布局，并且与这个区域外部毫不相干。<br>BFC布局规则：</p><ul><li>内部的Box会在垂直方向，一个接一个地放置。</li><li>Box垂直方向的距离由margin决定。属于同一个BFC的两个相邻Box的margin会发生重叠</li><li>每个元素的margin box的左边， 与包含块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此。</li><li>BFC的区域不会与float box重叠。</li><li>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。</li><li>计算BFC的高度时，浮动元素也参与计算</li></ul><p>哪些元素会生成BFC</p><ul><li>根元素</li><li>float属性不为none</li><li>position为absolute或fixed</li><li>display为inline-block, table-cell, table-caption, flex, inline-flex</li><li>overflow不为visible</li></ul><p>BFC的作用及原理</p><h3 id="自适应两栏布局"><a href="#自适应两栏布局" class="headerlink" title="自适应两栏布局"></a>自适应两栏布局</h3><p>我们可以通过通过触发main生成BFC， 来实现自适应两栏布局。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.main &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="清除内部浮动"><a href="#清除内部浮动" class="headerlink" title="清除内部浮动"></a>清除内部浮动</h3><p>为达到清除内部浮动，我们可以触发par生成BFC，那么par在计算高度时，par内部的浮动元素child也会参与计算。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.par &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="防止垂直-margin-重叠"><a href="#防止垂直-margin-重叠" class="headerlink" title="防止垂直 margin 重叠"></a>防止垂直 margin 重叠</h3><p>我们可以在p外面包裹一层容器，并触发该容器生成一个BFC。那么两个P便不属于同一个BFC，就不会发生margin重叠了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    .wrap &#123;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    p &#123;</span><br><span class="line">        color: #f55;</span><br><span class="line">        background: #fcc;</span><br><span class="line">        width: 200px;</span><br><span class="line">        line-height: 100px;</span><br><span class="line">        text-align:center;</span><br><span class="line">        margin: 100px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;Haha&lt;/p&gt;</span><br><span class="line">    &lt;div class=&quot;wrap&quot;&gt;</span><br><span class="line">        &lt;p&gt;Hehe&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure></p><p>因为BFC内部的元素和外部的元素绝对不会互相影响，因此， 当BFC外部存在浮动时，它不应该影响BFC内部Box的布局，BFC会通过变窄，而不与浮动有重叠。同样的，当BFC内部有浮动时，为了不影响外部元素的布局，BFC计算高度时会包括浮动的高度。避免margin重叠也是这样的一个道理。</p><h2 id="IFC"><a href="#IFC" class="headerlink" title="IFC"></a>IFC</h2><p>IFC(Inline-Formatting-Contexts)即内联格式化上下文布局。一般都是行内元素比如：input a img span 以及display 属性值为inline-block的元素。<br>行内元素有哪些特点呢？如下列举：</p><ul><li>水平方向根据direction依次布局。</li><li>不会在元素前后换行。</li><li>受white-space属性的影响。</li><li>margin/padding 在竖直方向无效，水平方向有效的。</li><li>white/height 对非替换行内元素无效，宽度由元素内容决定。</li><li>非替换行内元素的行框高由line-height决定而替换行内元素的行框高则是由height，padding，border，margin决定</li><li>浮动或者绝对定位会转化为block</li><li>vertical-align属性生效</li></ul><p>IFC的布局规则如下：</p><ul><li>框会从包含块的顶部开始，然后一个接一个的排列。</li><li>在放置这些框的时候，他们在水平方向上的外边距，边框和内边距所占的空间都会被考虑在内（这样就得到了一个一个的框）。然而在垂直方向上，这些框可能会以不同的方式来对齐，比如他们可以顶部对齐，或者底部对齐也有可能按照文本的基线对齐。而把这一行上的框都包含进去的一个大框我们称之为改行的行框。水平的padding,border,margin有效，竖直方向则无效。不能指定框高。</li><li>行宽的宽度由包含块和存在的浮动决定的。行框的高度至少会高到足以包含他内部的所有框。</li><li>当一行上的行级总宽度（某一个小框的宽度或者若干个小框的总宽度）小于行宽的时候，他们在行宽内的水平方向上的排布由text-align决定。</li><li>当一个行内框的宽度超过了该行的行宽的时候，就会被分成几个框。(ex.文字换行的时候 字都不在同一行了，那换行的时候自然就会多一份框，自然也就多了一份行宽)但是如果设置这个框就不能被分割的话（比如，文字强制不给换行white-space设置为nowrap）那么这时候该行内框就会溢出该行的行宽。</li><li>一般情况下行宽的左边紧贴在他的包含块的左边，同样他的右边也是紧贴在其包含块的右边。但是也不一定，比如出现浮动的话，浮动元素可能会插在包含块和行框之间。所以一般在同一个IFC中行框通常有相同的宽度（包含快的宽度）但是某一行的行宽的宽度也可能受浮动元素影响，减少了水平可用的宽度了。在同一个IFC中，行框的高度通常是变化的，不一定的，比如某一行的某个框是个很高的图片，而改行框中其他框只是文字。</li><li>计算行框内各个框的高度，对于非替换元素就是起line-height,而对于替换元素就是边界框的高度了。 行框的高是最顶端框的顶边到最底端框的底边的距离。</li></ul><blockquote><p>补充：包含块的概念：<br>简单说就是定位参考框或者定位坐标参考系，元素一旦定义了定位显示（相对、绝对、固定）都具有包含块性质，它所包含的定位元素都将以该包含块为坐标系进行定位和调整。<br>是视觉格式化模型的一个重要概念，它与框模型类似，也可以理解为一个矩形，而这个矩形的作用是为它里面包含的元素提供一个参考，元素的尺寸和位置的计算往往是由该元素所在的包含块决定的。</p></blockquote><h2 id="FFC"><a href="#FFC" class="headerlink" title="FFC"></a>FFC</h2><p>弹性布局(FFC-Flex Formattig-Contexts 自适应格式化上下文)申明 display:flex; 或者display:inline-flex(行内弹性布局)</p><p>这个布局是我最爱的布局之一了，因为他可以非常轻松的实现元素的上下居中，左右居中；只需要justify-content:center（左右居中）align-items:center;(上下居中)就ok了.申明flex之后这个元素就会成为一个flex容器，而他的子元素就会自动成为这个容器的成员，简称为项目。而其中又会有两个轴线（类似于笛卡尔坐标系的两个轴吧）横的称之为主轴，竖着的称之为交叉轴，容器是一个相对独立的渲染区域，他对自己内部的项目有着自己的一套渲染规则，不受容器外部的影响，同样的，容器内部的规则也不会影响外面。</p><h3 id="容器属性："><a href="#容器属性：" class="headerlink" title="容器属性："></a>容器属性：</h3><p>六个属性分别为：flex-direction,flex-wrap,flex-flow,justify-content,align-items,align-content</p><h3 id="项目属性："><a href="#项目属性：" class="headerlink" title="项目属性："></a>项目属性：</h3><p>六个属性分别为：order，flex-grow，flex-shrink，flex-basis，flex，align-self</p><h2 id="GFC"><a href="#GFC" class="headerlink" title="GFC"></a>GFC</h2><p>GFC（Grid Formatting Contexts）栅格格式化上下文</p><p>当为一个元素设置display值为grid的时候，此元素将会获得一个独立的渲染区域，我们可以通过在网格容器（grid container）上定义网格定义行（grid definition rows）和网格定义列（grid definition columns）属性各在网格项目（grid item）上定义网格行（grid row）和网格列（grid columns）为每一个网格项目（grid item）定义位置和空间。</p><p>那么GFC有什么用呢，和table又有什么区别呢？<br>首先同样是一个二维的表格，但GridLayout会有更加丰富的属性来控制行列，控制对齐以及更为精细的渲染语义和控制。</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 样式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>canvas事件处理</title>
      <link href="/2021/02/20/canvas%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/"/>
      <url>/2021/02/20/canvas%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>canvas中的图形添加事件<br><a id="more"></a></p><h1 id="canvas事件处理"><a href="#canvas事件处理" class="headerlink" title="canvas事件处理"></a>canvas事件处理</h1><p>canvas是一块画布，假设这块画布中有3个方块，给这3个方块添加事件该如何操作呢？<br>因为canvas是一个元素节点，所以添加事件只能添加到这个canvas上，canvas里边的图形要响应事件稍微复杂些。<br>这里用到了canvas提供的api <code>isPointInPath</code>,这个api可能会有兼容性问题，但本次还是基于这个api实现。<br>笔者这次只实现了mousedown事件的基础功能，而且图形是固定的，先看看实现的这个事件监听类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * @desc canvas事件处理类</span><br><span class="line">   * @params canvas 要监听的图形所在canvas</span><br><span class="line">   * @method pushPath 监听图形</span><br><span class="line">   * @method iteratorRegsions 便利所要监听的所有图形</span><br><span class="line">   */</span><br><span class="line">  function RegsionEvt(canvas) &#123;</span><br><span class="line">    this.canvas = document.createElement(&apos;canvas&apos;);</span><br><span class="line">    this.canvas.width = canvas.width;</span><br><span class="line">    this.canvas.height = canvas.height;</span><br><span class="line">    this.ctx = this.canvas.getContext(&quot;2d&quot;);</span><br><span class="line">    this.arr = [];</span><br><span class="line">    /**</span><br><span class="line">     * option.shapType 类型</span><br><span class="line">     * option.x</span><br><span class="line">     * option.y</span><br><span class="line">     * option.width</span><br><span class="line">     * option.height</span><br><span class="line">     * option.evtName</span><br><span class="line">     * option.CallBack</span><br><span class="line">     */</span><br><span class="line">    this.pushPath = function(option) &#123;</span><br><span class="line">      this.arr.push(option);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * evtName 事件名</span><br><span class="line">     * evt 事件对象</span><br><span class="line">     */ </span><br><span class="line">    this.iteratorRegsions = function(evtName, evt) &#123;</span><br><span class="line">      this.arr.forEach(function(item) &#123;</span><br><span class="line">        this.ctx.beginPath();</span><br><span class="line">        if(item.shapType===&apos;rect&apos; &amp;&amp; item.evtName===evtName) &#123;</span><br><span class="line">          this.ctx.rect(item.x, item.y, item.width, item.height);</span><br><span class="line">          if(this.ctx.isPointInPath(evt.layerX, evt.layerY)) &#123;</span><br><span class="line">            item.CallBack(evt);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.ctx.closePath();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>使用的时候，new一个实例，构造函数参数是要监听的图形所在的canvas，添加图形事件需要调用pushPath方法，触发事件的时候需要循环遍历添加了事件的图形，方法是iteratorRegsions。<br>最后，附上一个demo：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;canvas-event&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  * &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;canvas id=&quot;canvas&quot; width=&quot;500&quot; height=&quot;300&quot; style=&quot;display: block; border: 1px solid #cccccc; margin: 50px auto;&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var nCanvas = document.getElementById(&apos;canvas&apos;);</span><br><span class="line">  var ctx = nCanvas.getContext(&quot;2d&quot;);</span><br><span class="line">  var regsion = new RegsionEvt(nCanvas);</span><br><span class="line">  </span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.rect(50, 50, 100, 100);</span><br><span class="line">  ctx.fillStyle = &apos;red&apos;;</span><br><span class="line">  ctx.fill();</span><br><span class="line">  regsion.pushPath(&#123;</span><br><span class="line">    shapType: &apos;rect&apos;,</span><br><span class="line">    evtName: &apos;mousedown&apos;,</span><br><span class="line">    x: 50,</span><br><span class="line">    y: 50,</span><br><span class="line">    width: 100,</span><br><span class="line">    height: 100,</span><br><span class="line">    CallBack: function(evt) &#123;</span><br><span class="line">      console.log(&apos;红色box被点击了&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.rect(250, 150, 100, 100);</span><br><span class="line">  ctx.fillStyle = &apos;yellow&apos;;</span><br><span class="line">  ctx.fill();</span><br><span class="line">  regsion.pushPath(&#123;</span><br><span class="line">    shapType: &apos;rect&apos;,</span><br><span class="line">    evtName: &apos;mousedown&apos;,</span><br><span class="line">    x: 250,</span><br><span class="line">    y: 150,</span><br><span class="line">    width: 100,</span><br><span class="line">    height: 100,</span><br><span class="line">    CallBack: function(evt) &#123;</span><br><span class="line">      console.log(&apos;黄色box被点击了&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.rect(350, 50, 50, 50);</span><br><span class="line">  ctx.fillStyle = &apos;green&apos;;</span><br><span class="line">  ctx.fill();</span><br><span class="line">  regsion.pushPath(&#123;</span><br><span class="line">    shapType: &apos;rect&apos;,</span><br><span class="line">    evtName: &apos;mousedown&apos;,</span><br><span class="line">    x: 350,</span><br><span class="line">    y: 50,</span><br><span class="line">    width: 50,</span><br><span class="line">    height: 50,</span><br><span class="line">    CallBack: function(evt) &#123;</span><br><span class="line">      console.log(&apos;绿色box被点击了&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  nCanvas.onmousedown = function(evt) &#123;</span><br><span class="line">    regsion.iteratorRegsions(&apos;mousedown&apos;, evt);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @desc canvas事件处理类</span><br><span class="line">   * @params canvas 要监听的图形所在canvas</span><br><span class="line">   * @method pushPath 监听图形</span><br><span class="line">   * @method iteratorRegsions 便利所要监听的所有图形</span><br><span class="line">   */</span><br><span class="line">  function RegsionEvt(canvas) &#123;</span><br><span class="line">    this.canvas = document.createElement(&apos;canvas&apos;);</span><br><span class="line">    this.canvas.width = canvas.width;</span><br><span class="line">    this.canvas.height = canvas.height;</span><br><span class="line">    this.ctx = this.canvas.getContext(&quot;2d&quot;);</span><br><span class="line">    this.arr = [];</span><br><span class="line">    /**</span><br><span class="line">     * option.shapType 类型</span><br><span class="line">     * option.x</span><br><span class="line">     * option.y</span><br><span class="line">     * option.width</span><br><span class="line">     * option.height</span><br><span class="line">     * option.evtName</span><br><span class="line">     * option.CallBack</span><br><span class="line">     */</span><br><span class="line">    this.pushPath = function(option) &#123;</span><br><span class="line">      this.arr.push(option);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * evtName 事件名</span><br><span class="line">     * evt 事件对象</span><br><span class="line">     */ </span><br><span class="line">    this.iteratorRegsions = function(evtName, evt) &#123;</span><br><span class="line">      this.arr.forEach(function(item) &#123;</span><br><span class="line">        this.ctx.beginPath();</span><br><span class="line">        if(item.shapType===&apos;rect&apos; &amp;&amp; item.evtName===evtName) &#123;</span><br><span class="line">          this.ctx.rect(item.x, item.y, item.width, item.height);</span><br><span class="line">          if(this.ctx.isPointInPath(evt.layerX, evt.layerY)) &#123;</span><br><span class="line">            item.CallBack(evt);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.ctx.closePath();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>碰撞检测</title>
      <link href="/2021/02/19/%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B/"/>
      <url>/2021/02/19/%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<p>图形或dom元素碰撞检测<br><a id="more"></a></p><h1 id="碰撞检测"><a href="#碰撞检测" class="headerlink" title="碰撞检测"></a>碰撞检测</h1><p>碰撞检测在游戏开发中是肯定会用到的，检测两个物体是否碰撞，其实非常简单,用一个方法就可以搞定：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function haveIntersection(r1, r2) &#123;</span><br><span class="line">    return !(</span><br><span class="line">      r2.x &gt; r1.x + r1.width ||</span><br><span class="line">      r2.x + r2.width &lt; r1.x ||</span><br><span class="line">      r2.y &gt; r1.y + r1.height ||</span><br><span class="line">      r2.y + r2.height &lt; r1.y</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>这个方法传入两个对象，返回true就是碰撞了，反之就没碰撞。<br>再来一个demo：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;collision&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .wrap &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 700px;</span><br><span class="line">    height: 300px;</span><br><span class="line">    border: 1px solid #cccccc;</span><br><span class="line">  &#125;</span><br><span class="line">  .box1, .box2 &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">  &#125;</span><br><span class="line">  .box1 &#123;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    background-color: green;</span><br><span class="line">    z-index: 2;</span><br><span class="line">  &#125;</span><br><span class="line">  .box2 &#123;</span><br><span class="line">    top: 100px;</span><br><span class="line">    right: 300px;</span><br><span class="line">    background-color: brown;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;wrap&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;box1&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;box2&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  // 工具函数</span><br><span class="line">  // 获取style</span><br><span class="line">  function getStyle(element, attr) &#123;</span><br><span class="line">    var computed;</span><br><span class="line">    if(element.currentStyle) &#123;</span><br><span class="line">      computed = element.currentStyle;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      computed = window.getComputedStyle(element, false);</span><br><span class="line">    &#125;</span><br><span class="line">    return computed.getPropertyValue( attr ) || computed[ attr ];</span><br><span class="line">  &#125;  </span><br><span class="line">  // 判断两个物体是否碰撞</span><br><span class="line">  function haveIntersection(r1, r2) &#123;</span><br><span class="line">    return !(</span><br><span class="line">      r2.x &gt; r1.x + r1.width ||</span><br><span class="line">      r2.x + r2.width &lt; r1.x ||</span><br><span class="line">      r2.y &gt; r1.y + r1.height ||</span><br><span class="line">      r2.y + r2.height &lt; r1.y</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  // 获取节点对象</span><br><span class="line">  var box1 = document.querySelector(&apos;.box1&apos;);</span><br><span class="line">  var box2 = document.querySelector(&apos;.box2&apos;);</span><br><span class="line">  // box1和box2的信息</span><br><span class="line">  box1Obj = &#123;</span><br><span class="line">    x: parseInt(getStyle(box1, &apos;left&apos;)),</span><br><span class="line">    y: parseInt(getStyle(box1, &apos;top&apos;)),</span><br><span class="line">    width: parseInt(getStyle(box1, &apos;width&apos;)),</span><br><span class="line">    height: parseInt(getStyle(box1, &apos;height&apos;)),</span><br><span class="line">  &#125;</span><br><span class="line">  box2Obj = &#123;</span><br><span class="line">    x: parseInt(getStyle(box2, &apos;left&apos;)),</span><br><span class="line">    y: parseInt(getStyle(box2, &apos;top&apos;)),</span><br><span class="line">    width: parseInt(getStyle(box2, &apos;width&apos;)),</span><br><span class="line">    height: parseInt(getStyle(box2, &apos;height&apos;)),</span><br><span class="line">  &#125;</span><br><span class="line">  // 鼠标按下对象</span><br><span class="line">  mouseDownObj = &#123;</span><br><span class="line">    x: 0,</span><br><span class="line">    y: 0</span><br><span class="line">  &#125;</span><br><span class="line">  // 给box1添加拖拽事件</span><br><span class="line">  box1.onmousedown = function(evt) &#123;</span><br><span class="line">    mouseDownObj.x = evt.pageX;</span><br><span class="line">    mouseDownObj.y = evt.pageY;</span><br><span class="line">    box1.onmousemove = function(evt) &#123;</span><br><span class="line">      box1.style.left = box1Obj.x + evt.pageX - mouseDownObj.x + &apos;px&apos;;</span><br><span class="line">      box1.style.top = box1Obj.y + evt.pageY - mouseDownObj.y + &apos;px&apos;;</span><br><span class="line">      var currentBox1Obj = &#123;</span><br><span class="line">        x: parseInt(getStyle(box1, &apos;left&apos;)),</span><br><span class="line">        y: parseInt(getStyle(box1, &apos;top&apos;)),</span><br><span class="line">        width: box1Obj.width,</span><br><span class="line">        height: box1Obj.height</span><br><span class="line">      &#125;</span><br><span class="line">      var bCollision = haveIntersection(currentBox1Obj, box2Obj);</span><br><span class="line">      console.log(bCollision);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  document.onmouseup = function(evt) &#123;</span><br><span class="line">    box1.onmousemove = Function.prototype;</span><br><span class="line">    box1Obj.x = parseInt(getStyle(box1, &apos;left&apos;));</span><br><span class="line">    box1Obj.y = parseInt(getStyle(box1, &apos;top&apos;));</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-cli多页面项目</title>
      <link href="/2021/02/10/vue-cli%E5%A4%9A%E9%A1%B5%E9%9D%A2%E9%A1%B9%E7%9B%AE/"/>
      <url>/2021/02/10/vue-cli%E5%A4%9A%E9%A1%B5%E9%9D%A2%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<p>vue-cli多页面项目配置<br><a id="more"></a></p><h1 id="vue-cli多页面项目"><a href="#vue-cli多页面项目" class="headerlink" title="vue-cli多页面项目"></a>vue-cli多页面项目</h1><p>vue-cli创建vue项目非常方便，在vue-cli基础上创建多页面应用，官网也给出了配置（<a href="https://cli.vuejs.org/config/#pages" target="_blank" rel="noopener">多页面配置</a>）。<br>笔者按照这个配置，又加入了一些常用的工具，完成了一个demo项目，在实际的工作中可以直接下载下来进行开发。<br><a href="https://github.com/jinux7/vue-cli-multi-pages" target="_blank" rel="noopener">demo地址</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文字跑马灯</title>
      <link href="/2021/02/07/%E6%96%87%E5%AD%97%E8%B7%91%E9%A9%AC%E7%81%AF/"/>
      <url>/2021/02/07/%E6%96%87%E5%AD%97%E8%B7%91%E9%A9%AC%E7%81%AF/</url>
      
        <content type="html"><![CDATA[<p>文字跑马灯效果<br><a id="more"></a></p><h1 id="文字跑马灯"><a href="#文字跑马灯" class="headerlink" title="文字跑马灯"></a>文字跑马灯</h1><p>笔者在开发移动端，因为移动端的屏幕较小，在展示文字的时候，比如说一个区域有5个文字，效果图展示没有问题，但是实际的数据可能是10个或者更多文字，如果折行就不美观，不折行又显示不下。加上省略号看起来美观些，但是还是看不全文字，所以跑马灯效果是一个很好的解决方案。<br>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;跑马灯效果&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;div-wrap&quot; style=&quot;width:100px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  /**</span><br><span class="line">   * @desc 文字跑马灯</span><br><span class="line">   * @param &#123;domNode&#125; [Element] ele 文字外容器dom</span><br><span class="line">   * @param &#123;offSetLeft&#125; [Number] offSetLeft 文字跑动距离左侧容器距离 </span><br><span class="line">   * @param &#123;text&#125; [String] 文字</span><br><span class="line">   */</span><br><span class="line">  function RunChar(ele, offSetLeft, text) &#123;</span><br><span class="line">    this.ele = ele;</span><br><span class="line">    this.text = text;</span><br><span class="line">    this.init = function() &#123;</span><br><span class="line">      let nSpan = document.createElement(&apos;span&apos;);</span><br><span class="line">      let nText = document.createTextNode(text);</span><br><span class="line">      nSpan.appendChild(nText);</span><br><span class="line">      this.ele.appendChild(nSpan);</span><br><span class="line">      // css</span><br><span class="line">      this.ele.style[&apos;white-space&apos;] = &apos;nowrap&apos;;</span><br><span class="line">      this.ele.style[&apos;overflow&apos;] = &apos;hidden&apos;;</span><br><span class="line">      nSpan.style[&apos;display&apos;] = &apos;inline-block&apos;;</span><br><span class="line">      let wrapWidth = Math.ceil(parseFloat(this.getStyle(this.ele, &apos;width&apos;)));</span><br><span class="line">      let spanWidth = Math.ceil(parseFloat(this.getStyle(nSpan, &apos;width&apos;)));</span><br><span class="line">      if(spanWidth &gt; wrapWidth) &#123;</span><br><span class="line">        let w = spanWidth - wrapWidth;</span><br><span class="line">        let moveVal = 0;</span><br><span class="line">        setInterval(function() &#123;</span><br><span class="line">          nSpan.style.transform = `translateX($&#123;moveVal--&#125;px)`;</span><br><span class="line">          if(moveVal &lt;= -(w+offSetLeft)) moveVal = offSetLeft;</span><br><span class="line">        &#125;, 100);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.getStyle = function(element, attr) &#123;</span><br><span class="line">      var computed;</span><br><span class="line">      if(element.currentStyle) &#123;</span><br><span class="line">        computed = element.currentStyle;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        computed = window.getComputedStyle(element, false);</span><br><span class="line">      &#125;</span><br><span class="line">      return computed.getPropertyValue( attr ) || computed[ attr ];</span><br><span class="line">    &#125;</span><br><span class="line">    this.init();</span><br><span class="line">  &#125;</span><br><span class="line">  new RunChar(document.querySelector(&apos;.div-wrap&apos;), 100, &apos;文字跑马灯效果&apos;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片压缩</title>
      <link href="/2021/02/03/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/"/>
      <url>/2021/02/03/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/</url>
      
        <content type="html"><![CDATA[<p>前端图片压缩处理<br><a id="more"></a></p><h1 id="图片压缩"><a href="#图片压缩" class="headerlink" title="图片压缩"></a>图片压缩</h1><p>笔者在日常开发中，有时候会遇到上传图片接口限制大小，所以需要对图片进行压缩。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;image-compress&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;input id=&quot;input&quot; type=&quot;file&quot; accept=&quot;image/*&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  let nInput = document.querySelector(&apos;#input&apos;);</span><br><span class="line">  nInput.onchange = function(ev) &#123;</span><br><span class="line">    let file = this.files[0];</span><br><span class="line">    imgCompress(&#123;</span><br><span class="line">      file: file,</span><br><span class="line">      maxWidth: 300,</span><br><span class="line">      maxHeight: 300,</span><br><span class="line">      callback: function(dataURL) &#123;</span><br><span class="line">        console.log(dataURL);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  /**</span><br><span class="line">   * @desc 将图片ev.target.files[0]格式直接压缩转换成base64格式</span><br><span class="line">   * @param option.file 原图片文件</span><br><span class="line">   * @param option.maxWidth 图片需要压缩的最大宽度</span><br><span class="line">   * @param option.maxHeight 图片需要压缩的最大高度</span><br><span class="line">   * @param option.callback 回调函数，参数是dataURL</span><br><span class="line">   */</span><br><span class="line">  function imgCompress(option) &#123;</span><br><span class="line">    var file = option.file; // 图片file</span><br><span class="line">    var maxWidth = option.maxWidth; // 图片需要压缩的最大宽度 </span><br><span class="line">    var maxHeight = option.maxHeight; // 图片需要压缩的最大高度</span><br><span class="line">    var originWidth, originHeight; // 原图片宽高</span><br><span class="line">    var targetWidth, targetHeight; // 目标图片宽高 </span><br><span class="line">    var dataURL; // 最后转化成的base64图片</span><br><span class="line">    var img = new Image();</span><br><span class="line">    var reader = new FileReader();</span><br><span class="line">    reader.readAsDataURL(file) </span><br><span class="line">    reader.onload = function(e)&#123; </span><br><span class="line">      img.src = e.target.result;</span><br><span class="line">    &#125;</span><br><span class="line">    img.onload = function() &#123;</span><br><span class="line">      targetWidth = originWidth = img.width;</span><br><span class="line">      targetHeight = originHeight = img.height;</span><br><span class="line">      // 等比例计算超过最大限制时缩放后的图片尺寸</span><br><span class="line">      if (originWidth &gt; maxWidth || originHeight &gt; maxHeight) &#123;</span><br><span class="line">        if (originWidth / originHeight &gt; 1) &#123;</span><br><span class="line">          // 宽图片</span><br><span class="line">          targetWidth = maxWidth;</span><br><span class="line">          targetHeight = Math.round(maxWidth * (originHeight / originWidth));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // 高图片</span><br><span class="line">          targetHeight = maxHeight;</span><br><span class="line">          targetWidth = Math.round(maxHeight * (originWidth / originHeight));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      // 创建画布</span><br><span class="line">      var canvas = document.createElement(&apos;canvas&apos;);</span><br><span class="line">      var context = canvas.getContext(&apos;2d&apos;);</span><br><span class="line">      // 设置宽高度为等同于要压缩图片的尺寸</span><br><span class="line">      canvas.width = targetWidth;</span><br><span class="line">      canvas.height = targetHeight;</span><br><span class="line">      context.clearRect(0, 0, targetWidth, targetHeight);</span><br><span class="line">      //将img绘制到画布上</span><br><span class="line">      context.drawImage(img, 0, 0, targetWidth, targetHeight);</span><br><span class="line">      dataURL = canvas.toDataURL(&apos;image/jpeg&apos;);</span><br><span class="line">      option.callback&amp;&amp;option.callback(dataURL);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个压缩工具是传入file格式图片数据，返回base64格式数据，如果需要其他格式，可以配合<a href="/2018/09/29/图片类型转换-image-base64-file-canvas/">格式转换</a>进行处理。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> 图片处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5移动端常见开发总结</title>
      <link href="/2021/01/28/h5%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B8%B8%E8%A7%81%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
      <url>/2021/01/28/h5%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B8%B8%E8%A7%81%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>移动端开发的常见问题汇总<br><a id="more"></a></p><h1 id="h5移动端常见开发总结"><a href="#h5移动端常见开发总结" class="headerlink" title="h5移动端常见开发总结"></a>h5移动端常见开发总结</h1><h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><h3 id="调用系统功能"><a href="#调用系统功能" class="headerlink" title="调用系统功能"></a>调用系统功能</h3><p>使用<code>&lt;a&gt;</code>能快速调用移动设备的电话/短信/邮件三大通讯功能，使用<code>&lt;input&gt;</code>能快速调用移动设备的的图库/文件。<br>这些功能方便了页面与系统的交互，关键在于调用格式一定要准确，否则会被移动端浏览器忽略。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 拨打电话 --&gt;</span><br><span class="line">&lt;a href=&quot;tel:10086&quot;&gt;拨打电话给10086小姐姐&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 发送短信 --&gt;</span><br><span class="line">&lt;a href=&quot;sms:10086&quot;&gt;发送短信给10086小姐姐&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 发送邮件 --&gt;</span><br><span class="line">&lt;a href=&quot;mailto:young.joway@aliyun.com&quot;&gt;发送邮件给JowayYoung&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 选择照片或拍摄照片 --&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; accept=&quot;image/*&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 选择视频或拍摄视频 --&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; accept=&quot;video/*&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 多选文件 --&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; multiple&gt;</span><br></pre></td></tr></table></figure></p><h3 id="忽略自动识别"><a href="#忽略自动识别" class="headerlink" title="忽略自动识别"></a>忽略自动识别</h3><p>有些移动端浏览器会自动将数字字母符号识别为电话/邮箱并将其渲染成上述「调用系统功能」里的<code>&lt;a&gt;</code>。虽然很方便却有可能违背需求。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 忽略自动识别电话 --&gt;</span><br><span class="line">&lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 忽略自动识别邮箱 --&gt;</span><br><span class="line">&lt;meta name=&quot;format-detection&quot; content=&quot;email=no&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 忽略自动识别电话和邮箱 --&gt;</span><br><span class="line">&lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no, email=no&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="弹出数字键盘"><a href="#弹出数字键盘" class="headerlink" title="弹出数字键盘"></a>弹出数字键盘</h3><p>使用<code>&lt;input type=&quot;tel&quot;&gt;</code>弹起数字键盘会带上#和*，适合输入电话。推荐使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;number&quot; pattern=&quot;\d*&quot;&gt;</span><br></pre></td></tr></table></figure></p><p>弹起数字键盘，适合输入验证码等纯数字格式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 纯数字带#和* --&gt;</span><br><span class="line">&lt;input type=&quot;tel&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 纯数字 --&gt;</span><br><span class="line">&lt;input type=&quot;number&quot; pattern=&quot;\d*&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="唤醒原生应用"><a href="#唤醒原生应用" class="headerlink" title="唤醒原生应用"></a>唤醒原生应用</h3><p>通过<code>location.href</code>与原生应用建立通讯渠道，这种页面与客户端的通讯方式称为<code>「URL Scheme」</code>，其基本格式为<code>scheme://[path][?query]</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">「scheme」：应用标识，表示应用在系统里的唯一标识</span><br><span class="line">「path」：应用行为，表示应用某个页面或功能</span><br><span class="line">「query」：应用参数，表示应用页面或应用功能所需的条件参数</span><br></pre></td></tr></table></figure></p><p>URL Scheme一般由前端与客户端共同协商。唤醒原生应用的前提是必须在移动设备里安装了该应用，有些移动端浏览器即使安装了该应用也无法唤醒原生应用，因为它认为URL Scheme是一种潜在的危险行为而禁用它，像Safari和微信浏览器。还好微信浏览器可开启白名单让URL Scheme有效。<br>若在页面引用第三方原生应用的URL Schema，可通过抓包第三方原生应用获取其URL。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 打开微信 --&gt;</span><br><span class="line">&lt;a href=&quot;weixin://&quot;&gt;打开微信&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 打开支付宝 --&gt;</span><br><span class="line">&lt;a href=&quot;alipays://&quot;&gt;打开支付宝&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 打开支付宝的扫一扫 --&gt;</span><br><span class="line">&lt;a href=&quot;alipays://platformapi/startapp?saId=10000007&quot;&gt;打开支付宝的扫一扫&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 打开支付宝的蚂蚁森林 --&gt;</span><br><span class="line">&lt;a href=&quot;alipays://platformapi/startapp?appId=60000002&quot;&gt;打开支付宝的蚂蚁森林&lt;/a&gt;</span><br></pre></td></tr></table></figure></p><h3 id="禁止页面缩放"><a href="#禁止页面缩放" class="headerlink" title="禁止页面缩放"></a>禁止页面缩放</h3><p>在智能手机的普及下，很多网站都具备桌面端和移动端两种浏览版本，因此无需双击缩放查看页面。禁止页面缩放可保障移动端浏览器能无遗漏地展现页面所有布局。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="禁止页面缓存"><a href="#禁止页面缓存" class="headerlink" title="禁止页面缓存"></a>禁止页面缓存</h3><p>「Cache-Control」指定请求和响应遵循的缓存机制，不想使用浏览器缓存就禁止呗！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-cache&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="禁止字母大写"><a href="#禁止字母大写" class="headerlink" title="禁止字母大写"></a>禁止字母大写</h3><p>有时在输入框里输入文本会默认开启首字母大写纠正，就是输入首字母小写会被自动纠正成大写，特么的烦。直接声明autocapitalize=off关闭首字母大写功能和autocorrect=off关闭纠正功能。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input autocapitalize=&quot;off&quot; autocorrect=&quot;off&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="针对Safari配置"><a href="#针对Safari配置" class="headerlink" title="针对Safari配置"></a>针对Safari配置</h3><p>一些Safari较零散且少用的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 设置Safari全屏，在iOS7+无效 --&gt;</span><br><span class="line">&lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 改变Safari状态栏样式，可选default/black/black-translucent，需在上述全屏模式下才有效 --&gt;</span><br><span class="line">&lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 添加页面启动占位图 --&gt;</span><br><span class="line">&lt;link rel=&quot;apple-touch-startup-image&quot; href=&quot;pig.jpg&quot; media=&quot;(device-width: 375px)&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 保存网站到桌面时添加图标 --&gt;</span><br><span class="line">&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;76x76&quot; href=&quot;pig.jpg&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 保存网站到桌面时添加图标且清除默认光泽 --&gt;</span><br><span class="line">&lt;link rel=&quot;apple-touch-icon-precomposed&quot; href=&quot;pig.jpg&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="针对其他浏览器配置"><a href="#针对其他浏览器配置" class="headerlink" title="针对其他浏览器配置"></a>针对其他浏览器配置</h3><p>贴一些其他浏览器较零散且少用的配置，主要是常用的QQ浏览器、UC浏览器和360浏览器。从网易MTL的测试数据得知，新版的QQ浏览器和UC浏览器已不支持以下<code>&lt;meta&gt;</code>声明了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 强制QQ浏览器竖屏 --&gt;</span><br><span class="line">&lt;meta name=&quot;x5-orientation&quot; content=&quot;portrait&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 强制QQ浏览器全屏 --&gt;</span><br><span class="line">&lt;meta name=&quot;x5-fullscreen&quot; content=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 开启QQ浏览器应用模式 --&gt;</span><br><span class="line">&lt;meta name=&quot;x5-page-mode&quot; content=&quot;app&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 强制UC浏览器竖屏 --&gt;</span><br><span class="line">&lt;meta name=&quot;screen-orientation&quot; content=&quot;portrait&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 强制UC浏览器全屏 --&gt;</span><br><span class="line">&lt;meta name=&quot;full-screen&quot; content=&quot;yes&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 开启UC浏览器应用模式 --&gt;</span><br><span class="line">&lt;meta name=&quot;browsermode&quot; content=&quot;application&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 开启360浏览器极速模式 --&gt;</span><br><span class="line">&lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot;&gt;</span><br></pre></td></tr></table></figure></p><h3 id="让-active有效，让-hover无效"><a href="#让-active有效，让-hover无效" class="headerlink" title="让:active有效，让:hover无效"></a>让:active有效，让:hover无效</h3><p>有些元素的:active可能会无效，而元素的:hover在点击后会一直处于点击状态，需点击其他位置才能解除点击状态。给<code>&lt;body&gt;</code>注册一个空的touchstart事件可将两种状态反转。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body ontouchstart&gt;&lt;/body&gt;</span><br></pre></td></tr></table></figure></p><h2 id="CSS方向"><a href="#CSS方向" class="headerlink" title="CSS方向"></a>CSS方向</h2><h3 id="自动适应布局"><a href="#自动适应布局" class="headerlink" title="自动适应布局"></a>自动适应布局</h3><p>针对移动端，笔者通常会结合JS依据屏幕宽度与设计图宽度的比例动态声明<html>的font-size，以rem为长度单位声明所有节点的几何属性，这样就能做到大部分移动设备的页面兼容，兼容出入较大的地方再通过媒体查询做特别处理。<br>笔者通常将rem布局比例设置成1rem=100px，即在设计图上100px长度在CSS代码上使用1rem表示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function AutoResponse(width = 750) &#123;</span><br><span class="line">    const target = document.documentElement;</span><br><span class="line">    if (target.clientWidth &gt;= 600) &#123;</span><br><span class="line">        target.style.fontSize = &quot;80px&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        target.style.fontSize = target.clientWidth / width * 100 + &quot;px&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">AutoResponse();</span><br><span class="line">window.addEventListener(&quot;resize&quot;, () =&gt; AutoResponse());</span><br></pre></td></tr></table></figure></html></p><p>当然还可依据屏幕宽度与设计图宽度的比例使用calc()动态声明<html>的font-size，这样就能节省上述代码。不对，是完全代替上述代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html &#123;</span><br><span class="line">    font-size: calc(100vw / 7.5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></html></p><p>若以iPad Pro分辨率1024px为移动端和桌面端的断点，还可结合媒体查询做断点处理。1024px以下使用rem布局，否则不使用rem布局。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (max-width: 1024px) &#123;</span><br><span class="line">    html &#123;</span><br><span class="line">        font-size: calc(100vw / 7.5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="自动适应背景"><a href="#自动适应背景" class="headerlink" title="自动适应背景"></a>自动适应背景</h3><p>使用rem布局声明一个元素背景，多数情况会将background-size声明为cover。可能在设计图对应分辨率的移动设备下，背景会完美贴合显示，但换到其他分辨率的移动设备下就会出现左右空出1px到npx的空隙。<br>此时将background-size声明为100% 100%，跟随width和height的变化而变化。反正width和height都是量好的实际尺寸。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    width: 1rem;</span><br><span class="line">    height: 1rem;</span><br><span class="line">    background: url(&quot;pig.jpg&quot;) no-repeat center/100% 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="监听屏幕旋转"><a href="#监听屏幕旋转" class="headerlink" title="监听屏幕旋转"></a>监听屏幕旋转</h3><p>你还在使用JS判断横屏竖屏调整样式吗？那就真的Out了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/* 竖屏 */</span><br><span class="line">@media all and (orientation: portrait) &#123;</span><br><span class="line">    /* 自定义样式 */</span><br><span class="line">&#125;</span><br><span class="line">/* 横屏 */</span><br><span class="line">@media all and (orientation: landscape) &#123;</span><br><span class="line">    /* 自定义样式 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="支持弹性滚动"><a href="#支持弹性滚动" class="headerlink" title="支持弹性滚动"></a>支持弹性滚动</h3><p>在苹果系统上非<code>&lt;body&gt;</code>元素的滚动操作可能会存在卡顿，但安卓系统不会出现该情况。通过声明overflow-scrolling:touch调用系统原生滚动事件优化弹性滚动，增加页面滚动的流畅度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">    -webkit-overflow-scrolling: touch;</span><br><span class="line">&#125;</span><br><span class="line">.elem &#123;</span><br><span class="line">    overflow: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="禁止滚动传播"><a href="#禁止滚动传播" class="headerlink" title="禁止滚动传播"></a>禁止滚动传播</h3><p>与桌面端浏览器不一样，移动端浏览器有一个奇怪行为。当页面包含多个滚动区域时，滚完一个区域后若还存在滚动动量则会将这些剩余动量传播到下一个滚动区域，造成该区域也滚动起来。这种行为称为「滚动传播」。<br>若不想产生这种奇怪行为可直接禁止。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    overscroll-behavior: contain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="禁止屏幕抖动"><a href="#禁止屏幕抖动" class="headerlink" title="禁止屏幕抖动"></a>禁止屏幕抖动</h3><p>对于一些突然出现滚动条的页面，可能会产生左右抖动的不良影响。在一个滚动容器里，打开弹窗就隐藏滚动条，关闭弹窗就显示滚动条，来回操作会让屏幕抖动起来。提前声明滚动容器的padding-right为滚动条宽度，就能有效消除这个不良影响。<br>每个移动端浏览器的滚动条宽度都有可能不一致，甚至不一定占位置，通过以下方式能间接计算出滚动条的宽度。100vw为视窗宽度，100%为滚动容器内容宽度，相减就是滚动条宽度，妥妥的动态计算。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">    padding-right: calc(100vw - 100%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="禁止长按操作"><a href="#禁止长按操作" class="headerlink" title="禁止长按操作"></a>禁止长按操作</h3><p>有时不想用户长按元素呼出菜单进行点链接、打电话、发邮件、保存图片或扫描二维码等操作，声明touch-callout:none禁止用户长按操作。<br>有时不想用户复制粘贴盗文案，声明user-select:none禁止用户长按操作和选择复制。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    /* pointer-events: none; */ /* 微信浏览器还需附加该属性才有效 */</span><br><span class="line">    user-select: none; /* 禁止长按选择文字 */</span><br><span class="line">    -webkit-touch-callout: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>但声明user-select:none会让<code>&lt;input&gt;</code>和<code>&lt;textarea&gt;</code>无法输入文本，可对其声明user-select:auto排除在外。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input,</span><br><span class="line">textarea &#123;</span><br><span class="line">    user-select: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="禁止字体调整"><a href="#禁止字体调整" class="headerlink" title="禁止字体调整"></a>禁止字体调整</h3><p>旋转屏幕可能会改变字体大小，声明text-size-adjust:100%让字体大小保持不变。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    text-size-adjust: 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="禁止高亮显示"><a href="#禁止高亮显示" class="headerlink" title="禁止高亮显示"></a>禁止高亮显示</h3><p>触摸元素会出现半透明灰色遮罩，不想要！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    -webkit-tap-highlight-color: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="禁止动画闪屏"><a href="#禁止动画闪屏" class="headerlink" title="禁止动画闪屏"></a>禁止动画闪屏</h3><p>在移动设备上添加动画，多数情况会出现闪屏，给动画元素的父元素构造一个3D环境就能让动画稳定运行了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    perspective: 1000;</span><br><span class="line">    backface-visibility: hidden;</span><br><span class="line">    transform-style: preserve-3d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="美化表单外观"><a href="#美化表单外观" class="headerlink" title="美化表单外观"></a>美化表单外观</h3><p>表单元素样式太丑希望自定义，appearance:none来帮你。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button,</span><br><span class="line">input,</span><br><span class="line">select,</span><br><span class="line">textarea &#123;</span><br><span class="line">    appearance: none;</span><br><span class="line">    /* 自定义样式 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="美化滚动占位"><a href="#美化滚动占位" class="headerlink" title="美化滚动占位"></a>美化滚动占位</h3><p>滚动条样式太丑希望自定义，::-webkit-scrollbar-*来帮你。记住以下三个关键词就能随机应变了。<br>[x] 「::-webkit-scrollbar」：滚动条整体部分<br>[x] 「::-webkit-scrollbar-track」：滚动条轨道部分<br>[x] 「::-webkit-scrollbar-thumb」：滚动条滑块部分<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    width: 6px;</span><br><span class="line">    height: 6px;</span><br><span class="line">    background-color: transparent;</span><br><span class="line">&#125;</span><br><span class="line">::-webkit-scrollbar-track &#123;</span><br><span class="line">    background-color: transparent;</span><br><span class="line">&#125;</span><br><span class="line">::-webkit-scrollbar-thumb &#123;</span><br><span class="line">    border-radius: 3px;</span><br><span class="line">    background-image: linear-gradient(135deg, #09f, #3c9);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="美化输入占位"><a href="#美化输入占位" class="headerlink" title="美化输入占位"></a>美化输入占位</h3><p>输入框占位文本太丑，::-webkit-input-placeholder来帮你。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input::-webkit-input-placeholder &#123;</span><br><span class="line">    color: #66f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="对齐输入占位"><a href="#对齐输入占位" class="headerlink" title="对齐输入占位"></a>对齐输入占位</h3><p>有强迫症的同学总会觉得输入框文本位置整体偏上，感觉未居中心里就痒痒的。桌面端浏览器里声明line-height等于height就能解决，但移动端浏览器里还是未能解决，需将line-height声明为normal才行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    line-height: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="对齐下拉选项"><a href="#对齐下拉选项" class="headerlink" title="对齐下拉选项"></a>对齐下拉选项</h3><p>下拉框选项默认向左对齐，是时候改改向右对齐了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select option &#123;</span><br><span class="line">    direction: rtl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="修复点击无效"><a href="#修复点击无效" class="headerlink" title="修复点击无效"></a>修复点击无效</h3><p>在苹果系统上有些情况下非可点击元素监听click事件可能会无效，针对该情况只需对不触发click事件的元素声明cursor:pointer就能解决。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="识别文本换行"><a href="#识别文本换行" class="headerlink" title="识别文本换行"></a>识别文本换行</h3><p>多数情况会使用JS换行文本，那就真的Out了。若接口返回字段包含\n或<code>&lt;br&gt;</code>，千万别替换掉，可声明white-space:pre-line交由浏览器做断行处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    white-space: pre-line;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="开启硬件加速"><a href="#开启硬件加速" class="headerlink" title="开启硬件加速"></a>开启硬件加速</h3><p>想动画更流畅吗，开启GPU硬件加速呗！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    transform: translate3d(0, 0, 0);</span><br><span class="line">    /* transform: translateZ(0); */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="描绘像素边框"><a href="#描绘像素边框" class="headerlink" title="描绘像素边框"></a>描绘像素边框</h3><p>万年话题，如何描绘一像素边框？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 80px;</span><br><span class="line">    &amp;::after &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        left: 0;</span><br><span class="line">        top: 0;</span><br><span class="line">        border: 1px solid #f66;</span><br><span class="line">        width: 200%;</span><br><span class="line">        height: 200%;</span><br><span class="line">        content: &quot;&quot;;</span><br><span class="line">        transform: scale(.5);</span><br><span class="line">        transform-origin: left top;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="控制溢出文本"><a href="#控制溢出文本" class="headerlink" title="控制溢出文本"></a>控制溢出文本</h3><p>万年话题，如何控制文本做单行溢出和多行溢出？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123;</span><br><span class="line">    width: 400px;</span><br><span class="line">    line-height: 30px;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">    &amp;.sl-ellipsis &#123;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">        text-overflow: ellipsis;</span><br><span class="line">        white-space: nowrap;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;.ml-ellipsis &#123;</span><br><span class="line">        display: -webkit-box;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">        text-overflow: ellipsis;</span><br><span class="line">        -webkit-line-clamp: 3;</span><br><span class="line">        -webkit-box-orient: vertical;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="JS方向"><a href="#JS方向" class="headerlink" title="JS方向"></a>JS方向</h2><h3 id="禁止点击穿透"><a href="#禁止点击穿透" class="headerlink" title="禁止点击穿透"></a>禁止点击穿透</h3><p>移动端浏览器里点击操作会存在300ms延迟，往往会造成点击延迟甚至点击无效，这个是众所周知的事情。<br>2007年苹果发布首款iPhone搭载的Safari为了将桌面端网站能较好地展示在移动端浏览器上而使用了双击缩放。该方案就是上述300ms延迟的主要原因，当用户执行第一次单击后会预留300ms检测用户是否继续执行单击，若是则执行缩放操作，若否则执行点击操作。鉴于该方案的成功，其他移动端浏览器也复制了该方案，现在几乎所有移动端浏览器都配备该功能。而该方案引发的点击延迟被称为「点击穿透」。<br>在前端领域里最早解决点击穿透是jQuery时代的zepto，估计现在大部分同学都未使用过zepto，其实它就是移动端版本的jquery。zepto封装tap事件能有效地解决点击穿透，通过监听document上的touch事件完成tap事件的模拟，并将tap事件冒泡到document上触发。<br>在移动端浏览器上不使用click事件而使用touch事件是因为click事件有着明显的延迟，后续又出现fastclick。该解决方案监听用户是否做了双击操作，可正常使用click事件，而点击穿透就交给fastclick自动判断。更多fastclick原理可自行百度，在此不作过多介绍。<br>fastclick有现成的NPM包，可直接安装到项目里。引入fastclick可使用click事件代替tap事件，接入方式极其简单。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Fastclick from &quot;fastclick&quot;;</span><br><span class="line"></span><br><span class="line">FastClick.attach(document.body);</span><br></pre></td></tr></table></figure></p><h3 id="禁止滑动穿透"><a href="#禁止滑动穿透" class="headerlink" title="禁止滑动穿透"></a>禁止滑动穿透</h3><p>移动端浏览器里出现弹窗时，若在屏幕上滑动能触发弹窗底下的内容跟着滚动，这个是众所周知的事情。<br>首先明确解决滑动穿透需保持哪些交互行为，那就是除了弹窗内容能点击或滚动，其他内容都不能点击或滚动。目前很多解决方案都无法做到这一点，全部解决方案都能禁止<code>&lt;body&gt;</code>的滚动行为却引发其他问题。</p><ul><li>弹窗打开后内部内容无法滚动</li><li>弹窗关闭后页面滚动位置丢失</li><li>Webview上下滑动露出底色</li></ul><p>当打开弹窗时给<code>&lt;body&gt;</code>声明position:fixed;left:0;width:100%并动态声明top。声明position:fixed会导致<code>&lt;body&gt;</code>滚动条消失，此时会发现虽然无滑动穿透，但页面滚动位置早已丢失。通过scrollingElement获取页面当前滚动条偏移量并将其赋值给top，那么在视觉上就无任何变化。当关闭弹窗时移除position:fixed;left:0;width:100%和动态top。<br>scrollingElement可兼容地获取scrollTop和scrollHeight等属性，在移动端浏览器里屡试不爽。document.scrollingElement.scrollHeight可完美代替曾经的document.documentElement.scrollHeight || document.body.scrollHeight，一眼看上去就是代码减少了。<br>该解决方案在视觉上无任何变化，完爆其他解决方案，其实就是一种反向思维和障眼法。该解决方案完美解决固定弹窗和滚动弹窗对<code>&lt;body&gt;</code>全局滚动的影响，当然也可用于局部滚动容器里，因此很值得推广。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body.static &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    left: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const body = document.body;</span><br><span class="line">const openBtn = document.getElementById(&quot;open-btn&quot;);</span><br><span class="line">const closeBtn = document.getElementById(&quot;close-btn&quot;);</span><br><span class="line">openBtn.addEventListener(&quot;click&quot;, e =&gt; &#123;</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">    const scrollTop = document.scrollingElement.scrollTop;</span><br><span class="line">    body.classList.add(&quot;static&quot;);</span><br><span class="line">    body.style.top = `-$&#123;scrollTop&#125;px`;</span><br><span class="line">&#125;);</span><br><span class="line">closeBtn.addEventListener(&quot;click&quot;, e =&gt; &#123;</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">    body.classList.remove(&quot;static&quot;);</span><br><span class="line">    body.style.top = &quot;&quot;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="支持往返刷新"><a href="#支持往返刷新" class="headerlink" title="支持往返刷新"></a>支持往返刷新</h3><p>点击移动端浏览器的前进按钮或后退按钮，有时不会自动执行旧页面的JS代码，这与往返缓存有关。这种情况在Safari上特别明显，简单概括就是往返页面无法刷新。<br>「往返缓存」指浏览器为了在页面间执行前进后退操作时能拥有更流畅体验的一种策略，以下简称BFCache。该策略具体表现为：当用户前往新页面前将旧页面的DOM状态保存在BFCache里，当用户返回旧页面前将旧页面的DOM状态从BFCache里取出并加载。大部分移动端浏览器都会部署BFCache，可大大节省接口请求的时间和带宽。<br>pageshow事件在每次页面加载时都会触发，无论是首次加载还是再次加载都会触发。pageshow事件暴露的persisted可判断页面是否从BFCache里取出。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&quot;pageshow&quot;, e =&gt; e.persisted &amp;&amp; location.reload());</span><br></pre></td></tr></table></figure></p><h3 id="解析有效日期"><a href="#解析有效日期" class="headerlink" title="解析有效日期"></a>解析有效日期</h3><p>在苹果系统上解析YYYY-MM-DD HH:mm:ss这种日期格式会报错Invalid Date，但在安卓系统上解析这种日期格式完全无问题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Date(&quot;2019-03-31 21:30:00&quot;); // Invalid Date</span><br></pre></td></tr></table></figure></p><p>查看Safari相关开发手册发现可用YYYY/MM/DD HH:mm:ss这种日期格式，简单概括就是年月日必须使用/衔接而不能使用-衔接。当然安卓系统也支持该格式，然而接口返回字段的日期格式通常是YYYY-MM-DD HH:mm:ss，那么需替换其中的-为/。</p><p>const date = “2019-03-31 21:30:00”;<br>new Date(date.replace(/-/g, “/“));</p><h3 id="修复高度坍塌"><a href="#修复高度坍塌" class="headerlink" title="修复高度坍塌"></a>修复高度坍塌</h3><p>当页面同时出现以下三个条件时，键盘占位会把页面高度压缩一部分。当输入完成键盘占位消失后，页面高度有可能回不到原来高度，产生坍塌导致Webview底色露脸，简单概括就是输入框失焦后页面未回弹。</p><ul><li>页面高度过小</li><li>输入框在页面底部或视窗中下方</li><li>输入框聚焦输入文本</li></ul><p>只要保持前后滚动条偏移量一致就不会出现上述问题。在输入框聚焦时获取页面当前滚动条偏移量，在输入框失焦时赋值页面之前获取的滚动条偏移量，这样就能间接还原页面滚动条偏移量解决页面高度坍塌。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const input = document.getElementById(&quot;input&quot;);</span><br><span class="line">let scrollTop = 0;</span><br><span class="line">input.addEventListener(&quot;focus&quot;, () =&gt; &#123;</span><br><span class="line">    scrollTop = document.scrollingElement.scrollTop;</span><br><span class="line">&#125;);</span><br><span class="line">input.addEventListener(&quot;blur&quot;, () =&gt; &#123;</span><br><span class="line">    document.scrollingElement.scrollTo(0, scrollTop);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h3 id="修复输入监听"><a href="#修复输入监听" class="headerlink" title="修复输入监听"></a>修复输入监听</h3><p>在苹果系统上的输入框输入文本，keyup/keydown/keypress事件可能会无效。当输入框监听keyup事件时，逐个输入英文和数字会有效，但逐个输入中文不会有效，需按回车键才会有效。<br>此时可用input事件代替输入框的keyup/keydown/keypress事件。</p><h3 id="简化回到顶部"><a href="#简化回到顶部" class="headerlink" title="简化回到顶部"></a>简化回到顶部</h3><p>曾几何时编写一个返回顶部函数麻烦得要死，需scrollTop、定时器和条件判断三者配合才能完成。其实DOM对象里隐藏了一个很好用的函数可完成上述功能，一行核心代码就能搞定。<br>该函数就是scrollIntoView，它会滚动目标元素的父容器使之对用户可见，简单概括就是相对视窗让容器滚动到目标元素位置。它有三个可选参数能让scrollIntoView滚动起来更优雅。<br>「behavior」：动画过渡效果，默认auto无，可选smooth平滑<br>「inline」：水平方向对齐方式，默认nearest就近对齐，可选start顶部对齐、center中间对齐和end底部对齐<br>「block」：垂直方向对齐方式，默认start顶部对齐，可选center中间对齐、end底部对齐和nearest就近对齐<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const gotopBtn = document.getElementById(&quot;gotop-btn&quot;);</span><br><span class="line">openBtn.addEventListener(&quot;click&quot;, () =&gt; document.body.scrollIntoView(&#123; behavior: &quot;smooth&quot; &#125;));</span><br></pre></td></tr></table></figure></p><p>当然还可滚动到目标元素位置，只需将document.body修改成目标元素的DOM对象。一行核心代码就能搞掂的事情为何还编写那么多代码去完成，不累吗？</p><h3 id="简化懒性加载"><a href="#简化懒性加载" class="headerlink" title="简化懒性加载"></a>简化懒性加载</h3><p>与上述「简化回到顶部」一样，编写一个懒性加载函数也同样需scrollTop、定时器和条件判断三者配合才能完成。其实DOM对象里隐藏了一个很好用的函数可完成上述功能，该函数无需监听容器的scroll事件，通过浏览器自身机制完成滚动监听。<br>该函数就是IntersectionObserver，它提供一种异步观察目标元素及其祖先元素或顶级文档视窗交叉状态的方法。详情可参照MDN文档，在此不作过多介绍。<br>懒性加载的第一种使用场景：「图片懒加载」。只需确认图片进入可视区域就赋值加载图片，赋值完成还需对图片停止监听。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;img data-src=&quot;pig.jpg&quot;&gt;</span><br><span class="line">&lt;!-- 很多&lt;img&gt; --&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const imgs = document.querySelectorAll(&quot;img.lazyload&quot;);</span><br><span class="line">const observer = new IntersectionObserver(nodes =&gt; &#123;</span><br><span class="line">    nodes.forEach(v =&gt; &#123;</span><br><span class="line">        if (v.isIntersecting) &#123; // 判断是否进入可视区域</span><br><span class="line">            v.target.src = v.target.dataset.src; // 赋值加载图片</span><br><span class="line">            observer.unobserve(v.target); // 停止监听已加载的图片</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">imgs.forEach(v =&gt; observer.observe(v));</span><br></pre></td></tr></table></figure><p>懒性加载的第二种使用场景：「下拉加载」。在列表最底部部署一个占位元素且该元素无任何高度或实体外观，只需确认占位元素进入可视区域就请求接口加载数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;&lt;/li&gt;</span><br><span class="line">    &lt;!-- 很多&lt;li&gt; --&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;!-- 也可将#bottom以&lt;li&gt;的形式插入到&lt;ul&gt;内部的最后位置 --&gt;</span><br><span class="line">&lt;div id=&quot;bottom&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const bottom = document.getElementById(&quot;bottom&quot;);</span><br><span class="line">const observer = new IntersectionObserver(nodes =&gt; &#123;</span><br><span class="line">    const tgt = nodes[0]; // 反正只有一个</span><br><span class="line">    if (tgt.isIntersecting) &#123;</span><br><span class="line">        console.log(&quot;已到底部，请求接口&quot;);</span><br><span class="line">        // 执行接口请求代码</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">bottom.observe(bottom);</span><br></pre></td></tr></table></figure><h3 id="优化扫码识别"><a href="#优化扫码识别" class="headerlink" title="优化扫码识别"></a>优化扫码识别</h3><p>通常移动端浏览器都会配备长按二维码图片识别链接的功能，但长按二维码可能无法识别或错误识别。二维码表面看上去是一张图片，可二维码生成方式却五花八门，二维码生成方式有以下三种。<br>[x] 使用<code>&lt;img&gt;</code>渲染<br>[x] 使用<code>&lt;svg&gt;</code>渲染<br>[x] 使用<code>&lt;canvas&gt;</code>渲染<br>从网易MTL的测试数据得知，大部分移动端浏览器只能识别<img>渲染的二维码，为了让全部移动端浏览器都能识别二维码，那只能使用<code>&lt;img&gt;</code>渲染二维码了。若使用SVG和Canvas的方式生成二维码，那就想方设法把二维码数据转换成Base64再赋值到<code>&lt;img&gt;</code>的src上。<br>一个页面可能存在多个二维码，若长按二维码只能识别最后一个，那只能控制每个页面只存在一个二维码。</p><h3 id="自动播放媒体"><a href="#自动播放媒体" class="headerlink" title="自动播放媒体"></a>自动播放媒体</h3><p>常见媒体元素包括音频<code>&lt;audio&gt;</code>和视频<code>&lt;video&gt;</code>，为了让用户得到更好的媒体播放体验与不盲目浪费用户流量，大部分移动端浏览器都明确规定不能自动播放媒体或默认屏蔽autoplay。为了能让媒体在页面加载完成后自动播放，只能显式声明播放。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const audio = document.getElementById(&quot;audio&quot;);</span><br><span class="line">const video = document.getElementById(&quot;video&quot;);</span><br><span class="line">audio.play();</span><br><span class="line">video.play();</span><br></pre></td></tr></table></figure></p><p>对于像微信浏览器这样的内置浏览器，还需监听其应用SDK加载完成才能触发上述代码，以保障WebView正常渲染。其他内置浏览器同理，在此不作过多介绍。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(&quot;WeixinJSBridgeReady&quot;, () =&gt; &#123;</span><br><span class="line">    // 执行上述媒体自动播放代码</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>在苹果系统上明确规定用户交互操作开始后才能播放媒体，未得到用户响应会被Safari自动拦截，因此需监听用户首次触摸操作并触发媒体自动播放，而该监听仅此一次。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">document.body.addEventListener(&quot;touchstart&quot;, () =&gt; &#123;</span><br><span class="line">    // 执行上述媒体自动播放代码</span><br><span class="line">&#125;, &#123; once: true &#125;);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>android ios 键盘弹出</title>
      <link href="/2021/01/14/android-ios-%E9%94%AE%E7%9B%98%E5%BC%B9%E5%87%BA/"/>
      <url>/2021/01/14/android-ios-%E9%94%AE%E7%9B%98%E5%BC%B9%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<p>android ios 键盘弹出<br><a id="more"></a></p><h1 id="android-ios-键盘弹出"><a href="#android-ios-键盘弹出" class="headerlink" title="android ios 键盘弹出"></a>android ios 键盘弹出</h1><p>有时在页面的特殊布局情况下，需要对输入键盘的弹出和收起做判断。<br>android可以用clientHeight高度来判断键盘的弹出和收起，但是ios却不行，ios可以利用focusin和focusout这两个事件冒泡到body元素上，来判断键盘的弹出和收起，focus和blur可不行，因为他们不会冒泡到body上。</p><h2 id="android专用方法"><a href="#android专用方法" class="headerlink" title="android专用方法"></a>android专用方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isAndroid = navigator.userAgent.indexOf(<span class="string">'Android'</span>) &gt; <span class="number">-1</span> || navigator.userAgent.indexOf(<span class="string">'Adr'</span>) &gt; <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">var</span> isiOS = !!navigator.userAgent.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>);</span><br><span class="line"><span class="keyword">if</span>(isAndroid) &#123;</span><br><span class="line"><span class="comment">//获取原窗口的高度</span></span><br><span class="line"><span class="keyword">var</span> originalHeight=<span class="built_in">document</span>.documentElement.clientHeight ||<span class="built_in">document</span>.body.clientHeight;</span><br><span class="line"><span class="built_in">window</span>.onresize=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">//键盘弹起与隐藏都会引起窗口的高度发生变化</span></span><br><span class="line"><span class="keyword">var</span> resizeHeight=<span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">      <span class="keyword">if</span>(resizeHeight<span class="number">-0</span>&lt;originalHeight<span class="number">-0</span>)&#123;</span><br><span class="line">      <span class="comment">//当软键盘弹起，在此处操作</span></span><br><span class="line">      alert(<span class="string">'键盘弹起'</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//当软键盘收起，在此处操作</span></span><br><span class="line">      alert(<span class="string">'键盘收起'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="android和ios通用方法"><a href="#android和ios通用方法" class="headerlink" title="android和ios通用方法"></a>android和ios通用方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'focusin'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">//软键盘弹出的事件处理</span></span><br><span class="line">  <span class="keyword">if</span>(isiOS) &#123;</span><br><span class="line">    alert(<span class="string">'ios键盘弹起'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(isAndroid) &#123;</span><br><span class="line">    alert(<span class="string">'android键盘弹起'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'focusout'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">//软键盘收起的事件处理</span></span><br><span class="line">  <span class="keyword">if</span>(isiOS) &#123;</span><br><span class="line">    alert(<span class="string">'ios键盘收起'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(isAndroid) &#123;</span><br><span class="line">    alert(<span class="string">'android键盘收起'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> 兼容性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>toString与valueOf浅析</title>
      <link href="/2020/12/25/toString%E4%B8%8EvalueOf%E6%B5%85%E6%9E%90/"/>
      <url>/2020/12/25/toString%E4%B8%8EvalueOf%E6%B5%85%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>分析toString与valueOf<br><a id="more"></a></p><h1 id="toString与valueOf浅析"><a href="#toString与valueOf浅析" class="headerlink" title="toString与valueOf浅析"></a>toString与valueOf浅析</h1><p>基本上，所有JS数据类型都拥有这两个方法，null除外。它们俩是位于原型链上的方法，也是为了解决javascript值运算与显示的问题。<br>valueOf 和 toString 几乎都是在出现操作符(+-*/==&gt;&lt;)时被调用（隐式转换）。</p><h2 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h2><p>返回一个表示该对象的字符串，当对象表示为文本值或以期望的字符串方式被引用时，toString方法被自动调用。</p><h3 id="1-手动调用看看什么效果"><a href="#1-手动调用看看什么效果" class="headerlink" title="1. 手动调用看看什么效果"></a>1. 手动调用看看什么效果</h3><p>嗯，跟介绍的一样，没骗人，全部都转成了字符串。<br>比较特殊的地方就是，表示对象的时候，变成[object Object]，表示数组的时候，就变成数组内容以逗号连接的字符串，相当于Array.join(‘,’)。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> c = <span class="string">'123'</span></span><br><span class="line"><span class="keyword">let</span> d = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">'fn'</span>) &#125;</span><br><span class="line"><span class="built_in">console</span>.log(a.toString())   <span class="comment">// '[object Object]'</span></span><br><span class="line"><span class="built_in">console</span>.log(b.toString())   <span class="comment">// '1,2,3'</span></span><br><span class="line"><span class="built_in">console</span>.log(c.toString())   <span class="comment">// '123'</span></span><br><span class="line"><span class="built_in">console</span>.log(d.toString())   <span class="comment">// 'function()&#123; console.log('fn') &#125;'</span></span><br></pre></td></tr></table></figure></p><h3 id="2-最精准的类型判断"><a href="#2-最精准的类型判断" class="headerlink" title="2. 最精准的类型判断"></a>2. 最精准的类型判断</h3><p>这种属于更精确的判断方式，在某种场合会比使用 typeof &amp; instanceof 来的更高效和准确些。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">toString.call(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;)       <span class="comment">// [object Function]</span></span><br><span class="line">toString.call(&#123;&#125;)           <span class="comment">// [object Object]</span></span><br><span class="line">toString.call([])           <span class="comment">// [object Array]</span></span><br><span class="line">toString.call(<span class="string">''</span>)           <span class="comment">// [object String]</span></span><br><span class="line">toString.call(<span class="number">22</span>)           <span class="comment">// [object Number]</span></span><br><span class="line">toString.call(<span class="literal">undefined</span>)    <span class="comment">// [object undefined]</span></span><br><span class="line">toString.call(<span class="literal">null</span>)         <span class="comment">// [object null]</span></span><br><span class="line">toString.call(<span class="keyword">new</span> <span class="built_in">Date</span>)     <span class="comment">// [object Date]</span></span><br><span class="line">toString.call(<span class="built_in">Math</span>)         <span class="comment">// [object Math]</span></span><br><span class="line">toString.call(<span class="built_in">window</span>)       <span class="comment">// [object Window]</span></span><br></pre></td></tr></table></figure></p><h3 id="3-什么时候会自动调用呢"><a href="#3-什么时候会自动调用呢" class="headerlink" title="3. 什么时候会自动调用呢"></a>3. 什么时候会自动调用呢</h3><p>使用操作符的时候，如果其中一边为对象，则会先调用toSting方法，也就是隐式转换，然后再进行操作。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> d = &#123;<span class="attr">a</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Object'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Array</span>.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Array'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.join(<span class="string">','</span>)   <span class="comment">// 返回toString的默认值（下面测试）</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Number</span>.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Number'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">String</span>.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'String'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span> + <span class="number">1</span>)  <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'s'</span>)    <span class="comment">// 's'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'s'</span>+<span class="number">2</span>)  <span class="comment">// 's2'</span></span><br><span class="line"><span class="built_in">console</span>.log(c &lt; <span class="number">2</span>)  <span class="comment">// false        (一次 =&gt; 'Array')</span></span><br><span class="line"><span class="built_in">console</span>.log(c + c)  <span class="comment">// "1,2,31,2,3" (两次 =&gt; 'Array')</span></span><br><span class="line"><span class="built_in">console</span>.log(d &gt; d)  <span class="comment">// false        (两次 =&gt; 'Object')</span></span><br></pre></td></tr></table></figure></p><h3 id="4-重写toString方法"><a href="#4-重写toString方法" class="headerlink" title="4. 重写toString方法"></a>4. 重写toString方法</h3><p>既然知道了有 toString 这个默认方法，那我们也可以来重写这个方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(count) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count</span><br><span class="line">    &#125;</span><br><span class="line">    toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'我有这么多钱：'</span> + <span class="keyword">this</span>.count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">console</span>.log(a)              <span class="comment">// A &#123;count: 100&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(a.toString())   <span class="comment">// 我有这么多钱：100</span></span><br><span class="line"><span class="built_in">console</span>.log(a + <span class="number">1</span>)          <span class="comment">// 我有这么多钱：1001</span></span><br></pre></td></tr></table></figure></p><h2 id="valueOf-NaN"><a href="#valueOf-NaN" class="headerlink" title="valueOf"></a>valueOf</h2><p>返回当前对象的原始值。<br>具体功能与toString大同小异，同样具有以上的自动调用和重写方法。<br>这里就没什么好说的了，主要为两者间的区别，有请继续往下看<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> d = &#123;<span class="attr">a</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(c.valueOf())    <span class="comment">// [1, 2, 3]</span></span><br><span class="line"><span class="built_in">console</span>.log(d.valueOf())    <span class="comment">// &#123;a:2&#125;</span></span><br></pre></td></tr></table></figure></p><h2 id="两者区别"><a href="#两者区别" class="headerlink" title="两者区别"></a>两者区别</h2><p>共同点：在输出对象时会自动调用。<br>不同点：默认返回值不同，且存在优先级关系。<br>二者并存的情况下，在数值运算中，优先调用了valueOf，字符串运算中，优先调用了toString。<br>看代码:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    valueOf() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'哈哈哈'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(a))  <span class="comment">// '哈哈哈'   =&gt; (toString)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(a))  <span class="comment">// 2         =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a + <span class="string">'22'</span>)   <span class="comment">// '222'     =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a == <span class="number">2</span>)     <span class="comment">// true      =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a === <span class="number">2</span>)    <span class="comment">// false     =&gt; (严格等于不会触发隐式转换)</span></span><br></pre></td></tr></table></figure></p><p>结果给人的感觉是，如果转换为字符串时调用toString方法，如果是转换为数值时则调用valueOf方法。<br>但其中的 a + ‘22’ 很不和谐，字符串合拼应该是调用toString方法。为了追究真相，我们需要更严谨的实验。<br>暂且先把 valueOf 方法去掉<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'哈哈哈'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(a))  <span class="comment">// '哈哈哈'     =&gt; (toString)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(a))  <span class="comment">// NaN         =&gt; (toString)</span></span><br><span class="line"><span class="built_in">console</span>.log(a + <span class="string">'22'</span>)   <span class="comment">// '哈哈哈22'   =&gt; (toString)</span></span><br><span class="line"><span class="built_in">console</span>.log(a == <span class="number">2</span>)     <span class="comment">// false       =&gt; (toString)</span></span><br></pre></td></tr></table></figure></p><p>去掉 toString 方法看看<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    valueOf() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(a))  <span class="comment">// '[object Object]'    =&gt; (toString)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(a))  <span class="comment">// 2                    =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a + <span class="string">'22'</span>)   <span class="comment">// '222'                =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a == <span class="number">2</span>)     <span class="comment">// true                 =&gt; (valueOf)</span></span><br></pre></td></tr></table></figure></p><p>发现有点不同吧？！它没有像上面 toString 那样统一规整。对于那个 [object Object]，我估计是从 Object 那里继承过来的，我们再去掉它看看。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    valueOf() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A()</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString = <span class="literal">null</span>; </span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(a))  <span class="comment">// 2        =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(a))  <span class="comment">// 2        =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a + <span class="string">'22'</span>)   <span class="comment">// '222'    =&gt; (valueOf)</span></span><br><span class="line"><span class="built_in">console</span>.log(a == <span class="number">2</span>)     <span class="comment">// true     =&gt; (valueOf)</span></span><br></pre></td></tr></table></figure></p><p>总结：valueOf偏向于运算，toString偏向于显示。</p><ul><li>在进行对象转换时，将优先调用toString方法，如若没有重写 toString，将调用 valueOf 方法；如果两个方法都没有重写，则按Object的toString输出。</li><li>在进行强转字符串类型时，将优先调用 toString 方法，强转为数字时优先调用 valueOf。</li><li>使用运算操作符的情况下，valueOf的优先级高于toString。</li></ul><h2 id="Symbol-toPrimitive"><a href="#Symbol-toPrimitive" class="headerlink" title="[Symbol.toPrimitive]"></a>[Symbol.toPrimitive]</h2><p>MDN：Symbol.toPrimitive 是一个内置的 Symbol 值，它是作为对象的函数值属性存在的，当一个对象转换为对应的原始值时，会调用此函数。<br>是不是有点懵？？？把它当做一个函数就行了~~<br>作用：同valueOf()和toString()一样，但是优先级要高于这两者；<br>该函数被调用时，会被传递一个字符串参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint</span><br></pre></td></tr></table></figure></p><p>表示当前运算的模式，一共有三种模式：</p><ul><li>string：字符串类型</li><li>number：数字类型</li><li>default：默认</li></ul><p>下面来看看实现吧：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">    constructor(count) &#123;</span><br><span class="line">        this.count = count</span><br><span class="line">    &#125;</span><br><span class="line">    valueOf() &#123;</span><br><span class="line">        return 2</span><br><span class="line">    &#125;</span><br><span class="line">    toString() &#123;</span><br><span class="line">        return &apos;哈哈哈&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    // 我在这里</span><br><span class="line">    [Symbol.toPrimitive](hint) &#123;</span><br><span class="line">        if (hint == &quot;number&quot;) &#123;</span><br><span class="line">            return 10;</span><br><span class="line">        &#125;</span><br><span class="line">        if (hint == &quot;string&quot;) &#123;</span><br><span class="line">            return &quot;Hello Libai&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">const a = new A(10)</span><br><span class="line">console.log(`$&#123;a&#125;`)     // &apos;Hello Libai&apos; =&gt; (hint == &quot;string&quot;)</span><br><span class="line">console.log(String(a))  // &apos;Hello Libai&apos; =&gt; (hint == &quot;string&quot;)</span><br><span class="line">console.log(+a)         // 10            =&gt; (hint == &quot;number&quot;)</span><br><span class="line">console.log(a * 20)     // 200           =&gt; (hint == &quot;number&quot;)</span><br><span class="line">console.log(a / 20)     // 0.5           =&gt; (hint == &quot;number&quot;)</span><br><span class="line">console.log(Number(a))  // 10            =&gt; (hint == &quot;number&quot;)</span><br><span class="line">console.log(a + &apos;22&apos;)   // &apos;true22&apos;      =&gt; (hint == &quot;default&quot;)</span><br><span class="line">console.log(a == 10)     // false        =&gt; (hint == &quot;default&quot;)</span><br></pre></td></tr></table></figure></p><p>比较特殊的是(+)拼接符，这个属于default的模式。<br>划重点：此方法不兼容IE，尴尬到我不想写出来了~~</p><h2 id="面试题分析"><a href="#面试题分析" class="headerlink" title="面试题分析"></a>面试题分析</h2><p>以下几道大厂必考的面试题，完美呈现出 toString 与 valueOf 的作用。</p><h3 id="1-a-1-amp-amp-a-2-amp-amp-a-3-为-true"><a href="#1-a-1-amp-amp-a-2-amp-amp-a-3-为-true" class="headerlink" title="1. a==1&amp;&amp;a==2&amp;&amp;a==3 为 true"></a>1. a==1&amp;&amp;a==2&amp;&amp;a==3 为 true</h3><p>双等号(==)：会触发隐式类型转换，所以可以使用 valueOf 或者 toString 来实现。<br>每次判断都会触发valueOf方法，同时让value+1，才能使得下次判断成立。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">    constructor(value) &#123;</span><br><span class="line">        this.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    valueOf() &#123;</span><br><span class="line">        return this.value++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">const a = new A(1);</span><br><span class="line">if (a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) &#123;</span><br><span class="line">    console.log(&quot;Hi Libai!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="2-a-1-amp-amp-a-2-amp-amp-a-3-为-true"><a href="#2-a-1-amp-amp-a-2-amp-amp-a-3-为-true" class="headerlink" title="2. a===1&amp;&amp;a===2&amp;&amp;a===3 为 true"></a>2. a===1&amp;&amp;a===2&amp;&amp;a===3 为 true</h3><p>全等(===)：严格等于不会进行隐式转换，这里使用 Object.defineProperty 数据劫持的方法来实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let value = 1;</span><br><span class="line">Object.defineProperty(window, &apos;a&apos;, &#123;</span><br><span class="line">    get() &#123;</span><br><span class="line">        return value++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">if (a === 1 &amp;&amp; a === 2 &amp;&amp; a === 3) &#123;</span><br><span class="line">    console.log(&quot;Hi Libai!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上面我们就是劫持全局window上面的a，当a每一次做判断的时候都会触发get属性获取值，并且每一次获取值都会触发一次函数实行一次自增，判断三次就自增三次，所以最后会让公式成立。</p><h3 id="3-实现一个无限累加函数"><a href="#3-实现一个无限累加函数" class="headerlink" title="3. 实现一个无限累加函数"></a>3. 实现一个无限累加函数</h3><p>问题：用 JS 实现一个无限累加的函数 add，示例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">add(1); // 1</span><br><span class="line">add(1)(2);  // 3</span><br><span class="line">add(1)(2)(3)； // 6</span><br><span class="line">add(1)(2)(3)(4)； // 10 </span><br><span class="line"></span><br><span class="line">// 以此类推</span><br><span class="line">function add(a) &#123;</span><br><span class="line">    function sum(b) &#123; // 使用闭包</span><br><span class="line">        a = b ? a + b : a; // 累加</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">    sum.toString = function() &#123; // 只在最后一次调用</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">    return sum; // 返回一个函数</span><br><span class="line">&#125;</span><br><span class="line">add(1)              // 1</span><br><span class="line">add(1)(2)           // 3</span><br><span class="line">add(1)(2)(3)        // 6</span><br><span class="line">add(1)(2)(3)(4)     // 10</span><br></pre></td></tr></table></figure></p><p>add函数内部定义sum函数并返回，实现连续调用<br>sum函数形成了一个闭包，每次调用进行累加值，再返回当前函数sum<br>add()每次都会返回一个函数sum，直到最后一个没被调用，默认会触发toString方法，所以我们这里重写toString方法，并返回累计的最终值a<br>这样说才能理解:<br>add(10): 执行函数add(10)，返回了sum函数，注意这一次没有调用sum，默认执行sum.toString方法。所以输出10；<br>add(10)(20): 执行函数add(10)，返回sum(此时a为10)，再执行sum(20)，此时a为30，返回sum，最后调用sum.toString()输出30。add(10)(20)…(n)依次类推。</p><h3 id="4-柯里化实现多参累加"><a href="#4-柯里化实现多参累加" class="headerlink" title="4. 柯里化实现多参累加"></a>4. 柯里化实现多参累加</h3><p>这里是上面累加的升级版，实现多参数传递累加。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">add(1)(3,4)(3,5)    // 16</span><br><span class="line">add(2)(2)(3,5)      // 12</span><br><span class="line">function add()&#123;</span><br><span class="line">    // 1 把所有参数转换成数组</span><br><span class="line">    let args = Array.prototype.slice.call(arguments)</span><br><span class="line">    // 2 再次调用add函数，传递合并当前与之前的参数</span><br><span class="line">    let fn = function() &#123;</span><br><span class="line">        let arg_fn = Array.prototype.slice.call(arguments)</span><br><span class="line">        return add.apply(null, args.concat(arg_fn))</span><br><span class="line">    &#125;</span><br><span class="line">    // 3 最后默认调用，返回合并的值</span><br><span class="line">    fn.toString = function() &#123;</span><br><span class="line">        return args.reduce(function(a, b) &#123;</span><br><span class="line">            return a + b</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    return fn</span><br><span class="line">&#125;</span><br><span class="line">// ES6写法</span><br><span class="line">function add () &#123;</span><br><span class="line">    let args = [...arguments];</span><br><span class="line">    let fn = function()&#123;</span><br><span class="line">        return add.apply(null, args.concat([...arguments]))</span><br><span class="line">    &#125; </span><br><span class="line">    fn.toString = () =&gt; args.reduce((a, b) =&gt; a + b)</span><br><span class="line">    return fn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>海量数据页面渲染优化</title>
      <link href="/2020/12/16/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96/"/>
      <url>/2020/12/16/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>页面有大量数据渲染的优化处理<br><a id="more"></a></p><h1 id="海量数据页面渲染优化"><a href="#海量数据页面渲染优化" class="headerlink" title="海量数据页面渲染优化"></a>海量数据页面渲染优化</h1><p>平时在工作中需要在页面中渲染的数据量并不多，不过在极端情况下可能会渲染成千上万条，如果直接把数据生成dom节点往页面中插入的话，可能会使浏览器挂掉，下面列举3个优化方式：</p><h2 id="一-使用requestAnimationFrame"><a href="#一-使用requestAnimationFrame" class="headerlink" title="一 使用requestAnimationFrame"></a>一 使用requestAnimationFrame</h2><p>使用requestAnimationFrame函数，可以根据浏览器刷新频率进行渲染。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul id=<span class="string">"ul"</span>&gt;&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  const maxNum = 50000;</span></span><br><span class="line"><span class="regexp">  const num = 20;</span></span><br><span class="line"><span class="regexp">  let count = 0;</span></span><br><span class="line"><span class="regexp">  let ul = document.querySelector('#ul');</span></span><br><span class="line"><span class="regexp">  function add() &#123;</span></span><br><span class="line"><span class="regexp">    let frag = document.createDocumentFragment();</span></span><br><span class="line"><span class="regexp">    for(let j=0; j&lt;num; j++) &#123;</span></span><br><span class="line"><span class="regexp">      let li = document.createElement('li');</span></span><br><span class="line"><span class="regexp">      li.innerHTML = num*count + j;</span></span><br><span class="line"><span class="regexp">      frag.appendChild(li);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    ul.appendChild(frag);</span></span><br><span class="line"><span class="regexp">    loop();</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  function loop() &#123;</span></span><br><span class="line"><span class="regexp">    count++;</span></span><br><span class="line"><span class="regexp">    if(count &lt; maxNum/</span>num) &#123;</span><br><span class="line">      requestAnimationFrame(add);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'总用时-&gt;'</span>+<span class="built_in">Math</span>.ceil((performance.now() - startTime))+<span class="string">'ms'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> startTime = performance.now();</span><br><span class="line">  add();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><h2 id="二-使用setTimeout"><a href="#二-使用setTimeout" class="headerlink" title="二 使用setTimeout"></a>二 使用setTimeout</h2><p>使用setTimeout函数，完成一段工作后将线程让出去，让浏览器其它任务执行<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul id=<span class="string">"ul"</span>&gt;&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  const maxNum = 50000;</span></span><br><span class="line"><span class="regexp">  const num = 20;</span></span><br><span class="line"><span class="regexp">  let count = 0;</span></span><br><span class="line"><span class="regexp">  let ul = document.querySelector('#ul');</span></span><br><span class="line"><span class="regexp">  function add() &#123;</span></span><br><span class="line"><span class="regexp">    let frag = document.createDocumentFragment();</span></span><br><span class="line"><span class="regexp">    for(let j=0; j&lt;num; j++) &#123;</span></span><br><span class="line"><span class="regexp">      let li = document.createElement('li');</span></span><br><span class="line"><span class="regexp">      li.innerHTML = num*count + j;</span></span><br><span class="line"><span class="regexp">      frag.appendChild(li);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    ul.appendChild(frag);</span></span><br><span class="line"><span class="regexp">    loop();</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  function loop() &#123;</span></span><br><span class="line"><span class="regexp">    count++;</span></span><br><span class="line"><span class="regexp">    if(count &lt; maxNum/</span>num) &#123;</span><br><span class="line">      setTimeout(add);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'总用时-&gt;'</span>+<span class="built_in">Math</span>.ceil((performance.now() - startTime))+<span class="string">'ms'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> startTime = performance.now();</span><br><span class="line">  add();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><p>上述两种方式，一个是使用requestAnimationFrame，一个是使用setTimeout，前者是根据浏览器刷新频率，60HZ就是1000/60毫秒执行一次，但这里有个问题我没有实验，就是单词任务如果超过一次刷新的时间会如何处理呢？（所以尽可能把单次任务执行时间控制在浏览器一次刷新时间范围内）。<br>而setTimeout就没有刷新时间，任务执行完成之后，任务队列中没有其它任务的话，直接执行setTimeout里的任务。<br>所以在都是50000条数据，单次向dom中插入20条数据的任务，两者所耗费的时间是不一样的。<br>方法一用时：总用时-&gt;168309ms<br>方法二用时: 总用时-&gt;94812ms<br>根据用时可以看出来，方法二不需要等待浏览器的刷新时间（在理想状态，没有其它任务情况下），所需时间是比方法一少的。</p><h2 id="三-时间切片"><a href="#三-时间切片" class="headerlink" title="三 时间切片"></a>三 时间切片</h2><p><a href="/2020/03/12/前端性能优化之时间切片/">什么是时间切片</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul id=<span class="string">"ul"</span>&gt;&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  const maxNum = 50000;</span></span><br><span class="line"><span class="regexp">  const num = 20;</span></span><br><span class="line"><span class="regexp">  let count = 0;</span></span><br><span class="line"><span class="regexp">  let ul = document.querySelector('#ul');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  function *gen() &#123;</span></span><br><span class="line"><span class="regexp">    while(count &lt;  maxNum/</span>num) &#123;</span><br><span class="line">      <span class="keyword">yield</span> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">let</span> frag = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">              <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>; j&lt;num; j++) &#123;</span><br><span class="line">                <span class="keyword">let</span> li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">                li.innerHTML = num*count + j;</span><br><span class="line">                frag.appendChild(li);</span><br><span class="line">              &#125;</span><br><span class="line">              ul.appendChild(frag);</span><br><span class="line">            &#125;)();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ts</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> gen === <span class="string">'function'</span>) gen = gen()</span><br><span class="line">    <span class="keyword">if</span> (!gen || <span class="keyword">typeof</span> gen.next !== <span class="string">'function'</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> start = performance.now()</span><br><span class="line">        <span class="keyword">let</span> res = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            res = gen.next();</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!res.done &amp;&amp; performance.now() - start &lt; <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (res.done) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'总用时-&gt;'</span>+<span class="built_in">Math</span>.ceil((performance.now() - startTime))+<span class="string">'ms'</span>);</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        setTimeout(next)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> startTime = performance.now();</span><br><span class="line">  ts(gen)();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><p>方法三用时: 总用时-&gt;1703ms<br>可以看出速度明显高于前两种方法，因为方法三可以设置切片时间，根据浏览器的性能或者页面的实际交互情况来设置具体的切片时间。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端常见的设计模式</title>
      <link href="/2020/11/19/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/11/19/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>前端常见的9种设计模式<br><a id="more"></a></p><h1 id="前端常见的设计模式"><a href="#前端常见的设计模式" class="headerlink" title="前端常见的设计模式"></a>前端常见的设计模式</h1><p>之前写过一篇比较全的设计模式<a href="/2019/06/24/javascript设计模式/">点击查阅</a>。<br>这篇文章主要写几个前端平时常用的设计模式案例。</p><h2 id="设计模式类型"><a href="#设计模式类型" class="headerlink" title="设计模式类型"></a>设计模式类型</h2><p><img src="/2020/11/19/前端常见的设计模式/1.jpg" alt="img"><br>通过图片的结构展示，可以快速的理解和记忆。</p><h2 id="demo案例"><a href="#demo案例" class="headerlink" title="demo案例"></a>demo案例</h2><h3 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a>创建型</h3><h4 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h4><p>工厂模式根据抽象程度可分为三种，分别为简单工厂、工厂方法和抽象工厂。其核心在于将创建对象的过程封装其他，然后通过同一个接口创建新的对象。简单工厂模式又叫静态工厂方法，用来创建某一种产品对象的实例，用来创建单一对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单工厂</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (username, pwd, role) &#123;</span><br><span class="line">   <span class="keyword">this</span>.username = username;</span><br><span class="line">    <span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">    <span class="keyword">this</span>.role = role;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateRoleFactory</span> </span>&#123;</span><br><span class="line"> <span class="keyword">static</span> create (username, pwd, role) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Factory(username, pwd, role);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> admin = CreateRoleFactory.create(<span class="string">'张三'</span>, <span class="string">'222'</span>, <span class="string">'admin'</span>);</span><br></pre></td></tr></table></figure></p><p>在实际工作中，各用户角色所具备的能力是不同的，因此简单工厂是无法满足的，这时候就可以考虑使用工厂方法来代替。工厂方法的本意是将实际创建对象的工作推迟到子类中。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span> (name, menuAuth) &#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">new</span>.target === User) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'User 不能被实例化'</span>);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.menuAuth = menuAuth;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserFactory</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span> (...props) &#123;</span><br><span class="line">   <span class="keyword">super</span>(...props);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> create (role) &#123;</span><br><span class="line">   <span class="keyword">const</span> roleCollection = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">     [<span class="string">'admin'</span>, () =&gt; <span class="keyword">new</span> UserFactory(<span class="string">'管理员'</span>, [<span class="string">'首页'</span>, <span class="string">'个人中心'</span>])],</span><br><span class="line">      [<span class="string">'user'</span>, () =&gt; <span class="keyword">new</span> UserFactory(<span class="string">'普通用户'</span>, [<span class="string">'首页'</span>])]</span><br><span class="line">    ])</span><br><span class="line">    <span class="keyword">return</span> roleCollection.get(role)();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> admin = UserFactory.create(<span class="string">'admin'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(admin); <span class="comment">// &#123;name: "管理员", menuAuth: Array(2)&#125;</span></span><br><span class="line"><span class="keyword">const</span> user = UserFactory.create(<span class="string">'user'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(user); <span class="comment">// &#123;name: "普通用户", menuAuth: Array(1)&#125;</span></span><br></pre></td></tr></table></figure></p><p>随着业务形态的变化，一个用户可能在多个平台上同时存在，显然工厂方法也不再满足了，这时候就要用到抽象工厂。抽象工厂模式是对类的工厂抽象用来创建产品类簇，不负责创建某一类产品的实例。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (hospital) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.target === User) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'抽象类不能实例化!'</span>);</span><br><span class="line">    <span class="keyword">this</span>.hospital = hospital;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 浙一</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZheYiUser</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, departmentsAuth) &#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="string">'zheyi_hospital'</span>);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.departmentsAuth = departmentsAuth;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 萧山医院</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaoShanUser</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, departmentsAuth) &#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="string">'xiaoshan_hospital'</span>);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.departmentsAuth = departmentsAuth;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getAbstractUserFactory = <span class="function">(<span class="params">hospital</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (hospital) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'zheyi_hospital'</span>:</span><br><span class="line">      <span class="keyword">return</span> ZheYiUser;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'xiaoshan_hospital'</span>:</span><br><span class="line">      <span class="keyword">return</span> XiaoShanUser;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ZheYiUserClass = getAbstractUserFactory(<span class="string">'zheyi_hospital'</span>);</span><br><span class="line"><span class="keyword">const</span> XiaoShanUserClass = getAbstractUserFactory(<span class="string">'xiaoshan_hospital'</span>);</span><br><span class="line"><span class="keyword">const</span> user1 = <span class="keyword">new</span> ZheYiUserClass(<span class="string">'王医生'</span>, [<span class="string">'外科'</span>, <span class="string">'骨科'</span>, <span class="string">'神经外科'</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(user1);</span><br><span class="line"><span class="keyword">const</span> user2 = newXiaoShanUserClass(<span class="string">'王医生'</span>, [<span class="string">'外科'</span>, <span class="string">'骨科'</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(user2);</span><br></pre></td></tr></table></figure></p><p>小结： 构造函数和创建对象分离，符合开放封闭原则。<br>使用场景： 比如根据权限生成不同用户。</p><h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h4><p>单例模式理解起来比较简单，就是保证一个类只能存在一个实例，并提供一个访问它的全局接口。单例模式又分懒汉式和饿汉式两种，其区别在于懒汉式在调用的时候创建实例，而饿汉式则是在初始化就创建好实例，具体实现如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 懒汉式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single</span> </span>&#123;</span><br><span class="line"> <span class="keyword">static</span> getInstance () &#123;</span><br><span class="line">   <span class="keyword">if</span> (!Single.instance) &#123;</span><br><span class="line">     Single.instance = <span class="keyword">new</span> Single();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Single.instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> test1 = Single.getInstance();</span><br><span class="line"><span class="keyword">const</span> test2 = Single.getInstance();</span><br><span class="line"><span class="built_in">console</span>.log(test1 === test2); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 饿汉式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single</span> </span>&#123;</span><br><span class="line"> <span class="keyword">static</span> instance = <span class="keyword">new</span> Single();</span><br><span class="line">  <span class="keyword">static</span> getInstance () &#123;</span><br><span class="line">    <span class="keyword">return</span> Single.instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> test1 = Single.getInstance();</span><br><span class="line"><span class="keyword">const</span> test2 = Single.getInstance();</span><br><span class="line"><span class="built_in">console</span>.log(test1 === test2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p><p>小结： 实例如果存在，直接返回已创建的，符合开放封闭原则。<br>使用场景： Redux、Vuex 等状态管理工具，还有我们常用的 window 对象、全局缓存等。</p><h4 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h4><p>对于前端来说，原型模式在常见不过了。当新创建的对象和已有对象存在较大共性时，可以通过对象的复制来达到创建新的对象，这就是原型模式。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Object.create()实现原型模式</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line"> name: <span class="string">'zhangsan'</span>,</span><br><span class="line">  age: <span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> userOne = <span class="built_in">Object</span>.create(user);</span><br><span class="line"><span class="built_in">console</span>.log(userOne.__proto__); <span class="comment">// &#123;name: "zhangsan", age: 18&#125;</span></span><br><span class="line"><span class="comment">// 原型链继承实现原型模式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span> (name) &#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  getName () &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span> (name) &#123;</span><br><span class="line">   <span class="keyword">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">  setName (_name) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>.name = _name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> admin = <span class="keyword">new</span> Admin(<span class="string">'zhangsan'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(admin.getName());</span><br><span class="line"><span class="built_in">console</span>.log(admin.setName(<span class="string">'lisi'</span>));</span><br></pre></td></tr></table></figure></p><p>小结： 原型模式最简单的实现方式—Object.create()。<br>使用场景： 新创建对象和已有对象无较大差别时，可以使用原型模式来减少创建新对象的成本。</p><h3 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a>结构型</h3><h4 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h4><p>讲装饰器模式之前，先聊聊高阶函数。高阶函数就是一个函数就可以接收另一个函数作为参数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y, f</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> f(x) + f(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> num = add(<span class="number">2</span>, <span class="number">-2</span>, <span class="built_in">Math</span>.abs);</span><br><span class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure></p><p>函数 add 就是一个简单的高阶函数，而 add 相对于 Math.abs 来说相当于一个装饰器，因此这个例子也可以理解为一个简单的装饰器模式。在 react 中，高阶组件(HOC)也是装饰器模式的一种体现，通常用来不改变原来组件的情况下添加一些属性，达到组件复用的功能。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> BgHOC = <span class="function"><span class="params">WrappedComponent</span> =&gt;</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"> render () &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;div style=&#123;&#123; <span class="attr">background</span>: <span class="string">'blue'</span> &#125;&#125;&gt;</span><br><span class="line">       &lt;WrappedComponent /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><p>小结： 装饰器模式将现有对象和装饰器进行分离，两者独立存在，符合开放封闭原则和单一职责模式。<br>使用场景： es7 装饰器、vue mixins、core-decorators 等。</p><h4 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h4><p>适配器别名包装器，其作用是解决两个软件实体间的接口不兼容的问题。以 axios 源码为例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDefaultAdapter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> adapter;</span><br><span class="line">  <span class="comment">// 判断当前是否是 node 环境</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> process !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">Object</span>.prototype.toString.call(process) === <span class="string">'[object process]'</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果是 node 环境，调用 node 专属的 http 适配器</span></span><br><span class="line">    adapter = <span class="built_in">require</span>(<span class="string">'./adapters/http'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> XMLHttpRequest !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果是浏览器环境，调用基于 xhr 的适配器</span></span><br><span class="line">    adapter = <span class="built_in">require</span>(<span class="string">'./adapters/xhr'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// http adapter</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">httpAdapter</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">dispatchHttpRequest</span>(<span class="params">resolvePromise, rejectPromise</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// xhr adapter</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">xhrAdapter</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">dispatchXhrRequest</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>其目的就是保证 node 和浏览器环境的入参 config 一致，出参 Promise 都是同一个。<br>小结： 不改变原有接口的情况下，统一接口、统一入参、统一出参、统一规则，符合开发封闭原则。<br>使用场景 ：拥抱变化，兼容代码。</p><h4 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h4><p>代理模式就是为对象提供一个代理，用来控制对这个对象的访问。在我们业务开发中最常见的有四种代理类型：事件代理，虚拟代理、缓存代理和保护代理。本文主要介绍虚拟代理和缓存代理两类。提到虚拟代理，其最具代表性的例子就是图片预加载。预加载主要是为了避免网络延迟、或者图片太大引起页面长时间留白的问题。通常的解决方案是先给 img 标签展示一个占位图，然后创建一个 Image 实例，让这个实例的 src 指向真实的目标图片地址，当其真实图片加载完成之后，再将 DOM 上的 img 标签的 src 属性指向真实图片地址。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyImg</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span> (imgELe) &#123;</span><br><span class="line">   <span class="keyword">this</span>.imgELe = imgELe;</span><br><span class="line">    <span class="keyword">this</span>.DEFAULT_URL = <span class="string">'xxx'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setUrl (targetUrl) &#123;</span><br><span class="line">   <span class="keyword">this</span>.imgEle.src = <span class="keyword">this</span>.DEFAULT_URL;</span><br><span class="line">    <span class="keyword">const</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">    </span><br><span class="line">    image.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">this</span>.imgEle.src = targetUrl;</span><br><span class="line">    &#125;</span><br><span class="line">    image.src = targetUrl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>缓存代理常用于一些计算量较大的场景。当计算的值已经被出现过的时候，不需要进行第二次重复计算。以传参求和为例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> countSum = <span class="function">(<span class="params">...arg</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'count...'</span>);</span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">  arg.forEach(<span class="function"><span class="params">v</span> =&gt;</span> result += v);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proxyCountSum = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> cache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...arg</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> args = arg.join(<span class="string">','</span>);</span><br><span class="line">    <span class="keyword">if</span> (args <span class="keyword">in</span> cache) <span class="keyword">return</span> cache[args];</span><br><span class="line">    <span class="keyword">return</span> cache[args] = countSum(...arg);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)()</span><br><span class="line">proxyCountSum(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>); <span class="comment">// count...  10</span></span><br><span class="line">proxyCountSum(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure></p><p>小结： 通过修改代理类来增加功能，符合开放封闭模式。<br>使用场景： 图片预加载、缓存服务器、处理跨域以及拦截器等。</p><h3 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a>行为型</h3><h4 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h4><p>介绍策略模式之前，简单实现一个常见的促销活动规则：</p><ul><li>预售活动，全场 9.5 折</li><li>大促活动，全场 9 折</li><li>返场优惠，全场 8.5 折</li><li>限时优惠，全场 8 折</li></ul><p>人人喊打的 if-else<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> activity = <span class="function">(<span class="params">type, price</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">if</span> (type === <span class="string">'pre'</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> price * <span class="number">0.95</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'onSale'</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> price * <span class="number">0.9</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'back'</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> price * <span class="number">0.85</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'limit'</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> price * <span class="number">0.8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>以上代码存在肉眼可见的问题：大量 if-else、可扩展性差、违背开放封闭原则等。我们再使用策略模式优化：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> activity = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line"> [<span class="string">'pre'</span>, (price) =&gt; price * <span class="number">0.95</span>],</span><br><span class="line">  [<span class="string">'onSale'</span>, (price) =&gt; price * <span class="number">0.9</span>],</span><br><span class="line">  [<span class="string">'back'</span>, (price) =&gt; price * <span class="number">0.85</span>],</span><br><span class="line">  [<span class="string">'limit'</span>, (price) =&gt; price * <span class="number">0.8</span>]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> getActivityPrice = <span class="function">(<span class="params">type, price</span>) =&gt;</span> activity.get(type)(price);</span><br><span class="line"><span class="comment">// 新增新手活动</span></span><br><span class="line">activity.set(<span class="string">'newcomer'</span>, (price) =&gt; price * <span class="number">0.7</span>);</span><br></pre></td></tr></table></figure></p><p>小结： 定义一系列算法，将其一一封装起来，并且使它们可相互替换。符合开放封闭原则。<br>使用场景： 表单验证、存在大量 if-else 场景、各种重构等。</p><h4 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h4><p>观察者模式又叫发布-订阅模式，其用来定义对象之间的一对多依赖关系，以便当一个对象更改状态时，将通知其所有依赖关系。通过“别名”可以知道，观察者模式具备两个角色，即“发布者”和“订阅者”。正如我们工作中的产品经理就是一个“发布者”，而前后端、测试可以理解为“订阅者”。以产品经理建需求沟通群为例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义发布者类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers = [];</span><br><span class="line">    <span class="keyword">this</span>.prdState = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增加订阅者</span></span><br><span class="line">  add (observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.push(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 通知所有订阅者</span></span><br><span class="line">  notify () &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.forEach(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">      observer.update(<span class="keyword">this</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 该方法用于获取当前的 prdState</span></span><br><span class="line">  getState () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.prdState;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 该方法用于改变 prdState 的值</span></span><br><span class="line">  setState (state) &#123;</span><br><span class="line">    <span class="comment">// prd 的值发生改变</span></span><br><span class="line">    <span class="keyword">this</span>.prdState = state;</span><br><span class="line">    <span class="comment">// 需求文档变更，立刻通知所有开发者</span></span><br><span class="line">    <span class="keyword">this</span>.notify();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义订阅者类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">  <span class="keyword">this</span>.prdState = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  update (publisher) &#123;</span><br><span class="line">    <span class="comment">// 更新需求文档</span></span><br><span class="line">    <span class="keyword">this</span>.prdState = publisher.getState();</span><br><span class="line">    <span class="comment">// 调用工作函数</span></span><br><span class="line">    <span class="keyword">this</span>.work();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// work 方法，一个专门搬砖的方法</span></span><br><span class="line">  work () &#123;</span><br><span class="line">    <span class="comment">// 获取需求文档</span></span><br><span class="line">    <span class="keyword">const</span> prd = <span class="keyword">this</span>.prdState;</span><br><span class="line">    <span class="built_in">console</span>.log(prd);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建订阅者：前端开发小王</span></span><br><span class="line"><span class="keyword">const</span> wang = <span class="keyword">new</span> Observer();</span><br><span class="line"><span class="comment">// 创建订阅者：后端开发小张</span></span><br><span class="line"><span class="keyword">const</span> zhang = <span class="keyword">new</span> Observer();</span><br><span class="line"><span class="comment">// 创建发布者：产品经理小曾</span></span><br><span class="line"><span class="keyword">const</span> zeng = <span class="keyword">new</span> Publisher();</span><br><span class="line"><span class="comment">// 需求文档</span></span><br><span class="line"><span class="keyword">const</span> prd = &#123;</span><br><span class="line">  url: <span class="string">'xxxxxxx'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 小曾开始拉人入群</span></span><br><span class="line">zeng.add(wang);</span><br><span class="line">zeng.add(zhang);</span><br><span class="line"><span class="comment">// 小曾发布需求文档并通知所有人</span></span><br><span class="line">zeng.setState(prd);</span><br></pre></td></tr></table></figure></p><p>经常使用 Event Bus(Vue) 和 Event Emitter(node)会发现，发布-订阅模式和观察者模式还是存在着细微差别，即所有事件的发布/订阅都不能由发布者和订阅者“私下联系”，需要委托事件中心处理。以 Vue Event Bus 为例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">const</span> EventBus = <span class="keyword">new</span> Vue();</span><br><span class="line">Vue.prototype.$bus = EventBus;</span><br><span class="line"><span class="comment">// 订阅事件</span></span><br><span class="line"><span class="keyword">this</span>.$bus.$on(<span class="string">'testEvent'</span>, func);</span><br><span class="line"><span class="comment">// 发布/触发事件</span></span><br><span class="line"><span class="keyword">this</span>.$bus.$emit(<span class="string">'testEvent'</span>, params);</span><br></pre></td></tr></table></figure></p><p>整个过程都是 this.$bus 这个“事件中心”在处理。<br>小结： 为解耦而生，为事件而生，符合开放封闭原则。<br>使用场景： 跨层级通信、事件绑定等。</p><h4 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h4><p>迭代器模式号称“遍历专家”，它提供一种方法顺序访问一个聚合对象中的各个元素，且不暴露该对象的内部表示。迭代器又分内部迭代器（jquery.each/for…of）和外部迭代器（es6 yield）。在 es6 之前，直接通过 forEach 遍历 DOM NodeList 和函数的 arguments 对象，都会直接报错，其原因都是因为他们都是类数组对象。对此 jquery 很好的兼容了这一点。在 es6 中，它约定只要数据类型具备 Symbol.iterator 属性，就可以被 for…of 循环和迭代器的 next 方法遍历。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> arg = <span class="built_in">arguments</span>;</span><br><span class="line">  <span class="keyword">const</span> iterator = arg[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">  <span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure></p><p>通过 es6 内置生成器 Generator 实现迭代器并没什么难度，这里重点通 es5 实现迭代器：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iteratorGenerator</span> (<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// len 记录传入集合的长度</span></span><br><span class="line">  <span class="keyword">var</span> len = list.length;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 自定义 next 方法</span></span><br><span class="line">    next: funciton () &#123;</span><br><span class="line">      <span class="comment">// 如果索引还没有超出集合长度，done 为 false</span></span><br><span class="line">      <span class="keyword">var</span> done = index &gt;= len;</span><br><span class="line">      <span class="comment">// 如果 done 为 false，则可以继续取值</span></span><br><span class="line">      <span class="keyword">var</span> value = !done ? list[index++] : <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">// 将当前值与遍历是否完毕（done）返回</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> iterator = iteratorGenerator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure></p><p>小结： 实现统一遍历接口，符合单一功能和开放封闭原则。<br>使用场景： 有遍历的地方就有迭代器。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>设计模式的难，在于它的抽象和分散。抽象在于每一设计模式看例子都很好理解，真正使用起来却不知所措；分散则是出现一个场景发现好几种设计模式都能实现。而解决抽象的最好办法就是动手实践，在业务开发中探索使用它们的可能性。本文大致介绍了前端领域常见的 9 种设计模式，相信大家在理解的同时也不难发现，设计模式始终围绕着“封装变化”来提供代码的可读性、扩展性、易维护性。所以当我们工作生活中，始终保持“封装变化”的思想的时候，就已经开始体会到设计模式精髓了。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web安全之外链target=_blank</title>
      <link href="/2020/08/28/web%E5%AE%89%E5%85%A8%E4%B9%8B%E5%A4%96%E9%93%BEtarget-blank/"/>
      <url>/2020/08/28/web%E5%AE%89%E5%85%A8%E4%B9%8B%E5%A4%96%E9%93%BEtarget-blank/</url>
      
        <content type="html"><![CDATA[<p>web安全之外链target=”_blank”<br><a id="more"></a></p><h1 id="web安全之外链target-blank"><a href="#web安全之外链target-blank" class="headerlink" title="web安全之外链target=_blank"></a>web安全之外链target=_blank</h1><p>网页里的a标签默认在当前窗口跳转链接地址，如果需要在新窗口打开，需要给 a 标签添加一个target=”_blank”属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">"http://baidu.com/"</span> target=<span class="string">"_blank"</span>&gt;百度&lt;<span class="regexp">/a&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="安全隐患"><a href="#安全隐患" class="headerlink" title="安全隐患"></a>安全隐患</h2><p>如果只是加上target=”_blank”，打开新窗口后，新页面能通过window.opener获取到来源页面的window对象，即使跨域也一样。虽然跨域的页面对于这个对象的属性访问有所限制，但还是有漏网之鱼。</p><p>可以看到window.opener的一些属性，某些属性的访问被拦截，是因为跨域安全策略的限制。</p><p>即便如此，还是给一些操作留下可乘之机。比如修改window.opener.location的值，指向另外一个地址。你想想看，刚刚还是在某个网站浏览，随后打开了新窗口，结果这个新窗口神不知鬼不觉地把原来的网页地址改了。这个可以用来做什么？钓鱼啊！等你回到那个钓鱼页面，已经伪装成登录页，你可能就稀里糊涂把账号密码输进去了。</p><p>还有一种玩法，如果你处于登录状态，有些操作可能只是发送一个GET请求就完事了。通过修改地址，就执行了非你本意的操作，其实就是 CSRF 攻击。</p><h2 id="性能问题"><a href="#性能问题" class="headerlink" title="性能问题"></a>性能问题</h2><p>除了安全隐患外，还有可能造成性能问题。通过target=”_blank”打开的新窗口，跟原来的页面窗口共用一个进程。如果这个新页面执行了一大堆性能不好的 JavaScript 代码，占用了大量系统资源，那你原来的页面也会受到池鱼之殃。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>尽量不使用target=”_blank”，如果一定要用，需要加上rel=”noopener”或者rel=”noreferrer”。这样新窗口的window.openner就是null了，而且会让新窗口运行在独立的进程里，不会拖累原来页面的进程。不过，有些浏览器对性能做了优化，即使不加这个属性，新窗口也会在独立进程打开。不过为了安全考虑，还是加上吧。</p><p>我特意用自己的博客网站 <a href="http://www.kaysonli.com/" target="_blank" rel="noopener">http://www.kaysonli.com/</a> 试了一下，点击里面的外链打开新页面，window.openner都是null。查看页面元素发现，a标签都加上了 rel=”noreferrer”。博客是用 Hexo 生成的，看来这种设置已经成了基本常识了。</p><p>另外，对于通过window.open的方式打开的新页面，可以这样做：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> yourWindow = <span class="built_in">window</span>.open();</span><br><span class="line">yourWindow.opener = <span class="literal">null</span>;</span><br><span class="line">yourWindow.location = <span class="string">"http://someurl.here"</span>;</span><br><span class="line">yourWindow.target = <span class="string">"_blank"</span>;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js操作伪元素</title>
      <link href="/2020/08/06/js%E6%93%8D%E4%BD%9C%E4%BC%AA%E5%85%83%E7%B4%A0/"/>
      <url>/2020/08/06/js%E6%93%8D%E4%BD%9C%E4%BC%AA%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<p>javascript操作伪元素<br><a id="more"></a></p><h1 id="js操作伪元素"><a href="#js操作伪元素" class="headerlink" title="js操作伪元素"></a>js操作伪元素</h1><p>日常开发中，伪元素使用频率很高，今天说一说如何使用js动态的改变伪元素样式。<br>对于普通的元素，要改变其样式，获取它的节点，再使用style[属性名]便可以改变其样式，但是伪元素使用这种方式是不行的。<br>只能使用css设置的模式，也就是改变css的样式，如果用js来改变css的样式相对复杂，所以改用添加新的css样式，再更换伪元素className方式来做。<br>细节见demo代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  * &#123;</span><br><span class="line">    margin: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;style&gt;</span></span><br><span class="line"><span class="regexp">  .wrap &#123;</span></span><br><span class="line"><span class="regexp">    width: 300px;</span></span><br><span class="line"><span class="regexp">    margin: 20px auto;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  .content-style1::before &#123;</span></span><br><span class="line"><span class="regexp">    content: attr(data-content);</span></span><br><span class="line"><span class="regexp">    font-size: 32px;</span></span><br><span class="line"><span class="regexp">    color: red;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  .btns &#123;</span></span><br><span class="line"><span class="regexp">    margin: 20px 0;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;h1&gt;js操作伪类&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div class="content-style1" data-content="伪类内容"&gt;&lt;/</span>div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"btns"</span>&gt;</span><br><span class="line">      &lt;button id=<span class="string">"btn1"</span> onclick=<span class="string">"onBtn1()"</span>&gt;方式一&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button id="btn1" onclick="onBtn2()"&gt;方式二&lt;/</span>button&gt;</span><br><span class="line">      &lt;button id=<span class="string">"btn1"</span> onclick=<span class="string">"onBtn3()"</span>&gt;改变伪类的内容&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> nDiv = <span class="built_in">document</span>.querySelector(<span class="string">'.content-style1'</span>);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onBtn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个style节点</span></span><br><span class="line">    <span class="keyword">var</span> nStyle = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span><br><span class="line">    <span class="comment">// 创建一个文本节点</span></span><br><span class="line">    <span class="keyword">var</span> nStyleText = <span class="built_in">document</span>.createTextNode(<span class="string">'.content-style2::before&#123;content: attr(data-content);color:blue;&#125;'</span>);</span><br><span class="line">    nStyle.appendChild(nStyleText);</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(nStyle);</span><br><span class="line">    <span class="comment">// 删除添加类名</span></span><br><span class="line">    removeClass(nDiv, <span class="string">'content-style1'</span>);</span><br><span class="line">    addClass(nDiv, <span class="string">'content-style2'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onBtn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> styleSheets = <span class="built_in">document</span>.styleSheets[<span class="number">1</span>]; <span class="comment">// 获取样式表引用</span></span><br><span class="line">    <span class="keyword">var</span> index = styleSheets.rules.length;  <span class="comment">// 获取样式表中包含样式的个数</span></span><br><span class="line">    <span class="keyword">if</span>(styleSheets.insertRule)&#123;  <span class="comment">// 判断浏览器是否支持insertRule()方法</span></span><br><span class="line">      styleSheets.insertRule(<span class="string">'.content-style3::before&#123;content: attr(data-content);color:green;&#125;'</span>, index);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  <span class="comment">// 如果哦浏览器不支持insertRule()方法</span></span><br><span class="line">      styleSheets.addRule(<span class="string">'.content-style3::before'</span>, <span class="string">'content: attr(data-content);color:green;'</span>, index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除添加类名</span></span><br><span class="line">    removeClass(nDiv, <span class="string">'content-style1'</span>);</span><br><span class="line">    addClass(nDiv, <span class="string">'content-style3'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 不处理样式，只改变伪类content的内容</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onBtn3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    nDiv.setAttribute(<span class="string">'data-content'</span>, <span class="string">'js改变内容'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 工具函数</span></span><br><span class="line"><span class="regexp">  function addClass(ele, className) &#123;</span></span><br><span class="line"><span class="regexp">    ele.classList.add(className);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  function removeClass(ele, className) &#123;</span></span><br><span class="line"><span class="regexp">    ele.classList.remove(className);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure></p><p>以上只是简单的列举。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 样式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5长按图片自定义菜单</title>
      <link href="/2020/07/28/h5%E9%95%BF%E6%8C%89%E5%9B%BE%E7%89%87%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95/"/>
      <url>/2020/07/28/h5%E9%95%BF%E6%8C%89%E5%9B%BE%E7%89%87%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<p>移动端页面，长按图片，弹出自定义菜单<br><a id="more"></a></p><h1 id="h5长按图片自定义菜单"><a href="#h5长按图片自定义菜单" class="headerlink" title="h5长按图片自定义菜单"></a>h5长按图片自定义菜单</h1><h2 id="我们平时在使用浏览器访问网页时，有图片的场景，长按图片："><a href="#我们平时在使用浏览器访问网页时，有图片的场景，长按图片：" class="headerlink" title="我们平时在使用浏览器访问网页时，有图片的场景，长按图片："></a>我们平时在使用浏览器访问网页时，有图片的场景，长按图片：</h2><p>浏览器：<br><img src="/2020/07/28/h5长按图片自定义菜单/2.png" alt="img"><br>微信:<br><img src="/2020/07/28/h5长按图片自定义菜单/1.png" alt="img"><br>自定义：<br><img src="/2020/07/28/h5长按图片自定义菜单/3.png" alt="img"></p><h2 id="阻止浏览器默认图片长按事件"><a href="#阻止浏览器默认图片长按事件" class="headerlink" title="阻止浏览器默认图片长按事件"></a>阻止浏览器默认图片长按事件</h2><h3 id="css方法"><a href="#css方法" class="headerlink" title="css方法"></a>css方法</h3><p>给指定的图片加上css样式后，可以阻止浏览器的图片默认长按事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">img &#123;</span><br><span class="line">  pointer-events:none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="蒙层方法"><a href="#蒙层方法" class="headerlink" title="蒙层方法"></a>蒙层方法</h3><p>在图片上加一个蒙层，给这个蒙层加长按事件。<br>之后就可以根据需求，给指定图片加上长按事件，自己制作一个菜单，弹出显示。<br>这里使用了alloy-finger.js库添加长按事件</p><h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    *&#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    #div_1 &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100px;</span><br><span class="line">      background: #cccccc;</span><br><span class="line">    &#125;</span><br><span class="line">    #img_1 img &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      pointer-events:none;</span><br><span class="line">    &#125;</span><br><span class="line">    #img_2 &#123;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">    #img_2 img &#123;</span><br><span class="line">      width: 50%;</span><br><span class="line">    &#125;</span><br><span class="line">    #img_3 &#123;</span><br><span class="line">      position: relative;</span><br><span class="line">    &#125;</span><br><span class="line">    #img_3 img, #img_3 .mask &#123;</span><br><span class="line">      width: 150px;</span><br><span class="line">      height: 150px;</span><br><span class="line">    &#125;</span><br><span class="line">    #img_3 .mask &#123;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: 0;</span><br><span class="line">      left: 0;</span><br><span class="line">      background: rgba(0, 0, 0, .3);</span><br><span class="line">      color: red;</span><br><span class="line">      font-size: 30px;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">    #modal &#123;</span><br><span class="line">      display: none;</span><br><span class="line">      position: absolute;</span><br><span class="line">      box-shadow: 1px 1px 2px 1px rgba(0, 0, 0, .3);</span><br><span class="line">      width: 150px;</span><br><span class="line">      background: #ffffff;</span><br><span class="line">    &#125;</span><br><span class="line">    #modal p &#123;</span><br><span class="line">      padding-left: 20px;</span><br><span class="line">      line-height: 30px;</span><br><span class="line">      border-bottom: 1px solid #cccccc;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;img_1&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;./img.jpg&quot; alt=&quot;&quot; srcset=&quot;&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div id=&quot;div_1&quot;&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div id=&quot;img_2&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;./code.png&quot; alt=&quot;&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div id=&quot;img_3&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;./code.png&quot; alt=&quot;&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;mask&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div id=&quot;modal&quot;&gt;</span><br><span class="line">    &lt;p&gt;菜单项1&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;菜单项2&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;菜单项3&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;./alloy-finger.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./vconsole.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var nModal = document.querySelector(&apos;#modal&apos;);</span><br><span class="line">  var vConsole = new VConsole();</span><br><span class="line">  new AlloyFinger(&apos;#img_1&apos;, &#123;</span><br><span class="line">    longTap: function (ev) &#123;</span><br><span class="line">      showModal(ev);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  new AlloyFinger(&apos;#img_2 img&apos;, &#123;</span><br><span class="line">    longTap: function (ev) &#123;</span><br><span class="line">      showModal(ev);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  new AlloyFinger(&apos;#img_3&apos;, &#123;</span><br><span class="line">    longTap: function (ev) &#123;</span><br><span class="line">      showModal(ev);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // 显示长按modal</span><br><span class="line"> function showModal(ev) &#123;</span><br><span class="line">   var pointer = ev.touches[0];</span><br><span class="line">   nModal.style.display = &apos;block&apos;;</span><br><span class="line">   nModal.style.top = pointer.pageY + &apos;px&apos;;</span><br><span class="line">   nModal.style.left = pointer.pageX + &apos;px&apos;;</span><br><span class="line"> &#125;</span><br><span class="line"> // 隐藏modal</span><br><span class="line"> function hideModal() &#123;</span><br><span class="line">  nModal.style.display = &apos;none&apos;;</span><br><span class="line"> &#125;</span><br><span class="line"> // modal菜单加事件</span><br><span class="line"> document.querySelector(&apos;#modal&apos;).addEventListener(&apos;click&apos;, function(ev) &#123;</span><br><span class="line">   hideModal();</span><br><span class="line">   alert(&apos;点击了&apos; + ev.target.innerText);</span><br><span class="line"> &#125;, false);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>the-super-tiny-compiler</title>
      <link href="/2020/07/20/the-super-tiny-compiler/"/>
      <url>/2020/07/20/the-super-tiny-compiler/</url>
      
        <content type="html"><![CDATA[<p>一个极简编译器<br><a id="more"></a></p><h1 id="the-super-tiny-compiler"><a href="#the-super-tiny-compiler" class="headerlink" title="the-super-tiny-compiler"></a>the-super-tiny-compiler</h1><p>现在我们在开发中一定会使用到babel这个编译器，它可以把JavaScript代码解析成ast语法树，进而处理代码。<br>the-super-tiny-compiler 是一个非常简单的代码解析器，通过它可以了解babel的工作原理。<br><a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">the-super-tiny-compiler</a><br><a href="https://github.com/YongzeYao/the-super-tiny-compiler-CN" target="_blank" rel="noopener">the-super-tiny-compiler-CN</a><br>中文注释代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 今天我们会一起编写一个编译器。一个非常非常简化的微型编译器！这个编译器非常小，如果你移除这个</span></span><br><span class="line"><span class="comment"> * 文件里的注释，那么这个文件只剩下大概200行代码。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 我们会将类似于LISP的函数调用编译成类似于C的函数调用。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 如果你对这两个语言中的一个或者两个不熟悉。下面是一个快速的介绍。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 如果我有两个函数`add`和`subtract`，它们会像下面这样被写出来：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                  LISP                      C</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   2 + 2          (add 2 2)                 add(2, 2)</span></span><br><span class="line"><span class="comment"> *   4 - 2          (subtract 4 2)            subtract(4, 2)</span></span><br><span class="line"><span class="comment"> *   2 + (4 - 2)    (add 2 (subtract 4 2))    add(2, subtract(4, 2))</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 非常简单直观不是吗？</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 非常好，因为这就是我们要编译的代码。尽管这并不是一个完整的LISP或者C的编译器，但是它足够展示</span></span><br><span class="line"><span class="comment"> * 现代编译器的很多大部分组成部件。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 大部分编译器的工作可以被分解为三个主要阶段：解析（Parsing），转化（Transformation）以及</span></span><br><span class="line"><span class="comment"> * 代码生成（Code Generation）。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. *解析* 将源代码转换为一个更抽象的形式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. *转换* 接受解析产生的抽象形式并且操纵这些抽象形式做任何编译器想让它们做的事。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3. *代码生成* 基于转换后的代码表现形式（code representation）生成目标代码。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析</span></span><br><span class="line"><span class="comment"> * -------</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 解析一般被分为两个部分：词法分析和语法分析。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. *词法分析* 通过一个叫做tokenizer（词素生成器，也叫lexer）的工具将源代码分解成一个个词素。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *    词素是描述编程语言语法的对象。它可以描述数字，标识符，标点符号，运算符等等。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. *语法分析* 接收词素并将它们组合成一个描述了源代码各部分之间关系的中间表达形式：抽象语法树。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *    抽象语法树是一个深度嵌套的对象，这个对象以一种既能够简单地操作又提供很多关于源代码信息的形式</span></span><br><span class="line"><span class="comment"> *    来展现代码。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 看下面的代码:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   (add 2 (subtract 4 2))</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 上面代码产生的词素会像下面这样：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   [</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'paren',  value: '('        &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'name',   value: 'add'      &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'number', value: '2'        &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'paren',  value: '('        &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'name',   value: 'subtract' &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'number', value: '4'        &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'number', value: '2'        &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'paren',  value: ')'        &#125;,</span></span><br><span class="line"><span class="comment"> *     &#123; type: 'paren',  value: ')'        &#125;,</span></span><br><span class="line"><span class="comment"> *   ]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 而产生的抽象语法树会像下面这样：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   &#123;</span></span><br><span class="line"><span class="comment"> *     type: 'Program',</span></span><br><span class="line"><span class="comment"> *     body: [&#123;</span></span><br><span class="line"><span class="comment"> *       type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *       name: 'add',</span></span><br><span class="line"><span class="comment"> *       params: [&#123;</span></span><br><span class="line"><span class="comment"> *         type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *         value: '2',</span></span><br><span class="line"><span class="comment"> *       &#125;, &#123;</span></span><br><span class="line"><span class="comment"> *         type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *         name: 'subtract',</span></span><br><span class="line"><span class="comment"> *         params: [&#123;</span></span><br><span class="line"><span class="comment"> *           type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *           value: '4',</span></span><br><span class="line"><span class="comment"> *         &#125;, &#123;</span></span><br><span class="line"><span class="comment"> *           type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *           value: '2',</span></span><br><span class="line"><span class="comment"> *         &#125;]</span></span><br><span class="line"><span class="comment"> *       &#125;]</span></span><br><span class="line"><span class="comment"> *     &#125;]</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转换</span></span><br><span class="line"><span class="comment"> * --------------</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 编译器的下一个阶段是转换阶段。再回顾一遍，这个过程接收解析生成的抽象语法树并对它做出改动。</span></span><br><span class="line"><span class="comment"> * 转换阶段可以改变抽象语法树使代码保持在同一个语言（例如Babel，Babel接收的是JS代码生成的也是</span></span><br><span class="line"><span class="comment"> * JS代码），或者编译成另外一门语言。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 让我们一起来看如何转换一个抽象语法树。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 你可能会注意到我们的抽象语法树包含了长得非常相似的元素。观察那些含有type属性的元素。这些元素</span></span><br><span class="line"><span class="comment"> * 被称为抽象语法树的节点。每一个节点都描述了源代码中的一部分。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 针对NumberLiteral我们有一个节点：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   &#123;</span></span><br><span class="line"><span class="comment"> *     type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *     value: '2',</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 针对CallExpression我们也有一个节点：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   &#123;</span></span><br><span class="line"><span class="comment"> *     type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *     name: 'subtract',</span></span><br><span class="line"><span class="comment"> *     params: [...nested nodes go here...],</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在转换抽象语法树的时候，我们可以通过添加/删除/替换节点属性来操纵节点。我们也可以添加节点，</span></span><br><span class="line"><span class="comment"> * 删除节点，或者基于现有的抽象语法树创建一个全新的抽象语法树。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 由于我们的编译目标是另外一门语言，所以我们集中注意力新建一个针对目标语言的全新抽象语法树。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 遍历</span></span><br><span class="line"><span class="comment"> * ---------</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 为了处理节点，我们需要遍历它们。这个遍历的过程按照深度优先规则遍历每一个节点。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   &#123;</span></span><br><span class="line"><span class="comment"> *     type: 'Program',</span></span><br><span class="line"><span class="comment"> *     body: [&#123;</span></span><br><span class="line"><span class="comment"> *       type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *       name: 'add',</span></span><br><span class="line"><span class="comment"> *       params: [&#123;</span></span><br><span class="line"><span class="comment"> *         type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *         value: '2'</span></span><br><span class="line"><span class="comment"> *       &#125;, &#123;</span></span><br><span class="line"><span class="comment"> *         type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *         name: 'subtract',</span></span><br><span class="line"><span class="comment"> *         params: [&#123;</span></span><br><span class="line"><span class="comment"> *           type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *           value: '4'</span></span><br><span class="line"><span class="comment"> *         &#125;, &#123;</span></span><br><span class="line"><span class="comment"> *           type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *           value: '2'</span></span><br><span class="line"><span class="comment"> *         &#125;]</span></span><br><span class="line"><span class="comment"> *       &#125;]</span></span><br><span class="line"><span class="comment"> *     &#125;]</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 所以针对上面这个抽象语法树我们会按照下面步骤遍历节点：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. Program - 从抽象语法树的最顶端开始</span></span><br><span class="line"><span class="comment"> *   2. CallExpression (add) - 移动到Program的body属性中的第一个元素</span></span><br><span class="line"><span class="comment"> *   3. NumberLiteral (2) - 移动到CallExpression的params中的第一个元素</span></span><br><span class="line"><span class="comment"> *   4. CallExpression (subtract) - 移动到CallExpression的params中的第二个元素</span></span><br><span class="line"><span class="comment"> *   5. NumberLiteral (4) - 移动到CallExpression的params中的第一个元素</span></span><br><span class="line"><span class="comment"> *   6. NumberLiteral (2) - 移动到CallExpression的params中的第二个元素</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 如果我们直接操纵这个抽象语法树，而不是创建一个新的抽象语法树，那么我们就需要在这个步骤使用到</span></span><br><span class="line"><span class="comment"> * 很多不同的抽象概念。然而为了满足我们的需求，在这一步我们仅仅需要访问抽象语法树中的每一个节点</span></span><br><span class="line"><span class="comment"> * 即可。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The reason I use the word "visiting" is because there is this pattern of how</span></span><br><span class="line"><span class="comment"> * to represent operations on elements of an object structure.</span></span><br><span class="line"><span class="comment"> * 在这里我使用“访问”这个词的与原因是因为存在着下面这个用来表示一个对象结构中元素行为的模式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 访问者</span></span><br><span class="line"><span class="comment"> * --------</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 基本的思想是我们会创建一个“访问者”对象，这个访问者对象有不同的方法来接受不同的节点类型。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   var visitor = &#123;</span></span><br><span class="line"><span class="comment"> *     NumberLiteral() &#123;&#125;,</span></span><br><span class="line"><span class="comment"> *     CallExpression() &#123;&#125;,</span></span><br><span class="line"><span class="comment"> *   &#125;;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 当我们遍历抽象语法树的时候，我们会根据现在“进入”的节点的类型调用访问者对象相对应的方法。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 为了使这个对象能够正常工作，我们需要传入当前节点以及当前节点的父节点的引用。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   var visitor = &#123;</span></span><br><span class="line"><span class="comment"> *     NumberLiteral(node, parent) &#123;&#125;,</span></span><br><span class="line"><span class="comment"> *     CallExpression(node, parent) &#123;&#125;,</span></span><br><span class="line"><span class="comment"> *   &#125;;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 然而，也存在着在“离开”节点的时候调用方法的可能性。假设我们有以下的抽象语法树结构：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Program</span></span><br><span class="line"><span class="comment"> *     - CallExpression</span></span><br><span class="line"><span class="comment"> *       - NumberLiteral</span></span><br><span class="line"><span class="comment"> *       - CallExpression</span></span><br><span class="line"><span class="comment"> *         - NumberLiteral</span></span><br><span class="line"><span class="comment"> *         - NumberLiteral</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 当我们向下遍历语法树的时候，我们会碰到所谓的叶子节点。我们在处理完一个节点后会“离开”这个节点。</span></span><br><span class="line"><span class="comment"> * 所以向下遍历树的时候我们“进入”节点，而向上返回的时候我们“离开”节点。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   -&gt; Program (enter)</span></span><br><span class="line"><span class="comment"> *     -&gt; CallExpression (enter)</span></span><br><span class="line"><span class="comment"> *       -&gt; Number Literal (enter)</span></span><br><span class="line"><span class="comment"> *       &lt;- Number Literal (exit)</span></span><br><span class="line"><span class="comment"> *       -&gt; Call Expression (enter)</span></span><br><span class="line"><span class="comment"> *          -&gt; Number Literal (enter)</span></span><br><span class="line"><span class="comment"> *          &lt;- Number Literal (exit)</span></span><br><span class="line"><span class="comment"> *          -&gt; Number Literal (enter)</span></span><br><span class="line"><span class="comment"> *          &lt;- Number Literal (exit)</span></span><br><span class="line"><span class="comment"> *       &lt;- CallExpression (exit)</span></span><br><span class="line"><span class="comment"> *     &lt;- CallExpression (exit)</span></span><br><span class="line"><span class="comment"> *   &lt;- Program (exit)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 为了支持上面所讲的功能，我们的访问者对象的最终形态如下：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   var visitor = &#123;</span></span><br><span class="line"><span class="comment"> *     NumberLiteral: &#123;</span></span><br><span class="line"><span class="comment"> *       enter(node, parent) &#123;&#125;,</span></span><br><span class="line"><span class="comment"> *       exit(node, parent) &#123;&#125;,</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代码生成</span></span><br><span class="line"><span class="comment"> * ---------------</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 编译器的最后步骤是代码生成。有时候编译器在这个步骤也会执行转换阶段的一些行为，但是大体而言代</span></span><br><span class="line"><span class="comment"> * 码生成阶段的工作就是基于转换步骤产生的抽象语法树生成目标代码。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 代码生成器的工作方式多种多样，一些编译器会重新利用更早阶段产生的词素，还有一些编译器会创建一</span></span><br><span class="line"><span class="comment"> * 个独立的代码表达形式从而能够线性地打印节点，但是基于我的经验大部分编译器会使用我们刚刚创造的</span></span><br><span class="line"><span class="comment"> * 那个抽象语法树，这也是我们接下来讲的方法。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 一个有效的代码生成器知道如何“打印”抽象语法树不同类型的节点，并且会递归地调用自己来打印嵌套的</span></span><br><span class="line"><span class="comment"> * 节点直到整个语法树被打印成一长串完整的代码字符串。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上面所讲到的就是编译器的所有不同部分了。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这并不表明所有编译器都像我上面描述的那样工作。不同的编译器有各种各样不同的目的，它们可能需要</span></span><br><span class="line"><span class="comment"> * 一些我没有讲到的步骤。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 但是现在你应该已经有了一个编译器如何工作的大体概念了。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 既然现在我已经解释了所有东西，你就可以立马动手写一个你自己的编译器了不是吗？</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 开个玩笑，我会帮助你理解如何写一个编译器 :P。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 那么我们开始吧……</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                                   (/^▽^)/</span></span><br><span class="line"><span class="comment"> *                                THE TOKENIZER!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们从解析步骤的第一个部分开始，词法分析。也就是tokenizer词素生成器的工作。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 我们将源代码分解成一个词素数组。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   (add 2 (subtract 4 2))   =&gt;   [&#123; type: 'paren', value: '(' &#125;, ...]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们首先需要接收一个代码字符串，并且我们需要设置两个变量……</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenizer</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// `current`变量跟踪我们现在在源代码中的什么地方，就像一个光标一样。</span></span><br><span class="line">  <span class="keyword">let</span> current = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `tokens`变量，顾名思义，用来储存词素的数组。</span></span><br><span class="line">  <span class="keyword">let</span> tokens = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 我们从创建一个`while`循环开始，在这个循环里我们会根据需求增加`current`变量的值。</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 注意由于词素的长度不同的，我们可能需要在一次循环中多次增加`current`的值。</span></span><br><span class="line">  <span class="keyword">while</span> (current &lt; input.length) &#123;</span><br><span class="line">    <span class="comment">// 我们将input中的当前字符存到char变量中。</span></span><br><span class="line">    <span class="keyword">let</span> char = input[current];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们需要检测的第一个情况就是开括号，这在之后会被函数调用`CallExpression`所用到。但是</span></span><br><span class="line">    <span class="comment">// 现在我们只需要关心字符即可。</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 我们检测我们是否有一个开括号：</span></span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">'('</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果我们有一个开括号，我们创建一个类型为`paren`的词素并将value设置为开括号。</span></span><br><span class="line">      tokens.push(&#123;</span><br><span class="line">        type: <span class="string">'paren'</span>,</span><br><span class="line">        value: <span class="string">'('</span>,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 之后我们增加`current`</span></span><br><span class="line">      current++;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 然后我们继续进行下一个循环</span></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接下来我们需要检测的是闭括号。这里的行为和开括号的一模一样：检查是否是一个闭括号，如果是</span></span><br><span class="line">    <span class="comment">// 的话，创建一个新词素，增加`current`然后执行下一个循环。</span></span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">')'</span>) &#123;</span><br><span class="line">      tokens.push(&#123;</span><br><span class="line">        type: <span class="string">'paren'</span>,</span><br><span class="line">        value: <span class="string">')'</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      current++;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接下来我们需要检测得是空格。这非常有趣，因为空格只是为了易读性而被添加的，所以我们并不需</span></span><br><span class="line">    <span class="comment">// 要将其储存为一个词素。我们简单地不管它就好。</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 所以这里我们仅仅检测当前字符是否是一个空格，如果是的话我们直接继续下一个循环。</span></span><br><span class="line">    <span class="keyword">let</span> WHITESPACE = <span class="regexp">/\s/</span>;</span><br><span class="line">    <span class="keyword">if</span> (WHITESPACE.test(char)) &#123;</span><br><span class="line">      current++;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下一个词素类型是数字。这和我们之前碰到的情况都不一样，因为一个数字可能包含任意数量的字符。</span></span><br><span class="line">    <span class="comment">// 我们需要捕获数字的所有字符来创建一个词素。</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   (add 123 456)</span></span><br><span class="line">    <span class="comment">//        ^^^ ^^^</span></span><br><span class="line">    <span class="comment">//        上面代码中数字只构成了两个词素</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 所以我们在碰到一个序列中的第一个数字的时候开始下面的步骤。</span></span><br><span class="line">    <span class="keyword">let</span> NUMBERS = <span class="regexp">/[0-9]/</span>;</span><br><span class="line">    <span class="keyword">if</span> (NUMBERS.test(char)) &#123;</span><br><span class="line">      <span class="comment">// 我们会创造一个`value`字符串，这个字符串用来存储字符。</span></span><br><span class="line">      <span class="keyword">let</span> value = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 之后我们遍历序列中的每一个字符直到遇到一个不是数字的字符，把每一个字符添加到`value`</span></span><br><span class="line">      <span class="comment">// 字符串中并且增加`current`的值。</span></span><br><span class="line">      <span class="keyword">while</span> (NUMBERS.test(char)) &#123;</span><br><span class="line">        value += char;</span><br><span class="line">        char = input[++current];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 之后我们将我们的数字词素添加到`tokens`数组。</span></span><br><span class="line">      tokens.push(&#123; <span class="attr">type</span>: <span class="string">'number'</span>, value &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 然后我们继续下一个循环。</span></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们同样支持字符串，字符串是由双引号"包裹的文字内容。</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   (concat "foo" "bar")</span></span><br><span class="line">    <span class="comment">//            ^^^   ^^^ string tokens</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 我们引号开始检测。</span></span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">'"'</span>) &#123;</span><br><span class="line">      <span class="comment">// 创造一个`value`变量保存我们的字符串。</span></span><br><span class="line">      <span class="keyword">let</span> value = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 跳过意味着字符串开始的那个引号。</span></span><br><span class="line">      char = input[++current];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 之后我们遍历每一个字符直到我们到达了另一个引号。</span></span><br><span class="line">      <span class="keyword">while</span> (char !== <span class="string">'"'</span>) &#123;</span><br><span class="line">        value += char;</span><br><span class="line">        char = input[++current];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 跳过意味着字符串结尾的引号。</span></span><br><span class="line">      char = input[++current];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 然后创造字符串词素并添加到`tokens`数组。</span></span><br><span class="line">      tokens.push(&#123; <span class="attr">type</span>: <span class="string">'string'</span>, value &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最后一种词素是`name`词素。这是一个字母序列，在我们lisp语法中是函数的名称。</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   (add 2 4)</span></span><br><span class="line">    <span class="comment">//    ^^^</span></span><br><span class="line">    <span class="comment">//    Name token</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">let</span> LETTERS = <span class="regexp">/[a-z]/i</span>;</span><br><span class="line">    <span class="keyword">if</span> (LETTERS.test(char)) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 和其他情况一样，我们遍历字母并将它们添加到`value`变量。</span></span><br><span class="line">      <span class="keyword">while</span> (LETTERS.test(char)) &#123;</span><br><span class="line">        value += char;</span><br><span class="line">        char = input[++current];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 之后创建词素并添加到`tokens`变量。</span></span><br><span class="line">      tokens.push(&#123; <span class="attr">type</span>: <span class="string">'name'</span>, value &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最后如果我们并不能匹配到任何情况的话，我们就抛出一个错误并退出。</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'I dont know what this character is: '</span> + char);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后我们返回词素数组tokens。</span></span><br><span class="line">  <span class="keyword">return</span> tokens;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                                 ヽ/❀o ل͜ o\ﾉ</span></span><br><span class="line"><span class="comment"> *                                THE PARSER!!!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们的语法分析器接受我们的词素数组并创造出一个抽象语法树。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   [&#123; type: 'paren', value: '(' &#125;, ...]   =&gt;   &#123; type: 'Program', body: [...] &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 好的，那么我们定义一个`parser`函数，这个函数接收词素数组tokens。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parser</span>(<span class="params">tokens</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 我们还是创建一个`current`变量跟踪我们所处的位置。</span></span><br><span class="line">  <span class="keyword">let</span> current = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 但是这一次我们使用的是递归而不是一个`while`循环。所以我们定义一个`walk`函数。</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">walk</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在walk函数中我们首先获取当前词素。</span></span><br><span class="line">    <span class="keyword">let</span> token = tokens[current];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对不同类型的词素，我们的处理方式也不同，从数字词素开始。</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 我们检测当前词素是否为一个数字词素。</span></span><br><span class="line">    <span class="keyword">if</span> (token.type === <span class="string">'number'</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果是一个数字词素，我们增加`current`变量的值。</span></span><br><span class="line">      current++;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 之后我们返回一个类型为`NumberLiteral`类型的抽象语法树节点，并且设置这个节点的value。</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        type: <span class="string">'NumberLiteral'</span>,</span><br><span class="line">        value: token.value,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果我们有一个字符串词素，那么和数字词素的情况类似，只不过这里我们返回一个`StringLiteral`</span></span><br><span class="line">    <span class="comment">// 类型的词素。</span></span><br><span class="line">    <span class="keyword">if</span> (token.type === <span class="string">'string'</span>) &#123;</span><br><span class="line">      current++;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        type: <span class="string">'StringLiteral'</span>,</span><br><span class="line">        value: token.value,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接下来我们检测是否是一个函数调用。我们在碰到一个开括号的时候处理这种情况。</span></span><br><span class="line">    <span class="keyword">if</span> (token.type === <span class="string">'paren'</span> &amp;&amp; token.value === <span class="string">'('</span>) &#123;</span><br><span class="line">      <span class="comment">// 我们会增加`current`变量的值来跳过开括号以选取下一个词素，这是因为在我们的抽象语法树</span></span><br><span class="line">      <span class="comment">// 中开括号本身并没有意义。</span></span><br><span class="line">      token = tokens[++current];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 我们创建一个类型为`CallExpression`的基础词素，之后我们将它的名字设置为当前词素的value。</span></span><br><span class="line">      <span class="comment">// 这是因为开括号之后的词素的value就是函数的名字。</span></span><br><span class="line">      <span class="keyword">let</span> node = &#123;</span><br><span class="line">        type: <span class="string">'CallExpression'</span>,</span><br><span class="line">        name: token.value,</span><br><span class="line">        params: [],</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 我们再一次增加`current`变量来跳过包含了函数名的词素。</span></span><br><span class="line">      token = tokens[++current];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 现在我们遍历每一个会成为我们`CallExpression`词素的`params`的词素直到我们遇到一个</span></span><br><span class="line">      <span class="comment">// 闭括号为止。</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// 这就是需要递归的时候。我们使用递归而不是试图直接分析可能有无限多层嵌套节点的参数。</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// 为了解释这个概念，以我们的lisp代码为例。你可以观察到`add`的参数是一个数字和一个嵌套</span></span><br><span class="line">      <span class="comment">// 的`CallExpression`，而这个`CallExpression`又拥有自己的参数。</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//   (add 2 (subtract 4 2))</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// 你也可以观察到在我们的词素数组中我们有多个闭括号。</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//   [</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'paren',  value: '('        &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'name',   value: 'add'      &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'number', value: '2'        &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'paren',  value: '('        &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'name',   value: 'subtract' &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'number', value: '4'        &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'number', value: '2'        &#125;,</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'paren',  value: ')'        &#125;, &lt;&lt;&lt; 闭括号</span></span><br><span class="line">      <span class="comment">//     &#123; type: 'paren',  value: ')'        &#125;, &lt;&lt;&lt; 闭括号</span></span><br><span class="line">      <span class="comment">//   ]</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// 我们依赖嵌套的`walk`函数在处理每一个嵌套的CallExpression`的时候增加我们的`current`变量。</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 所以我们创建一个`while`循环直到我们碰到一个类型为`paren`并且`value`是闭括号的词素。</span></span><br><span class="line">      <span class="keyword">while</span> (</span><br><span class="line">        token.type !== <span class="string">'paren'</span> ||</span><br><span class="line">        (token.type === <span class="string">'paren'</span> &amp;&amp; token.value !== <span class="string">')'</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// 我们调用`walk`函数，`walk`函数会返回一个节点然后我们将这个节点添加到我们的`node.params`。</span></span><br><span class="line">        node.params.push(walk());</span><br><span class="line">        token = tokens[current];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 最后我们还需要增加`current`变量来跳过闭括号。</span></span><br><span class="line">      current++;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回这个节点。</span></span><br><span class="line">      <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同样，如果我们没有匹配到以上任何类型，我们抛出一个错误。</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(token.type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 现在，我们来创建我们的抽象语法树。抽象语法树的根节点是一个`Program`节点。</span></span><br><span class="line">  <span class="keyword">let</span> ast = &#123;</span><br><span class="line">    type: <span class="string">'Program'</span>,</span><br><span class="line">    body: [],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 然后我们调用我们的`walk`函数，将返回的节点都添加到`ast.body`数组中。</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 我们在一个循环中这样做的原因是因为我们可能有多个单独的函数调用，而不是相互嵌套。</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">//   (add 2 2)</span></span><br><span class="line">  <span class="comment">//   (subtract 4 2)</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">while</span> (current &lt; tokens.length) &#123;</span><br><span class="line">    ast.body.push(walk());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后，语法分析器会返回抽象语法树。</span></span><br><span class="line">  <span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                                 ⌒(❀&gt;◞౪◟&lt;❀)⌒</span></span><br><span class="line"><span class="comment"> *                               THE TRAVERSER!!!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 现在我们有了抽象语法树，而我们希望可以使用一个访问者对象来访问各个节点。我们需要能够在碰到一</span></span><br><span class="line"><span class="comment"> * 个节点的时候调用访问者对象相应的方法。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   traverse(ast, &#123;</span></span><br><span class="line"><span class="comment"> *     Program: &#123;</span></span><br><span class="line"><span class="comment"> *       enter(node, parent) &#123;</span></span><br><span class="line"><span class="comment"> *         // ...</span></span><br><span class="line"><span class="comment"> *       &#125;,</span></span><br><span class="line"><span class="comment"> *       exit(node, parent) &#123;</span></span><br><span class="line"><span class="comment"> *         // ...</span></span><br><span class="line"><span class="comment"> *       &#125;,</span></span><br><span class="line"><span class="comment"> *     &#125;,</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     CallExpression: &#123;</span></span><br><span class="line"><span class="comment"> *       enter(node, parent) &#123;</span></span><br><span class="line"><span class="comment"> *         // ...</span></span><br><span class="line"><span class="comment"> *       &#125;,</span></span><br><span class="line"><span class="comment"> *       exit(node, parent) &#123;</span></span><br><span class="line"><span class="comment"> *         // ...</span></span><br><span class="line"><span class="comment"> *       &#125;,</span></span><br><span class="line"><span class="comment"> *     &#125;,</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     NumberLiteral: &#123;</span></span><br><span class="line"><span class="comment"> *       enter(node, parent) &#123;</span></span><br><span class="line"><span class="comment"> *         // ...</span></span><br><span class="line"><span class="comment"> *       &#125;,</span></span><br><span class="line"><span class="comment"> *       exit(node, parent) &#123;</span></span><br><span class="line"><span class="comment"> *         // ...</span></span><br><span class="line"><span class="comment"> *       &#125;,</span></span><br><span class="line"><span class="comment"> *     &#125;,</span></span><br><span class="line"><span class="comment"> *   &#125;);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以我们定义一个traverser函数，这个函数接收抽象语法树以及一个访问者对象。在这个函数内部我们</span></span><br><span class="line"><span class="comment">// 还会定义两个函数……</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">traverser</span>(<span class="params">ast, visitor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// `traverseArray`函数，这个函数允许我们遍历一个数组并且调用我们接下来定义的函数："traverseNode`。</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseArray</span>(<span class="params">array, parent</span>) </span>&#123;</span><br><span class="line">    array.forEach(<span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">      traverseNode(child, parent);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `traverseNode`函数会接收一个节点以及这个节点的父节点。这样它就可以将这两个参数传递给我们</span></span><br><span class="line">  <span class="comment">// 的访问者对象的方法。</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, parent</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//我们首先检测访问者对象是否含有一个匹配当前类型节点的方法。</span></span><br><span class="line">    <span class="keyword">let</span> methods = visitor[node.type];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果当前类型节点有相匹配的`enter`方法，我们调用这个方法`enter`方法并传入节点以及父节点。</span></span><br><span class="line">    <span class="keyword">if</span> (methods &amp;&amp; methods.enter) &#123;</span><br><span class="line">      methods.enter(node, parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接下来我们根据当前节点类型分情况处理。</span></span><br><span class="line">    <span class="keyword">switch</span> (node.type) &#123;</span><br><span class="line">      <span class="comment">// 我们从最顶层的`Program`开始。由于Program节点的body属性是一个节点数组，我们调用</span></span><br><span class="line">      <span class="comment">// `traverseArray`函数来向下遍历它们。</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// （请注意'traverseArray`会调用`traverseNode`所以我们会递归地遍历抽象语法树。）</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Program'</span>:</span><br><span class="line">        traverseArray(node.body, node);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 对于`CallExpression`节点，我们遍历它的`params`属性。</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'CallExpression'</span>:</span><br><span class="line">        traverseArray(node.params, node);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 对于`NumberLiteral`和`StringLiteral`的情况，我们并没有任何子节点去访问，所以我们</span></span><br><span class="line">      <span class="comment">// 直接break。</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'NumberLiteral'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'StringLiteral'</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 同样的，如果出现没有匹配的情况，我们抛出一个错误。</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(node.type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果访问者对象针对当前类型节点存在着一个`exit`方法的话，我们在这里调用它并传入节点和父节点。</span></span><br><span class="line">    <span class="keyword">if</span> (methods &amp;&amp; methods.exit) &#123;</span><br><span class="line">      methods.exit(node, parent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后，我们通过调用`traverseNode`并传入ast和null来开始遍历。这里传入null作为父节点的原</span></span><br><span class="line">  <span class="comment">// 因是因为抽象语法树的根节点并没有父节点。</span></span><br><span class="line">  traverseNode(ast, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                                   ⁽(◍˃̵͈̑ᴗ˂̵͈̑)⁽</span></span><br><span class="line"><span class="comment"> *                              THE TRANSFORMER!!!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接下来就是转换器。我们的转换器会接收我们创造的抽象语法树并将它和一个访问者对象传给traverser</span></span><br><span class="line"><span class="comment"> * 函数。然后创造一个新的抽象语法树。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *   Original AST                     |   Transformed AST</span></span><br><span class="line"><span class="comment"> * ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *   &#123;                                |   &#123;</span></span><br><span class="line"><span class="comment"> *     type: 'Program',               |     type: 'Program',</span></span><br><span class="line"><span class="comment"> *     body: [&#123;                       |     body: [&#123;</span></span><br><span class="line"><span class="comment"> *       type: 'CallExpression',      |       type: 'ExpressionStatement',</span></span><br><span class="line"><span class="comment"> *       name: 'add',                 |       expression: &#123;</span></span><br><span class="line"><span class="comment"> *       params: [&#123;                   |         type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *         type: 'NumberLiteral',     |         callee: &#123;</span></span><br><span class="line"><span class="comment"> *         value: '2'                 |           type: 'Identifier',</span></span><br><span class="line"><span class="comment"> *       &#125;, &#123;                         |           name: 'add'</span></span><br><span class="line"><span class="comment"> *         type: 'CallExpression',    |         &#125;,</span></span><br><span class="line"><span class="comment"> *         name: 'subtract',          |         arguments: [&#123;</span></span><br><span class="line"><span class="comment"> *         params: [&#123;                 |           type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *           type: 'NumberLiteral',   |           value: '2'</span></span><br><span class="line"><span class="comment"> *           value: '4'               |         &#125;, &#123;</span></span><br><span class="line"><span class="comment"> *         &#125;, &#123;                       |           type: 'CallExpression',</span></span><br><span class="line"><span class="comment"> *           type: 'NumberLiteral',   |           callee: &#123;</span></span><br><span class="line"><span class="comment"> *           value: '2'               |             type: 'Identifier',</span></span><br><span class="line"><span class="comment"> *         &#125;]                         |             name: 'subtract'</span></span><br><span class="line"><span class="comment"> *       &#125;]                           |           &#125;,</span></span><br><span class="line"><span class="comment"> *     &#125;]                             |           arguments: [&#123;</span></span><br><span class="line"><span class="comment"> *   &#125;                                |             type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *                                    |             value: '4'</span></span><br><span class="line"><span class="comment"> * ---------------------------------- |           &#125;, &#123;</span></span><br><span class="line"><span class="comment"> *                                    |             type: 'NumberLiteral',</span></span><br><span class="line"><span class="comment"> *                                    |             value: '2'</span></span><br><span class="line"><span class="comment"> *                                    |           &#125;]</span></span><br><span class="line"><span class="comment"> *  (sorry the other one is longer.)  |         &#125;</span></span><br><span class="line"><span class="comment"> *                                    |       &#125;</span></span><br><span class="line"><span class="comment"> *                                    |     &#125;]</span></span><br><span class="line"><span class="comment"> *                                    |   &#125;</span></span><br><span class="line"><span class="comment"> * ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以我们定义一个transformer函数，这个函数接收一个lisp抽象语法树对象。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformer</span>(<span class="params">ast</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 我们会创建一个`newAst`，这个新抽象语法树和之前的抽象语法树一样有一个Program节点。</span></span><br><span class="line">  <span class="keyword">let</span> newAst = &#123;</span><br><span class="line">    type: <span class="string">'Program'</span>,</span><br><span class="line">    body: [],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接下来我会小小地作弊一下并使用一个小小的hack。我们会给父节点添加一个`context`属性，我们</span></span><br><span class="line">  <span class="comment">// 会将子节点添加到它们的父节点的`context`属性中。通常情况下你会有一个比这个更好的抽象，</span></span><br><span class="line">  <span class="comment">// 但是针对我们的目的这样做更简洁。</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 只要记住`context`是一个从旧的抽象语法树到新的抽象语法树的引用即可。</span></span><br><span class="line">  ast._context = newAst.body;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 我们从调用traverser函数并传入抽象语法树和访问者对象开始。</span></span><br><span class="line">  traverser(ast, &#123;</span><br><span class="line">    <span class="comment">// 访问者对象处理的第一种情况是`NumberLiteral`节点。</span></span><br><span class="line">    NumberLiteral: &#123;</span><br><span class="line">      <span class="comment">// 我们会在进入节点的时候访问节点。</span></span><br><span class="line">      enter(node, parent) &#123;</span><br><span class="line">        <span class="comment">//我们创建一个`NumberLiteral`类型的新节点并添加到父节点的`context`。</span></span><br><span class="line">        parent._context.push(&#123;</span><br><span class="line">          type: <span class="string">'NumberLiteral'</span>,</span><br><span class="line">          value: node.value,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接下来是`StringLiteral`类型节点。</span></span><br><span class="line">    StringLiteral: &#123;</span><br><span class="line">      enter(node, parent) &#123;</span><br><span class="line">        parent._context.push(&#123;</span><br><span class="line">          type: <span class="string">'StringLiteral'</span>,</span><br><span class="line">          value: node.value,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接着是`CallExpression`类型节点。</span></span><br><span class="line">    CallExpression: &#123;</span><br><span class="line">      enter(node, parent) &#123;</span><br><span class="line">        <span class="comment">// 我们创建一个新的`CallExpression`类型节点，这个新节点还有一个嵌套的`Identifier`对象。</span></span><br><span class="line">        <span class="keyword">let</span> expression = &#123;</span><br><span class="line">          type: <span class="string">'CallExpression'</span>,</span><br><span class="line">          callee: &#123;</span><br><span class="line">            type: <span class="string">'Identifier'</span>,</span><br><span class="line">            name: node.name,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="built_in">arguments</span>: [],</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接下来我们给原始的`CallExpression`节点定义一个`context`属性。这个属性指向</span></span><br><span class="line">        <span class="comment">// `expression`的arguments属性，这样我们就可以添加参数了。</span></span><br><span class="line">        node._context = expression.arguments;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接下来我们检测父节点是否是一个`CallExpression`，如果不是的话……</span></span><br><span class="line">        <span class="keyword">if</span> (parent.type !== <span class="string">'CallExpression'</span>) &#123;</span><br><span class="line">          <span class="comment">// 我们将我们的`CallExpression`节点包裹在`ExpressionStatement`节点中。</span></span><br><span class="line">          <span class="comment">// 我们这样做的原因是因为JS中顶层的`CallExpression`实际上是语句。</span></span><br><span class="line">          expression = &#123;</span><br><span class="line">            type: <span class="string">'ExpressionStatement'</span>,</span><br><span class="line">            expression: expression,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最后，我们将我们的`CallExpression`（可能被包裹）添加到父节点的`context`属性。</span></span><br><span class="line">        parent._context.push(expression);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后，转换器会返回我们刚刚创造的全新抽象语法树。</span></span><br><span class="line">  <span class="keyword">return</span> newAst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                               ヾ（〃＾∇＾）ﾉ♪</span></span><br><span class="line"><span class="comment"> *                            THE CODE GENERATOR!!!!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 现在我们进入最后的阶段：代码生成器。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 我们的代码生成器会递归地调用自身将树中的每一个节点打印出来，最终形成一个巨大的字符串。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">codeGenerator</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 我们根据节点类型分情况处理。</span></span><br><span class="line">  <span class="keyword">switch</span> (node.type) &#123;</span><br><span class="line">    <span class="comment">// 如果我们有一个`Program`节点。我们会使用代码生成器遍历`body`属性中的所有节点然后使用</span></span><br><span class="line">    <span class="comment">// 换行符\n连接起来。</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Program'</span>:</span><br><span class="line">      <span class="keyword">return</span> node.body.map(codeGenerator).join(<span class="string">'\n'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对`ExpressionStatement`我们会对节点的expression属性调用代码生成器，并加上一个分号……</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'ExpressionStatement'</span>:</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        codeGenerator(node.expression) + <span class="string">';'</span> <span class="comment">// &lt;&lt; (...because we like to code the *correct* way)</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对`CallExpression`我们会打印出`callee`，也就是函数名，加上一个开括号，我们会对</span></span><br><span class="line">    <span class="comment">// `arguments`数组中的每一个节点调用代码生成器，使用逗号连接它们，然后我们添加一个闭括号。</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'CallExpression'</span>:</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        codeGenerator(node.callee) +</span><br><span class="line">        <span class="string">'('</span> +</span><br><span class="line">        node.arguments.map(codeGenerator).join(<span class="string">', '</span>) +</span><br><span class="line">        <span class="string">')'</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对`Identifier`，我们简单地返回节点的name属性。</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Identifier'</span>:</span><br><span class="line">      <span class="keyword">return</span> node.name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对`NumberLiteral`，我们简单地返回节点的值。</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'NumberLiteral'</span>:</span><br><span class="line">      <span class="keyword">return</span> node.value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对StringLiteral`，我们在节点value周围加上引号。</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'StringLiteral'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'"'</span> + node.value + <span class="string">'"'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果没有匹配，我们抛出一个错误。</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(node.type);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                                  (۶* ‘ヮ’)۶”</span></span><br><span class="line"><span class="comment"> *                         !!!!!!!!THE COMPILER!!!!!!!!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 终于到了！我们定义我们的`compiler`函数。这个函数会将所有部分连接起来。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. input  =&gt; tokenizer   =&gt; tokens</span></span><br><span class="line"><span class="comment"> *   2. tokens =&gt; parser      =&gt; ast</span></span><br><span class="line"><span class="comment"> *   3. ast    =&gt; transformer =&gt; newAst</span></span><br><span class="line"><span class="comment"> *   4. newAst =&gt; generator   =&gt; output</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compiler</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> tokens = tokenizer(input);</span><br><span class="line">  <span class="keyword">let</span> ast = parser(tokens);</span><br><span class="line">  <span class="keyword">let</span> newAst = transformer(ast);</span><br><span class="line">  <span class="keyword">let</span> output = codeGenerator(newAst);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回输出！</span></span><br><span class="line">  <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> *                                   (๑˃̵ᴗ˂̵)و</span></span><br><span class="line"><span class="comment"> * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!YOU MADE IT!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line"><span class="comment"> * ============================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里我只是在导出函数……</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  tokenizer,</span><br><span class="line">  parser,</span><br><span class="line">  traverser,</span><br><span class="line">  transformer,</span><br><span class="line">  codeGenerator,</span><br><span class="line">  compiler,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs多进程cluster</title>
      <link href="/2020/07/20/nodejs%E5%A4%9A%E8%BF%9B%E7%A8%8Bcluster/"/>
      <url>/2020/07/20/nodejs%E5%A4%9A%E8%BF%9B%E7%A8%8Bcluster/</url>
      
        <content type="html"><![CDATA[<p>使用cluster开启nodejs多进程<br><a id="more"></a></p><h1 id="nodejs多进程cluster"><a href="#nodejs多进程cluster" class="headerlink" title="nodejs多进程cluster"></a>nodejs多进程cluster</h1><p>nodejs是单线程语言，如果一台电脑cpu是8核的，nodejs只能使用其中的一个，另外7个都没有使用到，cpu的资源都浪费了。<br>cluster这个包可以开启多个进程，可以完全利用电脑的cpu资源。<br>pm2这个工具内部也是用cluster开启的nodejs多进程<br>笔者写了一个小例子：</p><h2 id="cluster-js"><a href="#cluster-js" class="headerlink" title="cluster.js"></a>cluster.js</h2><p>这个文件开启多进程，并且可以守护进程<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);</span><br><span class="line"><span class="keyword">var</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>); <span class="comment">// 获取CPU 的数量</span></span><br><span class="line"><span class="keyword">var</span> numCPUs = os.cpus().length;</span><br><span class="line"></span><br><span class="line"><span class="comment">// numCPUs = 2</span></span><br><span class="line"><span class="keyword">var</span> process = <span class="built_in">require</span>(<span class="string">'process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> workers = &#123;&#125;;</span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">    <span class="comment">// 主进程分支</span></span><br><span class="line">    cluster.on(<span class="string">'exit'</span>, (worker, code, signal) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'工作进程 %d 关闭 (%s). 重启中...'</span>,</span><br><span class="line">            worker.process.pid, signal || code);</span><br><span class="line">        <span class="keyword">delete</span> workers[worker.process.pid]</span><br><span class="line">        worker = cluster.fork()</span><br><span class="line">        workers[worker.process.pid] = worker</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'新的工作进程'</span>, worker.process.pid)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(workers))</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'numCPUs:'</span>, numCPUs)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> worker = cluster.fork();</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'init ... pid'</span>, worker.process.pid)</span><br><span class="line">        workers[worker.process.pid] = worker;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'./app'</span>);</span><br><span class="line">    app.listen(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当主进程被终止时，关闭所有工作进程</span></span><br><span class="line">process.on(<span class="string">'SIGTERM'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> pid <span class="keyword">in</span> workers) &#123;</span><br><span class="line">        process.kill(pid);</span><br><span class="line">    &#125;</span><br><span class="line">    process.exit(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h2><p>这里就是一个普通http服务程序，有10%的几率抛出错误，检测cluster的守护进程功能<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Math</span>.random() &gt; <span class="number">0.9</span> ? fn() : <span class="string">''</span> </span><br><span class="line">    response.end(<span class="string">'Hello jinux'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">module</span>.parent) &#123;</span><br><span class="line">    server.listen(<span class="number">3000</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'app started at port 3000...'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = server</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="test-js"><a href="#test-js" class="headerlink" title="test.js"></a>test.js</h2><p>这里用来测试端口<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    request(<span class="string">'http://localhost:3000'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, response, body</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'body:'</span>, body); <span class="comment">// Print the HTML for the Google homepage.</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure></p><p>最后附上demo的代码<a href="https://github.com/jinux7/study-collections/tree/master/nodejs%E5%A4%9A%E8%BF%9B%E7%A8%8Bcluster" target="_blank" rel="noopener">source</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
            <tag> 服务器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5横屏适配</title>
      <link href="/2020/07/16/h5%E6%A8%AA%E5%B1%8F%E9%80%82%E9%85%8D/"/>
      <url>/2020/07/16/h5%E6%A8%AA%E5%B1%8F%E9%80%82%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<p>h5移动端横屏适配<br><a id="more"></a></p><h1 id="h5横屏适配"><a href="#h5横屏适配" class="headerlink" title="h5横屏适配"></a>h5横屏适配</h1><p>我们平时在移动端开发时，特别是一些互动小游戏，需要只能在竖屏或者横屏的状态下展示。<br>比如，我们现在有一个需求，要求只能横屏展示，无论用户的手机处于竖屏还是横屏状态，都展示横屏效果。<br>最常用的方式是利用css3的transform rotate,将页面旋转90度。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用 CSS3 旋转 对根容器逆时针旋转 90 度</span></span><br><span class="line"><span class="keyword">var</span> detectOrient = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> width = <span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">      height =  <span class="built_in">document</span>.documentElement.clientHeight,</span><br><span class="line">      $wrapper =  <span class="built_in">document</span>.getElementById(<span class="string">"J_wrapper"</span>),</span><br><span class="line">      style = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>( width &gt;= height )&#123; <span class="comment">// 横屏</span></span><br><span class="line">      style += <span class="string">"width:"</span> + width + <span class="string">"px;"</span>;  <span class="comment">// 注意旋转后的宽高切换</span></span><br><span class="line">      style += <span class="string">"height:"</span> + height + <span class="string">"px;"</span>;</span><br><span class="line">      style += <span class="string">"-webkit-transform: rotate(0); transform: rotate(0);"</span>;</span><br><span class="line">      style += <span class="string">"-webkit-transform-origin: 0 0;"</span>;</span><br><span class="line">      style += <span class="string">"transform-origin: 0 0;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123; <span class="comment">// 竖屏</span></span><br><span class="line">      style += <span class="string">"width:"</span> + height + <span class="string">"px;"</span>;</span><br><span class="line">      style += <span class="string">"height:"</span> + width + <span class="string">"px;"</span>;</span><br><span class="line">      style += <span class="string">"-webkit-transform: rotate(90deg); transform: rotate(90deg);"</span>;</span><br><span class="line">      <span class="comment">// 注意旋转中点的处理</span></span><br><span class="line">      style += <span class="string">"-webkit-transform-origin: "</span> + width / <span class="number">2</span> + <span class="string">"px "</span> + width / <span class="number">2</span> + <span class="string">"px;"</span>;</span><br><span class="line">      style += <span class="string">"transform-origin: "</span> + width / <span class="number">2</span> + <span class="string">"px "</span> + width / <span class="number">2</span> + <span class="string">"px;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  $wrapper.style.cssText = style;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.onresize = detectOrient;</span><br><span class="line">detectOrient();</span><br></pre></td></tr></table></figure></p><p>以上这段代码可以解决一些常见场景，如果场景更复杂，<a href="https://aotu.io/notes/2017/10/18/landscape_mode_in_html5_game/" target="_blank" rel="noopener">详见此文</a>。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见的web攻击方式</title>
      <link href="/2020/06/24/%E5%B8%B8%E8%A7%81%E7%9A%84web%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/"/>
      <url>/2020/06/24/%E5%B8%B8%E8%A7%81%E7%9A%84web%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>常见的web攻击方式<br><a id="more"></a></p><h1 id="常见的web攻击方式"><a href="#常见的web攻击方式" class="headerlink" title="常见的web攻击方式"></a>常见的web攻击方式</h1><p>简要的介绍下web常见的几种攻击方式</p><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>详请见本站文章<a href="http://jinux.top/2018/11/28/web%E5%AE%89%E5%85%A8%E4%B9%8BXSS/" target="_blank" rel="noopener">web安全之XSS</a></p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>详请见本站文章<a href="http://jinux.top/2018/11/28/web%E5%AE%89%E5%85%A8%E4%B9%8BCSRF/" target="_blank" rel="noopener">web安全之CSRF</a></p><h2 id="点击劫持"><a href="#点击劫持" class="headerlink" title="点击劫持"></a>点击劫持</h2><p>比如你访问黑客网站A，A网站iframe引入了一个博客网站B，A网站将iframe透明化，并且在iframe下面放一张美女图片，图片上有一个更新美女信息的按钮，这个按钮正好跟B网站发布信息按钮重合，当你不在意的点击了图片上的按钮，实际你点击的是透明化的B网站的发布信息按钮。</p><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>SQL注入是对后端数据库的攻击<br>前端页面输入<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用户名：admin</span><br><span class="line">密码：<span class="number">1</span><span class="string">'or'</span><span class="number">1</span><span class="string">'='</span><span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>这里的密码是一段SQL语句，后台在利用前端传来的红户名和密码拼装好一段SQL语句，并查询就会返回true。<br>拼接后的SQL语句：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM test WHERE username = <span class="string">'admin'</span> AND password = <span class="string">'1'</span>or<span class="string">'1'</span>=<span class="string">'1'</span>;</span><br></pre></td></tr></table></figure></p><h2 id="OS注入"><a href="#OS注入" class="headerlink" title="OS注入"></a>OS注入</h2><p>OS注入式针对操作系统的<br>以nodejs为例，假如在接口中需要从github下载用户指定的repo，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'mz/child_process'</span>).exec;</span><br><span class="line"><span class="keyword">let</span> params = <span class="comment">// 用户输入的参数</span></span><br><span class="line">exec(<span class="string">`git clone <span class="subst">$&#123;params.repo&#125;</span>`</span>);</span><br></pre></td></tr></table></figure></p><p>如果传入的参数是这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//github.com/xx/xx.git &amp;&amp; rm -rf /*</span></span><br></pre></td></tr></table></figure></p><p>执行完拉取库的命令后继续执行一个删除当前路径下所有文件的操作。</p><h2 id="请求劫持"><a href="#请求劫持" class="headerlink" title="请求劫持"></a>请求劫持</h2><h3 id="DNS劫持"><a href="#DNS劫持" class="headerlink" title="DNS劫持"></a>DNS劫持</h3><p>DNS服务器（DNS解析的各个步骤）被纂改，修改了域名解析的结果，使得访问到的不是预期的ip。</p><h3 id="HTTP劫持"><a href="#HTTP劫持" class="headerlink" title="HTTP劫持"></a>HTTP劫持</h3><p>运营商劫持，此时大概只能升级HTTPS了。</p><h2 id="DDOS"><a href="#DDOS" class="headerlink" title="DDOS"></a>DDOS</h2><p><a href="http://www.ruanyifeng.com/blog/2018/06/ddos.html" target="_blank" rel="noopener">可以看一下阮老师的这篇文章</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chrome调试之overrides</title>
      <link href="/2020/06/22/chrome%E8%B0%83%E8%AF%95%E4%B9%8Boverrides/"/>
      <url>/2020/06/22/chrome%E8%B0%83%E8%AF%95%E4%B9%8Boverrides/</url>
      
        <content type="html"><![CDATA[<p>浏览器调试之overrides<br><a id="more"></a></p><h1 id="chrome调试之overrides"><a href="#chrome调试之overrides" class="headerlink" title="chrome调试之overrides"></a>chrome调试之overrides</h1><p>平时我们用浏览器调试代码很普遍，今天我介绍一个浏览器的小技能，可以覆盖网站的代码，在本地生成一个一样的文件，刷新网站的时候浏览器会加载本地生成的文件，这样，可以实时的修改代码并且观察修改后的效果。<br>启用步骤：<br>1.在浏览器的调试面板进入sources.<br>2.点击overrides,会看到一个<code>+ Select folder for overrides</code>,点击加号选择一个存放文件的文件夹。（注意浏览器上方会有一个权限提示，点击允许）<br>3.这时还是在sources面板下，点击Page，切换到此网站的源代码展示目录，选择一个要调试的文件（html,js,css均可），单击右键，选择<code>Save for overrides</code>, 之后可以在刚才选择的文件夹下看到这个保存到本地的文件，修改这个文件后再刷新页面，就可以看到修改后的变化了。<br>4.在overrides面板下可以看到<code>Enable Local Overrides</code>,切换这个选项可以控制本地代码是否参与执行。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> 浏览器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jwt、session、oauth简单介绍</title>
      <link href="/2020/06/19/jwt%E3%80%81session%E3%80%81oauth%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/"/>
      <url>/2020/06/19/jwt%E3%80%81session%E3%80%81oauth%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>jwt、session、oauth的鉴权简单说明<br><a id="more"></a></p><h1 id="jwt、session、oauth简单介绍"><a href="#jwt、session、oauth简单介绍" class="headerlink" title="jwt、session、oauth简单介绍"></a>jwt、session、oauth简单介绍</h1><h2 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h2><p>jwt是json web token的缩写，jwt的鉴权流程如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、用户向服务器发送用户名和密码。</span><br><span class="line"><span class="number">2</span>、服务器验证通过后，生成jwt，可以有选择的在其中    保存用户信息及数据。也可以加密。    </span><br><span class="line"><span class="number">3</span>、服务器向用户返回jwt。</span><br><span class="line"><span class="number">4</span>、用户随后的每一次请求，都会在 cookie 或者 header或参数里，将 jwt 传回服务器鉴权。</span><br><span class="line"><span class="number">5</span>、服务器收到jwt，找到前期保存的数据，由此得知用户的身份。</span><br></pre></td></tr></table></figure></p><p>jwt内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">分为 头部（header),载荷（payload)，签证（signature). 用 “.” 分隔。</span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1</span><br><span class="line">NDM0ODg3NjgsImp0aSI6ImFjYzhmZjIzLWM1MjgtNDk3OS04N</span><br><span class="line">TYwLWY0NGFmYWNhNDY4MiIsImlzcyI6ImJpenN2YyIsIm5iZ</span><br><span class="line">iI6NTQzNDgxNTY4LCJzdWIiOiJ0b2tlbi14ajZqOTo3emg1Y</span><br><span class="line">md2OGI1cWZrN2JoNnJxZ3o3djV0OGJ2amhiNHNoazQ5aGh6O</span><br><span class="line">GtjcWN6NmpnNWI3ejIifQ.dRKURNOUFOlgO7zBxMajF7<span class="number">-8</span>Wn</span><br><span class="line"><span class="number">0</span>zYs8x2t0UU6SYtP4</span><br></pre></td></tr></table></figure></p><p>优缺点：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">没有跨域问题、集群下登录信息同步的问题。</span><br><span class="line">一旦签发，到期前无法简单废止，最好用https。</span><br><span class="line">server无状态，性能高。</span><br></pre></td></tr></table></figure></p><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><p>session是利用cookie做健全的，流程如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、用户向服务器发送用户名和密码。</span><br><span class="line"><span class="number">2</span>、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</span><br><span class="line"><span class="number">3</span>、服务器向用户返回一个 session_id，写入用户的 Cookie。</span><br><span class="line"><span class="number">4</span>、用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</span><br><span class="line"><span class="number">5</span>、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</span><br></pre></td></tr></table></figure></p><p>优缺点：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">扩展性不好，存在跨域 和 集群session同步的问题。</span><br><span class="line">面对csrf 攻击，不如jwt。</span><br></pre></td></tr></table></figure></p><h2 id="oauth-用于第三方认证"><a href="#oauth-用于第三方认证" class="headerlink" title="oauth 用于第三方认证"></a>oauth 用于第三方认证</h2><p>目的在于让客户端安全可控地获取”用户”的授权。<br>比如说，登录微博（客户端）的时候，懒得新建账号了就用qq账号登录，选择qq登录。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">oauth场景，客户端不必保存登录用户（qq）的登录密码。  </span><br><span class="line">更精细的控制权限，即权限的到期时间，提升安全性。</span><br><span class="line">有四种模式：</span><br><span class="line">    授权码模式（authorization code）</span><br><span class="line">    简化模式（implicit）</span><br><span class="line">    密码模式（resource owner password credentials）</span><br><span class="line">    客户端模式（client credentials）</span><br></pre></td></tr></table></figure></p><p>这里我做了一个github的第三方登录鉴权，详情<a href="https://github.com/jinux7/study-collections/tree/master/oauth-github%E7%99%BB%E5%BD%95" target="_blank" rel="noopener">点这里</a>查看。<br>在做鉴权之前，需要登录github，之后在setting-&gt;Developer settings开启github鉴权功能。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 网络基础 </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP1和HTTP2的区别</title>
      <link href="/2020/06/18/HTTP1%E5%92%8CHTTP2%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2020/06/18/HTTP1%E5%92%8CHTTP2%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>简单的说一下http1和http2的区别<br><a id="more"></a></p><h1 id="HTTP1和HTTP2的区别"><a href="#HTTP1和HTTP2的区别" class="headerlink" title="HTTP1和HTTP2的区别"></a>HTTP1和HTTP2的区别</h1><h2 id="Http1-x"><a href="#Http1-x" class="headerlink" title="Http1.x"></a>Http1.x</h2><p>缺陷：线程阻塞，在同一时间，同一域名的请求有一定数量限制，超过限制数目的请求会被阻塞。</p><h2 id="Http1-0-短连接"><a href="#Http1-0-短连接" class="headerlink" title="Http1.0(短连接)"></a>Http1.0(短连接)</h2><p>缺陷：浏览器与服务器只保持短暂的连接，浏览器的每次请求都需要与服务器建立一个TCP连接（TCP连接的新建成本很高，因为需要客户端和服务器三次握手），服务器完成请求处理后立即断开TCP连接，服务器不跟踪每个客户也不记录过去的请求；<br>解决方案：添加头信息——非标准的Connection字段Connection: keep-alive</p><h2 id="Http1-1"><a href="#Http1-1" class="headerlink" title="Http1.1"></a>Http1.1</h2><p>改进点：<br>1.持久连接（与Http1其它版本的最大区别）<br>引入了持久连接，即TCP连接默认不关闭，可以被多个请求复用，不用声明Connection: keep-alive(对于同一个域名，大多数浏览器允许同时建立6个持久连接)<br>2.管道机制<br>即在同一个TCP连接里面，客户端可以同时发送多个请求。<br>3.分块传输编码<br>即服务端每产生一块数据，就发送一块，采用”流模式”而取代”缓存模式”。<br>4.新增请求方式<br>PUT:请求服务器存储一个资源;<br>DELETE：请求服务器删除标识的资源；<br>OPTIONS：请求查询服务器的性能，或者查询与资源相关的选项和需求；<br>TRACE：请求服务器回送收到的请求信息，主要用于测试或诊断；<br>CONNECT：保留将来使用<br>5.缺点：<br>虽然允许复用TCP连接，但是同一个TCP连接里面，所有的数据通信是按次序进行的。服务器只有处理完一个请求，才会接着处理下一个请求。如果前面的处理特别慢，后面就会有许多请求排队等着。这将导致“队头堵塞”</p><ul><li>避免方式：一是减少请求数，二是同时多开持久连接</li></ul><h2 id="Http-2-0"><a href="#Http-2-0" class="headerlink" title="Http/2.0"></a>Http/2.0</h2><p>特点：<br>1.采用二进制格式而非文本格式；<br>2.完全多路复用，而非有序并阻塞的、只需一个连接即可实现并行；（解决了线头阻塞的问题，与Http1最重要的区别）<br>3.使用报头压缩，降低开销<br>4.服务器推送</p><h3 id="二进制协议"><a href="#二进制协议" class="headerlink" title="二进制协议"></a>二进制协议</h3><p>HTTP/1.1 版的头信息肯定是文本（ASCII编码），数据体可以是文本，也可以是二进制。HTTP/2 则是一个彻底的二进制协议，头信息和数据体都是二进制，并且统称为”帧”：头信息帧和数据帧。<br>二进制协议解析起来更高效、“线上”更紧凑，更重要的是错误更少。</p><h3 id="完全多路复用"><a href="#完全多路复用" class="headerlink" title="完全多路复用"></a>完全多路复用</h3><p>HTTP/2 复用TCP连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，而且不用按照顺序一一对应，这样就避免了”队头堵塞”。</p><h3 id="报头压缩"><a href="#报头压缩" class="headerlink" title="报头压缩"></a>报头压缩</h3><p>1.HTTP 协议是没有状态，导致每次请求都必须附上所有信息。所以，请求的很多头字段都是重复的，比如Cookie，一样的内容每次请求都必须附带，这会浪费很多带宽，也影响速度。<br>2.对于相同的头部，不必再通过请求发送，只需发送一次；<br>3.HTTP/2 对这一点做了优化，引入了头信息压缩机制；<br>4.一方面，头信息使用gzip或compress压缩后再发送；<br>5.另一方面，客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，产生一个索引号，之后就不发送同样字段了，只需发送索引号。</p><h2 id="服务器推送"><a href="#服务器推送" class="headerlink" title="服务器推送"></a>服务器推送</h2><p>HTTP协议通常承载于TCP协议之上，在HTTP和TCP之间添加一个安全协议层（SSL或TSL），这个时候，就成了我们常说的HTTPS.</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nodejs常驻后台运行</title>
      <link href="/2020/06/05/Nodejs%E5%B8%B8%E9%A9%BB%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/"/>
      <url>/2020/06/05/Nodejs%E5%B8%B8%E9%A9%BB%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>nodejs程序在后台运行<br><a id="more"></a></p><h1 id="Nodejs常驻后台运行"><a href="#Nodejs常驻后台运行" class="headerlink" title="Nodejs常驻后台运行"></a>Nodejs常驻后台运行</h1><p>nodejs是通过命令行方式执行，当用户的xshell断开时Nodejs也就停止运行了。下面介绍几种办法让Nodejs常驻在后台运行</p><h2 id="pm2-推荐"><a href="#pm2-推荐" class="headerlink" title="pm2(推荐)"></a>pm2(推荐)</h2><p><a href="http://pm2.io/" target="_blank" rel="noopener">官网地址</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pm2</span><br><span class="line">pm2 start app.js        <span class="comment">// 启动</span></span><br><span class="line">pm2 start app.js -i max <span class="comment">//启动 使用所有CPU核心的集群</span></span><br><span class="line">pm2 stop app.js         <span class="comment">// 停止</span></span><br><span class="line">pm2 stop all            <span class="comment">// 停止所有</span></span><br><span class="line">pm2 restart app.js      <span class="comment">// 重启</span></span><br><span class="line">pm2 restart all         <span class="comment">// 重启所有</span></span><br><span class="line">pm2 <span class="keyword">delete</span>  app.js      <span class="comment">// 关闭</span></span><br></pre></td></tr></table></figure></p><h2 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup node app.js &amp;</span><br></pre></td></tr></table></figure><h2 id="forever"><a href="#forever" class="headerlink" title="forever"></a>forever</h2><p><a href="https://github.com/nodejitsu/forever" target="_blank" rel="noopener">github地址</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install forever -g</span><br><span class="line">forever start app.js    <span class="comment">//启动</span></span><br><span class="line">forever stop app.js     <span class="comment">//关闭</span></span><br><span class="line">forever stopall         <span class="comment">//关闭全部</span></span><br><span class="line">forever restart app.js  <span class="comment">//重启</span></span><br><span class="line">forever restartall      <span class="comment">//重启全部</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端埋点</title>
      <link href="/2020/05/29/%E5%89%8D%E7%AB%AF%E5%9F%8B%E7%82%B9/"/>
      <url>/2020/05/29/%E5%89%8D%E7%AB%AF%E5%9F%8B%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<p>全面的介绍前端埋点知识<br><a id="more"></a></p><h1 id="前端埋点"><a href="#前端埋点" class="headerlink" title="前端埋点"></a>前端埋点</h1><p>所谓「埋点」，就是在正常的功能逻辑中添加统计逻辑。拿统计微信右上角「+」的点击次数为例，上报的数据可以采用KEY-VALUE形式，我们定义KEY为「CLICK_ADD_BTN」，VALUE的值为点击的次数。当用户点击「+」时，展示菜单的代码会通过按钮的「回调」来触发执行，程序猿在业务代码执行完后，又加上了统计代码，把「CLICK_ADD_BTN」对应的VALUE加1，「+」被统计到了一次使用。<br>目前常见的前端埋点技术有3类：代码埋点、可视化埋点、无埋点（无埋点属于埋点的一个子集）。</p><h2 id="代码埋点："><a href="#代码埋点：" class="headerlink" title="代码埋点："></a>代码埋点：</h2><p>控件操作发生时通过预先写好的代码来发送数据。<br>优点：</p><ul><li>控制发送数据时间，事件自定义属性详细记录</li></ul><p>缺点：</p><ul><li>时间、人力成本大，数据传输的时效性。</li></ul><h2 id="可视化埋点："><a href="#可视化埋点：" class="headerlink" title="可视化埋点："></a>可视化埋点：</h2><p>利用可视化交互手段，通过可视化界面配置控件操作与事件操作发生关系。通过后台截屏的方式采集数据。<br>优点：</p><ul><li>成本低，速度快</li></ul><p>缺点：</p><ul><li>行为记录信息少，支持的分析方式少</li></ul><h2 id="无埋点："><a href="#无埋点：" class="headerlink" title="无埋点："></a>无埋点：</h2><p>Growing IO和Heap analytics，这2家是国内与国外的无埋点技术公司代表。用户展现界面元素时，通过控件绑定触发事件，事件被触发的时候系统会有相应的接口让开发者处理这些行为。现在市面上主流无埋点做法有两种，一种是预先跟踪所有的渲染信息，一种是滞后跟踪的渲染信息。<br>优点：</p><ul><li>无需埋点，方便快捷</li></ul><p>缺点：</p><ul><li>行为记录信息少，传输压力大</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后，关于埋点有无问题，可视化埋点和代码优劣问题，不管选择哪个都要从自身情况去考虑，自身分析场景来体验和对比，选择最适合自己的。适合自己的才是最好的。<br>这里推荐两篇介绍比较详细的前端埋点博文:<br><a href="http://www.imooc.com/article/27151" target="_blank" rel="noopener">第一篇</a><br><a href="https://blog.csdn.net/ywl570717586/article/details/89852222" target="_blank" rel="noopener">第二篇</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微前端</title>
      <link href="/2020/05/25/%E5%BE%AE%E5%89%8D%E7%AB%AF/"/>
      <url>/2020/05/25/%E5%BE%AE%E5%89%8D%E7%AB%AF/</url>
      
        <content type="html"><![CDATA[<p>初探微前端<br><a id="more"></a></p><h1 id="微前端"><a href="#微前端" class="headerlink" title="微前端"></a>微前端</h1><p>微前端最近火了起来，作为紧跟技术潮流的笔者来说，当然要了解一下。<br>贴出一篇笔者觉得不错的文章，<a href="https://www.lizenghai.com/archives/40308.html#i-17" target="_blank" rel="noopener">Single-Spa + Vue Cli 微前端落地指南</a>。这篇文章写得很不错，笔者就是按照他的思路一步一步的完成了一个微前端的demo。但是，笔者的demo只包含vue，父项目和子项目都是用的vue搭建的，相对来说比较简单些，而且，在实际开发的项目中都是一样的框架也是最好的选择。<br>最后，自己用vue写的一个demo，完成了主框架引入了两个子框架。<br><a href="https://github.com/jinux7/study-collections/tree/master/%E5%BE%AE%E5%89%8D%E7%AB%AF" target="_blank" rel="noopener">demo</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hash&amp;history单页面路由框架</title>
      <link href="/2020/05/18/hash-history%E5%8D%95%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E6%A1%86%E6%9E%B6/"/>
      <url>/2020/05/18/hash-history%E5%8D%95%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<p>hash和history路由形式的单页面框架<br><a id="more"></a></p><h1 id="hash-amp-history单页面路由框架"><a href="#hash-amp-history单页面路由框架" class="headerlink" title="hash&amp;history单页面路由框架"></a>hash&amp;history单页面路由框架</h1><p>现在vue,react,angular三大框架已经垄断了前端的单页面应用，用起来很方便，今天笔者写两个hash和history路由的小框架，有时候小项目可能也能用到，相比其它框架可能会配置灵活些。在使用vue等框架之前的单页面应用都是这样做的。<br>细节不写了，附上demo代码：<br><a href="https://github.com/jinux7/study-collections/tree/master/hash%26history%E7%9A%84%E8%B7%AF%E7%94%B1%E6%A1%86%E6%9E%B6" target="_blank" rel="noopener">点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写vue</title>
      <link href="/2020/04/27/%E6%89%8B%E5%86%99vue/"/>
      <url>/2020/04/27/%E6%89%8B%E5%86%99vue/</url>
      
        <content type="html"><![CDATA[<p>实现一个基础功能的vue<br><a id="more"></a></p><h1 id="手写vue"><a href="#手写vue" class="headerlink" title="手写vue"></a>手写vue</h1><p>实现一个非常简化版vue，暂时实现了<code>v-text,v-html,v-model,@eventName</code>指令，还有插值表达式<code>｛｛｝｝</code>,<br>一共写了4个类去实现，Vue是主类，Dep依赖收集类，Watcher是观察者类，Dep依赖收集去触发Watcher观察者定义的的方法，Compile类是用来解析html的dom元素的，解析的时候向对应的数据添加依赖，这样数据改变视图跟着改变。<br>下面是代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(option) &#123;</span><br><span class="line">    <span class="keyword">this</span>.el = option.el &amp;&amp; <span class="built_in">document</span>.querySelector(option.el);</span><br><span class="line">    <span class="keyword">this</span>.$data = option.data;</span><br><span class="line">    <span class="keyword">this</span>.$methods = option.methods;</span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">  &#125;</span><br><span class="line">  init() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observer(<span class="keyword">this</span>.$data);</span><br><span class="line">    <span class="keyword">new</span> Compile(<span class="keyword">this</span>.el, <span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 给data值设置get，set的数据劫持</span></span><br><span class="line">  observer(daObj) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> daObj === <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> daObj) &#123;</span><br><span class="line">        <span class="keyword">let</span> value = daObj[key];</span><br><span class="line">        <span class="keyword">if</span>(value &amp;&amp; <span class="keyword">typeof</span> value === <span class="string">'object'</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.observer(value);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> dep = <span class="keyword">new</span> Dep(); </span><br><span class="line">          <span class="built_in">Object</span>.defineProperty(daObj, key, &#123;</span><br><span class="line">            <span class="keyword">get</span>() &#123;</span><br><span class="line">              Dep.target &amp;&amp; dep.push(Dep.target);</span><br><span class="line">              <span class="keyword">return</span> value;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">set</span>(val) &#123;</span><br><span class="line">              value = val;</span><br><span class="line">              <span class="comment">// 这里注意。依赖触发要在value=val的下边</span></span><br><span class="line">              dep.dispatch();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 依赖类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.watchers = [];</span><br><span class="line">  &#125;</span><br><span class="line">  push(watcher) &#123;</span><br><span class="line">    <span class="keyword">this</span>.watchers.push(watcher);</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch() &#123;</span><br><span class="line">    <span class="keyword">this</span>.watchers.forEach(<span class="function"><span class="params">watcher</span>=&gt;</span> &#123;</span><br><span class="line">      watcher &amp;&amp; watcher.callback &amp;&amp; watcher.callback(); </span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 观察者类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(callback) &#123;</span><br><span class="line">    Dep.target = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">this</span>.callback = callback;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 编译模板字符串类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compile</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(el, vm) &#123;</span><br><span class="line">    <span class="keyword">this</span>.parseHtml(el, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  parseHtml(el, vm) &#123;</span><br><span class="line">    <span class="built_in">Array</span>.from(el.childNodes).forEach(<span class="function"><span class="params">item</span>=&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 处理带有指令的节点元素</span></span><br><span class="line">      <span class="keyword">this</span>.updateDirect(item, vm);</span><br><span class="line">      <span class="keyword">if</span>(item.nodeType === <span class="number">1</span> &amp;&amp; item.childNodes.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 递归解析</span></span><br><span class="line">        <span class="keyword">this</span>.parseHtml(item, vm);</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.nodeType === <span class="number">3</span> &amp;&amp; <span class="regexp">/\&#123;\&#123;(.*)\&#125;\&#125;/</span>.test(item.textContent)) &#123;</span><br><span class="line">        <span class="keyword">let</span> epx = <span class="built_in">RegExp</span>.$<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.updateText(item, vm, epx);</span><br><span class="line">        <span class="keyword">new</span> Watcher(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.updateText(item, vm, epx);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span> + epx);</span><br><span class="line">        Dep.target = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断是否是指令节点</span></span><br><span class="line">  updateDirect(node, vm) &#123;</span><br><span class="line">    <span class="comment">// 如果元素节点的属性是一个json对象</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> node.attributes === <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="comment">// 转换成数组</span></span><br><span class="line">      <span class="keyword">let</span> attrs = <span class="built_in">Array</span>.from(node.attributes);</span><br><span class="line">      <span class="keyword">if</span>(attrs.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;attrs.length; i++) &#123;</span><br><span class="line">          <span class="comment">// v-xxx指令</span></span><br><span class="line">          <span class="keyword">if</span>(<span class="regexp">/^v\-.+/</span>.test(attrs[i].name)) &#123;</span><br><span class="line">            <span class="keyword">let</span> handleStr = attrs[i].name.substring(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">let</span> epx = attrs[i].value;</span><br><span class="line">            <span class="keyword">this</span>[<span class="string">'dir'</span>+handleStr](node, vm, epx);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// @事件</span></span><br><span class="line">          <span class="keyword">if</span>(<span class="regexp">/^\@.+/</span>.test(attrs[i].name))&#123;</span><br><span class="line">            <span class="keyword">let</span> eventName = attrs[i].name.substring(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">let</span> callbackName = attrs[i].value;</span><br><span class="line">            <span class="keyword">this</span>[<span class="string">'eventHandler'</span>](node, vm, eventName, callbackName);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理指令节点数据响应</span></span><br><span class="line">  dirtext(node, vm, epx) &#123;</span><br><span class="line">    <span class="keyword">this</span>.updateText(node, vm, epx);</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.updateText(node, vm, epx);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span> + epx);</span><br><span class="line">    Dep.target = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  dirhtml(node, vm, epx) &#123;</span><br><span class="line">    <span class="keyword">this</span>.updateHtml(node, vm, epx);</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.updateHtml(node, vm, epx);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span> + epx);</span><br><span class="line">    Dep.target = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  dirmodel(node, vm, epx) &#123;</span><br><span class="line">    <span class="keyword">this</span>.updateValue(node, vm, epx);</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.updateValue(node, vm, epx);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span> + epx);</span><br><span class="line">    Dep.target = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 添加input事件</span></span><br><span class="line">    node.addEventListener(<span class="string">'input'</span>, (ev)=&gt; &#123;</span><br><span class="line">      <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span> + epx + <span class="string">'="'</span> + ev.target.value + <span class="string">'"'</span>);</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理指令事件</span></span><br><span class="line">  eventHandler(node, vm, eventName, callbackName) &#123;</span><br><span class="line">    node.addEventListener(eventName, vm.$methods[callbackName]||loop, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 更改元素节点的textContent</span></span><br><span class="line">  updateText(node, vm, epx) &#123;</span><br><span class="line">    node.textContent = <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span>+epx);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 更改元素节点的innerHTML</span></span><br><span class="line">  updateHtml(node, vm, epx) &#123;</span><br><span class="line">    node.innerHTML = <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span>+epx);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 更改input元素的value</span></span><br><span class="line">  updateValue(node, vm, epx) &#123;</span><br><span class="line">    node.value = <span class="built_in">eval</span>(<span class="string">'vm.$data.'</span>+epx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p><p>代码不多，但是基本功能已经实现。<br><a href="https://github.com/jinux7/study-collections/tree/master/%E6%89%8B%E5%86%99vue" target="_blank" rel="noopener">代码点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写vuex</title>
      <link href="/2020/04/21/%E6%89%8B%E5%86%99vuex/"/>
      <url>/2020/04/21/%E6%89%8B%E5%86%99vuex/</url>
      
        <content type="html"><![CDATA[<p>简单的实现vuex的功能<br><a id="more"></a></p><h1 id="手写vuex"><a href="#手写vuex" class="headerlink" title="手写vuex"></a>手写vuex</h1><p>vuex是vue的一个状态管理插件，现在使用的场景非常多，今天，自己简单的实现一下vuex的几个小功能，如<code>state,getter,commit,mutations,dispatch,actions</code>,暂时先实现这么多，有精力的话再补充<code>module,map等</code>。</p><h2 id="vuex在vue中的使用"><a href="#vuex在vue中的使用" class="headerlink" title="vuex在vue中的使用"></a>vuex在vue中的使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">// store.js文件，也就是配置store的文件</span><br><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import Vuex from &apos;vuex&apos;</span><br><span class="line">Vue.use(Vuex)</span><br><span class="line">export default new Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    count: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  getter: &#123;</span><br><span class="line">    getterCount(state) &#123;</span><br><span class="line">      return state.count + 5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    add(state, num) &#123;</span><br><span class="line">      state.count += num; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    addAction(state, num) &#123;</span><br><span class="line">      setTimeout(()=&gt; &#123;</span><br><span class="line">        state.commit(&apos;add&apos;, num);</span><br><span class="line">      &#125;, 2000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// vue的main.js文件中引入store</span><br><span class="line">import store from &apos;./store&apos;</span><br><span class="line">new Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: h =&gt; h(App)</span><br><span class="line">&#125;).$mount(&apos;#app&apos;)</span><br><span class="line"></span><br><span class="line">// vue具体页面使用</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hello&quot;&gt;</span><br><span class="line">    &lt;h2&gt;state-&gt;&#123;&#123;$store.state.count&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;getter-&gt;&#123;&#123;$store.getter.getterCount&#125;&#125;&lt;/h2&gt;  </span><br><span class="line">    &lt;h2&gt;computed-&gt;&#123;&#123;mill&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;onAdd&quot;&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;onAddDispatch&quot;&gt;addDispatch&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    mill() &#123;</span><br><span class="line">      return this.$store.state.count + 2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onAdd() &#123;</span><br><span class="line">      this.$store.commit(&apos;add&apos;, 15);</span><br><span class="line">    &#125;,</span><br><span class="line">    onAddDispatch() &#123;</span><br><span class="line">      this.$store.dispatch(&apos;addAction&apos;, 10);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="vuex的实现代码"><a href="#vuex的实现代码" class="headerlink" title="vuex的实现代码"></a>vuex的实现代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">let Vue;</span><br><span class="line">class Store &#123;</span><br><span class="line">  constructor(options = &#123;&#125;) &#123;</span><br><span class="line">    this.options = options;</span><br><span class="line">    this.vueState = new Vue(&#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          state: options.state</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    // 处理getter操作</span><br><span class="line">    this.getter = &#123;&#125;;</span><br><span class="line">    Object.keys(this.options.getter).forEach(item=&gt; &#123;</span><br><span class="line">      Object.defineProperty(this.getter, item, &#123;</span><br><span class="line">        get: ()=&gt; &#123;</span><br><span class="line">          return this.options.getter[item](this.options.state);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  // commit方法和mutations</span><br><span class="line">  commit(type, val) &#123;</span><br><span class="line">    Object.keys(this.options.mutations).forEach(item=&gt; &#123;</span><br><span class="line">      if(item === type) &#123;</span><br><span class="line">        this.options.mutations[item](this.options.state, val);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  // dispatch方法和actions</span><br><span class="line">  dispatch(type, val) &#123;</span><br><span class="line">    Object.keys(this.options.actions).forEach(item=&gt; &#123;</span><br><span class="line">      if(item === type) &#123;</span><br><span class="line">        this.options.actions[item](this, val);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  // 获取Store的state，来源于this.vueState，是Vue的一个实例，可以实现了store.state的数据绑定更新页面</span><br><span class="line">  get state () &#123;</span><br><span class="line">      return this.vueState.state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 供Vue.use()调用 </span><br><span class="line">function install(_Vue) &#123;</span><br><span class="line">  Vue = _Vue;</span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">      beforeCreate: function () &#123;</span><br><span class="line">          const options = this.$options;</span><br><span class="line">          if (options.store) &#123;</span><br><span class="line">              this.$store = options.store;</span><br><span class="line">          &#125; else if (options.parent &amp;&amp; options.parent.$store) &#123;</span><br><span class="line">              this.$store = options.parent.$store;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  Store,</span><br><span class="line">  install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebAssembly入门</title>
      <link href="/2020/04/15/WebAssembly%E5%85%A5%E9%97%A8/"/>
      <url>/2020/04/15/WebAssembly%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>WebAssembly简单实例<br><a id="more"></a></p><h1 id="WebAssembly入门"><a href="#WebAssembly入门" class="headerlink" title="WebAssembly入门"></a>WebAssembly入门</h1><p>WebAssembly是一门新技术，可以将c,c++,java等文件编译成.wasm文件，再被js引入到html中使用。<br>今天我介绍一种简单的方式生成.wasm文件，不需要使用繁琐的系统工具来完成。<br><a href="https://webassembly.studio/" target="_blank" rel="noopener">在线webassembly</a>,这个网站可以在线写c语言代码，在线打包成.wasm文件，还可以看例子，学习具体的使用。<br>贴一个小例子，也是按照这个在线编辑器copy下来的，<a href="https://github.com/jinux7/study-collections/tree/master/webAssembly" target="_blank" rel="noopener">demo点这里</a>。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>点击或触摸事件中的相关X,Y介绍</title>
      <link href="/2020/04/13/%E7%82%B9%E5%87%BB%E6%88%96%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3X-Y%E4%BB%8B%E7%BB%8D/"/>
      <url>/2020/04/13/%E7%82%B9%E5%87%BB%E6%88%96%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3X-Y%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>点击或触摸事件中，事件对象的clientX,pageX,screenX,offsetX,x介绍<br><a id="more"></a></p><h1 id="点击或触摸事件中的相关X-Y介绍"><a href="#点击或触摸事件中的相关X-Y介绍" class="headerlink" title="点击或触摸事件中的相关X,Y介绍"></a>点击或触摸事件中的相关X,Y介绍</h1><h2 id="位置属性"><a href="#位置属性" class="headerlink" title="位置属性"></a>位置属性</h2><p>我们在使用点击事件时，想获取当前鼠标在页面中的位置，可以把事件对象打印出来，看到了下图中的一些相关于x，y的属性。<br><img src="/2020/04/13/点击或触摸事件中的相关X-Y介绍/1.png" alt="img"></p><h2 id="属性介绍"><a href="#属性介绍" class="headerlink" title="属性介绍"></a>属性介绍</h2><h3 id="clientX、clientY"><a href="#clientX、clientY" class="headerlink" title="clientX、clientY"></a>clientX、clientY</h3><p>点击位置距离当前body可视区域的x，y坐标</p><h3 id="pageX、pageY"><a href="#pageX、pageY" class="headerlink" title="pageX、pageY"></a>pageX、pageY</h3><p>对于整个页面来说，包括了被卷去的body部分的长度</p><h3 id="screenX、screenY"><a href="#screenX、screenY" class="headerlink" title="screenX、screenY"></a>screenX、screenY</h3><p>点击位置距离当前电脑屏幕的x，y坐标</p><h3 id="offsetX、offsetY"><a href="#offsetX、offsetY" class="headerlink" title="offsetX、offsetY"></a>offsetX、offsetY</h3><p>相对于带有定位的父盒子的x，y坐标</p><h3 id="x、y"><a href="#x、y" class="headerlink" title="x、y"></a>x、y</h3><p>和screenX、screenY一样</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2020/04/13/点击或触摸事件中的相关X-Y介绍/2.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web全景图之pannellum</title>
      <link href="/2020/04/09/web%E5%85%A8%E6%99%AF%E5%9B%BE%E4%B9%8Bpannellum/"/>
      <url>/2020/04/09/web%E5%85%A8%E6%99%AF%E5%9B%BE%E4%B9%8Bpannellum/</url>
      
        <content type="html"><![CDATA[<p>开发web全景图的工具库pannellum<br><a id="more"></a></p><h1 id="web全景图之pannellum"><a href="#web全景图之pannellum" class="headerlink" title="web全景图之pannellum"></a>web全景图之pannellum</h1><p>最近需要开发一个室内全景图的项目，类似于贝壳的VR看房，直接用three.js开发成本太高，于是在网上找到了pannellum这个工具库，不依赖其它的库，而且还小，使用简单。</p><h2 id="pannellum官网地址"><a href="#pannellum官网地址" class="headerlink" title="pannellum官网地址"></a>pannellum官网地址</h2><p><a href="https://pannellum.org/" target="_blank" rel="noopener">pannellum官网地址</a></p><h2 id="自己做了一个小demo"><a href="#自己做了一个小demo" class="headerlink" title="自己做了一个小demo"></a>自己做了一个小demo</h2><p><a href="https://github.com/jinux7/study-collections/tree/master/pannellum-web%E5%85%A8%E6%99%AF" target="_blank" rel="noopener">demo地址</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 3D </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AlloyFinger手势库分析</title>
      <link href="/2020/03/26/AlloyFinger%E6%89%8B%E5%8A%BF%E5%BA%93%E5%88%86%E6%9E%90/"/>
      <url>/2020/03/26/AlloyFinger%E6%89%8B%E5%8A%BF%E5%BA%93%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>移动端手势库AlloyFinger分析<br><a id="more"></a></p><h1 id="AlloyFinger手势库分析"><a href="#AlloyFinger手势库分析" class="headerlink" title="AlloyFinger手势库分析"></a>AlloyFinger手势库分析</h1><p>AlloyFinger这个移动端手势库是腾讯的AlloyTeam团队开发的，体积小，功能强大，简单易用，具体的使用方法见<a href="https://github.com/AlloyTeam/AlloyFinger" target="_blank" rel="noopener">AlloyFinger github</a><br>这两天闲暇的时候好好的读了几遍这个库的代码，写好了注释，理解了作者的思路，受益匪浅。<br>注释代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @desc 移动端手势库</span><br><span class="line"> * @desc 分析</span><br><span class="line"> */</span><br><span class="line">;</span><br><span class="line">(function(window) &#123;</span><br><span class="line">  // 获取两点间距离工具函数</span><br><span class="line">  function getLen(v) &#123;</span><br><span class="line">      return Math.sqrt(v.x * v.x + v.y * v.y);</span><br><span class="line">  &#125;</span><br><span class="line">  // dot和getAngle函数用来算两次手势状态之间的夹角, cross函数用来算方向的, getRotateAngle函数算手势真正的角度的</span><br><span class="line">  function dot(v1, v2) &#123;</span><br><span class="line">      return v1.x * v2.x + v1.y * v2.y;</span><br><span class="line">  &#125;</span><br><span class="line"> // 求两次手势状态之间的夹角</span><br><span class="line">  function getAngle(v1, v2) &#123;</span><br><span class="line">      var mr = getLen(v1) * getLen(v2);</span><br><span class="line">      if (mr === 0) return 0;</span><br><span class="line">      var r = dot(v1, v2) / mr;</span><br><span class="line">      if (r &gt; 1) r = 1;</span><br><span class="line">      return Math.acos(r);</span><br><span class="line">  &#125;</span><br><span class="line">  // 利用cross结果的正负来判断旋转的方向(大于0为逆时针, 小于0为顺时针)</span><br><span class="line">  function cross(v1, v2) &#123;</span><br><span class="line">      return v1.x * v2.y - v2.x * v1.y;</span><br><span class="line">  &#125;</span><br><span class="line">  // 如果cross大于0那就是逆时针对于屏幕是正角,对于第一象限是负角,所以 角度 * -1, 然后角度单位换算</span><br><span class="line">  function getRotateAngle(v1, v2) &#123;</span><br><span class="line">      var angle = getAngle(v1, v2);</span><br><span class="line">      if (cross(v1, v2) &gt; 0) &#123;</span><br><span class="line">          angle *= -1;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return angle * 180 / Math.PI;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var HandlerAdmin = function(el) &#123;</span><br><span class="line">      this.handlers = [];</span><br><span class="line">      this.el = el;</span><br><span class="line">  &#125;;</span><br><span class="line">  // 函数管理构造函数</span><br><span class="line">  function HandlerAdmin(el) &#123;</span><br><span class="line">    this.handlers = [];</span><br><span class="line">    this.el = el;</span><br><span class="line">  &#125;</span><br><span class="line">  // 添加需要触发的函数</span><br><span class="line">  HandlerAdmin.prototype.add = function(handler) &#123;</span><br><span class="line">    this.handlers.push(handler);</span><br><span class="line">  &#125;</span><br><span class="line">  // 删除需要触发的函数</span><br><span class="line">  HandlerAdmin.prototype.del = function(handler) &#123;</span><br><span class="line">    // 如果什么也不传，清空函数数组</span><br><span class="line">    if(!handler) &#123;</span><br><span class="line">      this.handlers = [];</span><br><span class="line">    &#125;</span><br><span class="line">    // 比对数组中的函数，并且删除它</span><br><span class="line">    for(var i=this.handlers.length; i&gt;=0; i--) &#123;</span><br><span class="line">      if(this.handlers[i] === handler) &#123;</span><br><span class="line">          this.handlers.splice(i, 1);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 运行需要触发的函数</span><br><span class="line">  HandlerAdmin.prototype.dispatch = function() &#123;</span><br><span class="line">    for(var i=0,len=this.handlers.length; i&lt;len; i++) &#123;</span><br><span class="line">        var handler = this.handlers[i];</span><br><span class="line">        // 运行这些函数的时候，是作为元素的事件触发的，所以，这些函数的this要指向这个元素</span><br><span class="line">        if(typeof handler === &apos;function&apos;) handler.apply(this.el, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 初始化函数管理对象</span><br><span class="line">  function wrapFunc(el, handler) &#123;</span><br><span class="line">    var handlerAdmin = new HandlerAdmin(el);</span><br><span class="line">    handlerAdmin.add(handler);</span><br><span class="line">    return handlerAdmin;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 手势库构造函数</span><br><span class="line">  function AlloyFinger(el, option) &#123;</span><br><span class="line">    // 获取添加事件的元素</span><br><span class="line">    this.element = typeof el === &apos;string&apos; ? document.querySelector(el) : el;</span><br><span class="line">    // 因为添加事件后这些方法的执行上下文是this.element，所以给方法bind JinuxFinger这个执行上下文</span><br><span class="line">    this.start = this.start.bind(this);</span><br><span class="line">    this.move = this.move.bind(this);</span><br><span class="line">    this.end = this.end.bind(this);</span><br><span class="line">    this.cancel = this.cancel.bind(this);</span><br><span class="line">    // 给这个元素添加事件</span><br><span class="line">    this.element.addEventListener(&quot;touchstart&quot;, this.start, false);</span><br><span class="line">    this.element.addEventListener(&quot;touchmove&quot;, this.move, false);</span><br><span class="line">    this.element.addEventListener(&quot;touchend&quot;, this.end, false);</span><br><span class="line">    this.element.addEventListener(&quot;touchcancel&quot;, this.cancel, false);</span><br><span class="line">    // 定义一些实例属性</span><br><span class="line">    this.preV = &#123; x: null, y: null &#125;; // 两个手指间的x距离和y距离</span><br><span class="line">    this.pinchStartLen = null; // 捏拽的长度</span><br><span class="line">    this.zoom = 1; // 缩放比例</span><br><span class="line">    this.isDoubleTap = false; // 是否是双击</span><br><span class="line">    var noop = function() &#123;&#125; // 空函数</span><br><span class="line">    // 实例化JinuxFinger时，设置的手势回调函数</span><br><span class="line">    this.rotate = wrapFunc(this.element, option.rotate || noop); // 旋转</span><br><span class="line">    this.touchStart = wrapFunc(this.element, option.touchStart || noop); // 触摸开始  </span><br><span class="line">    this.multipointStart = wrapFunc(this.element, option.multipointStart || noop); // 多个手指触摸开始 </span><br><span class="line">    this.multipointEnd = wrapFunc(this.element, option.multipointEnd || noop); // 多个手指触摸结束，如4个手指触摸，屏幕上剩下1个或不剩都会触发</span><br><span class="line">    this.pinch = wrapFunc(this.element, option.pinch || noop); // 两个手指捏拽</span><br><span class="line">    this.swipe = wrapFunc(this.element, option.swipe || noop); // 上下左右滑动，手指离开时触发</span><br><span class="line">    this.tap = wrapFunc(this.element, option.tap || noop); // 无论是单击还是双击都会触发</span><br><span class="line">    this.doubleTap = wrapFunc(this.element, option.doubleTap || noop); // 双击触发</span><br><span class="line">    this.longTap = wrapFunc(this.element, option.longTap || noop); // 单手指长按触发，750ms</span><br><span class="line">    this.singleTap = wrapFunc(this.element, option.singleTap || noop); // 单击触发，250ms</span><br><span class="line">    this.pressMove = wrapFunc(this.element, option.pressMove || noop); // 1个手指屏幕上移动触发</span><br><span class="line">    this.twoFingerPressMove = wrapFunc(this.element, option.twoFingerPressMove || noop); // 2个以上手指屏幕上移动触发</span><br><span class="line">    this.touchMove = wrapFunc(this.element, option.touchMove || noop); // 无论几个手指在屏幕上移动都会触发</span><br><span class="line">    this.touchEnd = wrapFunc(this.element, option.touchEnd || noop); // 触摸结束都会触发</span><br><span class="line">    this.touchCancel = wrapFunc(this.element, option.touchCancel || noop); // 事件简单的说是在移动端发生了触摸中断，一般情况下就是优先级比当前活动更高的事件时，才会触发的。比如正在看新闻，手指滑动屏幕的时候，突然来电话，直接中断了触摸事件，跳转到了通话，页面此时就触发了touchcancel事件。这个事件不容易在浏览器的模拟器中模拟，之前我在用电脑的任务栏切换的时候，受到启发，可以试试在浏览器模拟器触摸的同时，按下键盘上的Alt+Tab键，果然触发了touchcancel事件，有兴趣的小伙伴可以试一下。</span><br><span class="line">    </span><br><span class="line">    this._cancelAllHandler = this.cancelAll.bind(this);</span><br><span class="line">    // 触发window的scroll事件时，清除现有touch事件的回调函数执行</span><br><span class="line">    window.addEventListener(&apos;scroll&apos;, this._cancelAllHandler);</span><br><span class="line"></span><br><span class="line">    this.delta = null; // 双击的间隔时间</span><br><span class="line">    this.last = null; // 相对于下一次点击，前一次点击的时间</span><br><span class="line">    this.now = null; // 当前点击保存用的时间，也可以理解为相对于上一次点击，这个是当前点击的时间</span><br><span class="line">    this.tapTimeout = null;</span><br><span class="line">    this.singleTapTimeout = null;</span><br><span class="line">    this.longTapTimeout = null;</span><br><span class="line">    this.swipeTimeout = null;</span><br><span class="line">    this.x1 = this.x2 = this.y1 = this.y2 = null;</span><br><span class="line">    this.preTapPosition = &#123; x: null, y: null &#125;; // 相对于下次点击，前一次点击手指x,y坐标的保存对象</span><br><span class="line">  &#125;</span><br><span class="line">  AlloyFinger.prototype = &#123;</span><br><span class="line">    start: function (evt) &#123;</span><br><span class="line">      if (!evt.touches) return; // 屏幕上没有手指则返回</span><br><span class="line">      this.now = Date.now(); // 设置touch开始时的时间</span><br><span class="line">      this.x1 = evt.touches[0].pageX; // 第一个手指触点相对于HTML文档左边沿的的X坐标. 当存在水平滚动的偏移时, 这个值包含了水平滚动</span><br><span class="line">      this.y1 = evt.touches[0].pageY; // 第一个手指触点相对于HTML文档左边沿的的Y坐标</span><br><span class="line">      this.delta = this.now - (this.last || this.now); // 双击的间隔时间</span><br><span class="line">      this.touchStart.dispatch(evt, this.element); // 触发了touchStart回调函数</span><br><span class="line">      if (this.preTapPosition.x !== null) &#123; // 如果不为null，说明之前已经有点击了</span><br><span class="line">          // 判断是否满足手指双击条件</span><br><span class="line">          this.isDoubleTap = (this.delta &gt; 0 &amp;&amp; this.delta &lt;= 250 &amp;&amp; Math.abs(this.preTapPosition.x - this.x1) &lt; 30 &amp;&amp; Math.abs(this.preTapPosition.y - this.y1) &lt; 30);</span><br><span class="line">          if (this.isDoubleTap) clearTimeout(this.singleTapTimeout);</span><br><span class="line">      &#125;</span><br><span class="line">      this.preTapPosition.x = this.x1; // 保存当前手指x坐标</span><br><span class="line">      this.preTapPosition.y = this.y1;// 保存当前手指y坐标</span><br><span class="line">      this.last = this.now; // 保存当前时间</span><br><span class="line">      var preV = this.preV, </span><br><span class="line">          len = evt.touches.length; // 现在屏幕上有多少个手指</span><br><span class="line">      if (len &gt; 1) &#123; // 两个手指以上触摸情况</span><br><span class="line">          this._cancelLongTap(); // 清除长按回调函数的执行</span><br><span class="line">          this._cancelSingleTap(); // 清除点击函数的执行</span><br><span class="line">          // 计算两个手指x,y的距离</span><br><span class="line">          var v = &#123; x: evt.touches[1].pageX - this.x1, y: evt.touches[1].pageY - this.y1 &#125;;</span><br><span class="line">          // 赋值给preV</span><br><span class="line">          preV.x = v.x; </span><br><span class="line">          preV.y = v.y;</span><br><span class="line">          this.pinchStartLen = getLen(preV); // 计算出两个手指间的距离</span><br><span class="line">          this.multipointStart.dispatch(evt, this.element); // 触发多点触碰函数回调</span><br><span class="line">      &#125;</span><br><span class="line">      this._preventTap = false; // 长按是否回调执行，否 </span><br><span class="line">      this.longTapTimeout = setTimeout(function () &#123; // 长按触发回调函数的定时器</span><br><span class="line">          this.longTap.dispatch(evt, this.element); // 触发长按回调函数</span><br><span class="line">          this._preventTap = true; // 长按是否回调执行，是</span><br><span class="line">      &#125;.bind(this), 750); // 长按是手指按下750ms后触发</span><br><span class="line">  &#125;,</span><br><span class="line">  move: function (evt) &#123;</span><br><span class="line">      if (!evt.touches) return; // 没有touches属性则返回</span><br><span class="line">      var preV = this.preV, // 两个手指间距离暂存preV里</span><br><span class="line">          len = evt.touches.length, // 屏幕上的手指数</span><br><span class="line">          currentX = evt.touches[0].pageX, // 屏幕上第一个手指的pageX暂存</span><br><span class="line">          currentY = evt.touches[0].pageY; // 屏幕上第一个手指的pageY暂存</span><br><span class="line">      this.isDoubleTap = false; // 手指移动了，就不是双击了</span><br><span class="line">      if (len &gt; 1) &#123; // 手指大于2个情况</span><br><span class="line">          var sCurrentX = evt.touches[1].pageX, // 屏幕上第2个手指的pageX暂存</span><br><span class="line">              sCurrentY = evt.touches[1].pageY; // 屏幕上第2个手指的pageY暂存</span><br><span class="line">          // 两个手指间距离</span><br><span class="line">          var v = &#123; x: evt.touches[1].pageX - currentX, y: evt.touches[1].pageY - currentY &#125;;</span><br><span class="line"></span><br><span class="line">          if (preV.x !== null) &#123;</span><br><span class="line">              if (this.pinchStartLen &gt; 0) &#123; // move之前两指间的距离如果大于0情况</span><br><span class="line">                  evt.zoom = getLen(v) / this.pinchStartLen; // move后的距离/move前的，就是捏拽的比例</span><br><span class="line">                  this.pinch.dispatch(evt, this.element); // 触发捏拽回调，并将zoom属性传递到事件对象里</span><br><span class="line">              &#125;</span><br><span class="line">              // 获取手指移动的角度</span><br><span class="line">              evt.angle = getRotateAngle(v, preV);</span><br><span class="line">              this.rotate.dispatch(evt, this.element); // 触发旋转回调函数</span><br><span class="line">          &#125;</span><br><span class="line">          preV.x = v.x; // move时将现在两指间的距离x赋值给preV</span><br><span class="line">          preV.y = v.y; // move时将现在两指间的距离y赋值给preV</span><br><span class="line"></span><br><span class="line">          if (this.x2 !== null &amp;&amp; this.sx2 !== null) &#123; // 因为是两个手指，所以取的是两个手指中间的值，两次move之间的偏移量,参考下变一个手指情况</span><br><span class="line">              evt.deltaX = (currentX - this.x2 + sCurrentX - this.sx2) / 2;</span><br><span class="line">              evt.deltaY = (currentY - this.y2 + sCurrentY - this.sy2) / 2;</span><br><span class="line">          &#125; else &#123; // 第一次移动都为0</span><br><span class="line">              evt.deltaX = 0;</span><br><span class="line">              evt.deltaY = 0;</span><br><span class="line">          &#125;</span><br><span class="line">          this.twoFingerPressMove.dispatch(evt, this.element); // 两个以上手指移动的事件回调</span><br><span class="line"></span><br><span class="line">          this.sx2 = sCurrentX; // 第二个手指坐标x暂存</span><br><span class="line">          this.sy2 = sCurrentY; // 第二个手指坐标y暂存</span><br><span class="line">      &#125; else &#123; // 单指move情况下</span><br><span class="line">          if (this.x2 !== null) &#123; // 第一次移动this.x2=null的,第二次之后才为true</span><br><span class="line">              evt.deltaX = currentX - this.x2; // x方向两次move事件的差值</span><br><span class="line">              evt.deltaY = currentY - this.y2; // y方向两次move事件的差值</span><br><span class="line"></span><br><span class="line">              //move事件中添加对当前触摸点到初始触摸点的判断，</span><br><span class="line">              //如果曾经大于过某个距离(比如10),就认为是移动到某个地方又移回来，应该不再触发tap事件才对。</span><br><span class="line">              var movedX = Math.abs(this.x1 - this.x2),</span><br><span class="line">                  movedY = Math.abs(this.y1 - this.y2);</span><br><span class="line"></span><br><span class="line">              if(movedX &gt; 10 || movedY &gt; 10)&#123;</span><br><span class="line">                  this._preventTap = true;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">          &#125; else &#123; // 第一次移动都为0</span><br><span class="line">              evt.deltaX = 0;</span><br><span class="line">              evt.deltaY = 0;</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">          this.pressMove.dispatch(evt, this.element); // 一个手指移动的触发回调</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.touchMove.dispatch(evt, this.element); // 有移动就触发touchMove事件回调</span><br><span class="line"></span><br><span class="line">      this._cancelLongTap(); // 有移动事件了，清除长按的事件回调</span><br><span class="line">      this.x2 = currentX; // 将当前第一个手指的坐标x复制给this.x2</span><br><span class="line">      this.y2 = currentY; // 将当前第一个手指的坐标y复制给this.y2</span><br><span class="line">      </span><br><span class="line">      if (len &gt; 1) &#123; // 两个以上手指，阻止浏览器默认事件</span><br><span class="line">          evt.preventDefault();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  end: function (evt) &#123;</span><br><span class="line">      if (!evt.changedTouches) return; // end事件触发时，changedTouches为空，则返回</span><br><span class="line">      this._cancelLongTap(); // 取消长按的回调函数</span><br><span class="line">      var self = this; // this暂存在bianliangself</span><br><span class="line">      if (evt.touches.length &lt; 2) &#123; // 目前屏幕上留下的手指0或者1个</span><br><span class="line">          this.multipointEnd.dispatch(evt, this.element); // 调用多指触摸的结束回调</span><br><span class="line">          this.sx2 = this.sy2 = null;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      //swipe</span><br><span class="line">      // this.x2或this.y2有值说明有在屏幕上移动，并且计算移动后离开屏幕时的坐标与this.x1手指刚触摸屏幕时的坐标差值大于30，可以出发swipe事件回调</span><br><span class="line">      if ((this.x2 &amp;&amp; Math.abs(this.x1 - this.x2) &gt; 30) ||</span><br><span class="line">          (this.y2 &amp;&amp; Math.abs(this.y1 - this.y2) &gt; 30)) &#123;</span><br><span class="line">          // 获取滑动的方向  </span><br><span class="line">          evt.direction = this._swipeDirection(this.x1, this.x2, this.y1, this.y2);</span><br><span class="line">          this.swipeTimeout = setTimeout(function () &#123; // 触发swipe回调函数，加入宏任务队列</span><br><span class="line">              self.swipe.dispatch(evt, self.element);</span><br><span class="line"></span><br><span class="line">          &#125;, 0)</span><br><span class="line">      &#125; else &#123; // 这里说明不是swipe事件，只是点击事件</span><br><span class="line">          this.tapTimeout = setTimeout(function () &#123; // 点击定时器</span><br><span class="line">              if(!self._preventTap)&#123; // 长按事件函数没有执行</span><br><span class="line">                  self.tap.dispatch(evt, self.element); // 执行tap回调</span><br><span class="line">              &#125;</span><br><span class="line">              // trigger double tap immediately</span><br><span class="line">              if (self.isDoubleTap) &#123; // 如果是双击的话</span><br><span class="line">                  self.doubleTap.dispatch(evt, self.element); // 执行双击事件回调</span><br><span class="line">                  self.isDoubleTap = false; // 执行之后设置双击标识为假</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;, 0)</span><br><span class="line"></span><br><span class="line">          if (!self.isDoubleTap) &#123; // 如果不是双击操作</span><br><span class="line">              self.singleTapTimeout = setTimeout(function () &#123; // 250ms后执行singleTap事件回调</span><br><span class="line">                  self.singleTap.dispatch(evt, self.element);</span><br><span class="line">              &#125;, 250);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.touchEnd.dispatch(evt, this.element); // 手指离开都会触发touchEnd事件回调</span><br><span class="line">      // 手指离开后将一些属性重置</span><br><span class="line">      this.preV.x = 0;</span><br><span class="line">      this.preV.y = 0;</span><br><span class="line">      this.zoom = 1;</span><br><span class="line">      this.pinchStartLen = null;</span><br><span class="line">      this.x1 = this.x2 = this.y1 = this.y2 = null;</span><br><span class="line">  &#125;,</span><br><span class="line">  cancelAll: function () &#123;</span><br><span class="line">      this._preventTap = true; // 阻止tap事件</span><br><span class="line">      clearTimeout(this.singleTapTimeout); // 清除singleTapTimeout定时器</span><br><span class="line">      clearTimeout(this.tapTimeout); // 清除tapTimeout定时器</span><br><span class="line">      clearTimeout(this.longTapTimeout); // 清除longTapTimeout定时器</span><br><span class="line">      clearTimeout(this.swipeTimeout); // 清除swipeTimeout定时器</span><br><span class="line">  &#125;,</span><br><span class="line">  cancel: function (evt) &#123; // cancel事件</span><br><span class="line">      this.cancelAll()</span><br><span class="line">      this.touchCancel.dispatch(evt, this.element); // 触发touchCancel回调</span><br><span class="line">  &#125;,</span><br><span class="line">  _cancelLongTap: function () &#123; // 清除longTapTimeout定时器函数</span><br><span class="line">      clearTimeout(this.longTapTimeout);</span><br><span class="line">  &#125;,</span><br><span class="line">  _cancelSingleTap: function () &#123; // 清除singleTapTimeout定时器函数</span><br><span class="line">      clearTimeout(this.singleTapTimeout);</span><br><span class="line">  &#125;,</span><br><span class="line">  // 计算swipe的方向函数</span><br><span class="line">  _swipeDirection: function (x1, x2, y1, y2) &#123;</span><br><span class="line">      return Math.abs(x1 - x2) &gt;= Math.abs(y1 - y2) ? (x1 - x2 &gt; 0 ? &apos;Left&apos; : &apos;Right&apos;) : (y1 - y2 &gt; 0 ? &apos;Up&apos; : &apos;Down&apos;)</span><br><span class="line">  &#125;,</span><br><span class="line">  // 使用实例给事件添加回调函数</span><br><span class="line">  on: function(evt, handler) &#123;</span><br><span class="line">      if(this[evt]) &#123;</span><br><span class="line">          this[evt].add(handler);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 使用实例给事件删除回调函数</span><br><span class="line">  off: function(evt, handler) &#123;</span><br><span class="line">      if(this[evt]) &#123;</span><br><span class="line">          this[evt].del(handler);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 实例销毁函数</span><br><span class="line">  destroy: function() &#123;</span><br><span class="line">      if(this.singleTapTimeout) clearTimeout(this.singleTapTimeout);</span><br><span class="line">      if(this.tapTimeout) clearTimeout(this.tapTimeout);</span><br><span class="line">      if(this.longTapTimeout) clearTimeout(this.longTapTimeout);</span><br><span class="line">      if(this.swipeTimeout) clearTimeout(this.swipeTimeout);</span><br><span class="line"></span><br><span class="line">      this.element.removeEventListener(&quot;touchstart&quot;, this.start);</span><br><span class="line">      this.element.removeEventListener(&quot;touchmove&quot;, this.move);</span><br><span class="line">      this.element.removeEventListener(&quot;touchend&quot;, this.end);</span><br><span class="line">      this.element.removeEventListener(&quot;touchcancel&quot;, this.cancel);</span><br><span class="line"></span><br><span class="line">      this.rotate.del();</span><br><span class="line">      this.touchStart.del();</span><br><span class="line">      this.multipointStart.del();</span><br><span class="line">      this.multipointEnd.del();</span><br><span class="line">      this.pinch.del();</span><br><span class="line">      this.swipe.del();</span><br><span class="line">      this.tap.del();</span><br><span class="line">      this.doubleTap.del();</span><br><span class="line">      this.longTap.del();</span><br><span class="line">      this.singleTap.del();</span><br><span class="line">      this.pressMove.del();</span><br><span class="line">      this.twoFingerPressMove.del()</span><br><span class="line">      this.touchMove.del();</span><br><span class="line">      this.touchEnd.del();</span><br><span class="line">      this.touchCancel.del();</span><br><span class="line"></span><br><span class="line">      this.preV = this.pinchStartLen = this.zoom = this.isDoubleTap = this.delta = this.last = this.now = this.tapTimeout = this.singleTapTimeout = this.longTapTimeout = this.swipeTimeout = this.x1 = this.x2 = this.y1 = this.y2 = this.preTapPosition = this.rotate = this.touchStart = this.multipointStart = this.multipointEnd = this.pinch = this.swipe = this.tap = this.doubleTap = this.longTap = this.singleTap = this.pressMove = this.touchMove = this.touchEnd = this.touchCancel = this.twoFingerPressMove = null;</span><br><span class="line"></span><br><span class="line">      window.removeEventListener(&apos;scroll&apos;, this._cancelAllHandler);</span><br><span class="line">      return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 暴露给外部使用</span><br><span class="line">  if (typeof module !== &apos;undefined&apos; &amp;&amp; typeof exports === &apos;object&apos;) &#123;</span><br><span class="line">    module.exports = AlloyFinger;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      window.AlloyFinger = AlloyFinger;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(window)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写call,apply,bind函数</title>
      <link href="/2020/03/25/%E6%89%8B%E5%86%99call-apply-bind%E5%87%BD%E6%95%B0/"/>
      <url>/2020/03/25/%E6%89%8B%E5%86%99call-apply-bind%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>手写call,apply,bind函数<br><a id="more"></a></p><h1 id="手写call-apply-bind函数"><a href="#手写call-apply-bind函数" class="headerlink" title="手写call,apply,bind函数"></a>手写call,apply,bind函数</h1><h2 id="call"><a href="#call" class="headerlink" title="call"></a>call</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myCall = function(context) &#123;</span><br><span class="line">    context = context || window;</span><br><span class="line">    var arg = Array.prototype.slice.call(arguments, 1);</span><br><span class="line">    context.fn = this;</span><br><span class="line">    var result = context.fn(...arg);</span><br><span class="line">    delete context.fn;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var testObj = &#123;</span><br><span class="line">    name: 123</span><br><span class="line">&#125;</span><br><span class="line">function testFn(a,b,c) &#123;</span><br><span class="line">    console.log(this, a, b, c);</span><br><span class="line">    return 555;</span><br><span class="line">&#125;</span><br><span class="line">testFn.myCall(testObj, 1, 2, 3);</span><br></pre></td></tr></table></figure></p><h2 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myApply = function(context) &#123;</span><br><span class="line">    context = context || window;</span><br><span class="line">    var arg = arguments[1];</span><br><span class="line">    context.fn = this;</span><br><span class="line">    var result = context.fn(...arg);</span><br><span class="line">    delete context.fn;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var testObj = &#123;</span><br><span class="line">    name: 123</span><br><span class="line">&#125;</span><br><span class="line">function testFn(a,b,c) &#123;</span><br><span class="line">    console.log(this, a, b, c);</span><br><span class="line">    return 555;</span><br><span class="line">&#125;</span><br><span class="line">testFn.myApply(testObj, [1, 2, 3]);</span><br></pre></td></tr></table></figure></p><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myBind = function(context) &#123;</span><br><span class="line">  if (typeof this !== &apos;function&apos;) &#123;</span><br><span class="line">    throw new TypeError(&apos;Error&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">  let _this = this</span><br><span class="line">  let args = [...arguments].slice(1)</span><br><span class="line">  return function F() &#123;</span><br><span class="line">    // 判断是否被当做构造函数使用</span><br><span class="line">    if (this instanceof F) &#123;</span><br><span class="line">      return _this.apply(this, args.concat([...arguments]))</span><br><span class="line">    &#125;</span><br><span class="line">    return _this.apply(context, args.concat([...arguments]))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var testObj = &#123;</span><br><span class="line">    name: 123</span><br><span class="line">&#125;</span><br><span class="line">function testFn(a,b,c) &#123;</span><br><span class="line">    console.log(this, a, b, c);</span><br><span class="line">    return 555;</span><br><span class="line">&#125;</span><br><span class="line">testFn.myBind(testObj, 1)(2, 3);</span><br></pre></td></tr></table></figure></p><p>以上就是我们常用的call，apply，bind函数的手写实现，但是，用到了es6的[…arg]结构语法，下面只写一个call实现的es5版本。</p><h2 id="call-es5版"><a href="#call-es5版" class="headerlink" title="call es5版"></a>call es5版</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myCall = function(context) &#123;</span><br><span class="line">    context = context || window;</span><br><span class="line">    var arg = Array.prototype.slice.call(arguments, 1);</span><br><span class="line">    context.fn = this;</span><br><span class="line">    var fnStr = `context.fn(`;</span><br><span class="line">    for(var i=0, len=arg.length; i&lt;len; i++) &#123;</span><br><span class="line">        if(i === (len-1)) &#123;</span><br><span class="line">            fnStr += arg[i];    </span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            fnStr += arg[i] + &apos;,&apos;;   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fnStr += &apos;)&apos;;</span><br><span class="line">    console.log(fnStr);</span><br><span class="line">    var result = eval(fnStr);</span><br><span class="line">    delete context.fn;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var testObj = &#123;</span><br><span class="line">    name: 123</span><br><span class="line">&#125;</span><br><span class="line">function testFn(a,b,c) &#123;</span><br><span class="line">    console.log(this, a, b, c);</span><br><span class="line">    return 555;</span><br><span class="line">&#125;</span><br><span class="line">testFn.myCall(testObj, 1, 2, 3);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写Promise</title>
      <link href="/2020/03/20/%E6%89%8B%E5%86%99Promise/"/>
      <url>/2020/03/20/%E6%89%8B%E5%86%99Promise/</url>
      
        <content type="html"><![CDATA[<p>模拟一个Promise功能<br><a id="more"></a></p><h1 id="手写Promise"><a href="#手写Promise" class="headerlink" title="手写Promise"></a>手写Promise</h1><p>现在的异步基本上都是用Promise来实现的，用起来很方便，但是，Promise是怎么实现的呢，它的then回调是怎么工作的，带着这些疑问，决定自己实现一个Promise。<br>早在2年前，其实我就实现过一个Promise，不过那个原理比较笨，还用到了定时器循环，后来陆续看了些其他人的写法，还是有点没绕明白，这两天又看了向军老师的实现方式，觉得很好，自己也实现一下。<br>主要的难以理解的地方是then函数的写法，这个地方明白了整个Promise也就理解了。<br>代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">class MyPromise &#123;</span><br><span class="line">  // 等待状态</span><br><span class="line">  static PENDING = &quot;pending&quot;;</span><br><span class="line">  // 成功状态</span><br><span class="line">  static FULFILLED = &quot;fulfilled&quot;;</span><br><span class="line">  // 拒绝状态</span><br><span class="line">  static REJECTED = &quot;rejected&quot;;</span><br><span class="line">  constructor(executor) &#123;</span><br><span class="line">    // 默认状态是等待</span><br><span class="line">    this.status = MyPromise.PENDING;</span><br><span class="line">    // 成功值</span><br><span class="line">    this.value = null;</span><br><span class="line">    // 拒绝值</span><br><span class="line">    this.reason = null;</span><br><span class="line">    // then的回调数组</span><br><span class="line">    this.callbacks = [];</span><br><span class="line">    try &#123;</span><br><span class="line">      executor(this.resolve.bind(this), this.reject.bind(this));</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      this.reject(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 成功调用函数</span><br><span class="line">  resolve(value) &#123;</span><br><span class="line">    if(this.status === MyPromise.PENDING) &#123;</span><br><span class="line">      this.value = value;</span><br><span class="line">      this.status = MyPromise.FULFILLED;</span><br><span class="line">      setTimeout(()=&gt; &#123;</span><br><span class="line">        this.callbacks.forEach(item=&gt; &#123;</span><br><span class="line">          item.onFulfilled(this.value);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 拒绝调用函数</span><br><span class="line">  reject(reason) &#123;</span><br><span class="line">    if(this.status === MyPromise.PENDING) &#123;</span><br><span class="line">      this.reason = reason;</span><br><span class="line">      this.status = MyPromise.REJECTED;</span><br><span class="line">      setTimeout(()=&gt; &#123;</span><br><span class="line">        this.callbacks.forEach(item=&gt; &#123;</span><br><span class="line">          item.onRejected(this.reason);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // then函数</span><br><span class="line">  then(onFulfilled, onRejected) &#123;</span><br><span class="line">    if (typeof onFulfilled != &quot;function&quot;) &#123;</span><br><span class="line">      onFulfilled = () =&gt; this.value;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof onRejected != &quot;function&quot;) &#123;</span><br><span class="line">      onRejected = () =&gt; this.reason;</span><br><span class="line">    &#125;</span><br><span class="line">    // 链式调用，返回一个MyPromise</span><br><span class="line">    const p = new MyPromise((resolve, reject)=&gt; &#123;</span><br><span class="line">      if(this.status === MyPromise.PENDING) &#123;</span><br><span class="line">        this.callbacks.push(&#123;</span><br><span class="line">          onFulfilled: (value)=&gt; &#123;</span><br><span class="line">            let result = onFulfilled(value);</span><br><span class="line">            if(result instanceof MyPromise) &#123;</span><br><span class="line">              result.then(resolve, reject);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">              resolve(result);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          onRejected: (value)=&gt; &#123;</span><br><span class="line">            let result = onRejected(value);</span><br><span class="line">            if(result instanceof MyPromise) &#123;</span><br><span class="line">              result.then(resolve, reject);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">              resolve(result);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      if(this.status === MyPromise.FULFILLED) &#123;</span><br><span class="line">        setTimeout(()=&gt; &#123;</span><br><span class="line">          let result = onFulfilled(this.value);</span><br><span class="line">          if(result instanceof MyPromise) &#123;</span><br><span class="line">            result.then(resolve, reject);</span><br><span class="line">          &#125;else &#123;</span><br><span class="line">            resolve(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      if(this.status === MyPromise.REJECTED) &#123;</span><br><span class="line">        setTimeout(()=&gt; &#123;</span><br><span class="line">          let result = onRejected(this.reason);</span><br><span class="line">          if(result instanceof MyPromise) &#123;</span><br><span class="line">            result.then(resolve, reject);</span><br><span class="line">          &#125;else &#123;</span><br><span class="line">            resolve(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    return p;</span><br><span class="line">  &#125;</span><br><span class="line">  // MyPromise.resolve方法</span><br><span class="line">  static resolve(value) &#123;</span><br><span class="line">    return new MyPromise((resolve, reject)=&gt; &#123;</span><br><span class="line">      if(value instanceof MyPromise) &#123;</span><br><span class="line">        value.then(resolve, reject);</span><br><span class="line">      &#125;</span><br><span class="line">      resolve(value);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  // MyPromise.reject方法</span><br><span class="line">  static reject(reason) &#123;</span><br><span class="line">    return new MyPromise((resolve, reject)=&gt; &#123;</span><br><span class="line">      reject(reason);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  // MyPromise.all方法</span><br><span class="line">  static all(promises) &#123;</span><br><span class="line">    return new MyPromise((resolve, reject)=&gt; &#123;</span><br><span class="line">      let values = [];</span><br><span class="line">      promises.forEach(item =&gt; &#123;</span><br><span class="line">        item.then(</span><br><span class="line">          value=&gt; &#123;</span><br><span class="line">            values.push(value);</span><br><span class="line">            if(values.length === promises.length) &#123;</span><br><span class="line">              resolve(values);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          reason=&gt; &#123;</span><br><span class="line">            reject(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  // MyPromise.race方法</span><br><span class="line">  static race(promises) &#123;</span><br><span class="line">    return new MyPromise((resolve, reject)=&gt; &#123;</span><br><span class="line">      promises.forEach(item =&gt; &#123;</span><br><span class="line">        item.then(</span><br><span class="line">          value=&gt; &#123;</span><br><span class="line">            resolve(value);</span><br><span class="line">          &#125;,</span><br><span class="line">          reason=&gt; &#123;</span><br><span class="line">            reject(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>demo代码<a href="https://github.com/jinux7/study-collections/tree/master/%E6%89%8B%E5%86%99promise" target="_blank" rel="noopener">点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs环境变量NODE_ENV</title>
      <link href="/2020/03/17/nodejs%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FNODE-ENV/"/>
      <url>/2020/03/17/nodejs%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FNODE-ENV/</url>
      
        <content type="html"><![CDATA[<p>nodejs环境变量NODE_ENV的设置和获取<br><a id="more"></a></p><h1 id="nodejs环境变量NODE-ENV"><a href="#nodejs环境变量NODE-ENV" class="headerlink" title="nodejs环境变量NODE_ENV"></a>nodejs环境变量NODE_ENV</h1><p>我们在使用webpack打包的时候，会根据环境变量的不同做各种操作，那么，环境变量是如何设置和获取的呢？<br>首先说一下，在命令行中设置的环境变量是临时的，当命令行关闭后就没有了，要想持久化的设置环境变量，只能到我的电脑，属性，高级，环境变量里设置。</p><p>首先，创建一个app.js的文件，内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(process.env.NODE_ENV);</span><br></pre></td></tr></table></figure></p><p>我们把环境变量打印出来看看。<br>在命令行下(window系统的cmd可以，powershell和git bash不行)，输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set NODE_ENV=pro &amp;&amp; node app.js</span><br></pre></td></tr></table></figure></p><p>打印出<code>pro</code><br>如果想在powershell和git bash都可以使用，那就得利用npm，在package.json中的scripts里：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;pro&quot;: &quot;set NODE_ENV=pro &amp;&amp; node app.js&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><p>利用npm可以获取NODE_ENV的值。<br>这种方法的不足是，<code>set NODE_ENV=pro</code>是window的方式，而linux和ios是<code>export NODE_ENV=&#39;pro&#39;</code>,为了一套命令的兼容性，<br>我们可以使用<code>cross-env</code>这个nodejs模块，使用方法是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;main&quot;: &quot;app.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;cross-env NODE_ENV=dev node app.js&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><p>好了，我们已经可以获取NODE_ENV环境变量了。<br>再介绍一个可以获取命令行参数的方便方法，<code>process.env.npm_config_argv</code><br>看名字就知道，只能在npm命令下使用，我们来看看具体使用方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(process.env.npm_config_argv);</span><br></pre></td></tr></table></figure></p><p>当我们执行<code>npm run dev</code><br>打印出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;remain&quot;:[],&quot;cooked&quot;:[&quot;run&quot;,&quot;dev&quot;],&quot;original&quot;:[&quot;run&quot;,&quot;dev&quot;]&#125;</span><br></pre></td></tr></table></figure></p><p>我们可以分析是dev还是pro来处理不同操作。<br>其实，我们想做的莫非就是利用命令行中不同的参数做不同的操作而已，nodejs有一个<code>process.argv</code>属性，可以获取命令行下的参数，来看一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(process.argv);</span><br></pre></td></tr></table></figure></p><p>我们在命令行下执行：<code>node app.js dev pro</code>。<br>打印出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ &apos;C:\\Program Files\\nodejs\\node.exe&apos;,</span><br><span class="line">  &apos;C:\\Jinux\\test\\nodejs-env\\app.js&apos;,</span><br><span class="line">  &apos;dev&apos;,</span><br><span class="line">  &apos;pro&apos; ]</span><br></pre></td></tr></table></figure></p><p>我们还是可以根据命令行下的参数做不同的操作。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iPhoneX适配</title>
      <link href="/2020/03/13/iPhoneX%E9%80%82%E9%85%8D/"/>
      <url>/2020/03/13/iPhoneX%E9%80%82%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<p>h5在iPhoneX中的页面兼容处理<br><a id="more"></a></p><h1 id="iPhoneX适配"><a href="#iPhoneX适配" class="headerlink" title="iPhoneX适配"></a>iPhoneX适配</h1><h2 id="基础设备信息"><a href="#基础设备信息" class="headerlink" title="基础设备信息"></a>基础设备信息</h2><p>首先在了解iPhoneX适配之前，需要了解关于iPhone设备的一些基础</p><h3 id="关于iPhone的一些基础参数"><a href="#关于iPhone的一些基础参数" class="headerlink" title="关于iPhone的一些基础参数"></a>关于iPhone的一些基础参数</h3><p><img src="/2020/03/13/iPhoneX适配/1.webp" alt="img"></p><h3 id="iPhoneX设备信息"><a href="#iPhoneX设备信息" class="headerlink" title="iPhoneX设备信息"></a>iPhoneX设备信息</h3><p>iPhoneX屏幕组成：上部齐刘海sensor housing（44pt） + 安全区域safe area + 底部手势区域Home Indicator（34pt）<br>safe area（安全区域）<br><img src="/2020/03/13/iPhoneX适配/2.webp" alt="img"><br>安全区域以外的是上部“齐刘海” 和 下部“手势区域”，一般情况下，我们都会在安全区域（safe area）中进行页面的编写；</p><h2 id="iPhoneX适配-1"><a href="#iPhoneX适配-1" class="headerlink" title="iPhoneX适配"></a>iPhoneX适配</h2><h3 id="适配方案viewport-fit"><a href="#适配方案viewport-fit" class="headerlink" title="适配方案viewport-fit"></a>适配方案viewport-fit</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover&quot;&gt;</span><br></pre></td></tr></table></figure><p>viewport-fit有两个值，contain和 cover<br>默认是contain，页面内容显示在safe area中（不包括上部的齐刘海和下部的手势区域）<br>cover值：页面内容充满屏幕</p><h3 id="适配方案css-constant"><a href="#适配方案css-constant" class="headerlink" title="适配方案css constant()"></a>适配方案css constant()</h3><p>css constant()<br>有四个值：<code>safe-area-inset-top , safe-area-inset-left , safe-area-inset-right , safe-area-inset-bottom</code><br>1)当viewport-fit:contain，上面这个四个值无效<br>2)当viewport-fit:cover，这四个值需要设置，页面才会显示在安全区域中，设置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">    padding-top: constant(safe-area-inset-top);   //为导航栏+状态栏的高度 88px            </span><br><span class="line">    padding-left: constant(safe-area-inset-left);   //如果未竖屏时为0                </span><br><span class="line">    padding-right: constant(safe-area-inset-right); //如果未竖屏时为0                </span><br><span class="line">    padding-bottom: constant(safe-area-inset-bottom);//为底下圆弧的高度 34px       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="适配方案媒体查询"><a href="#适配方案媒体查询" class="headerlink" title="适配方案媒体查询"></a>适配方案媒体查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@media only screen and (device-width: 385px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)&#123;</span><br><span class="line">  // iphoneX css部分</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="viewport-fit-contain"><a href="#viewport-fit-contain" class="headerlink" title="viewport-fit:contain"></a>viewport-fit:contain</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=contain&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="viewpoer-fit-cover-css-canstant"><a href="#viewpoer-fit-cover-css-canstant" class="headerlink" title="viewpoer-fit: cover + css canstant()"></a>viewpoer-fit: cover + css canstant()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">  padding-top: constant(safe-area-inset-top);   //为导航栏+状态栏的高度 88px            </span><br><span class="line">  padding-left: constant(safe-area-inset-left);   //如果未竖屏时为0                </span><br><span class="line">  padding-right: constant(safe-area-inset-right); //如果未竖屏时为0                </span><br><span class="line">  padding-bottom: constant(safe-area-inset-bottom);//为底下圆弧的高度 34px       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="css的媒体查询"><a href="#css的媒体查询" class="headerlink" title="css的媒体查询"></a>css的媒体查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@media only screen and (device-width: 385px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)&#123;</span><br><span class="line">  // iphoneX css部分</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
            <tag> 兼容性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>generator自动运行器</title>
      <link href="/2020/03/12/generator%E8%87%AA%E5%8A%A8%E8%BF%90%E8%A1%8C%E5%99%A8/"/>
      <url>/2020/03/12/generator%E8%87%AA%E5%8A%A8%E8%BF%90%E8%A1%8C%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>手写一个generator自动运行器<br><a id="more"></a></p><h1 id="generator自动运行器"><a href="#generator自动运行器" class="headerlink" title="generator自动运行器"></a>generator自动运行器</h1><p>generator函数是es6新出的功能，之后又推出了async函数，操作异步真的是超级简单。我觉得我们在实际项目中使用generator的机会非常少，即使使用，一般也会依赖co这样的库来方便的使用generator。<br>但是我却想研究一下generator，所以写了一个generator不用手动的调用next函数，而是自动的调用。</p><h2 id="generator手动next代码"><a href="#generator手动next代码" class="headerlink" title="generator手动next代码"></a>generator手动next代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">var p1 = function() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      setTimeout(function() &#123;</span><br><span class="line">        resolve(1);</span><br><span class="line">      &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  var p2 = function(val) &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      setTimeout(function() &#123;</span><br><span class="line">        resolve(val+2);</span><br><span class="line">      &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  var p3 = function(val) &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      setTimeout(function() &#123;</span><br><span class="line">        resolve(val+3);</span><br><span class="line">      &#125;, 1500);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  var p1callback = function(res) &#123;</span><br><span class="line">    console.log(&apos;第1个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">  &#125;</span><br><span class="line">  var p2callback = function(res) &#123;</span><br><span class="line">    console.log(&apos;第2个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">  &#125;</span><br><span class="line">  var p3callback = function(res) &#123;</span><br><span class="line">    console.log(&apos;第3个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function *gen() &#123;</span><br><span class="line">    var val_1 = yield p1();</span><br><span class="line">    var val_2 = yield p2(val_1);</span><br><span class="line">    var val_3 = yield p3(val_2);</span><br><span class="line">  &#125; </span><br><span class="line">  var g = gen();</span><br><span class="line">  window.gObj = null;</span><br><span class="line">  window.gObj_index = 0;</span><br><span class="line">  gObj = g.next();</span><br><span class="line">  gObj.value.then(function(res) &#123;</span><br><span class="line">    console.log(&apos;第1个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">    gObj = g.next(res);</span><br><span class="line">    gObj.value.then(function(res) &#123;</span><br><span class="line">      console.log(&apos;第2个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">      gObj = g.next(res);</span><br><span class="line">      gObj.value.then(function(res) &#123;</span><br><span class="line">        console.log(&apos;第3个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>上面的代码，需要在generator函数里手动定义yield的表达式，之后在执行的时候需要手动的调用next函数，但是可以看出来，还是有嵌套的情况。</p><h2 id="generator自动运行代码"><a href="#generator自动运行代码" class="headerlink" title="generator自动运行代码"></a>generator自动运行代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">// p1,p2,p3是3个Promise的执行函数</span><br><span class="line">  var p1 = function() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      setTimeout(function() &#123;</span><br><span class="line">        resolve(1);</span><br><span class="line">      &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  var p2 = function(val) &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      setTimeout(function() &#123;</span><br><span class="line">        resolve(val+2);</span><br><span class="line">      &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  var p3 = function(val) &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">      setTimeout(function() &#123;</span><br><span class="line">        resolve(val+3);</span><br><span class="line">      &#125;, 1500);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  // p1callback,p2callback,p3callback对应着p1,p2,p3的回调</span><br><span class="line">  var p1callback = function(res) &#123;</span><br><span class="line">    console.log(&apos;第1个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">  &#125;</span><br><span class="line">  var p2callback = function(res) &#123;</span><br><span class="line">    console.log(&apos;第2个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">  &#125;</span><br><span class="line">  var p3callback = function(res) &#123;</span><br><span class="line">    console.log(&apos;第3个yield的callback啊-&gt;&apos;, res);</span><br><span class="line">  &#125;</span><br><span class="line">  /**</span><br><span class="line">   * @desc generator的生成函数</span><br><span class="line">   * @param &#123; Array &#125; Promise的函数数组</span><br><span class="line">   * @retuen &#123; Function &#125; generator函数</span><br><span class="line">  */</span><br><span class="line">  function gen(arr) &#123;</span><br><span class="line">    var valArr = [];</span><br><span class="line">    return function *() &#123;</span><br><span class="line">      for(var i=0; i&lt;arr.length; i++) &#123;</span><br><span class="line">        valArr[i] = yield arr[i](valArr[i-1]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  /**</span><br><span class="line">   * @desc 自动执行generator的next()的函数</span><br><span class="line">   * @param &#123; Function &#125; gen函数</span><br><span class="line">   * @param &#123; Array &#125; Promise函数对应的回调函数数组</span><br><span class="line">   * @param &#123; Any &#125; 向generator的next中传入的值</span><br><span class="line">  */</span><br><span class="line">  function co(gen, arr, res) &#123;</span><br><span class="line">    var g = gen();</span><br><span class="line">    var gObj = null;</span><br><span class="line">    var gObj_index = 0;</span><br><span class="line">    function innerCo(g, arr, res) &#123;</span><br><span class="line">      gObj = g.next(res);</span><br><span class="line">      if(gObj.done) return void 0;</span><br><span class="line">      gObj.value.then(function(res) &#123;</span><br><span class="line">        arr[gObj_index++](res);  </span><br><span class="line">        if(!gObj.done) &#123;</span><br><span class="line">          innerCo(g, arr, res);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    innerCo(g, arr, 0);</span><br><span class="line">  &#125;</span><br><span class="line">  // 执行co函数</span><br><span class="line">  co(gen([p1,p2,p3]), [p1callback, p2callback, p3callback], 0);</span><br></pre></td></tr></table></figure><p>可以看出来，最后只需要<code>co(gen([p1,p2,p3]), [p1callback, p2callback, p3callback], 0);</code>这样一行代码，省去了定义yield，省去了调用next。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>首先，我并没有去参考co这样的库的使用方法，如何使用都是自己想出来的。</li><li>目前代码只是超级简化版，我也是想验证一下我的想法而已，只有resolve的回调，并没写reject的回调。</li></ul><p>最后，<a href="https://github.com/jinux7/study-collections/tree/master/generator-co" target="_blank" rel="noopener">代码在这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端性能优化之时间切片</title>
      <link href="/2020/03/12/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%B6%E9%97%B4%E5%88%87%E7%89%87/"/>
      <url>/2020/03/12/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E6%97%B6%E9%97%B4%E5%88%87%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>前端性能优化之时间切片<br><a id="more"></a></p><h1 id="前端性能优化之时间切片"><a href="#前端性能优化之时间切片" class="headerlink" title="前端性能优化之时间切片"></a>前端性能优化之时间切片</h1><p>从用户的输入，再到显示器在视觉上给用户的输出，这一过程如果超过 100ms，那么用户会察觉到网页的卡顿，所以为了解决这个问题，每个任务不能超过 50ms，W3C 性能工作组在 LongTask 规范中也将超过 50ms 的任务定义为长任务。<br>所以为了避免长任务，一种方案是使用 Web Worker，将长任务放在 Worker 线程中执行，缺点是无法访问 DOM，而另一种方案是使用时间切片。</p><h2 id="什么是时间切片"><a href="#什么是时间切片" class="headerlink" title="什么是时间切片"></a>什么是时间切片</h2><p>时间切片的核心思想是：如果任务不能在 50 毫秒内执行完，那么为了不阻塞主线程，这个任务应该让出主线程的控制权，使浏览器可以处理其他任务。让出控制权意味着停止执行当前任务，让浏览器去执行其他任务，随后再回来继续执行没有执行完的任务。<br>所以时间切片的目的是不阻塞主线程，而实现目的的技术手段是将一个长任务拆分成很多个不超过 50ms 的小任务分散在宏任务队列中执行。<br><img src="/2020/03/12/前端性能优化之时间切片/1.png" alt="img"><br>上图可以看到主线程中有一个长任务，这个任务会阻塞主线程。使用时间切片将它切割成很多个小任务后，如下图所示。<br><img src="/2020/03/12/前端性能优化之时间切片/2.png" alt="img"><br>可以看到现在的主线程有很多密密麻麻的小任务，我们将它放大后如下图所示。<br><img src="/2020/03/12/前端性能优化之时间切片/3.png" alt="img"><br>可以看到每个小任务中间是有空隙的，代表着任务执行了一小段时间后，将让出主线程的控制权，让浏览器执行其他的任务。</p><blockquote><p>使用时间切片的缺点是，任务运行的总时间变长了，这是因为它每处理完一个小任务后，主线程会空闲出来，并且在下一个小任务开始处理之前有一小段延迟。但是为了避免卡死浏览器，这种取舍是很有必要的。</p></blockquote><h2 id="如何使用时间切片"><a href="#如何使用时间切片" class="headerlink" title="如何使用时间切片"></a>如何使用时间切片</h2><p>时间切片是一种概念，也可以理解为一种技术方案，它不是某个 API 的名字，也不是某个工具的名字。<br>事实上，时间切片充分利用了“异步”，在早期，可以使用定时器来实现，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">btn.onclick = function() &#123;</span><br><span class="line">    someThing() // 执行了50毫秒</span><br><span class="line">    setTimeout(function() &#123;</span><br><span class="line">        otherThing() // 执行了50毫秒</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上面代码当按钮被点击时，本应执行 100 毫秒的任务现在被拆分成了两个 50 毫秒的任务。<br>在实际应用中，我们可以进行一些封装，封装后的使用效果类似下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">btn.onclick = ts([someThing, otherThing], function() &#123;</span><br><span class="line">    console.log(&apos;done~&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>当然，关于ts这个函数的 API 的设计并不是本文的重点，这里想说明的是，在早期可以利用定时器来实现“时间切片”。<br>ES6 带来了迭代器的概念，并提供了生成器 Generator 函数用来生成迭代器对象，虽然 Generator 函数最正统的用法是生成迭代器对象，但这不妨我们利用它的特性做一些其他的事情。<br>Generator 函数提供了yield关键字，这个关键字可以让函数暂停执行。然后通过迭代器对象的next方法让函数继续执行。</p><blockquote><p>对 Generator 函数不熟悉的同学，需要先学习 Generator 函数的用法。<br>利用这个特性，我们可以设计出更方便使用的时间切片，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">btn.onclick = ts(function*() &#123;</span><br><span class="line">    someThing() // 执行了50毫秒</span><br><span class="line">    yield</span><br><span class="line">    otherThing() // 执行了50毫秒</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p></blockquote><p>可以看到，我们只需要使用yield这个关键字就可以将本应执行 100 毫秒的任务拆分成了两个 50 毫秒的任务。<br>我们甚至可以将 yield 关键字放在循环里：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">btn.onclick = ts(function*() &#123;</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        someThing() // 执行了50毫秒</span><br><span class="line">        yield</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>上面代码我们写了一个死循环，但依然不会阻塞主线程，浏览器也不会卡死。</p><h2 id="基于生成器的-ts-实现原理"><a href="#基于生成器的-ts-实现原理" class="headerlink" title="基于生成器的 ts 实现原理"></a>基于生成器的 ts 实现原理</h2><p>通过前面的例子，我们会发现基于 Generator 的时间切片非常好用，但其实 ts 函数的实现原理非常简单，一个最简单的 ts 函数只需要九行代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function ts(gen) &#123;</span><br><span class="line">    if (typeof gen === &apos;function&apos;) gen = gen()</span><br><span class="line">    if (!gen || typeof gen.next !== &apos;function&apos;) return</span><br><span class="line">    return function next() &#123;</span><br><span class="line">        const res = gen.next()</span><br><span class="line">        if (res.done) return</span><br><span class="line">        setTimeout(next)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>代码虽然全部只有 9 行，关键代码只有 3、4 行，但这几行代码充分利用了事件循环机制以及 Generator 函数的特性。</p><blockquote><p>创造出这样的代码我还是很开心的。</p></blockquote><p>上面代码核心思想是：通过yield关键字可以将任务暂停执行，从而让出主线程的控制权；通过定时器可以将“未完成的任务”重新放在任务队列中继续执行。</p><h2 id="避免把任务分解的过于零碎"><a href="#避免把任务分解的过于零碎" class="headerlink" title="避免把任务分解的过于零碎"></a>避免把任务分解的过于零碎</h2><p>使用yield来切割任务非常方便，但如果切割的粒度特别细，反而效率不高。假设我们的任务执行100ms，最好的方式是切割成两个执行50ms的任务，而不是切割成 100 个执行1ms的任务。假设被切割的任务之间的间隔为4ms，那么切割成 100 个执行1ms的任务的总执行时间为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1 + 4) * 100 = 500ms</span><br></pre></td></tr></table></figure></p><p>如果切割成两个执行时间为50ms的任务，那么总执行时间为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(50 + 4) * 2 = 108ms</span><br></pre></td></tr></table></figure></p><p>可以看到，在不影响用户体验的情况下，下面的总执行时间要比前面的少了 4.6 倍。<br>保证切割的任务刚好接近50ms，可以在用户使用yield时自行评估，也可以在ts函数中根据任务的执行时间判断是否应该一次性执行多个任务。<br>我们将ts函数稍微改进一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function ts(gen) &#123;</span><br><span class="line">    if (typeof gen === &apos;function&apos;) gen = gen()</span><br><span class="line">    if (!gen || typeof gen.next !== &apos;function&apos;) return</span><br><span class="line">    return function next() &#123;</span><br><span class="line">        const start = performance.now()</span><br><span class="line">        let res = null</span><br><span class="line">        do &#123;</span><br><span class="line">            res = gen.next()</span><br><span class="line">        &#125; while (!res.done &amp;&amp; performance.now() - start &lt; 25)</span><br><span class="line"></span><br><span class="line">        if (res.done) return</span><br><span class="line">        setTimeout(next)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>现在我们测试下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ts(function*() &#123;</span><br><span class="line">    const start = performance.now()</span><br><span class="line">    while (performance.now() - start &lt; 1000) &#123;</span><br><span class="line">        console.log(11)</span><br><span class="line">        yield</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&apos;done!&apos;)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p><p>这段代码在之前的版本中，在我的电脑上可以打印出 215 次 11，在后面的版本中可以打印出 6300 次 11，说明在总时间相同的情况下，可以执行更多的任务。<br>再看另一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ts(function*() &#123;</span><br><span class="line">    for (let i = 0; i &lt; 10000; i++) &#123;</span><br><span class="line">        console.log(11)</span><br><span class="line">        yield</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&apos;done!&apos;)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p><p>在我的电脑上，这段代码在之前的版本中，被切割成一万个小任务，总执行时间为 46秒，在之后的版本中，被切割成 52 个小任务，总执行时间为 1.5秒。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上代码出自于网络，这里感谢作者的付出，同时贴出作者的原创地址:<br><a href="https://ppt.baomitu.com/d/b267a4a3" target="_blank" rel="noopener">《让你的网页更丝滑》</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写mockjs</title>
      <link href="/2020/03/10/%E6%89%8B%E5%86%99mockjs/"/>
      <url>/2020/03/10/%E6%89%8B%E5%86%99mockjs/</url>
      
        <content type="html"><![CDATA[<p>简单的写一个mockjs<br><a id="more"></a></p><h1 id="手写mockjs"><a href="#手写mockjs" class="headerlink" title="手写mockjs"></a>手写mockjs</h1><p>在我们前端的开发中，mock数据是必须走的一环，我们可以完全脱离后端接口，等我们前端开发好了之后，再跟后台接口的无缝对接。<br>其实mock数据的方式有很多，比如写一些静态text文档，用nodejs写一个后台服务，都可以满足mock数据的需求。但是，最方便的莫过于使用mockjs工具库了，他可以自动的拦截ajax请求，返回配置好的mock数据。<br>我第一次这个库大概是2016年，感觉很方便，后来也想过它的实现原理是什么，不过当时没有想出来。最近在使用vue的ant pro时候，里面就使用了mockjs，于是准备自己写一个mockjs。<br>我并没有看mockjs的源码，不知道它是怎么实现的，我的想法是既然它可以拦截ajax的请求，那么肯定对原生的XMLHttpRequest做了什么处理，于是乎，我准备覆盖掉原生的XMLHttpRequest对象，这样使用ajax的时候new出来的对象是我自己写的构造函数，不就可以满足拦截ajax请求的目的了吗。<br>我只是实现了拦截ajax的初级功能，并没有深入，点到为止。<br>mockjs代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">// 将原生的XMLHttpRequest缓存起来</span><br><span class="line">window.XMLHttpRequestMock = window.XMLHttpRequest;</span><br><span class="line">// mock对象，用来存储ajax的path和返回的数据</span><br><span class="line">window.mock = &#123;</span><br><span class="line">  urlData: &#123;&#125;,</span><br><span class="line">  setPath: function(path, data) &#123;</span><br><span class="line">    this.urlData[path] = data;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line">// 覆盖原生XMLHttpRequest的构造函数</span><br><span class="line">function XmlMock() &#123;</span><br><span class="line">  this.type = null;</span><br><span class="line">  this.url = null;</span><br><span class="line">  this.onreadystatechange = null;</span><br><span class="line">&#125;</span><br><span class="line">// open方法</span><br><span class="line">XmlMock.prototype.open = function(type, url) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.url = url;</span><br><span class="line">  this.readyState = 4;</span><br><span class="line">  this.status = 200</span><br><span class="line">&#125;</span><br><span class="line">// send方法，这里会判断，如果请求的path在mock.urlData中则返回设置好据的数，</span><br><span class="line">// 如果不在，则利用原生的XMLHttpRequest来进行ajax网络请求</span><br><span class="line">XmlMock.prototype.send = function(params) &#123;</span><br><span class="line">  var path = &apos;&apos;; </span><br><span class="line">  var _this = this; </span><br><span class="line">  for(var key in mock.urlData) &#123;</span><br><span class="line">    if((this.url).indexOf(key)&gt;-1) &#123;</span><br><span class="line">      path = key;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if(path) &#123;</span><br><span class="line">    this.responseText = mock.urlData[path];</span><br><span class="line">    this.onreadystatechange(this);</span><br><span class="line">  &#125;else &#123;</span><br><span class="line">    var xhr = new XMLHttpRequestMock();</span><br><span class="line">    xhr.open(&apos;get&apos;, this.url, false);</span><br><span class="line">    xhr.onreadystatechange = function() &#123;</span><br><span class="line">      if(xhr.readyState===4&amp;&amp;xhr.status===200) &#123;</span><br><span class="line">        _this.responseText = xhr.responseText;</span><br><span class="line">        _this.onreadystatechange(_this);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.XMLHttpRequest = XmlMock;</span><br></pre></td></tr></table></figure></p><p>html使用代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;./mock.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  mock.setPath(&apos;get/小明&apos;, &#123;name: &apos;小明&apos;&#125;);</span><br><span class="line">  mock.setPath(&apos;get/小红&apos;, &#123;name: &apos;小红&apos;&#125;);</span><br><span class="line"></span><br><span class="line">  fetchData(&apos;http://jinux.top/get/小明&apos;, function(res) &#123;</span><br><span class="line">    console.log(&apos;小明mock数据-&gt;&apos;, res);</span><br><span class="line">  &#125;);</span><br><span class="line">  fetchData(&apos;http://jinux.top/get/小红&apos;, function(res) &#123;</span><br><span class="line">    console.log(&apos;小红mock数据-&gt;&apos;, res);</span><br><span class="line">  &#125;);</span><br><span class="line">  // 测试真实的ajax数据，用的实际百度的一个链接</span><br><span class="line">  var testUrl = &apos;https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/home/js/nu_instant_search_baaa58d.js&apos;;</span><br><span class="line">  fetchData(testUrl, function(res) &#123;</span><br><span class="line">    console.log(&apos;百度的真是数据-&gt;&apos;, res);</span><br><span class="line">  &#125;);</span><br><span class="line">  // 封装的ajax请求方法</span><br><span class="line">  function fetchData(url, callback) &#123;</span><br><span class="line">    var xhr = new XMLHttpRequest();</span><br><span class="line">    xhr.open(&apos;get&apos;, url, false);</span><br><span class="line">    xhr.onreadystatechange = function() &#123;</span><br><span class="line">      if(xhr.readyState===4&amp;&amp;xhr.status===200) &#123;</span><br><span class="line">        callback(xhr.responseText);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send();</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>最后，附上代码，<a href="https://github.com/jinux7/study-collections/tree/master/%E6%89%8B%E5%86%99mockjs" target="_blank" rel="noopener">点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wireshark抓包工具</title>
      <link href="/2020/03/09/wireshark%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/"/>
      <url>/2020/03/09/wireshark%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>wireshark是一款非常厉害的网络抓包工具<br><a id="more"></a></p><h1 id="wireshark抓包工具"><a href="#wireshark抓包工具" class="headerlink" title="wireshark抓包工具"></a>wireshark抓包工具</h1><p>作为一个前端开发，讨论网络抓包有点不务正业，但是知道点还是有好处的。<br>我平时用到的抓包工具有wireshark和charles，charles使用起来简单些，抓取http请求比较直观，wireshark的功能就强大得多，各种网络协议都可以解析，具体的使用细节就不说了，简单的说一下tcp协议的三次握手和四次挥手在wireshark中被抓取的数据。<br>首先看一下tcp的三次握手和四次挥手图解过程<br>1.三次握手：<br><img src="/2020/03/09/wireshark抓包工具/1.png" alt="img"><br>2.四次挥手：<br><img src="/2020/03/09/wireshark抓包工具/2.png" alt="img"><br>3.最后，wireshark抓取的数据：<br><img src="/2020/03/09/wireshark抓包工具/3.png" alt="img"><br>可以看到，前3个tcp是握手过程，最后4个tcp是挥手过程，中间的TLS协议是加密协议，因为我抓取的是https协议，所以会有加密协议。<br>本想再贴一个http协议的抓取截屏，抓了几次太乱了，还有好多失败的包，不贴了，大同小异，大概了解过程就行了，有精力的话，继续深入研究。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript严格模式</title>
      <link href="/2020/02/28/javascript%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/02/28/javascript%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>js的严格模式和普通模式的区别<br><a id="more"></a></p><h1 id="javascript严格模式"><a href="#javascript严格模式" class="headerlink" title="javascript严格模式"></a>javascript严格模式</h1><p>随着javascript的不断发展，严格模式在开发中是必须使用的，他有什么好处呢？<br>严格模式消除了一些不确定的行为，并且对某些不安全的操作抛出异常。它有助于解析引擎，优化代码，提高执行速度，也为以后新标准的制定留出余地。下面将对严格模式做一个详细的介绍。</p><h2 id="1-启用严格模式"><a href="#1-启用严格模式" class="headerlink" title="1.启用严格模式"></a>1.启用严格模式</h2><p>要使一个javascript文件运行于严格模式，只需要在文件顶部添加如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br></pre></td></tr></table></figure></p><p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br></pre></td></tr></table></figure></p><p>这行代码是一个编译指示，用以告知解析引擎以严格模式解析脚本。严格模式可以用于整个脚本或单个函数。在用于脚本文件时，”use strict”需放在所有其它语句前面。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// whole-script strict mode syntax</span><br><span class="line">&quot;use strict&quot;;</span><br><span class="line">var v = &quot;Hi! I&apos;m a strict mode script!&quot;;</span><br></pre></td></tr></table></figure></p><p>而用于函数时，需方在函数内第一行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function strict() &#123;</span><br><span class="line">  // Function-level strict mode syntax</span><br><span class="line">  &apos;use strict&apos;;</span><br><span class="line">  function nested() &#123;</span><br><span class="line">    return &quot;And so am I!&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  return &quot;Hi! I&apos;m a strict mode function@ &quot; + nested();</span><br><span class="line">&#125;</span><br><span class="line">function notStrict() &#123;</span><br><span class="line">  return &quot;I&apos;m not strict.&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-严格模式带来的变化"><a href="#2-严格模式带来的变化" class="headerlink" title="2.严格模式带来的变化"></a>2.严格模式带来的变化</h2><p>在语法和行为这两方面，严格模式都做了一些改变。这些变化主要分为以下几类。</p><ul><li>对错误抛出异常，而不是静默地忽略；</li><li>简化变量的使用，去掉引擎难以优化的语法功能；</li><li>简化eval和arguments的使用；</li><li>增加安全特性；</li><li>为javascript迎接新标准做准备；</li></ul><h3 id="1"><a href="#1" class="headerlink" title="1)"></a>1)</h3><p>对错误抛出异常，而不是静默的忽略。严格模式将过去那些能够被静默忽略的错误变成异常抛出，因为这类错误代表着代码目的的矛盾。不一致的代码也许在当时不会产生什么不良后果，但未来可能会引起严重问题。严格模式不会容忍这些错误，使得开发者能够立即发现并且解决。</p><h4 id="1-1"><a href="#1-1" class="headerlink" title="(1)"></a>(1)</h4><p>在正常模式下，对一个没有声明的变量赋值，会自动作用到全局对象上（node的global对象，浏览器的window对象）。严格模式禁止这种做法，以避免意外地修改全局对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;</span><br><span class="line">mistypedVaraible = 17; // ReferenceError</span><br></pre></td></tr></table></figure></p><p>上面的代码将会抛出类型为ReferenceError的异常</p><h4 id="2"><a href="#2" class="headerlink" title="(2)"></a>(2)</h4><p>在正常模式下，引擎会默认忽略对NaN赋值的语句，但在严格模式下，引擎会以抛异常的方式，立即向开发者反馈错误。类似的还有给一个指定为不可写的属性赋值，对只有取值函数getter的属性赋值，给一个不可扩展的对象增加属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;</span><br><span class="line">// Assignment to NaN</span><br><span class="line">NaN = &apos;a&apos;; // TypeError: Cannot assign to read noly property &apos;NaN&apos; of #&lt;Object&gt;</span><br><span class="line">// Assignment to a non-writable property</span><br><span class="line">var obj1 = &#123;&#125;;</span><br><span class="line">Object.defineProperty(obj1, &quot;x&quot;, &#123;</span><br><span class="line">  value: 42,</span><br><span class="line">  writable: false</span><br><span class="line">&#125;);</span><br><span class="line">obj1.x = 9; // throws a TypeError</span><br><span class="line">// Assignment to a getter-only property</span><br><span class="line">var obj2 = &#123;</span><br><span class="line">  get x() &#123;</span><br><span class="line">    return 18;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj2.x = 5; // throws a TypeError</span><br><span class="line">// Assignment to a new property on a non-extensible object</span><br><span class="line">var fixed = &#123;&#125;;</span><br><span class="line">Object.preventExtensions(fixed);</span><br><span class="line">fixed.newProp = &quot;ohai&quot;; // throws a TypeError</span><br></pre></td></tr></table></figure></p><h4 id="3"><a href="#3" class="headerlink" title="(3)"></a>(3)</h4><p>严格模式禁止删除一个声明为不可删除的属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">delete Object.prototype; // throws a TypeError</span><br></pre></td></tr></table></figure></p><h4 id="4"><a href="#4" class="headerlink" title="(4)"></a>(4)</h4><p>严格模式禁止声明重名属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">var o = &#123;</span><br><span class="line">  p: 1,</span><br><span class="line">  p: 2</span><br><span class="line">&#125;; // !!! syntax error</span><br></pre></td></tr></table></figure></p><h4 id="5"><a href="#5" class="headerlink" title="(5)"></a>(5)</h4><p>严格模式规定，函数的参数名必须唯一，否则抛出语法错误。在正常模式下，相同名称的参数，位置最靠后的会把前面的隐藏，但所有参数仍然可以借由arguments[i]访问，因此这种隐藏的意义不大，很可能写错了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function sum(a, a, c) &#123; // syntax error</span><br><span class="line">  &quot;use strict&quot;;</span><br><span class="line">  return a + b + c; // wrong if this code ran</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="6"><a href="#6" class="headerlink" title="(6)"></a>(6)</h4><p>八进制数的写法。ECMAScript 5 标准下的严格模式禁止八进制数，但在ECMAScript 6标准下，八进制数前面需要加0o。Node支持前面加0o的八进制数，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">// Right</span><br><span class="line">var a = 0o10; // ES6: Octal</span><br><span class="line">console.log(a);</span><br><span class="line"></span><br><span class="line">// 以下代码异常</span><br><span class="line">// SyntaxError</span><br><span class="line">var sum = 015 + // syntax error</span><br><span class="line">          197 + 142;</span><br></pre></td></tr></table></figure></p><h4 id="7"><a href="#7" class="headerlink" title="(7)"></a>(7)</h4><p>严格模式禁止为基本数据类型添加属性，以下操作非法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(function() &#123;</span><br><span class="line">  &quot;use strict&quot;;</span><br><span class="line">  false.true = &quot;&quot;; // TypeError</span><br><span class="line">  (14).sailing = &quot;home&quot;;  // TypeError</span><br><span class="line">  &quot;with&quot;.you = &quot;far away&quot;; // TypeError</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><h3 id="2-1"><a href="#2-1" class="headerlink" title="2)"></a>2)</h3><p>简化变量的使用，去掉引擎难以优化的语法功能。</p><h4 id="1-2"><a href="#1-2" class="headerlink" title="(1)"></a>(1)</h4><p>严格模式禁止使用with。with的问题在于，其语句内部的变量名只有在运行的时候才能够被决定，这使得引擎在编译阶段难以生成高效的代码。因为with代码块中的名称即有可能代表语句内部的变量，也有可能是with表达式中的对象属性，还有可能位于代码块外，甚至是全局对象的属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">var x = 18;</span><br><span class="line">with(obj) &#123; // syntax error</span><br><span class="line">  x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="2-2"><a href="#2-2" class="headerlink" title="(2)"></a>(2)</h4><p>严格模式下，eval有单独的作用域，不能够使用eval语句在它之外创建变量。正常模式下，语句<figure class="highlight plain"><figcaption><span>x;")```会为它所在的运行环境声明一个变量x，在严格模式下，x只在eval语句的内部有效。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">var x = 18;</span><br><span class="line">var evalX = eval(&quot;&apos;use strict&apos;; var x = 42; x&quot;);</span><br><span class="line">console.assert(x === 18);</span><br><span class="line">console.assert(evalX === 42);</span><br></pre></td></tr></table></figure></p><h4 id="3-1"><a href="#3-1" class="headerlink" title="(3)"></a>(3)</h4><p>严格模式禁止删除变量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">var x;</span><br><span class="line">delete x;                  // syntax error</span><br><span class="line">eval(&quot;var y; delete y;&quot;);  // syntax error</span><br></pre></td></tr></table></figure></p><h3 id="3-2"><a href="#3-2" class="headerlink" title="3)"></a>3)</h3><p>简化eval和arguments的使用。严格模式将eval和arguments的一些怪异和奇特的用法做了限制，并倾向于将eval和arguments当作关键字处理。</p><h4 id="1-3"><a href="#1-3" class="headerlink" title="(1)"></a>(1)</h4><p>严格模式不允许对eval和arguments赋值。以下语句运行都会报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">eval = 18;</span><br><span class="line">arguments++;</span><br><span class="line">++eval;</span><br><span class="line">var obj = &#123; set p(arguments) &#123; &#125; &#125;;</span><br><span class="line">var eval;</span><br><span class="line">try &#123; &#125; catch(arguments) &#123; &#125;</span><br><span class="line">function x(eval) &#123; &#125;</span><br><span class="line">function arguments() &#123; &#125;</span><br><span class="line">var y = function eval() &#123; &#125;;</span><br><span class="line">var f = new Function(&quot;arguments&quot;, &quot;&apos;use strict&apos;; return 18;&quot;);</span><br></pre></td></tr></table></figure></p><h4 id="2-3"><a href="#2-3" class="headerlink" title="(2)"></a>(2)</h4><p>在严格模式下，修改函数参数不会影响arguments，下面的示例代码能够正常运行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function f(a) &#123;</span><br><span class="line">  &quot;use strict&quot;;</span><br><span class="line">  a = 42;</span><br><span class="line">  return [a, arguments[0]];</span><br><span class="line">&#125;</span><br><span class="line">var pair = f(18);</span><br><span class="line">console.assert(pair[0] === 42);</span><br><span class="line">console.assert(pair[1] === 18);</span><br></pre></td></tr></table></figure></p><h4 id="3-3"><a href="#3-3" class="headerlink" title="(3)"></a>(3)</h4><p>arguments.callee不能再使用了。正常模式下，arguments.callee返回正在执行的函数本身的引用。在严格模式下，这种用法被禁止。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;</span><br><span class="line">var f = function() &#123;</span><br><span class="line">  return arguments.callee;</span><br><span class="line">&#125;</span><br><span class="line">f(); // throws a TypeError;</span><br></pre></td></tr></table></figure></p><h3 id="4-1"><a href="#4-1" class="headerlink" title="4)"></a>4)</h3><p>增加安全特性。在严格模式下，写出安全的代码变得更容易，引擎不会越俎代庖，除非使用者有意地这样做。</p><h4 id="1-4"><a href="#1-4" class="headerlink" title="(1)"></a>(1)</h4><p>在严格模式下，函数的上下文对象this可以是简单的值，并且避免了对全局对象的引用。在正常模式下，this只是一个对象，例如下面的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function() &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;</span><br><span class="line">f.call(true);</span><br></pre></td></tr></table></figure></p><p>运行结果为[Boolean: true]，引擎会自动地将简单类型打包为对应的对象。单严格模式不会做这样的转换。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">function f(a) &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;</span><br><span class="line">f.call(true);</span><br></pre></td></tr></table></figure></p><p>运行结果为true。<br>正常模式下，如果不指定this对象，或者指定为undefined或null，则this引用的是全局对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function f(a) &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;</span><br><span class="line">f.call(null);</span><br></pre></td></tr></table></figure></p><p>上面的代码打印出全局的global对象。但在严格模式下，除非使用call或apply明确指定this为global对象，否则this为null或者undefined。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">function f(a) &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;</span><br><span class="line">f.call(null);</span><br><span class="line">f();</span><br></pre></td></tr></table></figure></p><p>结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">null</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure></p><h4 id="2-4"><a href="#2-4" class="headerlink" title="(2)"></a>(2)</h4><p>严格模式禁止访问函数对象属性caller和arguments，这意味着不再可能遍历调用堆栈了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">function outer() &#123;</span><br><span class="line">  inner();</span><br><span class="line">&#125;</span><br><span class="line">function inner() &#123;</span><br><span class="line">  console.log(arguments.callee.caller);</span><br><span class="line">  // TypeError: &apos;caller&apos;, &apos;callee&apos;, and</span><br><span class="line">  // &apos;arguments&apos; properties may not be accessed</span><br><span class="line">  // on strict mode functions or the arguments</span><br><span class="line">  // objects for calls to them</span><br><span class="line">&#125;</span><br><span class="line">outer();</span><br></pre></td></tr></table></figure></p><h3 id="5-1"><a href="#5-1" class="headerlink" title="5)"></a>5)</h3><p>保留关键字。严格模式将implements,interface,let,package,private,protected,public,static和yield作为保留字，用户代码不能以这些名称命名变量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function package(protected) &#123; // SyntaxError</span><br><span class="line">  &quot;use strict&quot;;</span><br><span class="line">  var implements;             // SyntaxError </span><br><span class="line">  interface;                  // SyntaxError</span><br><span class="line">  while(true) &#123;</span><br><span class="line">    break interface;          // SyntaxError</span><br><span class="line">  &#125;</span><br><span class="line">  function private() &#123; &#125;      // SyntaxError</span><br><span class="line">&#125;</span><br><span class="line">function fun(static) &#123;        // SyntaxError</span><br><span class="line">  &quot;use strict&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端异常处理</title>
      <link href="/2020/02/27/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
      <url>/2020/02/27/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>异常在前端的处理<br><a id="more"></a></p><h1 id="前端异常处理"><a href="#前端异常处理" class="headerlink" title="前端异常处理"></a>前端异常处理</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>异常是不可控的，会影响最终的呈现结果，但是我们有充分的理由去做这样的事情。</p><ul><li>增强用户体验；</li><li>远程定位问题；</li><li>未雨绸缪，及早发现问题；</li><li>无法复线问题，尤其是移动端，机型，系统都是问题；</li><li>完善的前端方案，前端监控系统；</li></ul><p>对于 JS 而言，我们面对的仅仅只是异常，异常的出现不会直接导致 JS 引擎崩溃，最多只会使当前执行的任务终止。</p><p>对于前端来说，我们可做的异常捕获还真不少。总结一下，大概如下：</p><ul><li>JS 语法错误、代码异常</li><li>AJAX 请求异常</li><li>静态资源加载异常</li><li>Promise 异常</li><li>Iframe 异常</li><li>跨域 Script error</li><li>崩溃和卡顿</li></ul><p>下面我会针对每种具体情况来说明如何处理这些异常。</p><h2 id="异常分类"><a href="#异常分类" class="headerlink" title="异常分类"></a>异常分类</h2><h3 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h3><p>try-catch 只能捕获到同步的运行时错误，对语法和异步错误却无能为力，捕获不到。<br>1.同步运行时错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">  let name = &apos;jartto&apos;;</span><br><span class="line">  console.log(nam);</span><br><span class="line">&#125; catch(e) &#123;</span><br><span class="line">  console.log(&apos;捕获到异常：&apos;,e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>控制台输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">捕获到异常： ReferenceError: nam is not defined</span><br><span class="line">    at index.html:16</span><br></pre></td></tr></table></figure></p><p>2.不能捕获到具体的语法错误，只有一个语法错误提示。我们修改一下代码，删掉一个单引号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">  let name = &apos;jartto;</span><br><span class="line">  console.log(nam);</span><br><span class="line">&#125; catch(e) &#123;</span><br><span class="line">  console.log(&apos;捕获到异常：&apos;,e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>控制台输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uncaught SyntaxError: Invalid or unexpected token</span><br><span class="line">不过语法错误在我们开发阶段就可以看到，应该不会顺利上到线上环境。</span><br></pre></td></tr></table></figure></p><p>3.异步错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(nam);</span><br><span class="line">  &#125;, 1000)</span><br><span class="line">&#125; catch(e) &#123;</span><br><span class="line">  console.log(&apos;捕获到异常：&apos;,e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>控制台输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uncaught ReferenceError: nam is not defined</span><br><span class="line">    at index.html:31</span><br></pre></td></tr></table></figure></p><p>可以看出，try-catch是捕获不到异步错误的，下面会介绍异步的错误如何捕获。</p><h3 id="window-onerror"><a href="#window-onerror" class="headerlink" title="window.onerror"></a>window.onerror</h3><p>当 JS 运行时错误发生时，window 会触发一个 ErrorEvent 接口的 error 事件，并执行 window.onerror()。<br>1.同步错误和异步错误都可以捕获到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// message：错误信息（字符串）。</span><br><span class="line">// source：发生错误的脚本URL（字符串）</span><br><span class="line">// lineno：发生错误的行号（数字）</span><br><span class="line">// colno：发生错误的列号（数字）</span><br><span class="line">// error：Error对象（对象）</span><br><span class="line">window.onerror = function(message, source, lineno, colno, error) &#123;</span><br><span class="line">  console.log(&apos;捕获到异常：&apos;,&#123;message, source, lineno, colno, error&#125;);</span><br><span class="line">  return true; // 这里返回true，控制台就不会输出被捕获的那个错误自己抛出的异常提示，见下面截图。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/2020/02/27/前端异常处理/1.png" alt="img"><br><img src="/2020/02/27/前端异常处理/2.png" alt="img"><br>2.再试试语法错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">window.onerror = function(message, source, lineno, colno, error) &#123;</span><br><span class="line">  console.log(&apos;捕获到异常：&apos;,&#123;message, source, lineno, colno, error&#125;);</span><br><span class="line">&#125;</span><br><span class="line">let name = &apos;Jartto</span><br></pre></td></tr></table></figure></p><p>控制台输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught SyntaxError: Invalid or unexpected token</span><br></pre></td></tr></table></figure></p><p>语法错误还是不能捕获<br>3.我们试试网络请求异常的情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">window.onerror = function(message, source, lineno, colno, error) &#123;</span><br><span class="line">    console.log(&apos;捕获到异常：&apos;,&#123;message, source, lineno, colno, error&#125;);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;img src=&quot;./jartto.png&quot;&gt;</span><br></pre></td></tr></table></figure></p><p>不论是静态资源异常，或者接口异常，错误都无法捕获到。<br>补充一点：window.onerror 函数只有在返回 true 的时候，异常才不会向上抛出，否则即使是知道异常的发生控制台还是会显示 Uncaught Error: xxxxx，上面已经有提到过。<br>需要注意：</p><ul><li>onerror 最好写在所有 JS 脚本的前面，否则有可能捕获不到错误；</li><li>onerror 无法捕获语法错误；<br>到这里基本就清晰了：在实际的使用过程中，onerror 主要是来捕获预料之外的错误，而 try-catch 则是用来在可预见情况下监控特定的错误，两者结合使用更加高效。<h3 id="window-addEventListener"><a href="#window-addEventListener" class="headerlink" title="window.addEventListener"></a>window.addEventListener</h3>当一项资源（如图片或脚本）加载失败，加载资源的元素会触发一个 Event 接口的 error 事件，并执行该元素上的onerror() 处理函数。这些 error 事件不会向上冒泡到 window，所以我们需要在每一个元素节点上监听error事件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var nImgs = document.querySelectorAll(&apos;img&apos;);</span><br><span class="line">  nImgs.forEach(item=&gt; &#123;</span><br><span class="line">    item.addEventListener(&apos;error&apos;, function(ev) &#123;</span><br><span class="line">      console.log(&apos;捕获到异常：&apos;, ev);</span><br><span class="line">    &#125;, false);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li></ul><p>上面是来捕获页面中所有的img元素标签出现的错误。<br>控制台输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">捕获到异常： Event &#123;isTrusted: true, type: &quot;error&quot;, target: img#img, currentTarget: img#img, eventPhase: 2, …&#125;</span><br></pre></td></tr></table></figure></p><p>由于网络请求异常不会事件冒泡，因此必须在捕获阶段将其捕捉到才行，但是这种方式虽然可以捕捉到网络请求的异常，但是无法判断 HTTP 的状态是 404 还是其他比如 500 等等，所以还需要配合服务端日志才进行排查分析才可以。<br>需要注意：</p><ul><li>不同浏览器下返回的 error 对象可能不同，需要注意兼容处理。</li><li>需要注意避免 addEventListener 重复监听。</li></ul><h3 id="Promise-Catch"><a href="#Promise-Catch" class="headerlink" title="Promise Catch"></a>Promise Catch</h3><p>在 promise 中使用 catch 可以非常方便的捕获到异步 error ，这个很简单。<br>没有写 catch 的 Promise 中抛出的错误无法被 onerror 或 try-catch 捕获到，所以我们务必要在 Promise 中不要忘记写 catch 处理抛出的异常。<br>解决方案：为了防止有漏掉的 Promise 异常，建议在全局增加一个对 unhandledrejection 的监听，用来全局监听Uncaught Promise Error。使用方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&quot;unhandledrejection&quot;, function(e)&#123;</span><br><span class="line">  e.preventDefault()</span><br><span class="line">  console.log(&apos;捕获到异常：&apos;, e);</span><br><span class="line">  return true;</span><br><span class="line">&#125;);</span><br><span class="line">var pro = new Promise(function(resolve, reject) &#123;</span><br><span class="line">  reject(&apos;错误&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">// pro.catch(err=&gt; &#123;</span><br><span class="line">//   console.log(&apos;promise catch 捕获：&apos; + err);</span><br><span class="line">// &#125;);</span><br></pre></td></tr></table></figure></p><p>可以看到，如果忘记了catch的话，全局也可以捕获到Promise的错误。<br>控制台输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">捕获到异常： PromiseRejectionEvent &#123;isTrusted: true, promise: Promise, reason: &quot;错误&quot;, type: &quot;unhandledrejection&quot;, target: Window, …&#125;</span><br></pre></td></tr></table></figure></p><p>所以，正如我们上面所说，为了防止有漏掉的 Promise 异常，建议在全局增加一个对 unhandledrejection 的监听，用来全局监听 Uncaught Promise Error。<br>补充一点：如果去掉控制台的异常显示，需要加上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event.preventDefault();</span><br></pre></td></tr></table></figure></p><h3 id="iframe-异常"><a href="#iframe-异常" class="headerlink" title="iframe 异常"></a>iframe 异常</h3><p>对于 iframe 的异常捕获，我们还得借力 window.onerror<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;./iframe.html&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  window.frames[0].onerror = function (message, source, lineno, colno, error) &#123;</span><br><span class="line">    console.log(&apos;捕获到 iframe 异常：&apos;,&#123;message, source, lineno, colno, error&#125;);</span><br><span class="line">    return true;</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h3 id="Script-error"><a href="#Script-error" class="headerlink" title="Script error"></a>Script error</h3><p>一般情况，如果出现 Script error 这样的错误，基本上可以确定是出现了跨域问题。这时候，是不会有其他太多辅助信息的，但是解决思路无非如下：<br>跨源资源共享机制( CORS )：我们为 script 标签添加 crossOrigin 属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;http://jartto.wang/main.js&quot; crossorigin&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><p>或者动态去添加 js 脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const script = document.createElement(&apos;script&apos;);</span><br><span class="line">script.crossOrigin = &apos;anonymous&apos;;</span><br><span class="line">script.src = url;</span><br><span class="line">document.body.appendChild(script);</span><br></pre></td></tr></table></figure></p><p>特别注意，服务器端需要设置：Access-Control-Allow-Origin<br>此外，我们也可以试试这个-解决 Script Error 的另类思路：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const originAddEventListener = EventTarget.prototype.addEventListener;</span><br><span class="line">EventTarget.prototype.addEventListener = function (type, listener, options) &#123;</span><br><span class="line">  const wrappedListener = function (...args) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      return listener.apply(this, args);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (err) &#123;</span><br><span class="line">      throw err;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return originAddEventListener.call(this, type, wrappedListener, options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>简单解释一下：<br>改写了 EventTarget 的 addEventListener 方法；对传入的 listener 进行包装，返回包装过的 listener，对其执行进行 try-catch；浏览器不会对 try-catch 起来的异常进行跨域拦截，所以 catch 到的时候，是有堆栈信息的；重新 throw 出来异常的时候，执行的是同域代码，所以 window.onerror 捕获的时候不会丢失堆栈信息；利用包装 addEventListener，我们还可以达到「扩展堆栈」的效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(() =&gt; &#123;</span><br><span class="line">   const originAddEventListener = EventTarget.prototype.addEventListener;</span><br><span class="line">   EventTarget.prototype.addEventListener = function (type, listener, options) &#123;</span><br><span class="line">+    // 捕获添加事件时的堆栈</span><br><span class="line">+    const addStack = new Error(`Event ($&#123;type&#125;)`).stack;</span><br><span class="line">     const wrappedListener = function (...args) &#123;</span><br><span class="line">       try &#123;</span><br><span class="line">         return listener.apply(this, args);</span><br><span class="line">       &#125;</span><br><span class="line">       catch (err) &#123;</span><br><span class="line">+        // 异常发生时，扩展堆栈</span><br><span class="line">+        err.stack += &apos;\n&apos; + addStack;</span><br><span class="line">         throw err;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     return originAddEventListener.call(this, type, wrappedListener, options);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)();</span><br></pre></td></tr></table></figure></p><h3 id="崩溃和卡顿"><a href="#崩溃和卡顿" class="headerlink" title="崩溃和卡顿"></a>崩溃和卡顿</h3><p>卡顿也就是网页暂时响应比较慢， JS 可能无法及时执行。但崩溃就不一样了，网页都崩溃了，JS 都不运行了，还有什么办法可以监控网页的崩溃，并将网页崩溃上报呢？<br>崩溃和卡顿也是不可忽视的，也许会导致你的用户流失。<br>1.利用 window 对象的 load 和 beforeunload 事件实现了网页崩溃的监控。不错的文章，推荐阅读：Logging Information on Browser Crashes。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&apos;load&apos;, function () &#123;</span><br><span class="line">  sessionStorage.setItem(&apos;good_exit&apos;, &apos;pending&apos;);</span><br><span class="line">  setInterval(function () &#123;</span><br><span class="line">      sessionStorage.setItem(&apos;time_before_crash&apos;, new Date().toString());</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">window.addEventListener(&apos;beforeunload&apos;, function () &#123;</span><br><span class="line">  sessionStorage.setItem(&apos;good_exit&apos;, &apos;true&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">if(sessionStorage.getItem(&apos;good_exit&apos;) &amp;&amp;</span><br><span class="line">  sessionStorage.getItem(&apos;good_exit&apos;) !== &apos;true&apos;) &#123;</span><br><span class="line">  /*</span><br><span class="line">      insert crash logging code here</span><br><span class="line">  */</span><br><span class="line">  alert(&apos;Hey, welcome back from your crash, looks like you crashed on: &apos; + sessionStorage.getItem(&apos;time_before_crash&apos;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>2.基于以下原因，我们可以使用 Service Worker 来实现网页崩溃的监控<br>Service Worker 有自己独立的工作线程，与网页区分开，网页崩溃了，Service Worker 一般情况下不会崩溃；Service Worker 生命周期一般要比网页还要长，可以用来监控网页的状态；网页可以通过 navigator.serviceWorker.controller.postMessage API 向掌管自己的 SW 发送消息。</p><h3 id="VUE-errorHandler"><a href="#VUE-errorHandler" class="headerlink" title="VUE errorHandler"></a>VUE errorHandler</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue.config.errorHandler = (err, vm, info) =&gt; &#123;</span><br><span class="line">  console.error(&apos;通过vue errorHandler捕获的错误&apos;);</span><br><span class="line">  console.error(err);</span><br><span class="line">  console.error(vm);</span><br><span class="line">  console.error(info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="React-异常捕获"><a href="#React-异常捕获" class="headerlink" title="React 异常捕获"></a>React 异常捕获</h3><p>React 16 提供了一个内置函数 componentDidCatch，使用它可以非常简单的获取到 react 下的错误信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidCatch(error, info) &#123;</span><br><span class="line">  console.log(error, info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>除此之外，我们可以了解一下：error boundary UI 的某部分引起的 JS 错误不应该破坏整个程序，为了帮 React 的使用者解决这个问题，React 16 介绍了一种关于错误边界（error boundary)的新观念。<br>需要注意的是：error boundaries 并不会捕捉下面这些错误。</p><ul><li>事件处理器</li><li>异步代码</li><li>服务端的渲染代码</li><li>在 error boundaries 区域内的错误<br>我们来举一个小例子，在下面这个 componentDIdCatch(error,info) 里的类会变成一个 error boundary<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class ErrorBoundary extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; hasError: false &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  componentDidCatch(error, info) &#123;</span><br><span class="line">    // Display fallback UI</span><br><span class="line">    this.setState(&#123; hasError: true &#125;);</span><br><span class="line">    // You can also log the error to an error reporting service</span><br><span class="line">    logErrorToMyService(error, info);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  render() &#123;</span><br><span class="line">    if (this.state.hasError) &#123;</span><br><span class="line">      // You can render any custom fallback UI</span><br><span class="line">      return &lt;h1&gt;Something went wrong.&lt;/h1&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">    return this.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>然后我们像使用普通组件那样使用它<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ErrorBoundary&gt;</span><br><span class="line">  &lt;MyWidget /&gt;</span><br><span class="line">&lt;/ErrorBoundary&gt;</span><br></pre></td></tr></table></figure></p><p>componentDidCatch() 方法像 JS 的 catch{} 模块一样工作，但是对于组件，只有 class 类型的组件(class component )可以成为一个 error boundaries 。<br>实际上，大多数情况下我们可以在整个程序中定义一个 error boundary 组件，之后就可以一直使用它了！</p><h3 id="错误上报"><a href="#错误上报" class="headerlink" title="错误上报"></a>错误上报</h3><p>通过 Ajax 发送数据 因为 Ajax 请求本身也有可能会发生异常，而且有可能会引发跨域问题，一般情况下更推荐使用动态创建 img 标签的形式进行上报。<br>动态创建 img 标签的形式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function report(error) &#123;</span><br><span class="line">  let reportUrl = &apos;http://jartto.wang/report&apos;;</span><br><span class="line">  new Image().src = `$&#123;reportUrl&#125;?logs=$&#123;error&#125;`;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>收集异常信息量太多，怎么办？实际中，我们不得不考虑这样一种情况：如果你的网站访问量很大，那么一个必然的错误发送的信息就有很多条，这时候，我们需要设置采集率，从而减缓服务器的压力<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Reporter.send = function(data) &#123;</span><br><span class="line">  // 只采集 30%</span><br><span class="line">  if(Math.random() &lt; 0.3) &#123;</span><br><span class="line">    send(data)      // 上报错误信息</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>采集率应该通过实际情况来设定，随机数，或者某些用户特征都是不错的选择。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>回到我们开头提出的那个问题，如何优雅的处理异常呢？</p><ul><li>可疑区域增加 Try-Catch</li><li>全局监控 JS 异常 window.onerror</li><li>全局监控静态资源异常 window.addEventListener</li><li>捕获没有 Catch 的 Promise 异常：unhandledrejection</li><li>VUE errorHandler 和 React componentDidCatch</li><li>监控网页崩溃：window 对象的 load 和 beforeunload</li><li>跨域 crossOrigin 解决</li></ul><p>其实很简单，正如上文所说：采用组合方案，分类型的去捕获异常，这样基本 80%-90% 的问题都化于无形。</p><p>这篇文章部分代码<a href="https://github.com/jinux7/study-collections/tree/master/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" target="_blank" rel="noopener">点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>html元素节点的attribute&amp;property</title>
      <link href="/2020/02/24/html%E5%85%83%E7%B4%A0%E8%8A%82%E7%82%B9%E7%9A%84attribute-property/"/>
      <url>/2020/02/24/html%E5%85%83%E7%B4%A0%E8%8A%82%E7%82%B9%E7%9A%84attribute-property/</url>
      
        <content type="html"><![CDATA[<p>元素节点attr和prop区别<br><a id="more"></a></p><h1 id="html元素节点的attribute-amp-property"><a href="#html元素节点的attribute-amp-property" class="headerlink" title="html元素节点的attribute&amp;property"></a>html元素节点的attribute&amp;property</h1><p>元素节点的attrbute和property大家可能都是用过，但是也是容易被大家忽略它俩到底区别在哪里。<br>想当初在使用jquery时,$(‘ele’).attr(),$(‘’ele).prop(),这两个方法我也是没有深入研究，再后来使用angular的时候有看到attribute和property的区别，今天我好好总结一下。</p><h2 id="attribute和property如何使用"><a href="#attribute和property如何使用" class="headerlink" title="attribute和property如何使用"></a>attribute和property如何使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 这样一个input节点</span><br><span class="line">&lt;input id=&quot;inp&quot; type=&quot;text&quot; value=&quot;val&quot; /&gt;</span><br><span class="line">// 首先，使用attribute来操作</span><br><span class="line">var nEle = document.getElementById(&apos;inp&apos;);</span><br><span class="line">nEle.setAttribute(&apos;class&apos;, &apos;wrap&apos;);</span><br><span class="line">nEle.getAttribute(&apos;class&apos;);</span><br><span class="line">// 使用property来操作</span><br><span class="line">nEle.index = 1;</span><br><span class="line">nEle.type = &apos;text&apos;;</span><br></pre></td></tr></table></figure><p>其实，attribute是在这个元素节点上设置属性，而property是在这个元素节点的dom对象上设置属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 想看看元素节点的attribute属性</span><br><span class="line">nEle.attributes</span><br><span class="line">// 想看看元素节点的property属性</span><br><span class="line">console.dir(nEle);</span><br><span class="line">// 打印出来的内容可以看到attributes也在其中</span><br></pre></td></tr></table></figure></p><h2 id="attribute和property实际区别"><a href="#attribute和property实际区别" class="headerlink" title="attribute和property实际区别"></a>attribute和property实际区别</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=&quot;inp&quot; type=&quot;text&quot; value=&quot;val&quot; /&gt;</span><br><span class="line">// 还是这个元素节点</span><br><span class="line">// 页面加载时如果使用getAttribute(&apos;value&apos;)是可以获取&apos;val&apos;值的，当然，nEle.value也可以获取到</span><br><span class="line">   &apos;val&apos;。</span><br><span class="line">// 但是，如果现在你在input框中，把&apos;val&apos;改成&apos;val123&apos;</span><br><span class="line">// 你再使用getAttribute(&apos;value&apos;)方式获取到的还是&apos;val&apos;,而使用nEle.value可以获取到最新值&apos;val123&apos;</span><br><span class="line">// 从这样一个简单的操作，可以理解为，attribute时html元素上的，而property是html元素对象上的。</span><br></pre></td></tr></table></figure><p>其实，两者区别还有很多，这里不一一列举，一个小例子知道其区别就可以了。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>http请求头的安全策略</title>
      <link href="/2020/02/18/http%E8%AF%B7%E6%B1%82%E5%A4%B4%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/"/>
      <url>/2020/02/18/http%E8%AF%B7%E6%B1%82%E5%A4%B4%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<p>http请求头中相关安全的头字段<br><a id="more"></a></p><h1 id="http请求头的安全策略"><a href="#http请求头的安全策略" class="headerlink" title="http请求头的安全策略"></a>http请求头的安全策略</h1><p>我们的项目在经过开发，测试之后，还得经过安全小组的安全漏斗扫描，经常会暴漏一些返回头缺少安全字段的漏洞，今天我稍加整理常用的几个。<br>如果想了解更多的请求头和响应头的字段信息，可以看本站另一篇文章，<a href="/2019/04/15/http请求头响应头字段详解/">这里</a></p><h2 id="1-X-Frame-Options"><a href="#1-X-Frame-Options" class="headerlink" title="1.X-Frame-Options"></a>1.X-Frame-Options</h2><p>如果网站可以嵌入到IFRAME元素中，则攻击者可以在社交场合设计一种情况，即受害者被指向攻击者控制的网站，该网站构成目标网站的框架。然后攻击者可以操纵受害者在目标网站上不知不觉地执行操作。即使有跨站点请求伪造保护，这种攻击也是可能的，并且被称为“clickjacking”，有关更多信息，<a href="https://www.owasp.org/index.php/Clickjacking" target="_blank" rel="noopener">请参阅</a>。为了避免这种情况，创建了“X-Frame-Options”标题。此标题允许网站所有者决定允许哪些网站构建其网站。<br>通常的建议是将此标头设置为“SAMEORIGIN”，它只允许属于同源策略的资源构成受保护资源的框架，或者设置为“DENY”，它拒绝任何资源（本地或远程）尝试框架也提供“X-Frame-Options”标头的资源。如下所示：<br>X-Frame-Options：SAMEORIGIN<br>请注意，“X-Frame-Options”标题已被弃用，将由内容安全策略中的Frame-Options指令替换，该指令仍处于活动开发阶段。但是，“X-Frame-Options”标题目前具有更广泛的支持，因此仍应实施安全措施。<br>说白了呢，就是让你的网站禁止被嵌套。<br>demo:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;httpProtocol&gt;</span><br><span class="line">  &lt;customHeaders&gt;</span><br><span class="line">    &lt;add name=&quot;X-Frame-Options&quot; value=&quot;SAMEORIGIN&quot; /&gt;</span><br><span class="line">  &lt;/customHeaders&gt;</span><br><span class="line">&lt;/httpProtocol&gt;</span><br></pre></td></tr></table></figure></p><h2 id="2-Content-Security-Policy"><a href="#2-Content-Security-Policy" class="headerlink" title="2.Content-Security-Policy"></a>2.Content-Security-Policy</h2><p>内容安全策略（CSP）旨在允许Web应用程序的所有者通知客户端浏览器有关应用程序的预期行为（包括内容源，脚本源，插件类型和其他远程资源），这允许浏览器更多智能地执行安全约束。虽然CSP本质上是复杂的，如果没有适当部署它可能会变得混乱，一个应用良好的CSP可以大大降低利用大多数形式的跨站点脚本攻击的机会。<br>需要整个帖子来深入了解CSP允许的功能和不同设置，因此建议进一步阅读。以下是Mozilla开发者网络对CSP的<a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP" target="_blank" rel="noopener">精彩介绍性帖子</a><br>下面的简要示例显示了如何使用CSP指定您的网站希望从任何URI加载图像，从受信任的媒体提供商（包括内容分发网络）列表中插入插件内容，以及仅从您控制的服务器加载脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy：default-src&apos;self&apos;; img-src *; object-src media1.example.com media2.example.com * .cdn.example.com; script-src trustedscripts.example.com</span><br></pre></td></tr></table></figure></p><p>请注意，使用CSP的主要问题涉及策略错误配置（即使用“不安全内联”），或使用过于宽松的策略，因此在实施CSP时应特别注意。<br>这个呢，是将你引入的一切，加一个限制，这样如果别人想通过一些手段在你的网站加一些不好的东西，我们就可以有效地防止了。<br>demo:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;httpProtocol&gt;</span><br><span class="line">  &lt;customHeaders&gt;</span><br><span class="line">    &lt;add name=&quot;Content-Security-Policy&quot; value=&quot;script-src &apos;unsafe-inline&apos; http://localhost:56504; object-src &apos;none&apos;; style-src &apos;unsafe-inline&apos; http://localhost:56504;&quot; /&gt;</span><br><span class="line">    &lt;/customHeaders&gt;</span><br><span class="line">  &lt;/httpProtocol&gt;</span><br></pre></td></tr></table></figure></p><p>其中预设值有以下这些：</p><ul><li>none 不匹配任何东西。</li><li>self 匹配当前域，但不包括子域。比如 example.com 可以，api.example.com 则会匹配失败。</li><li>unsafe-inline 允许内嵌的脚本及样式。是的，没看错，对于页面中内嵌的内容也是有相应限制规则的。</li><li>unsafe-eval 允许通过字符串动态创建的脚本执行，比如 eval，setTimeout 等。</li></ul><h1 id="3-X-Content-Type-Options"><a href="#3-X-Content-Type-Options" class="headerlink" title="3.X-Content-Type-Options"></a>3.X-Content-Type-Options</h1><p>互联网上的资源有各种类型，通常浏览器会根据响应头的Content-Type字段来分辨它们的类型。例如：”text/html”代表html文档，”image/png”是PNG图片，”text/css”是CSS样式文档。然而，有些资源的Content-Type是错的或者未定义。这时，某些浏览器会启用MIME-sniffing来猜测该资源的类型，解析内容并执行。<br>例如，我们即使给一个html文档指定Content-Type为”text/plain”，在IE8-中这个文档依然会被当做html来解析。利用浏览器的这个特性，攻击者甚至可以让原本应该解析为图片的请求被解析为JavaScript。通过下面这个响应头可以禁用浏览器的类型猜测行为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Content-Type-Options: nosniff</span><br></pre></td></tr></table></figure></p><p>demo:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// php</span><br><span class="line">header(&quot;X-Content-Type-Options:nosniff&quot;);</span><br></pre></td></tr></table></figure></p><h2 id="4-X-XSS-Protection"><a href="#4-X-XSS-Protection" class="headerlink" title="4.X-XSS-Protection"></a>4.X-XSS-Protection</h2><p>顾名思义，这个响应头是用来防范XSS的。最早我是在介绍IE8的文章里看到这个，现在主流浏览器都支持，并且默认都开启了XSS保护，用这个header可以关闭它。它有几种配置：</p><ul><li>0：禁用XSS保护；</li><li>1：启用XSS保护；</li><li>1; mode=block：启用XSS保护，并在检查到XSS攻击时，停止渲染页面（例如IE8中，检查到攻击时，整个页面会被一个#替换）；<br>浏览器提供的XSS保护机制并不完美，但是开启后仍然可以提升攻击难度，总之没有特别的理由，不要关闭它。<br>demo:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// php</span><br><span class="line">header(&quot;X-XSS-Protection: 1&quot;);</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片裁剪插件</title>
      <link href="/2020/02/16/%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E6%8F%92%E4%BB%B6/"/>
      <url>/2020/02/16/%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>一个图片裁剪插件，并穿给后端<br><a id="more"></a></p><h1 id="图片裁剪插件"><a href="#图片裁剪插件" class="headerlink" title="图片裁剪插件"></a>图片裁剪插件</h1><p>我们在日常开发中，裁剪图片并上传，是经常出现的需求。前几天，就有一个这样的需求，但是要求比较特殊，于是自己写了一个图片裁剪插件，因为自己写的改起来比较灵活。</p><h2 id="其实裁剪图片无非就是"><a href="#其实裁剪图片无非就是" class="headerlink" title="其实裁剪图片无非就是:"></a>其实裁剪图片无非就是:</h2><ul><li>文件选择图片，利用FileReader将文件格式的图片转成base64格式。</li><li>把这个base64格式显示在页面上，作为原图。</li><li>可以在原图的上面弄一个剪裁的方框，可以用鼠标来控制大小并移动，我觉得这里是最难的，需要很强的逻辑能力。</li><li>再利用canvas，以原图为基准，进行画图的裁剪，最后通过canvas方法得到裁剪后的base64格式图片。</li><li>最后把base64格式的图片转成Blob对象，利用ajax传送给后端。</li></ul><h2 id="关键方法"><a href="#关键方法" class="headerlink" title="关键方法"></a>关键方法</h2><h3 id="选择图片文件转base64"><a href="#选择图片文件转base64" class="headerlink" title="选择图片文件转base64"></a>选择图片文件转base64</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function file2base64(imgFile, callBack) &#123;</span><br><span class="line">  var fr = new FileReader();</span><br><span class="line">  fr.onload = function() &#123;</span><br><span class="line">    // fr.result就是base64格式数据</span><br><span class="line">    callBack(fr.result);</span><br><span class="line">  &#125;</span><br><span class="line">  fr.readAsDataURL(imgFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="将base64图片转化blob"><a href="#将base64图片转化blob" class="headerlink" title="将base64图片转化blob"></a>将base64图片转化blob</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function base64url2blob(base64url) &#123;</span><br><span class="line">  var binaryString = atob(base64url.split(&apos;,&apos;)[1]),</span><br><span class="line">        mimeType = base64url.split(&apos;,&apos;)[0].match(/:(.*?);/)[1],</span><br><span class="line">        length = binaryString.length,</span><br><span class="line">        u8arr = new Uint8Array(length),</span><br><span class="line">        blob;</span><br><span class="line">    while(length--) &#123;</span><br><span class="line">      u8arr[length] = binaryString.charCodeAt(length);</span><br><span class="line">    &#125;</span><br><span class="line">    blob = new Blob([u8arr.buffer], &#123;type: mimeType&#125;);</span><br><span class="line">    return blob;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="将图片转化为blob"><a href="#将图片转化为blob" class="headerlink" title="将图片转化为blob"></a>将图片转化为blob</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function img2blob(nImg, compressVal) &#123;</span><br><span class="line">  // 获取图片原始宽高</span><br><span class="line">  var cloneImg = nImg.cloneNode(true);</span><br><span class="line">  var nCanvas = document.createElement(&apos;canvas&apos;);</span><br><span class="line">  nCanvas.style.display = &apos;none&apos;;</span><br><span class="line">  document.body.appendChild(nCanvas);</span><br><span class="line">  nCanvas.width = cloneImg.width;</span><br><span class="line">  nCanvas.height = cloneImg.height;</span><br><span class="line">  var ctx = nCanvas.getContext(&quot;2d&quot;);</span><br><span class="line">  ctx.drawImage(nImg,0,0,cloneImg.width,cloneImg.height);</span><br><span class="line">  var base64Data = nCanvas.toDataURL(&quot;image/jpeg&quot;, compressVal);</span><br><span class="line">  var blob = this.base64url2blob(base64Data);</span><br><span class="line">  return blob;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是几个重要的格式转换方法。<br>最后，贴出源码demo，里边包含后端接收的nodejs代码。<br><a href="https://github.com/jinux7/study-collections/tree/master/image-clipper-upload" target="_blank" rel="noopener">点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写一个自己的webpack</title>
      <link href="/2020/01/31/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84webpack/"/>
      <url>/2020/01/31/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84webpack/</url>
      
        <content type="html"><![CDATA[<p>一个超级简化版的webpack打包工具<br><a id="more"></a></p><h1 id="手写一个自己的webpack"><a href="#手写一个自己的webpack" class="headerlink" title="手写一个自己的webpack"></a>手写一个自己的webpack</h1><p>webpack现在用的人非常多，我们在开发vue，react，angular的时候默认的打包工具就是webpack，作为一名前端开发者来说，webpack是现在必须掌握的技能之一。随着webpack版本的不断增加，功能和复杂度越来越高，会配置的话都得学一阵子，但是，抛开使用来说，想没想过它的原理是什么？如果自己写一个该从哪里入手呢，今天我就写一个简化版的webpack。</p><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>简化版的webpack，实现了它的最基础的功能，也就是模块化的引用处理，比如，main.js文件依赖了a.js文件，使用es6的语法import语法，浏览器是不支持的，需要用工具打包成浏览器支持的语法，我就实现这个最基础的功能。</p><h2 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h2><p>打包文件，首先需要分析代码，比如，入口文件main.js，分析出import语句，都依赖哪些文件，再去读取这些依赖的文件，而分析js代码就需要babel这个工具库，babel工具库可以将es6代码转换成es5，es3代码，功能特别强大。</p><h2 id="打包流程"><a href="#打包流程" class="headerlink" title="打包流程"></a>打包流程</h2><p>这里，依赖babel的3个工具，分别是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;@babel/core&quot;: &quot;^7.8.3&quot;,</span><br><span class="line">&quot;@babel/parser&quot;: &quot;^7.8.3&quot;,</span><br><span class="line">&quot;@babel/traverse&quot;: &quot;^7.8.3&quot;</span><br></pre></td></tr></table></figure></p><p>parser是用来将js代码解析成ast语法书。<br>traverse可以将ast语法书进行遍历，对相应的ast语法书节点做单独的获取或者处理。<br>babel-core是babel的核心，可以将es6的js代码或ast语法书转化成es5代码。</p><h3 id="步骤1"><a href="#步骤1" class="headerlink" title="步骤1"></a>步骤1</h3><p>用paser将es6的代码先转成ast语法树</p><h3 id="步骤2"><a href="#步骤2" class="headerlink" title="步骤2"></a>步骤2</h3><p>用traverse处理ast语法书中的import节点，获取依赖文件路径，并获取依赖文件的代码，重复做步骤1，步骤2的处理。</p><h3 id="步骤3"><a href="#步骤3" class="headerlink" title="步骤3"></a>步骤3</h3><p>用babel-core将获取到的文件全部转成es5语法。</p><h3 id="步骤4"><a href="#步骤4" class="headerlink" title="步骤4"></a>步骤4</h3><p>最后把这些文件拼接成一个可执行的js代码，保存起来，html直接引用就可以执行了。</p><h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>上面步骤都说了，但是还是有点抽象，下面贴出代码，一目了然。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse = require(&apos;@babel/traverse&apos;).default;</span><br><span class="line">const babel = require(&apos;@babel/core&apos;);</span><br><span class="line"></span><br><span class="line">let ID = 0;</span><br><span class="line">function createAsset(fileName) &#123;</span><br><span class="line">  // 这个文件里所依赖的其它文件路径</span><br><span class="line">  let dependencies = [];</span><br><span class="line">  const content = fs.readFileSync(fileName, &apos;utf8&apos;);</span><br><span class="line">  // 用babel的parser来解析读取的的文件内容content,获取ast抽象语法书</span><br><span class="line">  const ast = parser.parse(content, &#123;</span><br><span class="line">    sourceType: &apos;module&apos;</span><br><span class="line">  &#125;);</span><br><span class="line">  // 用babel的traverse功能来观察ast语法树的相应节点，进行相应的处理</span><br><span class="line">  traverse(ast, &#123;</span><br><span class="line">    ImportDeclaration(&#123; node &#125;) &#123;</span><br><span class="line">      // console.log(node.source.value);</span><br><span class="line">      dependencies.push(node.source.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  // 用babel来讲es6语法转成es5语法</span><br><span class="line">  const &#123; code &#125; = babel.transformFromAstSync(ast, null, &#123;</span><br><span class="line">    presets: [&apos;@babel/preset-env&apos;]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  let id = ID++;</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    id,</span><br><span class="line">    fileName,</span><br><span class="line">    dependencies,</span><br><span class="line">    code,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createGraph() &#123;</span><br><span class="line">  const mainAsset = createAsset(&apos;./src/main.js&apos;);</span><br><span class="line">  // 队列存放单个文件资源,这里利用循环队列去搜寻依赖文件，而没有使用递归方法</span><br><span class="line">  const queue = [ mainAsset ];</span><br><span class="line">  for(const asset of queue) &#123;</span><br><span class="line">    const dirname = path.dirname(asset.fileName);</span><br><span class="line">    asset.mapping = &#123;&#125;;</span><br><span class="line">    asset.dependencies.forEach(relativePath =&gt; &#123;</span><br><span class="line">      const absolutePath = path.join(dirname, relativePath);</span><br><span class="line">      const child = createAsset(absolutePath);</span><br><span class="line">      asset.mapping[relativePath] = child.id;</span><br><span class="line">      queue.push(child);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  return queue;</span><br><span class="line">&#125;</span><br><span class="line">// 打包生成处理后的js文件</span><br><span class="line">function bundle() &#123;</span><br><span class="line">  const graph = createGraph(&apos;./src/main.js&apos;);</span><br><span class="line">  let modules = ``;</span><br><span class="line">  graph.forEach(mod=&gt; &#123;</span><br><span class="line">    modules += `</span><br><span class="line">      $&#123;mod.id&#125;: [</span><br><span class="line">        function(require, module, exports) &#123;</span><br><span class="line">          $&#123;mod.code&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        $&#123;JSON.stringify(mod.mapping)&#125;</span><br><span class="line">      ],</span><br><span class="line">    `;</span><br><span class="line">  &#125;);</span><br><span class="line">  const result = `(function(modules) &#123;</span><br><span class="line">    function require(id) &#123;</span><br><span class="line">      const fn = modules[id][0],</span><br><span class="line">            mapping = modules[id][1];</span><br><span class="line">      function localRequire(relativePath) &#123;</span><br><span class="line">        return require(mapping[relativePath]);</span><br><span class="line">      &#125;</span><br><span class="line">      const module = &#123;</span><br><span class="line">        exports: &#123;&#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      fn(localRequire, module, module.exports);</span><br><span class="line">      return module.exports;</span><br><span class="line">    &#125;</span><br><span class="line">    require(0);</span><br><span class="line">  &#125;)(&#123;$&#123;modules&#125;&#125;)`;</span><br><span class="line"></span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const result = bundle();</span><br><span class="line">fs.writeFileSync(&apos;./dist/bundle.js&apos;, result);</span><br></pre></td></tr></table></figure></p><h2 id="demo地址"><a href="#demo地址" class="headerlink" title="demo地址"></a>demo地址</h2><p><a href="https://github.com/jinux7/study-collections/tree/master/%E6%89%8B%E5%86%99webpack/nux-webpack" target="_blank" rel="noopener">截这里</a></p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单的聊聊iframe</title>
      <link href="/2020/01/19/%E7%AE%80%E5%8D%95%E7%9A%84%E8%81%8A%E8%81%8Aiframe/"/>
      <url>/2020/01/19/%E7%AE%80%E5%8D%95%E7%9A%84%E8%81%8A%E8%81%8Aiframe/</url>
      
        <content type="html"><![CDATA[<p>iframe在html中的简单使用<br><a id="more"></a></p><h1 id="简单的聊聊iframe"><a href="#简单的聊聊iframe" class="headerlink" title="简单的聊聊iframe"></a>简单的聊聊iframe</h1><p>我们在前端开发中，iframe的使用场景很多，即便是vue，react时代，我还是乐此不疲的在项目中使用iframe，因为它会隔离页面彼此的环境，避免造成一些不必要的干扰。</p><h2 id="在同域下使用iframe"><a href="#在同域下使用iframe" class="headerlink" title="在同域下使用iframe"></a>在同域下使用iframe</h2><p>在同域下使用iframe,父级页面可以获取iframe页面里的信息，还可以操作iframe页面中的内容。<br><a href="https://github.com/jinux7/study-collections/tree/master/iframe/same-origin" target="_blank" rel="noopener">案例</a><br>在同域下没什么好说的，父页面可以随意控制子页面。</p><h2 id="跨域下使用iframe"><a href="#跨域下使用iframe" class="headerlink" title="跨域下使用iframe"></a>跨域下使用iframe</h2><p>跨域下使用iframe,父页面是不能操作子页面的，但是子页面可以操作父页面。<br>而且，后台返回的头信息，还能够更加严格的控制iframe<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(&apos;X-Frame-Options&apos;, &apos;DENY&apos;); // 不允许此页面被iframe加载</span><br><span class="line">res.setHeader(&apos;X-Frame-Options&apos;, &apos;SAMEORIGIN&apos;); // 只可以在相同域名下加载</span><br><span class="line">res.setHeader(&apos;X-Frame-Options&apos;, &apos;allow-from http://baidu.com/&apos;); // 允许指定的url加载iframe,但是这个属性在chrome,firefox,opera并不好使,只在edge中兼容</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/jinux7/study-collections/tree/master/iframe/cross-origin" target="_blank" rel="noopener">案例</a><br>目前为止，没有找到跨域控制iframe页面内容的方法。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用数据结构的JavaScript实现</title>
      <link href="/2019/11/28/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84JavaScript%E5%AE%9E%E7%8E%B0/"/>
      <url>/2019/11/28/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84JavaScript%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>一些传统的数据结构,如栈,队列,链表,哈希表,树在js中如何的实现<br><a id="more"></a></p><h1 id="常用数据结构的JavaScript实现"><a href="#常用数据结构的JavaScript实现" class="headerlink" title="常用数据结构的JavaScript实现"></a>常用数据结构的JavaScript实现</h1><p>觉得这篇文章很不错，收藏下来，感谢作者。<br><a href="https://mp.weixin.qq.com/s/04PFD6dHhUjdh7wpT33UMQ" target="_blank" rel="noopener">这里是连接哦</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux的常用操作</title>
      <link href="/2019/11/28/linux%E7%9A%84%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
      <url>/2019/11/28/linux%E7%9A%84%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>linux的一些基础常用操作<br><a id="more"></a></p><h1 id="linux的常用操作"><a href="#linux的常用操作" class="headerlink" title="linux的常用操作"></a>linux的常用操作</h1><h2 id="安装应用"><a href="#安装应用" class="headerlink" title="安装应用"></a>安装应用</h2><p>在linux下安装应用的方法有很多，我也尝试了好几种，最后感觉还是用yum安装方便。<br>在使用yum安装应用的时候需要配置一下yum源，这里写出两条命令，常用的应用软件都已经有了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">curl -O http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure></p><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="新建文件夹"><a href="#新建文件夹" class="headerlink" title="新建文件夹"></a>新建文件夹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir &lt;filename&gt;</span><br></pre></td></tr></table></figure><h3 id="文件的移动"><a href="#文件的移动" class="headerlink" title="文件的移动"></a>文件的移动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 将repo结尾的文件移动到当前目录的back文件夹下</span><br><span class="line">mv *.repo ./back</span><br></pre></td></tr></table></figure><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、删除文件命令</span><br><span class="line">rm -f 文件名</span><br><span class="line">将会强行删除文件，且无提示</span><br><span class="line">需要注意：</span><br><span class="line">使用rm -rf要格外注意，linux中没有回收站，慎重删除</span><br><span class="line">2、删除文件夹以及文件夹中的所有文件命令：</span><br><span class="line">rm -rf 目录名字</span><br><span class="line">其中：</span><br><span class="line">-r：向下递归删除</span><br><span class="line">-f：直接强行删除，且没有任何提示</span><br></pre></td></tr></table></figure><h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep node</span><br></pre></td></tr></table></figure><h3 id="杀死进程"><a href="#杀死进程" class="headerlink" title="杀死进程"></a>杀死进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 &lt;pid&gt;</span><br></pre></td></tr></table></figure><h3 id="搜索一个程序所在位置"><a href="#搜索一个程序所在位置" class="headerlink" title="搜索一个程序所在位置"></a>搜索一个程序所在位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">whereis &lt;程序名称&gt;</span><br><span class="line">查找软件的安装路径</span><br><span class="line">-b 只查找二进制文件</span><br><span class="line">-m 只查找帮助文件</span><br><span class="line">-s 只查找源代码</span><br><span class="line">-u 排除指定类型文件</span><br><span class="line">-f 只显示文件名</span><br><span class="line">-B &lt;目录&gt; 在指定目录下查找二进制文件</span><br><span class="line">-M &lt;目录&gt; 在指定目录下查找帮助文件</span><br><span class="line">-S &lt;目录&gt; 在指定目录下查找源代码</span><br></pre></td></tr></table></figure><h3 id="查找一个文件夹所在目录"><a href="#查找一个文件夹所在目录" class="headerlink" title="查找一个文件夹所在目录"></a>查找一个文件夹所在目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name &lt;文件名&gt;</span><br></pre></td></tr></table></figure><h2 id="文件的上传和下载"><a href="#文件的上传和下载" class="headerlink" title="文件的上传和下载"></a>文件的上传和下载</h2><p>使用之前确保安装了lrzsz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install lrzsz</span><br></pre></td></tr></table></figure></p><h3 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rz</span><br></pre></td></tr></table></figure><h3 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sz &lt;filename&gt;</span><br></pre></td></tr></table></figure><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx</span><br></pre></td></tr></table></figure><h3 id="开启nginx服务"><a href="#开启nginx服务" class="headerlink" title="开启nginx服务"></a>开启nginx服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -c /etc/nginx/nginx.conf.default</span><br><span class="line">// 以我的nginx安装目录为例，nginx.conf.default这个文件就是nginx的主默认配置文件</span><br></pre></td></tr></table></figure><h3 id="重启nginx服务"><a href="#重启nginx服务" class="headerlink" title="重启nginx服务"></a>重启nginx服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="压缩和解压zip"><a href="#压缩和解压zip" class="headerlink" title="压缩和解压zip"></a>压缩和解压zip</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 安装zip</span><br><span class="line">yum install zip</span><br><span class="line">// 安装unzip</span><br><span class="line">yum install unzip</span><br></pre></td></tr></table></figure><h3 id="使用zip"><a href="#使用zip" class="headerlink" title="使用zip"></a>使用zip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 将 /home/html/ 这个目录下所有文件和文件夹打包为当前目录下的 html.zip：</span><br><span class="line">zip -q -r html.zip /home/html</span><br><span class="line">// 如果在我们在 /home/html 目录下，可以执行以下命令：</span><br><span class="line">zip -q -r html.zip *</span><br></pre></td></tr></table></figure><h3 id="使用unzip"><a href="#使用unzip" class="headerlink" title="使用unzip"></a>使用unzip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 它会默认将文件解压到当前目录 </span><br><span class="line"># unzip test.zip </span><br><span class="line">// 如果要解压到指定目录，可以加上 -d 选项</span><br><span class="line"># unzip test.zip -d /root/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chrome浏览器设置可跨域</title>
      <link href="/2019/11/20/chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BE%E7%BD%AE%E5%8F%AF%E8%B7%A8%E5%9F%9F/"/>
      <url>/2019/11/20/chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BE%E7%BD%AE%E5%8F%AF%E8%B7%A8%E5%9F%9F/</url>
      
        <content type="html"><![CDATA[<p>chrome浏览器设置可跨域<br><a id="more"></a></p><h1 id="chrome浏览器设置可跨域"><a href="#chrome浏览器设置可跨域" class="headerlink" title="chrome浏览器设置可跨域"></a>chrome浏览器设置可跨域</h1><p>跨域方法很多种，我比较喜欢简单粗暴的修改chrome配置<br>1.先chrome鼠标右键打开下，点击打开属性，出现下面这幅图<br><img src="/2019/11/20/chrome浏览器设置可跨域/1.png" alt="img"><br>2.将下面的这段粘贴在目标的字符串的后面，注意要隔着一个空格<br>chrome版本49之前：–disable-web-security<br>chrome版本49之后：open -a Google\ Chrome –args –disable-web-security –user-data-dir</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css初始化</title>
      <link href="/2019/10/30/css%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
      <url>/2019/10/30/css%E5%88%9D%E5%A7%8B%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>css的初始化设计<br><a id="more"></a></p><h1 id="css初始化"><a href="#css初始化" class="headerlink" title="css初始化"></a>css初始化</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">"utf-8"</span>;<span class="selector-tag">html</span>&#123;<span class="attribute">background-color</span>:<span class="number">#fff</span>;<span class="attribute">color</span>:<span class="number">#000</span>;<span class="attribute">font-size</span>:<span class="number">12px</span>&#125;</span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">ol</span>,<span class="selector-tag">dl</span>,<span class="selector-tag">dd</span>,<span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,<span class="selector-tag">figure</span>,<span class="selector-tag">form</span>,<span class="selector-tag">fieldset</span>,<span class="selector-tag">legend</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,<span class="selector-tag">p</span>,<span class="selector-tag">blockquote</span>,<span class="selector-tag">th</span>,<span class="selector-tag">td</span>,<span class="selector-tag">pre</span>,<span class="selector-tag">xmp</span>&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>&#125;</span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,<span class="selector-tag">select</span>,<span class="selector-tag">pre</span>,<span class="selector-tag">xmp</span>,<span class="selector-tag">tt</span>,<span class="selector-tag">code</span>,<span class="selector-tag">kbd</span>,<span class="selector-tag">samp</span>&#123;<span class="attribute">line-height</span>:<span class="number">1.5</span>;<span class="attribute">font-family</span>:tahoma,arial,<span class="string">"Hiragino Sans GB"</span>,simsun,sans-serif&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,<span class="selector-tag">small</span>,<span class="selector-tag">big</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,<span class="selector-tag">select</span>&#123;<span class="attribute">font-size</span>:<span class="number">100%</span>&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>&#123;<span class="attribute">font-family</span>:tahoma,arial,<span class="string">"Hiragino Sans GB"</span>,<span class="string">"微软雅黑"</span>,simsun,sans-serif&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,<span class="selector-tag">b</span>,<span class="selector-tag">strong</span>&#123;<span class="attribute">font-weight</span>:normal&#125;</span><br><span class="line"><span class="selector-tag">address</span>,<span class="selector-tag">cite</span>,<span class="selector-tag">dfn</span>,<span class="selector-tag">em</span>,<span class="selector-tag">i</span>,<span class="selector-tag">optgroup</span>,<span class="selector-tag">var</span>&#123;<span class="attribute">font-style</span>:normal&#125;</span><br><span class="line"><span class="selector-tag">table</span>&#123;<span class="attribute">border-collapse</span>:collapse;<span class="attribute">border-spacing</span>:<span class="number">0</span>;<span class="attribute">text-align</span>:left&#125;</span><br><span class="line"><span class="selector-tag">caption</span>,<span class="selector-tag">th</span>&#123;<span class="attribute">text-align</span>:inherit&#125;</span><br><span class="line"><span class="selector-tag">ul</span>,<span class="selector-tag">ol</span>,<span class="selector-tag">menu</span>&#123;<span class="attribute">list-style</span>:none&#125;</span><br><span class="line"><span class="selector-tag">fieldset</span>,<span class="selector-tag">img</span>&#123;<span class="attribute">border</span>:<span class="number">0</span>&#125;</span><br><span class="line"><span class="selector-tag">img</span>,<span class="selector-tag">object</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,<span class="selector-tag">select</span>&#123;<span class="attribute">vertical-align</span>:middle&#125;</span><br><span class="line"><span class="selector-tag">article</span>,<span class="selector-tag">aside</span>,<span class="selector-tag">footer</span>,<span class="selector-tag">header</span>,<span class="selector-tag">section</span>,<span class="selector-tag">nav</span>,<span class="selector-tag">figure</span>,<span class="selector-tag">figcaption</span>,<span class="selector-tag">hgroup</span>,<span class="selector-tag">details</span>,<span class="selector-tag">menu</span>&#123;<span class="attribute">display</span>:block&#125;</span><br><span class="line">audio,canvas,video&#123;display:inline-block;*display:inline;*zoom:1&#125;</span><br><span class="line"><span class="selector-tag">blockquote</span><span class="selector-pseudo">:before</span>,<span class="selector-tag">blockquote</span><span class="selector-pseudo">:after</span>,<span class="selector-tag">q</span><span class="selector-pseudo">:before</span>,<span class="selector-tag">q</span><span class="selector-pseudo">:after</span>&#123;<span class="attribute">content</span>:<span class="string">"\0020"</span>&#125;</span><br><span class="line"><span class="selector-tag">textarea</span>&#123;<span class="attribute">overflow</span>:auto;<span class="attribute">resize</span>:vertical&#125;</span><br><span class="line"><span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,<span class="selector-tag">select</span>,<span class="selector-tag">a</span>&#123;<span class="attribute">outline</span>:<span class="number">0</span> none;<span class="attribute">border</span>: none;&#125;</span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">::-moz-focus-inner</span>,<span class="selector-tag">input</span><span class="selector-pseudo">::-moz-focus-inner</span>&#123;<span class="attribute">padding</span>:<span class="number">0</span>;<span class="attribute">border</span>:<span class="number">0</span>&#125;</span><br><span class="line"><span class="selector-tag">mark</span>&#123;<span class="attribute">background-color</span>:transparent&#125;</span><br><span class="line"><span class="selector-tag">a</span>,<span class="selector-tag">ins</span>,<span class="selector-tag">s</span>,<span class="selector-tag">u</span>,<span class="selector-tag">del</span>&#123;<span class="attribute">text-decoration</span>:none&#125;</span><br><span class="line"><span class="selector-tag">sup</span>,<span class="selector-tag">sub</span>&#123;<span class="attribute">vertical-align</span>:baseline&#125;</span><br><span class="line"><span class="selector-tag">html</span> &#123;<span class="attribute">overflow-x</span>: hidden;<span class="attribute">height</span>: <span class="number">100%</span>;<span class="attribute">font-size</span>: <span class="number">50px</span>;<span class="attribute">-webkit-tap-highlight-color</span>: transparent;&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">font-family</span>: Arial, <span class="string">"Microsoft Yahei"</span>, <span class="string">"Helvetica Neue"</span>, Helvetica, sans-serif;<span class="attribute">color</span>: <span class="number">#333</span>;<span class="attribute">font-size</span>: .<span class="number">28em</span>;<span class="attribute">line-height</span>: <span class="number">1</span>;<span class="attribute">-webkit-text-size-adjust</span>: none;&#125;</span><br><span class="line"><span class="selector-tag">hr</span> &#123;<span class="attribute">height</span>: .<span class="number">02rem</span>;<span class="attribute">margin</span>: .<span class="number">1rem</span> <span class="number">0</span>;<span class="attribute">border</span>: medium none;<span class="attribute">border-top</span>: .<span class="number">02rem</span> solid <span class="number">#cacaca</span>;&#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123;<span class="attribute">color</span>: <span class="number">#25a4bb</span>;<span class="attribute">text-decoration</span>: none;&#125;</span><br><span class="line"><span class="selector-tag">a</span>,<span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">-webkit-appearance</span>: none;<span class="comment">/*屏蔽阴影*/</span></span><br><span class="line">    <span class="attribute">-webkit-tap-highlight-color</span>:<span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*ios android去除自带阴影的样式*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>, <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="comment">/* 禁止长按链接与图片弹出菜单 */</span></span><br><span class="line">    <span class="attribute">-webkit-touch-callout</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="comment">/* 禁止选中文本(如无文本选中需求,此为必选项) */</span></span><br><span class="line">    <span class="attribute">-webkit-user-select</span>: none;  </span><br><span class="line">    <span class="attribute">user-select</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">* &#123;</span><br><span class="line">-webkit-overflow-scrolling: touch; // ios滑动不卡顿</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 样式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VUE自定义组件v-model使用</title>
      <link href="/2019/10/22/VUE%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6v-model%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/10/22/VUE%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6v-model%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>vue中自定义组件v-model双向数据绑定的使用<br><a id="more"></a></p><h1 id="VUE自定义组件v-model使用"><a href="#VUE自定义组件v-model使用" class="headerlink" title="VUE自定义组件v-model使用"></a>VUE自定义组件v-model使用</h1><p>我们在写vue组建的时候，可以往组件里传prop，但是普通的属性都是单向数据流，要想在子组件里修改父组件里值，必须在父组件中定义一个事件，在子组件里<code>this.$emit(&#39;事件名&#39;,&#39;...参数&#39;)</code>,但是我觉得好麻烦，要想实现数据的双向绑定还得定义子组件调用的事件方法，我们可以直接使用<code>v-model</code>,可以简单些。<br>父组件代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Child v-model=<span class="string">"val"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      val: <span class="number">123</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    Child</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>子组件代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123;value&#125;&#125;</span><br><span class="line">    &lt;div @click=<span class="string">"changeVal"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  data () &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  props: ['value'],</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    changeVal () &#123;</span></span><br><span class="line"><span class="regexp">      this.$emit('input', 456); /</span><span class="regexp">/ 注意这里默认是input事件哦</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><p>是不是双向数据绑定写着会简单些。<br>最后，看一下vue中v-model的语法糖：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input v-model=<span class="string">"price"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> :value=<span class="string">"price"</span> @input=<span class="string">"price=$event.target.value"</span>&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端优化之Pre技术简介</title>
      <link href="/2019/10/14/%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E4%B9%8BPre%E6%8A%80%E6%9C%AF%E7%AE%80%E4%BB%8B/"/>
      <url>/2019/10/14/%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E4%B9%8BPre%E6%8A%80%E6%9C%AF%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>link标签中pre技术的介绍<br><a id="more"></a></p><h1 id="前端优化之Pre技术简介"><a href="#前端优化之Pre技术简介" class="headerlink" title="前端优化之Pre技术简介"></a>前端优化之Pre技术简介</h1><p>Pre技术：预加载技术。提供在不影响当前页面情况下，浏览器预加载资源的性能优化方案。</p><h2 id="DNS-Prefetch"><a href="#DNS-Prefetch" class="headerlink" title="DNS Prefetch"></a>DNS Prefetch</h2><p>就是上述提到的，用于告知浏览器，尽可能预先解析指定域名的DNS。使用方式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"dns-prefetch"</span> href=<span class="string">"//the-domain-to-be-prefetched.com"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>至于兼容性，可以说是目前为止所有的Pre技术里最好的了，<a href="http://caniuse.com/#search=dns-prefetch" target="_blank" rel="noopener">兼容性查看</a><br>IE是从IE9开始支持DNS Prefetch的，但是，是从IE10开始支持dns-prefetch。IE9里，并不是使用dns-prefetch来定义一个DNS的预解析，而是使用prefetch。挺尴尬的，因为prefetch在w3规范里又被用到了另一个Pre技术，下面会讲到。</p><h2 id="Preconnect"><a href="#Preconnect" class="headerlink" title="Preconnect"></a>Preconnect</h2><p>预连接。和DNS Prefetch类似，但是，更进一步。它不仅要求浏览器预解析指定域名的DNS，还需要预先与服务器握手以及TLS协商（如果使用了HTTPS）。使用方式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"preconnect"</span> href=<span class="string">"//the-domain-to-be-preconnect.com"</span> crossorigin=<span class="string">"anonymous"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p><a href="http://caniuse.com/#search=preconnect" target="_blank" rel="noopener">兼容性查看</a><br>由于会与服务器握手，因此，就需要确定“是否跨域”。和script类似，带crossorigin属性，以告知浏览器如何处理跨域和cookie。</p><h2 id="Prefetch"><a href="#Prefetch" class="headerlink" title="Prefetch"></a>Prefetch</h2><p>上述DNS Prefetch里提到过，IE9里使用的DNS Prefetch类型名是prefetch，但是，这个类型名在规范里又被用于另外一个意图。<br>Prefetch：预获取，在Preconnect基础上更进一步，它要求浏览器获取整个的指定资源，link[href]值指定的是某个具体资源，而不是简单的一个域名了。除了和Preconnect一样拥有rel、href和crossorigin外，还有as，可用于告知浏览器资源类型，这个类型和MIME不一样，是一个统称类型，比如：所有的图片都是as=”image”，JS的是as=”script”，HTML的是 as=”html”等，<a href="https://fetch.spec.whatwg.org/#concept-request-destination" target="_blank" rel="noopener">具体可以参考</a>。<br>使用方式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"prefetch"</span> href=<span class="string">"//the-domain.com/prefetch.js"</span> crossorigin <span class="keyword">as</span>=<span class="string">"script"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>as属性并不是必须的，但是建议加上，以便浏览器能更好的添加请求Header来优化资源的获取。<br>使用Prefetch，整个资源都会被加载，但是，浏览器不允许对资源预处理或执行，资源只是被提前加载，并缓存起来，以便将来使用。<a href="http://caniuse.com/#search=prefetch" target="_blank" rel="noopener">兼容性查看</a></p><h2 id="Prerender"><a href="#Prerender" class="headerlink" title="Prerender"></a>Prerender</h2><p>预渲染。与Prefetch类似，浏览器会下载整个资源，但是，Prefetch不允许浏览器对资源做预处理和执行，而Prerender则会告知浏览器，下载资源（HTML）并解析/执行它，包括被解析资源的子资源，这意味着会下载该HTML中的图片、样式、脚本等等。<br>Prerender没有as属性，它下载的是HTML，使用方式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"preconnect"</span> href=<span class="string">"//the-domain-to-be-preconnect.com"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>由于不允许对当前页面产生影响，浏览器设置预渲染的页面visibilityState属性为hidden。<a href="http://caniuse.com/#search=prerender" target="_blank" rel="noopener">兼容性查看</a><br>建议少用这个，太耗资源。而且，查看上述兼容性，你会看到Chrome 58里又把这个功能干掉了。</p><h2 id="Preload"><a href="#Preload" class="headerlink" title="Preload"></a>Preload</h2><p>预加载。这是一个和Prefetch几乎一模一样的功能，但是，其加载的资源适用的场景又完全不一样。使用方式只是将上述Prefetch中的prefetch改成preload。其他的完全一样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"preload"</span> href=<span class="string">"//the-domain.com/prefetch.png"</span> crossorigin <span class="keyword">as</span>=<span class="string">"image"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>与Prefetch*不同之处在于：</p><ul><li>Prefetch的优先级很低，低到浏览器可以不加载</li><li>Preload的优先级很高，浏览器一定要加载</li><li>Prefetch加载的资源用于将来某个页面中（这意味着它可能压根不会被用到）</li><li>Preload加载的资源用于当前页面中</li></ul><p>所以，在使用prefetch还是preload时候，需要考虑上述的不同点，而不应该盲目使用。[Preload以前叫Subresource]<br><a href="http://caniuse.com/#search=preload" target="_blank" rel="noopener">兼容性查看</a><br>最后，上述Pre技术，除了Preload，其他的Pre都可能“不被浏览器执行”，这不是兼容性的问题，而是，这些Pre都不是浏览器必须行为，浏览器会根据一定的策略决定是否Pre相应的资源或操作，这些策略包括：CPU、内存等的占用率。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;script&gt;标签的defer,async,module</title>
      <link href="/2019/10/14/script-%E6%A0%87%E7%AD%BE%E7%9A%84defer-async-module/"/>
      <url>/2019/10/14/script-%E6%A0%87%E7%AD%BE%E7%9A%84defer-async-module/</url>
      
        <content type="html"><![CDATA[<p><code>&lt;script&gt;</code>标签中defer,async,module的使用<br><a id="more"></a></p><h1 id="lt-script-标签的defer-async-module"><a href="#lt-script-标签的defer-async-module" class="headerlink" title="&lt;script>标签的defer,async,module"></a>&lt;script>标签的defer,async,module</h1><h2 id="defer-amp-async"><a href="#defer-amp-async" class="headerlink" title="defer&amp;async"></a>defer&amp;async</h2><p>传统方法<br>HTML 网页中，浏览器通过<code>&lt;script&gt;</code>标签加载 JavaScript 脚本。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面内嵌的脚本 --&gt;</span><br><span class="line">&lt;script type=<span class="string">"application/javascript"</span>&gt;</span><br><span class="line">  <span class="comment">// module code</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!-- 外部脚本 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type="application/</span>javascript<span class="string">" src="</span>path/to/myModule.js<span class="string">"&gt;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>上面代码中，由于浏览器脚本的默认语言是 JavaScript，因此type=”application/javascript”可以省略。<br>默认情况下，浏览器是同步加载 JavaScript 脚本，即渲染引擎遇到<code>&lt;script&gt;</code>标签就会停下来，等到执行完脚本，再继续向下渲染。如果是外部脚本，还必须加入脚本下载的时间。<br>如果脚本体积很大，下载和执行的时间就会很长，因此造成浏览器堵塞，用户会感觉到浏览器“卡死”了，没有任何响应。这显然是很不好的体验，所以浏览器允许脚本异步加载，下面就是两种异步加载的语法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"path/to/myModule.js"</span> defer&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="path/</span>to/myModule.js<span class="string">" async&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>上面代码中，<code>&lt;script&gt;</code>标签打开defer或async属性，脚本就会异步加载。渲染引擎遇到这一行命令，就会开始下载外部脚本，但不会等它下载和执行，而是直接执行后面的命令。<br>defer与async的区别是：defer要等到整个页面在内存中正常渲染结束（DOM 结构完全生成，以及其他脚本执行完成），才会执行；async一旦下载完，渲染引擎就会中断渲染，执行这个脚本以后，再继续渲染。一句话，defer是“渲染完再执行”，async是“下载完就执行”。另外，如果有多个defer脚本，会按照它们在页面出现的顺序加载，而多个async脚本是不能保证加载顺序的。</p><h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p>加载规则<br>浏览器加载 ES6 模块，也使用<code>&lt;script&gt;</code>标签，但是要加入type=”module”属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span> src=<span class="string">"./foo.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>上面代码在网页中插入一个模块foo.js，由于type属性设为module，所以浏览器知道这是一个 ES6 模块。<br>浏览器对于带有type=”module”的<code>&lt;script&gt;</code>，都是异步加载，不会造成堵塞浏览器，即等到整个页面渲染完，再执行模块脚本，等同于打开了<code>&lt;script&gt;</code>标签的defer属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span> src=<span class="string">"./foo.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;!-- 等同于 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type="module" src="./</span>foo.js<span class="string">" defer&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>如果网页有多个<code>&lt;script type=&quot;module&quot;&gt;</code>，它们会按照在页面出现的顺序依次执行。<br><code>&lt;script&gt;</code>标签的async属性也可以打开，这时只要加载完成，渲染引擎就会中断渲染立即执行。执行完成后，再恢复渲染。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span> src=<span class="string">"./foo.js"</span> <span class="keyword">async</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>一旦使用了async属性，<code>&lt;script type=&quot;module&quot;&gt;</code>就不会按照在页面出现的顺序执行，而是只要该模块加载完成，就执行该模块。<br>ES6 模块也允许内嵌在网页中，语法行为与加载外部脚本完全一致。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span>&gt;</span><br><span class="line">  <span class="keyword">import</span> utils <span class="keyword">from</span> <span class="string">"./utils.js"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// other code</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>对于外部的模块脚本（上例是foo.js），有几点需要注意。</li><li>代码是在模块作用域之中运行，而不是在全局作用域运行。模块内部的顶层变量，外部不可见。</li><li>模块脚本自动采用严格模式，不管有没有声明use strict。</li><li>模块之中，可以使用import命令加载其他模块（.js后缀不可省略，需要提供绝对 URL 或相对 URL），也可以使用export命令输出对外接口。</li><li>模块之中，顶层的this关键字返回undefined，而不是指向window。也就是说，在模块顶层使用this关键字，是无意义的。</li><li>同一个模块如果加载多次，将只执行一次。<br>下面是一个示例模块。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> utils <span class="keyword">from</span> <span class="string">'https://example.com/js/utils.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(x === <span class="built_in">window</span>.x); <span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="literal">undefined</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><p>利用顶层的this等于undefined这个语法点，可以侦测当前代码是否在 ES6 模块之中。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isNotModuleScript = <span class="keyword">this</span> !== <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试相关术语整理</title>
      <link href="/2019/10/12/%E6%B5%8B%E8%AF%95%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD%E6%95%B4%E7%90%86/"/>
      <url>/2019/10/12/%E6%B5%8B%E8%AF%95%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>介绍一些测试的相关术语<br><a id="more"></a></p><h1 id="测试相关术语整理"><a href="#测试相关术语整理" class="headerlink" title="测试相关术语整理"></a>测试相关术语整理</h1><p>作为一名前端开发工程师，工作中肯定会和测试同事打交道，为了不丢面子，一些测试用语还是应该知道滴。</p><ul><li>Unit testing（单元测试），指一段代码的基本测试，其实际大小是未定的，通常是一个函数或子程序，一般由开发者执行。</li><li>Integration testing（集成测试），被测试系统的所有组件都集成在一起，找出被测试系统组件之间关系和接口中的错误。该测试一般在单元测试之后进行。</li><li>Acceptance testing（验收测试），系统开发生命周期方法论的一个阶段，这时相关的用户和／或独立测试人员根据测试计划和结果对系统进行测试和接收。它让系统用户决定是否接收系统。它是一项确定产品是否能够满足合同或用户所规定需求的测试。这是管理性和防御性控制。</li><li>Alpha testing (α测试),是由一个用户在开发环境下进行的测试，也可以是公司内部的用户在模拟实际操作环境下进行的受控测试，Alpha测试不能由程序员或测试员完成。</li><li>Beta testing(β测试),测试是软件的多个用户在一个或多个用户的实际使用环境下进行的测试。开发者通常不在测试现场，Beta测试不能由程序员或测试员完成。</li><li>Black box testing（黑盒测试），指测试人员不关心程序具体如何实现的一种测试方法。根据软件的规格对软件进行各种输入和观察软件的各种输出结果来发现软件的缺陷的测试，这类测试不考虑软件内部的运作原理，因此软件对用户来说就像一个黑盒子。</li><li>White box testing（白盒测试），根据软件内部的工作原理分析来进行测试,基于代码的测试，测试人员通过阅读程序代码或者通过使用开发工具中的单步调试来判断软件的质量，一般黑盒测试由项目经理在程序员开发中来实现。</li><li>Automated Testing（自动化测试），使用自动化测试工具来进行测试，这类测试一般不需要人干预，通常在GUI、性能等测试中用得较多。</li><li>Bug (错误)，有时称作defect（缺陷）或error（错误），软件程序中存在的编程错误，可能会带来不必要的副作用，软件的功能和特性与设计规格说明书或用户需求不一致的方面。软件缺陷表现特征为：软件未达到产品说明书标明的功能；软件出现产品说明书指明不会出现的错误；软件功能超出产品说明书指明的范围；虽然产品说明书未指出但是软件应达到的目标；软件测试人员或用户认为软件难以理解，不易使用，运行速度缓慢等问题。 Bug report（错误报告），也称为“Bug record（错误记录）”，记录发现的软件错误信息的文档，通常包括错误描述、复现步骤、抓取的错误图像和注释等。</li><li>Bug tracking system（错误跟踪系统，BTS），也称为“Defect tracking system，DTS”，管理软件测试缺陷的专用数据库系统，可以高效率地完成软件缺陷的报告、验证、修改、查询、统计、存储等任务。尤其适用于大型多语言软件的测试管理。</li><li>“抓虫大扫除”（Bug Bash）：在某一个版本的发行里程碑到达之后，在发行之前项目经理向全体开发组织发出通知，告诉大家哪一天的某个时间是Bug Bash的时间，到时候全体成员，包括开发、测试、文档等团队、甚至市场部门的员工，全都放下手中的工作，在规定的那一个或几个小时的时间里，每个人把自己当作是用户一样来使用这个未成品的软件，并且进行竞赛，看谁能找到最多的Bug。这样做的目的是，不是按照测试方案的顺序来检查软件，而是通过像真正的用户那样来使用软件，即完全是任意性的、无规则的顺序，看看在这样的使用条件下，还有没有仍旧没有被发现的严重的Bug。我们往往采用谁找到最严重的Bug 就得奖的方法来鼓励大家尽力找出Bug。抓虫大扫除一结束，项目经理马上进行新呈交的Bug数量的统计，然后向开发组织中的全体员工公布。得奖的小有免费的咖啡、午餐、电影票等，大有各种礼物。所以每次Bug Bash 大家都踊跃参加，找到很多测试案例执行时没找到的问题。</li><li>Exception（异常/例外），一个引起正常程序执行挂起的事件。</li><li>Crash（崩溃），计算机系统或组件突然并完全的丧失功能，例如软件或系统突然退出或没有任何反应（死机）。</li><li>Build（工作版本），软件开发过程中用于内部测试的功能和性能等不完善的软件版本。工作版本既可以是系统的可操作版本，也可以是展示要在最终产品中提供的部分功能的部分系统。</li><li>Functional testing (功能测试)，也称为behavioral testing（行为测试），根据产品特征、操作描述和用户方案，测试一个产品的特性和可操作行为以确定它们满足设计需求。本地化软件的功能测试，用于验证应用程序或网站对目标用户能正确工作。使用适当的平台、浏览器和测试脚本，以保证目标用户的体验将足够好，就像应用程序是专门为该市场开发的一样。</li><li>Load testing（负载测试），通过测试系统在资源超负荷情况下的表现，以发现设计上的错误或验证系统的负载能力。在这种测试中，将使测试对象承担不同的工作量，以评测和评估测试对象在不同工作量条件下的性能行为，以及持续正常运行的能力。负载测试的目标是确定并确保系统在超出最大预期工作量的情况下仍能正常运行。此外，负载测试还要评估性能特征，例如，响应时间、事务处理速率和其他与时间相关的方面。</li><li>Performance testing（性能测试），评价一个产品或组件与性能需求是否符合的测试。包括负载测试、强度测试、数据库容量测试、基准测试等类型。</li><li>Pilot testing（引导测试），软件开发中，验证系统在真实硬件和客户基础上处理典型操作的能力。在软件外包测试中，引导测试通常是客户检查软件测试公司测试能力的一种形式，只有通过了客户特定的引导测试，软件测试公司才能接受客户真实软件项目的软件测试。</li><li>Portability testing（可移植性测试），测试软件是否可以被成功移植到指定的硬件或软件平台上。</li><li>Compatibility Testing（兼容性测试），也称“Configuration testing（配置测试）”，测试软件是否和系统的其它与之交互的元素之间兼容，如：浏览器、操作系统、硬件等。验证测试对象在不同的软件和硬件配置中的运行情况。</li><li>Installing testing（安装测试），确保该软件在正常情况和异常情况的不同条件下，例如，进行首次安装、升级、完整的或自定义的安装都能进行安装。异常情况包括磁盘空间不足、缺少目录创建权限等。核实软件在安装后可立即正常运行。安装测试包括测试安装代码以及安装手册。安装手册提供如何进行安装，安装代码提供安装一些程序能够运行的基础数据。</li><li>International testing（国际化测试），国际化测试的目的是测试软件的国际化支持能力，发现软件的国际化的潜在问题，保证软件在世界不同区域中都能正常运行。国际化测试使用每种可能的国际输入类型，针对任何区域性或区域设置检查产品的功能是否正常，软件国际化测试的重点在于执行国际字符串的输入/输出功能。国际化测试数据必须包含东亚语言、德语、复杂脚本字符和英语（可选）的混合字符。</li><li>Localizability testing(本地化能力测试)，本地化能力是指不需要重新设计或修改代码，将程序的用户界面翻译成任何目标语言的能力。为了降低本地化能力测试的成本，提高测试效率，本地化能力侧是通常在软件的伪本地化版本上进行。本地化能力测试中发现的典型错误包括：字符的硬编码（即软件中需要本地化的字符写在了代码内部），对需要本地化的字符长度设置了国定值，在软件运行时以控件位置定位，图标和位图中包含了需要本地化的文本，软件的用户界面与文档术语不一致等。</li><li>Localization testing（本地化测试），本地化测试的对象是软件的本地化版本。本地化测试的目的是测试特定目标区域设置的软件本地化质量。本地化测试的环境是在本地化的操作系统上安装本地化的软件。从测试方法上可以分为基本功能测试，安装/卸载测试，当地区域的软硬件兼容性测试。测试的内容主要包括软件本地化后的界面布局和软件翻译的语言质量，包含软件、文档和联机帮助等部分。</li><li>Ad hoc testing (随机测试)，没有书面测试用例、记录期望结果、检查列表、脚本或指令的测试。主要是根据测试者的经验对软件进行功能和性能抽查。随机测试是根据测试说明书执行用例测试的重要补充手段，是保证测试覆盖完整性的有效方式和过程。</li><li>Smoke testing（冒烟测试），冒烟测试的对象是每一个新编译的需要正式测试的软件版本，目的是确认软件基本功能正常，可以进行后续的正式测试工作。冒烟测试的执行者是版本编译人员。参考“Sanity testing（健全测试）”。</li><li>Sanity testing（健全测试），软件主要功能成分的简单测试以保证它是否能进行基本的测试。</li><li>User interface（用户界面，UI），广义是指使用户可以和计算机进行交互的硬件和/或软件。狭义是指软件中的可见外观及其底层与用户交互的部分（菜单、对话框、窗口和其它控件）。</li><li>User interface testing (用户界面测试)，指测试用户界面的风格是否满足客户要求，文字是否正确，页面是否美观，文字，图片组合是否完美，操作是否友好等等。UI 测试的目标是确保用户界面会通过测试对象的功能来为用户提供相应的访问或浏览功能。确保用户界面符合公司或行业的标准。包括用户友好性、人性化、易操作性测试。</li><li>Static testing（静态测试），不通过执行来测试一个系统。如代码检查，文档检查和评审等。</li><li>Regression testing（回归测试），在发生修改之后重新测试先前的测试以保证修改的正确性。理论上，对软件的任何新版本，都需要进行回归测试，验证以前发现和修复的错误是否在新软件版本上再现。</li><li>Capture/Replay Tool (捕获/回放工具)，一种测试工具，能够捕获在测试过程中传递给软件的输入，并且能够在以后的时间中，重复这个执行的过程。这类工具一般在GUI测试中用的较多。</li><li>Debug（调试），开发人员确定引起错误的根本原因和确定可能的修复措施的过程。一般发生在子系统或单元模块编码完成时，或者根据测试错误报告指出错误以后，开发人员需要执行调试过程来解决已存在的错误。</li><li>Deployment（部署），也称为shipment(发布)，对内部IT系统而言，指它的第一个版本通过彻底的测试、形成产品、交付给付款客户的阶段。 Dynamic testing（动态测试），通过执行软件的手段来测试软件。</li><li>Garbage characters（乱码字符），程序界面中显示的无意义的字符，例如，程序对双字节字符集的字符不支持时，这些字符不能正确显示。</li><li>GB 18030 testing（GB 18030测试），软件支持GB 18030字符集标准能力的测试，包括GB 18030字符的输入、输出、显示、存储的支持程度。</li><li>Priority（优先权），从商业角度出发是指错误的重要性，尤其是从客户和用户的角度出发，是指错误对于系统的可行性和可接受性的影响。与“Severity（严重性）”相对照。</li><li>Severity（严重性），错误对被测系统的影响程度，在终端用户条件下发生的可能性，软件错误妨碍系统使用的程度。</li><li>Quality assurance（质量保证QA），采取相关活动，以保证一个开发组织交付的产品满足性能需求和已确立的标准和过程。</li><li>Review（评审），在产品开发过程中，把产品提交给项目成员、用户、管理者或其它相关人员评价或批准的过程。</li><li>Screen shot（抓屏、截图），软件测试中，将软件界面中的错误（窗口、菜单、对话框等）的全部或一部分，使用专用工具存储成图像文件，以便于后续处理。</li><li>Software life cycle（软件生命周期），开始于一个软件产品的构思，结束于该产品不再被使用的这段期间。</li><li>Structured query language（结构化查询语句，SQL），在一个关系数据库中查询和处理数据的一种语言。</li><li>TBD(To be determined，待定)，在测试文档中标是一项进行中的尚未最终确定的工作。</li><li>Test（测试），执行软件以验证其满足指定的需求并检测错误的过程。检测已有条件之间的不同，并评价软件项的特性软件项的分析过程。软件工程过程的一个活动，它将软件在预定的条件下运行以判断软件是否符合预期结果。</li><li>Test case（测试用例），为特定目标而开发的一组测试输入、执行条件和预期结果，其目标可以是测试某个程序路径或核实是否满足某个特定的需求。</li><li>Testing coverage（测试覆盖），指测试系统覆盖被测试系统的程度，一项给定测试或一组测试对某个给定系统或构件的所有指定测试用例进行处理所达到的程度。</li><li>Testing environment（测试环境），进行测试的环境，包括测试平台、测试基础设施、测试实验室和其他设施。</li><li>Testing item（测试项），作为测试对象的工作版本。</li><li>Testing plan（测试计划），描述了要进行的测试活动的范围、方法、资源和进度的文档。它确定测试项、被测特性、测试任务、谁执行任务、各种可能的风险。</li><li>Testing procedure（测试过程），指设置、执行给定测试用例并对测试结果进行评估的一系列详细步骤。</li><li>Testing script（测试脚本），一般指的是一个特定测试的一系列指令，这些指令可以被自动化测试工具执行。</li><li>Testing suite（测试包），一组测试用里的执行框架；一种组织测试用例的方法。在测试包里，测试用例可以组合起来创造出独特的测试条件。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>带标签的模板字符串</title>
      <link href="/2019/10/12/%E5%B8%A6%E6%A0%87%E7%AD%BE%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2019/10/12/%E5%B8%A6%E6%A0%87%E7%AD%BE%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<p>模板字符串的特殊用法<br><a id="more"></a></p><h1 id="带标签的模板字符串"><a href="#带标签的模板字符串" class="headerlink" title="带标签的模板字符串"></a>带标签的模板字符串</h1><p>模板字符串中我们使用 ${exporession} 作为占位符，而作为字符串连接的语法糖是其最基本的用法，而带标签的模板字符串则是一种函数调用，这能够让模板字符串更加强大，拥有真正模板引擎的功能。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span> (<span class="params">strs, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(strs)</span><br><span class="line">  <span class="built_in">console</span>.log(args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name =<span class="string">'jinux'</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">a <span class="string">`name: <span class="subst">$&#123;name&#125;</span>, age: <span class="subst">$&#123;age&#125;</span>`</span></span><br></pre></td></tr></table></figure></p><p>在浏览器的console面板打印一下。<br>可以看到，标签模板字符串的标签函数的第一个参数是由原始的字符串由占位字符串分割而成的字符串组成的数组，剩下的参数则是对应占位符的值。<br>利用这个特性常被提到的是避免XSS攻击：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEscape</span>(<span class="params">literals, ...placeholders</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> placeholders.reduce(<span class="function">(<span class="params">pre, val, i</span>) =&gt;</span> pre + literals[i] + val</span><br><span class="line">    .replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/'/g</span>, <span class="string">'&amp;#39'</span>)</span><br><span class="line">    .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">    .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>), <span class="string">''</span>) + literals[literals.length - <span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SPA应用前端预渲染之VUE</title>
      <link href="/2019/10/11/SPA%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E9%A2%84%E6%B8%B2%E6%9F%93%E4%B9%8BVUE/"/>
      <url>/2019/10/11/SPA%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E9%A2%84%E6%B8%B2%E6%9F%93%E4%B9%8BVUE/</url>
      
        <content type="html"><![CDATA[<p>vue中如何实现预渲染<br><a id="more"></a></p><h1 id="SPA应用前端预渲染之VUE"><a href="#SPA应用前端预渲染之VUE" class="headerlink" title="SPA应用前端预渲染之VUE"></a>SPA应用前端预渲染之VUE</h1><p>SPA应用的缺点是第一次打开缓慢，再有就是SEO不友好，优化有两种方式，一种是前端预渲染，另一种是后端渲染ssr,今天我们只说前端预渲染。<br>前端预渲染必须在webpack的基础上来做，用到的插件是prerender-spa-plugin。<br>我们在创建vue项目的时候现在都是用vue-cli，这里我只举例3.0版本。</p><h2 id="prerender-spa-plugin的使用"><a href="#prerender-spa-plugin的使用" class="headerlink" title="prerender-spa-plugin的使用"></a>prerender-spa-plugin的使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install prerender-spa-plugin --save</span><br></pre></td></tr></table></figure><h3 id="vue-config-js中增加"><a href="#vue-config-js中增加" class="headerlink" title="vue-config.js中增加"></a>vue-config.js中增加</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PrerenderSPAPlugin = <span class="built_in">require</span>(<span class="string">'prerender-spa-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> Renderer = PrerenderSPAPlugin.PuppeteerRenderer;</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            plugins: [</span><br><span class="line">                <span class="keyword">new</span> PrerenderSPAPlugin(&#123;</span><br><span class="line">                    <span class="comment">// 生成文件的路径，也可以与webpakc打包的一致。</span></span><br><span class="line">                    <span class="comment">// 下面这句话非常重要！！！</span></span><br><span class="line">                    <span class="comment">// 这个目录只能有一级，如果目录层次大于一级，在生成的时候不会有任何错误提示，在预渲染的时候只会卡着不动。</span></span><br><span class="line">                    staticDir: path.join(__dirname,<span class="string">'dist'</span>),</span><br><span class="line">                    <span class="comment">// 对应自己的路由文件，比如a有参数，就需要写成 /a/param1。</span></span><br><span class="line">                    routes: [<span class="string">'/'</span>, <span class="string">'/product'</span>,<span class="string">'/about'</span>],</span><br><span class="line">                    <span class="comment">// 这个很重要，如果没有配置这段，也不会进行预编译</span></span><br><span class="line">                    renderer: <span class="keyword">new</span> Renderer(&#123;</span><br><span class="line">                        inject: &#123;</span><br><span class="line">                            foo: <span class="string">'bar'</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        headless: <span class="literal">false</span>,</span><br><span class="line">                        <span class="comment">// 在 main.js 中 document.dispatchEvent(new Event('render-event'))，两者的事件名称要对应上。</span></span><br><span class="line">                        renderAfterDocumentEvent: <span class="string">'render-event'</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;),</span><br><span class="line">            ],</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="在main-js中增加"><a href="#在main-js中增加" class="headerlink" title="在main.js中增加"></a>在main.js中增加</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    <span class="built_in">document</span>.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'render-event'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><h3 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h3><p>router.js 中设置mode: “history”</p><h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><p>运行npm run build，之后在dist文件夹下可以看到跟预渲染路由名字一样文件夹，里边有一个index.html的文件，这就是预渲染页面。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在现实中，这种需求还是很多的，我现在做的项目领导对首页加载一直不满意，首页是一个登录页面，现在的做法我把登录页的内容直接写死到dom里了，当js文件加载好了之后再覆盖掉，这种方式也可以，我看掘金的首页就是这么干的。<br>我来说一下我理解的预渲染，比如想把about页面预渲染出来，打包之后发现有两个html文件，正常的首页index.html页和about文件夹下的index.html页，仔细观察about预渲染页面，引入的js，css文件是一样的，只是显示的dom内容已经写死在dom里了，当然，也可以把首页的html文件预渲染，其实也是静态化，这样SEO就可以抓到里边的内容。预渲染的页面刚访问的时候里边内容是写死的，当点击路由后又切回到vue自己的路由模式来加载页面，当然，我猜在vue的路由里边已经删除了预渲染页面的路由，访问这些页面的时候只能去服务器端去下载静态的预渲染页面了。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flex简单教程</title>
      <link href="/2019/10/10/flex%E7%AE%80%E5%8D%95%E6%95%99%E7%A8%8B/"/>
      <url>/2019/10/10/flex%E7%AE%80%E5%8D%95%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>flex语法的简单记录<br><a id="more"></a></p><h1 id="flex简单教程"><a href="#flex简单教程" class="headerlink" title="flex简单教程"></a>flex简单教程</h1><p>flex在项目中经常使用，但是语法还是经常忘，这里简单的记录下基本语法，以便方便查看，如果想系统学习，请阅读阮一峰老师的两篇文章<a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">Flex 布局教程：语法篇</a> 和 <a href="http://www.ruanyifeng.com/blog/2015/07/flex-examples.html" target="_blank" rel="noopener">Flex 布局教程：实例篇</a></p><h2 id="容器指定为flex容器"><a href="#容器指定为flex容器" class="headerlink" title="容器指定为flex容器"></a>容器指定为flex容器</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">  display: flex; <span class="comment">// 块元素flex布局 </span></span><br><span class="line">  display: inline-flex; <span class="comment">// 行间元素flex布局</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="flex容器的属性"><a href="#flex容器的属性" class="headerlink" title="flex容器的属性"></a>flex容器的属性</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">  <span class="comment">// 属性决定主轴的方向（即项目的排列方向）。</span></span><br><span class="line">  flex-direction: row | row-reverse | column | column-reverse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// flex-wrap属性定义，如果一条轴线排不下，如何换行。</span></span><br><span class="line">  flex-wrap: nowrap | wrap | wrap-reverse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// flex-flow属性是flex-direction属性和flex-wrap属性的简写形式，默认值为row nowrap。</span></span><br><span class="line">  flex-flow: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br><span class="line"></span><br><span class="line">  // justify-content属性定义了项目在主轴上的对齐方式。</span><br><span class="line">  justify-content: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line"></span><br><span class="line">  // align-items属性定义项目在交叉轴上如何对齐。</span><br><span class="line">  align-items: flex-start | flex-end | center | baseline | stretch;</span><br><span class="line"></span><br><span class="line">  // align-content属性定义了多根轴线的对齐方式。如果项目只有一根轴线，该属性不起作用。</span><br><span class="line">  align-content: flex-start | flex-end | center | space-between | space-around | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="flex容器里项目的属性"><a href="#flex容器里项目的属性" class="headerlink" title="flex容器里项目的属性"></a>flex容器里项目的属性</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">  <span class="comment">// order属性定义项目的排列顺序。数值越小，排列越靠前，默认为0。</span></span><br><span class="line">  order: &lt;integer&gt;;</span><br><span class="line"></span><br><span class="line">  // flex-grow属性定义项目的放大比例，默认为0，即如果存在剩余空间，也不放大。</span><br><span class="line">  flex-grow: &lt;number&gt;; /* default 0 */</span><br><span class="line"></span><br><span class="line">  // flex-shrink属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。</span><br><span class="line">  flex-shrink: &lt;number&gt;; /* default 1 */</span><br><span class="line"></span><br><span class="line">  // flex-basis属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。</span><br><span class="line">  flex-basis: &lt;length&gt; | auto; /* default auto */</span><br><span class="line"></span><br><span class="line">  // flex属性是flex-grow, flex-shrink 和 flex-basis的简写，默认值为0 1 auto。后两个属性可选。</span><br><span class="line">  flex: none | [ &lt;'flex-grow'&gt; &lt;'flex-shrink'&gt;? || &lt;'flex-basis'&gt; ] // 例：auto (1 1 auto) 和 none (0 0 auto)</span><br><span class="line"></span><br><span class="line">  // align-self属性允许单个项目有与其他项目不一样的对齐方式，可覆盖align-items属性。默认值为auto，表示继承父元素的align-items属性，如果没有父元素，则等同于stretch。</span><br><span class="line">  align-self: auto | flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 样式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单快速理解web缓存</title>
      <link href="/2019/10/09/%E7%AE%80%E5%8D%95%E5%BF%AB%E9%80%9F%E7%90%86%E8%A7%A3web%E7%BC%93%E5%AD%98/"/>
      <url>/2019/10/09/%E7%AE%80%E5%8D%95%E5%BF%AB%E9%80%9F%E7%90%86%E8%A7%A3web%E7%BC%93%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<p>简单快速,5分钟你就能理解web缓存<br><a id="more"></a></p><h1 id="简单快速理解web缓存"><a href="#简单快速理解web缓存" class="headerlink" title="简单快速理解web缓存"></a>简单快速理解web缓存</h1><p>之前我已经写过了一篇关于web缓存的文章，<a href="/2018/09/19/HTTP缓存机制及原理/">阅读点这里</a>，不过，这篇文章比较长，今天再写个短小易懂的，便于快速查看。</p><h2 id="服务器的缓存协商"><a href="#服务器的缓存协商" class="headerlink" title="服务器的缓存协商"></a>服务器的缓存协商</h2><p>缓存有两种，一种是需要服务器验证，另外一种是不用发送请求验证。</p><h2 id="ETag-Last-Modified"><a href="#ETag-Last-Modified" class="headerlink" title="ETag/Last-Modified"></a>ETag/Last-Modified</h2><p>这两种方式做法类似，都要向服务器发送一次请求进行验证。简直，缓存就缓存呗，为什么还要验证呢？ 其实，这是该协议的一种特有方式，发送一次验证主要是检查文件是否发生变化。</p><h3 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h3><p>ETag是用来计算文件的内容是否发生变化，比如，你在文件中删除一个空格，这样都算文件内容发生变化。 通常做法是用md5或者SHA1算法，计算出文件的唯一值。 在前端其实都可以完成， 找到一个文件文件解析的md5算法，然后将文件传入，就可以得到ETag的值。 不过这里，我们着重点并不是让你生成Etag，而是看看ETag在缓存中的重要作用。 ETag是HTTP/1.1A的一种办法，由Web服务器生成，并写入响应头中。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//response Headers</span></span><br><span class="line">ETag:<span class="string">"751F63A30AB5F98F855D1D90D217B356"</span></span><br></pre></td></tr></table></figure></p><p>接着，到了浏览器之后，便缓存在本地。 当下次打开同样的文章时，会在请求头中发送If-None-Match, 给服务器检查文件是否发生变化。如果没有，则告诉浏览器使用本地的，否则返回新文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//request Headers</span></span><br><span class="line">If-None-Match: <span class="string">"751F63A30AB5F98F855D1D90D217B356"</span></span><br></pre></td></tr></table></figure></p><p>通常情况下，服务器默认是打开Etag的，但是为了防止你的同事，或者后台哥哥的后台配置文件不正确，关闭了Etag，这时候，就需要你对对配置文件做一些设置。 这里我以Nginx为例: 打开ngnix.conf文件，检查是否有以下语句:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">etag off;</span><br><span class="line">more_set_headers -s <span class="number">404</span> -t <span class="string">'ETag'</span>;</span><br><span class="line">more_clear_headers <span class="string">'Etag'</span>;</span><br></pre></td></tr></table></figure></p><p>如果有则将其删除掉。然后重启nginx就可以了。他们将Etag关闭的原因其实也很简单，就是因为，Etag打开之后会增加服务器的负载，造成性能的局限性，所以，关闭或者打开Etag都要经过权衡的。</p><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>这和文档内容信息验证不同，这里采用的是日期验证办法。 即，服务器上会对文件打上一个文件改动的日期，然后客户端接受该日期，下次请求时，返回该日期，服务器验证，如果日期未变，则告诉浏览器使用本地缓存即可。 即，在服务器的相应头中，可以设置Last-Modified，来启用这一缓存协议.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Response Header</span></span><br><span class="line">Last-Modified:Tue, <span class="number">03</span> Mar <span class="number">2015</span> <span class="number">01</span>:<span class="number">38</span>:<span class="number">18</span> GMT</span><br></pre></td></tr></table></figure></p><p>接受到这一响应头之后，浏览器会对该文件做一个缓存，并保存该日期。当下次请求的时候，会通过If-Modified-Since将日期传入并验证:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Modified-Since:Tue, <span class="number">03</span> Mar <span class="number">2015</span> <span class="number">01</span>:<span class="number">38</span>:<span class="number">18</span> GMT</span><br></pre></td></tr></table></figure></p><p>如果日期未变，则告诉浏览器使用缓存。 那我们通常应该怎样启用服务器这一功能呢？ 默认情况下，服务器会对静态资源发送Last-modified的tag。 但是，需要注意，Last-Modified的更新时间只能以秒来计，如果你文件改动过于频繁，Last-Modified是无效的(不过，谁牛逼到1s内能多次更新文件嘞~) 实际上.Last-Modified的这个标签的我们通常并不会单独使用它，通常与expires结合，形成一个可降级的缓存.</p><h2 id="Expires-Cache-Control"><a href="#Expires-Cache-Control" class="headerlink" title="Expires/Cache-Control"></a>Expires/Cache-Control</h2><p>Expires/Cache协议与上述验证协议最大的不同在于，他可以省略发送验证请求环节，不需要服务器的验证，而直接使用本地缓存。 通常这种方式，适用于，项目稳定，版本迭代不多的时候。</p><h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>在服务器端可以设置Expires的一个绝对时间。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Response Headers</span></span><br><span class="line">Expires:Tue, <span class="number">03</span> May <span class="number">2016</span> <span class="number">09</span>:<span class="number">33</span>:<span class="number">34</span> GMT</span><br></pre></td></tr></table></figure></p><p>这告诉浏览器,在2016.5.3号之前,可以直接使用该文本的缓存副本。但是，可能会因为服务器和客户端的GMT时间不同，会有一定的bug。 所以，这里只提议在长时间缓存的情况下使用。否则，应该选择Cache-Control. 那在服务器端该怎么设置呢？ 这里以nginx为例:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(?:css|js)$ &#123;</span><br><span class="line">  expires <span class="number">1</span>d;</span><br><span class="line">  access_log off;</span><br><span class="line">  add_header Cache-Control <span class="string">"public"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过expires设置过期时间为一天，此时，服务器会根据当前的时间，加上一天.同时添加Expires和Cache-Control头部标签。 即,得到的Response Header为:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expires: Fri, <span class="number">28</span> Feb <span class="number">2014</span> <span class="number">10</span>:<span class="number">42</span>:<span class="number">09</span> GMT</span><br><span class="line">Cache-Control: max-age=<span class="number">86400</span> <span class="comment">//24*60*60</span></span><br></pre></td></tr></table></figure></p><p>(HTTP规定，如果出现max-age和expires，则max-age默认覆盖掉expires) 当expires为负数表示no-cache，正数或零表示max-age=time。 如果你不想缓存，可以直接设置:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expires <span class="number">-1</span>;  <span class="comment">//永远过期，Cache-Control: no-cache</span></span><br></pre></td></tr></table></figure></p><h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>这应该是HTTP1.1为了解决HTTP1.0中expires的时间差的bug，而新添加的一个tag. 他的配置项很多，其实完全都可以取代expires(现在大多数服务器都支持). 引用一段原话:</p><ul><li>Cache-Control 头在 HTTP/1.1 规范中定义，取代了之前用来定义响应缓存策略的头（例如 Expires）。当前的所有浏览器都支持 Cache-Control，因此，使用它就够了。</li></ul><p>不过，目前大部分服务器都会将两者添加上，因为HTTP规定，如果Cache-Control和expires同时出现的话，expires会默认被覆盖掉。 此时，返回的响应码不再是304(文件未改动),而是200(资源成功访问).</p><p>当前每次发送请求之前浏览器会检查缓存系统里，是否有相应文件的备份，如果有的话，则直接从本地模仿一个Response头 理论知识铺垫完毕，我们来take a look. 看看cache-control 有哪些可以配置的属性(以下属性都跟在cache-control后)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public: 共有缓存，可被缓存代理服务器缓存,比如CDN</span><br><span class="line">private: 私有缓存，不能被共有缓存代理服务器缓存，可被用户的代理缓存如浏览器。</span><br><span class="line">max-age=[秒]：表示在这个时间范围内缓存是新鲜的无需更新。类似Expires时间，不过这个时间是相对的，而不是绝对的。也就是某次请求成功后多少秒内缓存是新鲜的。</span><br><span class="line">s-maxage=[秒]：类似max-age, 除了仅应用于共享缓存（如代理）。</span><br><span class="line">no-cache：这里不是不缓存的意思，只是每次在使用缓存之前都强制发送请求给源服务器进行验证，检查文件该没改变(其实这里和ETag/Last区别不大)</span><br><span class="line">no-store：就是禁止缓存，不让浏览器保留缓存副本</span><br><span class="line">must-revalidate：告诉浏览器，你这必须再次验证检查信息是否过期, 返回的代号就不是<span class="number">200</span>而是<span class="number">304</span>了。</span><br><span class="line">proxy-revalidate：类似must-revalidate，除了只能应用于代理缓存。</span><br></pre></td></tr></table></figure></p><p>比如，这里我可以设置Cache-Control为:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Response Headers</span></span><br><span class="line">Cache-Control:private, max-age=<span class="number">0</span>, must-revalidate</span><br></pre></td></tr></table></figure></p><p>该文件是一个私有文件,只能被浏览器缓存，而不能被代理缓存。max-age标识该缓存立即过期，其实和no-cache实际上区别不大. 然后must-revalidate告诉浏览器，你必须给我再验证文件过没过期，比如接下来可能会验证Last-Modified或者ETag.如果没有过期则使用本地缓存. 其实上面可以直接等同于:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Response Headers</span></span><br><span class="line">Cache-Control:private,no-cache</span><br></pre></td></tr></table></figure></p><p>使用no-store的结果<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Response Headers</span></span><br><span class="line">Cache-Control:no-store;</span><br></pre></td></tr></table></figure></p><p>这样表明，不管一不一样都需要重新下载. 强烈表示，不让你使用缓存文件。后续的就不会去验证ETag了。 当然，如果你将IE6那种古老的浏览器考虑进来的话，那你干脆就做的不要脸一点，直接用下面的tag就行:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: no-cache, no-store, must-revalidate <span class="comment">//HTTP1.1</span></span><br><span class="line">Pragma: no-cache <span class="comment">//HTTP1.0</span></span><br><span class="line">Expires: <span class="number">0</span> <span class="comment">//Proxy</span></span><br></pre></td></tr></table></figure></p><p>不过现在基本上也没有不支持Cache-Control的浏览器了。所以，正常情况下，可以直接使用.如下的策略来进行设置:(From google developer)  我们通常在nginx怎么配置对应的cache-control头呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">##设置no-cache</span><br><span class="line"><span class="comment">//Nginx</span></span><br><span class="line">expires <span class="number">-1</span>;</span><br><span class="line"><span class="comment">//cache-control</span></span><br><span class="line">Cache-Control:no-cache</span><br><span class="line"></span><br><span class="line">##设置max-age=0</span><br><span class="line"><span class="comment">//Nginx</span></span><br><span class="line">expires <span class="number">0</span>;</span><br><span class="line"><span class="comment">//cache-control</span></span><br><span class="line">Cache-Control:max-age=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">##设置其他头部</span><br><span class="line"><span class="comment">//nginx</span></span><br><span class="line">add_header  Cache-Control <span class="string">"no-cache"</span>;</span><br><span class="line">add_header  Pragma no-cache;</span><br></pre></td></tr></table></figure></p><p>上面说的基本上是服务器的响应头，那在浏览器的Request headers里存在cache-control代表什么呢？ 当请求头中有:Cache-Control: max-age=0,表示缓存需要进行验证(ETag||Last-Modified)，如果缓存未过期,则可以使用。 当请求头中有:Cache-Control: no-cache,表示浏览器只能获取最新的文件。 和Response Header中的no-store相对应。</p><h2 id="组合缓存策略"><a href="#组合缓存策略" class="headerlink" title="组合缓存策略"></a>组合缓存策略</h2><p>上面介绍的last/ETag/Expires/Cache都是HTTP协议的缓存策略。当然，缓存不止这一种，比如在HTML 4.0中定义的某些meta也可以实现自定义缓存的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">"Cache-Control"</span> content=<span class="string">"no-cache, no-store, must-revalidate"</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Pragma"</span> content=<span class="string">"no-cache"</span> /&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Expires"</span> content=<span class="string">"0"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>但，实际情况是，这些meta只能在file:// 本地文件中使用，如果是服务器则默认被覆盖。现在目前主流的就是使用HTTP1.1协议缓存 不过我们一般都不会单独使用某一项。 但是，组合之后他们的效果是怎样的呢？  如果你的网页不是什么特别定制化的(私密)的，使用缓存能给你网站的性能带来极大的提升。所以很推荐使用。 一个网站，说白了就是HTML+JS+CSS+fonts+img 这几类文件(视频就呵呵了). 我们可以针对这几类文件做一些缓存层级.</p><table><thead><tr><th style="text-align:left">文件</th><th style="text-align:left">缓存层级</th></tr></thead><tbody><tr><td style="text-align:left">HTML</td><td style="text-align:left">Cache-Control: no-cache,must-revalidate</td></tr><tr><td style="text-align:left">JS</td><td style="text-align:left">Cache-Control:private,max-age=86400</td></tr><tr><td style="text-align:left">CSS</td><td style="text-align:left">Cache-Control:max-age=2629000</td></tr><tr><td style="text-align:left">img\fonts</td><td style="text-align:left">Cache-Control:max-age=2629000</td></tr></tbody></table><p>上面只是一个简单的设置，要知道HTML是一定不能缓存的(大部分网页)。 缓存设置时间应该在你版本稳定之后设置，否则会得不偿失。 另外设置Cache-Control还可以配合ETag或者Last-Modified进行补偿验证，如果后面文件变化也可以及时反映出来。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWA应用</title>
      <link href="/2019/10/09/PWA%E5%BA%94%E7%94%A8/"/>
      <url>/2019/10/09/PWA%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>PWA应用教程<br><a id="more"></a></p><h1 id="PWA应用"><a href="#PWA应用" class="headerlink" title="PWA应用"></a>PWA应用</h1><p>PWA是Progressive Web App的英文缩写， 翻译过来就是渐进式增强WEB应用， 是Google 在2016年提出的概念，2017年落地的web技术。目的就是在移动端利用提供的标准化框架，在网页应用中实现和原生应用相近的用户体验的渐进式网页应用。<br>我也是正要准备学习，<a href="https://pwa.alienzhou.com" target="_blank" rel="noopener">点这里学习</a><br>在这里要感谢<strong>PWA学习手册</strong>的作者。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVG动画介绍</title>
      <link href="/2019/09/30/SVG%E5%8A%A8%E7%94%BB%E4%BB%8B%E7%BB%8D/"/>
      <url>/2019/09/30/SVG%E5%8A%A8%E7%94%BB%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>SVG动画效果简单入门介绍<br><a id="more"></a></p><h1 id="SVG动画介绍"><a href="#SVG动画介绍" class="headerlink" title="SVG动画介绍"></a>SVG动画介绍</h1><p>本文主要是讲解关于 SVG 的一些高级动画特效，比如 SVG 动画标签，图形渐变，路径动画，线条动画，SVG 裁剪等。<br>例如：路径动画<br><img src="/2019/09/30/SVG动画介绍/1.gif" alt="img"><br>图形渐变：<br><img src="/2019/09/30/SVG动画介绍/2.gif" alt="img"><br>线条动画：<br><img src="/2019/09/30/SVG动画介绍/3.gif" alt="img"><br>以及，相关的动画的矩阵知识，这个也是现在 CSS 动画里面最重要，同时也是最为欠缺的知识点：<br><img src="/2019/09/30/SVG动画介绍/4.png" alt="img"><br>文章会先从基本语法入手，然后，慢慢深入。介绍一些动画基本原理和对应的数学原理知识点。并且文章后面，还附有相关语法的介绍，当你在遇到不熟悉语法的时候可以参考参考。<br><a href="https://jinux7.github.io/2019/09/29/SVG入门教程/" target="_blank" rel="noopener">前面一篇文章</a>，主要介绍了一些 SVG 的基本概念和基本图形。接下来我们需要了解一下，SVG 处理矢量这个特性之外，还有啥内容吸引我们，能让 SVG 现在普及度这么高？</p><h2 id="SVG-Animation"><a href="#SVG-Animation" class="headerlink" title="SVG Animation"></a>SVG Animation</h2><p>在 SVG 中，如果我们想实现一个动画效果，可以使用 CSS，JS，或者直接使用 SVG 中自带的 animate 元素添加动画。<br>使用 CSS 的话，有两种选择一种是通过 style 直接内联在里面，另外是直接使用相关的动画属性– transform。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;use id=<span class="string">"star"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"starStyle"</span> xlink:href=<span class="string">"#starDef"</span></span><br><span class="line">       transform=<span class="string">"translate(100, 100)"</span></span><br><span class="line">       style=<span class="string">"fill: #008000; stroke: #008000"</span>/&gt;</span><br></pre></td></tr></table></figure></p><p>而使用 SVG 中自定的 animate 主要还是 SVG 自己的东西，比较好用。如果想用 CSS 的动画，这都无所谓。<br>先看一个 SVG animate DEMO:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;rect x=<span class="string">"10"</span> y=<span class="string">"10"</span> width=<span class="string">"200"</span> height=<span class="string">"20"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"none"</span>&gt;</span><br><span class="line">  &lt;animate</span><br><span class="line">    attributeName=<span class="string">"width"</span></span><br><span class="line">    attributeType=<span class="string">"XML"</span></span><br><span class="line">    <span class="keyword">from</span>=<span class="string">"200"</span> to=<span class="string">"20"</span></span><br><span class="line">    begin=<span class="string">"0s"</span> dur=<span class="string">"5s"</span></span><br><span class="line">    fill=<span class="string">"freeze"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/rect&gt;</span></span><br></pre></td></tr></table></figure></p><p>通过将 animate 标签嵌套在指定的图形里面，即可实现变换的效果。另外，还有 animateTransform，它主要是用来做变形动画的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;rect x=<span class="string">"-10"</span> y=<span class="string">"-10"</span> width=<span class="string">"20"</span> height=<span class="string">"20"</span></span><br><span class="line">    style=<span class="string">"fill: #ff9; stroke: black;"</span>&gt;</span><br><span class="line">    &lt;animateTransform attributeType=<span class="string">"XML"</span></span><br><span class="line">      attributeName=<span class="string">"transform"</span> type=<span class="string">"scale"</span></span><br><span class="line">      <span class="keyword">from</span>=<span class="string">"1"</span> to=<span class="string">"4 2"</span></span><br><span class="line">      begin=<span class="string">"0s"</span> dur=<span class="string">"4s"</span> fill=<span class="string">"freeze"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/rect&gt;</span></span><br></pre></td></tr></table></figure></p><p>简单来说：</p><ul><li>animate: 相当于 CSS 中的 transition</li><li>animateTransform: 相当于 CSS 中的 transform</li></ul><p>里面一些技术细节我们这里就不过多讲解了。这里，主要想介绍一下 animate 中的 morph 的效果。</p><h3 id="animate-morph"><a href="#animate-morph" class="headerlink" title="animate morph"></a>animate morph</h3><p>该效果主要做的就是图形内部的渐变。如图：<br><img src="/2019/09/30/SVG动画介绍/2.gif" alt="img"><br>这种动画是怎么实现呢？<br>直接看代码吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;path fill=<span class="string">"#1EB287"</span>&gt;</span><br><span class="line">    &lt;animate </span><br><span class="line">             attributeName=<span class="string">"d"</span> </span><br><span class="line">             dur=<span class="string">"1440ms"</span> </span><br><span class="line">             repeatCount=<span class="string">"indefinite"</span></span><br><span class="line">             keyTimes=<span class="string">"0;</span></span><br><span class="line"><span class="string">                       .0625;</span></span><br><span class="line"><span class="string">                       .208333333;</span></span><br><span class="line"><span class="string">                       .3125;</span></span><br><span class="line"><span class="string">                       .395833333;</span></span><br><span class="line"><span class="string">                       .645833333;</span></span><br><span class="line"><span class="string">                       .833333333;</span></span><br><span class="line"><span class="string">                       1"</span></span><br><span class="line">             calcMode=<span class="string">"spline"</span> </span><br><span class="line">             keySplines=<span class="string">"0,0,1,1;</span></span><br><span class="line"><span class="string">                         .42,0,.58,1;</span></span><br><span class="line"><span class="string">                         .42,0,1,1;</span></span><br><span class="line"><span class="string">                         0,0,.58,1;</span></span><br><span class="line"><span class="string">                         .42,0,.58,1;</span></span><br><span class="line"><span class="string">                         .42,0,.58,1;</span></span><br><span class="line"><span class="string">                         .42,0,.58,1"</span></span><br><span class="line">             values=<span class="string">"M 0,0 </span></span><br><span class="line"><span class="string">                     C 50,0 50,0 100,0</span></span><br><span class="line"><span class="string">                     100,50 100,50 100,100</span></span><br><span class="line"><span class="string">                     50,100 50,100 0,100</span></span><br><span class="line"><span class="string">                     0,50 0,50 0,0</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     M 0,0 </span></span><br><span class="line"><span class="string">                     C 50,0 50,0 100,0</span></span><br><span class="line"><span class="string">                     100,50 100,50 100,100</span></span><br><span class="line"><span class="string">                     50,100 50,100 0,100</span></span><br><span class="line"><span class="string">                     0,50 0,50 0,0</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     M 50,0 </span></span><br><span class="line"><span class="string">                     C 75,25 75,25 100,50 </span></span><br><span class="line"><span class="string">                     75,75 75,75 50,100</span></span><br><span class="line"><span class="string">                     25,75 25,75 0,50</span></span><br><span class="line"><span class="string">                     25,25 25,25 50,0</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     M 25,50 </span></span><br><span class="line"><span class="string">                     C 37.5,25 37.5,25 50,0 </span></span><br><span class="line"><span class="string">                     75,50 75,50 100,100</span></span><br><span class="line"><span class="string">                     50,100 50,100 0,100</span></span><br><span class="line"><span class="string">                     12.5,75 12.5,75 25,50</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     M 25,50 </span></span><br><span class="line"><span class="string">                     C 37.5,25 37.5,25 50,0 </span></span><br><span class="line"><span class="string">                     75,50 75,50 100,100</span></span><br><span class="line"><span class="string">                     50,100 50,100 0,100</span></span><br><span class="line"><span class="string">                     12.5,75 12.5,75 25,50</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     M 50,0</span></span><br><span class="line"><span class="string">                     C 77.6,0 100,22.4 100,50 </span></span><br><span class="line"><span class="string">                     100,77.6 77.6,100 50,100</span></span><br><span class="line"><span class="string">                     22.4,100, 0,77.6, 0,50</span></span><br><span class="line"><span class="string">                     0,22.4, 22.4,0, 50,0</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string">                     </span></span><br><span class="line"><span class="string">                     M 50,0</span></span><br><span class="line"><span class="string">                     C 77.6,0 100,22.4 100,50 </span></span><br><span class="line"><span class="string">                     100,77.6 77.6,100 50,100</span></span><br><span class="line"><span class="string">                     22.4,100, 0,77.6, 0,50</span></span><br><span class="line"><span class="string">                     0,22.4, 22.4,0, 50,0</span></span><br><span class="line"><span class="string">                     Z;</span></span><br><span class="line"><span class="string">                     </span></span><br><span class="line"><span class="string">                     M 100,0 </span></span><br><span class="line"><span class="string">                     C 100,50 100,50 100,100</span></span><br><span class="line"><span class="string">                     50,100 50,100 0,100</span></span><br><span class="line"><span class="string">                     0,50 0,50 0,0</span></span><br><span class="line"><span class="string">                     50,0 50,0 100,0</span></span><br><span class="line"><span class="string">                     Z;"</span>/&gt;</span><br><span class="line">  &lt;<span class="regexp">/path&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>这么多，是不是感觉有点懵逼。不过，我们细分来看一下其实很简单。里面主要是利用 animate 中的 keyTimes，calcMode，keySplines，以及 values 这几个属性。不急，我们一个一个来解释一下。</li><li>keyTimes: 这其实和 CSS 中定义的 @keyframes 一样。通过 0-1 之间的值，定义每段动画完成的时间。格式为：value;value…。例如 0;.0625;.208333333;.3125;.395833333;.645833333;.833333333;1。从第一个动画，到第二个动画经历的时间比例为 6.25%。并且，keyTimes 需要和 values 里面定义的帧数一致。</li><li>calcMode: 用来定义动画具体的插值模型。取值有: discrete | linear[default] | paced | spline。具体可以参考 MDN。这里我们主要介绍一下 spline。该值表示每个动画间使用自定的贝塞尔变换曲线。如果没有特殊要求，使用 linear 其实已经足够了，这样就不用麻烦去定义下面的 keySplines 属性。</li><li>keySplines：该值用来具体定义动画执行时的 贝塞尔曲线。使用格式是通过 ; 来分隔每一个值。即，cubic-bezier(.31,.57,.93,.46) 为一组。使用 keySplines 表达，则为：keySplines = “.31,.57,.93,.46;”。当然，里面的贝塞尔曲线组数为 整个动画帧数 - 1。</li></ul><p>而 values 就很简单了。它是直接结合 attributeName 属性，来设置具体的值，每个值之间使用 ; 进行分隔。<br>像上面那样，可以在指定元素里面嵌套多个 animate，既实现了形状的改变，又实现了颜色的改变。Morph 比较常用于数字的更迭，比如，<a href="https://codepen.io/felixhornoiu/pen/dovub" target="_blank" rel="noopener">倒数 10s 的相关动画</a>。到这里，Morpah 相关的知识点就结束了。</p><p>接着，让我们来看一下 SVG 中，另外一非常重要的标签 – animateMotion。<br>该标签可以让指定的元素，绕着指定的路径进行运动。所以这对于复杂的路径来说非常有用，因为我们很难使用 transform 去模拟复杂的变换路径。看一个 DEMO<br><img src="/2019/09/30/SVG动画介绍/1.gif" alt="img"></p><h3 id="animateMotion"><a href="#animateMotion" class="headerlink" title="animateMotion"></a>animateMotion</h3><p>animateMotion 大致的属性和 animate 差不多，不过，它还拥有自己特有的属性，比如 keyPoints、rotate、path 等。不过，calcMode 在 AM(animateMotion) 中的默认属性由，linear 变为 paced。<br>这些属性，我们慢慢介绍，先从最简单的开始吧。首先，我们来看一个 DEMO：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;g&gt;</span><br><span class="line">  &lt;rect x=<span class="string">"0"</span> y=<span class="string">"0"</span> width=<span class="string">"30"</span> height=<span class="string">"30"</span> style=<span class="string">"fill: #ccc;"</span>/&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"30"</span> cy=<span class="string">"30"</span> r=<span class="string">"15"</span> style=<span class="string">"fill: #cfc; stroke: green;"</span>/&gt;</span><br><span class="line">  &lt;animateMotion <span class="keyword">from</span>=<span class="string">"0,0"</span> to=<span class="string">"60,30"</span> dur=<span class="string">"4s"</span> fill=<span class="string">"freeze"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>from，to：指定两点的位置，位置参数是以元素的坐标为原点的。</li><li>dur：执行渲染时间</li><li>fill：指定动画结束后停留的装填。有 freeze 和 remove 效果。remove 表示回到动画开始的位置，freeze 表示停留在动画结束的位置。</li></ul><p>如果，你想要更复杂的路径，可以直接使用 path 属性来指定路径。用法和 path 标签中 d 属性是一样的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;rect x=<span class="string">"0"</span> y=<span class="string">"0"</span> width=<span class="string">"30"</span> height=<span class="string">"30"</span> style=<span class="string">"fill: #ccc;"</span>&gt;</span><br><span class="line">    &lt;animateMotion</span><br><span class="line">    path=<span class="string">"M50,125 C 100,25 150,225, 200, 125"</span></span><br><span class="line">    dur=<span class="string">"6s"</span> fill=<span class="string">"freeze"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/rect&gt;</span></span><br></pre></td></tr></table></figure></p><p>或者使用 mpath 标签，引用外部的 path。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=<span class="string">"M10,110 A120,120 -45 0,1 110 10 A120,120 -45 0,1 10,110"</span></span><br><span class="line">      stroke=<span class="string">"lightgrey"</span> stroke-width=<span class="string">"2"</span> </span><br><span class="line">      fill=<span class="string">"none"</span> id=<span class="string">"theMotionPath"</span>/&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"10"</span> cy=<span class="string">"110"</span> r=<span class="string">"3"</span> fill=<span class="string">"lightgrey"</span>  /&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"110"</span> cy=<span class="string">"10"</span> r=<span class="string">"3"</span> fill=<span class="string">"lightgrey"</span>  /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- Red circle which will be moved along the motion path. --&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">""</span> cy=<span class="string">""</span> r=<span class="string">"5"</span> fill=<span class="string">"red"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Define the motion path animation --&gt;</span><br><span class="line">    &lt;animateMotion dur=<span class="string">"6s"</span> repeatCount=<span class="string">"indefinite"</span>&gt;</span><br><span class="line">      &lt;mpath xlink:href=<span class="string">"#theMotionPath"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/animateMotion&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>circle&gt;</span><br></pre></td></tr></table></figure></p><p>动画效果为：<br><img src="/2019/09/30/SVG动画介绍/6.gif" alt="img"><br>所以，一般而言我们在定义 AM 的路径的时候，只用一种方式定义即可，否则会发生相应的覆盖：mpath&gt;path&gt;values&gt;from/to。<br>在 AM 运动中，还有一个很重要的概念就是旋转角。默认情况下，运动物体的角度是按照它和坐标轴的初始角度确定的。例如：<br><img src="/2019/09/30/SVG动画介绍/7.gif" alt="img"><br>这样看起来确实有些别扭，那能不能让物体垂直于路径进行运动呢？<br>有的，根据 rotate 属性值，一共有 3 个值可供选择。</p><ul><li>auto：让物体垂直于路径的切线方向运动。不过，如果你的路径是闭合曲线的话，需要注意起始点的位置。</li></ul><p>例如：<br><img src="/2019/09/30/SVG动画介绍/8.gif" alt="img"></p><ul><li>auto-reverse：让物体垂直于路径的切线方向并 + 180°。也就是和 auto 运动关于切线对称。<br><img src="/2019/09/30/SVG动画介绍/9.gif" alt="img"></li><li>Number：让物体以固定的旋转角度运动。这个就相当于使用 transform:rotate(deg) 进行控制。</li></ul><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>该标签也是用来模拟 transition 效果的。它和 animate 的主要区别是，它仅仅需要 to 的指定属性，而不需要其他的参考属性，比如 from，by 等。那它有啥特别的存在意义吗？<br>有的，因为 set 针对于所有属性，甚至包括 style 里面的相关 CSS 属性。所以，可以靠它来很好描述一些非 number 的属性值。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;text text-anchor=<span class="string">"middle"</span> x=<span class="string">"60"</span> y=<span class="string">"60"</span> style=<span class="string">"visibility: hidden;"</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">set</span> attributeName="visibility" attributeType="CSS"</span><br><span class="line">    to="visible" begin="4.5s" dur="1s" fill="freeze"/&gt;</span><br><span class="line">  All gone!</span><br><span class="line">&lt;/text&gt;</span><br></pre></td></tr></table></figure></p><h2 id="矩阵动画"><a href="#矩阵动画" class="headerlink" title="矩阵动画"></a>矩阵动画</h2><p>上面差不多简单阐述了关于 SVG 一些比较有特点的动画。当然，还有比较重要的线条动画，这个我们放到后面进行讲解。这里先来看一下所有动画中，非常重要的矩阵原理。线性代数应该是大学里面来说，最容易学的一门科目，MD。。。还记得，大学线代期末考试的时候，100 分的同学应该说是如韭菜地般，一抓一大片（对不起，我没能和他们同流合污。）<br>那矩阵是如何在动画中使用的呢？<br>简单的说，矩阵中的每个元素其实可以等价代换为每个因式里面的系数：<br><img src="/2019/09/30/SVG动画介绍/27.png" alt="img"><br>上面也叫作 三维矩阵。即，它涉及到 x,y,z 轴的计算。那对于我们平面 2D 变换来说，那么此时矩阵又是哪种形式呢？<br>很简单，只要将 z 轴永远置为一个常数就 OK。这里，惯例上是直接取 0 0 1 来设置。<br><img src="/2019/09/30/SVG动画介绍/10.png" alt="img"><br>不信的话，大家只要代进去乘以乘，应该就可以得到结果了。所以，在二维中，具体变换方式为：<br><img src="/2019/09/30/SVG动画介绍/4.png" alt="img"><br>后面，我们也会依据这个公式进行相关的变形操作。那矩阵变换是怎么运用到 CSS/SVG 当中呢？<br>在 CSS 中，是直接使用 transform 中的属性：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: matrix(a,b,c,d,e,f);</span><br></pre></td></tr></table></figure></p><p>当然，在 SVG 中也是一样的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;g transform=<span class="string">"matrix(1,2,3,4,5,6)"</span>&gt;</span><br><span class="line">    &lt;line x1=<span class="string">"10"</span> y1=<span class="string">"20"</span> x2=<span class="string">"30"</span> y2=<span class="string">"40"</span> style=<span class="string">"stroke-width: 10px; stroke: blue;"</span>/&gt;</span><br><span class="line">  &lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><p>所以，我们主要的重点就是讲解一下 matrix 这个属性。它的格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matrix(a,b,c,d,e,f);</span><br></pre></td></tr></table></figure></p><p>对应于我们上面的公式有：<br><img src="/2019/09/30/SVG动画介绍/10.png" alt="img"><br>在接触 transform 的时候，大家应该了解到 transform 里面有很多固定的动画属性：</p><ul><li>translate()</li><li>rotate()</li><li>scale()</li><li>skew()<br>实际上，在底层还是使用 matrix 实现的变换。就拿 translate 举个例子吧。<br>translate 的格式为：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">translate(dx,dy)</span><br></pre></td></tr></table></figure></li></ul><p>相当于参考当前原点，在 x/y 轴上移动 dx/dy 的距离。那么映射到矩阵，应该如何表示呢？<br>很简单，它等同于：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matrix(<span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> dx dy);</span><br></pre></td></tr></table></figure></p><p>使用代数证明一下：<br>假设有 matrix(1 0 0 1 20 30)<br>变为矩阵为：<br><img src="/2019/09/30/SVG动画介绍/11.png" alt="img"><br>根据，上面的表达式有：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = x<span class="string">'*1 + y'</span>*<span class="number">0</span> + <span class="number">20</span> = x<span class="string">' + 20</span></span><br><span class="line"><span class="string">Y = x'</span>*<span class="number">0</span> + y<span class="string">'*1 + 30 = y'</span> + <span class="number">30</span></span><br></pre></td></tr></table></figure></p><p>所以，就是 X 在原有 X 轴坐标上向右移动 20 的距离，Y 相对于原有移动 30 的距离。<br>那么其他几个属性呢？也是怎么变化的吗？<br>恩，类似。只是里面取值不一样：</p><ul><li>scale(x,y): 放大 X/Y 轴，矩阵的表达为 matrix(x 0 0 y 0 0)。</li><li>rotate(θ): 坐标旋转，矩阵的表达为 matrix(cosθ sinθ -sinθ cosθ 0 0)。</li><li>skew(θx,θy): X/Y 轴拉伸，矩阵的表达为 matrix(1 tanθx tanθy 1 0 0)。</li></ul><p>注意，上面三个都会改变原有物体的坐标系！！！ 这点很重要，换句话说，后面每次变换都是基于前面一个的变换结果的。<br>详情看图：<br><img src="/2019/09/30/SVG动画介绍/12.png" alt="img"><br>详情可以参考：<a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/transform" target="_blank" rel="noopener">MDN matrix</a><br>不过，这并不是我们使用 matrix 的重点，也不是它的优势。它的优势在于可计算，即，能够将复杂的动画集合到一个表达式中，并且，后续的变换可以直接基于当前的 matrix。<br>我们先来了解一下，如果多个变换动画一起使用，matrix 应该如何表达呢？<br><strong>只需要找到我们变换动画对应的矩阵，然后相乘即可。</strong>例如，先旋转 45°，然后放大 1.5 倍，则有变换动画为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotate(<span class="number">45</span>deg) scale(<span class="number">1.5</span>,<span class="number">1.5</span>);</span><br></pre></td></tr></table></figure></p><p>注意，虽然，你定义动画是分开的，但此时的动画是同时进行的。为啥？因为，这两个动画实际上可以整合成为一个变换矩阵：<br><img src="/2019/09/30/SVG动画介绍/13.png" alt="img"><br>并且，位置是不可以调换的。比如，transform: scale(2,2) translate(20px,30px)。即，你先放大两倍，然后移动 20,30 的距离。注意，这里移动的 20,30 相对的是已经放大过后的坐标，相对于原坐标而言就是 40,60 了。 如果，你调换位置，即 transform: translate(20px,30px) scale(2,2)。就变成现在原坐标移动 20,30，然后再放大两倍。<br>而上面强调的顺序关系，实际上就可以理解为矩阵不满足交换律的原则。因为一旦交换，结果很可能不一样。</p><h3 id="矩阵高级用法"><a href="#矩阵高级用法" class="headerlink" title="矩阵高级用法"></a>矩阵高级用法</h3><p>上面的内容只是简单的描述了关于矩阵的概念。在实际中，矩阵可以说是真正利器。<br>假设现在有一个动画，要求你将一个物体从一个点通过抛物线的方式移动到另外一个点，那么此时要求 JS/CSS 随你挑。此时，你会不会感觉，呼吸急促，头脑发热呢？<br>恩，matrix 可以治，而且包治百病。不过，matrix 有一个限制点，它只能用于一次线性动画表达式。即，针对于抛物线，椭圆曲线这类复杂曲线来说，不太合适。那么有什么办法吗？<br>有的，微分思想。每一段动画其实都可以通过一定范围内的直线拼接而成，那么这样，我们就可以将一段抛物线拆分为由几段线段构成的曲线。当然，如果你分的越细，拟合度就越高。这里我们不打算过度你和，我们简单的将一段抛物线分为 5段。<br>如图：<br><img src="/2019/09/30/SVG动画介绍/14.png" alt="img"><br>那么接下来就是抠细节。这里，依次取倾角为 45°，30°，0°，-45°，-30° 这 5 段直线。每段分配的时间比例为 20%、25%、10%、25%、20% 这主要是用于 keyframe 的设定。现在，用数学来分析一下，这个动画到底该怎么弄。<br>现在，已知两点之间的距离为 100px。那么我们同样根据上述比例分，则有 20px, 25px, 10px, 25px, 20px。<br>这里我们以 45° 倾角为参考点，则终点坐标为 (20,20); 。那么，该段的矩阵为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意 Y 轴需要取负值！</span></span><br><span class="line"></span><br><span class="line"> <span class="number">1</span> <span class="number">0</span> <span class="number">20</span></span><br><span class="line"> <span class="number">0</span> <span class="number">1</span> <span class="number">-20</span></span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>CSS 中的变形动画为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: matrix(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">20</span>,<span class="number">-20</span>);</span><br></pre></td></tr></table></figure></p><p>然后，第二段就为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">25</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">-14.4</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>使用矩阵的乘法法，则有：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">45</span></span><br><span class="line"> <span class="number">0</span> <span class="number">1</span> <span class="number">-34.4</span></span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p> 变形动画为：<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: matrix(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">45</span>,<span class="number">-34.4</span>);</span><br></pre></td></tr></table></figure></p><p>剩余几段也是这样的做法。最终，整个 keyframe 就应该表示为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@keyframe Parabola&#123;</span><br><span class="line">    <span class="number">20</span>%&#123;</span><br><span class="line">        transform: matrix(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">20</span>,<span class="number">-20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">45</span>%&#123;</span><br><span class="line">        transform: matrix(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">45</span>,<span class="number">-34.4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>整个动画过程差不多都是这样。当然，矩阵也不仅仅局限于这几个动画，凭借着高度定制化和灵活性的特点，这它还常常用于进行回弹，弹跳等动画中。如果大家有兴趣，后期也可以对这类动画进行简单的讲解。<br>后面，我们最后来了解一下 SVG 中很重要的线条动画。</p><h2 id="线条动画"><a href="#线条动画" class="headerlink" title="线条动画"></a>线条动画</h2><p>SVG 中的线条动画常常用作过渡屏（splash screen）中。例如：</p><p><img src="/2019/09/30/SVG动画介绍/15.gif" alt="img"></p><p>或者，一些比较炫酷的 LOGO 中，比如 AllowTeam 的：</p><p><img src="/2019/09/30/SVG动画介绍/16.gif" alt="img"><br>看到这些炫酷的效果，大家有没有动心想学一学，看看自己到底能否做的这么好呢？<br>OK，我们现在来正式介绍一下线条动画。在 SVG 中，最长用到的线条标签就是 Path。这里我前面一篇文章已经做了介绍，我这里就不赘述了。<br>而在具体变化当中用到的是关于 stroke 的相关属性：（下面的属性都可以直接用在 CSS 当中！）</p><ul><li>stroke：定义笔触的颜色。例如：stroke=”green”</li><li>stroke-dasharray：定义 dash 和 gap 的长度。它主要是通过使用 , 来分隔 实线 和 间隔 的值。例如：stroke-dasharray=”5, 5” 表示，按照 实线为 5，间隔为 5 的排布重复下去。如下图：<br><img src="/2019/09/30/SVG动画介绍/28.png" alt="img"><br>放大看有：<br><img src="/2019/09/30/SVG动画介绍/17.png" alt="img"><br>另外，stroke-dasharray 并不局限于只能设置两个值，要知道，它本身的含义是设置最小重复单元，即，dash,gap,dash,gap…。比如，我定义 stroke-dasharray=”15, 10, 5” 则相当于，[15,10,5] 为一段。则有：<br><img src="/2019/09/30/SVG动画介绍/18.png" alt="img"><br>放大看则有：<br><img src="/2019/09/30/SVG动画介绍/19.png" alt="img"></li><li>stroke-dashoffset: 用来设置 dasharray 定义其实 dash 线条开始的位置。值可以为 number || percentage。百分数是相对于 SVG 的 viewport。通常结合 dasharray 可以实现线条的运动。</li><li>stroke-linecap: 线条的端点样式。</li><li>stroke-linejoin: 线条连接的样式</li><li>stroke-miterlimit: 一个比较复杂的概念，如果我们只是画一些一般的线段，使用上面 linejoin 即可。如果涉及对边角要求比较高的，则可以使用该属性进行定义。它的值，其实就是角长度比上线宽：<br><img src="/2019/09/30/SVG动画介绍/20.png" alt="img"><br>而实际理解的话，就是假设当 width 为 1。此时比例为 2。那么 miter = 2。那么超过 2 的 miter 部分则会被 cut 掉。可以参照：<br><img src="/2019/09/30/SVG动画介绍/21.png" alt="img"><br>他主要是配合 linejoin 一起使用。因为 linejoin 默认取值就是 miter。所以，默认情况下就可以使用该标签属性。它默认值为 4。其余的大家下去实践一下即可。详细可以参考: <a href="https://www.oxxostudio.tw/articles/201409/svg-16-storke-miterlimit.html" target="_blank" rel="noopener">miter</a></li><li>stroke-opacity：线段的透明度</li><li>stroke-width：线的粗细。</li></ul><p>OK，介绍完关于 path 的所有 stroke 属性之后，我们就要开始动手写一下让线条动起来的代码。简单来说，就是通过 stroke-dashoffset 和 stroke-dasharray 来做。整个动画可以分为两个过程：</p><ul><li>通过 dasharray 将实线部分隐藏，空余为全线段长。然后，将实线部分增加至全长。比如：dasharray: 0,1000 变为 dasharray: 1000,1000。</li><li>同时，通过 dashoffset 来移动新增的实线部分，造成线段移动的效果。有: dashoffset:0，变为 dashoffset:1000。</li></ul><p>不过，这里我们不打算使用 Path 来做啥复杂的动画，这主要考虑到手头没有一些 SVG 生成工具。所以，这里我们就以 Text 来做吧（因为做起来真的简单）。<br>这里，先以 IV-WEB 这段文字来做动画。<br>先给大家看一下最终结果：<br><img src="/2019/09/30/SVG动画介绍/3.gif" alt="img"><br>那么这种动画是怎么做的呢？<br>这里，我主要介绍一下关于 CSS 相关，SVG 就一个 Text 我直接贴代码了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg viewBox=<span class="string">"0 0 1320 300"</span>&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- <span class="built_in">Symbol</span> --&gt;</span><br><span class="line">  &lt;symbol id=<span class="string">"s-text"</span>&gt;</span><br><span class="line">    &lt;text text-anchor=<span class="string">"middle"</span></span><br><span class="line">          x=<span class="string">"50%"</span> y=<span class="string">"50%"</span> dy=<span class="string">".35em"</span>&gt;</span><br><span class="line">      IV-WEB</span><br><span class="line">    &lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>symbol&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;!-- Duplicate symbols --&gt;</span><br><span class="line">  &lt;use xlink:href=<span class="string">"#s-text"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"text"</span></span><br><span class="line">       &gt;&lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  &lt;use xlink:href="#s-text" class="text"</span></span><br><span class="line"><span class="regexp">       &gt;&lt;/u</span>se&gt;</span><br><span class="line">  &lt;use xlink:href=<span class="string">"#s-text"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"text"</span></span><br><span class="line">       &gt;&lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>svg&gt;</span><br></pre></td></tr></table></figure></p><p>上面是通过创建一个居中定位的字体，然后使用 3 个 text 重叠。具体 CSS 我们下面来说一下。首先，我们营造的效果是从无到有，就需要使用 dasharray 将 gap 设置的足够大。这里我取 300 即可。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stroke-dasharray: <span class="number">0</span> <span class="number">300</span>;</span><br></pre></td></tr></table></figure></p><p>然后，通过 nth-child 选择器，给每一个文字使用不同的颜色值：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:nth-child(<span class="number">3n</span> + <span class="number">1</span>) &#123;</span><br><span class="line">  stroke: #F60A0A;</span><br><span class="line">&#125;</span><br><span class="line">.text:nth-child(<span class="number">3n</span> + <span class="number">2</span>) &#123;</span><br><span class="line">  stroke: #F2FF14;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text:nth-child(<span class="number">3n</span> + <span class="number">3</span>) &#123;</span><br><span class="line">  stroke: #FB9505;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>下面才是重点内容。此时，这 3 个 text 的起始点重合。我现在既要他们在运行时不完全重合，又要他们的线条能进行滚动。不啰嗦了，直接看代码吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@keyframes stroke &#123;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    stroke-dashoffset: <span class="number">1000</span>;</span><br><span class="line">    stroke-dasharray: <span class="number">80</span> <span class="number">160</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes stroke1 &#123;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    stroke-dashoffset: <span class="number">1080</span>;</span><br><span class="line">    stroke-dasharray: <span class="number">80</span> <span class="number">160</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@keyframes stroke2 &#123;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    stroke-dashoffset: <span class="number">1160</span>;</span><br><span class="line">    stroke-dasharray: <span class="number">80</span> <span class="number">160</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这就是上面 3 个不同的 text 运用的动画。dashoffet 由 0 到 1000。这完成了滚动的目的。同时，为了让字体不重合，我还需要在对应字体的 dashoffset 上，加上不同的间隔距离。比如，第一个字体 offset 为 1000。那么第二个字体，我需要加上前一个字体 dash 的长度，即，80。所以，第二个字体就变为 1080。那么第三个就是加上前两个的 dash 长度，即 1160。<br>大致过程就是这样，详情可以查看： <a href="https://codepen.io/JimmyVV/pen/oWWzdB" target="_blank" rel="noopener">IVWEB 线条动画</a>。</p><h2 id="SVG-中使用-transition"><a href="#SVG-中使用-transition" class="headerlink" title="SVG 中使用 transition"></a>SVG 中使用 transition</h2><p>在 SVG 中，本来就存在相关的动画 Tag，不过里面用起来比较复杂，最常用的还是直接利用 CSS 里面相关的属性标签来做。其中，transition 是最常用的。比如，想做一下颜色的渐变等等。这里可以直接利用 transition 修饰指定的 SVG 属性即可。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># fill 是 SVG 中，专有属性</span><br><span class="line">path &#123; <span class="attr">transition</span>: fill <span class="number">.4</span>s ease; &#125;</span><br><span class="line">#europe       path &#123; fill: red; &#125;</span><br><span class="line">#europe:hover path &#123; fill: white; &#125;</span><br></pre></td></tr></table></figure></p><h2 id="SVG-文字"><a href="#SVG-文字" class="headerlink" title="SVG 文字"></a>SVG 文字</h2><p>在 SVG 中定义文字直接使用 text 标签即可。关于文字来说，一般而言需要注意的点就那么即可，文字的排列，间距等等。这些都可以直接使用 CSS 进行控制。不过，有几个属性比较特殊，这里需要额外提一下。</p><h3 id="text-anchor"><a href="#text-anchor" class="headerlink" title="text-anchor"></a>text-anchor</h3><p>用来定义参考点和实际字符之间的定位关系。格式为：</p><ul><li>text-anchor: start | middle | end | inherit<br>直接看代码解释吧：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Anchors <span class="keyword">in</span> action --&gt;</span><br><span class="line">    &lt;text text-anchor=<span class="string">"start"</span></span><br><span class="line">          x=<span class="string">"60"</span> y=<span class="string">"40"</span>&gt;A&lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;text text-anchor="middle"</span></span><br><span class="line"><span class="regexp">          x="60" y="75"&gt;A&lt;/</span>text&gt;</span><br><span class="line"></span><br><span class="line">    &lt;text text-anchor=<span class="string">"end"</span></span><br><span class="line">          x=<span class="string">"60"</span> y=<span class="string">"110"</span>&gt;A&lt;<span class="regexp">/text&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>第一个 A，参考的是 (60,40) 的点，定义为 start ，那么参考点应该在字符的前面。<br><img src="/2019/09/30/SVG动画介绍/22.png" alt="img"><br>而剩下两个也是同样的道理：<br><img src="/2019/09/30/SVG动画介绍/23.png" alt="img"></p><h3 id="tspan"><a href="#tspan" class="headerlink" title="tspan"></a>tspan</h3><p>现在，假如我们想在 text 里面添加一些特殊的字符效果，比如斜体，加粗等。由于，text 标签不能实现嵌套，所以，为了解决这个痛点，提出了 tspan 的标签。它其实就是一个可以嵌套的 text 标签。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;text x=<span class="string">"10"</span> y=<span class="string">"30"</span> style=<span class="string">"font-size:12pt;"</span>&gt;</span><br><span class="line">  Switch among</span><br><span class="line">  &lt;tspan style=<span class="string">"font-style:italic"</span>&gt;italic&lt;<span class="regexp">/tspan&gt;, normal,</span></span><br><span class="line"><span class="regexp">  and &lt;tspan style="font-weight:bold"&gt;bold&lt;/</span>tspan&gt; text.</span><br><span class="line">&lt;<span class="regexp">/text&gt;</span></span><br></pre></td></tr></table></figure></p><p>tspan 里面同样可以自定义相关的自身属性。详细的可以参考 <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/tspan" target="_blank" rel="noopener">tspan</a> 我这里就不详述了。</p><h3 id="在-Path-展示-text"><a href="#在-Path-展示-text" class="headerlink" title="在 Path 展示 text"></a>在 Path 展示 text</h3><p>Text 一般可以横放，竖放。那有没有啥办法让文字可以按照一定的路径任意排放呢？<br>有的，这里可以使用 textPath 标签，来定义具体参考路径。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;path id=<span class="string">"sharp-corner"</span></span><br><span class="line">    d=<span class="string">"M 30 110 100 110 100 160"</span></span><br><span class="line">    style=<span class="string">"stroke: gray; fill: none;"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;text&gt;</span><br><span class="line">    &lt;textPath xlink:href=<span class="string">"#sharp-corner"</span>&gt;</span><br><span class="line">    Making a quick turn</span><br><span class="line">    &lt;<span class="regexp">/textPath&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>text&gt;</span><br></pre></td></tr></table></figure></p><p>如图：<br><img src="/2019/09/30/SVG动画介绍/24.png" alt="img"></p><h2 id="Clip"><a href="#Clip" class="headerlink" title="Clip"></a>Clip</h2><p>在 DOM 中如果想展示一个图片的部分，或者以某种形状展示图片的部分，一般是通过一个 cover div 来实现的。不过，如果涉及到不规则图形的话，那么 DOM 就有天生缺陷了（当然使用 CSS 里的 clip-path 可以完成，不过兼容性不太好）。而在 SVG 中，提供了 clipPath 标签，能够让我们自定义裁剪图片的范围和形状。<br>clipPath 里面可以接任何图形，比如，path,rect 甚至是 text。使用的时候，直接在 style 中，指定 clip-path 即可，或者直接使用 clip-path 属性指定。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;defs&gt;</span><br><span class="line">  &lt;clipPath id=<span class="string">"textClip"</span>&gt;</span><br><span class="line">    &lt;text id=<span class="string">"text1"</span> x=<span class="string">"20"</span> y=<span class="string">"20"</span> transform=<span class="string">"rotate(60)"</span></span><br><span class="line">      style=<span class="string">"font-family: 'Liberation Sans';</span></span><br><span class="line"><span class="string">        font-size: 48pt; stroke: black; fill: none;"</span>&gt;</span><br><span class="line">CLIP</span><br><span class="line">    &lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>clipPath&gt;</span><br><span class="line"> &lt;<span class="regexp">/defs&gt;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp"> &lt;use transform="translate(100, 0)"</span></span><br><span class="line"><span class="regexp">  xlink:href="#shapes" style="clip-path: url(#textClip);"/</span>&gt;</span><br><span class="line">  </span><br><span class="line">   &lt;use transform=<span class="string">"translate(100, 0)"</span></span><br><span class="line">  xlink:href=<span class="string">"#shapes"</span> clip-path=<span class="string">"url(#textClip);"</span>/&gt;</span><br></pre></td></tr></table></figure></p><p><img src="/2019/09/30/SVG动画介绍/25.png" alt="img"><br>或者说，如果我们想画一个圆的裁剪区域的话：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;defs&gt;</span><br><span class="line">     &lt;clipPath id=<span class="string">"circularPath"</span> clipPathUnits=<span class="string">"objectBoundingBox"</span>&gt;</span><br><span class="line">     &lt;circle cx=<span class="string">"0.5"</span> cy=<span class="string">"0.5"</span> r=<span class="string">"0.5"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/clipPath&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>defs&gt;</span><br><span class="line"></span><br><span class="line">&lt;use xlink:href=<span class="string">"#shapes"</span> style=<span class="string">"clip-path: url(#circularPath);"</span> /&gt;</span><br></pre></td></tr></table></figure></p><h2 id="Appendix-参考标签"><a href="#Appendix-参考标签" class="headerlink" title="Appendix 参考标签"></a>Appendix 参考标签</h2><h3 id="g"><a href="#g" class="headerlink" title="g"></a>g</h3><p>分组标签应该毫无意外排第一，因为其实作为绘制图形中最常和最基本的标签。前面一篇文章也主要介绍过了，这里做点补充。<br>每一个分组标签都带有 id 属性，唯一标识该分组，为什么呢？<br>因为，后面我们可以使用该 id 标签添加动画，重用该分组等。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;g id=<span class="string">"demo"</span> stroke=<span class="string">"green"</span> fill=<span class="string">"white"</span> stroke-width=<span class="string">"5"</span>&gt;</span><br><span class="line">   &lt;circle cx=<span class="string">"25"</span> cy=<span class="string">"25"</span> r=<span class="string">"15"</span>/&gt;</span><br><span class="line">   &lt;circle cx=<span class="string">"40"</span> cy=<span class="string">"25"</span> r=<span class="string">"15"</span>/&gt;</span><br><span class="line">   &lt;circle cx=<span class="string">"55"</span> cy=<span class="string">"25"</span> r=<span class="string">"15"</span>/&gt;</span><br><span class="line">   &lt;circle cx=<span class="string">"70"</span> cy=<span class="string">"25"</span> r=<span class="string">"15"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><p>每个分组里面可以含有一些描述标签，比如 desc。 这些描述内容是不会被渲染的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;g id=<span class="string">"demo"</span> stroke=<span class="string">"green"</span> fill=<span class="string">"white"</span> stroke-width=<span class="string">"5"</span>&gt;</span><br><span class="line">  &lt;desc&gt;Just Demo&lt;<span class="regexp">/desc&gt;</span></span><br><span class="line"><span class="regexp">  &lt;circle cx="25" cy="25" r="15"/</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="use"><a href="#use" class="headerlink" title="use"></a>use</h3><p>该标签就是结合 g 标签一起使用，作用是可以复用 g 分组的样式。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;g id=<span class="string">"Port"</span>&gt;</span><br><span class="line">      &lt;circle style=<span class="string">"fill: inherit;"</span> r=<span class="string">"10"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp">&lt;use x="50" y="30" xlink:href="#Port" class="classA"/</span>&gt;</span><br></pre></td></tr></table></figure></p><p>里面使用 xlink:href 加上指定 group 的 id，然后通过 x，y 属性指定副本放置的位置。不过，有一个限制，use 标签的 style 属性，并不能覆盖点原始的 group style 样式。而且，有时候，我们只是想使用一些模板，即，图形并未被解析，只有代码存在。这时候，就需要使用 defs 来包裹了。</p><h3 id="defs"><a href="#defs" class="headerlink" title="defs"></a>defs</h3><p>用来保存一些代码，使其不会被浏览器解析。并且里面的分组可以被 use 属性的 style 样式所覆盖。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &lt;defs&gt;</span><br><span class="line">   &lt;g id=<span class="string">"Port"</span>&gt;</span><br><span class="line">     &lt;circle style=<span class="string">"fill: inherit;"</span> r=<span class="string">"10"</span>/&gt;</span><br><span class="line">   &lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp"> &lt;/</span>defs&gt;</span><br><span class="line"></span><br><span class="line">&lt;use x=<span class="string">"50"</span> y=<span class="string">"50"</span> xlink:href=<span class="string">"#Port"</span> style=<span class="string">"fill: blue;"</span>/&gt;</span><br></pre></td></tr></table></figure></p><h3 id="symbol"><a href="#symbol" class="headerlink" title="symbol"></a>symbol</h3><p>该标签和 g 标签类似，也是用来进行分组。不过，它有个特点，即，不会被浏览器所渲染。那它不和 defs 差不多吗？<br>恩，确实。不过，defs 是官方推荐，用来包裹一些模板 svg 代码而创造出来，用来增加可读性的标签。而 symbol 是存粹的作为一个模板。它可以独立于 svg 的 viewbox 来自定义子 viewbox 和 preserveAspectRatio。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;symbol id=<span class="string">"sym01"</span> viewBox=<span class="string">"0 0 150 110"</span>&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"50"</span> cy=<span class="string">"50"</span> r=<span class="string">"40"</span> stroke-width=<span class="string">"8"</span></span><br><span class="line">      stroke=<span class="string">"red"</span> fill=<span class="string">"red"</span>/&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"90"</span> cy=<span class="string">"60"</span> r=<span class="string">"40"</span> stroke-width=<span class="string">"8"</span></span><br><span class="line">      stroke=<span class="string">"green"</span> fill=<span class="string">"white"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/symbol&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;use href="#sym01"</span></span><br><span class="line"><span class="regexp">     x="0" y="0" width="100" height="50"/</span>&gt;</span><br></pre></td></tr></table></figure></p><p>同样使用该模板，也是使用 use 标签来完成。</p><h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>既然 use 可以重用 SVG 代码，那么 SVG 里面能不能重用已经画好的 png/jpg 的图片呢？<br>这时候，就需要用到 image 标签。其可以用来加载外部的 PNG, JPEG 图片，注意，官方规定是前两种，其它图片支持不支持官方没做答复。即，如果你使用 GIF 图片，并不能保证所有的浏览器都能正常显示。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;image xlink:href=<span class="string">"kwanghwamun.jpg"</span></span><br><span class="line">  x=<span class="string">"72"</span> y=<span class="string">"92"</span></span><br><span class="line">  width=<span class="string">"160"</span> height=<span class="string">"120"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p><p>同样，该 image 标签也具有自定义 preserveAspectRatio 的效果。</p><ul><li>x: 定义水平位置</li><li>y: 定义垂直位置</li><li>width: 图片渲染的宽度，必须有。</li><li>height: 图片渲染的高度，必须有。</li><li>preserveAspectRatio: 控制图片的缩放</li></ul><h3 id="marker"><a href="#marker" class="headerlink" title="marker"></a>marker</h3><p>marker 一般是用来画箭头或者线段始末的标识图形。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;defs&gt;</span><br><span class="line">    &lt;marker id=<span class="string">"Triangle"</span> viewBox=<span class="string">"0 0 10 10"</span> refX=<span class="string">"1"</span> refY=<span class="string">"5"</span></span><br><span class="line">        markerWidth=<span class="string">"6"</span> markerHeight=<span class="string">"6"</span> orient=<span class="string">"auto"</span>&gt;</span><br><span class="line">      &lt;path d=<span class="string">"M 0 0 L 10 5 L 0 10 z"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/marker&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>defs&gt;</span><br><span class="line"></span><br><span class="line">  &lt;polyline points=<span class="string">"10,90 50,80 90,20"</span> fill=<span class="string">"none"</span> stroke=<span class="string">"black"</span> </span><br><span class="line">      stroke-width=<span class="string">"2"</span> marker-end=<span class="string">"url(#Triangle)"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>如图:<br><img src="/2019/09/30/SVG动画介绍/26.png" alt="img"><br>这里我们只需要里了解即可，因为在实际画的时候，直接使用相关工具生成更加方便。</p><h3 id="a"><a href="#a" class="headerlink" title="a"></a>a</h3><p>这里的 a 标签和我们直接在 HTML 使用的超链接 a 标签类似。也是用来定义一个外链的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;a xlink:href=<span class="string">"https://developer.mozilla.org/en-US/docs/SVG"</span></span><br><span class="line">    target=<span class="string">"_blank"</span>&gt;</span><br><span class="line">  &lt;rect height=<span class="string">"30"</span> width=<span class="string">"120"</span> y=<span class="string">"0"</span> x=<span class="string">"0"</span> rx=<span class="string">"15"</span>/&gt;</span><br><span class="line">  &lt;text fill=<span class="string">"white"</span> text-anchor=<span class="string">"middle"</span> </span><br><span class="line">        y=<span class="string">"21"</span> x=<span class="string">"60"</span>&gt;SVG on MDN&lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>a&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web图形 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVG入门教程</title>
      <link href="/2019/09/29/SVG%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2019/09/29/SVG%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>SVG基础入门教程<br><a id="more"></a></p><h1 id="SVG入门教程"><a href="#SVG入门教程" class="headerlink" title="SVG入门教程"></a>SVG入门教程</h1><p>svg和canvas是web页面画图的两个方式，我们在开发中常用的图形是折线图，柱形图，扇形图等，大多都用现有的库来做，如echarts，highcherts,d3等。但是有些特殊的图形用库是实现不了的，这时候就需要我们自己去完成，canvas性能好，但是难度大，所以，这次我来介绍下svg的基础写法，方便使用。<br>SVG 全称是 Scalable Vector Graphics，即，矢量图。在 Web 中使用 SVG 可以解决位图放大失真的问题。首先，不要把 SVG 和 CSS，Canvas，HTML 搞混。他们之间并没有你中有我，我中有你的关系。SVG 是通过 XML 的形式写在 HTML 文档中的。</p><h2 id="如何书写"><a href="#如何书写" class="headerlink" title="如何书写"></a>如何书写</h2><p>开篇说过，SVG 就是一个 XML。看一下代码吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg x=<span class="string">"0px"</span> y=<span class="string">"0px"</span> width=<span class="string">"450px"</span> height=<span class="string">"100px"</span> viewBox=<span class="string">"0 0 450 100"</span>&gt;</span><br><span class="line">  &lt;rect x=<span class="string">"10"</span> y=<span class="string">"5"</span> fill=<span class="string">"white"</span> stroke=<span class="string">"black"</span> width=<span class="string">"90"</span> height=<span class="string">"90"</span>/&gt;</span><br><span class="line">  &lt;circle fill=<span class="string">"white"</span> stroke=<span class="string">"black"</span> cx=<span class="string">"170"</span> cy=<span class="string">"50"</span> r=<span class="string">"45"</span>/&gt;</span><br><span class="line">  &lt;polygon fill=<span class="string">"white"</span> stroke=<span class="string">"black"</span> points=<span class="string">"279,5 294,35 328,40 303,62</span></span><br><span class="line"><span class="string">  309,94 279,79 258,94 254,62 230,39 263,35"</span>/&gt;</span><br><span class="line">  &lt;line fill=<span class="string">"none"</span> stroke=<span class="string">"black"</span> x1=<span class="string">"410"</span> y1=<span class="string">"95"</span> x2=<span class="string">"440"</span> y2=<span class="string">"6"</span>/&gt;</span><br><span class="line">  &lt;line fill=<span class="string">"none"</span> stroke=<span class="string">"black"</span> x1=<span class="string">"360"</span> y1=<span class="string">"6"</span> x2=<span class="string">"360"</span> y2=<span class="string">"95"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p><p>大家看 svg 标签中带有一个 viewBox 的属性。这其实是 SVG 中一个很重要的概念，后面的缩放都会与它有关。<br>说到这里，我们就需要了解一下关于 SVG 的几个基本概念。</p><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>简单来说有 3 个基本概念：</p><ul><li>viewport: 物理窗口</li><li>viewbox: 实物窗口（算了，下面解释）</li><li>preserveAspectRatio: 保留横纵比</li></ul><p>我们接下来，一个一个的进行讲解吧。</p><h3 id="viewport"><a href="#viewport" class="headerlink" title="viewport"></a>viewport</h3><p>参照上面的 demo，这实际上就是你用 x,y,width,height。这 4 个属性，在页面上固定的矩形区域。</p><h3 id="viewbox"><a href="#viewbox" class="headerlink" title="viewbox"></a>viewbox</h3><p>定义 SVG 元素在 viewport 中的具体尺寸比例。假设有如下内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"500"</span> height=<span class="string">"200"</span> viewBox=<span class="string">"0 0 50 20"</span> &gt;</span><br><span class="line"> &lt;rect x=<span class="string">"20"</span> y=<span class="string">"10"</span> width=<span class="string">"10"</span> height=<span class="string">"5"</span> style=<span class="string">"stroke: #000000; fill:none;"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>viewport 为 [0,0] 到 [500,200]</li><li>viewbox 为 [0,0] 到 [50,20]</li></ul><p>默认情况下 SVG 是自动填充满 viewport 的。注意，在 SVG 中，子标签的所有尺寸都是不能带单位的，因为初始单位就是根据上面两个概念确定。<br>当为以上情况，SVG 中基本的尺寸则不是 1px，而是 500/50 = 10px。所以，如下的图形大小为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;rect x=<span class="string">"20"</span> y=<span class="string">"10"</span> width=<span class="string">"10"</span> height=<span class="string">"5"</span> style=<span class="string">"stroke: #000000; fill:none;"</span>/&gt;</span><br></pre></td></tr></table></figure></p><p>也就是在 SVG 里面定义的 rect 图形，它的实际尺寸为 [200,100] 到 [100,50]。</p><h3 id="preserveAspectRatio"><a href="#preserveAspectRatio" class="headerlink" title="preserveAspectRatio"></a>preserveAspectRatio</h3><p>该属性就是用来定义上面 viewport 和 viewbox 相互对齐的方式。换句话就是说，它的属性可以改变 viewbox 的具体位置。基本格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;align&gt; [&lt;meetOrSlice&gt;]</span><br></pre></td></tr></table></figure></p><ul><li>align: 定义 viewport 和 viewbox 的对齐方式，分为 x,y 轴两个方向。X 轴方向有三种方式：左边重合（xMin），x 轴中点重合（xMid），右边重合（xMax）。同理，Y 轴也有 顶边重合（YMin），y 轴中点重合（YMid），底边边重合（YMax）</li><li>meetOrSlice: 主要就是定义该 SVG 是内嵌，还是裁剪或是 none（听天有命）。</li></ul><p>其中，align 需要着重理解一下。首先，它的默认值为 xMidYMid，即为中点重合。<br><img src="/2019/09/29/SVG入门教程/1.png" alt="img"><br>可以从图中看出，viewbox 是通过中心进行延展的。注意，它的原点坐标还是在 viewbox 的左上角。如果你是动态增加尺寸的话，此时并不是从左到右增加，而是从中心向两端扩张。同理，如果你使用的是 xMinYMin 的话，那么如果存在尺寸变化，那么相对点则是从左上角开始的。简单来说，align 相对点其实一共有 9 个。<br><img src="/2019/09/29/SVG入门教程/2.png" alt="img"><br>然后就是 meet || slice || none 这三个属性具体干的事情。<br>在这之前，我们需要了解一个公式–缩放比计算公式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vb_h * rat_y = vp_h; 或者 vb_w * rat_x = vp_w;</span><br></pre></td></tr></table></figure></p><p>其中，vb_ 为 viewbox 简写，vp_ 为 viewport 的简写。vb_h 代表就是 viewbox height。vb_w 代表就是 viewbox width。rat_x/y 代表的是 x,y 轴的缩放比例。<br>假设有下列情况：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"400"</span> height=<span class="string">"200"</span> viewBox=<span class="string">"0 0 200 200"</span> preserveAspectRatio=<span class="string">"xMinYMin slice"</span> style=<span class="string">"border:1px solid #cd0000;"</span>&gt;</span><br><span class="line">    &lt;rect x=<span class="string">"10"</span> y=<span class="string">"10"</span> width=<span class="string">"150"</span> height=<span class="string">"150"</span> fill=<span class="string">"#cd0000"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p><p>那么，rat_x 和 rat_y 分别为：</p><ul><li>rat_x = 400/200 = 2</li><li>rat_y = 200/200 = 1</li></ul><p>现在，针对上面 meet/slice 不同的取值，实际应用到 svg 里面的缩放比例是不同的。</p><ul><li>meet(默认值): 本意是让 svg 尽可能的显示在 viewport 里，即，会在 rat_x 和 rat_y 中选择最小的值作为缩放标准。</li><li>slice: 本意是让 svg 完全铺满 viewport，即，会在 rat_x 和 rat_y 中选择最大的值作为缩放标准。</li></ul><p>所以针对不同的取值，基准比例也不同。<br>当为 meet 的情况，那么实际缩放比例为 1。则里面实际矩形的大小就为 (10,10) 到 (150,150)。<br><img src="/2019/09/29/SVG入门教程/3.png" alt="img"><br>当为 slice 的情况，那么实际缩放比例为 2。则里面实际矩形的大小就为 (20,20) 到 (300,300)。<br><img src="/2019/09/29/SVG入门教程/4.png" alt="img"><br>如果你的值为 none 的话，他会直接铺满整个 viewport，即，实际矩形大小为：(20,10) 到 (300,150)。<br><img src="/2019/09/29/SVG入门教程/5.png" alt="img"></p><h3 id="响应式-SVG"><a href="#响应式-SVG" class="headerlink" title="响应式 SVG"></a>响应式 SVG</h3><p>虽然讲起响应式，一些童鞋会想这 TM 又是啥奇技淫巧？<br>对不起，并不是。。。就是一个 viewbox 并且不带 width/height 而已。<br>看个实际的例子吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg viewBox=<span class="string">"0 0 218.8 87.1"</span>&gt;</span><br><span class="line">  &lt;g fill=<span class="string">"none"</span> stroke=<span class="string">"#000"</span>&gt;</span><br><span class="line">    &lt;path d=<span class="string">"M7.3 75L25.9 6.8s58.4-6.4 33.5 13-41.1 32.8-11.2 30.8h15.9v5.5s42.6</span></span><br><span class="line"><span class="string">      18.8 0 20.6"</span> /&gt;</span><br><span class="line">    &lt;path d=<span class="string">"M133.1 58.2s12.7-69.2 24.4-47.5c0 0 4.1 8.6 9.5.9 0 0 5-10 10.4.9 0</span></span><br><span class="line"><span class="string">      0 12.2 32.6 13.6 43 0 0 39.8 5.4 15.8 15.4-13.2 5.5-53.8</span></span><br><span class="line"><span class="string">      13.1-77.4 5.9.1 0-51.9-15.4 3.7-18.6z"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/g&gt; </span></span><br><span class="line"><span class="regexp">&lt;/</span>svg&gt;</span><br></pre></td></tr></table></figure></p><p>可以看到，上面的 svg 标签并没有带上啥 width/height 属性，只是简单描述了 viewBox 的范围而已。当然，里面的尺寸标准都是在这 viewBox 的范围内进行设置的。<br>另外，在这里声明一下，本文章并不是新手教程，也就是说，不会教你一步一步的画直线啊，圆啊，矩形啊等等这些基本图形。这些直接 google 一下，一搜一大把。所以，这里假设大家的水平是处于，能对 SVG 基本的图形属性熟悉即可，对一些高级属性还不是很清楚和熟练。OK，继续~<br>在 SVG 中，能够直接使用的图形有:</p><ul><li>rect</li><li>circle</li><li>ellipse</li><li>line</li><li>polyline</li><li>polygon</li></ul><p>上面没有啥说的，后面我详细说一下两个比较重要的概念，分组和 Path。</p><h2 id="分组和-Path"><a href="#分组和-Path" class="headerlink" title="分组和 Path"></a>分组和 Path</h2><p>通常 Path 和 分组通常是一起使用的，如上：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;g fill=<span class="string">"none"</span> stroke=<span class="string">"#000"</span>&gt;</span><br><span class="line">    &lt;path d=<span class="string">"M7.3 75L25.9 6.8s58.4-6.4 33.5 13-41.1 32.8-11.2 30.8h15.9v5.5s42.6</span></span><br><span class="line"><span class="string">      18.8 0 20.6"</span> /&gt;</span><br><span class="line">    &lt;path d=<span class="string">"M133.1 58.2s12.7-69.2 24.4-47.5c0 0 4.1 8.6 9.5.9 0 0 5-10 10.4.9 0</span></span><br><span class="line"><span class="string">      0 12.2 32.6 13.6 43 0 0 39.8 5.4 15.8 15.4-13.2 5.5-53.8</span></span><br><span class="line"><span class="string">      13.1-77.4 5.9.1 0-51.9-15.4 3.7-18.6z"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><p>分组我们放到后面进行讲解，这里先看一下 Path。</p><h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p>Path 在 SVG 中的地位应该是比较高的，实际上，利用 Path 这个一个标签可以画出任意的图形。path 中 d(data) 属性是用来定义相关线条数据，通常是以 M/m 为起始，代表的就是 move to 的意思。在 path 中，一共可以定义 10 种不同的图形。例如 M/m，L/l。 大家可以注意，每种标识符有两种书写方式，即，大小写。</p><ul><li>大写: 参照的是绝对坐标，即，SVG 的右上角</li><li>小写: 参照的相对坐标，即，前一个点的坐标。</li></ul><p>而在 10 中不同表示符中，又可以分为直线和曲线两种不同的标识符。这里，我们分类来讲解一下。</p><h3 id="线型"><a href="#线型" class="headerlink" title="线型"></a>线型</h3><h4 id="M-m"><a href="#M-m" class="headerlink" title="M/m"></a>M/m</h4><p>该使用定义起始点的，没啥特殊的作用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=<span class="string">"M10 10"</span>/&gt;</span><br></pre></td></tr></table></figure></p><p>表示，以 (10,10) 为起始点。</p><h4 id="L-l"><a href="#L-l" class="headerlink" title="L/l"></a>L/l</h4><p>原意是 Line to，用来画线段的。格式和 M/m 差不多：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L x y (or l dx dy)</span><br></pre></td></tr></table></figure></p><h4 id="H-h"><a href="#H-h" class="headerlink" title="H/h"></a>H/h</h4><p>用来画水平线，即，Horizontal。既然方向已经定了，剩下的就是距离，格式很简单：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H x (or h dx)</span><br></pre></td></tr></table></figure></p><h4 id="V-v"><a href="#V-v" class="headerlink" title="V/v"></a>V/v</h4><p>用来画竖直线，即，vertical。同上，方向也定了，格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">V y (or v dy)</span><br></pre></td></tr></table></figure></p><p>看个例子吧：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=&quot;M10 10 H 90 V 90 H 10 L 10 10&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>该 path 实际上就是画了一个正方形，宽 = 高 = 90。<br><img src="/2019/09/29/SVG入门教程/6.png" alt="img"></p><h4 id="Z-z"><a href="#Z-z" class="headerlink" title="Z/z"></a>Z/z</h4><p>该标识符用来表示 path 的结束，并且将最后一点和 M/m 标识开头的一点连接起来。所以，它不存在什么表示点之类的，格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Z (or z)</span><br></pre></td></tr></table></figure></p><p>而上面也可以进行相关的优化，最终的结果为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=<span class="string">"M10 10 H 90 V 90 H 10 L 10 10"</span>/&gt;</span><br><span class="line"><span class="comment">// 使用 Z</span></span><br><span class="line">&lt;path d=<span class="string">"M10 10 H 90 V 90 H 10 Z"</span> fill=<span class="string">"transparent"</span> stroke=<span class="string">"black"</span>/&gt;</span><br></pre></td></tr></table></figure></p><h3 id="曲线"><a href="#曲线" class="headerlink" title="曲线"></a>曲线</h3><p>曲线就是 Web 画图中常见的 Bezier Curves（贝塞尔），Arcs，several Bezier curves（很多贝塞尔 - .-）等。<br>我们简单看一下：</p><h4 id="C-c"><a href="#C-c" class="headerlink" title="C/c"></a>C/c</h4><p>这是正统的贝塞尔曲线，需要 4 个参考点，下图应该说比较确切表示了二次贝塞尔所需要的点。所以，C/c 需要定义三个点。<br><img src="/2019/09/29/SVG入门教程/7.png" alt="img"><br>基本格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C x1 y1, x2 y2, x y (or c dx1 dy1, dx2 dy2, dx dy)</span><br></pre></td></tr></table></figure></p><p>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=<span class="string">"M10 10 C 20 20, 40 20, 50 10"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br></pre></td></tr></table></figure></p><h4 id="S-s"><a href="#S-s" class="headerlink" title="S/s"></a>S/s</h4><p>该标识符实际上使用来表示一个反射贝塞尔，即，在原有贝塞尔上再加一段贝塞尔曲线，所以，S/s 一般和 C/c 一起使用。<br>基本格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S x2 y2, x y (or s dx2 dy2, dx dy)</span><br></pre></td></tr></table></figure></p><p>实际样式图为：<br><img src="/2019/09/29/SVG入门教程/8.png" alt="img"><br>相当于原有的贝塞尔曲线的最后一段进行反向延长并对称。然后加上新定义的一段限制曲线。<br>具体实例为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=<span class="string">"M10 80 C 40 10, 65 10, 95 80 S 150 150, 180 80"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br></pre></td></tr></table></figure></p><h4 id="Q-q"><a href="#Q-q" class="headerlink" title="Q/q"></a>Q/q</h4><p>该标识符是用来定义二次(quadratic)贝塞尔曲线，该曲线相当于上面传统的贝塞尔来说，更加简单，它只需要定义三个点，即可完整一个贝塞尔曲线，具体作图过程如下：<br><img src="/2019/09/29/SVG入门教程/9.gif" alt="img"><br>基本格式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q x1 y1, x y (or q dx1 dy1, dx dy)</span><br></pre></td></tr></table></figure></p><p>即为图上点， P1(x1,y1)，P2(x,y)<br>起始点为 M 定义的点，例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;path d=<span class="string">"M10 80 Q 95 10 180 80"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br></pre></td></tr></table></figure></p><h4 id="T-t"><a href="#T-t" class="headerlink" title="T/t"></a>T/t</h4><p>该标识符和 S 差不多，也是一个贝塞尔曲线的延长。相当于原曲线的控制点 P1 相当于 end point P2 做对称，然后，只需要定义一个终点即可，即，T/t 只需要定义贝塞尔曲线里面的终点即可：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T x y (or t dx dy)</span><br></pre></td></tr></table></figure></p><p>如图：<br><img src="/2019/09/29/SVG入门教程/10.png" alt="img"><br>所以，简单来说，C/S，Q/T 是两两搭配一起使用的。在使用的时候，千万不要搞混即可。</p><h3 id="弧线"><a href="#弧线" class="headerlink" title="弧线"></a>弧线</h3><h4 id="A-a"><a href="#A-a" class="headerlink" title="A/a"></a>A/a</h4><p>该曲线是用来画弧线(Arcs)，而，弧线通常是圆/椭圆的一部分。当，椭圆的两个轴径长相等则为圆，所以，A/a 是按照椭圆作为基准格式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A rx ry x-axis-rotation large-arc-flag sweep-flag x y</span><br><span class="line">a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy</span><br></pre></td></tr></table></figure></p><p>说实在的，这个比较复杂。因为，他画椭圆的方式和我们平常不一样，一般情况下，椭圆只要确定一个中心，然后是长短轴，然后是弧度范围即可。<br>但是，它这里是通过椭圆上的两点来确定的，在加上旋转角度，俩轴径等因素来确定的。另外，需要注意，它的起始点是从上一个命令的结束点位置开始计算的。OK，我们首先简单了解一下格式里面的参数：</p><ul><li>rx,ry: 代表的就是长轴短轴，没得说。</li><li>x,y: 代表的是弧长的结束点。开始点就是上一个命令的终点。</li><li>x-axis-rotation: x 轴的旋转角度。顺时针为正</li><li>large-arc-flag[0,1]: 表示取大弧还是小弧。因为两点之间的弧长有两部分。</li><li>sweep-flag[0,1]: 取顺时针的弧，还是逆时针的弧长。参考点是以起始点开始的。</li></ul><p>上面几个属性中，比较难理解的就是 large-arc-flag 和 sweep-flag。这么说吧，前面几个属性充其量只能确定椭圆的位置，和经过椭圆的两个点，不过，一般能通过指定两点的椭圆有两个，而通过这两点划分又会出现 4 段弧长。为了确定 4 个弧长中，是哪一个，需要两个值来确定。即，4 抽 2，2 抽 1。<br><img src="/2019/09/29/SVG入门教程/11.png" alt="img"><br>简单说一种，例如当，laf 和 sf 都为 0的情况。首先，laf 为 0 选择的是小弧长。所以，里面两段比较小的弧长被抽出来。然后，sf 为 0 选择的是逆时针。即，以起始点为参考，选择通过逆时针方向到达终点的那段弧。即，2 抽 1。最终得出我们需要的弧。<br>说实在的，这个是真 TM 复杂。。。<br>给一个参考<a href="https://codepen.io/netsi1964/pen/pJzWoz" target="_blank" rel="noopener">codepen</a>。<br>一般情况下，我们并不需要手动来确定 path，有工具为啥不用工具呢！<br>比如，Illustrator, Sketch 等，都可以自动生成 SVG。不过，生成之后，需要对代码做相关的压缩优化，这些都可以直接在编译器里面找到。<br>你也可以用一下可视化工具<a href="https://jakearchibald.github.io/svgomg/" target="_blank" rel="noopener">SVGOMG</a>来简单看一下。</p><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><p>SVG 中的分组你可以理解为 PS 中的图层，一块图层里面通常只会放一下高内聚的图形，这样既方便移动又方便做动画。SVG 中的分组标签就是 g，使用 g 标签包裹的所有子元素都认同为一组。<br>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;g&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"20"</span> cy=<span class="string">"20"</span> r=<span class="string">"20"</span> fill=<span class="string">"green"</span> /&gt;</span><br><span class="line">  &lt;circle cx=<span class="string">"70"</span> cy=<span class="string">"70"</span> r=<span class="string">"20"</span> fill=<span class="string">"purple"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp">&lt;g&gt;</span></span><br><span class="line"><span class="regexp">  &lt;rect x="110" y="110" height="30" width="30" fill="blue" /</span>&gt;</span><br><span class="line">  &lt;rect x=<span class="string">"160"</span> y=<span class="string">"160"</span> height=<span class="string">"30"</span> width=<span class="string">"30"</span> fill=<span class="string">"red"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><p>需要注意的是，使用 g 进行分组，并不会改变原有元素的在屏幕上展示的效果。<br>不过，g 标签除了分组，还有另外一个很重要的功能–动画</p><h4 id="分组动画"><a href="#分组动画" class="headerlink" title="分组动画"></a>分组动画</h4><p>在分组重定义动画是直接写在 transform 属性当中的。实际上，每个子标签都可以使用 transform 的相关属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;g transform=<span class="string">"translate(...) scale(...) rotate(...) translate(...) rotate(...)"</span>&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;<span class="regexp">/g&gt;</span></span><br></pre></td></tr></table></figure></p><p>每种变换动画之间是通过 空格或逗号 连接的。它的执行顺序是从右到左。为啥呢？实际上可以理解为，这就是几个嵌套的 g 叠在一起。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> &lt;g transform=<span class="string">"translate(...) scale(...) rotate(...) translate(...) rotate(...)"</span>&gt;</span><br><span class="line">   ...</span><br><span class="line"> &lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"> /</span><span class="regexp">/ Being Equivalent to this:</span></span><br><span class="line"><span class="regexp"> &lt;g transform="translate(...)"&gt;</span></span><br><span class="line"><span class="regexp">  &lt;g transform="scale(...)"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;g transform="rotate(...)"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;g transform="translate(...)"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;g transform="rotate(...)"&gt;</span></span><br><span class="line"><span class="regexp">          ...</span></span><br><span class="line"><span class="regexp">        &lt;/g</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/g</span>&gt;</span><br><span class="line">  &lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp">&lt;/g</span>&gt;</span><br></pre></td></tr></table></figure></p><p>具体可以使用的动画形式和 CSS 动画一模一样，详情可以参考: <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/transform" target="_blank" rel="noopener">SVG动画</a></p><p>以上就是SVG的简单入门介绍，<a href="https://www.villainhr.com/page/2017/04/17/SVG%20快速入门" target="_blank" rel="noopener">原文请点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web图形 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>puppeteer爬取简书文章</title>
      <link href="/2019/09/26/puppeteer%E7%88%AC%E5%8F%96%E7%AE%80%E4%B9%A6%E6%96%87%E7%AB%A0/"/>
      <url>/2019/09/26/puppeteer%E7%88%AC%E5%8F%96%E7%AE%80%E4%B9%A6%E6%96%87%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<p>puppeteer爬取简书文章的小例子<br><a id="more"></a></p><h1 id="puppeteer爬取简书文章"><a href="#puppeteer爬取简书文章" class="headerlink" title="puppeteer爬取简书文章"></a>puppeteer爬取简书文章</h1><p>puppeteer这个工具库我已经了解有些时候了，自己在之前的文章中也有简单的介绍，也列出了几个学习站点，不过，第一个爬虫的例子，还是缓缓的到来了。<br>这个小例子很简单，只有几十行代码，大概的流程是，首先打开简书的首页，之后下拉到底部，加载数据，下拉几次之后就没有了下拉加载的功能，取而代之的是“阅读更多”按钮，点击后会加载新内容。就这样往复的加载文章的列表，当符合自己设定的上限值后，停止加载，拿到了文章列表后循环的打开相对应的页面，读取文章详细内容，并写到本地磁盘里。<br>代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="comment">// 简书网址</span></span><br><span class="line"><span class="keyword">const</span> baseUrl = <span class="string">'https://www.jianshu.com'</span>;  </span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123;</span><br><span class="line">    headless:<span class="literal">false</span>,</span><br><span class="line">    slowMo:<span class="number">250</span>,</span><br><span class="line">    defaultViewport: &#123;</span><br><span class="line">      width: <span class="number">1200</span>,</span><br><span class="line">      height: <span class="number">600</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="comment">// page.setDefaultNavigationTimeout(timeout);</span></span><br><span class="line">  <span class="keyword">await</span> page.goto(baseUrl);</span><br><span class="line">  <span class="comment">// await page.waitFor(1000);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取简书首页中的列表数据</span></span><br><span class="line">  <span class="keyword">const</span> hrefList = <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">baseUrl</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [], list;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span> &#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">loadPage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'.load-more'</span>); </span><br><span class="line">        <span class="keyword">if</span>(btn) &#123;</span><br><span class="line">          btn.click();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> pageHeight = <span class="built_in">document</span>.querySelector(<span class="string">'#list-container'</span>).offsetHeight;</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;pageHeight; i++) &#123;</span><br><span class="line">            <span class="built_in">document</span>.documentElement.scrollTo(<span class="number">0</span>, i);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          list = <span class="built_in">document</span>.querySelectorAll(<span class="string">'#list-container .note-list li'</span>);</span><br><span class="line">          <span class="keyword">if</span>(list.length &lt; <span class="number">50</span>) &#123;</span><br><span class="line">            loadPage();</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> list) &#123;</span><br><span class="line">              <span class="keyword">let</span> href = item.querySelector(<span class="string">'a'</span>).getAttribute(<span class="string">'href'</span>);</span><br><span class="line">              arr.push(baseUrl + href);</span><br><span class="line">            &#125;</span><br><span class="line">            resolve(arr);</span><br><span class="line">          &#125;    </span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      loadPage();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, baseUrl);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过hrefList来获取单个的文章内容，并写入文章文件</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> hrefList) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> page.goto(item);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.waitFor(<span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">var</span> article = <span class="keyword">await</span> page.evaluate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> mainText;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        mainText = <span class="built_in">document</span>.querySelector(<span class="string">'._gp-ck'</span>).innerHTML;</span><br><span class="line">      &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">        mainText = <span class="string">'此页面有问题。'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> mainText;</span><br><span class="line">    &#125;);</span><br><span class="line">    fs.writeFileSync(<span class="string">'./download-articles/'</span>+item.replace(<span class="regexp">/\/|\:|\./g</span>, <span class="string">''</span>)+<span class="string">'.txt'</span>, article, &#123;</span><br><span class="line">      flag: <span class="string">'a'</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 关闭浏览器</span></span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><p>以后还会更新些更复杂的爬虫案例哦。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文本文件和二进制文件的差异和区别</title>
      <link href="/2019/09/24/%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E5%92%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E5%B7%AE%E5%BC%82%E5%92%8C%E5%8C%BA%E5%88%AB/"/>
      <url>/2019/09/24/%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E5%92%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E5%B7%AE%E5%BC%82%E5%92%8C%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>文本文件和二进制文件的差异和区别<br><a id="more"></a></p><h1 id="文本文件和二进制文件的差异和区别"><a href="#文本文件和二进制文件的差异和区别" class="headerlink" title="文本文件和二进制文件的差异和区别"></a>文本文件和二进制文件的差异和区别</h1><h2 id="一："><a href="#一：" class="headerlink" title="一："></a>一：</h2><p>广义上的二进制文件包括文本文件，这里讨论的是狭义上的二进制文件与文本文件的比较：</p><ul><li>1.能存储的数据类型不同<br>文本文件只能存储char型字符变量。二进制文件可以存储char/int/short/long/float/……各种变量值。</li><li>2.每条数据的长度<br>文本文件每条数据通常是固定长度的。以ASCII为例，每条数据(每个字符)都是1个字节。进制文件每条数据不固定。如short占两个字节，int占四个字节，float占8个字节……</li><li>3.读取的软件不同<br>文本文件编辑器就可以读写。比如记事本、NotePad++、Vim等。二进制文件需要特别的解码器。比如bmp文件需要图像查看器，rmvb需要播放器……</li><li>4.操作系统对换行符(‘\n’)的处理不同（不重要）<br>文本文件，操作系统会对’\n’进行一些隐式变换，因此文本文件直接跨平台使用会出问题。<br>在Windows下，写入’\n’时，操作系统会隐式的将’\n’转换为”\r\n”，再写入到文件中；读的时候，会把“\r\n”隐式转化为’\n’，再读到变量中。<br>在Linux下，写入’\n’时，操作系统不做隐式变换。<br>二进制文件，操作系统不会对’\n’进行隐式变换，很多二进制文件（如电影、图片等）可以跨平台使用。</li></ul><p>从存储方式来说，文件在磁盘上的存储方式都是二进制形式，所以，文本文件其实也应该算二进制文件。先从他们的区别来说，虽然都是二进制文件，但是二进制代表的意思不一样。打个比方，一个人，我们可以叫他的大名，可以叫他的小名，但其实都是代表这个人。二进制读写是将内存里面的数据直接读写入文本中，而文本呢，则是将数据先转换成了字符串，再写入到文本中。<br>要弄明白二者的区别，需要知道文件的读写过程。以读文件为例，</p><p>实际上是磁盘 》》 文件缓冲区》》应用程序内存空间这两个转化过程。我们说“文本文件和二进制文件没有区别”，实际上针对的是第一个过程；既然没有区别，那么打开方式不同，为何显示内容就不同呢？这个区别实际上是第二个过程造成的。</p><p>文件实际上包括两部分，控制信息和内容信息。纯文本文件仅仅是没有控制格式信息罢了；</p><p>实际上也是一种特殊的二进制文件。所以，我们很难区分二者的不同，因为他们的概念上不是完全互斥的。我们说文本文件是特殊的二进制文件，是因为文本文件实际上的解释格式已经确定了：ASCII或者unicode编码。文本文件的一个缺点是，它的熵往往较低，也就是说，其实本可以用更小的存储空间记录这些信息。比如，文本文件中的一个数字65536，需要用5个字节来存储；但是用二进制格式，采用int存储，仅仅需要2个字节。而二进制文件elf和bmp等，都往往有一个head，告诉你文件信息和解释方式。</p><p>记事本支持文本文件而不支持二进制文件，所以如果你用记事本打开文本文件那么一切正常，如果打开的是二进制文件就会出现乱码。但也有不乱码的地方，你会注意到那些地方都是字符编码的，而对于int、double等类型所对应的值都是乱码的，这是由于记事本只能够识别字符类型，而无法识别其他类型。</p><ul><li>1.二进制文件是把内存中的数据按其在内存中的存储形式原样输出到磁盘上存放，也就是说存放的是数据的原形式。</li><li>2.文本文件是把数据的终端形式的二进制数据输出到磁盘上存放，也就是说存放的是数据的终端形式。</li></ul><p>字符数据本身在内存中就经过了编码，所以无论是二进制还是文本形式都是一样的，而对于非字符数据来说，例如inti=10；如果用二进制来进行存储的话为1010，但是如果需要用文本形式来进行存储的话就必须进行格式化编码（对1和0分别编码，即形式为‘1’和‘0’分别对应的码值）。</p><h2 id="二："><a href="#二：" class="headerlink" title="二："></a>二：</h2><p>1.文本文件与二进制文件的定义<br>大家都知道计算机的存储在物理上是二进制的，所以文本文件与二进制文件的区别并不是物理上的，而是逻辑上的。这两者只是在编码层次上有差异。简单来说，文本文件是基于字符编码的文件，常见的编码有ASCII编码，UNICODE编码等等。二进制文件是基于值编码的文件，你可以根据具体应用，指定某个值是什么意思（这样一个过程，可以看作是自定义编码。</p><p>从上面可以看出文本文件基本上是定长编码的(也有非定长的编码如UTF-8)。而二进制文件可看成是变长编码的，因为是值编码嘛，多少个比特代表一个值，完全由你决定。大家可能对BMP文件比较熟悉，就拿它举例子吧，其头部是较为固定长度的文件头信息，前2字节用来记录文件为BMP格式，接下来的8个字节用来记录文件长度，再接下来的4字节用来记录bmp文件头的长度。</p><p>2.文本文件与二进制文件的存取<br>文本工具打开一个文件的过程是怎样的呢？拿记事本来说，它首先读取文件物理上所对应的二进制比特流，然后按照你所选择的解码方式来解释这个流，然后将解释结果显示出来。一般来说，你选取的解码方式会是ASCII码形式（ASCII码的一个字符是8个比特），接下来，它8个比特8个比特地来解释这个文件流。例如对于这么一个文件流”01000000_01000001_01000010_01000011”(下划线”_”，为了增强可读性手动添加的)，第一个8比特”01000000”按ASCII码来解码的话，所对应的字符是字符”A”，同理其它3个8比特可分别解码为”BCD”，即这个文件流可解释成“ABCD”，然后记事本就将这个“ABCD”显示在屏幕上。</p><p>事实上，世界上任何东西要与其他东西通信会话，都存在一个既定的协议，既定的编码。人与人之间通过文字联络，汉字“妈”代表生你的那个人，这就是一种既定的编码。但注意到这样一种情况，汉字“妈”在日本文字里有可能是你生下的那个人，所以当一个中国人A与日本B之间用“妈”这个字进行交流，出现误解就很正常的。用记事本打开二进制文件与上面的情况类似。记事本无论打开什么文件都按既定的字符编码工作（如ASCII码），所以当他打开二进制文件时，出现乱码也是很必然的一件事情了，解码和译码不对应嘛。例如文件流”00000000_00000000_00000000_00000001”可能在二进制文件中对应的是一个四字节的整数int 1，在记事本里解释就变成了”NULL_NULL_NULL_SOH”这四个控制符。</p><p>文本文件的存储与其读取基本上是个逆过程。而二进制文件的存取显然与文本文件的存取差不多，只是编／解码方式不同而已。</p><p>3.文本文件与二进制文件的优缺点<br>因为文本文件与二进制文件的区别仅仅是编码上不同，所以他们的优缺点就是编码的优缺点，这个找本编码的书来看看就比较清楚了。一般认为，文本文件编码基于字符定长，译码容易些；二进制文件编码是变长的，所以它灵活，存储利用率要高些，译码难一些（不同的二进制文件格式，有不同的译码方式）。关于空间利用率，想想看，二进制文件甚至可以用一个比特来代表一个意思(位操作)，而文本文件任何一个意思至少是一个字符。</p><p>在windows下,文本文件不一定是一ASCII来存贮的,因为ASCII码只能表示128的标识,你打开一个txt文档,然后另存为,有个选项是编码,可以选择存贮格式,一般来说UTF-8编码格式兼容性要好一些.而二进制用的计算机原始语言,不存贮兼容性. 很多书上还认为，文本文件的可读性要好些，存储要花费转换时间(读写要编译码)，而二进制文件可读性差，存储不存在转换时间（读写不要编解码，直接写值）．这里的可读性是从软件使用者角度来说的，因为我们用通用的记事本工具就几乎可以浏览所有文本文件，所以说文本文件可读性好；而读写一个具体的二进制文件需要一个具体的文件解码器，所以说二进制文件可读性差，比如读BMP文件，必须用读图软件。</p><p>而这里的存储转换时间应该是从编程的角度来说的，因为有些操作系统如windows需要对回车换行符进行转换(将”\n”，换成”\r\n”，所以文件读写时，操作系统需要一个一个字符的检查当前字符是不是”\n”或”\r\n”).这个在存储转换在Linux操作系统中并不需要，当然，当在两个不同的操作系统上共享文件时，这种存储转换又可能出来。</p><h2 id="三："><a href="#三：" class="headerlink" title="三："></a>三：</h2><p>文本文件是一种计算机文件，它是一种典型的顺序文件，其文件的逻辑结构又属于流式文件。</p><p>特别的是，文本文件是指以ASCII码方式(也称文本方式)存储的文件，更确切地说，英文、数字等字符存储的是ASCII码，而汉字存储的是机内码。文本文件中除了存储文件有效字符信息（包括能用ASCII码字符表示的回车、换行等信息）外，不能存储其他任何信息。</p><p>文本文件是一种由若干行字符构成的计算机文件。文本文件存在于计算机文件系统中。通常，通过在文本文件最后一行后放置文件结束标志来指明文件的结束。文本文件是指一种容器，而纯文本是指一种内容。文本文件可以包含纯文本。一般来说，计算机文件可以分为两类：文本文件和二进制文件。</p><p>只含有ASCII字符的文本文件可以在Unix、Macintosh、Microsoft Windows、DOS和其它操作系统之间自由交互，而其它格式的文件是很难做到这一点的。但是，在这些操作系统中，换行符并不相同，处理非ASCII字符的方式也不一致。</p><p>.txt是包含极少格式信息的文字文件的扩展名。.txt格式并没有明确的定义，它通常是指那些能够被系统终端或者简单的文本编辑器接受的格式。任何能读取文字的程序都能读取带有.txt扩展名的文件，因此，通常认为这种文件是通用的、跨平台的。</p><p>在英文文本文件中，ASCII字符集是最为常见的格式，而且在许多场合，它也是默认的格式。对于带重音符号的和其它的非ASCII字符，必须选择一种字符编码。在很多系统中，字符编码是由计算机的区域设置决定的。常见的字符编码包括支持许多欧洲语言的ISO 8859-1。</p><p>由于许多编码只能表达有限的字符，通常它们只能用于表达几种语言。Unicode制定了一种试图能够表达所有已知语言的标准，Unicode字符集非常大，它囊括了大多数已知的字符集。Unicode有多种字符编码，其中最常见的是UTF-8，这种编码能够向后兼容ASCII，相同内容的的ASCII文本文件和UTF-8文本文件完全一致。</p><p>微软的MS-DOS和Windows采用了相同的文本文件格式，它们都使用CR和LF两个字符作为换行符，这两个字符对应的ASCII码分别为13和10。通常，最后一行文本并不以换行符(CR-LF标志)结尾，包括记事本在内的很多文本编辑器也不在文件的最后添加换行符。</p><p>大多数Windows文本文件使用ANSI、OEM或者Unicode编码。Windows所指的ANSI编码通常是1字节的ISO-8859编码，不过对于像中文、日文、朝鲜文这样的环境，需要使用2字节字符集。在过渡至Unicode前，Windows一直用ANSI作为系统默认的编码。而OEM编码，也是通常所说的MS-DOS代码页，是IBM为早期IBM个人电脑的文本模式显示系统定义的。在全屏的MS-DOS程序中同时使用了图形的和按行绘制的字符。新版本的Windows可以使用UTF-16LE和UTF-8之类的Unicode编码。</p><p>由于结构简单，文本文件被广泛用于记录信息。它能够避免其它文件格式遇到的一些问题。此外，当文本文件中的部分信息出现错误时，往往能够比较容易的从错误中恢复出来，并继续处理其余的内容。文本文件的一个缺点是，它的熵往往较低，也就是说，可以用较小的存储空间记录这些信息。</p><p>文本文件基本上是定长编码的(也有非定长的编码如UTF-8)，基于字符，每个字符在具体编码中是固定的，ASCII码是8个比特的编码，UNICODE一般占16个比特。而二进制文件可看成是变长编码的，因为是值编码，多少个比特代表一个值，完全由自己决定。</p><p>广义的二进制文件即指文件，由文件在外部设备的存放形式为二进制而得名。狭义的二进制文件即除文本文件以外的文件。</p><p>每个字符由一个或多个字节组成，每个字节都是用的-128—127之间的部分数值来表示的，也就是说，-128——127之间还有一些数据没有对应任何字符的任何字节。如果一个文件中的每个字节的内容都是可以表示成字符的数据，我们就可以称这个文件为文本文件。文本文件只是二进制文件中的一种特例，为了与文本文件相区别，人们又把除了文本文件以外的文件称为二进制文件，由于很难严格区分文本文件和二进制文件的概念，所以我们可以简单地认为，如果一个文件专门用于存储文本字符的数据，没有包含字符以外的其他数据，我们就称之为文本文件，除此之外的文件就是二进制文件。</p><p>为什么要使用二进制文件。原因大概有三个：</p><p>第一是二进制文件比较节约空间，这两者储存字符型数据时并没有差别。但是在储存数字，特别是实型数字时，二进制更节省空间；第二个原因是，内存中参加计算的数据都是用二进制无格式储存起来的，因此，使用二进制储存到文件就更快捷。如果储存为文本文件，则需要一个转换的过程。在数据量很大的时候，两者就会有明显的速度差别了。第三，就是一些比较精确的数据，使用二进制储存不会造成有效位的丢失。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebGL是啥？</title>
      <link href="/2019/09/23/WebGL%E6%98%AF%E5%95%A5%EF%BC%9F/"/>
      <url>/2019/09/23/WebGL%E6%98%AF%E5%95%A5%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<p>简单的介绍一下WebGL是什么<br><a id="more"></a></p><h1 id="WebGL是啥？"><a href="#WebGL是啥？" class="headerlink" title="WebGL是啥？"></a>WebGL是啥？</h1><p>为了让大家快速认识WebGL，先不讲解具体的知识点，我相信很多程序员希望通过一个麻雀虽小，但是五脏俱全的demo来认识一个新的技术领域。所以这里通过一个简单的案例来给大家展示WebGL技术，下面的代码完成的效果就是在canvas画布上绘制一个点。</p><h2 id="使用WebGL绘制一个点"><a href="#使用WebGL绘制一个点" class="headerlink" title="使用WebGL绘制一个点"></a>使用WebGL绘制一个点</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;使用WebGL绘制一个点&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--canvas标签创建一个宽高均为<span class="number">500</span>像素，背景为蓝色的矩形画布--&gt;</span><br><span class="line">&lt;canvas id=<span class="string">"webgl"</span> width=<span class="string">"500"</span> height=<span class="string">"500"</span> style=<span class="string">"background-color: blue"</span>&gt;&lt;<span class="regexp">/canvas&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;!-- 顶点着色器源码 --&gt;</span><br><span class="line">&lt;script id=<span class="string">"vertexShader"</span> type=<span class="string">"x-shader/x-vertex"</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> main() &#123;</span><br><span class="line">    <span class="comment">//给内置变量gl_PointSize赋值像素大小</span></span><br><span class="line">    gl_PointSize=<span class="number">20.0</span>;</span><br><span class="line">    <span class="comment">//顶点位置，位于坐标原点</span></span><br><span class="line">    gl_Position =vec4(<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;!-- 片元着色器源码 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;script id="fragmentShader" type="x-shader/</span>x-fragment<span class="string">"&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_FragColor = vec4(1.0,0.0,0.0,1.0);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">    //通过getElementById()方法获取canvas画布</span></span><br><span class="line"><span class="string">    var canvas=document.getElementById('webgl');</span></span><br><span class="line"><span class="string">    //通过方法getContext()获取WebGL上下文</span></span><br><span class="line"><span class="string">    var gl=canvas.getContext('webgl');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //顶点着色器源码</span></span><br><span class="line"><span class="string">    var vertexShaderSource = document.getElementById( 'vertexShader' ).innerText;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //片元着色器源码</span></span><br><span class="line"><span class="string">    var fragShaderSource = document.getElementById( 'fragmentShader' ).innerText;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //初始化着色器</span></span><br><span class="line"><span class="string">    var program = initShader(gl,vertexShaderSource,fragShaderSource);</span></span><br><span class="line"><span class="string">    //开始绘制，显示器显示结果</span></span><br><span class="line"><span class="string">    gl.drawArrays(gl.POINTS,0,1);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //声明初始化着色器函数</span></span><br><span class="line"><span class="string">    function initShader(gl,vertexShaderSource,fragmentShaderSource)&#123;</span></span><br><span class="line"><span class="string">        //创建顶点着色器对象</span></span><br><span class="line"><span class="string">        var vertexShader = gl.createShader(gl.VERTEX_SHADER);</span></span><br><span class="line"><span class="string">        //创建片元着色器对象</span></span><br><span class="line"><span class="string">        var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);</span></span><br><span class="line"><span class="string">        //引入顶点、片元着色器源代码</span></span><br><span class="line"><span class="string">        gl.shaderSource(vertexShader,vertexShaderSource);</span></span><br><span class="line"><span class="string">        gl.shaderSource(fragmentShader,fragmentShaderSource);</span></span><br><span class="line"><span class="string">        //编译顶点、片元着色器</span></span><br><span class="line"><span class="string">        gl.compileShader(vertexShader);</span></span><br><span class="line"><span class="string">        gl.compileShader(fragmentShader);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        //创建程序对象program</span></span><br><span class="line"><span class="string">        var program = gl.createProgram();</span></span><br><span class="line"><span class="string">        //附着顶点着色器和片元着色器到program</span></span><br><span class="line"><span class="string">        gl.attachShader(program,vertexShader);</span></span><br><span class="line"><span class="string">        gl.attachShader(program,fragmentShader);</span></span><br><span class="line"><span class="string">        //链接program</span></span><br><span class="line"><span class="string">        gl.linkProgram(program);</span></span><br><span class="line"><span class="string">        //使用program</span></span><br><span class="line"><span class="string">        gl.useProgram(program);</span></span><br><span class="line"><span class="string">        //返回程序program对象</span></span><br><span class="line"><span class="string">        return program;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><p>整个代码是一个.html文件，里面包含JavaScript代码和着色器语言代码，通过JavaScript调用WebGL API来完成绘制操作。</p><h2 id="HMTL和JavaScript"><a href="#HMTL和JavaScript" class="headerlink" title="HMTL和JavaScript"></a>HMTL和JavaScript</h2><p>如果原来接触的是OpenGL，不了解WebGL，对浏览器的生态环境不了解，不了解前端知识，那么在学习WebGL之前，你应该先了解一下什么是HTML，什么是JavaScript语言。</p><h2 id="canvas"><a href="#canvas" class="headerlink" title="canvas"></a>canvas</h2><p>canvas和div一样也是HTML的一个元素，只不过通过这个元素可实现三维场景的回执和渲染。通过canvas对象的getContext方法可以返回一个2D或3D环境</p><h2 id="canvas元素"><a href="#canvas元素" class="headerlink" title="canvas元素"></a>canvas元素</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--canvas标签创建一个宽高均为<span class="number">500</span>像素，背景为蓝色的矩形画布--&gt;</span><br><span class="line">&lt;canvas id=<span class="string">"webgl"</span> width=<span class="string">"500"</span> height=<span class="string">"500"</span> style=<span class="string">"background-color: blue"</span>&gt;&lt;<span class="regexp">/canvas&gt;</span></span><br></pre></td></tr></table></figure><h2 id="返回3D绘图环境"><a href="#返回3D绘图环境" class="headerlink" title="返回3D绘图环境"></a>返回3D绘图环境</h2><p>通过返回的gl对象可以调用WebGL API，所有的WebGL API就是gl对象的方法。比如gl.linkProgram()<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过getElementById()方法获取canvas画布</span></span><br><span class="line"><span class="keyword">var</span> canvas=<span class="built_in">document</span>.getElementById(<span class="string">'webgl'</span>);</span><br><span class="line"><span class="comment">//通过方法getContext()获取WebGL上下文</span></span><br><span class="line"><span class="keyword">var</span> gl=canvas.getContext(<span class="string">'webgl'</span>);</span><br></pre></td></tr></table></figure></p><h2 id="返回2D环境"><a href="#返回2D环境" class="headerlink" title="返回2D环境"></a>返回2D环境</h2><p>返回2D环境，就是大家平常说的canvas，通过canvas对象可以返回webgl绘图环境，也可以返回2D绘环境，不过大家在表达的时候，2D绘图环境通常表达为canvas，而canvas返回的3D环境，使用WebGL去表述。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c=canvas.getContext(<span class="string">'2d'</span>);</span><br></pre></td></tr></table></figure></p><h2 id="着色器语言-GLSL"><a href="#着色器语言-GLSL" class="headerlink" title="着色器语言 GLSL"></a>着色器语言 GLSL</h2><p>顶点、片元着色器代码要通过着色器语言来编写，着色器语言在GPU中执行，而平时大家说的JavaScript、Python等语言都是在CPU中执行。在GPU中执行的着色器代码，需要先通过WebGL进行一定的处理然后传递到GPU才能执行，所以编写的着色器语言就是一段符合一定的规则的字符串。<br>如果你现在还不能理解着色器语言的语法规则，也没有关系，作为初学者你现在只需要有一个印象，然后慢慢去学习。</p><h2 id="顶点着色器"><a href="#顶点着色器" class="headerlink" title="顶点着色器"></a>顶点着色器</h2><p>内置变量gl_PointSize设置了顶点渲染后的显示大小，内置变量gl_Position决定了渲染的位置，你可以去修改位置变量的值，比如vec4(0.0,0.0,0.0,1.0)变成vec4(0.5,0.0,0.0,1.0)，你会发现渲染的点位置发生了变化。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 顶点着色器源码 --&gt;</span><br><span class="line">&lt;script id=<span class="string">"vertexShader"</span> type=<span class="string">"x-shader/x-vertex"</span>&gt;</span><br><span class="line">  <span class="keyword">void</span> main() &#123;</span><br><span class="line">    <span class="comment">//给内置变量gl_PointSize赋值像素大小</span></span><br><span class="line">    gl_PointSize=<span class="number">20.0</span>;</span><br><span class="line">    <span class="comment">//顶点位置，位于坐标原点</span></span><br><span class="line">    gl_Position =vec4(<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="片元着色器"><a href="#片元着色器" class="headerlink" title="片元着色器"></a>片元着色器</h2><p>内置变量gl_FragColor设置渲染结果的颜色值，vec4(1.0,0.0,0.0,1.0)表示红色，如果改成vec4(0.0,1.0,0.0,1.0)，你会发现渲染结果是绿色，vec4的四个分量分别表示RGBA。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 片元着色器源码 --&gt;</span><br><span class="line">&lt;script id=<span class="string">"fragmentShader"</span> type=<span class="string">"x-shader/x-fragment"</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> main() &#123;</span><br><span class="line">    gl_FragColor = vec4(<span class="number">1.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iscroll移动端卡顿解决办法</title>
      <link href="/2019/09/19/iscroll%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%8D%A1%E9%A1%BF%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
      <url>/2019/09/19/iscroll%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%8D%A1%E9%A1%BF%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>解决iscroll在移动端卡顿<br><a id="more"></a></p><h1 id="iscroll移动端卡顿解决办法"><a href="#iscroll移动端卡顿解决办法" class="headerlink" title="iscroll移动端卡顿解决办法"></a>iscroll移动端卡顿解决办法</h1><p>iscroll是模拟区域滚动的一个库，很有名的，类似的还有一个库叫better-scroll，作者是中国人，好像是阿里的吧，是在iscroll的基础上开发的，很灵活，支持es6等语法导入，不过本篇博文不做介绍，我们来讨论iscroll。<br>有一个需求是页面拒不缩放并且可以滚动，正好用到了iscroll-zoom.js,但是引入后发现在pc端嗷嗷流畅，但是移动端就卡顿，后来在网上查到解决办法，但是感觉并不是好的解决办法，应该还有更好的，暂时贴出现在的解决办法，以后在陆续跟进。</p><h2 id="解决方法一"><a href="#解决方法一" class="headerlink" title="解决方法一"></a>解决方法一</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">  * &#123; touch-action: pan-y; &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">　  <span class="built_in">window</span>.PointerEvent = <span class="literal">undefined</span>;</span><br><span class="line">　  <span class="built_in">document</span>.addEventListener(<span class="string">'touchmove'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">　　  e.preventDefault();</span><br><span class="line">　　&#125;, <span class="literal">false</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">　  tabContentScroll = </span><br><span class="line">  <span class="keyword">new</span> IScroll(<span class="string">"#tabContentWrapper"</span>, &#123;</span><br><span class="line">      tap: <span class="literal">true</span>,</span><br><span class="line">      probeType: <span class="number">2</span>,</span><br><span class="line">      deceleration: <span class="number">0.001</span>,</span><br><span class="line">      vScrollbar: <span class="literal">false</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">　　<span class="comment">// 初始化IScroll的时候，加上vScrollbar: false，最关键这句，不加这句，完成其他几点只可以改好Chorme的问题，安卓的问题解决不了！！！</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><p>我觉得是最主要的，比如iscroll-zoom.js文件，我是用的是v5.2.0版本，大约在290行<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> disablePointer : !utils.hasPointer,</span><br><span class="line">disableTouch : utils.hasPointer || !utils.hasTouch,</span><br><span class="line"> disableMouse : utils.hasPointer || utils.hasTouch,</span><br><span class="line"> <span class="comment">// 修改成</span></span><br><span class="line"> disablePointer : <span class="literal">true</span>,</span><br><span class="line">disableTouch : <span class="literal">false</span>,</span><br><span class="line">disableMouse : <span class="literal">true</span>,</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/cubiq/iscroll/issues/1100" target="_blank" rel="noopener">官网issus的解释</a><br><a href="https://www.cnblogs.com/KAI0725/p/11019971.html" target="_blank" rel="noopener">这个是在网络上找到的参考答案连接</a></p><h2 id="解决方法二"><a href="#解决方法二" class="headerlink" title="解决方法二"></a>解决方法二</h2><p>既然v5.2.0有bug，那我们不用这个版本的，可以用以前的老版本啊。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm info iscroll</span><br></pre></td></tr></table></figure></p><p>可以查看历史版本等信息，我下载了v5.0.8这个版本，经过测试可用了。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Puppeteer</title>
      <link href="/2019/09/10/Puppeteer/"/>
      <url>/2019/09/10/Puppeteer/</url>
      
        <content type="html"><![CDATA[<p>Puppeteer工具<br><a id="more"></a></p><h1 id="Puppeteer"><a href="#Puppeteer" class="headerlink" title="Puppeteer"></a>Puppeteer</h1><p>Puppeteer是谷歌官方出品的一个通过DevTools协议控制headless Chrome的Node库。可以通过Puppeteer的提供的api直接控制Chrome模拟大部分用户操作来进行UI Test或者作为爬虫访问页面来收集数据。<br>这里不做太多的介绍，贴出官方网址链接自行查看</p><ul><li><a href="https://www.npmjs.com/package/puppeteer" target="_blank" rel="noopener">npm-puppeteer</a></li><li><a href="https://www.findbestopensource.com/product/zhaoqize-puppeteer-api-zh-cn" target="_blank" rel="noopener">findbestopensource</a></li><li><a href="https://github.com/zhaoqize/puppeteer-api-zh_CN#readme" target="_blank" rel="noopener">Puppeteer 中文文档</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS中的offset、scroll、client</title>
      <link href="/2019/09/09/JS%E4%B8%AD%E7%9A%84offset%E3%80%81scroll%E3%80%81client/"/>
      <url>/2019/09/09/JS%E4%B8%AD%E7%9A%84offset%E3%80%81scroll%E3%80%81client/</url>
      
        <content type="html"><![CDATA[<p>JS中的offset、scroll、client简单整理<br><a id="more"></a></p><h1 id="JS中的offset、scroll、client"><a href="#JS中的offset、scroll、client" class="headerlink" title="JS中的offset、scroll、client"></a>JS中的offset、scroll、client</h1><p>在下开发中经常碰到 offset、scroll、client 这几个关键字，比如 offsetLeft、offsetHeight、scrollHeight、clientTop 什么的，每次都要各种实验，这里总结一下，一劳永逸。<br>来两张图先：<br><img src="/2019/09/09/JS中的offset、scroll、client/1.jpg" alt="img"><br><img src="/2019/09/09/JS中的offset、scroll、client/2.jpg" alt="img"></p><h2 id="1-offset"><a href="#1-offset" class="headerlink" title="1. offset"></a>1. offset</h2><p>offset 指偏移，包括这个元素在文档中占用的所有显示宽度，包括滚动条、 padding、 border，不包括 overflow隐藏的部分。</p><ul><li>offsetParent属性返回一个对象的引用，这个对象是距离调用 offsetParent的父级元素中最近的（在包含层次中最靠近的），并且是已进行过CSS定位的容器元素。如果这个容器元素未进行CSS定位, 则 offsetParent属性的取值为根元素的引用。如果当前元素的父级元素中没有进行CSS定位（position为 absolute/relative）， offsetParent 为 body如果当前元素的父级元素中有CSS定位（ position 为 absolute/relative）， offsetParent 取父级中最近的元素</li><li>obj.offsetWidth 指 obj 控件自身的绝对宽度，不包括因 overflow 而未显示的部分，也就是其实际占据的宽度，整型，单位：像素。<br>offsetWidth = border-width*2+ padding-left+ width+ padding-right</li><li>obj.offsetHeight 指 obj 控件自身的绝对高度，不包括因 overflow 而未显示的部分，也就是其实际占据的高度，整型，单位：像素。<br>offsetHeight = border-width*2+ padding-top+ height+ padding-bottom</li><li>obj.offsetTop 指 obj 相对于版面或由 offsetParent 属性指定的父坐标的计算上侧位置，整型，单位：像素。<br>offsetTop= offsetParent的padding-top + 中间元素的offsetHeight + 当前元素的margin-top</li><li>obj.offsetLeft 指 obj 相对于版面或由 offsetParent 属性指定的父坐标的计算左侧位置，整型，单位：像素。<br>offsetLeft= offsetParent的padding-left + 中间元素的offsetWidth + 当前元素的margin-left</li></ul><h2 id="2-scroll"><a href="#2-scroll" class="headerlink" title="2. scroll"></a>2. scroll</h2><p>scroll指滚动，包括这个元素没显示出来的实际宽度，包括 padding，不包括滚动条、 border</p><ul><li>scrollHeight 获取对象的滚动高度，对象的实际高度；</li><li>scrollLeft 设置或获取位于对象左边界和窗口中目前可见内容的最左端之间的距离</li><li>scrollTop 设置或获取位于对象最顶端和窗口中可见内容的最顶端之间的距离</li><li>scrollWidth 获取对象的滚动宽度</li></ul><h2 id="3-client"><a href="#3-client" class="headerlink" title="3. client"></a>3. client</h2><p>client指元素本身的可视内容，不包括 overflow被折叠起来的部分，不包括滚动条、 border，包括 padding</p><ul><li>clientWidth 对象可见的宽度，不包括滚动条等边线，会随窗口的显示大小改变</li><li>clientHeight 对象可见的高度</li><li>clientTop、clientLeft 这两个返回的是元素周围边框的厚度，一般它的值就是0。因为滚动条不会出现在顶部或者左侧</li></ul><h2 id="最后，奉上一个demo"><a href="#最后，奉上一个demo" class="headerlink" title="最后，奉上一个demo"></a>最后，奉上一个demo</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  #parent &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    margin: <span class="number">20</span>px auto;</span><br><span class="line">    width: <span class="number">300</span>px;</span><br><span class="line">    height: <span class="number">400</span>px;</span><br><span class="line">    border: <span class="number">1</span>px solid blue;</span><br><span class="line">    overflow: auto;</span><br><span class="line">  &#125;</span><br><span class="line">  #child &#123;</span><br><span class="line">    width: <span class="number">500</span>px;</span><br><span class="line">    height: <span class="number">600</span>px;</span><br><span class="line">    margin: <span class="number">10</span>px;</span><br><span class="line">    padding: <span class="number">5</span>px;</span><br><span class="line">    background-color: blanchedalmond;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div id="parent"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div id="child"&gt;&lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> nParent = <span class="built_in">document</span>.querySelector(<span class="string">'#parent'</span>),</span><br><span class="line">      nChild = <span class="built_in">document</span>.querySelector(<span class="string">'#child'</span>);</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// offset偏移</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'父元素-&gt;'</span>, nChild.offsetParent);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'offsetWidth-&gt;'</span>, nChild.offsetWidth);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'offsetHeight-&gt;'</span>, nChild.offsetHeight);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'offsetTop-&gt;'</span>, nChild.offsetTop);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'offsetLeft-&gt;'</span>, nChild.offsetLeft);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'&lt;-------------------------&gt;'</span>);</span><br><span class="line">    <span class="comment">// scroll滚动</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'scrollHeight-&gt;'</span>, nParent.scrollHeight);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'scrollLeft-&gt;'</span>, nParent.scrollLeft);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'scrollTop-&gt;'</span>, nParent.scrollTop);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'scrollWidth-&gt;'</span>, nParent.scrollWidth);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'&lt;-------------------------&gt;'</span>);</span><br><span class="line">    <span class="comment">// client</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'clientWidth-&gt;'</span>, nChild.clientWidth);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'clientHeight-&gt;'</span>, nChild.clientHeight);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'clientTop-&gt;'</span>, nChild.clientTop);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'clientLeft-&gt;'</span>, nChild.clientLeft);</span><br><span class="line">  &#125;, <span class="literal">false</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个页面loading小插件2</title>
      <link href="/2019/09/04/%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2loading%E5%B0%8F%E6%8F%92%E4%BB%B62/"/>
      <url>/2019/09/04/%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2loading%E5%B0%8F%E6%8F%92%E4%BB%B62/</url>
      
        <content type="html"><![CDATA[<p>有多种选择的loading插件<br><a id="more"></a></p><h1 id="一个页面loading小插件2"><a href="#一个页面loading小插件2" class="headerlink" title="一个页面loading小插件2"></a>一个页面loading小插件2</h1><p>前些天写了一个loading的插件，<a href="https://jinux7.github.io/2019/08/18/一个页面loading小插件/" target="_blank" rel="noopener">点击查看</a>,今天又写了一个，优点是可以进行loading样式的选择，有12种样式。<br>先贴出loading插件代码:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>移动端的loading效果小插件，内置了12种loading效果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>使用demo：var mask = new JLoading();</span></span><br><span class="line"><span class="comment"> *                        mask.init('loader-03');</span></span><br><span class="line"><span class="comment"> *                        mask.show(); 显示</span></span><br><span class="line"><span class="comment"> *                        mask.hide(); 隐藏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">JLoading</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.loaderStr = <span class="string">'loader-01,loader-02,loader-03,loader-04,loader-05,loader-06,loader-07,loader-08,loader-09,loader-10,loader-11,loader-12'</span></span><br><span class="line">  <span class="keyword">this</span>.type = <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line">JLoading.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.loaderStr.split(<span class="string">','</span>).indexOf(type) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.type = <span class="string">'loader-01'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.type = type;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.loadIndex = <span class="keyword">this</span>.type.slice(<span class="number">-2</span>);</span><br><span class="line">  <span class="keyword">var</span> nBody = <span class="built_in">document</span>.body,</span><br><span class="line">      nHead = <span class="built_in">document</span>.head;</span><br><span class="line">  <span class="keyword">var</span> nStyle = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>), </span><br><span class="line">      nMask = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</span><br><span class="line">      nLoader = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  nMask.setAttribute(<span class="string">'id'</span>, <span class="string">'JLoading-mask-'</span>+<span class="keyword">this</span>.loadIndex);</span><br><span class="line">  nLoader.setAttribute(<span class="string">'class'</span>, <span class="keyword">this</span>.type);</span><br><span class="line">  nMask.appendChild(nLoader);</span><br><span class="line">  nBody.appendChild(nMask);</span><br><span class="line">  nStyle.innerHTML = <span class="string">`[id*="JLoading-mask"]&#123;display:none;width:100%;height:100%;height:100vh;background-color:rgba(0,0,0,.8)&#125;[class*="loader-"]&#123;position:absolute;display:inline-block;width:10%;padding-top:10%;color:#fff;vertical-align:middle;pointer-events:none;left:45%;top:45%&#125;.loader-01&#123;border:5px dotted currentcolor;border-radius:50%;-webkit-animation:1s loader-01 linear infinite;animation:1s loader-01 linear infinite&#125;@-webkit-keyframes loader-01&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@keyframes loader-01&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;.loader-02&#123;border:5px solid transparent;border-left-color:currentcolor;border-right-color:currentcolor;border-radius:50%;-webkit-animation:1s loader-02 linear infinite;animation:1s loader-02 linear infinite&#125;@-webkit-keyframes loader-02&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@keyframes loader-02&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;.loader-03&#123;border:2px solid currentcolor;border-bottom-color:transparent;border-radius:50%;-webkit-animation:1s loader-03 linear infinite;animation:1s loader-03 linear infinite;position:relative&#125;@-webkit-keyframes loader-03&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@keyframes loader-03&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;.loader-04&#123;border:1px solid currentcolor;border-radius:50%;-webkit-animation:1s loader-04 linear infinite;animation:1s loader-04 linear infinite;position:relative&#125;.loader-04:before&#123;content:'';display:block;width:0;height:0;position:absolute;top:-3px;left:50%;border:3px solid currentcolor;border-radius:50%&#125;@-webkit-keyframes loader-04&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@keyframes loader-04&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;.loader-05&#123;border:5px solid transparent;border-top-color:currentcolor;border-radius:50%;-webkit-animation:1s loader-05 linear infinite;animation:1s loader-05 linear infinite;position:relative&#125;.loader-05:before&#123;content:'';display:block;width:inherit;height:inherit;position:absolute;top:-5px;left:-5px;border:5px solid currentcolor;border-radius:50%;opacity:.5;width:100%;padding-top:100%&#125;@-webkit-keyframes loader-05&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@keyframes loader-05&#123;0%&#123;-webkit-transform:rotate(0deg);transform:rotate(0deg)&#125;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;.loader-06&#123;border:5px solid currentcolor;border-radius:50%;-webkit-animation:loader-06 1s ease-out infinite;animation:loader-06 1s ease-out infinite&#125;@-webkit-keyframes loader-06&#123;0%&#123;-webkit-transform:scale(0);transform:scale(0);opacity:0&#125;50%&#123;opacity:1&#125;100%&#123;-webkit-transform:scale(1);transform:scale(1);opacity:0&#125;&#125;@keyframes loader-06&#123;0%&#123;-webkit-transform:scale(0);transform:scale(0);opacity:0&#125;50%&#123;opacity:1&#125;100%&#123;-webkit-transform:scale(1);transform:scale(1);opacity:0&#125;&#125;.loader-07&#123;border:0 solid transparent;border-radius:50%;position:relative&#125;.loader-07:before,.loader-07:after&#123;content:'';border:5px solid currentcolor;border-radius:50%;width:inherit;height:inherit;position:absolute;top:0;left:0;-webkit-animation:loader-07 1s linear infinite;animation:loader-07 1s linear infinite;opacity:0;width:100%;height:100%&#125;.loader-07:before&#123;-webkit-animation-delay:1s;animation-delay:1s&#125;.loader-07:after&#123;-webkit-animation-delay:.5s;animation-delay:.5s&#125;@-webkit-keyframes loader-07&#123;0%&#123;-webkit-transform:scale(0);transform:scale(0);opacity:0&#125;50%&#123;opacity:1&#125;100%&#123;-webkit-transform:scale(1);transform:scale(1);opacity:0&#125;&#125;@keyframes loader-07&#123;0%&#123;-webkit-transform:scale(0);transform:scale(0);opacity:0&#125;50%&#123;opacity:1&#125;100%&#123;-webkit-transform:scale(1);transform:scale(1);opacity:0&#125;&#125;.loader-08&#123;position:relative&#125;.loader-08:before,.loader-08:after&#123;content:'';width:inherit;height:inherit;border-radius:50%;background-color:currentcolor;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:loader-08 2.0s infinite ease-in-out;animation:loader-08 2.0s infinite ease-in-out;width:100%;height:100%&#125;.loader-08:after&#123;-webkit-animation-delay:-1.0s;animation-delay:-1.0s&#125;@-webkit-keyframes loader-08&#123;0%,100%&#123;-webkit-transform:scale(0);transform:scale(0)&#125;50%&#123;-webkit-transform:scale(1);transform:scale(1)&#125;&#125;@keyframes loader-08&#123;0%,100%&#123;-webkit-transform:scale(0);transform:scale(0)&#125;50%&#123;-webkit-transform:scale(1);transform:scale(1)&#125;</span></span><br><span class="line"><span class="string">    &#125;.loader-09&#123;background-color:currentcolor;border-radius:50%;-webkit-animation:loader-09 1.0s infinite ease-in-out;animation:loader-09 1.0s infinite ease-in-out&#125;@-webkit-keyframes loader-09&#123;0%&#123;-webkit-transform:scale(0);transform:scale(0)&#125;100%&#123;-webkit-transform:scale(1);transform:scale(1);opacity:0&#125;&#125;@keyframes loader-09&#123;0%&#123;-webkit-transform:scale(0);transform:scale(0)&#125;100%&#123;-webkit-transform:scale(1);transform:scale(1);opacity:0&#125;&#125;.loader-10&#123;position:relative;-webkit-animation:loader-10-1 2.0s infinite linear;animation:loader-10-1 2.0s infinite linear&#125;.loader-10:before,.loader-10:after&#123;content:'';width:0!important;height:0!important;border:15px solid currentcolor;display:block;position:absolute;border-radius:100%;-webkit-animation:loader-10-2 2s infinite ease-in-out;animation:loader-10-2 2s infinite ease-in-out&#125;.loader-10:before&#123;top:0;left:50%&#125;.loader-10:after&#123;bottom:0;right:50%;-webkit-animation-delay:-1s;animation-delay:-1s&#125;@-webkit-keyframes loader-10-1&#123;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@keyframes loader-10-1&#123;100%&#123;-webkit-transform:rotate(360deg);transform:rotate(360deg)&#125;&#125;@-webkit-keyframes loader-10-2&#123;0%,100%&#123;-webkit-transform:scale(0);transform:scale(0)&#125;50%&#123;-webkit-transform:scale(1);transform:scale(1)&#125;&#125;@keyframes loader-10-2&#123;0%,100%&#123;-webkit-transform:scale(0);transform:scale(0)&#125;50%&#123;-webkit-transform:scale(1);transform:scale(1)&#125;&#125;.loader-11&#123;background-color:currentcolor;-webkit-animation:loader-11 1.2s infinite ease-in-out;animation:loader-11 1.2s infinite ease-in-out&#125;@-webkit-keyframes loader-11&#123;0%&#123;-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg);transform:perspective(120px) rotateX(0deg) rotateY(0deg)&#125;50%&#123;-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)&#125;100%&#123;-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)&#125;&#125;@keyframes loader-11&#123;0%&#123;-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg);transform:perspective(120px) rotateX(0deg) rotateY(0deg)&#125;50%&#123;-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)&#125;100%&#123;-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)&#125;&#125;.loader-12&#123;position:relative&#125;.loader-12:before,.loader-12:after&#123;content:'';display:block;position:absolute;background-color:currentcolor;left:50%;right:0;top:0;bottom:50%;box-shadow:-.5em 0 0 currentcolor;-webkit-animation:loader-12 1s linear infinite;animation:loader-12 1s linear infinite&#125;.loader-12:after&#123;top:50%;bottom:0;-webkit-animation-delay:.25s;animation-delay:.25s&#125;@-webkit-keyframes loader-12&#123;0%,100%&#123;box-shadow:-20px 0 0 transparent;background-color:currentcolor&#125;50%&#123;box-shadow:-20px 0 0 currentcolor;background-color:transparent&#125;&#125;@keyframes loader-12&#123;0%,100%&#123;box-shadow:-20px 0 0 transparent;background-color:currentcolor&#125;50%&#123;box-shadow:-20px 0 0 currentcolor;background-color:transparent&#125;&#125;`</span>;</span><br><span class="line">  nHead.appendChild(nStyle);   </span><br><span class="line">&#125;</span><br><span class="line">JLoading.prototype.show = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nMask = <span class="built_in">document</span>.getElementById(<span class="string">'JLoading-mask-'</span>+<span class="keyword">this</span>.loadIndex);</span><br><span class="line">  nMask.style.display = <span class="string">'block'</span>;</span><br><span class="line">&#125;</span><br><span class="line">JLoading.prototype.hide = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nMask = <span class="built_in">document</span>.getElementById(<span class="string">'JLoading-mask-'</span>+<span class="keyword">this</span>.loadIndex);</span><br><span class="line">  nMask.style.display = <span class="string">'none'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>使用见下面代码:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;<span class="xml"><span class="tag">&lt;<span class="name">loading-test</span>&gt;</span><span class="tag">&lt;/<span class="name">loading-test</span>&gt;</span></span>&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>loading-plug.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;script&gt;</span></span><br><span class="line"><span class="string">    var mask1 = new JLoading();</span></span><br><span class="line"><span class="string">    mask1.init('loader-12');</span></span><br><span class="line"><span class="string">    setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="string">        mask1.show();</span></span><br><span class="line"><span class="string">    &#125;, 1000);</span></span><br><span class="line"><span class="string">    setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="string">        mask1.hide();</span></span><br><span class="line"><span class="string">    &#125;, 3000);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p><p>使用不同的样式，需要在mask1.init(‘loader-12’)方法中传入名字，比如’loader-02’,具体的样式名字见下图:<br><img src="/2019/09/04/一个页面loading小插件2/1.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>window下flutter环境搭建</title>
      <link href="/2019/08/26/window%E4%B8%8Bflutter%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2019/08/26/window%E4%B8%8Bflutter%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>flutter在window 10下的环境搭建<br><a id="more"></a></p><h1 id="window下flutter环境搭建"><a href="#window下flutter环境搭建" class="headerlink" title="window下flutter环境搭建"></a>window下flutter环境搭建</h1><p>flutter是google出的一个跨平台移动端app开发框架，据说性能已经超过了原生开发，作为一名前端，即使不深入研究，也得浅浅的看一下这是个什么东西吧，所以今天记录一下flutter在win10下的安装步骤。</p><h2 id="1-安装flutter"><a href="#1-安装flutter" class="headerlink" title="1.安装flutter"></a>1.安装flutter</h2><p>去flutter官网下载flutter的压缩包，<a href="https://flutterchina.club/setup-windows/" target="_blank" rel="noopener">flutter官网地址</a>,将压缩包解压到一个目录下，之后配置一下环境变量（这里不细说了，就是把bin目录配到系统的环境变量下），之后开启终端，运行flutter，第一次运行flutter需要去网络拉取资源，所以电脑必须得安装好了git，再有一点，由于防火墙的原因，拉取国外资源有时候不成功，所以在运行flutter之前最好配一下资源镜像路径：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure></p><p>这两句话最好在git bash下执行哦，之后就可以运行flutter初始化了。</p><ul><li>这里注意一下，最好选择flutter的最新版本安装，因为下一步会安装android sdk，android会自动下载最新版本的，所以为了兼容，我在有的电脑中安装的flutter不是最新版本，andriod是最新的，出现了无法run的问题。</li></ul><h2 id="2-安装JDK"><a href="#2-安装JDK" class="headerlink" title="2.安装JDK"></a>2.安装JDK</h2><p>由于是android开发，所以java的sdk是必不可少的，去<a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">java sdk</a>下载，注意，一定要下载java SE 8u***版本的，其他版本不兼容，下载之后安装即可。</p><h2 id="3-安装vs-code以及flutter插件。"><a href="#3-安装vs-code以及flutter插件。" class="headerlink" title="3.安装vs code以及flutter插件。"></a>3.安装vs code以及flutter插件。</h2><h2 id="4-安装android-studio"><a href="#4-安装android-studio" class="headerlink" title="4.安装android studio"></a>4.安装android studio</h2><p><a href="https://developer.android.google.cn/studio" target="_blank" rel="noopener">下载链接</a>,下载好之后，一路下一步就可以，第一次安装需要下载android sdk，会下载很长时间，不过虽然有墙的存在，但是依然可以安装成功,如果不成功就多试几次。安装好了sdk后，软件就会自动打开，来到首页，也就是新建项目的地方，这时候可以安装android studio的flutter插件，第一次打开安装插件面板的时候会一直loading，最开始我还以为是墙的原因呢，不要着急，慢慢的等待即可。安装好了flutter插件后重启ide，重启后新建一个flutter项目，建好之后我们创建android虚拟机，点击tools-&gt;avd manager,创建一个虚拟机。创建虚拟机需要安装android的系统，非常的慢，慢慢等待吧。</p><ul><li>有的电脑安装模拟器的时候会报HAXM的安装不上错误，这是因为win10默认开启了Hyer-V微软的虚拟机，只需到服务里把它关掉即可。</li></ul><h2 id="5-以上完成之后，打开命令行，运行flutter-doctor-会有一段"><a href="#5-以上完成之后，打开命令行，运行flutter-doctor-会有一段" class="headerlink" title="5.以上完成之后，打开命令行，运行flutter doctor,会有一段"></a>5.以上完成之后，打开命令行，运行flutter doctor,会有一段</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Android toolchain - develop for Android devices (Android SDK version 29.0.2)</span><br><span class="line">   X Android licenses not accepted.  To resolve this, run: flutter doctor --android-licenses</span><br></pre></td></tr></table></figure><p>的提示，直接运行flutter doctor –android-licenses，一路y就可以。</p><p>如果顺利的话，现在就可以运行你的flutter项目了，我在自己的电脑上安装的很顺利，但是在公司的电脑上安装的很是肯可啊。</p><ul><li>还需要注意下，有的电脑会让你升级android sdk，命令行会提示你具体的路径，里边是一个.bat的文件，不用担心，.bat和.exe一样的，在cmd下一样可以在后边传参数。如果你运行的是powerShell，注意一下，执行命令需要这样<code>./manager.bat</code>。再有，升级可能会删除tools文件夹再下载，不过win10不允许程序随意删除文件，这时候需要手动删除一下（改个名字更好）。</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是我在搭建flutter环境的时候遇到的一些状况。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nw.js入门小结</title>
      <link href="/2019/08/22/nw-js%E5%85%A5%E9%97%A8%E5%B0%8F%E7%BB%93/"/>
      <url>/2019/08/22/nw-js%E5%85%A5%E9%97%A8%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>nw.js方便简单的pc端app开发工具<br><a id="more"></a></p><h1 id="nw-js入门小结"><a href="#nw-js入门小结" class="headerlink" title="nw.js入门小结"></a>nw.js入门小结</h1><p>nw.js和electron都是利用html来开发pc端应用的工具，今天我写一写nw.js的入门知识。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先，去官网下载nw，<a href="https://nwjs.io" target="_blank" rel="noopener">官网地址</a>,首页就可以看到下载地址，有两个下载，一个是normal,一个是sdk，见下图：<br><img src="/2019/08/22/nw-js入门小结/1.png" alt="img"><br>sdk是有调试功能的，生成的应用，在上面点击右键可以看到类似浏览器F12的调试面板。<br>normal就是没有调试功能的包，用于生产发布的时候用。<br>下载后不需要安装，直接解压后就可以使用。</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在nw的sdk包解压后的文件中，新建一个app文件夹，在app文件夹中放一个index.html的页面，再建一个package.json的文件，内容是：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"fullscreen"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"main"</span>: <span class="string">"index.html"</span>,</span><br><span class="line"><span class="string">"name"</span>: <span class="string">"layout"</span>,</span><br><span class="line"><span class="string">"description"</span>: <span class="string">"nw学习"</span>,</span><br><span class="line"><span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line"><span class="string">"keywords"</span>: [  <span class="string">"指令学习"</span>, <span class="string">"在线"</span>],</span><br><span class="line"><span class="string">"window"</span>: &#123;</span><br><span class="line"><span class="string">"title"</span>: <span class="string">"指令学习"</span>,</span><br><span class="line"><span class="string">"icon"</span>: <span class="string">"icon.png"</span>,</span><br><span class="line"><span class="string">"toolbar"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"frame"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">"width"</span>: <span class="number">375</span>,</span><br><span class="line"><span class="string">"height"</span>: <span class="number">750</span>,</span><br><span class="line"><span class="string">"position"</span>: <span class="string">"center"</span>,</span><br><span class="line"><span class="string">"min_width"</span>: <span class="number">375</span>,</span><br><span class="line"><span class="string">"min_height"</span>: <span class="number">750</span>,</span><br><span class="line"><span class="string">"max_width"</span>: <span class="number">1920</span>,</span><br><span class="line"><span class="string">"max_height"</span>: <span class="number">1080</span>,</span><br><span class="line"><span class="string">"resizable"</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"webkit"</span>: &#123;</span><br><span class="line"><span class="string">"plugin"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">"java"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">"page-cache"</span>: <span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"user-agent"</span>: <span class="string">"%name %ver %nwver %webkit_ver %osinfo"</span>,</span><br><span class="line"><span class="string">"chromium-args"</span>: <span class="string">"--allow-file-access-from-files"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main属性是关键，指的是入口文件的位置</span></span><br></pre></td></tr></table></figure></p><p>准备工作完毕，目录结构见下图：<br><img src="/2019/08/22/nw-js入门小结/2.png" alt="img"><br>将app文件夹拖拽到nw.exe上即可打开应用进行开发调试。</p><h2 id="打包发布"><a href="#打包发布" class="headerlink" title="打包发布"></a>打包发布</h2><p>如果开发完了之后，给别人用，就需要进行打包了。<br>首先将app文件夹压缩，比如压缩成app.zip文件，之后改名为app.nw文件。<br>打包需要在命令行下进行，打开cmd命令行（注意，这里只能用cmd，gitBash和powerShell都不好使哦），切换到当前目录，执行下面的命令:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy /b nw.exe+app.nw app.exe</span><br></pre></td></tr></table></figure></p><p><img src="/2019/08/22/nw-js入门小结/3.png" alt="img"><br>可以看到，app.exe就是打包出来的可执行文件，这时候直接点击它就可以运行程序了。</p><ul><li>把这个app.exe文件复制到normal的运行文件夹下，也可以点击运行，这时其实就是一个绿色版的应用程序了，完全可以交付给客户使用了。</li><li>如果感觉一堆文件看起来不舒服，还可以使用enigmavirtualbox工具进行打包成一个.exe的文件，不过这个文件一般都比较大哦。</li><li>最后一种方法，innosetup工具，可以制作成安装版本，这样体积就小了。</li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端静态资源服务器都用到了啥？</title>
      <link href="/2019/08/22/%E5%89%8D%E7%AB%AF%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%BD%E7%94%A8%E5%88%B0%E4%BA%86%E5%95%A5%EF%BC%9F/"/>
      <url>/2019/08/22/%E5%89%8D%E7%AB%AF%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%BD%E7%94%A8%E5%88%B0%E4%BA%86%E5%95%A5%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<p>前端都用到了哪些技术实现静态资源服务器<br><a id="more"></a></p><h1 id="前端静态资源服务器都用到了啥？"><a href="#前端静态资源服务器都用到了啥？" class="headerlink" title="前端静态资源服务器都用到了啥？"></a>前端静态资源服务器都用到了啥？</h1><p>平时我们在开发的时候，肯定会自己架一个服务，把网页放进去，再跑，那么，我们平时都用到了哪些手段来实现呢？</p><h2 id="http-server"><a href="#http-server" class="headerlink" title="http-server"></a>http-server</h2><p><a href="https://www.npmjs.com/package/http-server" target="_blank" rel="noopener">官网</a>,使用起来很方便。</p><h2 id="browser-sync"><a href="#browser-sync" class="headerlink" title="browser-sync"></a>browser-sync</h2><p><a href="http://www.browsersync.cn" target="_blank" rel="noopener">官网</a>,功能非常之强大。</p><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">官网下载</a>,nginx可是现在静态资源服务器中响应速度最快的了，如果在生产环境下，还是使用nginx吧。</p><h2 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h2><p>nginx出来之前大家都用，现在基本上没人用了，淘汰掉。</p><h2 id="webpack-dev"><a href="#webpack-dev" class="headerlink" title="webpack-dev"></a>webpack-dev</h2><p>这个其实是webpack的一个插件，我们在开发react，vue，angular的时候会用到它。</p><h2 id="express-amp-koa"><a href="#express-amp-koa" class="headerlink" title="express&amp;koa"></a>express&amp;koa</h2><p>express和koa中都有静态资源的中间件，用起来就是麻烦些。</p><h2 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h2><p>最后就是可以利用nodejs的http模块手写一个静态资源服务器。 </p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端适配rem&amp;scale</title>
      <link href="/2019/08/18/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8Drem&amp;scale/"/>
      <url>/2019/08/18/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8Drem&amp;scale/</url>
      
        <content type="html"><![CDATA[<p>移动端设置html元素的font-size代码，scale代码<br><a id="more"></a></p><h1 id="移动端适配rem-amp-scale"><a href="#移动端适配rem-amp-scale" class="headerlink" title="移动端适配rem&amp;scale"></a>移动端适配rem&amp;scale</h1><h2 id="rem方式"><a href="#rem方式" class="headerlink" title="rem方式"></a>rem方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">doc, win</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> docEl = doc.documentElement,</span><br><span class="line">resizeEvt = <span class="string">'orientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">'orientationchange'</span> : <span class="string">'resize'</span>,</span><br><span class="line">recalc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clientWidth = docEl.clientWidth;</span><br><span class="line">  <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span><br><span class="line">  docEl.style.fontSize = clientWidth/<span class="number">20</span> + <span class="string">'px'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (!doc.addEventListener) <span class="keyword">return</span>;</span><br><span class="line">win.addEventListener(resizeEvt, recalc, <span class="literal">false</span>);</span><br><span class="line">doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, recalc, <span class="literal">false</span>);</span><br><span class="line">&#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><h2 id="scale方式"><a href="#scale方式" class="headerlink" title="scale方式"></a>scale方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curWidth = <span class="built_in">window</span>.screen.width; <span class="comment">//iphone 6plus为414px</span></span><br><span class="line"><span class="keyword">var</span> targetWidth = <span class="number">750</span>; <span class="comment">// 设计稿宽度</span></span><br><span class="line"><span class="keyword">var</span> scale = curWidth/targetWidth;</span><br><span class="line"><span class="keyword">var</span> meta = <span class="built_in">document</span>.createElement(<span class="string">"meta"</span>);</span><br><span class="line">meta.name = <span class="string">"viewport"</span>;</span><br><span class="line">meta.content = <span class="string">'initial-scale='</span>+scale+<span class="string">',minimum-scale='</span>+scale+<span class="string">',maximum-scale='</span>+scale+<span class="string">''</span>; <span class="comment">// 注意，没有width=device-width</span></span><br></pre></td></tr></table></figure><p>scale方式就是把你按照设计稿宽度做的页面缩放到当前手机屏幕宽度。<br>scale = 屏幕视口宽度/设计稿宽度(实际制作的页面宽度)</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个页面loading小插件</title>
      <link href="/2019/08/18/%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2loading%E5%B0%8F%E6%8F%92%E4%BB%B6/"/>
      <url>/2019/08/18/%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2loading%E5%B0%8F%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>移动端的loading小插件<br><a id="more"></a></p><h1 id="一个页面loading小插件"><a href="#一个页面loading小插件" class="headerlink" title="一个页面loading小插件"></a>一个页面loading小插件</h1><p>这是一个移动端的loading蒙版，细节不说了，为了以后备用，直接上代码了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>一个页面加载的loading小插件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>注意，引用的时候一定要放到html文档的最后，因为需要向body插入内容，这里没有使用document的DOMContentLoaded，和window的loaded也是为了loading效果能够最快速的显示。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>这里css用到了rem，需要注意。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>window.showLoadingEarth() 显示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>window.hideLoadingEarth() 隐藏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">win</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.showLoadingEarth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    nDiv.style.display = <span class="string">'block'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.hideLoadingEarth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    nDiv.style.display = <span class="string">'none'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> templateStr = <span class="string">`&lt;div class="loading-inner"&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class="dong"&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;strong class="dong"&gt;&lt;/strong&gt;</span></span><br><span class="line"><span class="string">                        &lt;em&gt;&lt;/em&gt;</span></span><br><span class="line"><span class="string">                      &lt;/div&gt;`</span>;</span><br><span class="line">  <span class="keyword">var</span> cssStr = <span class="string">`#loading-earth &#123;</span></span><br><span class="line"><span class="string">                  display: none;</span></span><br><span class="line"><span class="string">                  position: absolute;</span></span><br><span class="line"><span class="string">                  width: 100%;</span></span><br><span class="line"><span class="string">                  height: 100%;</span></span><br><span class="line"><span class="string">                  top: 0;</span></span><br><span class="line"><span class="string">                  left: 0;</span></span><br><span class="line"><span class="string">                  background-color: rgba(0,0,0,.8);</span></span><br><span class="line"><span class="string">                  z-index: 999;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                #loading-earth .loading-inner &#123;</span></span><br><span class="line"><span class="string">                  width: 4rem;</span></span><br><span class="line"><span class="string">                  height: 4rem;</span></span><br><span class="line"><span class="string">                  /* background-color: #ffffff; */</span></span><br><span class="line"><span class="string">                  position: absolute;</span></span><br><span class="line"><span class="string">                  top: 50%;</span></span><br><span class="line"><span class="string">                  left: 50%;</span></span><br><span class="line"><span class="string">                  transform: translate(-50%,-50%);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                #loading-earth .loading-inner span &#123;</span></span><br><span class="line"><span class="string">                  display: inline-block;</span></span><br><span class="line"><span class="string">                  width: 3.6rem;</span></span><br><span class="line"><span class="string">                  height: 3.6rem;</span></span><br><span class="line"><span class="string">                  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALYAAAC4CAYAAABO+hZ0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAItFJREFUeNrsXQmUZFV5/l9V9TLdszPDMoCMICMom4gg6HGJStwXcDlREuPJvhjjyZ6TxeScmF2jxpx4jprkuCQxqNGoRNTIjiIIgoAwMgPMwDB790zvtdzc793v1rt1+1V3dXVV93tV95/zT22vqqve+97/vn+90Z98pSJB2pLIu027bx8r3i9orfE5e18529W8W/verolq8hf8p5Rq8rqav739TNXkb6gVODilgM+WAeyDNe31ZkB3nys4zxVTtq85z1Wd16opzwUJwG4LyAtZ5I4aTX628k6eAWe7QcfCKwIctxXnvUECsGN5mtYXaH1Q6z0tgjBawknRCdC7dKbo3HeBXiPAa8Gi9y+wL9H6Oq1Xa302n7uH4H6v1v3LAKgPfNXiZ0VL+Hz/sy2lGSS4IWUH7AHYPSprtZ6v9UVaX6v1CofnWrlI67MIhl/TOr4A2NQSgNjOCdIu9VHO8RxwrHfZseYB2DkXHNhtWp+v9ZVaL9N6qtbRFFC7HPYNWj+j9bo2gZwGUrUAd1ct0I+lgtvl6oPcF3g8R6DPBWDnU4a0vlXrm7ReSkAvBYhntQmkNCBWF4isVCUJAVZ5W/Aohg/UpVp196Raw7+D/TPL+9UA7Oz/jgu0vkXrNVpPc17zL8GFBT4HB/rHKWBJA7A4EYrlRiRcIBecv1+UJPxX4v1Cm9TIfnaR4J4jRZl1nNAA7AzJhbTQAPXZnqWUBUCaJge03tYEFKoFh2450Q+V8t0rzsk4y+NlncWiEylRi1hy//cCyIPK0JQh/eqs/oQy+XgA9irLKVp/XutVWs+lFWrH8lQJDljqd2g9lsHfaq86c95VZ4DgH5D0ZNBCZ2BNP2Hpzyg/BzrZC45mHoF9Fq3zu+kginNQFjqw7iUcIb2HtR7lQb1f66e13pWTfWCBN+sAvkBnseAc10g1IjtqgnUbUbFhwynH2QzAXgF5tdZfZZRjIy+di/FLSz1mCejvar2eIMbjJ3vgyluTJG5dVOb3Dse/W9WjImm83r215SA4MdZxfwHcM3nk33kBNqIbv6P1zQ5YKymev/vY/W2PaP2s1m9ovVvrhPSuWCs7ofdEkfth0OHnafVLUco+HBLLwQ09KQdgd05wYN5FLn2eNMZgoyZWyKad92q9mYD+ivSn2JDeHI/1kDIgbzVcWKDlHyA9mc4L/84ysF+o9c+1vpSPyy1cEouMbHxd66dIO45JEMX9V3as8IBjBFKjKOQmln+vpeWfyIP1ziKw4cy9jc7hMx0HqZllGXB45ue1/quYkN2RgOdUsSn2Iq3xEC1zpIGsmvBwGz8foh7PuvXOGrBPopX+Rc/r97mgy6Xh/H1T6z9q/V7AbcsWvELrO6sBPUIDsVDyyu012MjtJ/k5KgA7XWAFrtT6R1ovJiespVhqmz2zVvqHWv+B1OPJgNe2Lfgx7tM1PBYxv1bN61wUty3pV6b0o+msgTsrwP4pWmqkwmdk4dJPPH5A6ye0flBCgX2nLHi9SEo/GJEkta9SqIk5Jirm3EOkNZlK7Kw2sDdr/TOtv86dMtNkO1upBrmegL45gLrzURRljgGs+AitcqG+n9P7HnGziVjKjGO5msDervVPxZSKTrfwPe/T+jdiMoRBus+/j7F+pM6/F6AmNTr9RTqWs/0K7DO0flJMKM+WUKY5hpZLg0P/tdbbA+5WVGBwKspY7jWSVBimUhOVRE0OrTa4VwPYL9P6ETGFS1MpYLY7aw0vbe/X+pcBY6vqXFZ4u56YSZ/aoOrlt1u0jpF39wWwf0Lr39FiTza5rNlL251a/0rrVwO2MkFP4ri1MnUkpthKpVKTOKGj/9vgUBPVy8B+sZhs4DbvTHajHrauAY7he8TUdQTJjhjaqGI+vbbBsTR33IROiRZeVgPchRX6O6iZ/jdeoiaaWAR8F4Sc/paWPYA6m1IhUMdowaNmXRjKOJyImKyTxvR97i02wHoloxlbJCli8i9h2A6d4f+s9UPSx2MDciKwyJOMkqynkx8pP+eg6scYmUqU0x7tFWA/T+vHtJ5OS53GpxFOQuwUWcePB8zkSuD8I9W+Nj6O882228e5jifEeN6BjdQ4RhmcyEtXWrc1fvAurb+l9UsBJ7mU6Thiouqd8H69t70LKrLZWnvpcpayW8A+m1z5ZGne5YK/jZrp39P65YCP3PNuxK63MpadVu+tlOmx3GRAHo3V+9JUPoCNS87fi5m4NOf9OHv24sejrBRNBLcEXPQG7yaHXk8MqPmAjazl3kBsTOUlKoLP+7CY2XhlD8z2ZwLUu8UUPgVQ95YArMc0oI+reuOwzdlEkWdQt0pS/5N5YL9P6xuFoSDvNcuvD2r9A603Bhz0Krijw1pnaKHrY5EZGoyjJ6QsmyQpk80ksPE5r9L6CzJ/kr84lhpn9G9q/aKEyrxeFkXOPa1MmC/tYFc1uke1bu6Cge3YB6KF60OWW0n6uFtY8N/Vem047n0hZWVCe1PijG1TxlxHKolxj5JzdxTcnXAeEcP8CCMhY022QSr2o1r/PRzvvhK0ncFyb5PGJUrciAl0kzKp+mOduox34ixBYuU5Mr951lpunJFfE1N2OhWOdV86lEd4W0wBCIx3iXx7OAsWG2ca6ql/RrxiGOd1ZBVvFVPQNB2OcQ+htbqkkeG2CGpY+TkNVU/cYebJCWJ6V5dtuJdjsZF8+SCpSM2z0nEaVf/3uDId52MBCn3vTE4o4EA1osSbw7yOfHvZa/mUlnFCIGN4gU9BnFPtqH7wPv0VHw7HNUgMDSVjnES1VlL7FGJAb2DE5PiyLLZ3Ai2qlNeIGbl7SDVyJfP1lazX+h8S+hODNEqFV+9Zyxac2DYEDuSQ1hOW6/+1Y7G3KcOZzWxmNe+SA16N5Mtf2GeWQ5iiKKAhCzJd7tiBQGz7MCMlUUrnuw0BIjU/3i7fXiqwEWz/Df2nUI7qp8xt6Ab1AlhWLszMC9KMb0+KoRprVfpqx2akg+mSn2wH2QVZGhd5rtZrPGbi3qIQ5gNiRiV0Zi+oRIP0DrhRMKVM+Lc0L0qi4tUWwMVPaPewL5XH/D4914ZOGKIca5rcK6YLJsAwyGIyw6t7zTGckWNHcX89Hc2om8DGYBs0D5TdPjeVUBrwIQzAmQjHLEiLgrl/4w6QxaG0sernNtJoLolctMqxN8Tc2vSuzUljN4yNYX9OTHd5kB6Q4zMr5rUjSmJDgDXvUm874meVqQpt3XlskTNgXvWFjsPo8mpER7Di1ofFe7EbxKx+qQnRkl4AdUxJlMmFrK8bSWcRKGXS8CeQtrTc5N0KFUEf27u4bVqfWk0DDuPKHguQCNJmlGQijpLM59mWmtja7ZbPuNJi0YYoikG9XRoXM7LT73GZwPTTz6501KLq/L1iIaCjF6IkpMbDjgGNnImu6+m/tVRztBjHPpFOI5Iu004NrXL40b9IqAXJvYxNrzq3m6RlHpmX01Mx0AH4jTXVGrAXs3Wv0GC+VOuUY5HtVQIUBWslXrfae6RaC8DsAakwtl11w38ONSkw/LdmucCGl/pmSR+fgD9yXBlrHaY2BemUlFkoZYEsXggwttqudW0a7mtGjfWnXCJmhEJNkvnHNsSHSAg6zL+elUxMxbHapcC5W5LDk5kMLY3Tdxu2uFaN6ymg+m+/LDJwp7AA9/45MYXhyimdtXKU3Do0DwRQd1qAqWPsi4zU/PXf13CUcdQOsJ+mwK85m22+MY9De5ld7RbWuxJ4d14Ftdiw2jYR2FDaqpIhl6WFgZ1ecP3T0rgSrnnV/D+q9Z8k1IME6aLVVqbjpqRS1rvh2IYRt0DO1zTUYxHRS8WE+GYJZ/vhKFu9P46E5ADW5Wpyf6AY0HJgIlfpWtDdrfaBQ0lsthtc+3gzrl1KoRkX67debvmzEyC3TiNqQkKhU85k//Hc1SBMEmfzwntMs9sFn1LXufFbwwb0f69TJqaYZpQxI+JbeTywrvUOkgtRjJBUiFPLsyOCdVDr2lapyKgya8VUHCttb3F2fEs/+FFe99ScBvdgn1GSp47nulpsgo7ikLOQE5lJfWrrgTQbXPLWE75akjFldSZCAg8+gznWM8GY5ADQ4z1R/gg6jMjciJOoSQIfyerBUwtxbAD6WWIKu8fF/SAVLzCKs+cbed9Tc8yTDpYC+HMgqM+eoGUelPmrJVgnckFgo2DutTGvaawLgSC9/gVJWsKkFwDeq+DeN95Txeqw2tNcHbjqIbNGQ7xvPrATEL9IksXhledg4qy5Iwqz9zItT4z3ZPdFmZGPzd6iNpHDNEri1SyVnFsMljyNnmjkLQiPstSv9lpGZpa7YijQkiwLqv1gteea5F2KdDAPpTmPsNIvlyQmqLy4yz3RKi/63m2A5x3ce8d6uldumkGLDXU60piw0XQkOpRmsU/Reqo4YT6nkg/xwltUj0dDZvQFb3ggADqzVtsM2dkkTqaR2K5IMqJB+cC+XDVmeGzUsEgT/x0JtSHZA/XRvulo5krAkV/7b3cARhCPOIxDO4bGNJ8To95M4FEehFHJ92A/7D1YbatBMiUoFQFjsMMs7cyRpHZPaZriPAGLvUXfOV8aa6uVUyOyM+qhMF+vyJ6jfddNgXD0NGlHJYVnr1Mex4aZf7o0Nn5bQY/ZTf3IQaa11V6TQc79+NG+bQ+qxMbXqTb1cIlGYByxso2KXCZJX2PN4S5FbbZ3Skrwu19kSl+nRgYlSFZ4toonQpVpkN1y6oKYUSJr6sAWs3D7mVoPejWvGuQR3nBbP+/NKZKwkcHVv249dqTvmznnCFyYm5o3OSEu1FMcXw3n8SKtR8xGSWWg1iKdxg3BWADgUQB1BoCtcVrxxkrbA1Piar8RLXZ0Fk25W7FsV3jC+jFHw/40MqnBPbrClvvRwwHQnsWukDL7PLtES47bsn0A61x20ujYmzDpeyXEr4NkiWeb1LordZ6trXjd3Yf53iEmPqi8D4DJvy/sy0aZmI1k7dDKnOu7DgVrncYKo6gezXMpCR6vsTgueNEQd61rWPLJsB/TwR1AvXq7X2Oz6PBsOyUqXtgL7Y2K5rvGjZRS9dwNSDiW3Tgc9mNzcHcL4AHUCwrYxYw1yl7PLij1WmuxN6fw6Cqt+L6wH1dWAqgXFfQHTCkzCsS12IXYT1QybJt5Zxxg26o+xAoPR8axDOn0FmhJJ3j3IwHUrUgkycoakcOzlRMdiUqel2kLoNCVsIumPUgLguUt1g2rAOruC0ag1cgq3CkKNhiCHVksxeWqqj4Ax06QhxUHqMPQySXIMQ3u9cMhOtptYHtgjpRrzU3Ir4qex2pjK1n8BgB9v3jF20E6D+6dB4OlbkNgeAfrlKQx5BeviFBSCce2ZwBa3uFQPhGA3Z6Ma3BvaAHcAdTLiIyoeaMY7F3Q6wH8B++y5jqQ+t6c/n+tLDJcO0j7svNAAPVyHEhlghpFj2lgp2I832ApdhBVMouYbzrA54K0KXaxoo1r5lvuhwKolytY5rM+go8Oo30cr8VesAB25vmBnKPB4HFpYw3rIOkAD6DuLBVRps8xmS9iFmLCP5DASkk1VvVZwz6iNxsO/LqzEkDdMZnzkakSf7DOsQe5od0UnHt/3BwZpCNydCqSA8fDxa+DgnoQpNaHPOMLzj0Vc2w+rTzPEvQkFEB1UMKlr6NSIojrUTtvSY+5kkomPNl9D2qyTZmxwUGWSz/2N9KPjSMB4p2gIij3UE7DgSRp9Xh4pUV+ZV7xtorXogkSOHUmL4BcwbcgjTMmoeiwGYLFHowfqIYikqcUV0AN0uEoiebbaSHAIEsSO1K46FE9ABsJx1qJQ92V82JVLNjNG8PqLZ0G93QkGwK4lyNRZHpyay7PpnGOK1ZL3rBJu7e3Kq+zJsjSJGQWuwdqMcOdIvE61fmwGKG6T8ya1f7Sd/h/W8Nbg3QU0ONM3ATLvXR+LRyMo5LWxnqoGrsWoLezGKYdU44NMXLhdBX2ecvy4zYLmgDwUOq6ZBmiNpSwOiG/GaTUZ5iKVExR2lu8cV3Yh0EyJgWPftTXWXcmBccWe4x0RDnoHxXT6Atgh3j2IrLc7hfUcEPWDQXL3RIViRomrtZ5NqkJBsTHHLs+gsHpHcObEO4Lk6K7DGpXjnewf7KXga0RbPMvNS9jbuPaFUyo3Crzx5ghG3lW2L0LS+goXx1+rZJ0ukhj3yMMcVytWiLVsPFA26UOUo41aU7XejDsy5UF9EpOm8qh2KWmax64hfQ5nrZa4troz5LGMWfYcFpv9Gx9+/2wL1deAribih1vFmcdvchdfeUObLRb60XCRI2z4bFARxplpSefBnCnygalGtZ7dNvCjisusosNDmHm8DzP07yGQqgQGVllyw3JwuD5LEhk6kQGJFm6saAcS20NNJzHI3Qeh2mw7QZDcWQEGUiRh/reWofB61mQgdhiJ/VLLsfGAZpw+cpTNN+jsVfZuPwBVmLa2u/AzsJqAnZFhT633Eijr3MA7S8UNl7n2Pr/XazwcxGt6Exu0XqyhPkiQbIhJ0hjfQhn98U30+Isi46y1d1ckGaTNLbX4I2b9X+n0ZpP9OOefDxjFKTPLTfLPKI5byGwiBb7iGu+AdhdYtZ6FI9n4x7WqFnfb8DO+nqKAPiagb4D9haZnw23qfTxyMFtgSOg7lJmKTED6mSSNsz7M/TdTd6A7Z7WPl4kNOMBkZhf24HvSfFTsmbSjGuxIbeJcpbrSJCP9OSptOY7JczKzpRM03YN94flXkfm4ALd0hD0P477nmTs+CszhBKmvua9eVRMBvKmXgf2nrF8WuoZDfDhUs/b602S1GDbFhgLbjCNI+7mJSfTeLvWtwvKWFVDBGRG83QAeyPNfc/J3rEwzCYHNGQLWYWd12elSP+vYZZ7wSGX3xKsFKZsY29kFW+AA7lDwiy/7FrtSk//PAxO3aySxZTcxAyAfdB3KktJ1ETu1HrICaGIEyVB/PAcrd8TEwQPkmFwD/UeLTlF64gDZpeGIHZ9xMNsQzHJJOnIC8Rf/dRcAkBHTlI9BOx946FbORfW2vh+bn2Ia32txW6QghfquokLQNqRrLaLDIP+ztT6jEBHsi+zvUVLIlrsiqUhTo8jqPOTkjImpOAFcW/RetBp7LWKXYWaked4IZdcW+teBze0B/IKYAmDNLZWYydQGbCPS0oLY8m7FGPB0nu0Po+m312KukQ6soNcO5fy1PEoVL3kR2B4T3doiDvKTPjcnrQxIb6bASDfAgDrjeEwunFr3D8RoK/lENj9Op96Th/6gfyu1rme/Npd09Hl3k9Kk4bzgnLW6KDeowxvidwrgjIlgxiC+2Ixxd5BciLl/E5fPNnDWuSqMgyjmm7q58tu0pEpJ25orwLY/hx973l5IWgHtaU+GFYTyKOATZzhgdk6jwVmGg82O/RpwMbAvzuYYh+sW2xjzTF7BHznlU3eGyTDVttqTgRtiSi+qzUkZsydmtbDssDK0aUmftTDsNoaxOfL/GmsSKtfokxn+w+zulcOTQQrvRg1KWXZNEUxvqqSeIxu0VMhZhYLBAHSODb0qEKK3ZwRLs/GHVh0OJFXioQFmIJ0iVuruPjOLXayt3Aan5JFGsybJV8RRkGN9oNiUukzjsU2dEXJpfr2dmWylZkRrNAVpsTmWgBcJALRXJ42FAeHd1e0yOz2hS5GAPfX+eEFh2dDZ+mxvlJCJjK3UqklmjFufbJLSlyOrRXc+tBicYPCQi9q+T8N4ke0grK4L8Xrf+g7L9e3ZwZHsjdAnoVAlphK0iHa0Ei5rNtYc6wYPbvY71kMkHu1fpMOo38SqHiRUyVXCQZbrvIeAQWBBsk3t9aH8hRvtejIATVCfE+08kGl2uJ89EatF2u9QlRjo4EyBd5Ivz+k7395JVPVdqa0S/yD5FoG6M/Zhb0STm0OMMC+J4rMCLPFLfbi1vBRrTdwTb3Iu2zgkoAIyRvEjGgIkmOp1hJtEi3rmmrZLqaKL06fY7wCX7PhPQQwdrb6ea1wY6TS/0cZq9wAeYcHIULyUnHW3QsSZAmCtPkO+nJuVMuNiPxYlrAQQatOH+LZ/wWOwxLCZGFIU7GNdWxer1A8xTBKtzVId6WmEl0BOVeDeZM4052cWxjLMQK7ZSm0AiIC+RaFWdkmcK6S3sj4BIsbEfTDtwa+G2SJgjr/s8UrcHLADSuNfMqSJiQUlhB52K/1SwoD4ROubXEM/KPz5mWxk2kcgSBBFhNY4+eKGavgj/0AuIpc/Gv3Uj94KW2fIPU/0Hq91svpvVYdcGNoCb7g1Von9ZM/6GQGcLrsREHCZWHFaUkdcR2KqPJjnimmUbwmSczaXYwU0ZF72zncS0qskJZcq+CdciSaF11HOBDFK2/lWRgkSDMBp76AVjlyOmMSGqLiQqf97eQ1Cm04bA/qN37R9p15H1mhc/kSff9FtOpBgsxjChojz1fJSAULZDvQpsCy1PukzTRFOxMoQOJv1norrLMyn6GcL2frvK8RM1D+1laoQ7nWeI2rj3xVIQGTJVkODYwSDoI1jzCeetYrSRUnMgKHcbLdv9VujQccyM8o1G0rWe+E/Wxpq42SvJkcKkgQK2dqgOzQOscrfuQ5jGuUGWu9ezl/pKCQZVqqGvTegygJ6UfBayEDc0Gm6EL94J3SeMkJ0r8CI3gJ/S8LZHGibDZm/QNZ5oV6OVV5iC9+U5koSdW9UjmZTVCT14spbw0NwP0tA/S7NjpOmW+xgaPvSAcWGVhuuSm+3yf1fw9oHXUmSNlvPsfJUshKvkpJks2qUiuaW1dqoSqvxwU4u0If7lNVkhZPO+iPaN3TqT+4XHlU6+c1iPfFI6eSs9H6GTj7UDwOSnJOOMZ9J0U6i0/nVT7y/UlSEyzJeJdrMZejhapjPdvRmkHwd/TNp1U8Szv+Icqz6vgBm7W+V+sF4Vj3mbNoRuOV0oIkkqzPeIu00ECwkhZb+IW+JmbVgylJQoBuO9mkVoAayZtnhuPdF7KdvLrkgDlycIf7yC7eTostWQO2MAryKa03o1LLKz+0VwisE3KR1vdI6HDvB1C/hFSkmsKrLTp+JCa0p7IKbMhjGsyf1bf30guOvEhJjT8UFvu3xVR1Bek9QcPA5eTOaYAFLhACRv/ind3yVjste/Uv+YAyt5GaP0ywRicCl6i3iZneGqR3BB1VrxCp11e7FMTtXwSob5Quldd3q7scFvs/xUzDXOtffpSKKlo1545wVv+yJEsJB8m/o/iTPOYVmV9fbUF+QExZRrlbX6Tgdkp0Qh3TfIPWj2sd0wAuaVVY85rrXlvLrci5/5i0JLSW5VcQzruCoK5Jepy6wEADkjBj3fwy3bSSLICKPk6Pd0gaeyVtnRPazjBQ/lf0oxeKCvXWORTkJ6706Id4DuMQjzWGMO3r9hfq9vpS+JH/LWau9pvErBU55/34Ch9hUMq7uAOuD1jJheBYXUgtOvTD7V2091Gr/22t+1fii60Ur/0SaYkpaU1SRMpZSwRM5kStv6RfuUpCVWDWBUBGQRNauwabWGmLMVhqlDnvWakvt1IrAk7GZ6tpHXuLMin2mRTrDmuO5RmwQjDWcP+KLLN8MUhXBFnkl5JXzzqRDd9KlwjqGxgFkV4DNgQFUV/l34TnfK6kZ5uOK1MJ+BKtWFjnc9KlWGeQtvCyXcwcmc00Tm5IT3lW+wijH4+vxhddSUEG6gvkWaAcaL0vq+SMN2e6meaKHXOeMovrXKv1tm570kEWFRQzYaQdDE/Zscw+oIs0WresBqhXA9hWblUmlvmHYorPh8WZG+HsJVzG0EL0TjqX18kSB6cE6Ygftk3rZVqfVnf4GwHt1lQj47yXAYDx1fzSqyU79W55v9a7xUT4Br1ZJVbGaSGwWtm7tb4mxUEJ0j3ZQT59hswfxOUnX3BFfkDr/8oqL02+4hZbNfrOj+gnPsGFnK6RJBPVsPNUEiLcrv//WTG1JteS0swG7HUFF6cx6nE2LXR5ke1hJNHShUq9qSz8gNUUABjB+k9rPaT1HWI6bmxFmOLZYM8HAByhpRdwhyPYf4eY1H2QzkhELo2FtTZKY/SqGZ+29dQPZunMzILAGnyNa/e9WhDwV/W5bb7Bn+HOhFP5dmUaF77NyMl0wGXbYMYYaNR6PJecuuI4iNKEUwsN03dXy0nMOrANP1NxDQEcDzT/Xk2rXfNYTKQSax7xQMCxREEVVjr7YaAnSxbkFS4WE8obkSQ2HaUwSBufxi0G2iDxcjyLXEoyBW6Rx7R+UkxjJ3j3MOPaM9K4DLbd4VO0Ns/Xeo72Qu/gzt4tHeh27mHBPkUS7DwxOYUSLXQlxSq7aXIAHhGt74tpEqhk1UnIotjRDgDnVeR7iHkfS3VIVT1UuE5MYuc8nhg38QCEsqpEBgjoZ9NCr6NBqSxCVQaIF4RbkVPYk+UfWcryl9N7c5dG5EfFhPownwSdGRUN5KpnucVxLm3j8In06sG9QXF20kHtZ9lBQCOju16SFeB8q6xSnPwnGfW4Ny9hnSyLpRrXaTDjsvdGHpyTJQkBKo8HWk4Onojhh4igYALsfjo5PyLI+0GGuK+eTrpxGoE8QwutFrDQESNQVe6z7+Up+lTK0UECLYH1vox8+nLn8lnxzwbn+TL5JC67Z+sXMRcOyQMs84coDB4XpHdWAMFv3cDIxpkE9lr+xskUR1A1sdYwDI9qvVtymO0t5ez72kmvD4kZrgL+vUEZ53EmJYJiI+BVxzk9g9texksrHCE4nAfFJIoqOTyGQ+TKW8ift5GOrZVkdFhNmtd2KId/D5Ky3cn9fDSPZ3cpp1YJYLxBmaTAW0g1dtDKDLCIKo3W4L9ZWq8xXp5R/3ARIyj386DewYP8eEZ//wh1PX2JrfQ/NhPg1gjUmvgivrW2LVvYrw/zhJ+UHEspx9+9xoP3GVKMcxkR2UTLNeaAOe2yq5yDV+T7Xk5gX8XL75N8fJ8TEajx/kpa9kECeDNpxibqZt4O0SrPSRLDV4tEORR/d5G/8QFy6f29EEWK3vCx7lJL27xbb3ZMsaN13qCamNlFXuODYVqxFynj+V/Ky6hd6dWlKf4INtcBLRAkw7yPzwDVQeLoMMFzPwHxFK36CQTHFC//E54TVnMu9WWPD087jt5mSaZoraUVBrXYyN9haccov9ucuKUH6b/NGgH7PYr8HlV+Z/yWB2WFWrYCsJcObPfuKYwAXElQbJckm1ZtAuhmtxYQdgDQFC/30+TlAOM+OqKjvJwfoWUdI3g2ElDH+PdP4mfNEqzbeCLNcbsNvOrg/nEHkOKdpGlgrqXsFUs3yvy8J8mfH8yhT9HzVGQh2UdFiAoDEZ+h9YUE3noCaE7SY7bNwoc2CWSHKBZIDwCW0xlSm+TtCEFcJkjnJCm/HeX7Z2iViwT4nCTLCJZ5AjU2PS9OLXzKZb9/hX9zD+nUXgK82qtxzl4Ftit3kyPfSIBfyNutTihwepFwX9pIAdf6zznAL0tSi1ySpI5iDbc/5tCSGc/izrUAWGlyQrpSlKTf8AmCeTfpRrkPjnlfANtauwPU2xhB2cKQ3yijIzMEWy3FmkdNuOtC4Fcp3DdKOYH8BtjFHLe0CjtFKjPEE+kRgnknf3PfSUn6UxDS2kWQbyfIz2PoD5b1TDqKIwTirONULgboZiE11QS8C50kabXP9kStOrz/EGnGw9Qp6XMp9fFvt5z1Ueo9fO58RiCeQ2BvoXM3Sb4cka/a6EXFoyfLcuYlabKwYcVB3p8gYOdIJw6RZuwiZw4SgL0g0O/j7V0Emm2NOocRkGE+N8v7J9G6lxgtmeL2owTgLMFZcCIzw5I0TUR0Ii03t7x/iMDdx+jKDF8/QnoxGQ5ZAHa7onhpF1pGIbinGF05g5zWteob6ZiOE9Anc5sJvgegPkjHbg3/xgFuX6WOk1pM8DOiQC+WJv8vwAC3plLl62w9wwAAAABJRU5ErkJggg==');</span></span><br><span class="line"><span class="string">                  background-size: 100% 100%;</span></span><br><span class="line"><span class="string">                  position: absolute;</span></span><br><span class="line"><span class="string">                  top: 0.2rem;</span></span><br><span class="line"><span class="string">                  left: 0.2rem;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                #loading-earth .loading-inner strong &#123;</span></span><br><span class="line"><span class="string">                  display: inline-block;</span></span><br><span class="line"><span class="string">                  width: 4.4rem;</span></span><br><span class="line"><span class="string">                  height: 4.4rem;</span></span><br><span class="line"><span class="string">                  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOwAAADsCAYAAAB300oUAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUIwQTYzQUE3QzY1MTFFOUI2MTBCNUY1MUM1NkE0N0IiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUIwQTYzQTk3QzY1MTFFOUI2MTBCNUY1MUM1NkE0N0IiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTNDMUY2RDY2OTc3MTFFOUExOEY4RENGRjlFNzIwMzEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTNDMUY2RDc2OTc3MTFFOUExOEY4RENGRjlFNzIwMzEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz51xfIrAAAF60lEQVR42uzdSWjcZRjA4X8ad6stqFhFakGwntxRDLhdVEypWq0ogqi4IS1oDx6stVq3HvRgUQQ9CFJBQVFMcxEX0IitDTaC9CBaEKQIIq11K5JhfD/mkybTmUlmMpNMkueBl2QmM2n40l//yyztKZfLBTA7LLAEIFhAsCBYQLCAYEGwgGABwYJgga53hCWY3zYOlsZePDZma8yNMdtjVsfsbXT/p/p7LaItLDNkbcyq/PeiL+Z5SyJYutfSqsu3xpxkWQRLd/q26vIxMXdaFsHSnXbWuO7+mB5LI1i6z3cxf1ddd07M5ZZGsHSf0ZiRGtc/YGkESwdtHCydH9PXpt3im2NOtqqCpTOxnhYfdsQMxeeXtiHYowsnnwRLx6St4VFF5WTRuibv+3Wd6518EiwdMvYZbKtiK7u0ifv+ELOvxvXLY660tIKl/Y6vindtE/dNb6M53GAri2DpsHtjK7twisexiZNPgmUaLI65u4nb19vCpuPiuyynYOm8dbGVXTTJ2+5o8LX7CiefZoyX181ND9a4blnMvoh2T3zcVVSeIDGSP69+Cd3ePKfX+D5nx1wd86llFixTFEGmXdY76nw5bRnPynPLmOt/qQp4JO8Wr2ywlRWsYGmDNS3cZ0nMdXkmI71m9pSYXy339Orxn2HNLU8Mlg7EhxOm4Y/aHfNJPt79alN/7x6rL1iaizW9xcvvMUfWuclfxfjHaNspbW23/x9wzM6I+A+/FcFSL9htpXRs+VqdL6c3b7oqH6+mXd9risrJo4Ud+nFKeSv8UcwHm1b0DvkNCZZDsS7IgSyv8eW0m/xQRPNW1X3S46p9Od4U8XlF5x7qSyey1sTP8KXflmAFu610Q9qSjbnqnZi3Y/6NGYpQDtS539iL6UTStTEvxyzqwI+Z/rDV8bO87zfWGmeJ54jy+GcyvRTzyNMresuTuF/1ceiSDsWapPdEfXXDttJA/GyjfmuCnc+G8tbx2YjhmRa/Rzqm3TzBbdIreUbz1rgVp+Z/EH7zK7NLTJM2HNolPiPmmwlC/Ckf735fVJ58cVnMJfk4+Nyi/tnpccey8Q/KBVbeFpbWpZNP704Q6+68Bf85X/4xTcS3NYefHlK6eEzAF8WcWbX3/XnMPZZbsEzNlphGbyWT3oXi+ka7sRHuP/Hhizwv5ogX52Pi49LWOW5jN1iwTEUcEaWTVY3eFfHjmJti/mz2e0eg++PDfqvcPl5eN489PlC6MD680uAmaTe5v5VYESztjTX9nznvFZX/sa6W12NuKyqP4yJYZjDW9HhoetbTsjo32Zx3k0tWyzEsM33cWhRPFpUzvjW+VDwa84JVEixdYP1AKb0ofX2NL6WtaXrxwBtWSbB0R6xpF/jN4vD3ZDoYc3sx/rnICJYZ9nBx+POE02tW0wsHPrM8gqW7Dl4PVl2TnuyfnhAxbHFmB2eJ51WvxZaYXeXK5yMxV8QM58stDdPLk//nocc+LJ343MrK62Pj8yl9r/g+FlSwgF1iECwgWECwIFhAsIBgQbCAYAHBgmABwQKCBcECggUEC4IFBAsIFgQLCBYEawlAsIBgQbCAYAHBgmABwQKCBcECggUEC4IFBAsIFgQLCBYQLAgWECwgWBAsIFhAsCBYQLCAYEGwgGABwYJgAcECggXBAoIFBAuCBQQLCBYECwgWECwIFhAsIFgQLCBYQLAgWECwgGBBsIBgAcGCYAHBAoIFwQKCBQQLggUECwgWBAsIFhAsCBYQLCBYECwgWECwIFhAsIBgQbCAYAHBgmABwQKCBcECggUEC4IFBAuCtQQgWECwIFhAsIBgQbCAYAHBgmABwQKCBcECggUEC4IFBAsIFgQLCBYQLAgWECwgWBAsIFhAsCBYQLCAYEGwgGABwYJgAcECggXBAoIFBAuCBQQLCBYECwgWECwIFhAsIFgQLCBYQLAgWECwgGBBsIBgAcGCYAHBAoIFwQKCBQQLggUECwgWBAsIFhAsCBYQLCBYECwgWECwIFhAsIBgYRb6T4ABADPjFV4w9RfGAAAAAElFTkSuQmCC');</span></span><br><span class="line"><span class="string">                  background-size: 100% 100%;</span></span><br><span class="line"><span class="string">                  position: absolute;</span></span><br><span class="line"><span class="string">                  top: -0.2rem;</span></span><br><span class="line"><span class="string">                  left: -0.2rem;</span></span><br><span class="line"><span class="string">                  /* transform: rotateZ(10deg); */</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                #loading-earth .loading-inner em &#123;</span></span><br><span class="line"><span class="string">                  display: inline-block;</span></span><br><span class="line"><span class="string">                  width: 2.4rem;</span></span><br><span class="line"><span class="string">                  height: 2.4rem;</span></span><br><span class="line"><span class="string">                  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABxCAYAAADifkzQAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDEzMkZFRjg3QzY1MTFFOUExOTVEOEFCMTlCNUY3NjUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDEzMkZFRjc3QzY1MTFFOUExOTVEOEFCMTlCNUY3NjUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QkNCNTcyQTZGRjc1MTFFODhDMkFBOUYyRUM3RDc4QTYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QkNCNTcyQTdGRjc1MTFFODhDMkFBOUYyRUM3RDc4QTYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6mADWiAAAVBklEQVR42uxdC7xVY9p/z6UT1dE9FZEuKmRGNalIQjGjOwYpiiKEMJMyJpNGM5/cPmEwPo5BSkwXJZQMFU0zocjUJLmk0v1yQtfzPX/7v7N6z7PWXnuftfdeqzy/3/9X51lrr8v7rPd9n9v7vDkjpu0xEaXaguaCJoL6xJGC6kQ5QaEgX7BbUCzAy24VrBOsEXxOLBN8JFgbtUYYeX7eDy8YBcJzthWcITiVqJXE7yHQqvx/TUEjl/PWCxYI5gjmCeZT8KFvnLBSFUE34hxB5QzcEwI+nzDstbME0wSTBVvC2FC5IXse9JgeglcE3wieEVyQIQFqVJn3f5rPg+e6iM/5U0+0qK7gesGAJIdJm3YINhJbraEQDX8E58saggpJXrtA0IVYR8E+JFh9qAvxeMHvBJewkfzSWs5XUEY+FiwXfCHYlMQ1MEc2EDQUnEwlqRU/qESED+02wc2CFwR/Fiw91IR4jGCUoLfPZ9ggeEMwUzBb8GUAz7BZsJB40cGHUNsLzhN0ElRL0DuvEPQRjIOyKFhxsAsRKv8wfsGHJzgXvWq84GXB24K9GXrGFUQR2wca8aWCXh4CzRP0FVwsGCu4S7DtYFRsoCD8R3B7AgG+Jfi1Y56cnUEB2rSH9x/I5+lN88OrZ97KofXig0mItaievyQ4yqOxnhP8THCWYKJgZ8g0552c/9AzTxFM8Pi46nAUmUqnRKSF2J3KR3eX4/sEzwqacjhaHBHnw4dUxppRmCUu53XlO3WOohChzt8vmORhMvyD2uDl2VAGAqLlFGZLj2EWDoQZnCfzoiJECO1NKi85LubBZYKOgg/MwUF4jw4cTda5tPPvOd8fFXYhNqf91t7l+GSeM84cfFTCef0kDrEatWf7nBCoEEt49wBwpmCu4Djl2A7B1YKegg0B3tMLlXjPiYJ5gkcFDTNw3/WCSwR9BNuU40cL5gjaBnG/WE8M5sm7C2YIjlCOfShoIfiryZD0BL8SLBU8LrhQ0E5wreATwQhBuQw8w/OCVoJFyrFqglmCLkFIMYjhtBc9Hocpx17hEPLfDA5rPThsH+Vix43knF0zQ4rPaTSvbKpAxa9PtofTroIXBAXKsQc4fBZnrgOauoKnBeUSnNeeQ2zNDDwTppJfC0Yrx/IFRYKLyjacpk4daNDajuu99LTckgVPC5zpVXye21jwvIsGnQ6lB892I21j22UHhahL6j1RLp8CmgumCCpY/L2CKwWPpnjdsuBwQR+Fj+dpIVisHOskGJjBZxwrGMB2cvILBBMEJyd7zVR7IuaSv5vSgVpc8krB37Kk4p9uYvFCJ00xsbgf7Li2nCttGm1iMcZMEZ5njMscOV1wdLrnxDzBeEEj5dhgwd8yOP/ZaKHwnM/zraCv4FPrnOqC32fg+Y5gG/1bMMzlHJgfL7roGIHNiaPooLYJQdFHs2xsN1N471t/F3O+tmlQKj3AJx1HF+RXJhamapngfIwYDyZzg/ySEt/nwok7TOEj4nB7CDwmtRTn+lfKeW/Q9Onq4JUXDBH8JsDnOYb+0j4p+EyvNbEQ2EtBut2qcSy3Nbklgn4eXvxMUqH193YP7fgORUvsb4JJgEL+zn20ja9IIEC0279oT9r0uF8/q9858SHaYE7edsEFnGtMxLBY8LrFq1ZGV1iOoJ9gmeAWQXmPc1cIRtBF2VrQTbGn8Tx/CcrtBhfWZQr/RsGyEElmu/V3hQTnj1d4J6d479qCVwVP06WmnbNPMFXQUdBYMErwBY/BRXid8puugosTut0SPN9hgrEK/2V6GsLUu6pZf8NrU8Pj/EUKr0kK9+3Ann2ey/E9gid47e6Cf8RNPAvPCiYp/Aep2br3xAQP+FtBA4u3SXBdyAR4peBUhb/X4zdfKrwjk7zvVYKZHu47CKW54BrFtNEwSIny1PYygRINp0cKfqvwwVsXIgkWCu5V+FMEmz1+V6zwDkvivjczMqNFRJYI2gt6caj0e02063CFf4OgYSrDKaRfaPEW0MEcpl54raCqxVsp6J/gd00V3sYk7nk/lRknH8PkPYKWjK2m8j7/J5hv8aAk3enWE93sRKi2AxR1eEhIzAkn9VN4g00sOdiLeiu8RT7udy6Ndpu28ZrTA3CWI3jwrvK8fzKxtE/bTswxCoYKylu8qYL3XM7PFmoKmlm8DwWvJvid2JQ5Ay0eOtYUH/crEuRZ/LWCDoLpAb0X2nmSxcM9h5U+Vx9OqwgGWrx9tGvCZu8dq/Be9/G72+gzdfLe4TDs9buHqWg4eVsFnQUfBvxuIxQtFmkfR/kZTjGM2hnaSLkLY05oocJLNIzC9zvUxf/rRa1NbFmbHTvF+smP0vBuH9M92M3KTEBM8jYvt1uui4N4rAknfaPwWnic34UNY7vXsNbjtQT3Gqq4He8RvJPG9/uTiw5Q4OUAP9PE1r476RM6jcNIy+gjdfbIHoxoOBUALA+4lc5oWxC7+HUn8od2s3ibXBo5SJrPSEwLy9HfnYEHCvHAH12hXOgvIdRIncMZAr19rSFnChsAaxBPSeBIvsnHVNFR6b2P8ANKNyHE96QpLaeJ2nCKcExP62SsvC0y4aYxSkSiMQXbJYEA/yB4zMc9TlN4kzP0fhMoByd1Mj8Wkjggx6azoNDK4ZgqKM5Cvkwy+EhwX5K/+Z65NSN9nn+i9Tfa5IMMvV8x85nsnJyeJYrHpoei5k6ISGhpuGCqj/P20nkPf+aTSVzf9qmudnFipwvjFd75molhL78qDrFCo82NWNT5v5wvyjuObeWch3fBMrovArhfpquOoAzLd5bpdzbn6d3xh8ECDzvH5C3+MCr0veAaQUUTy0Q4klor8lCxMPSPZRCgXSEDxYyOy+C7QQ6zLR6yDds458QOylg8K+RzoRuQ07lZsC7A+fxNhXd5ht4HMhosaK8cO905J7ZWxtw5EUy7SBdeVubAwUqUJ2jUojtwrEtg+DSnENsq+TOLfhLefnwmeMPi1XBZXxEUalKAp3mc0zIeFD6cOR/Oox8wJ+QnCf6IexTe9YIBabhXnmCCoEmi3J7rJ+yrnMvgqB3N+OAnmZXCbMFkJcPtCQaIawYc6O7oM92kCSbNE5QJc2mGlZGKguFUIOYKHuEimLApTYOpMDl5OYKbBWsF/xUsEIwS5JdhYdAdCv9dwTCF3wS+U62WWSYXhaK+2uvmwBqkmLCRWv+wiWVl7w6JGfM1w1EzTeklfbl094F+Ifg2RQd5P5pHTlpFB7y2VKEpemJtRbqfZXA52gxBIxfV+ka6/gpC1BvfEXQVbEtw3jkpXl9bnnebYKNgpXKsMb4ebdnzmgx92ciFOT7BOSiU91TIHAvw/qAy4zSPc9ancN1acQPe6oXjHXKxR6U6GLfrWEyEV+rQu5HOEFSBHaEm7VPcWqh7M49hsTihhHQ7EyvX9bmJJRZlsjIw2qcrI/43mNJr7z9N4ZrtlHef6IjS7OPH4ZwCa2JOtFcTwVW1kuGPpQy8IgsMCzX/FWBDIUxkL+6EoK5imKepEnLaTLfaAOWL3cnf3cVAdqYINcP/rggxlXKeWlbCW9bfGywhVkNPrO9yQTRWSyKe3ldCwc6jL29WisMGJv4nFP69/Gg68YOpbT3PCx7XLE8neE8KcnQGg9k1FF4qpTIbKrxFCa5bkOxKYdhFzQQDBOMEa+ieG6wk8Lp5If7MyhV2ttkWh1dklaA3s+yStbGwyvaPXCuSkyEbMl/hbU/hOnWUdRxfWbzvrb8r5v9QQCh1wtq704n/4ZyFVIJNDJsU0oRozvH+bCtM5KQRVMudw8hIIhVC4b/ljF6km/IC6ol25Y9NymhilxDNly8oZ7c5MH8E2tAczkmwSw7z+QAoHHArkSxhObSWUYdh8TMTSye00yzWMbViEWOh/RXbbQTnq3TPkdpi1sIUrpOvhNc0hdBJezAMfGsOrISxzjEH5tOAbcF5DJpYKxPclgL4gG6ytE6bnqOKfQYdAns5L//T/FhtH4JC4tKrVly0HHtirzQLcWtAQrQ/Bm2UtHOCd0Cx2WUxKzmlbGKpf8Dzjoug1Bc2APmVcd/tJRG9xl7rp5fEyzjP9jjnIyo1/7TUdKT3HWOCKf7uN2gMOjaF62xWRrcca0i1hbgrl+sNnRNl5QST73dUQG4SNBa08pnfYjhJP8JyJb8UfBKwgoHyIs9ZvNyylN3yic8V3okpXKe6oqRVTHDOJvRE2B1NnMYjh1G/eyQt5Nd+Ln2etdgT9tKm3MR5bVGKBnCy9CiVGifBKJ9Bn2Se46v/zCRO+/dr+OM9ndX6Oyq9yItOpxfISTC3ihWvzgGeoXxlKMjly36d5Iu8TmSbFvDZnYoQ6tAt8RgKX6OjYLopncPqhyCouebALPF6JrbH1Uyf2u29Cr/I+ruqKb2zzho4mZcrTtX6Ec2vAUoEC5M4vy7rv01lDuu5Kd53ssK7x6fzfqjgVIu3Q/CkD7ksx3yx1Ocq2igh1bn2BMEMOiSSdRRMpMPCyfs5r9fI43dDBHcr/PuV9fvadZZiTlymxahMtAkrlYal+NscOuah3l+XxO+K6d+92+KfxbntTZpCS2haHU/b9kzlWnHb2KaTFN4y2ImaEE+JuBBn0IN0Iz0cC9l4q2nTleO8fxK9SJWUa6A0FxblJFM1EvPahUr75dIf3MnHNWDyXWJ5r+J0sibEnEuf+mEeX2M5m7dyEi0xBz/B7hpE71AlJWLQyMWYd6OjqcykMppBgMgcmOpyfJWlsK0d1z+nTq7DvrJtxaaHSALUdyx13UaZ02ooS98TYRVTQIuSdOB/zWXjbjZ3fXupd0lshNmf5TZP+dFZh1g22xJGZ7SCQ8leawtLsDRlSZTVHuduYNQFzoG3E9Qtt3nzfvCNckHNPKXrnkN/5KFEUDywD9TPLSUP6y5WpnC95VSShnP+bcHhFnPyejpA5ht/iWDnKby5Tq/5fI77Tkd4PGy08xASIj7pSZYQQS1TFGKcoHgsNqkXr8hVhLiVctvfE3dTBe5leeER4nnlEBJiQ1O6QoZbSCiTdIYpvQHn7HgPdq7Zn66EbC44yIUIbbQBe9r5dJvZYbbvXKabTJK2oeb+TDvnIlMMI4jrFVhCHKw4YaNoRgygY7wBDfpyLvahTQ8E5CRPlQpoe9qmyCTnWGscXv2Zypd6YcQFeB4NfWyn3orDUlWfAkR+6YgsPz8iRHYi1kznh2UnSj2jqLHXRNRkyGFprekuO8l5YR9LZndNUDM1E7ha4T3jVRYM9V+QnuGMWbUh5kesB8IFdkuSv9lIMwNbGnwSgnc4kVaCk9ZRTvspXxlri0zp2me/idiweoOHAOFcRhB3O4HSYlhA9G/abXtC9B5aKbIiymk/5fR4fJ/m+1thKTgltJ2isHEznMQLTOnUSKQQIinrmYj4hOFgWGZpy7toBq3ar41enaOWylyl1E3JCWmpTA1jlO0M1tA3WpTh+jNlwZ3KFoLjKR9f2wwhlmWnz8GGbBfyr7e1KV2PBx4nrPv4T4SmA7joLrN4e41LOU9RbNTtA/HCWPfgXCSCE5Hk2zbEw9EAhYc1Ge9HTCl7QNFXxrl9iF5rMf4g2GnxTuX2BWEdguy9KXbSVIiSaYRdf85R3mNkKlsqrBA8rPDHcLuFsL19TUE9i/e2YEuEJFhF8JDCf5jySGmHmrsEay1eVT97GGUBDRTewoj1wvuUPbm+oRxS3qFmG7OxbH7PFIOl6UQlhbc5QgLs6TJVDaEcyrThF4riTFP4DwqahagVdii8ihGRYD3udmPzp7lsTHaAFPN9qpmD6M2objnHXzaxtfPbQ6DRbVR4dSOgiZZnO1ZX3meQnwv4rduJtPiBCh/rF7H0LC8EjVHPpYHCTkiB+YXCH2h8LqVIZov2SYLHFH43weiQVHuyeXNDvuQAFaKuUviPsb3TskX7TS7RDDhqh2Txa4ZHxi5Cj4j8pBD3wMvpiLBpPtvZN+Un6XqJJ7e+Z0pXKoY3B2VT/prhxmjDId0o3v4NIRUgIkJPKRGKVWzfXclcLJVa1vE6Y3aaOR4Ia+ivzqCXH0u5UaChsnUMUe87QyzA5xU94lu266pkL5jMFu1OQmEirBd4yQpZ5VKQWIyC9RDxalXxPRwq85xC+gYr8vco7nA4/1+Rxwp5bmXrGjininFPr8AboRb4+hAK8HL2wDxlhLuE7Zo05ZfhgZAF15eO2TyrR44hskGjjGP3lhDR7Rw5cpToRF9ThqzC/DKGI16kGv9UGT+IIAiNgWzr+0JoB2J06qccQxbBlWzHlCmIhn+WcxC2w6mQpYaCooXUyrCFnOrRkNfsQMyByCedVtab5AcUGcSDdOK/VQNqAOSNbHUoKoZ/73N4NBZyGHovhMMnguhPKJ6Y+PvALHo3iBvlBxjdxQMh3RxFDNw22cIiz+H893vacjv5VSIlvZjD4jYTXapCc6u/h/cLubAfB3XDoLfLwYPBlzrH5Th8mfdSa53LnoTfIAPtK36hURYgzIclHgKcw/b5OMibpmPPI3xpWKd+t9HLiaBODpZQo8xm1JeVxwnbNL1Jrbiuy9RwN9vl66Bvnq6Nq6B13SH4pYe9djZ7Iuq2NYqo8BrQM7SIAtJoPdvhDpOmnNZ07z6GtQzIV3Xbez6HGhoSgJAPelJEhNecwkOhwCs8tPzpfP+07n6XiS3kVlMTu9TEUtDdTB14MxZzWLrIhC+MVMDnmsWeB+G5VZv8hu/bxejF+yInxDhh2GxCY3yXR888i8YvXh6xtg4me/FKtM+ZJlYvbhWf62zF6xKnXXy/pubHCvppp5xOY7OSQoo5EA7q3j4/pE3soRiWsKzrizQ+27E0lVBwsLPRt5zQFBc4tVFG5dNMNuQbg7MnxDghM+B2zovJFMJda2IFEt7nvxDql+T7JTgl6pvY2obmRGvjvZG0TbBt4akabbKUYR4GIcYJ7qkbOM/UKsN1dlKQm6kJbrGGxir0oACVynCfdVTExtK+zRpBiPkmHISGGEo1vDuVnM6mdL3rRFSew+GxaXjGXRzOYeNOMUkGbtNJYRGis6EmEhjuephYQQTU1KmchefZSm0UpsJkk921+5ERopPQYE8TeM42VDjace6qmYZ7wjDH2kb4gVGpcb4J16LTyAnR9gDNJeJUh8oISk4eR9TmnFqZZkk8kyAeEYmXtF7PuXMlgcWc8GeuMRGk/xdgANdUyy2mhZGIAAAAAElFTkSuQmCC');</span></span><br><span class="line"><span class="string">                  background-size: 100% 100%;</span></span><br><span class="line"><span class="string">                  position: absolute;</span></span><br><span class="line"><span class="string">                  top: 0.8rem;</span></span><br><span class="line"><span class="string">                  left: 0.8rem;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                #loading-earth .dong&#123;</span></span><br><span class="line"><span class="string">                  -webkit-animation:animations 2s linear infinite ;</span></span><br><span class="line"><span class="string">                  -moz-animation:animations 2s linear infinite ;</span></span><br><span class="line"><span class="string">                  -o-animation:animations 2s linear infinite ;</span></span><br><span class="line"><span class="string">                  -ms-animation:animations 2s linear infinite ;</span></span><br><span class="line"><span class="string">                  animation:animations 2s linear infinite ;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                @-webkit-keyframes animations&#123;</span></span><br><span class="line"><span class="string">                  0%&#123;-webkit-transform:rotateZ(0deg)&#125;</span></span><br><span class="line"><span class="string">                  10%&#123;-webkit-transform:rotateZ(36deg)&#125;</span></span><br><span class="line"><span class="string">                  20%&#123;-webkit-transform:rotateZ(72deg)&#125;</span></span><br><span class="line"><span class="string">                  30%&#123;-webkit-transform:rotateZ(108deg)&#125;</span></span><br><span class="line"><span class="string">                  40%&#123;-webkit-transform:rotateZ(144eg)&#125;</span></span><br><span class="line"><span class="string">                  50%&#123;-webkit-transform:rotateZ(180deg)&#125;</span></span><br><span class="line"><span class="string">                  60%&#123;-webkit-transform:rotateZ(216deg)&#125;</span></span><br><span class="line"><span class="string">                  70%&#123;-webkit-transform:rotateZ(252deg)&#125;</span></span><br><span class="line"><span class="string">                  80%&#123;-webkit-transform:rotateZ(288deg)&#125;</span></span><br><span class="line"><span class="string">                  90%&#123;-webkit-transform:rotateZ(324deg)&#125;</span></span><br><span class="line"><span class="string">                  100%&#123;-webkit-transform:rotateZ(360deg)&#125;</span></span><br><span class="line"><span class="string">                &#125;`</span></span><br><span class="line">  <span class="comment">// 创建div和style节点</span></span><br><span class="line">  <span class="keyword">var</span> nDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</span><br><span class="line">      nStyle = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span><br><span class="line">  <span class="comment">// 给div和style添加模板内容</span></span><br><span class="line">  nDiv.setAttribute(<span class="string">'id'</span>, <span class="string">'loading-earth'</span>);</span><br><span class="line">  nDiv.innerHTML = templateStr;</span><br><span class="line">  nStyle.setAttribute(<span class="string">'type'</span>, <span class="string">'text/css'</span>);</span><br><span class="line">  nStyle.innerHTML = cssStr;</span><br><span class="line">  <span class="comment">// 获取head， body节点元素</span></span><br><span class="line">  <span class="keyword">var</span> nBody = <span class="built_in">document</span>.body,</span><br><span class="line">      nHead = <span class="built_in">document</span>.head;</span><br><span class="line">  <span class="comment">// 添加这两个节点元素</span></span><br><span class="line">  nHead.appendChild(nStyle);</span><br><span class="line">  nBody.appendChild(nDiv);</span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js中的valueOf和toString</title>
      <link href="/2019/08/02/js%E4%B8%AD%E7%9A%84valueOf%E5%92%8CtoString/"/>
      <url>/2019/08/02/js%E4%B8%AD%E7%9A%84valueOf%E5%92%8CtoString/</url>
      
        <content type="html"><![CDATA[<p>js中的valueOf和toString<br><a id="more"></a></p><h1 id="js中的valueOf和toString"><a href="#js中的valueOf和toString" class="headerlink" title="js中的valueOf和toString"></a>js中的valueOf和toString</h1><p>valueOf和toSring两个函数是除null和undefined两种数据类型以外其他五种数据类型（number/string/bool/object/symbol）原型链上共有的函数，那么这两个函数主要是用来干什么的呢？司徒正美大神给出的答案是：值运算和显示问题，一般在隐式类型转换时会自动调用(经典面试题见备注3)。</p><h2 id="例1："><a href="#例1：" class="headerlink" title="例1："></a>例1：</h2><p>如果同时重写了valueOf和toString方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aaa = &#123;</span><br><span class="line">  i: <span class="number">10</span>,</span><br><span class="line">  valueOf: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'valueOf'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.i+<span class="number">30</span>; </span><br><span class="line">  &#125;,</span><br><span class="line">  toString: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'toString'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.i+<span class="number">10</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="built_in">console</span>.log(aaa &gt; <span class="number">20</span>); <span class="comment">// valueOf  true</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">''</span> + aaa);  <span class="comment">//  valueOf  40</span></span><br><span class="line"> <span class="built_in">console</span>.log(++aaa); <span class="comment">// valueOf  41</span></span><br><span class="line"> <span class="built_in">console</span>.log(+aaa); <span class="comment">//  valueOf  40</span></span><br><span class="line"> alert(aaa); <span class="comment">// toString 20</span></span><br><span class="line"> <span class="built_in">console</span>.log(aaa == <span class="number">40</span>) <span class="comment">//valueOf true</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">String</span>(aaa)) <span class="comment">// toString 20</span></span><br></pre></td></tr></table></figure></p><p>总结：涉及到操作符的问题，valueOf的优先级比toString的优先级高，涉及到显示问题，toString方法优先级比valueOf方法高。</p><h2 id="例2："><a href="#例2：" class="headerlink" title="例2："></a>例2：</h2><p>如果只是重写了toString方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aaa = &#123;</span><br><span class="line">  i: <span class="number">10</span>,</span><br><span class="line">  toString: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'toString'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.i+<span class="number">10</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="built_in">console</span>.log(aaa &gt; <span class="number">20</span>); <span class="comment">// toString false</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">''</span> + aaa);  <span class="comment">//  toString 20</span></span><br><span class="line"> <span class="built_in">console</span>.log(++aaa); <span class="comment">// toString 21</span></span><br><span class="line"> <span class="built_in">console</span>.log(+aaa); <span class="comment">//  toSring 20</span></span><br><span class="line"> alert(aaa); <span class="comment">// toString 20</span></span><br><span class="line"> <span class="built_in">console</span>.log(aaa == <span class="number">20</span>) <span class="comment">//toString true</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">String</span>(aaa)) <span class="comment">// toString 20</span></span><br></pre></td></tr></table></figure></p><p>总结：只重写了toString方法的话，toString方法比原型链上的valueOf方法优先级高。</p><h2 id="例3"><a href="#例3" class="headerlink" title="例3"></a>例3</h2><p>如果只重写了valueOf方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aaa = &#123;</span><br><span class="line">  i: <span class="number">10</span>,</span><br><span class="line">  valueOf: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'valueOf'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.i+<span class="number">30</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="built_in">console</span>.log(aaa &gt; <span class="number">20</span>); <span class="comment">// valueOf true</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">''</span> + aaa);  <span class="comment">//  valueOf 40</span></span><br><span class="line"> <span class="built_in">console</span>.log(++aaa); <span class="comment">// valueOf 41</span></span><br><span class="line"> <span class="built_in">console</span>.log(+aaa); <span class="comment">//  valueOf 40</span></span><br><span class="line"> alert(aaa); <span class="comment">// [object Object]</span></span><br><span class="line"> <span class="built_in">console</span>.log(aaa == <span class="number">20</span>) <span class="comment">//valueOf false</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">String</span>(aaa)) <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure></p><p>总结：只重写了valueOf方法的话，涉及到值运算优先调用valueOf方法，涉及到显示问题还是优先调用原型链上的toString方法。</p><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>针对一般没有对valueOf和toString方法进行重写的情况：<br>1.对除null和undefined(这两种类型的原型上没有valueOf方法)以外的数据类型调用valueOf方法，得到的都是数据本身。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> aa = a.valueOf()</span><br><span class="line">aa === a <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="string">'a'</span></span><br><span class="line"><span class="keyword">var</span> bb = b.valueOf()</span><br><span class="line">bb ===b <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="literal">true</span></span><br><span class="line"><span class="keyword">var</span> cc = c.valueOf()</span><br><span class="line">cc === c <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">'age'</span>&#125;</span><br><span class="line"><span class="keyword">var</span> objobj = obj.valueOf()</span><br><span class="line">obj === objobj <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">var</span> ss = s.valueOf()</span><br><span class="line">ss === s <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p><p>2.对number/string/bool/symbol类型数据调用toString方法得到的是对应的字符串，对object类型数据调用toString的方法得到的是”[object Object]”，null和undefined两种数据类型的原型链上没有toString方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aaa = a.toString() <span class="comment">// "1"</span></span><br><span class="line"><span class="keyword">var</span> bbb = b.toString() <span class="comment">// "a"</span></span><br><span class="line"><span class="keyword">var</span> ccc = c.toString() <span class="comment">// "true"</span></span><br><span class="line"><span class="keyword">var</span> objobjobj = obj.toString() <span class="comment">//"[object Object]"</span></span><br><span class="line"><span class="keyword">var</span> sss = s.toString() <span class="comment">//"Symbol()"</span></span><br></pre></td></tr></table></figure></p><p>3.也可以得到一个经典前端面试题的一种解法,如何能够使得下列的表达式返回true<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a==<span class="number">1</span> &amp;&amp; a==<span class="number">2</span> &amp;&amp; a==<span class="number">3</span></span><br></pre></td></tr></table></figure></p><p>解法如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">i: <span class="number">1</span>,</span><br><span class="line">valueOf: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.i++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">a==<span class="number">1</span> &amp;&amp; a==<span class="number">2</span> &amp;&amp; a==<span class="number">3</span> <span class="comment">//返回true</span></span><br></pre></td></tr></table></figure></p><p>以上重写了valueOf函数，比较运算时会优先调用该函数。当然，如果重写toString方法的话，比较运算也会优先调用该toString函数，因此可以到达同样的效果。<br>还有其他一种常见的解法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = <span class="number">1</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'a'</span>, &#123;</span><br><span class="line"><span class="keyword">get</span>() &#123;</span><br><span class="line"><span class="keyword">return</span> val++</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">a==<span class="number">1</span> &amp;&amp; a==<span class="number">2</span> &amp;&amp; a==<span class="number">3</span> <span class="comment">//同样返回true</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js读取和导出excel文件</title>
      <link href="/2019/07/31/js%E8%AF%BB%E5%8F%96%E5%92%8C%E5%AF%BC%E5%87%BAexcel%E6%96%87%E4%BB%B6/"/>
      <url>/2019/07/31/js%E8%AF%BB%E5%8F%96%E5%92%8C%E5%AF%BC%E5%87%BAexcel%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>javascript对excel文件进行导入导出的处理<br><a id="more"></a></p><h1 id="js读取和导出excel文件"><a href="#js读取和导出excel文件" class="headerlink" title="js读取和导出excel文件"></a>js读取和导出excel文件</h1><h2 id="js-xlsx-介绍"><a href="#js-xlsx-介绍" class="headerlink" title="js-xlsx 介绍"></a>js-xlsx 介绍</h2><p>由SheetJS出品的js-xlsx是一款非常方便的只需要纯JS即可读取和导出excel的工具库，功能强大，支持格式众多，支持xls、xlsx、ods(一种OpenOffice专有表格文件格式)等十几种格式。本文全部都是以xlsx格式为例。</p><ul><li>官方github：<a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="noopener">https://github.com/SheetJS/js-xlsx</a></li><li>本文配套demo：<a href="https://github.com/jinux7/study-collections/tree/master/js处理excel之js-xlsx" target="_blank" rel="noopener">点这里</a><h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3>见下图：<br><img src="/2019/07/31/js读取和导出excel文件/1.png" alt="img"><h3 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h3>dist目录下有很多个JS文件，一般情况下用xlsx.core.min.js就够了，xlsx.full.min.js则是包含了所有功能模块。<br><img src="/2019/07/31/js读取和导出excel文件/2.png" alt="img"><br>直接script标签引入即可：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"./js/xlsx.core.min.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="读取excel"><a href="#读取excel" class="headerlink" title="读取excel"></a>读取excel</h2><p>读取excel主要是通过XLSX.read(data, {type: type});方法来实现，返回一个叫WorkBook的对象，type主要取值如下：</p><ul><li>base64: 以base64方式读取；</li><li>binary: BinaryString格式(byte n is data.charCodeAt(n))</li><li>string: UTF8编码的字符串；</li><li>buffer: nodejs Buffer；</li><li>array: Uint8Array，8位无符号数组；</li><li>file: 文件的路径（仅nodejs下支持）；</li></ul><h3 id="获取workbook对象"><a href="#获取workbook对象" class="headerlink" title="获取workbook对象"></a>获取workbook对象</h3><h4 id="读取本地文件"><a href="#读取本地文件" class="headerlink" title="读取本地文件"></a>读取本地文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取本地excel文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readWorkbookFromLocalFile</span>(<span class="params">file, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = e.target.result;</span><br><span class="line">        <span class="keyword">var</span> workbook = XLSX.read(data, &#123;<span class="attr">type</span>: <span class="string">'binary'</span>&#125;);</span><br><span class="line">        <span class="keyword">if</span>(callback) callback(workbook);</span><br><span class="line">    &#125;;</span><br><span class="line">    reader.readAsBinaryString(file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="读取网络文件"><a href="#读取网络文件" class="headerlink" title="读取网络文件"></a>读取网络文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从网络上读取某个excel文件，url必须同域，否则报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readWorkbookFromRemoteFile</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">'get'</span>, url, <span class="literal">true</span>);</span><br><span class="line">    xhr.responseType = <span class="string">'arraybuffer'</span>;</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> data = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(xhr.response)</span><br><span class="line">            <span class="keyword">var</span> workbook = XLSX.read(data, &#123;<span class="attr">type</span>: <span class="string">'array'</span>&#125;);</span><br><span class="line">            <span class="keyword">if</span>(callback) callback(workbook);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="详解-workbook"><a href="#详解-workbook" class="headerlink" title="详解 workbook"></a>详解 workbook</h3><h4 id="Workbook-Object"><a href="#Workbook-Object" class="headerlink" title="Workbook Object"></a>Workbook Object</h4><p>workbook里面有什么东西呢，我们打印出来看一下：<br><img src="/2019/07/31/js读取和导出excel文件/3.png" alt="img"><br>可以看到，SheetNames里面保存了所有的sheet名字，然后Sheets则保存了每个sheet的具体内容（我们称之为Sheet Object）。每一个sheet是通过类似A1这样的键值保存每个单元格的内容，我们称之为单元格对象（Cell Object）：<br><img src="/2019/07/31/js读取和导出excel文件/4.png" alt="img"></p><h4 id="Sheet-Object"><a href="#Sheet-Object" class="headerlink" title="Sheet Object"></a>Sheet Object</h4><p>每一个Sheet Object表示一张表格，只要不是!开头的都表示普通cell，否则，表示一些特殊含义，具体如下：</p><ul><li>sheet[‘!ref’]：表示所有单元格的范围，例如从A1到F8则记录为A1:F8；</li><li>sheet[!merges]：存放一些单元格合并信息，是一个数组，每个数组由包含s和e构成的对象组成，s表示开始，e表示结束，r表示行，c表示列；</li><li>等等；</li></ul><p>关于单元格合并，看懂下面这张图基本上就没问题了：<br><img src="/2019/07/31/js读取和导出excel文件/5.png" alt="img"><br>结果如下：<br><img src="/2019/07/31/js读取和导出excel文件/6.png" alt="img"></p><h4 id="单元格对象"><a href="#单元格对象" class="headerlink" title="单元格对象"></a>单元格对象</h4><p>每一个单元格是一个对象（Cell Object），主要有t、v、r、h、w等字段（详见这里）：</p><ul><li>t：表示内容类型，s表示string类型，n表示number类型，b表示boolean类型，d表示date类型，等等</li><li>v：表示原始值；</li><li>f：表示公式，如B2+B3；</li><li>h：HTML内容</li><li>w：格式化后的内容</li><li>r：富文本内容rich text</li><li>等等</li></ul><h4 id="读取workbook"><a href="#读取workbook" class="headerlink" title="读取workbook"></a>读取workbook</h4><p>普通方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取 excel文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outputWorkbook</span>(<span class="params">workbook</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sheetNames = workbook.SheetNames; <span class="comment">// 工作表名称集合</span></span><br><span class="line">    sheetNames.forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> worksheet = workbook.Sheets[name]; <span class="comment">// 只能通过工作表名称来获取指定工作表</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> worksheet) &#123;</span><br><span class="line">            <span class="comment">// v是读取单元格的原始值</span></span><br><span class="line">            <span class="built_in">console</span>.log(key, key[<span class="number">0</span>] === <span class="string">'!'</span> ? worksheet[key] : worksheet[key].v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>根据!ref确定excel的范围，再根据!merges确定单元格合并（如果有），最后输出整个table，比较麻烦，幸运的是，插件自身已经写好工具类XLSX.utils给我们直接使用，无需我们自己遍历，工具类输出主要包括如下：<br><img src="/2019/07/31/js读取和导出excel文件/7.png" alt="img"><br>有些不常用，常用的主要是：</p><ul><li>XLSX.utils.sheet_to_csv：生成CSV格式</li><li>XLSX.utils.sheet_to_txt：生成纯文本格式</li><li>XLSX.utils.sheet_to_html：生成HTML格式</li><li>XLSX.utils.sheet_to_json：输出JSON格式</li></ul><p>常用的主要是sheet_to_csv或者sheet_to_html，转csv的话会忽略格式、单元格合并等信息，所以复杂表格可能不适用。转html的话会保留单元格合并，但是生成的是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">``` javascript</span><br><span class="line">function readWorkbook(workbook)</span><br><span class="line">&#123;</span><br><span class="line">    var sheetNames = workbook.SheetNames; // 工作表名称集合</span><br><span class="line">    var worksheet = workbook.Sheets[sheetNames[0]]; // 这里我们只读取第一张sheet</span><br><span class="line">    var csv = XLSX.utils.sheet_to_csv(worksheet);</span><br><span class="line">    document.getElementById(&apos;result&apos;).innerHTML = csv2table(csv);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 将csv转换成简单的表格，会忽略单元格合并，在第一行和第一列追加类似excel的索引</span><br><span class="line">function csv2table(csv)</span><br><span class="line">&#123;</span><br><span class="line">    var html = &apos;&lt;table&gt;&apos;;</span><br><span class="line">    var rows = csv.split(&apos;\n&apos;);</span><br><span class="line">    rows.pop(); // 最后一行没用的</span><br><span class="line">    rows.forEach(function(row, idx) &#123;</span><br><span class="line">        var columns = row.split(&apos;,&apos;);</span><br><span class="line">        columns.unshift(idx+1); // 添加行索引</span><br><span class="line">        if(idx == 0) &#123; // 添加列索引</span><br><span class="line">            html += &apos;&lt;tr&gt;&apos;;</span><br><span class="line">            for(var i=0; i&lt;columns.length; i++) &#123;</span><br><span class="line">                html += &apos;&lt;th&gt;&apos; + (i==0?&apos;&apos;:String.fromCharCode(65+i-1)) + &apos;&lt;/th&gt;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">            html += &apos;&lt;/tr&gt;&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">        html += &apos;&lt;tr&gt;&apos;;</span><br><span class="line">        columns.forEach(function(column) &#123;</span><br><span class="line">            html += &apos;&lt;td&gt;&apos;+column+&apos;&lt;/td&gt;&apos;;</span><br><span class="line">        &#125;);</span><br><span class="line">        html += &apos;&lt;/tr&gt;&apos;;</span><br><span class="line">    &#125;);</span><br><span class="line">    html += &apos;&lt;/table&gt;&apos;;</span><br><span class="line">    return html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="导出excel"><a href="#导出excel" class="headerlink" title="导出excel"></a>导出excel</h2><p>导出分为2种，一种是基于现有excel修改，一种是全新生成，前者比较简单，我们这里着重讲后者。</p><h3 id="自己手写代码生成"><a href="#自己手写代码生成" class="headerlink" title="自己手写代码生成"></a>自己手写代码生成</h3><p>导出excel文件，主要是如何生成一个sheet，我们这里写一个最简单的csv转excel示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// csv转sheet对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">csv2sheet</span>(<span class="params">csv</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sheet = &#123;&#125;; <span class="comment">// 将要生成的sheet</span></span><br><span class="line">    csv = csv.split(<span class="string">'\n'</span>);</span><br><span class="line">    csv.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">row, i</span>) </span>&#123;</span><br><span class="line">        row = row.split(<span class="string">','</span>);</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>) sheet[<span class="string">'!ref'</span>] = <span class="string">'A1:'</span>+<span class="built_in">String</span>.fromCharCode(<span class="number">65</span>+row.length<span class="number">-1</span>)+(csv.length<span class="number">-1</span>);</span><br><span class="line">        row.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">col, j</span>) </span>&#123;</span><br><span class="line">            sheet[<span class="built_in">String</span>.fromCharCode(<span class="number">65</span>+j)+(i+<span class="number">1</span>)] = &#123;<span class="attr">v</span>: col&#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> sheet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将一个sheet转成最终的excel文件的blob对象，然后利用URL.createObjectURL下载</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sheet2blob</span>(<span class="params">sheet, sheetName</span>) </span>&#123;</span><br><span class="line">    sheetName = sheetName || <span class="string">'sheet1'</span>;</span><br><span class="line">    <span class="keyword">var</span> workbook = &#123;</span><br><span class="line">        SheetNames: [sheetName],</span><br><span class="line">        Sheets: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    workbook.Sheets[sheetName] = sheet;</span><br><span class="line">    <span class="comment">// 生成excel的配置项</span></span><br><span class="line">    <span class="keyword">var</span> wopts = &#123;</span><br><span class="line">        bookType: <span class="string">'xlsx'</span>, <span class="comment">// 要生成的文件类型</span></span><br><span class="line">        bookSST: <span class="literal">false</span>, <span class="comment">// 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性</span></span><br><span class="line">        type: <span class="string">'binary'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> wbout = XLSX.write(workbook, wopts);</span><br><span class="line">    <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([s2ab(wbout)], &#123;<span class="attr">type</span>:<span class="string">"application/octet-stream"</span>&#125;);</span><br><span class="line">    <span class="comment">// 字符串转ArrayBuffer</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">s2ab</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(s.length);</span><br><span class="line">        <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i!=s.length; ++i) view[i] = s.charCodeAt(i) &amp; <span class="number">0xFF</span>;</span><br><span class="line">        <span class="keyword">return</span> buf;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> blob;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>拿到上面的blob对象就可以直接下载了，参考我之前在JS弹出下载对话框里面封装好的openDownloadDialog方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用的打开下载对话框方法，没有测试过具体兼容性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>url 下载地址，也可以是一个blob对象，必选</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>saveName 保存文件名，可选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openDownloadDialog</span>(<span class="params">url, saveName</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> url == <span class="string">'object'</span> &amp;&amp; url <span class="keyword">instanceof</span> Blob)</span><br><span class="line">    &#123;</span><br><span class="line">        url = URL.createObjectURL(url); <span class="comment">// 创建blob地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> aLink = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">    aLink.href = url;</span><br><span class="line">    aLink.download = saveName || <span class="string">''</span>; <span class="comment">// HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效</span></span><br><span class="line">    <span class="keyword">var</span> event;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">window</span>.MouseEvent) event = <span class="keyword">new</span> MouseEvent(<span class="string">'click'</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        event = <span class="built_in">document</span>.createEvent(<span class="string">'MouseEvents'</span>);</span><br><span class="line">        event.initMouseEvent(<span class="string">'click'</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="built_in">window</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    aLink.dispatchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>所以，最终下载实现如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传入csv，执行后就会弹出下载框</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exportExcel</span>(<span class="params">csv</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sheet = csv2sheet(csv);</span><br><span class="line">    <span class="keyword">var</span> blob = sheet2blob(sheet);</span><br><span class="line">    openDownloadDialog(blob, <span class="string">'导出.xlsx'</span>)；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="利用官方工具类生成"><a href="#利用官方工具类生成" class="headerlink" title="利用官方工具类生成"></a>利用官方工具类生成</h3><p>其实上面这些代码都不需要我们手写，官方已经提供好了现成的工具类给我们使用，主要包括：</p><ul><li>aoa_to_sheet: 这个工具类最强大也最实用了，将一个二维数组转成sheet，会自动处理number、string、boolean、date等类型数据；</li><li>table_to_sheet: 将一个table dom直接转成sheet，会自动识别colspan和rowspan并将其转成对应的单元格合并；</li><li>json_to_sheet: 将一个由对象组成的数组转成sheet；</li></ul><p>aoa_to_sheet示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aoa = [</span><br><span class="line">    [<span class="string">'姓名'</span>, <span class="string">'性别'</span>, <span class="string">'年龄'</span>, <span class="string">'注册时间'</span>],</span><br><span class="line">    [<span class="string">'张三'</span>, <span class="string">'男'</span>, <span class="number">18</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()],</span><br><span class="line">    [<span class="string">'李四'</span>, <span class="string">'女'</span>, <span class="number">22</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> sheet = XLSX.utils.aoa_to_sheet(aoa);</span><br><span class="line">openDownloadDialog(sheet2blob(sheet), <span class="string">'导出.xlsx'</span>);</span><br></pre></td></tr></table></figure></p><p>table_to_sheet就更简单了，直接XLSX.utils.table_to_sheet($(‘table’)[0])即可；</p><h3 id="处理单元格合并"><a href="#处理单元格合并" class="headerlink" title="处理单元格合并"></a>处理单元格合并</h3><p>一般来说，前端生成excel而不是csv最主要目的都是为了解决csv不能实现单元格合并的问题，要不然直接导出csv文件就好了，何必引入几百kb的插件。<br>假设我们要生成如下格式的excel文件，其中A1-C1进行单元格合并：<br><img src="/2019/07/31/js读取和导出excel文件/8.png" alt="img"><br>代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aoa = [</span><br><span class="line">    [<span class="string">'主要信息'</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">'其它信息'</span>], <span class="comment">// 特别注意合并的地方后面预留2个null</span></span><br><span class="line">    [<span class="string">'姓名'</span>, <span class="string">'性别'</span>, <span class="string">'年龄'</span>, <span class="string">'注册时间'</span>],</span><br><span class="line">    [<span class="string">'张三'</span>, <span class="string">'男'</span>, <span class="number">18</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()],</span><br><span class="line">    [<span class="string">'李四'</span>, <span class="string">'女'</span>, <span class="number">22</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> sheet = XLSX.utils.aoa_to_sheet(aoa);</span><br><span class="line">sheet[<span class="string">'!merges'</span>] = [</span><br><span class="line">    <span class="comment">// 设置A1-C1的单元格合并</span></span><br><span class="line">    &#123;<span class="attr">s</span>: &#123;<span class="attr">r</span>: <span class="number">0</span>, <span class="attr">c</span>: <span class="number">0</span>&#125;, <span class="attr">e</span>: &#123;<span class="attr">r</span>: <span class="number">0</span>, <span class="attr">c</span>: <span class="number">2</span>&#125;&#125;</span><br><span class="line">];</span><br><span class="line">openDownloadDialog(sheet2blob(sheet), <span class="string">'单元格合并示例.xlsx'</span>);</span><br></pre></td></tr></table></figure></p><p>需要注意的地方就是被合并的单元格要用null预留出位置，否则后面的内容（本例中是第四列其它信息）会被覆盖。</p><h3 id="自定义样式"><a href="#自定义样式" class="headerlink" title="自定义样式"></a>自定义样式</h3><p>普通版本不支持定义字体、颜色、背景色等，有这个功能需要的可以使用<a href="http://sheetjs.com/pro" target="_blank" rel="noopener">pro</a>版，好像是要收费的，因为官网没看到下载地址。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面的代码在上传本地excel文件转换时候没什么问题，但是在用ajax请求的excel文件在转换时，chrome浏览器报错，firefox和opera正常。<br>我觉得问题出在我是用的excel的版本上，我在网上下载的excel文件就可以正常解析，这里要注意哦。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6-Symbol.iterator 迭代器</title>
      <link href="/2019/07/30/ES6-Symbol-iterator-%E8%BF%AD%E4%BB%A3%E5%99%A8/"/>
      <url>/2019/07/30/ES6-Symbol-iterator-%E8%BF%AD%E4%BB%A3%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>ES6-Symbol.iterator 迭代器原理剖析<br><a id="more"></a></p><h1 id="ES6-Symbol-iterator-迭代器"><a href="#ES6-Symbol-iterator-迭代器" class="headerlink" title="ES6-Symbol.iterator 迭代器"></a>ES6-Symbol.iterator 迭代器</h1><p>一个数据结构只要部署了Symbol.iterator属性就能使用 for…of遍历 与 …运算符 操作<br>Object身上没有Symbol.iterator，当直接使用时会报错<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">'c'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...obj])<span class="comment">//报错obj is not iterable &lt;br&gt;　　　　　在没有Symbol.iterator方法下运行</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> p <span class="keyword">of</span> obj)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(p);<span class="comment">//TypeError: obj is not iterable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Array身上天生具备Symbol.iterator<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"><span class="comment">// 数组，天生具备Symbol.iterator方法所以可以使用</span></span><br><span class="line"><span class="built_in">console</span>.log([...arr]);<span class="comment">//(4) [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure></p><p>而我们Object需要用到…运算符 与 for of遍历怎么办呢<br>如果我们要使用它的话，Object身上需要有一个Symbol.iterator属性代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">'c'</span>,</span><br><span class="line">    length: <span class="number">3</span>,</span><br><span class="line">    [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// index用来记遍历圈数</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> next = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                value: <span class="keyword">this</span>[index],</span><br><span class="line">                done: <span class="keyword">this</span>.length == ++index</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(obj.length)</span></span><br><span class="line"><span class="built_in">console</span>.log([...obj]);<span class="comment">//(2) ["a", "b"]</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> p <span class="keyword">of</span> obj)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(p) <span class="comment">//"a"  "b"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端touch事件简介</title>
      <link href="/2019/07/30/%E7%A7%BB%E5%8A%A8%E7%AB%AFtouch%E4%BA%8B%E4%BB%B6%E7%AE%80%E4%BB%8B/"/>
      <url>/2019/07/30/%E7%A7%BB%E5%8A%A8%E7%AB%AFtouch%E4%BA%8B%E4%BB%B6%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>移动端的touch事件的简单入门介绍<br><a id="more"></a></p><h1 id="移动端touch事件简介"><a href="#移动端touch事件简介" class="headerlink" title="移动端touch事件简介"></a>移动端touch事件简介</h1><h2 id="touch事件"><a href="#touch事件" class="headerlink" title="touch事件"></a>touch事件</h2><p>首先 touch 包含三类事件，它们分别是：touchstart、touchmove、touchend 。</p><ul><li>touchstart：手指触摸到一个 DOM 元素时触发。</li><li>touchmove：手指在一个 DOM 元素上滑动时触发。</li><li>touchend：手指从一个 DOM 元素上移开时触发。</li></ul><p>这三个事件又分别对应三个相同的触摸列表：</p><ul><li>touches：正在触摸屏幕的所有手指的一个列表。</li><li>targetTouches：正在触摸当前 DOM 元素上的手指的一个列表。</li><li>changedTouches：涉及当前事件的手指的一个列表。</li></ul><h2 id="touch事件属性"><a href="#touch事件属性" class="headerlink" title="touch事件属性"></a>touch事件属性</h2><p>事件对应的三个列表虽然名字不一样，但是它们里面装的东西都是差不多的，包含了当前事件的一些相关信息，比如：一些坐标信息。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">clientX:<span class="number">65</span> <span class="comment">// 触摸点在浏览器窗口中的横坐标</span></span><br><span class="line">clientY:<span class="number">18</span> <span class="comment">// 触摸点在浏览器窗口中的纵坐标</span></span><br><span class="line">force:<span class="number">1</span> <span class="comment">// 触摸点压力大小</span></span><br><span class="line">identifier:<span class="number">0</span> <span class="comment">// 触摸点唯一标识（ID）</span></span><br><span class="line">pageX:<span class="number">65</span> <span class="comment">// 触摸点在页面中的横坐标</span></span><br><span class="line">pageY:<span class="number">18</span> <span class="comment">// 触摸点在页面中的纵坐标</span></span><br><span class="line">radiusX:<span class="number">11.5</span> <span class="comment">// 触摸点椭圆的水平半径</span></span><br><span class="line">radiusY:<span class="number">11.5</span> <span class="comment">// 触摸点椭圆的垂直半径</span></span><br><span class="line">rotationAngle:<span class="number">0</span> <span class="comment">// 旋转角度</span></span><br><span class="line">screenX:<span class="number">560</span> <span class="comment">// 触摸点在屏幕中的横坐标</span></span><br><span class="line">screenY:<span class="number">175</span> <span class="comment">// 触摸点在屏幕中的纵坐标</span></span><br></pre></td></tr></table></figure></p><p>上面就是一个 TouchList 列表。它对应的就是前面提到的三种事件（touchstart、touchmove、touchend）中的一种，在触发时生成的一个对象列表。列表里最有用的就是 Touch 对象了，Touch 对象里存放着对应事件的一些相关的信息，我们就是通过这种个事件里这些属性的有机结合来实现各种效果。<br>通过上面的 radiusX，radiusY，rotationAngle 这三个属性就可以计算出你的手指触摸手机屏幕时的一个接触面，只不过这个接触面是用一个近似的椭圆来表示，也就是说它不是一个真正意义上的接触面，而是一个大概的接触面。相信心细的朋友应该会看到 TouchList 对象里有一个 length 属性，并且它的值为 1  ，这说明当前只有一个手指触发了事件（比如：touchstart 事件），换句话说，此时你只有一个手指放到了手机屏幕上，这个手指对应的一些信息存放在 Touch 对象里。因为只有一个手指放在了屏幕上，所以这个 TouchList 里只有一个 Touch 对象，并且是第一个下标为 0 。TouchList 列表里还有一个 target 属性，这个应该很好理解，就是触摸的目标。<br>为了让你能更加立体地理解上面的这些属性，我专门从网上找了一段话来作为补充：</p><p>来自 mozilla</p><ul><li>1.Touch.identifier：此 Touch 对象的唯一标识符。 一次触摸动作(我们指的是手指的触摸)在平面上移动的整个过程中，该标识符不变。 可以根据它来判断跟踪的是否是同一次触摸过程，此值为只读属性。</li><li>2.Touch.screenX：触点相对于屏幕左边沿的X坐标。只读属性。</li><li>3.Touch.screenY：触点相对于屏幕上边沿的Y坐标。只读属性。</li><li>4.Touch.clientX：触点相对于可见视区(visual viewport)左边沿的X坐标。不包括任何滚动偏移。只读属性。</li><li>5.Touch.clientY：触点相对于可见视区(visual viewport)上边沿的Y坐标。不包括任何滚动偏移。只读属性。</li><li>6.Touch.pageX：触点相对于HTML文档左边沿的X坐标。当存在水平滚动的偏移时，这个值包含了水平滚动的偏移。只读属性。</li><li>7.Touch.pageY：触点相对于HTML文档上边沿的Y坐标。当存在水平滚动的偏移时，这个值包含了垂直滚动的偏移。只读属性。</li><li>8.Touch.radiusX：能够包围用户和触摸平面的接触面的最小椭圆的水平轴(X轴)半径。这个值的单位和 screenX 相同。只读属性。</li><li>9.Touch.radiusY：能够包围用户和触摸平面的接触面的最小椭圆的垂直轴(Y轴)半径。这个值的单位和 screenY 相同。只读属性。</li><li>10.Touch.rotationAngle：它是这样一个角度值：由radiusX 和 radiusY描述的正方向的椭圆，需要通过顺时针旋转这个角度值，才能最精确地覆盖住用户和触摸平面的接触面。只读属性。</li><li>11.Touch.force：手指挤压触摸平面的压力大小，从0.0(没有压力)到1.0(最大压力)的浮点数。只读属性。</li><li>12.Touch.target：当这个触点最开始被跟踪时(在 touchstart 事件中)，触点位于的HTML元素。哪怕在触点移动过程中，触点的位置已经离开了这个元素的有效交互区域，或者这个元素已经被从文档中移除。需要注意的是，如果这个元素在触摸过程中被移除，这个事件仍然会指向它，但是不会再冒泡这个事件到 window 或 document 对象。因此，如果有元素在触摸过程中可能被移除，最佳实践是将触摸事件的监听器绑定到这个元素本身，防止元素被移除后，无法再从它的上一级元素上侦测到从该元素冒泡的事件。只读属性。</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这里只是简单地介绍了一下移动端的touch事件，主要还是记住touchstart，touchmove，touchend这三个事件，还有事件里的touches，targetTouches，changedTouches这三个属性，我们尝试用的还是targetTouches,touches的兼容性不好，一般我们不使用。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>你真的了解回流和重绘吗?</title>
      <link href="/2019/07/29/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E5%9B%9E%E6%B5%81%E5%92%8C%E9%87%8D%E7%BB%98%E5%90%97/"/>
      <url>/2019/07/29/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E5%9B%9E%E6%B5%81%E5%92%8C%E9%87%8D%E7%BB%98%E5%90%97/</url>
      
        <content type="html"><![CDATA[<p>你真的了解回流和重绘吗<br><a id="more"></a></p><h1 id="你真的了解回流和重绘吗"><a href="#你真的了解回流和重绘吗" class="headerlink" title="你真的了解回流和重绘吗"></a>你真的了解回流和重绘吗</h1><p>回流和重绘可以说是每一个web开发者都经常听到的两个词语，我也不例外，可是我之前一直不是很清楚这两步具体做了什么事情。最近由于部门内部要做分享，所以对其进行了一些研究，看了一些博客和书籍，整理了一些内容并且结合一些例子，写了这篇文章，希望可以帮助到大家。</p><h2 id="浏览器的渲染过程"><a href="#浏览器的渲染过程" class="headerlink" title="浏览器的渲染过程"></a>浏览器的渲染过程</h2><p>本文先从浏览器的渲染过程来从头到尾的讲解一下回流重绘，如果大家想直接看如何减少回流和重绘，可以跳到后面。（这个渲染过程来自<a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn" target="_blank" rel="noopener">MDN</a>）</p><p><img src="/2019/07/29/你真的了解回流和重绘吗/1.png" alt="webkit渲染过程"></p><p>从上面这个图上，我们可以看到，浏览器渲染过程如下：</p><ol><li>解析HTML，生成DOM树，解析CSS，生成CSSOM树</li><li>将DOM树和CSSOM树结合，生成渲染树(Render Tree)</li><li>Layout(回流):根据生成的渲染树，进行回流(Layout)，得到节点的几何信息（位置，大小）</li><li>Painting(重绘):根据渲染树以及回流得到的几何信息，得到节点的绝对像素</li><li>Display:将像素发送给GPU，展示在页面上。（这一步其实还有很多内容，比如会在GPU将多个合成层合并为同一个层，并展示在页面中。而css3硬件加速的原理则是新建合成层，这里我们不展开，之后有机会会写一篇博客）</li></ol><p>渲染过程看起来很简单，让我们来具体了解下每一步具体做了什么。</p><h3 id="生成渲染树"><a href="#生成渲染树" class="headerlink" title="生成渲染树"></a>生成渲染树</h3><p><img src="/2019/07/29/你真的了解回流和重绘吗/2.png" alt="生成渲染树"></p><p>为了构建渲染树，浏览器主要完成了以下工作：</p><ol><li>从DOM树的根节点开始遍历每个可见节点。</li><li>对于每个可见的节点，找到CSSOM树中对应的规则，并应用它们。</li><li>根据每个可见节点以及其对应的样式，组合生成渲染树。</li></ol><p>第一步中，既然说到了要遍历可见的节点，那么我们得先知道，什么节点是不可见的。不可见的节点包括：</p><ul><li>一些不会渲染输出的节点，比如script、meta、link等。</li><li>一些通过css进行隐藏的节点。比如display:none。注意，利用visibility和opacity隐藏的节点，还是会显示在渲染树上的。只有display:none的节点才不会显示在渲染树上。</li></ul><p><strong>注意：渲染树只包含可见的节点</strong></p><h3 id="回流"><a href="#回流" class="headerlink" title="回流"></a>回流</h3><p>前面我们通过构造渲染树，我们将可见DOM节点以及它对应的样式结合起来，可是我们还需要计算它们在设备视口(viewport)内的确切位置和大小，这个计算的阶段就是回流。</p><p>为了弄清每个对象在网站上的确切大小和位置，浏览器从渲染树的根节点开始遍历，我们可以以下面这个实例来表示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Critial Path: Hello world!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 50%"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 50%"</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们可以看到，第一个div将节点的显示尺寸设置为视口宽度的50%，第二个div将其尺寸设置为父节点的50%。而在回流这个阶段，我们就需要根据视口具体的宽度，将其转为实际的像素值。（如下图）</p><p><img src="/2019/07/29/你真的了解回流和重绘吗/3.png" alt></p><h3 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h3><p>最终，我们通过构造渲染树和回流阶段，我们知道了哪些节点是可见的，以及可见节点的样式和具体的几何信息(位置、大小)，那么我们就可以将渲染树的每个节点都转换为屏幕上的实际像素，这个阶段就叫做重绘节点。</p><p>既然知道了浏览器的渲染过程后，我们就来探讨下，何时会发生回流重绘。</p><h2 id="何时发生回流重绘"><a href="#何时发生回流重绘" class="headerlink" title="何时发生回流重绘"></a>何时发生回流重绘</h2><p>我们前面知道了，回流这一阶段主要是计算节点的位置和几何信息，那么当页面布局和几何信息发生变化的时候，就需要回流。比如以下情况：</p><ul><li>添加或删除可见的DOM元素</li><li>元素的位置发生变化</li><li>元素的尺寸发生变化（包括外边距、内边框、边框大小、高度和宽度等）</li><li>内容发生变化，比如文本变化或图片被另一个不同尺寸的图片所替代。</li><li>页面一开始渲染的时候（这肯定避免不了）</li><li>浏览器的窗口尺寸变化（因为回流是根据视口的大小来计算元素的位置和大小的）</li></ul><p><strong>注意：回流一定会触发重绘，而重绘不一定会回流</strong></p><p>根据改变的范围和程度，渲染树中或大或小的部分需要重新计算，有些改变会触发整个页面的重排，比如，滚动条出现的时候或者修改了根节点。</p><h2 id="浏览器的优化机制"><a href="#浏览器的优化机制" class="headerlink" title="浏览器的优化机制"></a>浏览器的优化机制</h2><p>现代的浏览器都是很聪明的，由于每次重排都会造成额外的计算消耗，因此大多数浏览器都会通过队列化修改并批量执行来优化重排过程。浏览器会将修改操作放入到队列里，直到过了一段时间或者操作达到了一个阈值，才清空队列。但是！<strong>当你获取布局信息的操作的时候，会强制队列刷新</strong>，比如当你访问以下属性或者使用以下方法：</p><ul><li>offsetTop、offsetLeft、offsetWidth、offsetHeight</li><li>scrollTop、scrollLeft、scrollWidth、scrollHeight</li><li>clientTop、clientLeft、clientWidth、clientHeight</li><li>getComputedStyle()</li><li>getBoundingClientRect</li><li>具体可以访问这个网站：<a href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a" target="_blank" rel="noopener">https://gist.github.com/paulirish/5d52fb081b3570c81e3a</a></li></ul><p>以上属性和方法都需要返回最新的布局信息，因此浏览器不得不清空队列，触发回流重绘来返回正确的值。因此，我们在修改样式的时候，<strong>最好避免使用上面列出的属性，他们都会刷新渲染队列。</strong>如果要使用它们，最好将值缓存起来。</p><h2 id="减少回流和重绘"><a href="#减少回流和重绘" class="headerlink" title="减少回流和重绘"></a>减少回流和重绘</h2><p>好了，到了我们今天的重头戏，前面说了这么多背景和理论知识，接下来让我们谈谈如何减少回流和重绘。</p><h3 id="最小化重绘和重排"><a href="#最小化重绘和重排" class="headerlink" title="最小化重绘和重排"></a>最小化重绘和重排</h3><p>由于重绘和重排可能代价比较昂贵，因此最好就是可以减少它的发生次数。为了减少发生次数，我们可以合并多次对DOM和样式的修改，然后一次处理掉。考虑这个例子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span><br><span class="line">el.style.padding = <span class="string">'5px'</span>;</span><br><span class="line">el.style.borderLeft = <span class="string">'1px'</span>;</span><br><span class="line">el.style.borderRight = <span class="string">'2px'</span>;</span><br></pre></td></tr></table></figure><p>例子中，有三个样式属性被修改了，每一个都会影响元素的几何结构，引起回流。当然，大部分现代浏览器都对其做了优化，因此，只会触发一次重排。但是如果在旧版的浏览器或者在上面代码执行的时候，有其他代码访问了布局信息(上文中的会触发回流的布局信息)，那么就会导致三次重排。</p><p>因此，我们可以合并所有的改变然后依次处理，比如我们可以采取以下的方式：</p><ul><li><p>使用cssText</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span><br><span class="line">el.style.cssText += <span class="string">'border-left: 1px; border-right: 2px; padding: 5px;'</span>;</span><br></pre></td></tr></table></figure></li><li><p>修改CSS的class</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span><br><span class="line">el.className += <span class="string">' active'</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="批量修改DOM"><a href="#批量修改DOM" class="headerlink" title="批量修改DOM"></a>批量修改DOM</h3><p>当我们需要对DOM对一系列修改的时候，可以通过以下步骤减少回流重绘次数：</p><ol><li>使元素脱离文档流</li><li>对其进行多次修改</li><li>将元素带回到文档中。</li></ol><p>该过程的第一步和第三步可能会引起回流，但是经过第一步之后，对DOM的所有修改都不会引起回流，因为它已经不在渲染树了。</p><p>有三种方式可以让DOM脱离文档流：</p><ul><li>隐藏元素，应用修改，重新显示</li><li>使用文档片段(document fragment)在当前DOM之外构建一个子树，再把它拷贝回文档。</li><li>将原始元素拷贝到一个脱离文档的节点中，修改节点后，再替换原始的元素。</li></ul><p>考虑我们要执行一段批量插入节点的代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">appendDataToElement</span>(<span class="params">appendToElement, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> li;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">    li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">        li.textContent = <span class="string">'text'</span>;</span><br><span class="line">        appendToElement.appendChild(li);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line">appendDataToElement(ul, data);</span><br></pre></td></tr></table></figure><p>如果我们直接这样执行的话，由于每次循环都会插入一个新的节点，会导致浏览器回流一次。</p><p>我们可以使用这三种方式进行优化:</p><p><strong>隐藏元素，应用修改，重新显示</strong></p><p>这个会在展示和隐藏节点的时候，产生两次重绘</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">appendDataToElement</span>(<span class="params">appendToElement, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> li;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">    li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">        li.textContent = <span class="string">'text'</span>;</span><br><span class="line">        appendToElement.appendChild(li);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line">ul.style.display = <span class="string">'none'</span>;</span><br><span class="line">appendDataToElement(ul, data);</span><br><span class="line">ul.style.display = <span class="string">'block'</span>;</span><br></pre></td></tr></table></figure><p><strong>使用文档片段(document fragment)在当前DOM之外构建一个子树，再把它拷贝回文档</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line"><span class="keyword">const</span> fragment = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">appendDataToElement(fragment, data);</span><br><span class="line">ul.appendChild(fragment);</span><br></pre></td></tr></table></figure><p><strong>将原始元素拷贝到一个脱离文档的节点中，修改节点后，再替换原始的元素。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line"><span class="keyword">const</span> clone = ul.cloneNode(<span class="literal">true</span>);</span><br><span class="line">appendDataToElement(clone, data);</span><br><span class="line">ul.parentNode.replaceChild(clone, ul);</span><br></pre></td></tr></table></figure><p>对于上述那种情况，我写了一个<a href="https://chenjigeng.github.io/example/share/%E9%81%BF%E5%85%8D%E5%9B%9E%E6%B5%81%E9%87%8D%E7%BB%98/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9DOM.html" target="_blank" rel="noopener">demo</a>来测试修改前和修改后的性能。然而实验结果不是很理想。</p><p><strong>原因：原因其实上面也说过了，浏览器会使用队列来储存多次修改，进行优化，所以对这个优化方案，我们其实不用优先考虑。</strong></p><h3 id="避免触发同步布局事件"><a href="#避免触发同步布局事件" class="headerlink" title="避免触发同步布局事件"></a>避免触发同步布局事件</h3><p>上文我们说过，当我们访问元素的一些属性的时候，会导致浏览器强制清空队列，进行强制同步布局。举个例子，比如说我们想将一个p标签数组的宽度赋值为一个元素的宽度，我们可能写出这样的代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paragraphs.length; i++) &#123;</span><br><span class="line">        paragraphs[i].style.width = box.offsetWidth + <span class="string">'px'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码看上去是没有什么问题，可是其实会造成很大的性能问题。在每次循环的时候，都读取了box的一个offsetWidth属性值，然后利用它来更新p标签的width属性。这就导致了每一次循环的时候，浏览器都必须先使上一次循环中的样式更新操作生效，才能响应本次循环的样式读取操作。每一次循环都会强制浏览器刷新队列。我们可以优化为:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> width = box.offsetWidth;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paragraphs.length; i++) &#123;</span><br><span class="line">        paragraphs[i].style.width = width + <span class="string">'px'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样，我也写了个<a href="https://chenjigeng.github.io/example/share/%E9%81%BF%E5%85%8D%E5%9B%9E%E6%B5%81%E9%87%8D%E7%BB%98/%E9%81%BF%E5%85%8D%E5%BF%AB%E9%80%9F%E8%BF%9E%E7%BB%AD%E7%9A%84%E5%B8%83%E5%B1%80.html" target="_blank" rel="noopener">demo</a>来比较两者的性能差异。你可以自己点开这个demo体验下。这个对比差距就比较明显。</p><h3 id="对于复杂动画效果-使用绝对定位让其脱离文档流"><a href="#对于复杂动画效果-使用绝对定位让其脱离文档流" class="headerlink" title="对于复杂动画效果,使用绝对定位让其脱离文档流"></a>对于复杂动画效果,使用绝对定位让其脱离文档流</h3><p>对于复杂动画效果，由于会经常的引起回流重绘，因此，我们可以使用绝对定位，让它脱离文档流。否则会引起父元素以及后续元素频繁的回流。这个我们就直接上个<a href="https://chenjigeng.github.io/example/share/%E9%81%BF%E5%85%8D%E5%9B%9E%E6%B5%81%E9%87%8D%E7%BB%98/%E5%B0%86%E5%A4%8D%E6%9D%82%E5%8A%A8%E7%94%BB%E6%B5%AE%E5%8A%A8%E5%8C%96.html" target="_blank" rel="noopener">例子</a>。</p><p>打开这个例子后，我们可以打开控制台，控制台上会输出当前的帧数(虽然不准)。</p><p><img src="/2019/07/29/你真的了解回流和重绘吗/4.png" alt="image-20181210223750055"></p><p>从上图中，我们可以看到，帧数一直都没到60。这个时候，只要我们点击一下那个按钮，把这个元素设置为绝对定位，帧数就可以稳定60。</p><h3 id="css3硬件加速（GPU加速）"><a href="#css3硬件加速（GPU加速）" class="headerlink" title="css3硬件加速（GPU加速）"></a>css3硬件加速（GPU加速）</h3><p>比起考虑如何减少回流重绘，我们更期望的是，根本不要回流重绘。这个时候，css3硬件加速就闪亮登场啦！！</p><p><strong>划重点：使用css3硬件加速，可以让transform、opacity、filters这些动画不会引起回流重绘 。但是对于动画的其它属性，比如background-color这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。</strong></p><p>本篇文章只讨论如何使用，暂不考虑其原理，之后有空会另外开篇文章说明。</p><h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><p>常见的触发硬件加速的css属性：</p><ul><li>transform</li><li>opacity</li><li>filters</li><li>Will-change</li></ul><h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><p>我们可以先看个<a href="https://chenjigeng.github.io/example/share/%E5%AF%B9%E6%AF%94gpu%E5%8A%A0%E9%80%9F/gpu%E5%8A%A0%E9%80%9F-transform.html" target="_blank" rel="noopener">例子</a>。我通过使用chrome的Performance捕获了一段时间的回流重绘情况，实际结果如下图：</p><p><img src="/2019/07/29/你真的了解回流和重绘吗/5.png" alt="image-20181210225609533"></p><p>从图中我们可以看出，在动画进行的时候，没有发生任何的回流重绘。如果感兴趣你也可以自己做下实验。</p><h4 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h4><ul><li>使用css3硬件加速，可以让transform、opacity、filters这些动画不会引起回流重绘 </li><li>对于动画的其它属性，比如background-color这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。</li></ul><h4 id="css3硬件加速的坑"><a href="#css3硬件加速的坑" class="headerlink" title="css3硬件加速的坑"></a>css3硬件加速的坑</h4><ul><li><p>如果你为太多元素使用css3硬件加速，会导致内存占用较大，会有性能问题。</p></li><li><p>在GPU渲染字体会导致抗锯齿无效。这是因为GPU和CPU的算法不同。因此如果你不在动画结束的时候关闭硬件加速，会产生字体模糊。</p></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文主要讲了浏览器的渲染过程、浏览器的优化机制以及如何减少甚至避免回流和重绘，希望可以帮助大家更好的理解回流重绘。</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul><li><p><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn" target="_blank" rel="noopener">渲染树构建、布局及绘制</a></p></li><li><p>高性能Javascript</p></li></ul><p>文章出处-&gt;<a href="https://github.com/chenjigeng/blog" target="_blank" rel="noopener">博客地址</a>, 欢迎给个 start 或 follow</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>模块化CommonJS与AMD的手写实现</title>
      <link href="/2019/07/24/%E6%A8%A1%E5%9D%97%E5%8C%96CommonJS%E4%B8%8EAMD%E7%9A%84%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0/"/>
      <url>/2019/07/24/%E6%A8%A1%E5%9D%97%E5%8C%96CommonJS%E4%B8%8EAMD%E7%9A%84%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>javascript模块化CommonJS与AMD是如何实现的<br><a id="more"></a></p><h2 id="模块化CommonJS与AMD的手写实现"><a href="#模块化CommonJS与AMD的手写实现" class="headerlink" title="模块化CommonJS与AMD的手写实现"></a>模块化CommonJS与AMD的手写实现</h2><p>现在的前端开发都采用的模块化思想，之前都是使用全局变量，但是弊端这里就不过多描述了。<br>模块化有CommonJS,AMD,CMD,ES6的模块新规范这4种，今天我们来实现以下CommonJS和AMD的规范。</p><h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h3><p>首先，CommonJS一般都用在nodejs里，写法如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="keyword">const</span> someFun= <span class="built_in">require</span>(<span class="string">'./moduleA'</span>);</span><br><span class="line">someFun();</span><br><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = someFunc;</span><br></pre></td></tr></table></figure></p><p>我们来看一下简单的实现方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">let</span> b = req(<span class="string">'./b.js'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">req</span>(<span class="params">mod</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> filename = path.join(__dirname, mod);</span><br><span class="line">    <span class="keyword">let</span> content = fs.readFileSync(filename, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="keyword">let</span> fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'exports'</span>, <span class="string">'require'</span>, <span class="string">'module'</span>, <span class="string">'__filename'</span>, <span class="string">'__dirname'</span>, content + <span class="string">'\n return module.exports;'</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">        exports: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fn(<span class="built_in">module</span>.exports, req, <span class="built_in">module</span>, __filename, __dirname);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'bbb'</span>);</span><br><span class="line">exports.name = <span class="string">'zfpx'</span>;</span><br></pre></td></tr></table></figure></p><h3 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h3><p>我们再来看看AMD规范，AMD规范的实现库是大名鼎鼎requirejs<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个模块</span></span><br><span class="line">define(<span class="string">'a'</span>, [], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'a'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">define(<span class="string">'b'</span>, [<span class="string">'a'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + <span class="string">'b'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 导入和使用</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'b'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>简单的实现<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> factories = &#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">define</span>(<span class="params">modName, dependencies, factory</span>) </span>&#123;</span><br><span class="line">    factory.dependencies = dependencies;</span><br><span class="line">    factories[modName] = factory;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">modNames, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> loadedModNames = modNames.map(<span class="function"><span class="keyword">function</span> (<span class="params">modName</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> factory = factories[modName];</span><br><span class="line">        <span class="keyword">let</span> dependencies = factory.dependencies;</span><br><span class="line">        <span class="keyword">let</span> exports;</span><br><span class="line">        <span class="built_in">require</span>(dependencies, <span class="function"><span class="keyword">function</span> (<span class="params">...dependencyMods</span>) </span>&#123;</span><br><span class="line">            exports = factory.apply(<span class="literal">null</span>, dependencyMods);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> exports;</span><br><span class="line">    &#125;)</span><br><span class="line">    callback.apply(<span class="literal">null</span>, loadedModNames);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ES6-模块化"><a href="#ES6-模块化" class="headerlink" title="ES6 模块化"></a>ES6 模块化</h3><p>ES6 模块化是ECMA提出的JavaScript模块化规范，它在语言的层面上实现了模块化。浏览器厂商和Node.js 都宣布要原生支持该规范。它将逐渐取代CommonJS和AMD`规范，成为浏览器和服务器通用的模块解决方案。 采用 ES6 模块化导入及导出时的代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'./person.js'</span>;</span><br><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">'zfpx'</span>;</span><br></pre></td></tr></table></figure></p><p>ES6模块虽然是终极模块化方案，但它的缺点在于目前无法直接运行在大部分 JavaScript 运行环境下，必须通过工具转换成标准的 ES5 后才能正常运行。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript的FileReader类</title>
      <link href="/2019/07/24/javascript%E7%9A%84FileReader%E7%B1%BB/"/>
      <url>/2019/07/24/javascript%E7%9A%84FileReader%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>javascript的FileReader类<br><a id="more"></a></p><h1 id="javascript的FileReader类"><a href="#javascript的FileReader类" class="headerlink" title="javascript的FileReader类"></a>javascript的FileReader类</h1><h2 id="2019-07-24内容"><a href="#2019-07-24内容" class="headerlink" title="2019-07-24内容"></a>2019-07-24内容</h2><p>现在，我们在前端对文件处理的需求已经慢慢增加了，比如，前端上传图片的回显，还有excel文件的解析等，都需要FileReader这个类来实现，这个类有4个方法:</p><ul><li>FileReader.readAsBinaryString(Blob|File)</li><li>FileReader.readAsText(Blob|File, opt_encoding)</li><li>FileReader.readAsDataURL(Blob|File)</li><li>FileReader.readAsArrayBuffer(Blob|File)</li></ul><hr><p>这里，具体的使用方法不过多介绍，详情<a href="https://www.html5rocks.com/en/tutorials/file/dndfiles/" target="_blank" rel="noopener">点击这里</a></p><h2 id="2019-10-29追加内容"><a href="#2019-10-29追加内容" class="headerlink" title="2019-10-29追加内容"></a>2019-10-29追加内容</h2><h3 id="readAsArrayBuffer-gt-ArrayBuffer"><a href="#readAsArrayBuffer-gt-ArrayBuffer" class="headerlink" title="readAsArrayBuffer=&gt;ArrayBuffer"></a>readAsArrayBuffer=&gt;ArrayBuffer</h3><p>二进制数据的存储器,可通过ArrayBufferView以8位、16位、32位、64位数字为元素对ArrayBuffer内的二进制数据进行展现。可用于生成Blob,然后添加到FormData去上传。</p><h3 id="readAsBinaryString-gt-BinaryString"><a href="#readAsBinaryString-gt-BinaryString" class="headerlink" title="readAsBinaryString =&gt;BinaryString"></a>readAsBinaryString =&gt;BinaryString</h3><p>是二进制数据直接以byte的形式展现的字符串,ArrayBuffer对应的Uint8Array的字符形式的表现</p><h3 id="readAsDataURL-gt-DataURL"><a href="#readAsDataURL-gt-DataURL" class="headerlink" title="readAsDataURL =&gt;DataURL"></a>readAsDataURL =&gt;DataURL</h3><p>包括mimeType和base64编码后的binaryString,可以直接给<img src>使用：data:[mimeType];base64,[base64(binaryString)]可借此获取mimeType和binaryStringvar binaryString = atob(dataUrl.split(‘,’)[1]),mimeType = dataUrl.split(‘,’)[0].match(/:(.*?);/)[1];</p><h3 id="说一个截图上传的小例子"><a href="#说一个截图上传的小例子" class="headerlink" title="说一个截图上传的小例子"></a>说一个截图上传的小例子</h3><ul><li>canvas截图并使用toDataURL,获取DataURL</li><li>通过binaryString = atob(dataUrl.split(‘,’)[1])获取BinaryString</li><li>通过Uint8Array和charCodeAt把binaryString转化为ArrayBuffer</li><li>ArrayBuffer存入Blob并添加到FormData上传,服务器最终收到BinaryString</li></ul><p>注意,formdata在send时必须使用ArrayBuffer,因为BinaryString为字符串,当send发送时会对字符串进行utf8编码导致数据被破坏。<br>demo:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;form name=<span class="string">'test'</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">'file'</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</span><br><span class="line">  &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">  &lt;img src="" alt=""&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var img = document.querySelector('img'),</span></span><br><span class="line"><span class="regexp">        preview;</span></span><br><span class="line"><span class="regexp">    document.test.file.addEventListener('change', function() &#123;</span></span><br><span class="line"><span class="regexp">      var fr = new FileReader();</span></span><br><span class="line"><span class="regexp">      fr.onload = function() &#123;</span></span><br><span class="line"><span class="regexp">        preview = this.result;</span></span><br><span class="line"><span class="regexp">        img.src = preview;</span></span><br><span class="line"><span class="regexp">      &#125;;</span></span><br><span class="line"><span class="regexp">      fr.readAsDataURL(this.files[0]);</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">    document.test.addEventListener('submit', function(e) &#123;</span></span><br><span class="line"><span class="regexp">      e.preventDefault();</span></span><br><span class="line"><span class="regexp">      var binaryString = atob(preview.split(',')[1]),</span></span><br><span class="line"><span class="regexp">          mimeType = preview.split(',')[0].match(/</span>:(.*?);<span class="regexp">/)[1],</span></span><br><span class="line"><span class="regexp">          length = binaryString.length,</span></span><br><span class="line"><span class="regexp">          u8arr = new Uint8Array(length),</span></span><br><span class="line"><span class="regexp">          blob,</span></span><br><span class="line"><span class="regexp">          fd = new FormData(),</span></span><br><span class="line"><span class="regexp">          xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="regexp">      while(length--) &#123;</span></span><br><span class="line"><span class="regexp">        u8arr[length] = binaryString.charCodeAt(length);</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      blob = new Blob([u8arr.buffer], &#123;type: mimeType&#125;);</span></span><br><span class="line"><span class="regexp">      fd.append('file', blob);</span></span><br><span class="line"><span class="regexp">      xhr.open('post', '/u</span>pload<span class="string">');</span></span><br><span class="line"><span class="string">      xhr.send(fd);</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端利用hammer制作移动缩放旋转功能</title>
      <link href="/2019/07/16/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%88%A9%E7%94%A8hammer%E5%88%B6%E4%BD%9C%E7%A7%BB%E5%8A%A8%E7%BC%A9%E6%94%BE%E6%97%8B%E8%BD%AC%E5%8A%9F%E8%83%BD/"/>
      <url>/2019/07/16/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%88%A9%E7%94%A8hammer%E5%88%B6%E4%BD%9C%E7%A7%BB%E5%8A%A8%E7%BC%A9%E6%94%BE%E6%97%8B%E8%BD%AC%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<p>移动端利用hammer制作移动缩放旋转功能<br><a id="more"></a></p><h2 id="移动端利用hammer制作移动缩放旋转功能"><a href="#移动端利用hammer制作移动缩放旋转功能" class="headerlink" title="移动端利用hammer制作移动缩放旋转功能"></a>移动端利用hammer制作移动缩放旋转功能</h2><p>最近在项目中，有个需求是页面放大，我二话不说，直接把viewport的user-scalable属性设为yes，这倒是勉强的完成了需求的要求，但是这只是整个页面的缩放，而且初始上来的页面只能放大，并不能缩小，如果再加点需求，局部放大，这就挂了。。。。。。<br>于是乎，这几天有空闲的时候补了补关于移动端手势事件的一些知识，为了完成这几项功能，最终选了hammer这个插件，其实这类插件很多，大同小异，选一个稳定点，普及广的，还在维护的就行。当然了，不用插件，自己用原生的touchstart,touchmove,touchend事件也可以完成，但是各种算法还是很复杂的。<br>下面是几个例子：</p><h3 id="元素的缩放"><a href="#元素的缩放" class="headerlink" title="元素的缩放"></a>元素的缩放</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>hammer.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;!-- &lt;script src="</span>./vconsole.min.js<span class="string">"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="string">  &lt;style&gt;</span></span><br><span class="line"><span class="string">    #myElement &#123;</span></span><br><span class="line"><span class="string">      background: silver;</span></span><br><span class="line"><span class="string">      height: 300px;</span></span><br><span class="line"><span class="string">      text-align: center;</span></span><br><span class="line"><span class="string">      font: 30px/300px Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div id="</span>myElement<span class="string">"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">// var vConsole = new VConsole();</span></span><br><span class="line"><span class="string">  var scale = 1, old_scale;</span></span><br><span class="line"><span class="string">  var myElement = document.getElementById('myElement');</span></span><br><span class="line"><span class="string">  var mc = new Hammer.Manager(myElement);</span></span><br><span class="line"><span class="string">  // pinch</span></span><br><span class="line"><span class="string">  var pinch = new Hammer.Pinch();</span></span><br><span class="line"><span class="string">  // add to the Manager</span></span><br><span class="line"><span class="string">  mc.add([pinch]);</span></span><br><span class="line"><span class="string">  // pinch事件</span></span><br><span class="line"><span class="string">  mc.on("</span>pinchstart<span class="string">", function(ev) &#123;</span></span><br><span class="line"><span class="string">    // 注意这里1</span></span><br><span class="line"><span class="string">    old_scale = scale;</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  mc.on("</span>pinchmove<span class="string">", function(ev) &#123;</span></span><br><span class="line"><span class="string">    // 注意这里2</span></span><br><span class="line"><span class="string">    scale =ev.scale + old_scale-1;</span></span><br><span class="line"><span class="string">    // myElement.style.transform = `scale($&#123;scale&#125;)`;</span></span><br><span class="line"><span class="string">    updateTransform();</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  // 更新样式函数</span></span><br><span class="line"><span class="string">  function updateTransform() &#123;</span></span><br><span class="line"><span class="string">    var val = [</span></span><br><span class="line"><span class="string">      `scale($&#123;scale&#125;)`</span></span><br><span class="line"><span class="string">      // `rotate(`+deg+`deg)`</span></span><br><span class="line"><span class="string">    ];</span></span><br><span class="line"><span class="string">    myElement.style.transform = val.join(' ');</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><h3 id="元素的旋转"><a href="#元素的旋转" class="headerlink" title="元素的旋转"></a>元素的旋转</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>hammer.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;!-- &lt;script src="</span>./vconsole.min.js<span class="string">"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="string">  &lt;style&gt;</span></span><br><span class="line"><span class="string">    #myElement &#123;</span></span><br><span class="line"><span class="string">      background: silver;</span></span><br><span class="line"><span class="string">      height: 300px;</span></span><br><span class="line"><span class="string">      text-align: center;</span></span><br><span class="line"><span class="string">      font: 30px/300px Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div id="</span>myElement<span class="string">"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">// var vConsole = new VConsole();</span></span><br><span class="line"><span class="string">  var deg = 0, init_deg=0, rotate_deg, start_deg, pre_deg, flag_deg;</span></span><br><span class="line"><span class="string">  var myElement = document.getElementById('myElement');</span></span><br><span class="line"><span class="string">  var mc = new Hammer.Manager(myElement);</span></span><br><span class="line"><span class="string">  // rotate</span></span><br><span class="line"><span class="string">  var rotate = new Hammer.Rotate();</span></span><br><span class="line"><span class="string">  // add to the Manager</span></span><br><span class="line"><span class="string">  mc.add([rotate]);</span></span><br><span class="line"><span class="string">  // rotate事件</span></span><br><span class="line"><span class="string">  mc.on("</span>rotatestart<span class="string">", function(ev) &#123;</span></span><br><span class="line"><span class="string">    // 注意这里1</span></span><br><span class="line"><span class="string">    start_deg = ev.rotation; // 开始旋转时记录下当前rotation的角度</span></span><br><span class="line"><span class="string">    flag_deg = 0;</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  mc.on("</span>rotatemove<span class="string">", function(ev) &#123;</span></span><br><span class="line"><span class="string">    // 注意这里2</span></span><br><span class="line"><span class="string">    rotate_deg = ev.rotation - start_deg; // rotation的角度减去开始旋转的角度就是转过了多少角度</span></span><br><span class="line"><span class="string">    deg = init_deg + rotate_deg; // 元素旋转之前的角度 + 旋转了多少角度是当前元素的状态</span></span><br><span class="line"><span class="string">    // myElement.style.transform = `rotate(`+deg+`deg)`;</span></span><br><span class="line"><span class="string">    updateTransform();</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  mc.on("</span>rotateend<span class="string">", function(ev) &#123;</span></span><br><span class="line"><span class="string">    // 注意这里3</span></span><br><span class="line"><span class="string">      init_deg = deg; // 旋转结束时别忘了把当前角度状态赋值给初始化角度，以便下次旋转时接着上次的角度转</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  // 更新样式函数</span></span><br><span class="line"><span class="string">  function updateTransform() &#123;</span></span><br><span class="line"><span class="string">    var val = [</span></span><br><span class="line"><span class="string">      // `scale($&#123;scale&#125;)`</span></span><br><span class="line"><span class="string">      `rotate(`+deg+`deg)`</span></span><br><span class="line"><span class="string">    ];</span></span><br><span class="line"><span class="string">    myElement.style.transform = val.join(' ');</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p>最后，附上一个拖拽，缩放，旋转的</p><h3 id="拖拽，缩放，旋转"><a href="#拖拽，缩放，旋转" class="headerlink" title="拖拽，缩放，旋转"></a>拖拽，缩放，旋转</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>hammer.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;!-- &lt;script src="</span>./vconsole.min.js<span class="string">"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="string">  &lt;style&gt;</span></span><br><span class="line"><span class="string">    #myElement &#123;</span></span><br><span class="line"><span class="string">      background: silver;</span></span><br><span class="line"><span class="string">      width: 250px;</span></span><br><span class="line"><span class="string">      height: 250px;</span></span><br><span class="line"><span class="string">      text-align: center;</span></span><br><span class="line"><span class="string">      font: 30px/300px Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div id="</span>myElement<span class="string">"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">  var reqAnimationFrame = (function () &#123;</span></span><br><span class="line"><span class="string">      return window[Hammer.prefixed(window, 'requestAnimationFrame')] || function (callback) &#123;</span></span><br><span class="line"><span class="string">          window.setTimeout(callback, 1000 / 60);</span></span><br><span class="line"><span class="string">      &#125;;</span></span><br><span class="line"><span class="string">  &#125;)();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  var el = document.querySelector("#myElement");</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> START_X = <span class="built_in">Math</span>.round((<span class="built_in">window</span>.innerWidth - el.offsetWidth) / <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">var</span> START_Y = <span class="built_in">Math</span>.round((<span class="built_in">window</span>.innerHeight - el.offsetHeight) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ticking = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> transform;   <span class="comment">//图像效果</span></span><br><span class="line">  <span class="keyword">var</span> timer;</span><br><span class="line">  <span class="keyword">var</span> initAngle = <span class="number">0</span>;  <span class="comment">//旋转角度</span></span><br><span class="line">  <span class="keyword">var</span> initScale = <span class="number">1</span>;  <span class="comment">//放大倍数</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> mc = <span class="keyword">new</span> Hammer.Manager(el);   <span class="comment">//用管理器  可以同时触发旋转 拖拽  移动</span></span><br><span class="line">  <span class="comment">//var mc = new Hammer(el);      //旋转和移动互斥</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  ev.srcEvent.type  touchstart  touchend touchmove</span></span><br><span class="line"><span class="comment">  ev.deltaX  手势移动位移变量  </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  mc.add(<span class="keyword">new</span> Hammer.Pan(&#123; <span class="attr">threshold</span>: <span class="number">0</span>, <span class="attr">pointers</span>: <span class="number">0</span> &#125;));  </span><br><span class="line">  mc.add(<span class="keyword">new</span> Hammer.Rotate(&#123; <span class="attr">threshold</span>: <span class="number">0</span> &#125;)).recognizeWith(mc.get(<span class="string">'pan'</span>));</span><br><span class="line">  mc.add(<span class="keyword">new</span> Hammer.Pinch(&#123; <span class="attr">threshold</span>: <span class="number">0</span> &#125;)).recognizeWith([mc.get(<span class="string">'pan'</span>), mc.get(<span class="string">'rotate'</span>)]);</span><br><span class="line">  <span class="comment">//结束时做一些处理</span></span><br><span class="line">  mc.on(<span class="string">"hammer.input"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(ev.isFinal) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(START_X+<span class="string">"  "</span>+transform.translate.x  +<span class="string">"   "</span>+ev.deltaX);</span><br><span class="line">    START_X = transform.translate.x ;</span><br><span class="line">    START_Y = transform.translate.y ;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;);</span><br><span class="line">  mc.on(<span class="string">"panstart panmove"</span>, onPan);</span><br><span class="line">  mc.on(<span class="string">"rotatestart rotatemove rotateend"</span>, onRotate);</span><br><span class="line">  mc.on(<span class="string">"pinchstart pinchmove"</span>, onPinch);</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  第二次进入拖拽时  delta位移重置</span></span><br><span class="line"><span class="comment">  移动时 初始位置startxy不动。delta增加</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onPan</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!ev.isFinal) &#123;</span><br><span class="line">     el.className = <span class="string">''</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(START_X   +<span class="string">"  "</span>+  START_Y +<span class="string">" |  "</span>+ev.deltaX   +<span class="string">"  "</span>+  ev.deltaY);</span><br><span class="line">        transform.translate = &#123;</span><br><span class="line">          x: START_X + ev.deltaX,</span><br><span class="line">          y: START_Y + ev.deltaY</span><br><span class="line">        &#125;;</span><br><span class="line">        requestElementUpdate();</span><br><span class="line">    &#125;   </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onPinch</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ev.type == <span class="string">'pinchstart'</span>) &#123;</span><br><span class="line">      initScale = transform.scale || <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    el.className = <span class="string">''</span>;</span><br><span class="line">    transform.scale = initScale * ev.scale;</span><br><span class="line">    requestElementUpdate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//旋转相关</span></span><br><span class="line">  <span class="keyword">var</span>  preAngle =<span class="number">0</span> ;</span><br><span class="line">  <span class="keyword">var</span>  tempAngleFlag=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span>  deltaAngle = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span>  startRotateAngle = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRotate</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//点下第二个触控点时触发</span></span><br><span class="line">      <span class="keyword">if</span>(ev.type == <span class="string">'rotatestart'</span>) &#123;    </span><br><span class="line">        startRotateAngle =  ev.rotation ; </span><br><span class="line">        tempAngleFlag = <span class="number">0</span> ;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">if</span>(ev.type == <span class="string">'rotatemove'</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(tempAngleFlag == <span class="number">0</span>)&#123;</span><br><span class="line">        preAngle = startRotateAngle;</span><br><span class="line">        tempAngleFlag ++;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        deltaAngle = ev.rotation - preAngle;</span><br><span class="line">        el.className = <span class="string">''</span>;</span><br><span class="line">        transform.rz = <span class="number">1</span>;  <span class="comment">//非0  垂直xy轴</span></span><br><span class="line">        transform.angle =initAngle + deltaAngle;</span><br><span class="line">        requestElementUpdate();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//旋转结束  记录当前图片角度</span></span><br><span class="line">    <span class="keyword">if</span>(ev.type ==<span class="string">'rotateend'</span>)&#123;</span><br><span class="line">      initAngle = transform.angle;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateElementTransform</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> value = [</span><br><span class="line">                  <span class="string">'translate3d('</span> + transform.translate.x + <span class="string">'px, '</span> + transform.translate.y + <span class="string">'px, 0)'</span>,</span><br><span class="line">                  <span class="string">'scale('</span> + transform.scale + <span class="string">', '</span> + transform.scale + <span class="string">')'</span>,</span><br><span class="line">                  <span class="string">'rotate3d('</span>+ transform.rx +<span class="string">','</span>+ transform.ry +<span class="string">','</span>+ transform.rz +<span class="string">','</span>+  transform.angle + <span class="string">'deg)'</span></span><br><span class="line">      ];</span><br><span class="line"></span><br><span class="line">      value = value.join(<span class="string">" "</span>);</span><br><span class="line">      el.style.webkitTransform = value;  <span class="comment">/*为Chrome/Safari*/</span></span><br><span class="line">      el.style.mozTransform = value; <span class="comment">/*为Firefox*/</span></span><br><span class="line">      el.style.transform = value; <span class="comment">/*IE Opera?*/</span></span><br><span class="line">      ticking = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">requestElementUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(!ticking) &#123;</span><br><span class="line">          reqAnimationFrame(updateElementTransform);</span><br><span class="line">          ticking = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  初始化设置</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resetElement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      el.className = <span class="string">'animate'</span>;</span><br><span class="line">     transform = &#123;</span><br><span class="line">          translate: &#123; <span class="attr">x</span>: START_X, <span class="attr">y</span>: START_Y &#125;,</span><br><span class="line">          scale: <span class="number">1</span>,</span><br><span class="line">          angle: <span class="number">0</span>,</span><br><span class="line">          rx: <span class="number">0</span>,</span><br><span class="line">          ry: <span class="number">0</span>,</span><br><span class="line">          rz: <span class="number">0</span></span><br><span class="line">      &#125;;</span><br><span class="line">      requestElementUpdate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  resetElement();</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure><p>最后，附上github源码地址，<a href="https://github.com/jinux7/study-collections/tree/master/移动端利用hammer制作移动缩放旋转功能" target="_blank" rel="noopener">点这里</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实现一个串行异步执行类</title>
      <link href="/2019/07/08/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%B8%B2%E8%A1%8C%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E7%B1%BB/"/>
      <url>/2019/07/08/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%B8%B2%E8%A1%8C%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>写一个按顺序执行操作的类工具<br><a id="more"></a></p><h2 id="实现一个串行异步执行类"><a href="#实现一个串行异步执行类" class="headerlink" title="实现一个串行异步执行类"></a>实现一个串行异步执行类</h2><p>今天在学习webpack源码时，看到了webpack的核心模块tapable，里边有很多方法，其中之一就是串行异步执行方法，于是，自己准备实现一个简单的，其实很简单，见下面的代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明类SerialAsync</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SerialAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.arrFns = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 原型链上添加addFn方法</span></span><br><span class="line">SerialAsync.prototype.addFn = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.arrFns.push(fn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 原型链上添加emitFn方法</span></span><br><span class="line">SerialAsync.prototype.emitFn = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// next是核心代码</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">par</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fn = self.arrFns[index++];</span><br><span class="line">    fn?fn(next):callback(par);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// SerialAsync结束</span></span><br><span class="line"><span class="comment">// 是不是超级的简单，就15行代码，记住，核心代码是next方法</span></span><br><span class="line"><span class="comment">// 下面是具体的使用</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> SerialAsync();</span><br><span class="line">s.addFn(<span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    done(<span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;);</span><br><span class="line">s.addFn(<span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    done(<span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">s.addFn(<span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>);</span><br><span class="line">    done(<span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.time();</span><br><span class="line">s.emitFn(<span class="function">(<span class="params">par</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over-&gt;'</span>, par);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>可以看到，最关键部分就是next函数，有个递归的过程，据说，nodejs中很多类似的串行方法都是这么实现的，一定要记住哦。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js中小数精度问题</title>
      <link href="/2019/07/04/js%E4%B8%AD%E5%B0%8F%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/"/>
      <url>/2019/07/04/js%E4%B8%AD%E5%B0%8F%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>js中的小数精度问题分析<br><a id="more"></a></p><h2 id="js中小数精度问题"><a href="#js中小数精度问题" class="headerlink" title="js中小数精度问题"></a>js中小数精度问题</h2><p>我们在日常开发中，是否遇到过0.1+0.2，一看马上答案就出来了，0.3啊，多么简单的加法，但是，如果你在代码里运行一下，结果出乎意料哦，是0.30000000000000004，哈哈，有意思吧，不仅在js中这样，java，python等语言都是这个德行。<br>奇怪了，这是为什么呢？这就需要了解一下小数在计算机中的存储方式了。<br>我在这里只说小数部分的保存方式。<br>先来说一下小数如何存储，如0.6：</p><ul><li>将该数字乘以2，取出整数部分作为二进制表示的第1位；然后再将小数部分乘以2，将得到的整数部分作为二进制表示的第2位；以此类推，直到小数部分为0。 </li><li>特殊情况： 小数部分出现循环，无法停止，则用有限的二进制位无法准确表示一个小数，这也是在编程语言中表示小数会出现误差的原因<br>再具体的分步骤看一下：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.6</span> * <span class="number">2</span> = <span class="number">1.2</span> —————— <span class="number">1</span> </span><br><span class="line"><span class="number">0.2</span> * <span class="number">2</span> = <span class="number">0.4</span> —————— <span class="number">0</span> </span><br><span class="line"><span class="number">0.4</span> * <span class="number">2</span> = <span class="number">0.8</span> —————— <span class="number">0</span> </span><br><span class="line"><span class="number">0.8</span> * <span class="number">2</span> = <span class="number">1.6</span> —————— <span class="number">1</span> </span><br><span class="line"><span class="number">0.6</span> * <span class="number">2</span> = <span class="number">1.2</span> —————— <span class="number">1</span> </span><br><span class="line">…………</span><br></pre></td></tr></table></figure></li></ul><p>我们可以发现在该计算中已经出现了循环，0.6用二进制表示为 1001 1001 1001 1001 ……<br>如果是10.6，那个10.6的完整二进制表示为 1010.100110011001……<br>通过上边的解释，就知道为什么有的小数在js里会出现精度不准的问题了吧，接下来，我们再看看二进制小数如何还原成十进制。<br>我们还拿0.6这个小数来举例子,1001 1001 1001 1001 :</p><ul><li>从左到右，v[i] * 2^( - i ), i 为从左到右的index，v[i]为该位的值，直接看例子，很直接的<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.6</span> = <span class="number">1</span> * <span class="number">2</span>^<span class="number">-1</span> + <span class="number">0</span> * <span class="number">2</span>^<span class="number">-2</span> + <span class="number">0</span> * <span class="number">2</span>^<span class="number">-3</span> + <span class="number">1</span> * <span class="number">2</span>^<span class="number">-4</span> + ……</span><br></pre></td></tr></table></figure></li></ul><p>好了，通过上面大概的了解了小数为什么精度有时候不准的问题，这也只是粗略的理解一下而已，具体在各种语言中运行时可能情况会很复杂，我就点到而止了。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js中的递归总结</title>
      <link href="/2019/07/02/js%E4%B8%AD%E7%9A%84%E9%80%92%E5%BD%92%E6%80%BB%E7%BB%93/"/>
      <url>/2019/07/02/js%E4%B8%AD%E7%9A%84%E9%80%92%E5%BD%92%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>js中各种递归的知识总结<br><a id="more"></a></p><h2 id="js中的递归总结"><a href="#js中的递归总结" class="headerlink" title="js中的递归总结"></a>js中的递归总结</h2><p>递归，在我们平时编程中用到的地方很多，但是，对我而然，它是又熟悉又陌生，也就是说，不能熟练地应用到具体的实际业务代码中，所以，我想好好总结总结，以便可以更好地使用它。</p><h3 id="数字递归-最简单的入门"><a href="#数字递归-最简单的入门" class="headerlink" title="数字递归(最简单的入门)"></a>数字递归(最简单的入门)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加法的递归</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (num === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> num + sum(--num)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">4</span>); <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 再来一个阶乘的递归</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(num === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num*fn(num<span class="number">-1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">5</span>) <span class="comment">// 120</span></span><br></pre></td></tr></table></figure><h3 id="数组递归"><a href="#数组递归" class="headerlink" title="数组递归"></a>数组递归</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组中的各个元素相加之和</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(arr.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr[<span class="number">0</span>];</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> val = arr.shift();</span><br><span class="line">    <span class="keyword">return</span> val + fn(arr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]) <span class="comment">// 55</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将嵌套的多维数组转成一纬数组</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,[<span class="number">7</span>,[<span class="number">8</span>,[<span class="number">9</span>,<span class="number">10</span>]]]],<span class="number">11</span>,[<span class="number">12</span>]];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformArr</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  recursiveArr(arr, newArr);</span><br><span class="line">  <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recursiveArr</span>(<span class="params">arr, newArr</span>) </span>&#123;</span><br><span class="line">  arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(item <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">      recursiveArr(item, newArr);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      newArr.push(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(transformArr(arr), <span class="string">'@_@'</span>);</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一纬数组，元素都是对象，互相有父子关系，将这些数组转换成父子结构的对象格式</span></span><br><span class="line"><span class="comment">// 数据，parentId是其父节点的id </span></span><br><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据1'</span>,</span><br><span class="line">    id: <span class="number">11</span>,</span><br><span class="line">    parentId: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据2'</span>,</span><br><span class="line">    id: <span class="number">12</span>,</span><br><span class="line">    parentId: <span class="number">11</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据3'</span>,</span><br><span class="line">    id: <span class="number">13</span>,</span><br><span class="line">    parentId: <span class="number">11</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据4'</span>,</span><br><span class="line">    id: <span class="number">14</span>,</span><br><span class="line">    parentId: <span class="number">12</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据5'</span>,</span><br><span class="line">    id: <span class="number">15</span>,</span><br><span class="line">    parentId: <span class="number">13</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据6'</span>,</span><br><span class="line">    id: <span class="number">16</span>,</span><br><span class="line">    parentId: <span class="number">15</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据7'</span>,</span><br><span class="line">    id: <span class="number">17</span>,</span><br><span class="line">    parentId: <span class="number">16</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'数据8'</span>,</span><br><span class="line">    id: <span class="number">18</span>,</span><br><span class="line">    parentId: <span class="number">16</span></span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">// transformData这个函数是辅助生成对象的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformData</span>(<span class="params">data, parentId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">    children: []</span><br><span class="line">  &#125;;</span><br><span class="line">  generaterTree(data, obj, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// generaterTree这个函数是递归调用的核心函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generaterTree</span>(<span class="params">data, obj, parentId</span>) </span>&#123;</span><br><span class="line">  data.forEach(<span class="function"><span class="params">item</span>=&gt;</span> &#123;</span><br><span class="line">    item.children = item.children?item.children:[];</span><br><span class="line">    <span class="keyword">if</span>(item.parentId === parentId) &#123;</span><br><span class="line">      obj.children.push(item);</span><br><span class="line">      generaterTree(data, item, item.id); <span class="comment">// 继续递归回调</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(transformData(data));</span><br></pre></td></tr></table></figure><h3 id="对象的递归"><a href="#对象的递归" class="headerlink" title="对象的递归"></a>对象的递归</h3><p>其实，对象的递归里边也包含了数组等的一些基础型数据，我们常用的就是对象的深拷贝<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"jinux"</span>,</span><br><span class="line">  <span class="string">"like"</span>: [<span class="string">"football"</span>,<span class="string">"basketball"</span>,<span class="string">"voliball"</span>],</span><br><span class="line">  <span class="string">"work"</span>: &#123;</span><br><span class="line">    <span class="string">"company"</span>: <span class="string">"technology"</span>,</span><br><span class="line">    <span class="string">"address"</span>: <span class="string">"hunnan"</span>,</span><br><span class="line">    <span class="string">"tongshi"</span>: [<span class="string">"lining"</span>,<span class="string">"lvnan"</span>],</span><br><span class="line">    <span class="string">"isLeader"</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> data !== <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(data === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">Object</span>.prototype.toString.call(data)===<span class="string">'[object Array]'</span>?</span><br><span class="line">            []:&#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">    obj[key] = <span class="built_in">arguments</span>.callee(data[key]);</span><br><span class="line">    <span class="comment">// obj[key] = deepClone(data[key]); 与上边的一个意思</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(deepClone(data), <span class="string">"&lt;-&gt;"</span>);</span><br></pre></td></tr></table></figure></p><p>目前暂时整理这么多，以后会陆续增加递归的小demo.</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速创建含有多个元素的数组</title>
      <link href="/2019/07/01/%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E5%90%AB%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%E7%9A%84%E6%95%B0%E7%BB%84/"/>
      <url>/2019/07/01/%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E5%90%AB%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%E7%9A%84%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<p>快速并且简单的创建数组<br><a id="more"></a></p><h2 id="快速创建含有多个元素的数组"><a href="#快速创建含有多个元素的数组" class="headerlink" title="快速创建含有多个元素的数组"></a>快速创建含有多个元素的数组</h2><p>我们平时在开发时，有时候可能会创建一个包含20个元素的数组，之后对这个数组进行加工操作，来制作一个符合业务要求的数组。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如我要创建一个包含20个元素的数组</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> <span class="number">1</span>=<span class="number">0</span>; i&lt;<span class="number">20</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="literal">undefined</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上面虽然创建了数组，但是感觉麻烦了点。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">20</span>);</span><br><span class="line"><span class="comment">// 这样创建的数组，只是有长度，但是数组里并没有元素</span></span><br><span class="line">arr.length <span class="comment">// 20</span></span><br><span class="line"><span class="number">0</span> <span class="keyword">in</span> arr <span class="comment">// false</span></span><br><span class="line"><span class="comment">// arr 这个数组使用map， forEach等方法是便利不了的</span></span><br><span class="line"><span class="comment">// 创建一个长度为20的数组，注意该数组的元素并没有被初始化</span></span><br></pre></td></tr></table></figure></p><p>好了，有几种方便的创建方式，见下面<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先，看一下vue官网里出现的创建方式</span></span><br><span class="line"><span class="built_in">Array</span>.apply(<span class="literal">null</span>, &#123;<span class="attr">length</span>: <span class="number">20</span>&#125;); <span class="comment">// ES5开始apply函数的第二个参数除了可以是数组外，还可以是类数组对象（即包含length属性，且length属性值是个数字的对象）</span></span><br><span class="line"><span class="comment">// 这里顺便说一下&#123;length: 20&#125;这个参数的作用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="literal">undefined</span>,<span class="literal">undefined</span>,<span class="literal">undefined</span>);</span><br><span class="line">fn.apply(<span class="literal">null</span>, &#123;<span class="attr">length</span>: <span class="number">3</span>&#125;);</span><br><span class="line"><span class="comment">// 通过上面的代码，就可以看出来&#123;length: 3&#125;这个参数的含义了吧</span></span><br></pre></td></tr></table></figure></p><p>最后，总结一下可以快速创建有初始值得数组方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Array</span>.apply(<span class="literal">null</span>, &#123;<span class="attr">length</span>: <span class="number">20</span>&#125;);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="built_in">Array</span>.from(&#123;<span class="attr">length</span>: <span class="number">20</span>&#125;)</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">20</span>).fill(<span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写前端自动化构建工具</title>
      <link href="/2019/06/26/%E6%89%8B%E5%86%99%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
      <url>/2019/06/26/%E6%89%8B%E5%86%99%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>写一个自己的前端自动化构建工具<br><a id="more"></a></p><h2 id="手写前端自动化构建工具"><a href="#手写前端自动化构建工具" class="headerlink" title="手写前端自动化构建工具"></a>手写前端自动化构建工具</h2><p>现在我们使用vue，react等框架来开发已经很普遍了，当我们初始化一个项目的时候，是不是在命令行下按照提示一步一步的操作，最后在本地生成了一个现成的项目，是不是感觉很快捷，很方便，用来生成这个项目的工具就叫做构建工具（有的也称之为脚手架工具）。<br>我现在需要在命令行下进行各种操作，交互，npm上已经有人写好了这类工具，常用的就是commander和inquirer,使用它们来开发脚手架，真的是好简单。<br>我写了两个小demo，一个是围绕着commander，另一个则是围绕inquirer。<br>这两个小例子都很简单，可以根据具体的要求组合到一起。<br><a href="https://github.com/jinux7/study-collections/tree/master/手写自己的构建工具" target="_blank" rel="noopener">点这里看源码</a><br>select-list.js这个文件的功能是，可以根据列表的上下选择，下载github上对应的项目模板。<br>init-commander.js这个文件的功能是，命令行里传入的文件夹名和文件名来生成新项目文件。<br>题外话，这里还可以制作成系统命令，在package.json里的bin字段下。<br>如果，都配置好了，就可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm link</span><br></pre></td></tr></table></figure></p><p>这个命令，把bin字段下的内容生成系统命令，这是一种方式来生成系统命令，另一种应该是把这个项目发布到npm上，安装的时候直接全局安装就可以喽。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript设计模式</title>
      <link href="/2019/06/24/javascript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/24/javascript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>基本上所有的设计模式都在这里了<br><a id="more"></a></p><h2 id="javascript设计模式"><a href="#javascript设计模式" class="headerlink" title="javascript设计模式"></a>javascript设计模式</h2><p>其实，设计模式在前端，平时很少会遇到，这只是作为我们这些菜鸟前端来说，但是，对于那些高级的，写插件，库之类的前端童鞋来说，设计模式还是不可或缺的，这可是实实在在的会带入到项目中的哦。<br>我只知道常见的几种，也都是为了应付面试的时候被问到，不过，今天我要终结一下，代码部分来源于网络，我只是整理一下，以备被问到时能够快速的回答出来。</p><ul><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第一章-灵活的javascript.js" target="_blank" rel="noopener">1.灵活模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二章-写的都是看到的-面向对象编程.js" target="_blank" rel="noopener">2.面向对象编程</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三章-神奇的魔术师-简单工厂模式.js" target="_blank" rel="noopener">3.简单工厂模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第四章-给我一张名片-工厂方法模式.js" target="_blank" rel="noopener">4.工厂方法模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第五章-出现的都是幻觉-抽象工厂模式.js" target="_blank" rel="noopener">5.抽象工厂模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第六章-分即是合-建造者模式.js" target="_blank" rel="noopener">6.建造者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第七章-语言之魂-原型模式.js" target="_blank" rel="noopener">7.原型模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第八章-一个人的寂寞-单例模式.js" target="_blank" rel="noopener">8.单例模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第九章-套餐服务-外观模式.js" target="_blank" rel="noopener">9.外观模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十章-水管弯弯-适配器模式.js" target="_blank" rel="noopener">10.适配器模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十一章-牛郎织女-代理模式.js" target="_blank" rel="noopener">11.代理模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十二章-房子装修-装饰着模式.js" target="_blank" rel="noopener">12.装饰者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十三章-城市间公路-桥接模式.js" target="_blank" rel="noopener">13.桥接模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十四章-超值午餐-组合模式.js" target="_blank" rel="noopener">14.组合模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十五章-城市公交车-享元模式.js" target="_blank" rel="noopener">15.享元模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十六章-照猫画虎-模板方法模式.js" target="_blank" rel="noopener">16.模板方法模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十七章-通信卫星-观察者模式.js" target="_blank" rel="noopener">17.观察者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十八章-超级玛丽-状态模式.js" target="_blank" rel="noopener">18.状态模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第十九章-活诸葛-策略模式.js" target="_blank" rel="noopener">19.策略模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十章-有序车站-职责链模式.js" target="_blank" rel="noopener">20.职责链模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十一章-命令模式.js" target="_blank" rel="noopener">21.命令模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十二章-驻华大使-访问者模式.js" target="_blank" rel="noopener">22.访问者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十三章-媒婆-中介者模式.js" target="_blank" rel="noopener">23.中介者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十四章-做好笔录-备忘录模式.js" target="_blank" rel="noopener">24.备忘录模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十五章-点钞机-迭代器模式.js" target="_blank" rel="noopener">25.迭代器模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十六章-语言翻译-解释器模式.js" target="_blank" rel="noopener">26.解释器模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十七章-永无尽头-链式模式.js" target="_blank" rel="noopener">27.链式模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十八章-未来预言家-委托模式.js" target="_blank" rel="noopener">28.委托模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第二十九章-数据管理器-数据访问对象模式.js" target="_blank" rel="noopener">29.数据访问对象模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十章-执行控制-节流模式.js" target="_blank" rel="noopener">30.节流模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十一章-卡片拼图-简单模板模式.js" target="_blank" rel="noopener">31.简单模板模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十二章-机器学习-惰性模式.js" target="_blank" rel="noopener">32.惰性模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十三章-异国战场-参与者模式.js" target="_blank" rel="noopener">33.参与者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十四章-入场仪式-等待着模式.js" target="_blank" rel="noopener">34.等待者模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十五章-死心眼-同步模块.js" target="_blank" rel="noopener">35.同步模块模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十六章-大心脏-异步模块模式.js" target="_blank" rel="noopener">36.异步模块模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十七章-分而治之-widget.js" target="_blank" rel="noopener">37.widget模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十八章-三人行-MVC模式.js" target="_blank" rel="noopener">38.MVC模式</a></li><li><a href="https://github.com/jinux7/study-collections/blob/master/javaScript设计模式/第三十九章-MVVM.js" target="_blank" rel="noopener">39.MVVM模式</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>写一个自己的富文本编辑器</title>
      <link href="/2019/06/22/%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/"/>
      <url>/2019/06/22/%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>写一个稍微复杂点的富文本编辑器<br><a id="more"></a></p><h2 id="写一个自己的富文本编辑器"><a href="#写一个自己的富文本编辑器" class="headerlink" title="写一个自己的富文本编辑器"></a>写一个自己的富文本编辑器</h2><p>前几天写了一个<a href="https://jinux7.github.io/2019/06/17/简单的富文本编辑器/" target="_blank" rel="noopener">《简单的富文本编辑器》</a>这篇博文，没想到刚过两天，项目中就需要自己写一个富文本编辑器。<br>具体的需求是，在富文本编辑器中编辑好内容，存到数据库，之后app端拿到这些数据以webview的形式展示出来，当然，webview这块也是我来做，但是，在pc端编辑的内容直接放到移动端显示是有问题的，比如像图片大小问题，而且编辑的样式和展示出来的样式完全不一样。所以，我就想自己写一个，不用第三方的库，这样自己可以灵活的按照需求来修改。<br>暂时写这个小插件只用了一天多，还不是很完善，有些地方还有待修改，如果有时间的话，以后会陆续更新。<br>废话不多说，直接贴源码地址喽:<br><a href="https://github.com/jinux7/study-collections/tree/master/jinux-editor" target="_blank" rel="noopener">jinux-editor</a><br>这里有些注意的地方，比如把文字变成粗体，用到了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.execCommand(<span class="string">"bold"</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure></p><p>而取消粗体还是用到了这个命令，执行同一个命令，会切换字体的粗体和非粗体的状态。<br>但是，这里注意，还有一个方法可以获取现在文本是否是粗体状态<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.queryCommandState(<span class="string">'bold'</span>);</span><br></pre></td></tr></table></figure></p><p>可以用上面这个命令判断现在的状态，进而修改点击按钮的样式。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>base64加密原理</title>
      <link href="/2019/06/20/base64%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86/"/>
      <url>/2019/06/20/base64%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>你知道我们常用的base64是什么吗？<br><a id="more"></a></p><h2 id="base64加密原理"><a href="#base64加密原理" class="headerlink" title="base64加密原理"></a>base64加密原理</h2><p>开发者对Base64编码肯定很熟悉，是否对它有很清晰的认识就不一定了。实际 上Base64已经简单到不能再简单了，如果对它的理解还是模棱两可实在不应该。大概介绍一下Base64的相关内容，花几分钟时间就可以彻底理解它。文 章下边贴了一个Base64的编解码器，方便阅读文章的同时来实验。<br>　　一. Base64编码由来<br>　　为什么会有Base64编码呢？因为有些网络传送渠道并不支持所有的字节，例如传统的邮件只支持可见字符的传送，像ASCII码的控制字符就 不能通过邮件传送。这样用途就受到了很大的限制，比如图片二进制流的每个字节不可能全部是可见字符，所以就传送不了。最好的方法就是在不改变传统协议的情 况下，做一种扩展方案来支持二进制文件的传送。把不可打印的字符也能用可打印字符来表示，问题就解决了。Base64编码应运而生，Base64就是一种 基于64个可打印字符来表示二进制数据的表示方法。<br>　　二. Base64编码原理<br>　　看一下Base64的索引表，字符选用了”A-Z、a-z、0-9、+、/“ 64个可打印字符。数值代表字符的索引，这个是标准Base64协议规定的，不能更改。64个字符用6个bit位就可以全部表示，一个字节有8个bit 位，剩下两个bit就浪费掉了，这样就不得不牺牲一部分空间了。这里需要弄明白的就是一个Base64字符是8个bit，但是有效部分只有右边的6个 bit，左边两个永远是0。<br><img src="/2019/06/20/base64加密原理/1.png" alt="img"><br>那么怎么用6个有效bit来表示传统字符的8个bit呢？8和6的最小公倍数 是24，也就是说3个传统字节可以由4个Base64字符来表示，保证有效位数是一样的，这样就多了1/3的字节数来弥补Base64只有6个有效bit 的不足。你也可以说用两个Base64字符也能表示一个传统字符，但是采用最小公倍数的方案其实是最减少浪费的。结合下边的图比较容易理解。Man是三个 字符，一共24个有效bit，只好用4个Base64字符来凑齐24个有效位。红框表示的是对应的Base64，6个有效位转化成相应的索引值再对应 Base64字符表，查出”Man”对应的Base64字符是”TWFU”。说到这里有个原则不知道你发现了没有，要转换成Base64的最小单位就是三个字节，对一个字符串来说每次都是三个字节三个字节的转换，对应的是Base64的四个字节。这个搞清楚了其实就差不多了。<br><img src="/2019/06/20/base64加密原理/2.png" alt="img"><br><img src="/2019/06/20/base64加密原理/3.png" alt="img"><br>　　但是转换到最后你发现不够三个字节了怎么办呢？愿望终于实现了，我们可以用两 个Base64来表示一个字符或用三个Base64表示两个字符，像下图的A对应的第二个Base64的二进制位只有两个，把后边的四个补0就是了。所以 A对应的Base64字符就是QQ。上边已经说过了，原则是Base64字符的最小单位是四个字符一组，那这才两个字 符，后边补两个”=”吧。其实不用”=”也不耽误解码，之所以用”=”，可能是考虑到多段编码后的Base64字符串拼起来也不会引起混淆。由此可见 Base64字符串只可能最后出现一个或两个”=”，中间是不可能出现”=”的。下图中字符”BC”的编码过程也是一样的。<br><img src="/2019/06/20/base64加密原理/4.png" alt="img"><br>    三. 总结　　<br>　　说起Base64编码可能有些奇怪，因为大多数的编码都是由字符转化成二进制的过程，而从二进制转成字符的过程称为解码。而Base64的概念就恰好反了，由二进制转到字符称为编码，由字符到二进制称为解码。<br>　　Base64编码主要用在传输、存储、表示二进制等领域，还可以用来加密，但是这种加密比较简单，只是一眼看上去不知道什么内容罢了，当然也可以对Base64的字符序列进行定制来进行加密。<br>　　Base64编码是从二进制到字符的过程，像一些中文字符用不同的编码转为二 进制时，产生的二进制是不一样的，所以最终产生的Base64字符也不一样。例如”上网”对应utf-8格式的Base64编码是”5LiK572R”， 对应GB2312格式的Base64编码是”yc/N+A==”。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试及爬虫工具nightmare</title>
      <link href="/2019/06/18/%E6%B5%8B%E8%AF%95%E5%8F%8A%E7%88%AC%E8%99%AB%E5%B7%A5%E5%85%B7nightmare/"/>
      <url>/2019/06/18/%E6%B5%8B%E8%AF%95%E5%8F%8A%E7%88%AC%E8%99%AB%E5%B7%A5%E5%85%B7nightmare/</url>
      
        <content type="html"><![CDATA[<p>nightmare工具的使用<br><a id="more"></a></p><h2 id="测试及爬虫工具nightmare"><a href="#测试及爬虫工具nightmare" class="headerlink" title="测试及爬虫工具nightmare"></a>测试及爬虫工具nightmare</h2><p>nightmare是一个可视化的页面操作工具，<a href="https://www.npmjs.com/package/nightmare" target="_blank" rel="noopener">官网点这里</a><br>如何安装就不说了，npm就可以搞定，但是，安装的时候会很慢，因为它依赖electron<br>具体的使用方法可以直接看官网的api，下面是一个小demo，是对本博客网站的简单操作，可以看一下它强大的效果<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Nightmare = <span class="built_in">require</span>(<span class="string">'nightmare'</span>);       </span><br><span class="line"><span class="keyword">var</span> nightmare = Nightmare(&#123; </span><br><span class="line">      show: <span class="literal">true</span>,</span><br><span class="line">      gotoTimeout: <span class="number">100000</span> <span class="comment">// goto页面的等待时长，不写的话默认30000ms，访问慢的网页会报错</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">nightmare</span><br><span class="line">  .goto(<span class="string">'https://jinux7.github.io'</span>) <span class="comment">// 打开的网页</span></span><br><span class="line">  .type(<span class="string">'.m_search .u-search-input'</span>, <span class="string">'javascript'</span>) <span class="comment">// 向input中写入javascript</span></span><br><span class="line">  .type(<span class="string">'.m_search .u-search-input'</span>, <span class="string">'\u000d'</span>) <span class="comment">// 触发input的点击回车事件</span></span><br><span class="line">  .wait(<span class="string">'.icon.icon-close'</span>) <span class="comment">// 等待弹出层的.icon.icon-close元素节点出现</span></span><br><span class="line">  .click(<span class="string">'.icon.icon-close'</span>) <span class="comment">// 出现后点击它</span></span><br><span class="line">  .evaluate(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// 注入到页面里执行的js代码</span></span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(<span class="string">'.avatar.waves-image'</span>).src;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// .end() // 关闭nightmare</span></span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Search failed:'</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></p><p>如需要更丰富的功能，按照api一点点添加就可以喽.</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单的富文本编辑器</title>
      <link href="/2019/06/17/%E7%AE%80%E5%8D%95%E7%9A%84%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/"/>
      <url>/2019/06/17/%E7%AE%80%E5%8D%95%E7%9A%84%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>超级简单的富文本编辑器<br><a id="more"></a></p><h2 id="简单的富文本编辑器"><a href="#简单的富文本编辑器" class="headerlink" title="简单的富文本编辑器"></a>简单的富文本编辑器</h2><p>这是一个超级简单富文本编辑器，功能很简单，但是富文本编辑器的写法基础是有的，可以在这个基础上进行增加改进。<br>主要用到了div的contentEditable属性，还有document.execCommand方法，具体代码见下面<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;简易富文本编辑器.html&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    </span></span><br><span class="line"><span class="regexp">    &lt;meta http-equiv="keywords" content="keyword1,keyword2,keyword3"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;meta http-equiv="description" content="this is my page"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;meta http-equiv="content-type" content="text/</span>html; charset=UTF<span class="number">-8</span><span class="string">"&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&lt;style type="</span>text/css<span class="string">"&gt;</span></span><br><span class="line"><span class="string">    #editor &#123;width:600px;height:200px;border:1px solid #ccc;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    button &#123;margin:1px;border:1px solid #aaa;background:#ffe;cursor:pointer;overflow:hidden;&#125;</span></span><br><span class="line"><span class="string">    button:hover &#123;background:#ccc;border:1px solid #00f;&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;button id="</span>btn1<span class="string">"&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">  &lt;button id="</span>btn2<span class="string">"&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">  &lt;button id="</span>btn3<span class="string">"&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">  &lt;button id="</span>btn4<span class="string">"&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">  &lt;div id="</span>editor<span class="string">"&gt;</span></span><br><span class="line"><span class="string">      Click to Editor...</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;input id="</span>printContent<span class="string">" type="</span>button<span class="string">" value="</span>打印编辑器内容<span class="string">"&gt;</span></span><br><span class="line"><span class="string">  &lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        initEditor();</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        //初始化</span></span><br><span class="line"><span class="string">        function initEditor() &#123;</span></span><br><span class="line"><span class="string">            openOrCloseEditor("</span>editor<span class="string">", "</span><span class="literal">true</span><span class="string">");//开启元素编辑</span></span><br><span class="line"><span class="string">            bindBtnCommand();//给样式按钮绑定命令</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        /**</span></span><br><span class="line"><span class="string">        * </span></span><br><span class="line"><span class="string">        * 功能： 开启元素编辑功能</span></span><br><span class="line"><span class="string">        * 输入： el：编辑器ID; operate：Boolean值，表示启动还是关闭</span></span><br><span class="line"><span class="string">        */</span></span><br><span class="line"><span class="string">        function openOrCloseEditor(el, operate) &#123;</span></span><br><span class="line"><span class="string">            var editor = document.getElementById(el);</span></span><br><span class="line"><span class="string">            editor.contentEditable = operate;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        //按钮绑定命令</span></span><br><span class="line"><span class="string">        function bindBtnCommand() &#123;</span></span><br><span class="line"><span class="string">            var btns = document.getElementsByTagName("</span>button<span class="string">"),</span></span><br><span class="line">                btnConfigs = "backcolor|#f00|设置背景色 bold|null|字体加粗 indent|null|缩进 fontName|微软雅黑|转换字体".split(" "),</span><br><span class="line">                len = btnConfigs.length;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, btnConfig; btnConfig = btnConfigs[i]; i++) &#123;</span><br><span class="line">                (<span class="function"><span class="keyword">function</span>(<span class="params">btnConfig, btn</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> msg = btnConfig.split(<span class="string">"|"</span>),</span><br><span class="line">                        lab = msg[<span class="number">0</span>],</span><br><span class="line">                        value = msg[<span class="number">1</span>],</span><br><span class="line">                        title = msg[<span class="number">2</span>];</span><br><span class="line">                    btn.innerHTML = lab;</span><br><span class="line">                    btn.title = title;</span><br><span class="line">                    btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                        <span class="built_in">document</span>.execCommand(lab, <span class="literal">false</span>, value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)(btnConfig, btns[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取编辑器内嵌内容</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getContent</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> editor = <span class="built_in">document</span>.getElementById(el);</span><br><span class="line">            <span class="keyword">return</span> editor.innerHTML;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//打印按钮绑定触发事件</span></span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"printContent"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> content = getContent(<span class="string">"editor"</span>);</span><br><span class="line">            <span class="built_in">document</span>.write(content);</span><br><span class="line">        &#125;;</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure></p><p>上面的代码直接粘贴就可以跑起来哦。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue,react中百度地图的使用</title>
      <link href="/2019/06/13/vue-react%E4%B8%AD%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/06/13/vue-react%E4%B8%AD%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>vue,react等框架，百度地图的最优使用方式<br><a id="more"></a></p><h2 id="vue-react中百度地图的使用"><a href="#vue-react中百度地图的使用" class="headerlink" title="vue,react中百度地图的使用"></a>vue,react中百度地图的使用</h2><p>现在vue，react框架大行其道，很多项目都是用它们开发的，我的项目也都在用，之前，在使用百度地图的时候，我都是把百度地图封了一个组件，直接插入到dom中，但是，有些功能莫名其妙的不好使，我猜可能是跟vue有兼容性问题，还有一个页面中引入多个地图的情况下，像城市切换插件就不好使了，相互冲突了，所以，最终的解决方案是用iframe来引入百度地图。这个好处就是完全隔离开项目框架与百度地图之间的冲突。<br>首先，建一个百度地图的html页面，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"initial-scale=1.0, user-scalable=yes"</span> /&gt;</span><br><span class="line">    &lt;link href=<span class="string">"https://api.map.baidu.com/library/IndoorMap/1.0/src/indoor.min.css?v=1.0.1 "</span> rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">    &lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">        body, html,#map &#123;width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";&#125;</span><br><span class="line">    &lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script type="text/</span>javascript<span class="string">" src="</span>https:<span class="comment">//api.map.baidu.com/api?v=3.0&amp;ak=PaxZEfdK60GDxScXccj81kBW"&gt;&lt;/script&gt;</span></span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"https://api.map.baidu.com/library/IndoorMap/1.0/src/indoor.min.js?v=1.0.1 "</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"map"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">var obj = &#123;</span></span><br><span class="line"><span class="string">lng:'',</span></span><br><span class="line"><span class="string">lat:''</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">  var tab = getQueryString('tab');</span></span><br><span class="line"><span class="string">  // 获取url信息</span></span><br><span class="line"><span class="string">  function getQueryString(name) &#123;</span></span><br><span class="line"><span class="string">      var reg = new RegExp("</span>(^|&amp;)<span class="string">" + name + "</span>=([^&amp;]*)(&amp;|$)<span class="string">", "</span>i<span class="string">");</span></span><br><span class="line"><span class="string">      var reg_rewrite = new RegExp("</span>(^|<span class="regexp">/)" + name + "/</span>([^<span class="regexp">/]*)(/</span>|$)<span class="string">", "</span>i<span class="string">");</span></span><br><span class="line"><span class="string">      var r = window.location.search.substr(1).match(reg);</span></span><br><span class="line"><span class="string">      var q = window.location.pathname.substr(1).match(reg_rewrite);</span></span><br><span class="line"><span class="string">      if(r != null)&#123;</span></span><br><span class="line"><span class="string">          return unescape(r[2]);</span></span><br><span class="line"><span class="string">      &#125;else if(q != null)&#123;</span></span><br><span class="line"><span class="string">          return unescape(q[2]);</span></span><br><span class="line"><span class="string">      &#125;else&#123;</span></span><br><span class="line"><span class="string">          return null;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // 百度地图API功能</span></span><br><span class="line"><span class="string">  var map = new BMap.Map("</span>map<span class="string">");</span></span><br><span class="line"><span class="string">  map.centerAndZoom(new BMap.Point(123.436, 41.816), 11);</span></span><br><span class="line"><span class="string">var topLeftControl = new BMap.ScaleControl(&#123;</span></span><br><span class="line"><span class="string">anchor: BMAP_ANCHOR_BOTTOM_LEFT</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">// 城市选择控件</span></span><br><span class="line"><span class="string">var cityListControl = new BMap.CityListControl(&#123;</span></span><br><span class="line"><span class="string">anchor: BMAP_ANCHOR_TOP_RIGHT</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">// 比例尺控件</span></span><br><span class="line"><span class="string">var topLeftNavigation = new BMap.NavigationControl();</span></span><br><span class="line"><span class="string">map.addControl(topLeftControl);</span></span><br><span class="line"><span class="string">map.addControl(topLeftNavigation);</span></span><br><span class="line"><span class="string">map.addControl(cityListControl);</span></span><br><span class="line"><span class="string">  map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放</span></span><br><span class="line"><span class="string">  // 创建室内图实例</span></span><br><span class="line"><span class="string">  var indoorManager = new BMapLib.IndoorManager(map);</span></span><br><span class="line"><span class="string">  // 点击获取经纬度</span></span><br><span class="line"><span class="string">map.addEventListener("</span>click<span class="string">", function(e) &#123;</span></span><br><span class="line"><span class="string">obj.lng = parseFloat(e.point.lng) + '';</span></span><br><span class="line"><span class="string">obj.lat = parseFloat(e.point.lat) + '';</span></span><br><span class="line"><span class="string">drawLocation()</span></span><br><span class="line"><span class="string">selectLocation();</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">function selectLocation() &#123;</span></span><br><span class="line"><span class="string">    window.parent.postMessage(&#123;</span></span><br><span class="line"><span class="string">      refresh:obj,</span></span><br><span class="line"><span class="string">      tab</span></span><br><span class="line"><span class="string">      &#125;,'*');</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">function drawLocation() &#123;</span></span><br><span class="line"><span class="string">    if (obj.lng !== "</span><span class="string">" &amp;&amp; obj.lat !== "</span><span class="string">") &#123;</span></span><br><span class="line"><span class="string">      map.clearOverlays();</span></span><br><span class="line"><span class="string">      var new_point = new BMap.Point(obj.lng, obj.lat);</span></span><br><span class="line"><span class="string">      var marker = new BMap.Marker(new_point);</span></span><br><span class="line"><span class="string">      map.addOverlay(marker);</span></span><br><span class="line"><span class="string">      map.panTo(new_point);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>之后就是在项目中用iframe标签引入。<br>重要的地方来了，就是父子页面通信，在子页面点击选好地点后，肯定需要把选好点的坐标给父页面，这里有一个简单的方法，在子页面中点击选点时，给父页面发信息代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.parent.postMessage(&#123;</span><br><span class="line">    val: <span class="string">'信息'</span></span><br><span class="line">    &#125;,<span class="string">'*'</span>);</span><br><span class="line"><span class="comment">// 具体使用方法自行百度</span></span><br></pre></td></tr></table></figure></p><p>子页面消息发出去了，父页面如何接收呢？见下面代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(event);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 可以打印出很多需要的信息喽</span></span><br><span class="line"><span class="comment">// 据说，IE8+都支持哦</span></span><br></pre></td></tr></table></figure></p><p>好了，总结一下，vue中最好还是以这种方式使用哈。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web页面性能测试demo</title>
      <link href="/2019/06/06/web%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95demo/"/>
      <url>/2019/06/06/web%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95demo/</url>
      
        <content type="html"><![CDATA[<p>web页面性能测试demo<br><a id="more"></a></p><h2 id="web页面性能测试demo"><a href="#web页面性能测试demo" class="headerlink" title="web页面性能测试demo"></a>web页面性能测试demo</h2><p>写这篇文章的起因，有时候有人问，css会不会阻塞页面渲染了，js如何触发页面渲染了等等，所以，最好的方式就是自己写一个小demo，自己试一下不就一目了然了吗，目前这个demo的内容很简单，以后会慢慢增加。<br>下面是github的链接地址:<br><a href="https://github.com/jinux7/study-collections/tree/master/web-performance-test" target="_blank" rel="noopener">点我进入仓库</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker常用命令</title>
      <link href="/2019/05/28/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2019/05/28/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>docker常用命令<br><a id="more"></a></p><h2 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h2><p>最近想在win10下安装mysql5.6版本，装了半天没装成功，于是乎用docker来解决了。<br>docker需要命令行，这里以mysql为例，贴出一个别人的blog(懒得写了)。<br><a href="https://www.cnblogs.com/pwc1996/p/5425234.html" target="_blank" rel="noopener">docker运行mysql</a></p>]]></content>
      
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows下git命令批处理执行</title>
      <link href="/2019/05/24/windows%E4%B8%8Bgit%E5%91%BD%E4%BB%A4%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8C/"/>
      <url>/2019/05/24/windows%E4%B8%8Bgit%E5%91%BD%E4%BB%A4%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>win10操作系统下利用批处理程序来运行git操作。<br><a id="more"></a></p><h2 id="windows下git命令批处理执行"><a href="#windows下git命令批处理执行" class="headerlink" title="windows下git命令批处理执行"></a>windows下git命令批处理执行</h2><p>首先，我说一下我要这样做的起因，也许大家都会有感。<br>目前，我在做的项目是一个，但是下面分了5个子项目，这5个子项目，每一个自己拥有一个git仓库，所以，我在上传代码的操作就是，commit-&gt;pull-&gt;push,这样反复5回，因为有5个仓库嘛。有时候一天要好多次，效率太低了，于是我就想起了利用windows系统的批处理来做。<br>在使用批处理来操作git命令，首先需要把git的操作仓库方式改为ssh，使用ssh的话，还需要ssh key，ssh key的生成方法是，打开git的命令行工具，输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 首先检查一下现在电脑里是否已经有生成的ssh key</span><br><span class="line">cd ~/.ssh</span><br><span class="line">// ~这个符号我在git命令行下才能打出来，cmd没打出来。</span><br><span class="line">// ~/ 这个路径就是C:\Users\userName这个，看看现在是否已经有现成的ssh key</span><br><span class="line">// 如果有，就不用再生成了</span><br><span class="line"></span><br><span class="line">// 接下来是生成ssh key命令</span><br><span class="line">ssh-keygen -t rsa -C &quot;88888***@qq.com&quot;</span><br><span class="line">// 需要自己在电脑中注册的git邮箱,如果不知道，可以查一下 git config --global user.email</span><br><span class="line">// 生成的ssh key自动保存在C:\Users\userName这个目录下（这个是我的用户名）</span><br><span class="line">// 生成过程中一路回车就好，不用设置密码等</span><br></pre></td></tr></table></figure></p><p>有了ssh key，添加到github或自己公司的gitlab上就好了。<br>比如要添加到github上，登录账号进入自己的github库，步骤见下图<br><img src="/2019/05/24/windows下git命令批处理执行/1.png" alt="img"><br><img src="/2019/05/24/windows下git命令批处理执行/2.png" alt="img"><br>点进去之后，按照页面提示填写就可以了。<br>以上就是配置好了ssh key，之后就是用git拉取，推送代码了，这里有一个地方需要注意，那就是Git对仓库的操作方式，既然已经添加了ssh key，就需要用git的ssh提交方式。查看.git文件夹下的config文件，找到下面的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">  // 这个是ssh提交方式</span><br><span class="line">url = git@172.12.122.123:root/demo.git</span><br><span class="line">  </span><br><span class="line">  // 这个是http提交方式</span><br><span class="line">  url = http://172.12.122.123/root/demo</span><br><span class="line"></span><br><span class="line">fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure></p><p>按照上面的写法，只留下ssh提交方式即可。<br>接下来，我们来写windows的批处理命令,先写一个处理一个仓库的git操作批处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">cd C:\WORK\git-ku\demo1</span><br><span class="line">@echo off</span><br><span class="line">echo git批处理开始执行</span><br><span class="line">git status</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;update&quot;</span><br><span class="line">git pull</span><br><span class="line">git push</span><br><span class="line">echo ----------</span><br><span class="line">echo git commit pull push都已完成，点击任意键退出</span><br><span class="line">pause</span><br></pre></td></tr></table></figure></p><p>再写一个调用多个批处理文件的操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">pause</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\git&quot; call demo1.bat</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\git&quot; call demo2.bat</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\git&quot; call demo3.bat</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\git&quot; call demo4.bat</span><br></pre></td></tr></table></figure></p><p>这里，需要注意一下，因为批处理是在cmd命令行下执行的，所以要把git的环境变量配好哦。<br>好了，通过这样的方法，以后麻烦的git操作，点击一下就可以搞定喽。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多个ajax请求,页面渲染顺序问题</title>
      <link href="/2019/05/20/%E5%A4%9A%E4%B8%AAajax%E8%AF%B7%E6%B1%82-%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98/"/>
      <url>/2019/05/20/%E5%A4%9A%E4%B8%AAajax%E8%AF%B7%E6%B1%82-%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>在一个页面中,多个ajax请求,页面渲染顺序问题。<br><a id="more"></a></p><h2 id="多个ajax请求-页面渲染顺序问题"><a href="#多个ajax请求-页面渲染顺序问题" class="headerlink" title="多个ajax请求,页面渲染顺序问题"></a>多个ajax请求,页面渲染顺序问题</h2><p>如题，比如说在一个页面中有两个按钮或者多个，按照先后顺序点击，都发出了ajax请求，但是他们返回的顺序就不会按照点击按钮的顺序返回，如果，它们操作的是页面的同一个显示区域，比如列表，那就ajax访问最慢的接口最后被渲染出来，有可能这个接口是用户最开始点击的按钮渲染出来的，这样就会产生错误信息，用户本想最后点击那个按钮返回的数据才是他想要的。<br>其实，这个问题我并没有遇到过，这个是大约一年前我再一次面试中被问到的，当时由于没有做好准备，我也只能诚实的回答没有遇到过此场景，今天我又来了兴致，把它的解决方法记录下来（我的拖延症是不是很严重），这个解决方式是我自己定的，其实也是实现起来比较简单的。<br>为了加快写作，直接把代码贴出来，在代码中写注释<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;script src=<span class="string">"./jquery.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">  &lt;title&gt;多个ajax请求,页面渲染顺序问题&lt;/</span>title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    .content &#123;</span><br><span class="line">      width: <span class="number">500</span>px;</span><br><span class="line">      height: <span class="number">100</span>px;</span><br><span class="line">      background-color: #eeeeee;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"content"</span>&gt;</span><br><span class="line">    原始内容</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button id="btn1"&gt;按钮2s&lt;/</span>button&gt;</span><br><span class="line">  &lt;button id=<span class="string">"btn2"</span>&gt;按钮<span class="number">5</span>s&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button id="btn3"&gt;按钮3s&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 后端地址</span></span><br><span class="line"><span class="regexp">  var baseUrl = "http:/</span><span class="regexp">/localhost:3000/</span><span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 存放ajax标志的数组，用来区分是哪个ajax</span></span><br><span class="line"><span class="string">  var orderArr = [];</span></span><br><span class="line"><span class="string">  // 按钮1加点击事件</span></span><br><span class="line"><span class="string">  $('#btn1').on('click', function() &#123;</span></span><br><span class="line"><span class="string">    // 将btn1按钮的标志传入数组</span></span><br><span class="line"><span class="string">    ajaxOrder('btn1');</span></span><br><span class="line"><span class="string">    $.post(baseUrl+'delay2s', (res)=&gt; &#123;</span></span><br><span class="line"><span class="string">      // 渲染页面</span></span><br><span class="line"><span class="string">      render('btn1', res.data);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  // 按钮2加点击事件</span></span><br><span class="line"><span class="string">  $('#btn2').on('click', function() &#123;</span></span><br><span class="line"><span class="string">    ajaxOrder('btn2');</span></span><br><span class="line"><span class="string">    $.post(baseUrl+'delay5s', (res)=&gt; &#123;</span></span><br><span class="line"><span class="string">      render('btn2', res.data);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  // 按钮3加点击事件</span></span><br><span class="line"><span class="string">  $('#btn3').on('click', function() &#123;</span></span><br><span class="line"><span class="string">    ajaxOrder('btn3');</span></span><br><span class="line"><span class="string">    $.post(baseUrl+'delay3s', (res)=&gt; &#123;</span></span><br><span class="line"><span class="string">      render('btn3', res.data);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  // 向存放ajax标志位数组中push ajax标志</span></span><br><span class="line"><span class="string">  function ajaxOrder(flag) &#123;</span></span><br><span class="line"><span class="string">    orderArr.push(flag);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 根据ajax的标志来渲染页面</span></span><br><span class="line"><span class="string">  function render(flag, val) &#123;</span></span><br><span class="line"><span class="string">    // 如果数组中只有一个标志的情况，直接渲染并清空数组</span></span><br><span class="line"><span class="string">    if(orderArr.length === 1) &#123;</span></span><br><span class="line"><span class="string">      orderArr = [];</span></span><br><span class="line"><span class="string">      $('.content').html(val);</span></span><br><span class="line"><span class="string">      return void 0;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 如果标志数组中多余一个标志</span></span><br><span class="line"><span class="string">    if(orderArr.length &gt; 1) &#123;</span></span><br><span class="line"><span class="string">      // 如果这个标志是第一个请求的标志，则渲染页面</span></span><br><span class="line"><span class="string">      if(orderArr.indexOf(flag) === 0) &#123;</span></span><br><span class="line"><span class="string">        orderArr.shift();</span></span><br><span class="line"><span class="string">        $('.content').html(val);</span></span><br><span class="line"><span class="string">        return void 0;</span></span><br><span class="line"><span class="string">      &#125;else &#123; // 如果不是第一个，则不渲染页面，并把这个标志剔除</span></span><br><span class="line"><span class="string">        let index = orderArr.indexOf(flag);</span></span><br><span class="line"><span class="string">        orderArr.splice(index,1);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p><p>大概的流程就是，按照按钮点击的顺序来显示请求的结果。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack打包多页面项目</title>
      <link href="/2019/05/20/webpack%E6%89%93%E5%8C%85%E5%A4%9A%E9%A1%B5%E9%9D%A2%E9%A1%B9%E7%9B%AE/"/>
      <url>/2019/05/20/webpack%E6%89%93%E5%8C%85%E5%A4%9A%E9%A1%B5%E9%9D%A2%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<p>webpack打包多页面项目<br><a id="more"></a></p><h2 id="webpack打包多页面项目"><a href="#webpack打包多页面项目" class="headerlink" title="webpack打包多页面项目"></a>webpack打包多页面项目</h2><p>平时我们在工作中，使用webpack来打包单页面应用的项目很多，多页面应用之前我都是使用gulp来做，今天我在github发现一个不错的demo，我就不写具体的分析步骤了，代码里边写的很清楚，直接贴地址喽。<br><a href="https://github.com/jixoba/webpack-dev" target="_blank" rel="noopener">点击这里看项目</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>import和require的本质区别</title>
      <link href="/2019/05/09/import%E5%92%8Crequire%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB/"/>
      <url>/2019/05/09/import%E5%92%8Crequire%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>简单的说一下import和require的本质区别<br><a id="more"></a></p><h2 id="import和require的本质区别"><a href="#import和require的本质区别" class="headerlink" title="import和require的本质区别"></a>import和require的本质区别</h2><p>import是ES6的模块规范，require是commonjs的模块规范，详细的用法我不介绍，我只想说一下他们最基本的区别，import是静态加载模块，require是动态加载，那么静态加载和动态加载的区别是什么呢？<br>静态加载时代码在编译的时候已经执行了，动态加载是编译后在代码运行的时候再执行，那么具体点是什么呢？<br>先说说import，如下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'name.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// name.js文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name = <span class="string">'jinux'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> age = <span class="number">20</span></span><br></pre></td></tr></table></figure></p><p>上面的代码表示main.js文件里引入了name.js文件导出的变量，在代码编译阶段执行后的代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">'jinux'</span></span><br></pre></td></tr></table></figure></p><p>这个是我自己理解的，其实就是直接把name.js里的代码放到了main.js文件里，好比是在main.js文件中声明一样。<br>再来看看require<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">require</span>(<span class="string">'obj.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.js文件</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'jinux'</span>,</span><br><span class="line">  age: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.export obj;</span><br></pre></td></tr></table></figure></p><p>require是在运行阶段，需要把obj对象整个加载进内存，之后用到哪个变量就用哪个，这里再对比一下import，import是静态加载，如果只引入了name，age是不会引入的，所以是按需引入，性能更高。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>http常用状态码</title>
      <link href="/2019/05/06/http%E5%B8%B8%E7%94%A8%E7%8A%B6%E6%80%81%E7%A0%81/"/>
      <url>/2019/05/06/http%E5%B8%B8%E7%94%A8%E7%8A%B6%E6%80%81%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>列出了一些常用的http请求状态码<br><a id="more"></a></p><h2 id="http常用状态码"><a href="#http常用状态码" class="headerlink" title="http常用状态码"></a>http常用状态码</h2><p>我们在日常开发中，经常会使用ajax，会看到请求返回的状态码，也就是Status Code。<br>常见的3个是:</p><ul><li>200 – 服务器成功返回网页</li><li>404 – 请求的网页不存在</li><li>503 – 服务器超时</li></ul><p>但是，作为一个合格的前端，还需要掌握的详细点，下面列出常用的状态码，也不是最全的哦。</p><h3 id="1xx（临时响应）"><a href="#1xx（临时响应）" class="headerlink" title="1xx（临时响应）"></a>1xx（临时响应）</h3><p>表示临时响应并需要请求者继续执行操作的状态码。</p><ul><li>100（继续）:    请求者应当继续提出请求。服务器返回此代码表示已收到请求的第一部分，正在等待其余部分。</li><li>101（切换协议）:    请求者已要求服务器切换协议，服务器已确认并准备切换。</li></ul><h3 id="2xx-（成功）"><a href="#2xx-（成功）" class="headerlink" title="2xx （成功）"></a>2xx （成功）</h3><p>表示成功处理了请求的状态码。</p><ul><li>200（成功）:    服务器已成功处理了请求。通常，这表示服务器提供了请求的网页。如果是对您的 robots.txt 文件显示此状态码，则表示 Googlebot 已成功检索到该文件。</li><li>201（已创建）:    请求成功并且服务器创建了新的资源。</li><li>202（已接受）:    服务器已接受请求，但尚未处理。</li><li>203（非授权信息）:    服务器已成功处理了请求，但返回的信息可能来自另一来源。</li><li>204（无内容）:    服务器成功处理了请求，但没有返回任何内容。</li><li>205（重置内容）:    服务器成功处理了请求，但没有返回任何内容。与 204 响应不同，此响应要求请求者重置文档视图（例如，清除表单内容以输入新内容）。</li><li>206（部分内容）:    服务器成功处理了部分 GET 请求。</li></ul><h3 id="3xx-（重定向）"><a href="#3xx-（重定向）" class="headerlink" title="3xx （重定向）"></a>3xx （重定向）</h3><p>要完成请求，需要进一步操作。通常，这些状态码用来重定向。</p><ul><li>300（多种选择）:    针对请求，服务器可执行多种操作。服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择。</li><li>301（永久移动）:    请求的网页已永久移动到新位置。服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。您应使用此代码告诉 Googlebot 某个网页或网站已永久移动到新位置。</li><li>302（临时移动）:    服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来响应以后的请求。此代码与响应 GET 和 HEAD 请求的 301 代码类似，会自动将请求者转到不同的位置，但您不应使用此代码来告诉 Googlebot 某个网页或网站已经移动，因为 Googlebot 会继续抓取原有位置并编制索引。</li><li>303（查看其他位置）: 请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码。对于除 HEAD 之外的所有请求，服务器会自动转到其他位置。</li><li>304（未修改）: 自从上次请求后，请求的网页未修改过。服务器返回此响应时，不会返回网页内容。如果网页自请求者上次请求后再也没有更改过，您应将服务器配置为返回此响应（称为 If-Modified-Since HTTP 标头）。服务器可以告诉 Googlebot 自从上次抓取后网页没有变更，进而节省带宽和开销。</li><li>305（使用代理）:    请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理。</li><li>307（临时重定向）:    服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来响应以后的请求。此代码与响应 GET 和 HEAD 请求的 <code>&lt;a href=answer.py?answer=&gt;301&lt;/a&gt;</code> 代码类似，会自动将请求者转到不同的位置，但您不应使用此代码来告诉 Googlebot 某个页面或网站已经移动，因为 Googlebot 会继续抓取原有位置并编制索引。</li></ul><h3 id="4xx（请求错误）"><a href="#4xx（请求错误）" class="headerlink" title="4xx（请求错误）"></a>4xx（请求错误）</h3><p>这些状态码表示请求可能出错，妨碍了服务器的处理。</p><ul><li>400（错误请求）: 服务器不理解请求的语法。</li><li>401（未授权）: 请求要求身份验证。对于登录后请求的网页，服务器可能返回此响应。</li><li>403（禁止）: 服务器拒绝请求。如果您在 Googlebot 尝试抓取您网站上的有效网页时看到此状态码（您可以在 Google 网站管理员工具诊断下的网络抓取页面上看到此信息），可能是您的服务器或主机拒绝了 Googlebot 访问。</li><li>404（未找到）: 服务器找不到请求的网页。例如，对于服务器上不存在的网页经常会返回此代码。</li><li>405（方法禁用）: 禁用请求中指定的方法。</li><li>406（不接受）:    无法使用请求的内容特性响应请求的网页。</li><li>407（需要代理授权）:    此状态码与 <code>&lt;a href=answer.py?answer=35128&gt;401（未授权）&lt;/a&gt;</code>类似，但指定请求者应当授权使用代理。如果服务器返回此响应，还表示请求者应当使用代理。</li><li>408（请求超时）:    服务器等候请求时发生超时。</li><li>409（冲突）:    服务器在完成请求时发生冲突。服务器必须在响应中包含有关冲突的信息。服务器在响应与前一个请求相冲突的 PUT 请求时可能会返回此代码，以及两个请求的差异列表。</li><li>410（已删除）:    如果请求的资源已永久删除，服务器就会返回此响应。该代码与 404（未找到）代码类似，但在资源以前存在而现在不存在的情况下，有时会用来替代 404 代码。如果资源已永久移动，您应使用 301 指定资源的新位置。</li><li>411（需要有效长度）:    服务器不接受不含有效内容长度标头字段的请求。</li><li>412（未满足前提条件）:    服务器未满足请求者在请求中设置的其中一个前提条件。</li><li>413（请求实体过大）:    服务器无法处理请求，因为请求实体过大，超出服务器的处理能力。</li><li>414（请求的 URI 过长）:    请求的 URI（通常为网址）过长，服务器无法处理。</li><li>415（不支持的媒体类型）:    请求的格式不受请求页面的支持。</li><li>416（请求范围不符合要求）:    如果页面无法提供请求的范围，则服务器会返回此状态码。</li><li>417（未满足期望值）:    服务器未满足”期望”请求标头字段的要求。</li></ul><h3 id="5xx（服务器错误）"><a href="#5xx（服务器错误）" class="headerlink" title="5xx（服务器错误）"></a>5xx（服务器错误）</h3><p>这些状态码表示服务器在处理请求时发生内部错误。这些错误可能是服务器本身的错误，而不是请求出错。</p><ul><li>500（服务器内部错误）    服务器遇到错误，无法完成请求。</li><li>501（尚未实施）    服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码。</li><li>502（错误网关）    服务器作为网关或代理，从上游服务器收到无效响应。</li><li>503（服务不可用）    服务器目前无法使用（由于超载或停机维护）。通常，这只是暂时状态。</li><li>504（网关超时）    服务器作为网关或代理，但是没有及时从上游服务器收到请求。</li><li>505（HTTP 版本不受支持）    服务器不支持请求中所用的 HTTP 协议版本。</li></ul><p>以上就是一些常用的http状态吗，如果想了解更多，<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noopener">点击这里喽</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs将vue的dist目录文件copy到目标目录</title>
      <link href="/2019/04/23/nodejs%E5%B0%86vue%E7%9A%84dist%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6copy%E5%88%B0%E7%9B%AE%E6%A0%87%E7%9B%AE%E5%BD%95/"/>
      <url>/2019/04/23/nodejs%E5%B0%86vue%E7%9A%84dist%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6copy%E5%88%B0%E7%9B%AE%E6%A0%87%E7%9B%AE%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>利用nodejs拷贝转移文件<br><a id="more"></a></p><h2 id="nodejs将vue的dist目录文件copy到目标目录"><a href="#nodejs将vue的dist目录文件copy到目标目录" class="headerlink" title="nodejs将vue的dist目录文件copy到目标目录"></a>nodejs将vue的dist目录文件copy到目标目录</h2><p>上篇文章写了《window批处理执行webpack打包》，这篇文章主要写打包好的文件自动转移到git目录下。<br>其实就是用的nodejs的读写文件API而已，代码不多，见下面：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">let</span> fse = <span class="built_in">require</span>(<span class="string">'fs-extra'</span>) <span class="comment">// 文件的正删改查模块，比原生方便</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制文件</span></span><br><span class="line"><span class="keyword">var</span> copy=<span class="function"><span class="keyword">function</span>(<span class="params">src,dst</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> paths = fs.readdirSync(src); <span class="comment">//同步读取当前目录</span></span><br><span class="line">  paths.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _src=src+<span class="string">'/'</span>+path;</span><br><span class="line">      <span class="keyword">var</span> _dst=dst+<span class="string">'/'</span>+path;</span><br><span class="line">      fs.stat(_src,<span class="function"><span class="keyword">function</span>(<span class="params">err,stats</span>)</span>&#123;  <span class="comment">//stats  该对象 包含文件属性</span></span><br><span class="line">          <span class="keyword">if</span>(err)<span class="keyword">throw</span> err;</span><br><span class="line">          <span class="keyword">if</span>(stats.isFile())&#123; <span class="comment">//如果是个文件则拷贝 </span></span><br><span class="line">              <span class="keyword">let</span> _dst = dst+<span class="string">'/'</span> + path;</span><br><span class="line">              <span class="keyword">let</span>  readable=fs.createReadStream(_src);<span class="comment">//创建读取流</span></span><br><span class="line">              <span class="keyword">let</span>  writable=fs.createWriteStream(_dst);<span class="comment">//创建写入流</span></span><br><span class="line">              readable.pipe(writable);</span><br><span class="line">          &#125;<span class="keyword">else</span> <span class="keyword">if</span>(stats.isDirectory())&#123; <span class="comment">//是目录则 递归 </span></span><br><span class="line">              checkDirectory(_src,_dst,copy);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 检查文件夹是否存在，新建文件夹并copy</span></span><br><span class="line"><span class="keyword">var</span> checkDirectory=<span class="function"><span class="keyword">function</span>(<span class="params">src,dst,callback</span>)</span>&#123;</span><br><span class="line">  fs.access(dst, fs.constants.F_OK, (err) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          fs.mkdirSync(dst);</span><br><span class="line">          callback(src,dst);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          callback(src,dst);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除旧文件</span></span><br><span class="line"><span class="keyword">var</span> cleanOld = <span class="function"><span class="keyword">function</span>(<span class="params">dest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dest_static = path.join(dest, <span class="string">'static'</span>); </span><br><span class="line">  <span class="keyword">let</span> dest_index = path.join(dest, <span class="string">'index.html'</span>); </span><br><span class="line">  fs.exists(dest_static,<span class="function"><span class="keyword">function</span>(<span class="params">exists</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(exists) fse.removeSync(dest_static);</span><br><span class="line">  &#125;);</span><br><span class="line">  fs.exists(dest_index,<span class="function"><span class="keyword">function</span>(<span class="params">exists</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(exists) fse.removeSync(dest_index);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件路径</span></span><br><span class="line"><span class="keyword">let</span> url_src_ehome = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\ejashop\\dist\\'</span>),</span><br><span class="line">    url_dest_ehome = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\ehome'</span>),</span><br><span class="line">    url_src_airport = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\airport\\dist\\'</span>),</span><br><span class="line">    url_dest_airport = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\airport'</span>),</span><br><span class="line">    url_src_operation = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\eHomeOperation\\dist\\'</span>),</span><br><span class="line">    url_dest_operation = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\operation'</span>),</span><br><span class="line">    url_src_openShop = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\kaidian\\dist\\'</span>),</span><br><span class="line">    url_dest_openShop = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\openShop'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// copy之前先清空旧文件</span></span><br><span class="line">cleanOld(url_dest_ehome);</span><br><span class="line">cleanOld(url_dest_airport);</span><br><span class="line">cleanOld(url_dest_operation);</span><br><span class="line">cleanOld(url_dest_openShop);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4个项目的copy转移</span></span><br><span class="line">checkDirectory(url_src_ehome, url_dest_ehome,copy);</span><br><span class="line">checkDirectory(url_src_airport, url_dest_airport,copy);</span><br><span class="line">checkDirectory(url_src_operation, url_dest_operation,copy);</span><br><span class="line">checkDirectory(url_src_openShop, url_dest_openShop,copy);</span><br></pre></td></tr></table></figure></p><p>这里需要注意一点，path.relative(__dirname, ‘C:\WORK\new-airport\6 编码\5 Web\ejashop\dist\‘);利用path模块将两个绝对路径变成相对路径。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>window批处理执行webpack打包</title>
      <link href="/2019/04/19/window%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8Cwebpack%E6%89%93%E5%8C%85/"/>
      <url>/2019/04/19/window%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8Cwebpack%E6%89%93%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<p>利用window的批处理文件bat来批量执行debpack打包命令。<br><a id="more"></a></p><h2 id="window批处理执行webpack打包"><a href="#window批处理执行webpack打包" class="headerlink" title="window批处理执行webpack打包"></a>window批处理执行webpack打包</h2><p>现在的前端开发，使用vue，react，angular等框架的项目非常多，部署的时候需要打包后进行部署，比如运行npm run build命令，但是比如我现在的项目，有4个子平台，每个平台是独立的一套vue，每次打包的时候需要进入到4个不同的平台目录进行打包命令操作，还有一点，我们项目分为测试环境，生产环境，这样就会出现更多次打包操作，每次都很烦，进入一个文件夹，打开命令提示符，输入npm run build，有没有方便点的方式呢，有，可以利用window系统的批处理文件来操作。<br>首先，下面的是执行一个打包命令的.bat文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">cd C:\WORK\new-airport\6 编码\5 Web\ejashop</span><br><span class="line">npm run build</span><br><span class="line">pause</span><br></pre></td></tr></table></figure></p><ul><li>chcp 65001 //是用来可以在文件路径中使用中文</li><li>cd C:\WORK\new-airport\6 编码\5 Web\ejashop //进入到项目的目录</li><li>npm run build //执行打包命令</li><li>pause // 命令行暂停，等待下一步操作</li></ul><p>上面的是执行一个打包命令的，多个打包操作需要创建多个.bat文件，每执行一个点击一下也很麻烦，我们可以在创建一个.bat文件，用来执行这些批处理文件操作，向下面这样:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">pause</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\build&quot; call demo1.bat</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\build&quot; call demo2.bat</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\build&quot; call demo3.bat</span><br><span class="line">start /D &quot;C:\Users\userName\Desktop\批处理node\build&quot; call demo4.bat</span><br></pre></td></tr></table></figure></p><ul><li>chcp 65001 //是用来可以在文件路径中使用中文</li><li>start /D “C:\Users\userName\Desktop\批处理node\build” call demo1.bat //执行具体的.bat文件</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>http请求头响应头字段详解</title>
      <link href="/2019/04/15/http%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%93%8D%E5%BA%94%E5%A4%B4%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3/"/>
      <url>/2019/04/15/http%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%93%8D%E5%BA%94%E5%A4%B4%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>http请求头和返回头字段的解释<br><a id="more"></a></p><h2 id="http请求头响应头字段详解"><a href="#http请求头响应头字段详解" class="headerlink" title="http请求头响应头字段详解"></a>http请求头响应头字段详解</h2><p>作为一名前端开发人员，肯定少不了要和网络打交道，因为要从服务器端拉取数据，从服务端获取数据最常用的方式还是通过HTTP请求。给服务器发请求的时候有请求头，接受服务器响应的时候有响应头，客户端和服务器端互相沟通需要的信息都是通过这些“头”来传送，这些信息是一些类似key:value的键值对。了解这些“头”中字段的含义对于理解整个请求过程有很大的帮助。这里列举了常用的“头”字段的解释以及例子，本文可以作为工具文收藏，以备需要时查看。</p><h3 id="常用标准请求头字段"><a href="#常用标准请求头字段" class="headerlink" title="常用标准请求头字段"></a>常用标准请求头字段</h3><ul><li><p>Accept 设置接受的内容类型<br>Accept: text/plain</p></li><li><p>Accept-Charset 设置接受的字符编码<br>Accept-Charset: utf-8</p></li><li><p>Accept-Encoding 设置接受的编码格式<br>Accept-Encoding: gzip, deflate</p></li><li><p>Accept-Datetime 设置接受的版本时间<br>Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</p></li><li><p>Accept-Language 设置接受的语言<br>Accept-Language: en-US</p></li><li><p>Authorization 设置HTTP身份验证的凭证<br>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</p></li><li><p>Cache-Control 设置请求响应链上所有的缓存机制必须遵守的指令<br>Cache-Control: no-cache</p></li><li><p>Connection 设置当前连接和hop-by-hop协议请求字段列表的控制选项<br>Connection: keep-alive<br>Connection: Upgrade</p></li><li><p>Content-Length 设置请求体的字节长度<br>Content-Length: 348</p></li><li><p>Content-MD5 设置基于MD5算法对请求体内容进行Base64二进制编码<br>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</p></li><li><p>Content-Type 设置请求体的MIME类型（适用POST和PUT请求）<br>Content-Type: application/x-www-form-urlencoded</p></li><li><p>Cookie 设置服务器使用Set-Cookie发送的http cookie<br>Cookie: $Version=1; Skin=new;</p></li><li><p>Date 设置消息发送的日期和时间<br>Date: Tue, 15 Nov 1994 08:12:31 GMT</p></li><li><p>Expect 标识客户端需要的特殊浏览器行为<br>Expect: 100-continue</p></li><li><p>Forwarded 披露客户端通过http代理连接web服务的源信息<br>Forwarded: for=192.0.2.60;proto=http;by=203.0.113.43<br>Forwarded: for=192.0.2.43, for=198.51.100.17</p></li><li><p>From 设置发送请求的用户的email地址<br>From: <a href="mailto:user@example.com" target="_blank" rel="noopener">user@example.com</a></p></li><li><p>Host 设置服务器域名和TCP端口号，如果使用的是服务请求标准端口号，端口号可以省略<br>Host: en.wikipedia.org:8080<br>Host: en.wikipedia.org</p></li><li><p>If-Match 设置客户端的ETag,当时客户端ETag和服务器生成的ETag一致才执行，适用于更新自从上次更新之后没有改变的资源<br>If-Match: “737060cd8c284d8af7ad3082f209582d</p></li><li><p>If-Modified-Since 设置更新时间，从更新时间到服务端接受请求这段时间内如果资源没有改变，允许服务端返回304 Not Modified<br>If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</p></li><li><p>If-None-Match 设置客户端ETag，如果和服务端接受请求生成的ETage相同，允许服务端返回304 Not Modified<br>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</p></li><li><p>If-Range 设置客户端ETag，如果和服务端接受请求生成的ETage相同，返回缺失的实体部分；否则返回整个新的实体<br>If-Range: “737060cd8c284d8af7ad3082f209582d”</p></li><li><p>If-Unmodified-Since 设置更新时间，只有从更新时间到服务端接受请求这段时间内实体没有改变，服务端才会发送响应<br>If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</p></li><li><p>Max-Forwards 限制代理或网关转发消息的次数<br>Max-Forwards: 10</p></li><li><p>Origin 标识跨域资源请求（请求服务端设置Access-Control-Allow-Origin响应字段）<br>Origin: <a href="http://www.example-social-network.com" target="_blank" rel="noopener">http://www.example-social-network.com</a></p></li><li><p>Pragma 设置特殊实现字段，可能会对请求响应链有多种影响<br>Pragma: no-cache</p></li><li><p>Proxy-Authorization 为连接代理授权认证信息<br>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</p></li><li><p>Range 请求部分实体，设置请求实体的字节数范围，具体可以参见HTTP/1.1中的Byte serving<br>Range: bytes=500-999</p></li><li><p>Referer 设置前一个页面的地址，并且前一个页面中的连接指向当前请求，意思就是如果当前请求是在A页面中发送的，那么referer就是A页面的url地址（轶事：这个单词正确的拼法应该是”referrer”,但是在很多规范中都拼成了”referer”，所以这个单词也就成为标准用法）<br>Referer: <a href="http://en.wikipedia.org/wiki/Main_Page" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Main_Page</a></p></li><li><p>TE 设置用户代理期望接受的传输编码格式，和响应头中的Transfer-Encoding字段一样<br>TE: trailers, deflate</p></li><li><p>Upgrade 请求服务端升级协议<br>Upgrade: HTTP/2.0, HTTPS/1.3, IRC/6.9, RTA/x11, websocket</p></li><li><p>User-Agent 用户代理的字符串值<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:12.0) Gecko/20100101 Firefox/21.0</p></li><li><p>Via 通知服务器代理请求<br>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</p></li><li><p>Warning 实体可能会发生的问题的通用警告<br>Warning: 199 Miscellaneous warning</p></li></ul><h3 id="常用非标准请求头字段"><a href="#常用非标准请求头字段" class="headerlink" title="常用非标准请求头字段"></a>常用非标准请求头字段</h3><ul><li><p>X-Requested-With 标识Ajax请求，大部分js框架发送请求时都会设置它为XMLHttpRequest<br>X-Requested-With: XMLHttpRequest</p></li><li><p>DNT 请求web应用禁用用户追踪<br>DNT: 1 (Do Not Track Enabled)<br>DNT: 0 (Do Not Track Disabled)</p></li><li><p>X-Forwarded-For 一个事实标准，用来标识客户端通过HTTP代理或者负载均衡器连接的web服务器的原始IP地址<br>X-Forwarded-For: client1, proxy1, proxy2<br>X-Forwarded-For: 129.78.138.66, 129.78.64.103</p></li><li><p>X-Forwarded-Host 一个事实标准，用来标识客户端在HTTP请求头中请求的原始host,因为主机名或者反向代理的端口可能与处理请求的原始服务器不同<br>X-Forwarded-Host: en.wikipedia.org:8080<br>X-Forwarded-Host: en.wikipedia.org</p></li><li><p>X-Forwarded-Proto 一个事实标准，用来标识HTTP原始协议，因为反向代理或者负载均衡器和web服务器可能使用http,但是请求到反向代理使用的是https<br>X-Forwarded-Proto: https</p></li><li><p>Front-End-Https 微软应用程序和负载均衡器使用的非标准header字段<br>Front-End-Https: on</p></li><li><p>X-Http-Method-Override 请求web应用时，使用header字段中给定的方法（通常是put或者delete）覆盖请求中指定的方法（通常是post）,如果用户代理或者防火墙不支持直接使用put或者delete方法发送请求时，可以使用这个字段<br>X-HTTP-Method-Override: DELETE</p></li><li><p>X-ATT-DeviceId 允许更简单的解析用户代理在AT&amp;T设备上的MakeModel/Firmware<br>X-Att-Deviceid: GT-P7320/P7320XXLPG</p></li><li><p>X-Wap-Profile 设置描述当前连接设备的详细信息的xml文件在网络中的位置<br>x-wap-profile: <a href="http://wap.samsungmobile.com/uaprof/SGH-I777.xml" target="_blank" rel="noopener">http://wap.samsungmobile.com/uaprof/SGH-I777.xml</a></p></li><li><p>Proxy-Connection 早起HTTP版本中的一个误称，现在使用标准的connection字段<br>Proxy-Connection: keep-alive</p></li><li><p>X-UIDH 服务端深度包检测插入的一个唯一ID标识Verizon Wireless的客户<br>X-UIDH: …</p></li><li><p>X-Csrf-Token,X-CSRFToken,X-XSRF-TOKEN 防止跨站请求伪造<br>X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql</p></li><li><p>X-Request-ID,X-Correlation-ID 标识客户端和服务端的HTTP请求<br>X-Request-ID: f058ebd6-02f7-4d3f-942e-904344e8cde5</p></li></ul><h3 id="常用标准响应头字段"><a href="#常用标准响应头字段" class="headerlink" title="常用标准响应头字段"></a>常用标准响应头字段</h3><ul><li><p>Access-Control-Allow-Origin 指定哪些站点可以参与跨站资源共享<br>Access-Control-Allow-Origin: *</p></li><li><p>Accept-Patch 指定服务器支持的补丁文档格式，适用于http的patch方法<br>Accept-Patch: text/example;charset=utf-8</p></li><li><p>Accept-Ranges 服务器通过byte serving支持的部分内容范围类型<br>Accept-Ranges: bytes</p></li><li><p>Age 对象在代理缓存中暂存的秒数<br>Age: 12</p></li><li><p>Allow 设置特定资源的有效行为，适用方法不被允许的http 405错误<br>Allow: GET, HEAD</p></li><li><p>Alt-Svc 服务器使用”Alt-Svc”（Alternative Servicesde的缩写）头标识资源可以通过不同的网络位置或者不同的网络协议获取<br>Alt-Svc: h2=”http2.example.com:443”; ma=7200</p></li><li><p>Cache-Control 告诉服务端到客户端所有的缓存机制是否可以缓存这个对象，单位是秒<br>Cache-Control: max-age=3600</p></li><li><p>Connection 设置当前连接和hop-by-hop协议请求字段列表的控制选项<br>Connection: close</p></li><li><p>Content-Disposition 告诉客户端弹出一个文件下载框，并且可以指定下载文件名<br>Content-Disposition: attachment; filename=”fname.ext”</p></li><li><p>Content-Encoding 设置数据使用的编码类型<br>Content-Encoding: gzip</p></li><li><p>Content-Language 为封闭内容设置自然语言或者目标用户语言<br>Content-Language: en</p></li><li><p>Content-Length 响应体的字节长度<br>Content-Length: 348</p></li><li><p>Content-Location 设置返回数据的另一个位置<br>Content-Location: /index.htm</p></li><li><p>Content-MD5 设置基于MD5算法对响应体内容进行Base64二进制编码<br>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</p></li><li><p>Content-Range 标识响应体内容属于完整消息体中的那一部分<br>Content-Range: bytes 21010-47021/47022</p></li><li><p>Content-Type 设置响应体的MIME类型<br>Content-Type: text/html; charset=utf-8</p></li><li><p>Date 设置消息发送的日期和时间<br>Date: Tue, 15 Nov 1994 08:12:31 GMT</p></li><li><p>ETag 特定版本资源的标识符，通常是消息摘要<br>ETag: “737060cd8c284d8af7ad3082f209582d”</p></li><li><p>Expires 设置响应体的过期时间<br>Expires: Thu, 01 Dec 1994 16:00:00 GMT</p></li><li><p>Last-Modified 设置请求对象最后一次的修改日期<br>Last-Modified: Tue, 15 Nov 1994 12:45:26 GMT</p></li><li><p>Link 设置与其他资源的类型关系<br>Link: ; rel=”alternate”</p></li><li><p>Location 在重定向中或者创建新资源时使用<br>Location: <a href="http://www.w3.org/pub/WWW/People.html" target="_blank" rel="noopener">http://www.w3.org/pub/WWW/People.html</a></p></li><li><p>P3P 以P3P:CP=”your_compact_policy”的格式设置支持P3P(Platform for Privacy Preferences Project)策略，大部分浏览器没有完全支持P3P策略，许多站点设置假的策略内容欺骗支持P3P策略的浏览器以获取第三方cookie的授权<br>P3P: CP=”This is not a P3P policy! See <a href="http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657" target="_blank" rel="noopener">http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657</a> for more info.”</p></li><li><p>Pragma 设置特殊实现字段，可能会对请求响应链有多种影响<br>Pragma: no-cache</p></li><li><p>Proxy-Authenticate 设置访问代理的请求权限<br>Proxy-Authenticate: Basic</p></li><li><p>Public-Key-Pins 设置站点的授权TLS证书<br>Public-Key-Pins: max-age=2592000; pin-sha256=”E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=”;</p></li><li><p>Refresh “重定向或者新资源创建时使用，在页面的头部有个扩展可以实现相似的功能，并且大部分浏览器都支持</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">"refresh"</span> content=<span class="string">"5; url=http://example.com/"</span>&gt;</span><br><span class="line">Refresh: <span class="number">5</span>; url=http:<span class="comment">//www.w3.org/pub/WWW/People.html</span></span><br></pre></td></tr></table></figure></li><li><p>Retry-After 如果实体暂时不可用，可以设置这个值让客户端重试，可以使用时间段（单位是秒）或者HTTP时间<br>Example 1: Retry-After: 120<br>Example 2: Retry-After: Fri, 07 Nov 2014 23:59:59 GMT</p></li><li><p>Server 服务器名称<br>Server: Apache/2.4.1 (Unix)</p></li><li><p>Set-Cookie 设置HTTP Cookie<br>Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</p></li><li><p>Status 设置HTTP响应状态<br>Status: 200 OK</p></li><li><p>Strict-Transport-Security 一种HSTS策略通知HTTP客户端缓存HTTPS策略多长时间以及是否应用到子域<br>Strict-Transport-Security: max-age=16070400; includeSubDomains</p></li><li><p>Trailer 标识给定的header字段将展示在后续的chunked编码的消息中<br>Trailer: Max-Forwards</p></li><li><p>Transfer-Encoding 设置传输实体的编码格式，目前支持的格式： chunked, compress, deflate, gzip, identity<br>Transfer-Encoding: chunked</p></li><li><p>TSV Tracking Status Value，在响应中设置给DNT(do-not-track),可能的取值<br>　　　“!” — under construction<br>　　　“?” — dynamic<br>　　　“G” — gateway to multiple parties<br>　　　“N” — not tracking<br>　　　“T” — tracking<br>　　　“C” — tracking with consent<br>　　　“P” — tracking only if consented<br>　　　“D” — disregarding DNT<br>　　　“U” — updated<br>TSV: ?</p></li><li><p>Upgrade 请求客户端升级协议<br>Upgrade: HTTP/2.0, HTTPS/1.3, IRC/6.9, RTA/x11, websocket</p></li><li><p>Vary 通知下级代理如何匹配未来的请求头已让其决定缓存的响应是否可用而不是重新从源主机请求新的<br>Example 1: Vary: *<br>Example 2: Vary: Accept-Language</p></li><li><p>Via 通知客户端代理，通过其要发送什么响应<br>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</p></li><li><p>Warning 实体可能会发生的问题的通用警告<br>Warning: 199 Miscellaneous warning</p></li><li><p>WWW-Authenticate 标识访问请求实体的身份验证方案<br>WWW-Authenticate: Basic</p></li><li><p>X-Frame-Options 点击劫持保护：<br>　　　deny frame中不渲染<br>　　　sameorigin 如果源不匹配不渲染<br>　　　allow-from 允许指定位置访问<br>　　　allowall 不标准，允许任意位置访问<br>X-Frame-Options: deny</p></li></ul><h3 id="常用非标准响应头字段"><a href="#常用非标准响应头字段" class="headerlink" title="常用非标准响应头字段"></a>常用非标准响应头字段</h3><ul><li><p>X-XSS-Protection 过滤跨站脚本<br>X-XSS-Protection: 1; mode=block</p></li><li><p>Content-Security-Policy, X-Content-Security-Policy,X-WebKit-CSP 定义内容安全策略<br>X-WebKit-CSP: default-src ‘self’</p></li><li><p>X-Content-Type-Options 唯一的取值是””,阻止IE在响应中嗅探定义的内容格式以外的其他MIME格式<br>X-Content-Type-Options: nosniff</p></li><li><p>X-Powered-By 指定支持web应用的技术<br>X-Powered-By: PHP/5.4.0</p></li><li><p>X-UA-Compatible 推荐首选的渲染引擎来展示内容，通常向后兼容，也用于激活IE中内嵌chrome框架插件<br><meta http-equiv="X-UA-Compatible" content="chrome=1"><br>X-UA-Compatible: IE=EmulateIE7<br>X-UA-Compatible: IE=edge<br>X-UA-Compatible: Chrome=1</p></li><li><p>X-Content-Duration 提供音视频的持续时间，单位是秒，只有Gecko内核浏览器支持<br>X-Content-Duration: 42.666</p></li><li><p>Upgrade-Insecure-Requests 标识服务器是否可以处理HTTPS协议<br>Upgrade-Insecure-Requests: 1</p></li><li><p>X-Request-ID,X-Correlation-ID 标识一个客户端和服务端的请求<br>X-Request-ID: f058ebd6-02f7-4d3f-942e-904344e8cde5</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ajax携带cookie</title>
      <link href="/2019/04/15/ajax%E6%90%BA%E5%B8%A6cookie/"/>
      <url>/2019/04/15/ajax%E6%90%BA%E5%B8%A6cookie/</url>
      
        <content type="html"><![CDATA[<p>ajax同域和跨域情况下携带cookie问题<br><a id="more"></a></p><h2 id="ajax携带cookie"><a href="#ajax携带cookie" class="headerlink" title="ajax携带cookie"></a>ajax携带cookie</h2><p>这是一个老生常谈的问题，但是时间长了总容易忘掉，今天记录下来，以便下次方便记起来。</p><p>首先，今天我遇到了一个坑，chrome浏览无论是同域还是跨域状态下，浏览器request headers里居然都不显示，刚开始我还以为是设置错了，后来发现其他浏览器都显示，我想有可能是chrome浏览器安全考虑吧，但是，这并不影响后台接收，只是不显示而已。</p><p>同域下无可厚非，什么都不用做就会带上cookie。</p><p>跨域下的设置：<br>浏览器端，需要设置withCredentials为true<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原生方式</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'http://example.com/'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jquery方式</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">        url: <span class="string">"http://192.168.252.12:3006/post_form"</span>,</span><br><span class="line">        type: <span class="string">'POST'</span>,</span><br><span class="line">        xhrFields: &#123;</span><br><span class="line">            withCredentials: <span class="literal">true</span> <span class="comment">// 这里设置了withCredentials</span></span><br><span class="line">        &#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios方式</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line">axios.defaults.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></p><p>再来说说后端的设置，以nodejs的express为例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回头设置</span></span><br><span class="line">res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://localhost:9000"</span>); <span class="comment">// 注意，这里不能写*,应该是具体的地址</span></span><br><span class="line">res.header(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br></pre></td></tr></table></figure></p><p>最后附上demo代码：<br>前端<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="jquery.js"&gt;&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  ajax cookie demo</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">            url: <span class="string">"http://192.168.252.12:3006/post_form"</span>,</span><br><span class="line">            type: <span class="string">'POST'</span>,</span><br><span class="line">            xhrFields: &#123;</span><br><span class="line">                withCredentials: <span class="literal">true</span> <span class="comment">// 这里设置了withCredentials</span></span><br><span class="line">            &#125;,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;,</span><br><span class="line">            error: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><p>后端<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> multiparty = <span class="built_in">require</span>(<span class="string">'multiparty'</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>); </span><br><span class="line"></span><br><span class="line">app.set(<span class="string">'port'</span>,process.env.PORT || <span class="number">3006</span>);   <span class="comment">//设置端口</span></span><br><span class="line"></span><br><span class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://localhost:9000"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br><span class="line"></span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"client-token,Content-Type,Content-Length, Authorization, Accept,X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>,<span class="string">' 3.2.1'</span>);</span><br><span class="line">    <span class="keyword">if</span>(req.method==<span class="string">"OPTIONS"</span>) res.send(<span class="number">200</span>); <span class="comment">//让options请求快速返回</span></span><br><span class="line">    <span class="keyword">else</span>  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用static中间件 制定public目录为静态资源目录,其中资源不会经过任何处理</span></span><br><span class="line">app.use(express.static(__dirname + <span class="string">'/public'</span>));</span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// for parsing application/json</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;)); <span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line">app.use(cookieParser()); <span class="comment">// cookie解析</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/post_form'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = &#123;</span><br><span class="line">            name: req.body.name,</span><br><span class="line">            info: req.body.info,</span><br><span class="line">            hostName: req.hostname</span><br><span class="line">        &#125;;</span><br><span class="line">        res.cookie(<span class="string">"add"</span>, <span class="string">'test456'</span>, &#123;<span class="attr">maxAge</span>: <span class="number">900000</span>, <span class="attr">httpOnly</span>: <span class="literal">true</span>&#125;); <span class="comment">// 设置cookie</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'cookie-&gt;'</span> + req.cookies.add); <span class="comment">// 读取cookie</span></span><br><span class="line">        res.send(data);  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'服务器启动完成，端口为： '</span>+app.get(<span class="string">'port'</span>) );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>let存在变量提升吗?</title>
      <link href="/2019/04/10/let%E5%AD%98%E5%9C%A8%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E5%90%97/"/>
      <url>/2019/04/10/let%E5%AD%98%E5%9C%A8%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E5%90%97/</url>
      
        <content type="html"><![CDATA[<p>javascript中关于let的一些小知识<br><a id="more"></a></p><h2 id="let存在变量提升吗"><a href="#let存在变量提升吗" class="headerlink" title="let存在变量提升吗?"></a>let存在变量提升吗?</h2><p>let是ES6推出的新语法，平时简单的用大家都明白，但是里边的原理还是很深的。<br>在MDN的文档中对于let的特性是这样说的：</p><ul><li>let 声明的变量的作用域是块级的；</li><li>let 不能重复声明已存在的变量；</li><li>let 有暂时死区，不会被提升。<br>我们来看一个小demo<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  let b = 12</span></span><br><span class="line"><span class="regexp">  console.log(b)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></li></ul><p>代码执行报错：Uncaught SyntaxError: Identifier ‘b’ has already been declared</p><p>先给window创建b的属性，然后再去声明b，这个时候，b是个全局变量可以直接通过b访问，let 又不可以重复声明。此处可以解释的通。那么请看下面的代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  console.log(b)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></p><p>如果把let b 提升到上面的script块就可以声明成功。如果说从上往下执行的话，b是已经存在的了，那么let b是不可以声明的成功的。</p><p>到这里就有些解释不通了。为什么window已经声明了b的属性，会成为一个单独的b变量。let 的时候却没有报错呢。这里就需要对let 是不是会变量提升划一个问号了。</p><p>先把这个问题放在这里，我们继续看下面这段代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.b)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>window下已经声明了b的属性，而且let 一个b 打印出来分别是22和12。这里我们假设存在变量提升的话，那么js引擎在预解析的时候会先声明b对象。然后实际执行的时候，再给window创建b属性。到这里我们就可以解释的通了。既然存在变量提升的话，我是不是可以在声明之前打印一下b的值呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>报错 Uncaught ReferenceError: b is not defined<br>纳尼？难道let 真的不存在变量提升？因为鄙人有强迫症，本着不达目的不罢休的目的，问了度娘，找到了如下的参考资料。<br>要搞清楚提升的本质，需要理解 JS 变量的「创建create、初始化initialize 和赋值assign」。<br>我们来看看 var 声明的「创建、初始化和赋值」过程<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>在执行 fn 时，会有以下过程（不完全）：</p><p>1.进入 fn，为 fn 创建一个环境。<br>2.找到 fn 中所有用 var 声明的变量，在这个环境中「创建」这些变量（即 x 和 y）。<br>3.将这些变量「初始化」为 undefined。<br>4.开始执行代码<br>5.x = 1 将 x 变量「赋值」为 1<br>6.y = 2 将 y 变量「赋值」为 2<br>也就是说 var 声明会在代码执行之前就将「创建变量，并将其初始化为 undefined」。<br>这就解释了为什么在 var x = 1 之前 console.log(x) 会得到 undefined。<br>接下来来看 function 声明的「创建、初始化和赋值」过程<br>假设代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">fn2()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>JS 引擎会有一下过程：<br>1.找到所有用 function 声明的变量，在环境中「创建」这些变量。<br>2.将这些变量「初始化」并「赋值」为 function(){ console.log(2) }。<br>3.开始执行代码 fn2()<br>也就是说 function 声明会在代码执行之前就「创建、初始化并赋值」。<br>接下来看 let 声明的「创建、初始化和赋值」过程<br>假设代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line">  x = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>我们只看 {} 里面的过程：<br>1.找到所有用 let 声明的变量，在环境中「创建」这些变量<br>2.开始执行代码（注意现在还没有初始化）<br>3.执行 x = 1，将 x 「初始化」为 1（这并不是一次赋值，如果代码是 let x，就将 x 初始化为 undefined）<br>4.执行 x = 2，对 x 进行「赋值」<br>这就解释了为什么在 let x 之前使用 x 会报错：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">let</span> x = <span class="string">'global'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x) <span class="comment">// Uncaught ReferenceError: x is not defined</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>原因有两个<br>1.console.log(x) 中的 x 指的是下面的 x，而不是全局的 x<br>2.执行 log 时 x 还没「初始化」，所以不能使用（也就是所谓的暂时死区）<br>看到这里，你应该明白了 let 到底有没有提升：<br>1.let 的「创建」过程被提升了，但是初始化没有提升。<br>2.var 的「创建」和「初始化」都被提升了。<br>function 的「创建」「初始化」和「赋值」都被提升了。</p><p>至此 我们也可以解释</p><ul><li>为什么跨script标签提示重复声明：因为浏览器是从上往下执行js代码的，也就是说在第一段js执行完成之后，再去预解析第二段js代码，执行第二段代码。</li><li>为什么在同一个script标签中可以定义b： 因为在js引擎预解析script的时候先创建了b。然后再执行Object.defineProperty为window增加b属性。所以此处的b和window.b不是一个变量。</li><li>为什么在同一个script标签中可以定义b，但是在b声明之前会报错b没有定义：因为只是创建了b变量，并没有初始化。没有初始化，变量是不可以使用的</li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>封装ajax工具插件</title>
      <link href="/2019/04/03/%E5%B0%81%E8%A3%85ajax%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/"/>
      <url>/2019/04/03/%E5%B0%81%E8%A3%85ajax%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>封装一个自己的ajax工具插件<br><a id="more"></a></p><h2 id="封装ajax工具插件"><a href="#封装ajax工具插件" class="headerlink" title="封装ajax工具插件"></a>封装ajax工具插件</h2><p>我们在平时开发的时候，ajax请求都会用到现有库，用的比较多的如jquery，axios等，偶尔自己写个原生ajax请求的情况也有，这些库是怎么写的呢，我们自己封装一个库，来学习学习ajax的一些基础知识。<br>在写这篇文章的时候，是因为头两天同事问我一个ajax问题，关于请求参数的，我突然回答不出来，忘记了，于是翻出来2年前自己封的ajax工具看了一眼，知道了怎么回事，决定把代码写到博客里，忘了的时候方便看一下。<br>下面我只贴出了核心代码，其他部分我会提供github的地址：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">window,undefined</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jinuxAjax挂载到window上</span></span><br><span class="line"><span class="built_in">window</span>.jinuxAjax = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line">ieAjaxInit();</span><br><span class="line"><span class="comment">//默认参数配置</span></span><br><span class="line"><span class="keyword">var</span> defaultOpt = &#123;</span><br><span class="line">url:<span class="string">''</span>,</span><br><span class="line">type: <span class="string">'GET'</span>,</span><br><span class="line">data: <span class="literal">null</span>,</span><br><span class="line">contentType: <span class="string">'application/x-www-form-urlencoded'</span>,<span class="comment">//'text/plain;charset=UTF-8','application/json','multipart/form-data'</span></span><br><span class="line">timeOut: <span class="number">5000</span>,</span><br><span class="line">files:[],</span><br><span class="line">progress: <span class="literal">null</span>,</span><br><span class="line">before: fn,</span><br><span class="line">success: fn,</span><br><span class="line">error: fn,</span><br><span class="line">complete: fn</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数对象继承获取新参数对象</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">Object</span>.assign)&#123;</span><br><span class="line"><span class="keyword">var</span> opt = <span class="built_in">Object</span>.assign(&#123;&#125;, defaultOpt, opt);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> defaultOpt)&#123;</span><br><span class="line">defaultOpt[name] = opt[name] || defaultOpt[name];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> opt = defaultOpt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestData(opt);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将json格式数据转成application/x-www-form-urlencoded格式数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encodeFormData</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!data) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line"><span class="keyword">var</span> pairs = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> data)&#123;</span><br><span class="line"><span class="keyword">if</span>(!data.hasOwnProperty(name)) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> data[name] === <span class="string">'function'</span>) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">var</span> value = data[name].toString();</span><br><span class="line">name = <span class="built_in">encodeURIComponent</span>(name.replace(<span class="string">'%20'</span>,<span class="string">'+'</span>));</span><br><span class="line">value = <span class="built_in">encodeURIComponent</span>(value.replace(<span class="string">'%20'</span>,<span class="string">'+'</span>));</span><br><span class="line">pairs.push(name + <span class="string">'='</span> + value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pairs.join(<span class="string">'&amp;'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax的get请求函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="keyword">var</span> timeoutFlag = <span class="literal">false</span>; <span class="comment">//是否超时</span></span><br><span class="line"><span class="comment">//启动计时器，做超时处理</span></span><br><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">timeoutFlag = <span class="literal">true</span>;</span><br><span class="line">request.abort();</span><br><span class="line">&#125;,opt.timeOut);</span><br><span class="line"></span><br><span class="line">request.open(<span class="string">'GET'</span>,opt.url +<span class="string">'?'</span>+ encodeFormData(opt.data));</span><br><span class="line">opt.before(); <span class="comment">//请求之前执行before函数</span></span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(request.readyState === <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(timeoutFlag) <span class="keyword">return</span>;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="keyword">if</span>(request.status === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> type = request.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line"><span class="comment">//检查type类型做相应的解析处理</span></span><br><span class="line"><span class="keyword">if</span>(type.indexOf(<span class="string">'xml'</span>) !== <span class="number">-1</span> &amp;&amp; request.responseXML)&#123; <span class="comment">//xml相应</span></span><br><span class="line">opt.success(request.responseXML);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.indexOf(<span class="string">'application/json'</span>) !== <span class="number">-1</span>) &#123; <span class="comment">//json相应</span></span><br><span class="line">opt.success(<span class="built_in">JSON</span>.parse(request.responseText));</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.success(request.responseText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.error(request);</span><br><span class="line">&#125;</span><br><span class="line">opt.complete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">request.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax的post请求函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">postData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest(), sendData=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> timeoutFlag = <span class="literal">false</span>; <span class="comment">//是否超时</span></span><br><span class="line"><span class="comment">//启动计时器，做超时处理</span></span><br><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">timeoutFlag = <span class="literal">true</span>;</span><br><span class="line">request.abort();</span><br><span class="line">&#125;,opt.timeOut);</span><br><span class="line"></span><br><span class="line">request.open(<span class="string">'POST'</span>,opt.url);</span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(request.readyState === <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(timeoutFlag) <span class="keyword">return</span>;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="keyword">if</span>(request.status === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> type = request.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line"><span class="comment">//检查type类型做相应的解析处理</span></span><br><span class="line"><span class="keyword">if</span>(type.indexOf(<span class="string">'xml'</span>) !== <span class="number">-1</span> &amp;&amp; request.responseXML)&#123; <span class="comment">//xml相应</span></span><br><span class="line">opt.success(request.responseXML);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.indexOf(<span class="string">'application/json'</span>) !== <span class="number">-1</span>) &#123; <span class="comment">//json相应</span></span><br><span class="line">opt.success(<span class="built_in">JSON</span>.parse(request.responseText));</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.success(request.responseText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.error(request);</span><br><span class="line">&#125;</span><br><span class="line">opt.complete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理接收进度事件</span></span><br><span class="line"><span class="keyword">if</span>(opt.progress.enable &amp;&amp; request.upload)&#123;</span><br><span class="line">request.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(ev.lengthComputable)&#123;</span><br><span class="line">opt.progress.receiveHandle(ev);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">request.upload.onload = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">opt.progress.successHandle(ev);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(opt.contentType === <span class="string">'application/x-www-form-urlencoded'</span>)&#123;</span><br><span class="line">request.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>);</span><br><span class="line">sendData = encodeFormData(opt.data);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt.contentType === <span class="string">'application/json'</span>) &#123;</span><br><span class="line">request.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/json; charset=utf-8'</span>);</span><br><span class="line">sendData = <span class="built_in">JSON</span>.stringify(opt.data);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt.contentType === <span class="string">'multipart/form-data'</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> opt.data)&#123;</span><br><span class="line"><span class="keyword">if</span>( !opt.data.hasOwnProperty(name) ) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">typeof</span> opt.data[name] === <span class="string">'function'</span> ) <span class="keyword">continue</span>; </span><br><span class="line">fd.append(name,opt.data[name]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;opt.files.length; i++)&#123;</span><br><span class="line">fd.append(<span class="string">'file'</span>+i,opt.files[i]);</span><br><span class="line">&#125;</span><br><span class="line">sendData = fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.send(sendData);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax请求函数，在函数内再调用get或者post</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(opt.type === <span class="string">'GET'</span>)&#123;</span><br><span class="line">getData(opt);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">postData(opt);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个空函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果是ie6，创建XMLHttpRequest对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ieAjaxInit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest === <span class="literal">undefined</span>)&#123;</span><br><span class="line"><span class="built_in">window</span>.XMLHttpRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Msxml2.XMLHTTP.6.0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e1) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Msxml2.XMLHTTP.3.0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e2) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'不支持XMLHttpRequest'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure></p><p>详细代码请<a href="https://github.com/jinux7/jinux-ajax" target="_blank" rel="noopener">点击这里看源码</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防抖与节流</title>
      <link href="/2019/04/03/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/"/>
      <url>/2019/04/03/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<p>简单的介绍一下防抖与节流<br><a id="more"></a><br>作为一名前端开发者，我们经常会处理各种事件，比如常见的click、scroll、 resize等等。仔细一想，会发现像scroll、scroll、onchange这类事件会频繁触发，如果我们在回调中计算元素位置、做一些跟DOM相关的操作，引起浏览器回流和重绘，频繁触发回调，很可能会造成浏览器掉帧，甚至会使浏览器崩溃，影响用户体验。针对这种现象，目前有两种常用的解决方案：防抖和节流。</p><h2 id="防抖（debounce）"><a href="#防抖（debounce）" class="headerlink" title="防抖（debounce）"></a>防抖（debounce）</h2><p>所谓防抖，就是指触发事件后，就是把触发非常频繁的事件合并成一次去执行。即在指定时间内只执行一次回调函数，如果在指定的时间内又触发了该事件，则回调函数的执行时间会基于此刻重新开始计算。</p><ul><li>以我们生活中乘车刷卡的情景举例，只要乘客不断地在刷卡，司机师傅就不能开车，乘客刷卡完毕之后，司机会等待几分钟，确定乘客坐稳再开车。如果司机在最后等待的时间内又有新的乘客上车，那么司机等乘客刷卡完毕之后，还要再等待一会，等待所有乘客坐稳再开车。<br><img src="/2019/04/03/防抖与节流/1.jpg" alt="img"><br>具体应该怎么去实现这样的功能呢？第一时间肯定会想到使用setTimeout方法，那我们就尝试写一个简单的函数来实现这个功能吧~<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debounce = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timeId;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = <span class="keyword">this</span>, args = <span class="built_in">arguments</span>;</span><br><span class="line">    timeId &amp;&amp; clearTimeout(timeout);</span><br><span class="line">    timeId = setTimeout(<span class="function"><span class="keyword">function</span> </span>&#123;</span><br><span class="line">          fn.apply(context, args);</span><br><span class="line">        &#125;, delayTime)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>思路解析：<br>执行debounce函数之后会返回一个新的函数，通过闭包的形式，维护一个变量timeId，每次执行该函数的时候会结束之前的延迟操作，重新执行setTimeout方法，也就实现了上面所说的指定的时间内多次触发同一个事件，会合并执行一次。<br>温馨提示：<br>1、上述代码中arguments只会保存事件回调函数中的参数，譬如：事件对象等，并不会保存fn、delayTime<br>2、使用apply改变传入的fn方法中的this指向，指向绑定事件的DOM元素。</p><h2 id="节流（throttle）"><a href="#节流（throttle）" class="headerlink" title="节流（throttle）"></a>节流（throttle）</h2><p>所谓节流，是指频繁触发事件时，只会在指定的时间段内执行事件回调，即触发事件间隔大于等于指定的时间才会执行回调函数。</p><ul><li>类比到生活中的水龙头，拧紧水龙头到某种程度会发现，每隔一段时间，就会有水滴流出。<br><img src="/2019/04/03/防抖与节流/2.jpg" alt="img"><br>说到时间间隔，大家肯定会想到使用setTimeout来实现，在这里，我们使用两种方法来简单实现这种功能：时间戳和setTimeout定时器。</li><li>时间戳<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = (fn, delayTime) = &gt;&#123;</span><br><span class="line">    <span class="keyword">var</span> _start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _now = <span class="built_in">Date</span>.now(),</span><br><span class="line">        context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (_now - _start &gt;= delayTime) &#123;</span><br><span class="line">            fn.apply(context, args);</span><br><span class="line">            _start = <span class="built_in">Date</span>.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>通过比较两次时间戳的间隔是否大于等于我们事先指定的时间来决定是否执行事件回调。</p><ul><li>定时器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            flag = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn.apply(context, args);</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;,delayTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>在上述实现过程中，我们设置了一个标志变量flag，当delayTime之后执行事件回调，便会把这个变量重置，表示一次回调已经执行结束。 对比上述两种实现，我们会发现一个有趣的现象：<br>1、使用时间戳方式，页面加载的时候就会开始计时，如果页面加载时间大于我们设定的delayTime，第一次触发事件回调的时候便会立即fn，并不会延迟。如果最后一次触发回调与前一次触发回调的时间差小于delayTime，则最后一次触发事件并不会执行fn；<br>2、使用定时器方式，我们第一次触发回调的时候才会开始计时，如果最后一次触发回调事件与前一次时间间隔小于delayTime，delayTime之后仍会执行fn。<br>这两种方式有点优势互补的意思，哈哈~<br>我们考虑把这两种方式结合起来，便会在第一次触发事件时执行fn，最后一次与前一次间隔比较短，delayTime之后再次执行fn。<br>想法简单实现如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag, _start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>,</span><br><span class="line">        _now = <span class="built_in">Date</span>.now(),</span><br><span class="line">        remainTime = delayTime - (_now - _start);</span><br><span class="line">        <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">            &#125;,remainTime)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过上面的分析，可以很明显的看出函数防抖和函数节流的区别：<br>频繁触发事件时，函数防抖只会在最后一次触发事件只会才会执行回调内容，其他情况下会重新计算延迟事件，而函数节流便会很有规律的每隔一定时间执行一次回调函数。</p><ul><li>requestAnimationFrame<br>之前，我们使用setTimeout简单实现了防抖和节流功能，如果我们不考虑兼容性，追求精度比较高的页面效果，可以考虑试试html5提供的API–requestAnimationFrame。<br>与setTimeout相比，requestAnimationFrame的时间间隔是有系统来决定，保证屏幕刷新一次，回调函数只会执行一次，比如屏幕的刷新频率是60HZ，即间隔1000ms/60会执行一次回调。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn();</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><p>上述代码的基本功能就是保证在屏幕刷新的时候（对于大多数的屏幕来说，大约16.67ms），可以执行一次回调函数fn。使用这种方式也存在一种比较明显的缺点，时间间隔只能跟随系统变化，我们无法修改，但是准确性会比setTimeout高一些。<br>注意：</p><ul><li>防抖和节流只是减少了事件回调函数的执行次数，并不会减少事件的触发频率。</li><li>防抖和节流并没有从本质上解决性能问题，我们还应该注意优化我们事件回调函数的逻辑功能，避免在回调中执行比较复杂的DOM操作，减少浏览器reflow和repaint。<br>上面的示例代码比较简单，只是说明了基本的思路。目前已经有工具库实现了这些功能，比如underscore，考虑的情况也会比较多，大家可以去查看源码，学习作者的思路，加深理解。<br>underscore的debounce方法源码：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">_.debounce = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, immediate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, result;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params">context, args</span>) </span>&#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (args) result = func.apply(context, args);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> debounced = restArguments(<span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (timeout) clearTimeout(timeout);</span><br><span class="line">        <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">            <span class="keyword">var</span> callNow = !timeout;</span><br><span class="line">            timeout = setTimeout(later, wait);</span><br><span class="line">            <span class="keyword">if</span> (callNow) result = func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeout = _.delay(later, wait, <span class="keyword">this</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line">    debounced.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><p>underscore的throttle源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">_.throttle = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, context, args, result;</span><br><span class="line">    <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!options) options = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        previous = options.leading === <span class="literal">false</span> ? <span class="number">0</span> : _.now();</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> throttled = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> now = _.now();</span><br><span class="line">        <span class="keyword">if</span> (!previous &amp;&amp; options.leading === <span class="literal">false</span>) previous = now;</span><br><span class="line">        <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">        context = <span class="keyword">this</span>;</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">            <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">                clearTimeout(timeout);</span><br><span class="line">                timeout = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            previous = now;</span><br><span class="line">            result = func.apply(context, args);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> (!timeout &amp;&amp; options.trailing !== <span class="literal">false</span>) &#123;</span><br><span class="line">            timeout = setTimeout(later, remaining);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">    throttled.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        previous = <span class="number">0</span>;</span><br><span class="line">        timeout = context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> throttled;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML5中Video标签无法播放mp4的解决办法</title>
      <link href="/2019/03/21/HTML5%E4%B8%ADVideo%E6%A0%87%E7%AD%BE%E6%97%A0%E6%B3%95%E6%92%AD%E6%94%BEmp4%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
      <url>/2019/03/21/HTML5%E4%B8%ADVideo%E6%A0%87%E7%AD%BE%E6%97%A0%E6%B3%95%E6%92%AD%E6%94%BEmp4%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>解决其它格式视频转mp4格式文件，video标签无法播放问题<br><a id="more"></a></p><h2 id="HTML5中Video标签无法播放mp4的解决办法"><a href="#HTML5中Video标签无法播放mp4的解决办法" class="headerlink" title="HTML5中Video标签无法播放mp4的解决办法"></a>HTML5中Video标签无法播放mp4的解决办法</h2><p>首先，浏览器使用环境chrome<br>在使用video标签播放视频的时候，我一般都选择mp4格式的文件，在网上下载的demo视频或者是手机拍摄的mp4文件都可以播放，但是，我用格式工厂把avi格式的文件转换成mp4文件就无法播放，为什么呢？<br>带着疑问，上网找答案，找到了原因，如下：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/1.png" alt="img"><br>使用格式工厂的mp4转换功能转出来的mp4文件并不能使用，于是把能播放的视频文件和不能播放的视频文件的编码格式对比了一下<br>可以播放的：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/2.png" alt="img"><br>不可以播放的：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/3.png" alt="img"><br>所以，在格式工厂转换的时候需要转成AVC编码格式的mp4文件<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/4.png" alt="img"><br>好了，按照这种方式就可以正常播放了。<br>*补充更新：<br>上边的方式在pc端chrome浏览器上可以，但是在移动端上还是无法播放，最后没有办法，我采用了WebM格式。<br>格式工厂可以转换，见下图<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/5.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端兼容性</title>
      <link href="/2019/03/05/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
      <url>/2019/03/05/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%85%BC%E5%AE%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>移动端有关html标签节点的兼容性问题<br><a id="more"></a></p><h2 id="移动端兼容性"><a href="#移动端兼容性" class="headerlink" title="移动端兼容性"></a>移动端兼容性</h2><h3 id="meta标签"><a href="#meta标签" class="headerlink" title="meta标签"></a>meta标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// viewport就啥也不说了，必须得加</span></span><br><span class="line">&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动或禁用自动识别页面中的电话号码</span></span><br><span class="line">&lt;meta name=<span class="string">"format-detection"</span> content=<span class="string">"telephone=no"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动或禁用自动识别邮箱地址</span></span><br><span class="line">&lt;meta name=<span class="string">"format-detection"</span>  content=<span class="string">"email=no"</span> /&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 Web 应用是否以全屏模式运行。</span></span><br><span class="line">&lt;meta name=<span class="string">"apple-mobile-web-app-capable"</span> content=<span class="string">"yes"</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 的 safari 顶端状态条的样式，可选的参数有：default、black、black-translucent</span></span><br><span class="line">&lt;meta name=<span class="string">"apple-mobile-web-app-status-bar-style"</span>  content=<span class="string">"black"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// winphone 系统 a、input 标签被点击时产生的半透明灰色背景怎么去掉</span></span><br><span class="line">&lt;meta name=<span class="string">"msapplication-tap-highlight"</span>  content=<span class="string">"no"</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="body-img等标签"><a href="#body-img等标签" class="headerlink" title="body,img等标签"></a>body,img等标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁止 ios 长按时不触发系统的菜单，禁止 ios&amp;android 长按时下载图片</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-touch-callout: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止ios和android用户选中文字</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-user-select:none</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="图片不清晰"><a href="#图片不清晰" class="headerlink" title="图片不清晰"></a>图片不清晰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如，iphone6，设备款375，物理像素750，正常一张占1/3屏幕的图片，125px，如果准备一张125的</span></span><br><span class="line"><span class="comment">// 肯定会模糊，必须准备250px的。如果像iphone6 plus，像素比3， 占1/3的图片138px，实际需要414px。</span></span><br><span class="line"><span class="comment">// 解决方案：</span></span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    .css &#123;</span><br><span class="line">      background-image: url(<span class="string">'2x.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    .css &#123;</span><br><span class="line">      background-image: url(<span class="string">'3x.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="表单的标签"><a href="#表单的标签" class="headerlink" title="表单的标签"></a>表单的标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input 输入框不可编辑</span></span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"xxx"</span> disabled=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"xxx"</span> readonly=<span class="string">"true"</span>/&gt;</span><br><span class="line"><span class="comment">/* disabled 文本框变灰，通过request.getParameter("name")得不到文本框中的内容</span></span><br><span class="line"><span class="comment">readonly 只是使文本框不能输入，样式没有变化，通过request.getParameter("name")可以得到内容 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 输入的时候英文首字母的默认大写</span></span><br><span class="line">&lt;input autocapitalize=<span class="string">"off"</span> autocorrect=<span class="string">"off"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// android 上去掉语音输入按钮</span></span><br><span class="line">input::-webkit-input-speech-button &#123;</span><br><span class="line">  display: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios系统中元素被触摸时产生的半透明灰色遮罩怎么去掉</span></span><br><span class="line">a,button,input,textarea&#123;</span><br><span class="line">  -webkit-tap-highlight-color: rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>;)</span><br><span class="line">  -webkit-user-modify:read-write-plaintext-only;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">/* -webkit-user-modify 这个属性使用需谨慎，副作用就是输入法不再能够输入多个字符</span></span><br><span class="line"><span class="comment">另外，有些机型去除不了，如小米2</span></span><br><span class="line"><span class="comment">对于按钮类，不使用a或者input标签，直接用div标签 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单元素的默认外观重置</span></span><br><span class="line">  -webkit-appearance:none;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改表单输入框 placeholder 的颜色值</span></span><br><span class="line">  input::-webkit-input-placeholder&#123;color:#ccc;&#125; </span><br><span class="line">  input:focus::-webkit-input-placeholder&#123;color:#eee;&#125; </span><br><span class="line"><span class="comment">// 注意 placeholder,  ios 可以换行，android 不可以</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Input 的placeholder会出现文本位置偏上的情况</span></span><br><span class="line">input 的placeholder会出现文本位置偏上的情况：PC端设置line-height等于height能够对齐，而移动端仍然是偏上，解决是设置line-height：normal</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用 select 默认下拉箭头</span></span><br><span class="line">select::-ms-expand &#123;<span class="attr">display</span>: none;&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用 radio 和 checkbox 默认样式</span></span><br><span class="line">input[type=radio]::-ms-check,</span><br><span class="line">input[type=checkbox]::-ms-check &#123; </span><br><span class="line">  display: none; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="a标签"><a href="#a标签" class="headerlink" title="a标签"></a>a标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">部分安卓手机 a 标签用作按钮的时候，页面显示空白</span><br><span class="line">解决办法：用 button 标签替换 a 标签</span><br></pre></td></tr></table></figure><h3 id="button"><a href="#button" class="headerlink" title="button"></a>button</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去除button在ios上的默认样式</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-appearance: none;</span><br><span class="line">  border-radius: <span class="number">0</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不想让按钮touch时有蓝色的边框     </span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-tap-highlight-color:rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="audio和video"><a href="#audio和video" class="headerlink" title="audio和video"></a>audio和video</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在ios和andriod中,audio元素和video元素在无法自动播放</span></span><br><span class="line"><span class="comment">// 应对方案：触屏即播</span></span><br><span class="line">$(<span class="string">'html'</span>).one(<span class="string">'touchstart'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    audio.play()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 视频默认全屏播放，如何阻止全屏播放－ webkit-playsinline</span></span><br><span class="line">&lt;video id=<span class="string">"video"</span> src=<span class="string">""</span> webkit-playsinline poster=<span class="string">""</span> &gt;&lt;<span class="regexp">/video&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 视频，音频获取播放结束后的回调函数－ended</span></span><br><span class="line"><span class="regexp">$('#video').on('ended',function()&#123;</span></span><br><span class="line"><span class="regexp">  alert(0);</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure><h3 id="click点击事件"><a href="#click点击事件" class="headerlink" title="click点击事件"></a>click点击事件</h3><h4 id="300毫秒延迟"><a href="#300毫秒延迟" class="headerlink" title="300毫秒延迟"></a>300毫秒延迟</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 300毫秒延迟解决方案</span></span><br><span class="line"><span class="number">1.</span>fastclick可以解决在手机上点击事件的<span class="number">300</span>ms延迟</span><br><span class="line"><span class="number">2.</span>zepto的touch模块，tap事件也是为了解决在click的延迟问题</span><br><span class="line"><span class="number">3.</span>触摸事件的响应顺序为 touchstart --&gt; touchmove --&gt; touchend --&gt; click,也可以通过绑定ontouchstart事件，加快对事件的响应，解决<span class="number">300</span>ms延迟问题</span><br></pre></td></tr></table></figure><h4 id="ios-label-span-监听click事件-不触发"><a href="#ios-label-span-监听click事件-不触发" class="headerlink" title="ios(label,span)监听click事件,不触发"></a>ios(label,span)监听click事件,不触发</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所监听元素加上</span></span><br><span class="line">.css &#123;</span><br><span class="line">  cursor:pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h2><h3 id="webkit-keyframes-注意"><a href="#webkit-keyframes-注意" class="headerlink" title="@-webkit-keyframes 注意"></a>@-webkit-keyframes 注意</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以<span class="number">0</span>%开始<span class="number">100</span>%结束，<span class="number">0</span>%的百分号不能去掉</span><br><span class="line">after和before伪类无法使用动画</span><br></pre></td></tr></table></figure><h3 id="border-radius-注意"><a href="#border-radius-注意" class="headerlink" title="border-radius 注意"></a>border-radius 注意</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不支持%单位</span><br><span class="line">三星 Galaxy S4中自带浏览器不支持 border-radius 缩写</span><br><span class="line">同时写入 border-radius 和背景色的时候，背景色会溢出到圆角以外部分</span><br></pre></td></tr></table></figure><h3 id="解决-transition-闪屏"><a href="#解决-transition-闪屏" class="headerlink" title="解决 transition 闪屏"></a>解决 transition 闪屏</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.css&#123; </span><br><span class="line">  <span class="comment">/*设置内嵌的元素在 3D 空间如何呈现：保留 3D*/</span> </span><br><span class="line">  -webkit-transform-style: preserve<span class="number">-3</span>d; </span><br><span class="line">  <span class="comment">/*（设置进行转换的元素的背面在面对用户时是否可见：隐藏）*/</span> </span><br><span class="line">  -webkit-backface-visibility: hidden; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="阻止用户调整微信浏览器字体大小"><a href="#阻止用户调整微信浏览器字体大小" class="headerlink" title="阻止用户调整微信浏览器字体大小"></a>阻止用户调整微信浏览器字体大小</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ios 管事，android 暂无解决方案</span></span><br><span class="line">body&#123;</span><br><span class="line">  -webkit-text-size-adjust: <span class="number">100</span>%!important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="屏幕旋转的事件和样式"><a href="#屏幕旋转的事件和样式" class="headerlink" title="屏幕旋转的事件和样式"></a>屏幕旋转的事件和样式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 事件</span></span><br><span class="line"><span class="built_in">window</span>.orientation，取值：正负<span class="number">90</span>表示横屏模式、<span class="number">0</span>和<span class="number">180</span>表现为竖屏模式；</span><br><span class="line"><span class="comment">// 代码判断</span></span><br><span class="line"><span class="built_in">window</span>.onorientationchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">  <span class="keyword">switch</span>(<span class="built_in">window</span>.orientation)&#123; </span><br><span class="line">    <span class="keyword">case</span> <span class="number">-90</span>: </span><br><span class="line">    <span class="keyword">case</span> <span class="number">90</span>: </span><br><span class="line">        alert(<span class="string">"横屏:"</span> + <span class="built_in">window</span>.orientation); </span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: </span><br><span class="line">    <span class="keyword">case</span> <span class="number">180</span>: </span><br><span class="line">        alert(<span class="string">"竖屏:"</span> + <span class="built_in">window</span>.orientation); </span><br><span class="line">    <span class="keyword">break</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 样式</span></span><br><span class="line"><span class="comment">/*竖屏时使用的样式*/</span> </span><br><span class="line">@media all and (orientation:portrait) &#123;</span><br><span class="line">  .css&#123;&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横屏时使用的样式*/</span> </span><br><span class="line">@media all and (orientation:landscape) &#123;</span><br><span class="line">  .css&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fixed元素无法点击"><a href="#fixed元素无法点击" class="headerlink" title="fixed元素无法点击"></a>fixed元素无法点击</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">场景：父元素设置position: fixed;</span><br><span class="line">子元素设置position: absolute;</span><br><span class="line">此时，如果父元素/子元素还设置了overflow: hidden 则出现“父元素遮挡该子元素“的bug。</span><br><span class="line">视觉(view)层并没有出现遮挡，只是无法触发绑定在该子元素上的事件。可理解为：「看到点不到」。</span><br><span class="line">补充： 页面往下滚动，触发position: fixed;的特性时，才会出现这个bug，在最顶不会出现。</span><br><span class="line">测试平台： 小米<span class="number">1</span>S，Android4<span class="number">.0</span>的Chrome18</span><br><span class="line">解决办法： 把父元素和子元素的overflow: hidden去掉。</span><br></pre></td></tr></table></figure><h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">body如果设置height:<span class="number">100</span>%;overflow:hidden是依然可以滑动的，如果需禁止，</span><br><span class="line">要再加一层div设置 height:<span class="number">100</span>%加overflow：hidden（html,body加height:<span class="number">100</span>%） ，</span><br><span class="line">这样元素超出body的高度也不能滑动了。</span><br><span class="line">或者同时给html，body加height:<span class="number">100</span>%;overflow:hidden</span><br></pre></td></tr></table></figure><h3 id="ios阻止旋转屏幕时自动调整字体大小"><a href="#ios阻止旋转屏幕时自动调整字体大小" class="headerlink" title="ios阻止旋转屏幕时自动调整字体大小"></a>ios阻止旋转屏幕时自动调整字体大小</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html, body, form, fieldset, p, div, h1, h2, h3, h4, h5, h6 &#123;</span><br><span class="line">  -webkit-text-size-adjust:none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过transform进行skew变形，rotate旋转会造成出现锯齿现象"><a href="#通过transform进行skew变形，rotate旋转会造成出现锯齿现象" class="headerlink" title="通过transform进行skew变形，rotate旋转会造成出现锯齿现象"></a>通过transform进行skew变形，rotate旋转会造成出现锯齿现象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-webkit-transform: rotate(<span class="number">-4</span>deg) skew(<span class="number">10</span>deg) translateZ(<span class="number">0</span>);</span><br><span class="line">transform: rotate(<span class="number">-4</span>deg) skew(<span class="number">10</span>deg) translateZ(<span class="number">0</span>);</span><br><span class="line">outline: <span class="number">1</span>px solid rgba(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="iOS6下伪类-hover"><a href="#iOS6下伪类-hover" class="headerlink" title="iOS6下伪类:hover"></a>iOS6下伪类:hover</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">除了&lt;a&gt;之外的元素无效；在Android下则有效。类似</span><br><span class="line">div#topFloatBar_l:hover #topFloatBar_menu &#123;</span><br><span class="line">  display:block; </span><br><span class="line">&#125;</span><br><span class="line">这样的导航显示在iOS6点击没有点击效果，只能通过增加点击侦听器给元素增减<span class="class"><span class="keyword">class</span>来控制子元素。</span></span><br></pre></td></tr></table></figure><h3 id="点击按钮时背景变黑色的解决"><a href="#点击按钮时背景变黑色的解决" class="headerlink" title="点击按钮时背景变黑色的解决"></a>点击按钮时背景变黑色的解决</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击按钮时背景变黑色的解决</span></span><br><span class="line">-webkit-tap-highlight-color: transparent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们去掉默认的大黑块儿后，要添加自己想要的点击时按住按钮的效果，用以下代码：</span></span><br><span class="line">span:active&#123;</span><br><span class="line">  box-shadow: inset 0 5px 10px #B41313,inset 0 -5px 10px #B41313;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加完上述代码后，在安卓上，都可以看到想要的效果，但是iphone上依旧不行，</span></span><br><span class="line"><span class="comment">// :active  需要一个触发事件才可以，于是乎，用以下代码：</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><h3 id="retina屏下border的1px会变粗"><a href="#retina屏下border的1px会变粗" class="headerlink" title="retina屏下border的1px会变粗"></a>retina屏下border的1px会变粗</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为像素比，比如，iphone6的像素比是2，window.devicePixelRatio可以查看，</span></span><br><span class="line"><span class="comment">// iphone6的设备宽是375,而物理像素是750，在css中的1px，实际控制的是2px的像素，</span></span><br><span class="line"><span class="comment">// 所以看起来会变粗了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决一：IOS8下已经支持带小数的px值, media query对应devicePixelRatio有个查询值-webkit-min-device-pixel-ratio, css可以写成这样</span></span><br><span class="line">.border &#123; border: 1px solid #999 &#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    .border &#123; border: 0.5px solid #999 &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    .border &#123; border: 0.333333px solid #999 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决二：background渐变</span></span><br><span class="line"><span class="comment">// 背景渐变, 渐变在透明色和边框色中间分割, frozenUI用的就是这种方法, 借用它的上边框写法:</span></span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)&#123;</span><br><span class="line">    .ui-border-t &#123;</span><br><span class="line">        background-position: left top;</span><br><span class="line">        background-image: -webkit-gradient(linear,left bottom,left top,color-stop(0.5,transparent),color-stop(0.5,#e0e0e0),to(#e0e0e0));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决三：</span></span><br><span class="line"><span class="comment">// :before, :after与transform</span></span><br><span class="line">.radius-border&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)&#123;</span><br><span class="line">    .radius-border:before&#123;</span><br><span class="line">        content: <span class="string">""</span>;</span><br><span class="line">        pointer-events: none; <span class="comment">/* 防止点击触发 */</span></span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: <span class="number">200</span>%;</span><br><span class="line">        height: <span class="number">200</span>%;</span><br><span class="line">        left: <span class="number">0</span>;</span><br><span class="line">        top: <span class="number">0</span>;</span><br><span class="line">        border-radius: <span class="number">8</span>px;</span><br><span class="line">        border:1px solid #999;</span><br><span class="line">        -webkit-transform(scale(<span class="number">0.5</span>));</span><br><span class="line">        -webkit-transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">        transform(scale(<span class="number">0.5</span>));</span><br><span class="line">        transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="iphoneX兼容补充"><a href="#iphoneX兼容补充" class="headerlink" title="iphoneX兼容补充"></a>iphoneX兼容补充</h2><p><a href="/2020/03/13/iPhoneX适配/">iphoneX适配</a></p><h2 id="微信浏览器-amp-amp-安卓-amp-amp-ios禁止页面下拉刷新"><a href="#微信浏览器-amp-amp-安卓-amp-amp-ios禁止页面下拉刷新" class="headerlink" title="微信浏览器&amp;&amp;安卓&amp;&amp;ios禁止页面下拉刷新"></a>微信浏览器&amp;&amp;安卓&amp;&amp;ios禁止页面下拉刷新</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// css</span><br><span class="line">body &#123;</span><br><span class="line">  touch-action: none;</span><br><span class="line">&#125; </span><br><span class="line">// js</span><br><span class="line">document.body.addEventListener(&apos;touchmove&apos;, (e) =&gt; &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  e.stopPropagation();</span><br><span class="line">&#125;, &#123; passive: false &#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
            <tag> 兼容性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue自定义指令之输入框限制字数</title>
      <link href="/2019/03/01/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E4%B9%8B%E8%BE%93%E5%85%A5%E6%A1%86%E9%99%90%E5%88%B6%E5%AD%97%E6%95%B0/"/>
      <url>/2019/03/01/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E4%B9%8B%E8%BE%93%E5%85%A5%E6%A1%86%E9%99%90%E5%88%B6%E5%AD%97%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>input输入框限制字数的指令制作<br><a id="more"></a></p><h2 id="vue自定义指令之输入框限制字数"><a href="#vue自定义指令之输入框限制字数" class="headerlink" title="vue自定义指令之输入框限制字数"></a>vue自定义指令之输入框限制字数</h2><p>vue自定义指令没啥说的，说明见<a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">官网</a>,具体代码见下面:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'inputvalidatecounter'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nSpan = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>),</span><br><span class="line">        nInput = el.querySelector(<span class="string">'input'</span>),</span><br><span class="line">        count = +binding.expression || <span class="number">50</span>;</span><br><span class="line">    el.appendChild(nSpan);</span><br><span class="line">    nSpan.innerHTML = <span class="string">'还可以填写'</span>+count+<span class="string">'字'</span>;</span><br><span class="line">    nInput.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> num = count - <span class="keyword">this</span>.value.length;</span><br><span class="line">      <span class="keyword">if</span>(num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> substr = <span class="keyword">this</span>.value.substring(<span class="number">0</span>,count<span class="number">-1</span>);</span><br><span class="line">          <span class="keyword">this</span>.value = substr;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      nSpan.innerHTML = <span class="string">'还可以填写'</span>+(num&lt;<span class="number">0</span>?<span class="number">0</span>:num)+<span class="string">'字'</span>;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>需要注意的地方：</p><ul><li>这个指令只适用于iview的Input组件，看里边操作dom元素就可以看出来，想改成其它的也是简单。</li><li>在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。</li></ul><blockquote><p>2019年3月4日更改</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'inputvalidatecounter'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding, vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nSpan = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>),</span><br><span class="line">        nInput = el.querySelector(<span class="string">'input'</span>) || el.querySelector(<span class="string">'textarea'</span>),</span><br><span class="line">        count = +binding.expression || <span class="number">50</span>;</span><br><span class="line">    el.appendChild(nSpan);</span><br><span class="line">    nSpan.innerHTML = <span class="string">'还可以填写'</span>+count+<span class="string">'字'</span>;</span><br><span class="line">    nInput.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> num = count - <span class="keyword">this</span>.value.length;</span><br><span class="line">      <span class="keyword">if</span>(num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> substr = <span class="keyword">this</span>.value.substring(<span class="number">0</span>,count);</span><br><span class="line">          <span class="keyword">this</span>.value = substr;</span><br><span class="line">          <span class="comment">// 新添加开始</span></span><br><span class="line">          <span class="keyword">var</span> keyArr = vnode.data.model.expression.split(<span class="string">'.'</span>);</span><br><span class="line">          <span class="keyword">var</span> evalStr = <span class="string">'vnode.context._data'</span>;</span><br><span class="line">          keyArr.forEach(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span><br><span class="line">            evalStr += <span class="string">'["'</span>+item+<span class="string">'"]'</span>;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="built_in">eval</span>(evalStr+<span class="string">'="'</span>+<span class="keyword">this</span>.value+<span class="string">'"'</span>)</span><br><span class="line">          <span class="comment">// 新添加结束</span></span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      nSpan.innerHTML = <span class="string">'还可以填写'</span>+(num&lt;<span class="number">0</span>?<span class="number">0</span>:num)+<span class="string">'字'</span>;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>新添加的内容只有几行，其实是为了修改第一版的bug，当在input里输入内容的时候，超过一定字数后，进入延迟函数，这里把input的value值更改了，但是并没有更改这个指令所在组件里v-model的值，所以，这里需要修正。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vnode是这个指令所在的组建的虚拟dom</span></span><br><span class="line"><span class="comment">// vnode.data.model.expression 这就可以直接找到v-model里的变量名</span></span><br><span class="line"><span class="keyword">var</span> keyArr = vnode.data.model.expression.split(<span class="string">'.'</span>);</span><br><span class="line"><span class="comment">// vnode知道了，vnode.context很显然就是组件所在的父级组件，可以通过 _data 这个数据去改变v-model里变量的值。</span></span><br><span class="line"><span class="keyword">var</span> evalStr = <span class="string">'vnode.context._data'</span>;</span><br><span class="line">keyArr.forEach(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span><br><span class="line">  evalStr += <span class="string">'["'</span>+item+<span class="string">'"]'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 经过上边的循环是因为这种情况, v-model="formitem.name"，像这种的值，而不是v-model="name"这种。</span></span><br><span class="line"><span class="comment">// 最后需要eval来执行这些字符串组成的代码。</span></span><br><span class="line"><span class="built_in">eval</span>(evalStr+<span class="string">'="'</span>+<span class="keyword">this</span>.value+<span class="string">'"'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js图片下载之后端部分</title>
      <link href="/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86/"/>
      <url>/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>nodejs服务返回图片二进制数据<br><a id="more"></a></p><h2 id="js图片下载之后端部分"><a href="#js图片下载之后端部分" class="headerlink" title="js图片下载之后端部分"></a>js图片下载之后端部分</h2><p>本站<a href="/2019/02/27/js图片下载之前端部分/">《js图片下载之前端部分》</a>,写了如何利用js来下载图片，第二种方式需要后端返回图片的二进制数据，这篇文章我来写一下如何使用nodejs向前端返图片的二进制数据，我总结了三种方法。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  fs.createReadStream(<span class="string">'./img/1.jpg'</span>)</span><br><span class="line">  .pipe(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这种方法利用了stream和pipe，一行代码就解决了，利用fs去读取图片的流只有，用pipe方法把流转给res，res自动就把数据返回给前端。</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> readerStream = fs.createReadStream(process.cwd() + <span class="string">'/img/1.jpg'</span>);</span><br><span class="line">  <span class="comment">// 设置编码为 binary 必须</span></span><br><span class="line">  readerStream.setEncoding(<span class="string">'binary'</span>);</span><br><span class="line">  readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">     data += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 必须加上binary，返回的是二进制</span></span><br><span class="line">    res.end(data, <span class="string">'binary'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这个方法其实跟第一个差不多，都是使用了fs的流来读取图片，但是没有使用pipe直接把数据流转给res，需要自己监听数据来处理，这里我试验了好多方式，终于成功了，注意readerStream.setEncoding(‘binary’)和res.end(data, ‘binary’)，都需要加上binary格式。</p><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">    fs.readFile(<span class="string">'./img/1.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">     &#125;</span><br><span class="line">     res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这种方法时最简单的，但是遇到大文件会影响计算机的性能。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>最后整体代码贴一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>,<span class="string">' 3.2.1'</span>)</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream+pipe方式一</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  fs.createReadStream(<span class="string">'./img/1.jpg'</span>)</span><br><span class="line">  .pipe(res);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// stream方式二</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> readerStream = fs.createReadStream(process.cwd() + <span class="string">'/img/1.jpg'</span>);</span><br><span class="line">  <span class="comment">// 设置编码为 binary 必须</span></span><br><span class="line">  readerStream.setEncoding(<span class="string">'binary'</span>);</span><br><span class="line">  readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">     data += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 必须加上binary，返回的是二进制</span></span><br><span class="line">    res.end(data, <span class="string">'binary'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接读取整个文件方式三</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">    fs.readFile(<span class="string">'./img/1.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">     &#125;</span><br><span class="line">     res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js图片下载之前端部分</title>
      <link href="/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/"/>
      <url>/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>js控制图片下载<br><a id="more"></a></p><h2 id="js图片下载之前端部分"><a href="#js图片下载之前端部分" class="headerlink" title="js图片下载之前端部分"></a>js图片下载之前端部分</h2><p>这两天有一个小需求，就是点击页面中的下载按钮，下载指定的图片。经过一番的小研究，发现想实现这个功能，基本上都用到a标签的download属性，也就a标签的href指向图片地址，加上download属性后，点a标签就可以下载图片了。但是，有个问题，这需要在同域名下才好用，跨域貌似都不行，所以，在跨域的情况下就得另想办法。我总结了两种方法，一一道来。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>利用canvas，就是有一个图片地址，利用canvas把图片画出来，之后再通过canvas的toDataURL方法，将图片转为base64的数据，再把这个数据赋值给a标签的href属性，就可以了。这里注意一点，canvas调取toDataURL方法时，如果是跨域图片需要后台允许跨域，还需要在img标签的”crossOrigin”属性设置为’Anonymous’才管用，最后贴出具体代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadImg</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 通过构造函数来创建的 img 实例，在赋予 src 值后就会立刻下载图片，相比 createElement() 创建 &lt;img&gt; 省去了 append()，也就避免了文档冗余和污染</span></span><br><span class="line">        <span class="keyword">var</span> Img = <span class="keyword">new</span> Image(),</span><br><span class="line">            dataURL=<span class="string">''</span>;</span><br><span class="line">        Img.setAttribute(<span class="string">"crossOrigin"</span>,<span class="string">'Anonymous'</span>); <span class="comment">// 这里允许了跨域图片</span></span><br><span class="line">        Img.src=url;</span><br><span class="line">        Img.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 要先确保图片完整获取到，这是个异步事件</span></span><br><span class="line">            <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>), <span class="comment">// 创建canvas元素</span></span><br><span class="line">                width=Img.width, <span class="comment">// 确保canvas的尺寸和图片一样</span></span><br><span class="line">                height=Img.height;</span><br><span class="line">            canvas.width=width;</span><br><span class="line">            canvas.height=height;</span><br><span class="line">            canvas.getContext(<span class="string">"2d"</span>).drawImage(Img,<span class="number">0</span>,<span class="number">0</span>,width,height); <span class="comment">// 将图片绘制到canvas中</span></span><br><span class="line">            dataURL=canvas.toDataURL(<span class="string">'image/jpeg'</span>); <span class="comment">// 转换图片为dataURL</span></span><br><span class="line">            <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>),</span><br><span class="line">        body = <span class="built_in">document</span>.body;</span><br><span class="line">            a.download = <span class="string">'img.jpg'</span>;</span><br><span class="line">            a.href = dataURL;</span><br><span class="line">            body.append(a); </span><br><span class="line">            a.click();</span><br><span class="line">            body.removeChild(a);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>第二种方法就需要后端配合了，前端使用ajax请求到图片的二进制数据，之后利用了FileReader这个API，具体看代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">downloadImg</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, url, <span class="literal">true</span>);    <span class="comment">// 请求方式</span></span><br><span class="line">  xhr.responseType = <span class="string">"blob"</span>;  <span class="comment">// 返回类型blob</span></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 请求完成</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="comment">// 返回200</span></span><br><span class="line">      <span class="keyword">var</span> blob = <span class="keyword">this</span>.response;</span><br><span class="line">      <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">      reader.readAsDataURL(blob);  <span class="comment">// 转换为base64，可以直接放入a标签的href</span></span><br><span class="line">      reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 转换完成，创建一个a标签用于下载</span></span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>),</span><br><span class="line">        body = <span class="built_in">document</span>.body;</span><br><span class="line">        a.download = <span class="string">'img.jpg'</span>;</span><br><span class="line">        a.href = e.target.result;</span><br><span class="line">        body.append(a); </span><br><span class="line">        a.click();</span><br><span class="line">        body.removeChild(a);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 发送ajax请求</span></span><br><span class="line">  xhr.send()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这个方法需要后端发送图片的二进制数据，我也写了nodejs的发送方法，见<a href="/2019/02/27/js图片下载之后端部分/">《js图片下载之后端部分》</a></p><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><p>这种方式兼容性比较好，方法二在ie(11)下是不兼容的,最好的兼容方法莫过于后端写一个返回图片流的get方式的接口，这样直接window.open或者a标签链接再或者form都可以直接下载，如果后端是post方式，那就只能是form来解决了，见代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function downloadFile() &#123;</span><br><span class="line">    var form = document.createElement(&apos;form&apos;); //创建form标签</span><br><span class="line">    form.setAttribute(&quot;style&quot;,&quot;display:none&quot;);</span><br><span class="line">    form.setAttribute(&quot;method&quot;,&quot;post&quot;);//设置请求方式</span><br><span class="line">    form.setAttribute(&quot;action&quot;, hostUrl + &apos;/imgpath&apos;); //action属性设置请求路径</span><br><span class="line">    document.body.appendChild(form); //页面添加form标签</span><br><span class="line">    var input1 = document.createElement(&quot;input&quot;) //创建input标签</span><br><span class="line">    input1.setAttribute(&quot;name&quot;, &quot;id&quot;) //参数名</span><br><span class="line">    input1.setAttribute(&quot;value&quot;, 1) //参数值</span><br><span class="line">    form.appendChild(input1);</span><br><span class="line">    form.submit();//表单提交即可下载！</span><br><span class="line">    document.body.removeChild(form); //页面删除form标签</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 图片处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器消息提示Notification</title>
      <link href="/2019/02/14/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BANotification/"/>
      <url>/2019/02/14/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BANotification/</url>
      
        <content type="html"><![CDATA[<p>浏览器自带的消息提示框<br><a id="more"></a></p><h2 id="浏览器消息提示Notification"><a href="#浏览器消息提示Notification" class="headerlink" title="浏览器消息提示Notification"></a>浏览器消息提示Notification</h2><p>这两天有一个新需求，微信网页版有这个功能，就是当浏览器最小化后，微信来消息，这时在电脑桌面的右下角会有消息提示框。<br>这个功能用到了浏览器新特性的Notification接口，虽说兼容性不好，但是在现代浏览器上使用还是可以的。<br>直接贴出demo:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Notification&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;button id=<span class="string">"message"</span>&gt;弹消息&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button id="message-delay"&gt;弹消息延迟&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  var btn = document.getElementById('message');</span></span><br><span class="line"><span class="regexp">  var btnDelay = document.getElementById('message-delay');</span></span><br><span class="line"><span class="regexp">  btn.addEventListener('click', ()=&gt; &#123;</span></span><br><span class="line"><span class="regexp">    notifyMe(&#123;</span></span><br><span class="line"><span class="regexp">      title: '消息通知',</span></span><br><span class="line"><span class="regexp">      body: '菜品订单',</span></span><br><span class="line"><span class="regexp">      icon: './</span>asset/image/icon.png<span class="string">'</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  btnDelay.addEventListener('</span>click<span class="string">', ()=&gt; &#123;</span></span><br><span class="line"><span class="string">      setTimeout(()=&gt; &#123;</span></span><br><span class="line"><span class="string">        notifyMe(&#123;</span></span><br><span class="line"><span class="string">          title: '</span>消息通知<span class="string">',</span></span><br><span class="line"><span class="string">          body: '</span>菜品订单<span class="string">',</span></span><br><span class="line"><span class="string">          icon: '</span>./asset/image/icon.png<span class="string">'</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">      &#125;, 5000);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  function notifyMe(options) &#123;</span></span><br><span class="line"><span class="string">    // if(!document.hidden) return; // 判断浏览器是否最小化</span></span><br><span class="line"><span class="string">    // 先检查浏览器是否支持</span></span><br><span class="line"><span class="string">    if (!("Notification" in window)) &#123;</span></span><br><span class="line"><span class="string">      alert("This browser does not support desktop notification");</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 检查用户是否同意接受通知</span></span><br><span class="line"><span class="string">    else if (Notification.permission === "granted") &#123;</span></span><br><span class="line"><span class="string">      // If it'</span>s okay <span class="keyword">let</span><span class="string">'s create a notification</span></span><br><span class="line"><span class="string">      var notification = new Notification(options.title, &#123;</span></span><br><span class="line"><span class="string">        body: options.body,</span></span><br><span class="line"><span class="string">        icon: options.icon,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 否则我们需要向用户获取权限</span></span><br><span class="line"><span class="string">    else if (Notification.permission !== '</span>denied<span class="string">') &#123;</span></span><br><span class="line"><span class="string">      Notification.requestPermission(function (permission) &#123;</span></span><br><span class="line"><span class="string">        // 如果用户同意，就可以向他们发送通知</span></span><br><span class="line"><span class="string">        if (permission === "granted") &#123;</span></span><br><span class="line"><span class="string">          var notification = new Notification(options.title, &#123;</span></span><br><span class="line"><span class="string">            body: options.body,</span></span><br><span class="line"><span class="string">            icon: options.icon,</span></span><br><span class="line"><span class="string">          &#125;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 过3秒关闭提示框</span></span><br><span class="line"><span class="string">    setTimeout(function() &#123;</span></span><br><span class="line"><span class="string">      notification.close();</span></span><br><span class="line"><span class="string">    &#125;, 3000);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git常用命令</title>
      <link href="/2019/01/31/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2019/01/31/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>工作中常用的git命令小总结<br><a id="more"></a><br>git常用命令<br>git在我们工作中使用的很多，还有想github这样牛逼的代码托管网站，所以，git这个版本管理工具越来越多的被使用，其实git使用起来还是很复杂的，但是，我平时只是提交代码，所以就用到了几个命令而已，在这里做一下记录。<br>这里，推荐一个git学习网站，<a href="https://learngitbranching.js.org" target="_blank" rel="noopener">点这里</a></p><h2 id="先来个简单点的"><a href="#先来个简单点的" class="headerlink" title="先来个简单点的"></a>先来个简单点的</h2><h3 id="首先就是把现有的项目clone到本地。"><a href="#首先就是把现有的项目clone到本地。" class="headerlink" title="首先就是把现有的项目clone到本地。"></a>首先就是把现有的项目clone到本地。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jixoba/jQuery-Seat-Charts.git</span><br></pre></td></tr></table></figure><h3 id="之后就是我常用的几个提交命令"><a href="#之后就是我常用的几个提交命令" class="headerlink" title="之后就是我常用的几个提交命令"></a>之后就是我常用的几个提交命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git status  // 查看更改的文件有哪些</span><br><span class="line">git add .   // add后边.的话，就是把所有改动的文件添加进去</span><br><span class="line">git commit -m &quot;提交log信息&quot; // 提交信息</span><br><span class="line">git pull    // 拉取远程仓库的内容</span><br><span class="line">git push    // 最后把更改内容推到远程仓库中</span><br></pre></td></tr></table></figure><p>以上就是我经常用到的简单命令，如果有分支的话可能会复杂点，根据提示就可以了</p><h2 id="说点复杂的"><a href="#说点复杂的" class="headerlink" title="说点复杂的"></a>说点复杂的</h2><h3 id="查看提交日志"><a href="#查看提交日志" class="headerlink" title="查看提交日志"></a>查看提交日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git log // 显示从最近到最远的提交日志</span><br><span class="line">git log --pretty=oneline // 信息简化的日志</span><br><span class="line">git log --graph --pretty=oneline --abbrev-commit // 查看分支合并信息</span><br><span class="line">git reflog // 记录你操作的每一次命令</span><br></pre></td></tr></table></figure><h3 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard commit_id</span><br><span class="line">// 具体步骤</span><br><span class="line">1) git log // 查看所有的提交历史记录</span><br><span class="line">2) git reset --hard commit_id // 回退到指定的commit_id</span><br><span class="line">3) git push --force // 这里加上--force是强制更新远程库，如果不使用--force的话，会提示需要先拉取远程库，这样的话又回到了reset之前的commit版本了</span><br><span class="line">4) // 回退之后进行了相应处理，如果再想恢复到最新代码的版本的话</span><br><span class="line">   git reflog // reflog命令能够查看所有的commit版本信息，log的话只能查看当前版本之前的版本   </span><br><span class="line">5) git reset --hard commit_id // 再使用这个命令进行版本切换</span><br></pre></td></tr></table></figure><h3 id="撤销修改-只能撤销工作区的修改"><a href="#撤销修改-只能撤销工作区的修改" class="headerlink" title="撤销修改(只能撤销工作区的修改)"></a>撤销修改(只能撤销工作区的修改)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- readme.txt // 就是让这个文件回到最近一次git commit或git add时的状态</span><br></pre></td></tr></table></figure><h3 id="撤销修改-已经add到暂存区，但是没有commit到版本库"><a href="#撤销修改-已经add到暂存区，但是没有commit到版本库" class="headerlink" title="撤销修改(已经add到暂存区，但是没有commit到版本库)"></a>撤销修改(已经add到暂存区，但是没有commit到版本库)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD readme.txt</span><br><span class="line">// 可以将暂存区文件修改恢复到工作区，再使用git checkout -- readme.txt，撤销工作区的修改</span><br></pre></td></tr></table></figure><h3 id="查看分支"><a href="#查看分支" class="headerlink" title="查看分支"></a>查看分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -a  //查看所有分支</span><br><span class="line">git branch -r  //查看远程分支</span><br></pre></td></tr></table></figure><h3 id="新建分支"><a href="#新建分支" class="headerlink" title="新建分支"></a>新建分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch branchname // branchname就是分支名</span><br><span class="line">git switch -c branchname // 新版本git命令，创建并切换</span><br></pre></td></tr></table></figure><h3 id="本地切换分支"><a href="#本地切换分支" class="headerlink" title="本地切换分支"></a>本地切换分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout branchname</span><br><span class="line">git switch branchname // 新版本git命令，切换分支</span><br></pre></td></tr></table></figure><h3 id="删除本地分支"><a href="#删除本地分支" class="headerlink" title="删除本地分支"></a>删除本地分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d branchname</span><br><span class="line">git branch -D branchname // 强制删除没有被合并的分支</span><br></pre></td></tr></table></figure><h3 id="合并分支merge"><a href="#合并分支merge" class="headerlink" title="合并分支merge"></a>合并分支merge</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 假设当前在master分支上，想合并bugFix分支的内容</span><br><span class="line">git merge bugFix</span><br><span class="line">git merge --no-ff -m &quot;merge with no-ff&quot; bugFix // merge的时候不是Fast forward模式，此处会有一个commit提交点</span><br></pre></td></tr></table></figure><h3 id="cherry-pick"><a href="#cherry-pick" class="headerlink" title="cherry-pick"></a>cherry-pick</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick 4c805e2</span><br><span class="line">// 场景，dev分支超master分支好多个commit，但是，master只想合并4c805e2这个commit，在master分支上使用git cherry-pick 4c805e2</span><br></pre></td></tr></table></figure><h3 id="合并分支rebase"><a href="#合并分支rebase" class="headerlink" title="合并分支rebase"></a>合并分支rebase</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 假设当前在master分支上，想合并bugFix分支的内容</span><br><span class="line">git rebase bugFix</span><br></pre></td></tr></table></figure><h3 id="工作区暂时存储"><a href="#工作区暂时存储" class="headerlink" title="工作区暂时存储"></a>工作区暂时存储</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git stash // 将当前工作区的修改存储起来，这时git status查看是clean的，之后可以新建分支或者切换分支等操作</span><br><span class="line">git stash list // 查看stash暂存列表</span><br><span class="line"></span><br><span class="line">git stash apply // 恢复</span><br><span class="line">git stash drop // 删除stash列表中的记录</span><br><span class="line"></span><br><span class="line">git stash pop // apply和drop的组合</span><br><span class="line">// 如果有多个stash，可以这样使用</span><br><span class="line">git stash pop stash@&#123;0&#125;</span><br></pre></td></tr></table></figure><h3 id="克隆带有分支的项目方法一"><a href="#克隆带有分支的项目方法一" class="headerlink" title="克隆带有分支的项目方法一"></a>克隆带有分支的项目方法一</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b template https://github.com/iview/iview-admin.git  // clone template分支</span><br></pre></td></tr></table></figure><h3 id="克隆带有分支的项目方法二"><a href="#克隆带有分支的项目方法二" class="headerlink" title="克隆带有分支的项目方法二"></a>克隆带有分支的项目方法二</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/iview/iview-admin.git // clone整个项目</span><br><span class="line"></span><br><span class="line">git branch -a  //列出所有分支名称如下： * 号表示当前分支</span><br><span class="line">  * dev  </span><br><span class="line">  remotes/origin/HEAD -&gt; origin/dev</span><br><span class="line">  remotes/origin/desktop</span><br><span class="line">  remotes/origin/template</span><br></pre></td></tr></table></figure><h3 id="接下来，可以在本地新建分支并与远程仓库的分支进行关联了"><a href="#接下来，可以在本地新建分支并与远程仓库的分支进行关联了" class="headerlink" title="接下来，可以在本地新建分支并与远程仓库的分支进行关联了"></a>接下来，可以在本地新建分支并与远程仓库的分支进行关联了</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b template origin/template   // 作用是checkout远程仓库origin的分支template，在本地起名为template分支，并切换到本地的template分支</span><br></pre></td></tr></table></figure><h3 id="把本地已有的分支推送到远程仓库上"><a href="#把本地已有的分支推送到远程仓库上" class="headerlink" title="把本地已有的分支推送到远程仓库上"></a>把本地已有的分支推送到远程仓库上</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin 本地分支名:远程分支名</span><br></pre></td></tr></table></figure><h3 id="删除远程仓库的分支"><a href="#删除远程仓库的分支" class="headerlink" title="删除远程仓库的分支"></a>删除远程仓库的分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete 远程分支名</span><br></pre></td></tr></table></figure><h3 id="比较两个版本区别-diff"><a href="#比较两个版本区别-diff" class="headerlink" title="比较两个版本区别 diff"></a>比较两个版本区别 diff</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">git diff // 比较工作区和暂存区修改</span><br><span class="line">git diff HEAD // 比较工作区和当前分支最新的提交</span><br><span class="line">git diff commitId // 比较工作区和commitId版本的区别</span><br><span class="line">git diff branchName // 比较工作区和branchName分支最新提交的区别</span><br><span class="line"></span><br><span class="line">git diff --cached // 比较暂存区和当前分支最新提交区别,跟工作区比较一样，后边也可以接参数</span><br><span class="line"></span><br><span class="line">git diff commitId1 commitId2 // 比较两个commit之间的差异</span><br><span class="line">git diff HEAD^ HEAD // 还可以写HEAD来查看差异</span><br><span class="line"></span><br><span class="line">git diff branchName1 branchName2</span><br><span class="line">比较两个分支上最新提交之间的差异</span><br><span class="line"></span><br><span class="line">以上命令后边都可以接具体的文件夹或文件名，多个中间用空格分开</span><br><span class="line">git diff src1 src2</span><br><span class="line">git diff file1 file2</span><br><span class="line"></span><br><span class="line">在命令行查看信息不方便，可以把内容输出到一个文件：</span><br><span class="line">git diff commitId1 commitId2 &gt; difflog.txt</span><br></pre></td></tr></table></figure><h3 id="标签tag"><a href="#标签tag" class="headerlink" title="标签tag"></a>标签tag</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git tag // 查看tag列表</span><br><span class="line">git tag v1.0 // 当前分支的当前commit创建v1.o名字的tag</span><br><span class="line">git tag v2.0 f52c633 // 给id是f52c633的commit加tag</span><br><span class="line">git show &lt;tagname&gt; // 查看tag的详细信息</span><br><span class="line"></span><br><span class="line">// 默认创建的tag只在本地，如果推送标签到远程库</span><br><span class="line">git push origin &lt;tagname&gt; // 推送单个tag</span><br><span class="line">git push origin --tags // 一次性推送全部尚未推送到远程的本地标签</span><br><span class="line">// 删除tag</span><br><span class="line">git tag -d &lt;tagname&gt; // 删除tag，只删除本地的tag</span><br><span class="line">git push origin :refs/tags/&lt;tagname&gt; // 删除远程的tag</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;myName&quot; // 配置全局用户名</span><br><span class="line">git config --global user.email &quot;123456@qq.com&quot; // 配置全局用户邮箱</span><br><span class="line">git config --global color.ui true // 配置Git显示颜色</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jquery座位插件</title>
      <link href="/2019/01/29/jquery%E5%BA%A7%E4%BD%8D%E6%8F%92%E4%BB%B6/"/>
      <url>/2019/01/29/jquery%E5%BA%A7%E4%BD%8D%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>一个画座位图的jquery插件<br><a id="more"></a></p><h2 id="jquery座位插件"><a href="#jquery座位插件" class="headerlink" title="jquery座位插件"></a>jquery座位插件</h2><p>最近这两天在画飞机的座位布局图和选座系统，本来想自己直接用原生画出来的，但是领导说其他部门做过相关功能，别的部门用的是jQuery-Seat-Charts这个插件，所以我也得使用。<br><a href="https://github.com/jixoba/jQuery-Seat-Charts" target="_blank" rel="noopener">这里是插件地址，我fork了下来</a><br>其实，这个插件的使用很简单，按照giyhub的文档就可以使用，因为需要定制开发，所以我大致的看了一下源码，觉得很好，主要是它在每个座位上加的事件，如果是我写的话，可能使用click事件，但是它用的focus事件和blur事件，正常情况下只有form表单的一些元素才有focus事件，但是想在div上也使用focus事件的话，需要给这个div加上tabIndex属性，一般情况下设为-1，就可以直接使用div的el.focus()方法了，我觉得这个好处就是，当点击其它座位时，之前focus的座位会触发blur事件，可以在这里做一些操作，简化了代码。<br>以后再画座位的时候还可以使用这个插件，比如电影院选做系统，动车，飞机等，还是很方便的的。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写一个trigger插件</title>
      <link href="/2019/01/22/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AAtrigger%E6%8F%92%E4%BB%B6/"/>
      <url>/2019/01/22/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AAtrigger%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>自己写一个简单的trigger来触发事件<br><a id="more"></a></p><h2 id="手写一个trigger插件"><a href="#手写一个trigger插件" class="headerlink" title="手写一个trigger插件"></a>手写一个trigger插件</h2><p>各位小伙伴们，jquery大家超级熟悉吧，jquery的trigger函数一定知道吧，反正我是非常喜欢用它，有时候比如要把一个弹出层隐藏掉，大家可能会去改这个弹出层的css，但是我可能会直接trigger一下这个弹出层取消按钮，因为我懒嘛，哈哈。<br>但是，有时候可能想用trigger的时候，发现并没有使用jquery，额，自己写一个吧，其实，这段代码的核心部分我是参考了百度的一个手势库，好像叫touch.js,当时看的时候貌似这个库已经5年没人维护了，不过，模拟触发事件的代码被我留下了。见下面：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">'object'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = factory;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)</span><br><span class="line">define([], factory);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span>)</span><br><span class="line">exports[<span class="string">"jinuxTrigger"</span>] = factory;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">root[<span class="string">"jinuxTrigger"</span>] = factory;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, evt, detail</span>) </span>&#123;</span><br><span class="line">detail = detail || &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> e, opt = &#123;</span><br><span class="line">            bubbles: <span class="literal">true</span>,</span><br><span class="line">            cancelable: <span class="literal">true</span>,</span><br><span class="line">            detail: detail</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> CustomEvent !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">            e = <span class="keyword">new</span> CustomEvent(evt, opt);</span><br><span class="line">            <span class="keyword">if</span> (el) &#123;</span><br><span class="line">                el.dispatchEvent(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            e = <span class="built_in">document</span>.createEvent(<span class="string">"CustomEvent"</span>);</span><br><span class="line">            e.initCustomEvent(evt, <span class="literal">true</span>, <span class="literal">true</span>, detail);</span><br><span class="line">            <span class="keyword">if</span> (el) &#123;</span><br><span class="line">                el.dispatchEvent(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">"jinux-trigger is not supported by environment."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>再附上一个小demo<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>jinux-trigger<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./trigger.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>页面加载进来之后，等待3秒后代码触发按钮的点击事件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>点击...<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'button'</span>);</span></span><br><span class="line"><span class="javascript">    btn.addEventListener(<span class="string">'click'</span>,()=&gt;&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">'点击按钮被点击了！！！'</span>);</span></span><br><span class="line"><span class="javascript">    &#125;,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">//页面加载进来之后，等待3秒后代码触发按钮的点击</span></span></span><br><span class="line"><span class="javascript">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        jinuxTrigger(btn,<span class="string">'click'</span>);</span></span><br><span class="line">    &#125;,3000);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>谷歌黑语法</title>
      <link href="/2019/01/14/%E8%B0%B7%E6%AD%8C%E9%BB%91%E8%AF%AD%E6%B3%95/"/>
      <url>/2019/01/14/%E8%B0%B7%E6%AD%8C%E9%BB%91%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>关于搜索引擎的一些使用技巧<br><a id="more"></a></p><h2 id="谷歌黑语法"><a href="#谷歌黑语法" class="headerlink" title="谷歌黑语法"></a>谷歌黑语法</h2><p>平时，我们经常用百度来搜索一些东西，由于墙的原因，我们很少用谷歌，但是我们工作生活中使用百度就已经足够了。<br>今天这篇文章介绍一下谷歌搜索的使用技巧，因为谷歌是所搜的老大，所以其它搜索引擎也来效仿谷歌，因而，下边介绍的这些搜索知识，基本上所有的搜索引擎都会适用的。</p><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><p>谷歌的默认搜索是and逻辑，意思就是，我们在输入关键字后进行搜索时，如输入：“program google”后，会搜出包含“program”和“google”的文件内容，如下图1所示。<br><img src="/2019/01/14/谷歌黑语法/1.png" alt="img"><br>说到这里，我就插入一个小知识点：基础布尔逻辑。<br>对于一个搜索引擎来说，进行搜索的时候是要搜索到匹配到所有关键词的页面，还是包含关键词中的任意关键词就可以，取决于一个搜索引擎的一些特别算法，称之为搜索引擎的布尔逻辑默认值。<br>而google就是用and作为默认逻辑（搜索到所有的关键词），当然这个前提是我们没有输入一些特殊的命令。如果你不确定你要搜索的内容，或者你想搜索两个中的任意一个，那么就要使用关键词“OR”。注意：OR是大写的，小写是不起作用的，而且，每一个关键词与“OR”之间是有一个空格的，我们来看一下搜索结果。<br><img src="/2019/01/14/谷歌黑语法/2.png" alt="img"><br>当然，可以预想的是，google的结果要比program多得多，所以结果第一页全是有关google的内容。此外，还可以借助计算机体系语言中的“|”来代替“OR”，效果是一样的。<br>当然，如果你希望搜索“programgoogle”的内容，而不希望这两个单词之间有任何其他的内容，那么就要使用双引号把搜索的内容组成一个词组来达到目的。如下图3所示。<br><img src="/2019/01/14/谷歌黑语法/3.png" alt="img"><br>如上图所示，结果中的programgoogle都是在一起的，没有分割。当然这样的结果比较少，只有2740个，但是看图1，结果却有7亿多个。而且，大部分搜索引擎都有智能断句的功能，如果没有特殊的命令，搜索引擎会一定量的根据大众的语言使用习惯来判断你要搜索什么，而这样的做法，不仅仅没有使搜索引擎显得不听话，反而对大众来讲搜索引擎变得十分智能和高效！<br>但是如果我们只想看到“program”的内容，而不希望看到“google”的内容，就可以把“-”（减号或者破折号）应用到搜索当中去，语法为“program -google”，注意，“-”之前是有一个空格的，而其后却是和下一个关键词是紧紧相连的！搜索的结果如下图4所示。可以看得到结果中都会包含program，而不包含google。<br><img src="/2019/01/14/谷歌黑语法/4.png" alt="img"><br>说到这里，还要提一下google的约束扩展问题了。一般来说，当输入关键词后，google会把相关网页和信息的结果呈现在我们面前。然而，有一些单词在搜索引擎中是会被智能忽略的，导致我们得不到想要的结果。比如十分常用的“www”和“the”，基本上任何一个网页上都会找到的东西，就会被google自动忽略（不要觉得这样不好，还是那个道理，在实际引用当中这样做反而显得更加高效和智能）。如果我们不想忽略这些词进行查询，就得在这些关键词的前面加上符号“+”。如下图5所示：<br><img src="/2019/01/14/谷歌黑语法/5.png" alt="img"><br>看上去两者好像没有什么大的区别，其实仔细比较一下搜索结果就可以看得出，加上加号的搜索结果有一万多个，而不加加号的结果却有着55亿多！而因为google和www的关联度比较高，所以在前面的结果表现的差别不大。<br>除了上述字符之外，一些搜索引擎支持一种叫做“stemming”（填充）的技术。Stemming是指在查询的关键词中添加一些通配符，通常是“*”，有时候也可能是“？”，这些通配符的作用是要求搜索引擎进行查询是可以返回多个不同的结果。其中通配符代表占位，可以匹配其他任意字母和单词，而其他的字或词组与用户输入的相同。如我们想要搜索“Lionel Messi”的内容，却忘记了第一个单词的一些拼写，就可以输入“l*Messi”进行查询，注意：此处整个字符串是要用一个英文半角双引号括住的！结果如下图所示。<br><img src="/2019/01/14/谷歌黑语法/6.png" alt="img"><br>可以看到，google自动匹配出Lionel Messi的内容并且进行了搜索。这样的方式有利于我们只能记住单词或短语的一部分的内容时使用。<br>基本的语法就讲到这里，上述的内容也没有列全，因为有些搜索功能不太常用。不过，这些语法就已经够我们日常使用的了，基本语法就是做基本的事，google也有一些高级的语法，见下边高级语法。</p><h3 id="高级语法"><a href="#高级语法" class="headerlink" title="高级语法"></a>高级语法</h3><h4 id="intitle"><a href="#intitle" class="headerlink" title="intitle"></a>intitle</h4><p>首先要介绍的就是“intitle:”的用法，这个串的作用是将搜索的范围局限在标题上。在关键词前面加上这个，就会只对网页的标题进行搜索并且配对，最后将结果返回给用户。例如输入“intitle:program moon”进行搜索，就会返回如下图所示的结果。<br><img src="/2019/01/14/谷歌黑语法/7.png" alt="img"><br>但是可以看到，貌似搜索结果中只出现了关于program的内容，而并没有moon相关的内容，这里其实还是牵扯到搜索引擎的基础布尔逻辑问题，在intitle:语法上，google会检索所有的网页，只要出现program或者moon其中的一个就会被匹配，意料之中的是，关于program的内容肯定是要远远多于moon的内容的，所以搜索结果里关于program的内容占据了主导，可以理解为moon这个关键词被一定量的智能忽略了。但是如果我们想要找到网页标题中既有program又有moon的网页呢?那么我们就要使用“intitle:”的一个变体“allintitle:”，使用这个前缀后，就能得到我们想要的结果了。如下图所示，除了第一条为google的图片推荐，其余的结果中网页的标题既含有program这个关键词，又含有moon这个关键词。<br><img src="/2019/01/14/谷歌黑语法/8.png" alt="img"></p><h4 id="intext"><a href="#intext" class="headerlink" title="intext"></a>intext</h4><p>看到这个单词，大概就可以猜到它的意义了，“intext:”是用来搜索网页正文内容的，这样就可以忽略网页中的超文本链接、URL和题目。我们输入“intext:2018 program”进行搜索，结果如下图所示，结果中显示的网页大部分标题几乎没有规律，但是网页的索引中都包含着 “2018 program”，但是因为2018和program的同时出现的网页实在比较少，两个关键词的关联度实在不高（笔者此时的时间为2016年12月25日00:07:10），因为现在才是2016年，如果换成“2016 program”我相信应该会有更多的结果出现。但是我们要明白，这时搜索引擎关注的内容是网页的正文。与之相对应的也有一个变体：“allintext:”，用法和上面的“allintitle”相似，我就不做过多的介绍了。<br><img src="/2019/01/14/谷歌黑语法/9.png" alt="img"><br>到这里恐怕就有读者要问了，这与我们平时的搜索相比没有什么高级的地方啊？确实，就平时的搜索来讲，这个语法的意义确实不太重大，但是在某些领域，例如黑客作为一名攻击者，构造好关键词配合适当的语法就可以进行撒网式的攻击，这个呢，我们点到为止，这里就不谈了。</p><h4 id="inanchor"><a href="#inanchor" class="headerlink" title="inanchor"></a>inanchor</h4><p>这个语法的意思是在页面的链接锚点进行搜索。<br>链接锚点指的是一个链接的描述文本，如这样的一段HTML代码：&lt;a href=<a href="https://www.baidu.com&gt;百度" target="_blank" rel="noopener">https://www.baidu.com&gt;百度</a>，链接的锚点就是“百度”了。<br>我们搜索“inanchor:login”就可以搜索到有那些含有锚点的网页了，如下图所示。当然，这个语法也有一个变体“allinanchor:”，意思也与前面的类似。<br><img src="/2019/01/14/谷歌黑语法/10.png" alt="img"></p><h4 id="site"><a href="#site" class="headerlink" title="site"></a>site</h4><p>这个语法是把搜索限制在站点域名之内。例如我们搜索“program site:google.com”，结果如下图所示，这里呢，我们通常不需要加上前面的www，这样搜索的结果就会是包括所有含有google.com域名的有关内容，包括顶级域名和二级域名甚至三级域名的内容。也就是说我们甚至可以通过搜索，确定google.com大概有多少个子域名！<br><img src="/2019/01/14/谷歌黑语法/11.png" alt="img"></p><h4 id="inurl"><a href="#inurl" class="headerlink" title="inurl"></a>inurl</h4><p>inurl:会将搜索的范围限制在URL或者网站的页面上，这个语法对于查找搜索和帮助是很有用的，不仅适合我们普通的搜索，在黑客搜索中用处也很大。例如我们输入“inurl:password”，结果如下图所示，结果显示了所有URL中含有password的网页。另外，这个语法也有一个变体：“allinurl:”，用法与前面的相似。<br><img src="/2019/01/14/谷歌黑语法/12.png" alt="img"><br>在黑客领域，inurl和site的使用是十分的频繁的，利用他们组合可以搜索到有用的信息，如我们可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“site:google.com –inurl:www.google.com”，而这个语法的含义就是搜索google到底有多少个子域名。</span><br></pre></td></tr></table></figure></p><h4 id="link"><a href="#link" class="headerlink" title="link"></a>link</h4><p>这个的功能是查询所有链接到某个特定URL上的列表。要注意的是，是特定的URL页面，如输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“link:www.baidu.com”</span><br></pre></td></tr></table></figure></p><p>进行搜索，如下图所示，就会返回所有链接到百度主页的网页了。因此，我们同样可以指定特定的URL页面来进行搜索。<br><img src="/2019/01/14/谷歌黑语法/13.png" alt="img"></p><h4 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h4><p>Cache可以帮助我们查找到google索引过的页面副本，它最大的好处就是即使源文件界面不存在了，或者变成了其它的内容，我们依然可以搜索的到。例如输入:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“cache：www.baidu.com”</span><br></pre></td></tr></table></figure></p><p>结果如下所示，可以看到，格式虽然乱糟糟的，但是依稀可以从中获取一些有用的信息的。在国内的搜索引擎上，可能也有类似的功能，比如百度的网页快照，其功能与这个类似。<br><img src="/2019/01/14/谷歌黑语法/14.png" alt="img"></p><h4 id="filetype"><a href="#filetype" class="headerlink" title="filetype"></a>filetype</h4><p>filetype是指搜索指定后缀的文件。这个不太常用，但是在黑客领域有一定的作用。但是我们的重点是讲解语法，所以这里就一笔带过（关于filetype的一些其他内容我会在以后的博文中展示），如下图所示，输入“filetype:mdb”，结果就会显示出一些网站的数据库文件。<br><img src="/2019/01/14/谷歌黑语法/15.png" alt="img"></p><h4 id="related"><a href="#related" class="headerlink" title="related"></a>related</h4><p>这个语法是用于搜索与某些页面相关的网站的，可以辅助我们搜索同类的页面。比如我们输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“related:www.google.com”</span><br></pre></td></tr></table></figure></p><p>显示的结果都是一些其他的搜索引擎。<br><img src="/2019/01/14/谷歌黑语法/16.png" alt="img"></p><h4 id="info"><a href="#info" class="headerlink" title="info"></a>info</h4><p>这个语法可以搜索到关于一个URL的更多信息的页面列表，这里的信息包括这个网页的cache，还有与这个网页相似的网页等等，注意下面的英文信息就好。输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“info:www.google.com”</span><br></pre></td></tr></table></figure></p><p>结果如下图所示。<br><img src="/2019/01/14/谷歌黑语法/17.png" alt="img"></p><p>好了，大概就这么多了，还用别的这里就不介绍了，对于我这种小白来说已经够用的了。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>es6-async-await</title>
      <link href="/2019/01/03/es6-async-await/"/>
      <url>/2019/01/03/es6-async-await/</url>
      
        <content type="html"><![CDATA[<p>es6中async-await的demo<br><a id="more"></a></p><h2 id="es6-async-await"><a href="#es6-async-await" class="headerlink" title="es6-async-await"></a>es6-async-await</h2><p>es6现在已经在项目中使用了，async偶尔用，所以要用的时候总是忘记，写个小demo，用的时候看一眼，哈哈<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;es7-<span class="keyword">async</span>-<span class="keyword">await</span>&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;es7-<span class="keyword">async</span>-<span class="keyword">await</span>&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">//写一个返回Promise的异步函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncTime</span>(<span class="params">val, ms</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">resolve(val);</span><br><span class="line">&#125;,ms);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//async函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">await</span> asyncTime(<span class="number">1</span>, <span class="number">1000</span>); <span class="comment">//a的值就是Promise函数里面resolve的参数值</span></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">await</span> asyncTime(a+<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">await</span> asyncTime(b+<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br><span class="line"><span class="keyword">let</span> d = <span class="keyword">await</span> <span class="number">123</span>; <span class="comment">//await后面可以不是Promise函数，但是会自动包装成一个Promise函数并且立即向后执行</span></span><br><span class="line"><span class="built_in">console</span>.log(d);</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line">testAsync().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'async函数的then函数-&gt;'</span>,res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//async函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync_2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">await</span> testAsync(); <span class="comment">//因为async本身执行后会返回一个Promise函数(async函数内部return的值只作为async返回的Promise函数的then里的参数传入)，所以此处也可以在await后边写async函数。</span></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">testAsync_2().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'async函数2的then函数-&gt;'</span>,res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//再来一个多个异步函数执行的例子</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync_3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([asyncTime(<span class="string">'all1'</span>,<span class="number">2000</span>),asyncTime(<span class="string">'all2'</span>,<span class="number">2000</span>),asyncTime(<span class="string">'all3'</span>,<span class="number">2000</span>)]);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">testAsync_3().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">alert(res);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github预览静态库页面</title>
      <link href="/2019/01/02/github%E9%A2%84%E8%A7%88%E9%9D%99%E6%80%81%E5%BA%93%E9%A1%B5%E9%9D%A2/"/>
      <url>/2019/01/02/github%E9%A2%84%E8%A7%88%E9%9D%99%E6%80%81%E5%BA%93%E9%A1%B5%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<p>github预览静态库页面<br><a id="more"></a></p><h2 id="github预览静态库页面"><a href="#github预览静态库页面" class="headerlink" title="github预览静态库页面"></a>github预览静态库页面</h2><p>类似于 <a href="https://jinux7.github.io" target="_blank" rel="noopener">https://jinux7.github.io</a> 这样的github静态网站展示大家都知道怎么弄，在网上可以搜索到很多教程，我自己的blog网站就是这么搞的，但是这种方法我发现一个github账户只能弄出一个，今天我想说的是另一种方式，直接可以访问到普通库里的静态页面。<br>这里需要github提供的一个服务地址，见下边：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://htmlpreview.github.io/?https://raw.githubusercontent.com/jixoba/mobile_company/master/index.html</span><br></pre></td></tr></table></figure></p><p>上边的这段地址就可以访问普通库里的静态页面了，注意jixoba/mobile_company这个，是库的名称，只需要更改这个库名，其它地方不需要动。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cordova android打包配置详解</title>
      <link href="/2018/12/18/cordova-android%E6%89%93%E5%8C%85%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
      <url>/2018/12/18/cordova-android%E6%89%93%E5%8C%85%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>cordova打包android app<br><a id="more"></a></p><h2 id="cordova-android打包配置详解"><a href="#cordova-android打包配置详解" class="headerlink" title="cordova android打包配置详解"></a>cordova android打包配置详解</h2><p>前几天在网上看到了cordova的东西，之前有过鼓捣react native和weex，所以看看它有什么特点。<br>由于我用的是win10系统，所以在配置环境的时候相当的麻烦，这里稍微的屡一下。</p><h3 id="一-安装JDK"><a href="#一-安装JDK" class="headerlink" title="一 安装JDK"></a>一 安装JDK</h3><p>JDK是java的开发工具包，因为我们打包安卓的apk文件，安卓是依赖java的，所以这个必须安装。<br>我刚开始安装的是最新版的，但是与cordova版本好像不是很搭，于是安装了JDK8这个版本。<br>安装好了之后要配置环境变量，首先是新建变量名JAVA_HOME，指向JDK的安装目录，之后再配置一下path，指向JDK里的bin目录。<br>再配置一下jre的path，也是指向jre里的bin目录。（jre安装有的直接安装JDK的时候顺便安装了，有的版本需要另外单独安装）</p><h3 id="二-安装SDK"><a href="#二-安装SDK" class="headerlink" title="二 安装SDK"></a>二 安装SDK</h3><p>SDK稍微有点复杂，首先还是下载SDK并且安装，这里需要注意，安装路径，我用的win10，必须安装在 用户/用户名/AppData/Local,<br>其它系统可能无所谓。安装好了之后，还是配置环境变量，新建变量名ANDROID_SDK_HOME，指向安装的SDK目录，再配置path，指向SDK下的<br>tools和platform-tools。</p><h3 id="三-安装Gradle"><a href="#三-安装Gradle" class="headerlink" title="三 安装Gradle"></a>三 安装Gradle</h3><p>Gradle好像是一个打包工具，直接下载安装，之后配置一下Gradle的bin目录环境变量。</p><h3 id="四-安装cordova"><a href="#四-安装cordova" class="headerlink" title="四 安装cordova"></a>四 安装cordova</h3><p>cordova的安装和运行需要nodejs，所以用npm来安装。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g cordova@6.1.1</span><br></pre></td></tr></table></figure></p><p>注意，这里我安装的是6.1.1版本，高版本莫名其妙的报错，这个稳妥一些。<br>之后就是使用cordova来创建项目喽。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cordova create app jinux.com.cn app  // 创建一个项目</span><br><span class="line">cd app // 进入app项目</span><br><span class="line">cordova platform android  // 添加安卓模板</span><br><span class="line">cordova requirements  // 查看打包缺少什么依赖项</span><br><span class="line">cordova build android  // 打包apk</span><br></pre></td></tr></table></figure></p><p>以上的这些命令，在查看依赖项的时候肯定回报一些错误，SDK的一些依赖没有安装，进入SDK文件夹，打开SDK Manager.exe，根据依赖的提示下载相应的包，注意，这里是从谷歌上拉取，所以要开代理哦。<br>第一次build的时候，Gradle需要从网络上下载一堆包，还是注意需要代理拉取谷歌的文件，很慢的，耐心等待。<br>*下面是一个别人写的cordova博文，可供参考<br><a href="http://www.xiaoxiaohan.com/js/58.html#comments" target="_blank" rel="noopener">参考</a></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cordova </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>setTimeout&amp;async&amp;Promise执行顺序</title>
      <link href="/2018/12/11/setTimeout-async-Promise%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"/>
      <url>/2018/12/11/setTimeout-async-Promise%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>setTimeout&amp;async&amp;Promise执行顺序简要分析<br><a id="more"></a></p><h2 id="setTimeout-amp-async-amp-Promise执行顺序"><a href="#setTimeout-amp-async-amp-Promise执行顺序" class="headerlink" title="setTimeout&amp;async&amp;Promise执行顺序"></a>setTimeout&amp;async&amp;Promise执行顺序</h2><p>看到标题，觉得这种需求在实际项目中基本遇不到，是的，我从没有遇到过，而且，要用就用一种，既然用了async，还用啥Promise。不过，网上有一道面试题，据说是今日头条的面试题，考的就是这方面的知识，先贴出代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>)</span><br><span class="line">    <span class="keyword">await</span> async2()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async2'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line">async1();</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">    resolve();</span><br><span class="line">&#125; ).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">&#125; )</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>)</span><br></pre></td></tr></table></figure></p><p>答案一会再说。<br>先来分析一下，setTimeout,async,Promise执行的有先顺序。其实，要想研究明白这个问题，需要了解异步执行的宏任务，微任务知识，而且，在浏览器和nodejs环境下还不一样，这里我不对这些知识作深入分析，因为我看了些相关知识，看的晕头转向，所以，我只简单的记一下在浏览器环境下的优先顺序。<br>异步发生的节点是：<br>1.setTimeout的回调函数。<br>2.Promise实例的then方法中的回调函数。<br>3.async函数中await 后面紧跟着的函数（如async2），这个地方比较有意思，进入async2的时候是同步的，async2里边如果都是同步函数，那就继续执行，等执行完毕，返回先关东西后，”await async2()”这句话下边的语句不会马上执行，有点像Promise实例的then方法中的回调一样，需要排队等待。<br>所以，优先顺序是Promise的then方法回调第一，async await 之后的语句排第二，setTimeout的回调排第三。<br>记住了吗？我没有考虑理论知识，只是简单地死记硬背而已。<br>最后，把上边代码的结果写出来，看看与你想的是否一样。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">script start</span><br><span class="line">async1 start</span><br><span class="line">async2</span><br><span class="line">promise1</span><br><span class="line">script end</span><br><span class="line">promise2</span><br><span class="line">async1 end</span><br><span class="line">setTimeout</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs搭建https服务器</title>
      <link href="/2018/12/07/nodejs%E6%90%AD%E5%BB%BAhttps%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2018/12/07/nodejs%E6%90%AD%E5%BB%BAhttps%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>ssl证书的创建，https服务器的搭建<br><a id="more"></a></p><h2 id="nodejs搭建https服务器"><a href="#nodejs搭建https服务器" class="headerlink" title="nodejs搭建https服务器"></a>nodejs搭建https服务器</h2><p>虽然作者是一名菜鸟前端，但是学习https相关的知识还是必须的。之前看过很多理论的文章，http与https的区别，ssl证书如何起作用的等等，说实话，我都忘记了，今天正好有时间，早上坐地铁就看了相关的文章，刚才写出了一个demo，现在就记录一下整个过程。</p><h3 id="http与https区别"><a href="#http与https区别" class="headerlink" title="http与https区别"></a>http与https区别</h3><ul><li>HTTP: 超文本传输协议 (Hypertext transfer protocol) 是一种详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。</li><li>HTTPS:（Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司进行，提供了身份验证与加密通讯方法，现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。<blockquote><p>区别：</p></blockquote></li><li>https协议需要到ca申请证书，一般免费证书很少，需要交费。</li><li>http是超文本传输协议，信息是明文传输，https 则是具有安全性的ssl加密传输协议。</li><li>http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</li><li>http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。<h3 id="创建ssl证书"><a href="#创建ssl证书" class="headerlink" title="创建ssl证书"></a>创建ssl证书</h3><h4 id="第一步，安装openssl"><a href="#第一步，安装openssl" class="headerlink" title="第一步，安装openssl"></a>第一步，安装openssl</h4>安装openssl，很简单，按照正常的window软件按照下一步按照就可以，下面是下载地址，注意选择是64bit还是32bit哦,我下载了“Win64 OpenSSL v1.1.1a Ligh”这个版本，因为体积小，所以下载了light的版本。<br><a href="https://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener">openssl下载地址</a><br>安装好了之后，配置一下环境变量，这样在哪个文件夹下都可以直接使用openssl命令了。<h4 id="第二部，使用openssl创建ssl证书"><a href="#第二部，使用openssl创建ssl证书" class="headerlink" title="第二部，使用openssl创建ssl证书"></a>第二部，使用openssl创建ssl证书</h4>这个步骤还是有点小困难，在网上按照有的教程弄不好使，后来找到一个教程，好使，直接贴出命令行代码。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#生成私钥key文件：</span><br><span class="line">~ D:\workspace\javascript\nodejs-https&gt;openssl genrsa -out privatekey.pem 1024</span><br><span class="line">Generating RSA private key, 1024 bit long modulus</span><br><span class="line">...........................++++++</span><br><span class="line">........++++++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line"></span><br><span class="line">#通过私钥生成CSR证书签名</span><br><span class="line">~ D:\workspace\javascript\nodejs-https&gt;openssl req -new -key privatekey.pem -out certrequest.csr</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:Beijing</span><br><span class="line">Locality Name (eg, city) []:Beijing</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:fens.me</span><br><span class="line">Organizational Unit Name (eg, section) []:fens.me</span><br><span class="line">Common Name (eg, YOUR name) []:Conan Zhang</span><br><span class="line">Email Address []:bsspirit@gmail.com</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"></span><br><span class="line"># 通过私钥和证书签名生成证书文件</span><br><span class="line">~ D:\workspace\javascript\nodejs-https&gt;openssl x509 -req -in certrequest.csr -signkey privatekey.pem -out certificate.pem</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=Beijing/L=Beijing/O=fens.me/OU=fens.me/CN=Conan Zhang/emailAddress=bsspirit@gmail.com</span><br><span class="line">Getting Private key</span><br></pre></td></tr></table></figure></li></ul><p>注意在通过私钥生成CSR证书签名的时候需要添加一些个人信息。<br>新生成了3个文件：certificate.pem, certrequest.csr, privatekey.pem</p><ul><li>privatekey.pem: 私钥</li><li>certrequest.csr: CSR证书签名</li><li>certificate.pem: 证书文件<br>接下来，直接在nodejs的服务代码中引入相关文件就可以了。<h3 id="nodejs创建https服务器"><a href="#nodejs创建https服务器" class="headerlink" title="nodejs创建https服务器"></a>nodejs创建https服务器</h3>直接贴代码了，这步骤就很简单了<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">var</span> privateKey  = fs.readFileSync(<span class="string">'./ssl/privatekey.pem'</span>, <span class="string">'utf8'</span>),</span><br><span class="line">    certificate = fs.readFileSync(<span class="string">'./ssl/certificate.pem'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="keyword">var</span> credentials = &#123;<span class="attr">key</span>: privateKey, <span class="attr">cert</span>: certificate&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpServer = http.createServer(app);</span><br><span class="line"><span class="keyword">var</span> httpsServer = https.createServer(credentials, app);</span><br><span class="line"><span class="keyword">var</span> PORT = <span class="number">18080</span>;</span><br><span class="line"><span class="keyword">var</span> SSLPORT = <span class="number">18081</span>;</span><br><span class="line"></span><br><span class="line">httpServer.listen(PORT, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'HTTP Server is running on: http://localhost:%s'</span>, PORT);</span><br><span class="line">&#125;);</span><br><span class="line">httpsServer.listen(SSLPORT, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'HTTPS Server is running on: https://localhost:%s'</span>, SSLPORT);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Welcome</span></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.protocol === <span class="string">'https'</span>) &#123;</span><br><span class="line">        res.status(<span class="number">200</span>).send(<span class="string">'Welcome to Safety Land!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.status(<span class="number">200</span>).send(<span class="string">'Welcome!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><p>好了，https服务器搭建完成，原来这么简单。不过，有个问题，因为这个ssl证书属于个人证书，并不是第三方的安全CA证书，所以在浏览器访问https协议时候会有不安全的提醒文字，这个对于我们测试来说是没问题的，如果想在正规的网站上使用，我们还得去阿里云申请CA证书哦。<br>最后，本想把本demo的代码上传到github，不过，代码实在是简单，不传了，直接放个截图得了。<br><img src="/2018/12/07/nodejs搭建https服务器/1.png" alt="img"><br>ssl文件夹里放了3个ssl文件哦。</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络基础 </tag>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-iview Modal组件简单分析</title>
      <link href="/2018/12/04/vue-iview-Modal%E7%BB%84%E4%BB%B6%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/"/>
      <url>/2018/12/04/vue-iview-Modal%E7%BB%84%E4%BB%B6%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>vue-iview Modal组件简单分析<br><a id="more"></a></p><h2 id="vue-iview-Modal组件简单分析"><a href="#vue-iview-Modal组件简单分析" class="headerlink" title="vue-iview Modal组件简单分析"></a>vue-iview Modal组件简单分析</h2><p>现在公司的项目前端框架用的是vue，在工作中避免不了要写一些组件，其实写组件的方法千千种，怎么写都行，但是，总想写出来的组件像一些ui框架里的组件一样高大上，于是乎，今天有点时间，大致的看了一下iview的Modal组件，简单的记录一下思想。<br>由于时间原因，代码并没有深入往里边看，只是把大致的框框看了一下。<br>首先，我们看看Modal组件的用法，<a href="https://www.iviewui.com/components/modal#API" target="_blank" rel="noopener">官方文档点这里</a><br>简单的用法如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Modal v-model=<span class="string">"modal12"</span> draggable scrollable title=<span class="string">"Modal 1"</span>&gt;</span><br><span class="line">    &lt;div&gt;This is the first modal&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Modal&gt;</span><br><span class="line"><span class="comment">// 上边这个是基础写法</span></span><br><span class="line"><span class="comment">// 下边这个写法可以直接调用，不需要在html中写出&lt;Modal&gt;&lt;/Modal&gt;标签</span></span><br><span class="line"><span class="keyword">this</span>.$Modal.info(config)</span><br><span class="line"><span class="keyword">this</span>.$Modal.success(config)</span><br></pre></td></tr></table></figure></p><p>先看一下iview的Modal组件文件夹结构<br><img src="/2018/12/04/vue-iview-Modal组件简单分析/1.png" alt="img"><br>index文件是入口文件，里边导出了Modal对象。也就是可以使用<modal></modal>标签的原因，因为给Modal对象加一大堆方法，但是它还是一个vue的基础组件。大家可能注意到了，当使用<modal></modal>标签定义组建的时候，发现最后组件的dom元素被插入到了body下，而不是在具体引入的位置，这是因为Modal组件里有一个指令：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  Modal组件里有</span></span><br><span class="line">directives: &#123; TransferDom &#125;</span><br><span class="line"><span class="comment">// 追溯TransferDom指令，发现有如下代码</span></span><br><span class="line">parentNode.replaceChild(home, el); <span class="comment">// moving out, el is no longer in the document</span></span><br><span class="line">getTarget(value).appendChild(el); <span class="comment">// moving into new place</span></span><br></pre></td></tr></table></figure></p><p>modal.vue文件是组件的基础文件，也就是页面显示出来的东西，index文件里的东西可以看出来，只是给Modal对象添加了一些静态方法，为了this.$Modal.info(config)这样调用的时候使用。<br>confrim文件里主要做了this.$Modal.info()这样调用的时候动态new Vue()实例，也是以modal.vue这个组件为基础，动态的插入到body节点里，代码见下边:<br><img src="/2018/12/04/vue-iview-Modal组件简单分析/2.png" alt="img"><br>就是通过new Vue()的实例获取到这个组建的html代码片段，再插入到body节点中。<br>最后，再看看iview如何变成vue的全局组件的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue, opts = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里添加全局组件</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(iview).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        Vue.component(key, iview[key]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里添加实例方法</span></span><br><span class="line">    Vue.prototype.$Modal = Modal;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>以上就是大概思路哈。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小巧的html模板引擎</title>
      <link href="/2018/11/30/%E5%B0%8F%E5%B7%A7%E7%9A%84html%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/"/>
      <url>/2018/11/30/%E5%B0%8F%E5%B7%A7%E7%9A%84html%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/</url>
      
        <content type="html"><![CDATA[<p>小巧的html模板引擎<br><a id="more"></a></p><h2 id="小巧的html模板引擎"><a href="#小巧的html模板引擎" class="headerlink" title="小巧的html模板引擎"></a>小巧的html模板引擎</h2><p>今天看coco大神的github，看到了他写的html模板引擎，默默地记录下来，其实，模板引擎我自己也写过一个，不过总觉得大神写的一定比我的好，<a href="https://github.com/jinux7/jinux-template" target="_blank" rel="noopener">点击这是我写的</a><br>先贴出代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * coTemplate</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">name, definition</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span>) &#123;</span><br><span class="line">        define(definition);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>[name] = definition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="string">'cotemplate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tplReg = <span class="regexp">/\$\&#123;\s*([^\&#123;\&#125;\s]+)\s*\&#125;/g</span>;</span><br><span class="line">    <span class="keyword">var</span> jsReg = <span class="regexp">/(^( )?(if|for|else|switch|case|break|&#123;|&#125;))(.*)?/g</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> code = <span class="string">'var r=[];\n'</span>;</span><br><span class="line">    <span class="keyword">var</span> match = <span class="string">'undefined'</span>;</span><br><span class="line">    <span class="keyword">var</span> pointer = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加单行逻辑</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>line </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">lineAdd</span>(<span class="params">line</span>) </span>&#123;</span><br><span class="line">        code += <span class="string">'r.push("'</span> + line.replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>) + <span class="string">'");\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板拼接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>tpl 模板字符串 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;Objcet&#125;</span> </span>data 模板内替换对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">cotemplate</span>(<span class="params">tpl, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (match = tplReg.exec(tpl)) &#123;</span><br><span class="line">            <span class="comment">// 添加非逻辑部分</span></span><br><span class="line">            lineAdd(tpl.slice(pointer, match.index)); </span><br><span class="line"></span><br><span class="line">            <span class="comment">// 添加逻辑部分 "$&#123;" + match[1] + "&#125;";</span></span><br><span class="line">            code += (<span class="string">'r.push(String(this.'</span> + match[<span class="number">1</span>] + <span class="string">'));'</span>);</span><br><span class="line"></span><br><span class="line">            pointer = match.index + match[<span class="number">0</span>].length;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加代码的最后一截</span></span><br><span class="line">        lineAdd(tpl.substr(pointer, tpl.length - pointer)); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回结果，在这里我们就拿到了装入数组后的代码</span></span><br><span class="line">        code += <span class="string">'return r.join("");'</span>; </span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(code);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(code.replace(<span class="regexp">/[\r\t\n]/g</span>, <span class="string">''</span>)).apply(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * export</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> cotemplate;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>用法Demo<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"../js/cotemplate.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">var data = &#123;</span></span><br><span class="line"><span class="regexp">    name: 'Coco',</span></span><br><span class="line"><span class="regexp">    info: &#123;</span></span><br><span class="line"><span class="regexp">        age: 18</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    bar: &#123;</span></span><br><span class="line"><span class="regexp">        foo: &#123;</span></span><br><span class="line"><span class="regexp">            else: 'co-template'</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var tpl = `</span></span><br><span class="line"><span class="regexp">            &lt;p&gt;name:$&#123;coco&#125;&lt;/</span>p&gt;</span><br><span class="line">            &lt;p&gt;Age:$&#123;info.age&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div&gt;$&#123;bar.foo.else&#125;&lt;/</span>div&gt;</span><br><span class="line">          <span class="string">`;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cotemplate(tpl, data);</span></span><br><span class="line"><span class="string">// &lt;p&gt;Name:Coco&lt;/p&gt;        </span></span><br><span class="line"><span class="string">// &lt;p&gt;Age:18&lt;/p&gt;        </span></span><br><span class="line"><span class="string">// &lt;div&gt;HTML-template:co-template&lt;/div&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>传入标准时间，返回指定日期格式</title>
      <link href="/2018/11/30/%E4%BC%A0%E5%85%A5%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4%EF%BC%8C%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F/"/>
      <url>/2018/11/30/%E4%BC%A0%E5%85%A5%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4%EF%BC%8C%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>传入标准时间，返回指定日期格式<br><a id="more"></a></p><h2 id="传入标准时间，返回指定日期格式"><a href="#传入标准时间，返回指定日期格式" class="headerlink" title="传入标准时间，返回指定日期格式"></a>传入标准时间，返回指定日期格式</h2><p>平时在开发时经常会用到获取当前日期，有时候会自己写一个，今天网上闲逛，发现一个写的不错的，记录一下，以备后用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> common = &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 传入标准时间，返回指定日期格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>date </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>format </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@example </span></span></span><br><span class="line"><span class="comment">     *      - dateSerialization(1511181312647, "y-mm-dd h:i:s")</span></span><br><span class="line"><span class="comment">     *      - <span class="doctag">@return </span>2017-11-20 20:35:12</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    dateSerialization(date, format) &#123;</span><br><span class="line">        <span class="keyword">let</span> dateObj;</span><br><span class="line">        <span class="keyword">let</span> DEFAULT_FORMAT = <span class="string">"y-mm-dd h:i:s"</span>;</span><br><span class="line">        <span class="keyword">let</span> _patternArr = [<span class="string">"y"</span>, <span class="string">"mm"</span>, <span class="string">"dd"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>, <span class="string">"s"</span>];</span><br><span class="line">        <span class="keyword">let</span> _patternMap = &#123;</span><br><span class="line">            y: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> d.getFullYear();</span><br><span class="line">            &#125;,</span><br><span class="line">            m: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> d.getMonth() + <span class="number">1</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            mm: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _pad(d.getMonth() + <span class="number">1</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            d: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> d.getDate();</span><br><span class="line">            &#125;,</span><br><span class="line">            dd: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _pad(d.getDate());</span><br><span class="line">            &#125;,</span><br><span class="line">            h: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _pad(d.getHours());</span><br><span class="line">            &#125;,</span><br><span class="line">            i: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _pad(d.getMinutes());</span><br><span class="line">            &#125;,</span><br><span class="line">            s: <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _pad(d.getSeconds());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/^\d+$/</span>.test(date)) &#123;</span><br><span class="line">            dateObj = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">parseInt</span>(date));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> date == <span class="string">"string"</span>) &#123;</span><br><span class="line">            dateObj = <span class="keyword">new</span> <span class="built_in">Date</span>(date.replace(<span class="regexp">/-/g</span>, <span class="string">"/"</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_isDate(date)) &#123;</span><br><span class="line">            dateObj = date;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 非法数据</span></span><br><span class="line">        <span class="keyword">if</span> (!dateObj || dateObj.toString() == <span class="string">"Invalid Date"</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"[common.date.format]the input cannot be converted to date object("</span> + date + <span class="string">")"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        format = format || DEFAULT_FORMAT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> _resultArr = format.split(<span class="regexp">/-|:|\s/</span>);</span><br><span class="line">        <span class="keyword">let</span> resultObj = &#123;&#125;;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        _patternArr.forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">            resultObj[k] = _patternMap[k](dateObj);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        _resultArr.forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> regExp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(k);</span><br><span class="line"></span><br><span class="line">            format = format.replace(regExp, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> resultObj[e];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> format;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_toString</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_isDate</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _toString(v) == <span class="string">"[object Date]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_pad</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">9</span> ? n : <span class="string">"0"</span> + n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> common;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js工具库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高阶函数和高阶组件</title>
      <link href="/2018/11/29/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E5%92%8C%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/"/>
      <url>/2018/11/29/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E5%92%8C%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>高阶函数和高阶组件简介<br><a id="more"></a></p><h2 id="高阶函数和高阶组件"><a href="#高阶函数和高阶组件" class="headerlink" title="高阶函数和高阶组件"></a>高阶函数和高阶组件</h2><h3 id="什么是高阶函数"><a href="#什么是高阶函数" class="headerlink" title="什么是高阶函数"></a>什么是高阶函数</h3><p>高阶函数就是传入的参数有函数的函数。（有点绕口:)）</p><h3 id="什么是高阶组件"><a href="#什么是高阶组件" class="headerlink" title="什么是高阶组件"></a>什么是高阶组件</h3><p>高阶组件就是传入的参数有组件的组件。:)<br>react比较容易实现高阶组件</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web安全之CSRF</title>
      <link href="/2018/11/28/web%E5%AE%89%E5%85%A8%E4%B9%8BCSRF/"/>
      <url>/2018/11/28/web%E5%AE%89%E5%85%A8%E4%B9%8BCSRF/</url>
      
        <content type="html"><![CDATA[<p>CSRF攻击的简要介绍<br><a id="more"></a></p><h2 id="web安全之CSRF"><a href="#web安全之CSRF" class="headerlink" title="web安全之CSRF"></a>web安全之CSRF</h2><h3 id="一-CSRF是什么？"><a href="#一-CSRF是什么？" class="headerlink" title="一.CSRF是什么？"></a>一.CSRF是什么？</h3><p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。</p><h3 id="二-CSRF可以做什么？"><a href="#二-CSRF可以做什么？" class="headerlink" title="二.CSRF可以做什么？"></a>二.CSRF可以做什么？</h3><p>你这可以这么理解CSRF攻击：攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账……造成的问题包括：个人隐私泄露以及财产安全。</p><h3 id="三-CSRF漏洞现状"><a href="#三-CSRF漏洞现状" class="headerlink" title="三.CSRF漏洞现状"></a>三.CSRF漏洞现状</h3><p>CSRF这种攻击方式在2000年已经被国外的安全人员提出，但在国内，直到06年才开始被关注，08年，国内外的多个大型社区和交互网站分别 爆出CSRF漏洞，如：NYTimes.com（纽约时报）、Metafilter（一个大型的BLOG网站），YouTube和百度HI……而 现在，互联网上的许多站点仍对此毫无防备，以至于安全业界称CSRF为“沉睡的巨人”。</p><h3 id="四-CSRF的原理"><a href="#四-CSRF的原理" class="headerlink" title="四.CSRF的原理"></a>四.CSRF的原理</h3><p>下图简单阐述了CSRF攻击的思想：<br><img src="/2018/11/28/web安全之CSRF/1.jpg" alt="img"><br>从上图可以看出，要完成一次CSRF攻击，受害者必须依次完成两个步骤：<br>1.登录受信任网站A，并在本地生成Cookie。<br>2.在不登出A的情况下，访问危险网站B。</p><p>看到这里，你也许会说：“如果我不满足以上两个条件中的一个，我就不会受到CSRF的攻击”。是的，确实如此，但你不能保证以下情况不会发生：<br>1.你不能保证你登录了一个网站后，不再打开一个tab页面并访问另外的网站。<br>2.你不能保证你关闭浏览器了后，你本地的Cookie立刻过期，你上次的会话已经结束。（事实上，关闭浏览器不能结束一个会话，但大多数人都会错误的认为关闭浏览器就等于退出登录/结束会话了……）<br>3.上图中所谓的攻击网站，可能是一个存在其他漏洞的可信任的经常被人访问的网站。</p><h3 id="五例子"><a href="#五例子" class="headerlink" title="五例子"></a>五例子</h3><p>上面大概地讲了一下CSRF攻击的思想，下面我将用几个例子详细说说具体的CSRF攻击，这里我以一个银行转账的操作作为例子（仅仅是例子，真实的银行网站没这么傻:&gt;）</p><h4 id="示例1："><a href="#示例1：" class="headerlink" title="示例1："></a>示例1：</h4><p>银行网站A，它以GET请求来完成银行转账的操作，如：<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000</a><br>危险网站B，它里面有一段HTML的代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=http:<span class="comment">//www.mybank.com/Transfer.php?toBankId=11&amp;money=1000&gt;</span></span><br></pre></td></tr></table></figure></p><p>首先，你登录了银行网站A，然后访问危险网站B，噢，这时你会发现你的银行账户少了1000块……<br>为什么会这样呢？原因是银行网站A违反了HTTP规范，使用GET请求更新资源。在访问危险网站B的之前，你已经登录了银行网站A，而B中 的<img>以GET的方式请求第三方资源（这里的第三方就是指银行网站了，原本这是一个合法的请求，但这里被不法分子利用了），所以你的浏 览器会带上你的银行网站A的Cookie发出Get请求，去获取资源“<a href="http://www.mybank.com" target="_blank" rel="noopener">http://www.mybank.com</a> /Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账 操作），所以就立刻进行转账操作……</p><h4 id="示例2："><a href="#示例2：" class="headerlink" title="示例2："></a>示例2：</h4><p>为了杜绝上面的问题，银行决定改用POST请求完成转账操作。<br>银行网站A的WEB表单如下：<br>危险网站B，它里面有一段HTML的代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"Transfer.php"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">　　　　&lt;p&gt;ToBankId: <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> /&gt;</span></span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">　　　　&lt;p&gt;Money: &lt;input type="text" name="money" /</span>&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">　　　　&lt;p&gt;&lt;input type="submit" value="Transfer" /</span>&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">　　&lt;/</span>form&gt;</span><br></pre></td></tr></table></figure></p><p>后台处理页面Transfer.php如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　　　session_start();</span><br><span class="line">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_REQUEST[<span class="string">'money'</span>]))</span><br><span class="line">　　　　&#123;</span><br><span class="line">　　　　    buy_stocks($_REQUEST[<span class="string">'toBankId'</span>],　$_REQUEST[<span class="string">'money'</span>]);</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>危险网站B，仍然只是包含那句HTML代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=http:<span class="comment">//www.mybank.com/Transfer.php?toBankId=11&amp;money=1000&gt;</span></span><br></pre></td></tr></table></figure></p><p>和示例1中的操作一样，你首先登录了银行网站A，然后访问危险网站B，结果…..和示例1一样，你再次没了1000块～T_T，这次事故的 原因是：银行后台使用了$_REQUEST去获取请求的数据，而$_REQUEST既可以获取GET请求的数据，也可以获取POST请求的数据，这就造成 了在后台处理程序无法区分这到底是GET请求的数据还是POST请求的数据。在PHP中，可以使用$_GET和$_POST分别获取GET请求和POST 请求的数据。在JAVA中，用于获取请求数据request一样存在不能区分GET请求数据和POST数据的问题。</p><h4 id="示例3："><a href="#示例3：" class="headerlink" title="示例3："></a>示例3：</h4><p>经过前面2个惨痛的教训，银行决定把获取请求数据的方法也改了，改用$_POST，只获取POST请求的数据，后台处理页面Transfer.php代码如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　　　session_start();</span><br><span class="line">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_POST[<span class="string">'money'</span>]))</span><br><span class="line">　　　　&#123;</span><br><span class="line">　　　　    buy_stocks($_POST[<span class="string">'toBankId'</span>],　$_POST[<span class="string">'money'</span>]);</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>然而，危险网站B与时俱进，它改了一下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">　　&lt;head&gt;</span><br><span class="line">　　　　&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">　　　　　　<span class="function"><span class="keyword">function</span> <span class="title">steal</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">　　　　　　</span>&#123;</span><br><span class="line">          　　　　 iframe = <span class="built_in">document</span>.frames[<span class="string">"steal"</span>];</span><br><span class="line">　　     　　      iframe.document.Submit(<span class="string">"transfer"</span>);</span><br><span class="line">　　　　　　&#125;</span><br><span class="line">　　　　&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">　　&lt;/</span>head&gt;</span><br><span class="line"></span><br><span class="line">　　&lt;body onload=<span class="string">"steal()"</span>&gt;</span><br><span class="line">　　　　&lt;iframe name=<span class="string">"steal"</span> display=<span class="string">"none"</span>&gt;</span><br><span class="line">　　　　　　&lt;form method=<span class="string">"POST"</span> name=<span class="string">"transfer"</span>　action=<span class="string">"http://www.myBank.com/Transfer.php"</span>&gt;</span><br><span class="line">　　　　　　　　&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"toBankId"</span> value=<span class="string">"11"</span>&gt;</span><br><span class="line">　　　　　　　　&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"money"</span> value=<span class="string">"1000"</span>&gt;</span><br><span class="line">　　　　　　&lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">　　　　&lt;/i</span>frame&gt;</span><br><span class="line">　　&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><p>如果用户仍是继续上面的操作，很不幸，结果将会是再次不见1000块……因为这里危险网站B暗地里发送了POST请求到银行!</p><p>总结一下上面3个例子，CSRF主要的攻击模式基本上是以上的3种，其中以第1,2种最为严重，因为触发条件很简单，一 个<img>就可以了，而第3种比较麻烦，需要使用JavaScript，所以使用的机会会比前面的少很多，但无论是哪种情况，只要触发了 CSRF攻击，后果都有可能很严重。</p><p>理解上面的3种攻击模式，其实可以看出，CSRF攻击是源于WEB的隐式身份验证机制！WEB的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的！</p><h3 id="六-CSRF的防御"><a href="#六-CSRF的防御" class="headerlink" title="六.CSRF的防御"></a>六.CSRF的防御</h3><p>我总结了一下看到的资料，CSRF的防御可以从服务端和客户端两方面着手，防御效果是从服务端着手效果比较好，现在一般的CSRF防御也都在服务端进行。</p><h4 id="1-服务端进行CSRF防御"><a href="#1-服务端进行CSRF防御" class="headerlink" title="1.服务端进行CSRF防御"></a>1.服务端进行CSRF防御</h4><p>服务端的CSRF方式方法很多样，但总的思想都是一致的，就是在客户端页面增加伪随机数。</p><h5 id="1-Cookie-Hashing-所有表单都包含同一个伪随机值-："><a href="#1-Cookie-Hashing-所有表单都包含同一个伪随机值-：" class="headerlink" title="(1).Cookie Hashing(所有表单都包含同一个伪随机值)："></a>(1).Cookie Hashing(所有表单都包含同一个伪随机值)：</h5><p>这可能是最简单的解决方案了，因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败了:&gt;<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　　　<span class="comment">//构造加密的Cookie信息</span></span><br><span class="line">　　　　$value = “DefenseSCRF”;</span><br><span class="line">　　　　setcookie(”cookie”, $value, time()+<span class="number">3600</span>);</span><br><span class="line">　　<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>在表单里增加Hash值，以认证这确实是用户发送的请求。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　　　$hash = md5($_COOKIE[<span class="string">'cookie'</span>]);</span><br><span class="line">　　<span class="meta">?&gt;</span></span><br><span class="line">　　&lt;form method=”POST” action=”transfer.php”&gt;</span><br><span class="line">　　　　&lt;input type=”text” name=”toBankId”&gt;</span><br><span class="line">　　　　&lt;input type=”text” name=”money”&gt;</span><br><span class="line">　　　　&lt;input type=”hidden” name=”hash” value=”<span class="meta">&lt;?</span>=$hash;<span class="meta">?&gt;</span>”&gt;</span><br><span class="line">　　　　&lt;input type=”submit” name=”submit” value=”Submit”&gt;</span><br><span class="line">　　&lt;/form&gt;</span><br></pre></td></tr></table></figure></p><p>然后在服务器端进行Hash值验证<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　      <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'check'</span>])) &#123;</span><br><span class="line">     　　      $hash = md5($_COOKIE[<span class="string">'cookie'</span>]);</span><br><span class="line">    　　 <span class="keyword">if</span>($_POST[<span class="string">'check'</span>] == $hash) &#123;</span><br><span class="line">         　　 doJob();</span><br><span class="line">　　           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">　　　　　　　　<span class="comment">//...</span></span><br><span class="line">    　　 &#125;</span><br><span class="line">　　      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">　　　　　　<span class="comment">//...</span></span><br><span class="line">　　      &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>这个方法个人觉得已经可以杜绝99%的CSRF攻击了，那还有1%呢….由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，这就 另外的1%。一般的攻击者看到有需要算Hash值，基本都会放弃了，某些除外，所以如果需要100%的杜绝，这个不是最好的方法。</p><h5 id="2-验证码"><a href="#2-验证码" class="headerlink" title="(2).验证码"></a>(2).验证码</h5><p>这个方案的思路是：每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，厄….这个方案可以完全解决CSRF，但个人觉得在易用性方面似乎不是太好，还有听闻是验证码图片的使用涉及了一个被称为MHTML的Bug，可能在某些版本的微软IE中受影响。</p><h5 id="3-One-Time-Tokens-不同的表单包含一个不同的伪随机值"><a href="#3-One-Time-Tokens-不同的表单包含一个不同的伪随机值" class="headerlink" title="(3).One-Time Tokens(不同的表单包含一个不同的伪随机值)"></a>(3).One-Time Tokens(不同的表单包含一个不同的伪随机值)</h5><p>在实现One-Time Tokens时，需要注意一点：就是“并行会话的兼容”。如果用户在一个站点上同时打开了两个不同的表单，CSRF保护措施不应该影响到他对任何表单的提 交。考虑一下如果每次表单被装入时站点生成一个伪随机值来覆盖以前的伪随机值将会发生什么情况：用户只能成功地提交他最后打开的表单，因为所有其他的表单 都含有非法的伪随机值。必须小心操作以确保CSRF保护措施不会影响选项卡式的浏览或者利用多个浏览器窗口浏览一个站点。<br>以下我的实现:</p><h6 id="1-先是令牌生成函数-gen-token-："><a href="#1-先是令牌生成函数-gen-token-：" class="headerlink" title="1).先是令牌生成函数(gen_token())："></a>1).先是令牌生成函数(gen_token())：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">gen_token</span><span class="params">()</span> </span>&#123;</span><br><span class="line">　　　　<span class="comment">//这里我是贪方便，实际上单使用Rand()得出的随机数作为令牌，也是不安全的。</span></span><br><span class="line">　　　　<span class="comment">//这个可以参考我写的Findbugs笔记中的《Random object created and used only once》</span></span><br><span class="line">      $token =md5(uniqid(rand(), <span class="keyword">true</span>));</span><br><span class="line">      <span class="keyword">return</span> $token;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h6 id="2-然后是Session令牌生成函数-gen-stoken-："><a href="#2-然后是Session令牌生成函数-gen-stoken-：" class="headerlink" title="2).然后是Session令牌生成函数(gen_stoken())："></a>2).然后是Session令牌生成函数(gen_stoken())：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">gen_stoken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">　　　　　　$pToken = <span class="string">""</span>;</span><br><span class="line">　　　　　　<span class="keyword">if</span>($_SESSION[STOKEN_NAME]  == $pToken)&#123;</span><br><span class="line">　　　　　　　　<span class="comment">//没有值，赋新值</span></span><br><span class="line">　　　　　　　　$_SESSION[STOKEN_NAME] =gen_token();</span><br><span class="line">　　　　　　&#125;    </span><br><span class="line">　　　　　　<span class="keyword">else</span>&#123;</span><br><span class="line">　　　　　　　　<span class="comment">//继续使用旧的值</span></span><br><span class="line">　　　　　　&#125;</span><br><span class="line">　　&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h6 id="3-WEB表单生成隐藏输入域的函数："><a href="#3-WEB表单生成隐藏输入域的函数：" class="headerlink" title="3).WEB表单生成隐藏输入域的函数："></a>3).WEB表单生成隐藏输入域的函数：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">　　     <span class="function"><span class="keyword">function</span> <span class="title">gen_input</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     　　     gen_stoken();</span><br><span class="line">　　          <span class="keyword">echo</span> “&lt;input type=\”hidden\” name=\”<span class="string">" . FTOKEN_NAME . “\”</span></span><br><span class="line"><span class="string">    　　     value=\”"</span> . $_SESSION[STOKEN_NAME] . “\”&gt; “;</span><br><span class="line">     　　&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h6 id="4-WEB表单结构："><a href="#4-WEB表单结构：" class="headerlink" title="4).WEB表单结构："></a>4).WEB表单结构：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     session_start();</span><br><span class="line">     <span class="keyword">include</span>(”functions.php”);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form method=”POST” action=”transfer.php”&gt;</span><br><span class="line">     &lt;input type=”text” name=”toBankId”&gt;</span><br><span class="line">     &lt;input type=”text” name=”money”&gt;</span><br><span class="line">     <span class="meta">&lt;?</span> gen_input(); <span class="meta">?&gt;</span></span><br><span class="line">     &lt;input type=”submit” name=”submit” value=”Submit”&gt;</span><br><span class="line">&lt;/FORM&gt;</span><br></pre></td></tr></table></figure><h6 id="5-服务端核对令牌："><a href="#5-服务端核对令牌：" class="headerlink" title="5).服务端核对令牌："></a>5).服务端核对令牌：</h6><p>这个很简单，这里就不再啰嗦了。<br>上面这个其实不完全符合“并行会话的兼容”的规则，大家可以在此基础上修改。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web安全之XSS</title>
      <link href="/2018/11/28/web%E5%AE%89%E5%85%A8%E4%B9%8BXSS/"/>
      <url>/2018/11/28/web%E5%AE%89%E5%85%A8%E4%B9%8BXSS/</url>
      
        <content type="html"><![CDATA[<p>XSS攻击的简要介绍<br><a id="more"></a></p><h2 id="web安全之XSS"><a href="#web安全之XSS" class="headerlink" title="web安全之XSS"></a>web安全之XSS</h2><p>首先说下最常见的 XSS 漏洞，XSS (Cross Site Script)，跨站脚本攻击，因为缩写和 CSS (Cascading Style Sheets) 重叠，所以只能叫 XSS。<br>XSS 的原理是恶意攻击者往 Web 页面里插入恶意可执行网页脚本代码，当用户浏览该页之时，嵌入其中 Web 里面的脚本代码会被执行，从而可以达到攻击者盗取用户信息或其他侵犯用户安全隐私的目的。XSS 的攻击方式千变万化，但还是可以大致细分为几种类型。</p><h3 id="非持久型-XSS"><a href="#非持久型-XSS" class="headerlink" title="非持久型 XSS"></a>非持久型 XSS</h3><p>非持久型 XSS 漏洞，也叫反射型 XSS 漏洞，一般是通过给别人发送带有恶意脚本代码参数的 URL，当 URL 地址被打开时，特有的恶意代码参数被 HTML 解析、执行。<br><img src="/2018/11/28/web安全之XSS/1.webp" alt="img"><br>一个例子，比如你的 Web 页面中包含有以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        <span class="built_in">document</span>.write(<span class="string">''</span></span><br><span class="line">            + <span class="string">'&lt;option value=1&gt;'</span></span><br><span class="line">            +     location.href.substring(location.href.indexOf(<span class="string">'default='</span>) + <span class="number">8</span>)</span><br><span class="line">            + <span class="string">'&lt;/option&gt;'</span></span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">document</span>.write(<span class="string">'&lt;option value=2&gt;English&lt;/option&gt;'</span>);</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>select&gt;</span><br></pre></td></tr></table></figure></p><p>攻击者可以直接通过 URL<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(类似：https:<span class="comment">//xx.com/xx?default=&lt;script&gt;alert(document.cookie)&lt;/script&gt;)</span></span><br></pre></td></tr></table></figure></p><h4 id="注入可执行的脚本代码"><a href="#注入可执行的脚本代码" class="headerlink" title="注入可执行的脚本代码"></a>注入可执行的脚本代码</h4><p>非持久型 XSS 漏洞攻击有以下几点特征 :<br>1 . 即时性，不经过服务器存储，直接通过 HTTP 的 GET 和 POST 请求就能完成一次攻击，拿到用户隐私数据<br>2 . 攻击者需要诱骗点击<br>3 . 反馈率低，所以较难发现和响应修复<br>4 . 盗取用户敏感保密信息</p><h4 id="为了防止出现非持久型-XSS-漏洞，需要确保这么几件事情"><a href="#为了防止出现非持久型-XSS-漏洞，需要确保这么几件事情" class="headerlink" title="为了防止出现非持久型 XSS 漏洞，需要确保这么几件事情 :"></a>为了防止出现非持久型 XSS 漏洞，需要确保这么几件事情 :</h4><p>1 . Web 页面渲染的所有内容或者渲染的数据都必须来自于服务端。<br>2 . 尽量不要从 URL，document.referrer，document.forms 等这种 DOM API 中获取数据直接渲染。<br>3 . 尽量不要使用 eval, new Function()，document.write()，document.writeln()，window.setInterval()，window.setTimeout()，<br>innerHTML，document.creteElement() 等可执行字符串的方法。<br>4 . 如果做不到以上几点，也必须对涉及 DOM 渲染的方法传入的字符串参数做 escape 转义。<br>5 . 前端渲染的时候对任何的字段都需要做 escape 转义编码。</p><p>escape 转义的目的是将一些构成 HTML 标签的元素转义，比如 &lt;，&gt;，空格 等，转义成 &lt;，&gt;，  等显示转义字符。有很多开源的工具可以协助我们做 escape 转义。</p><h3 id="持久型-XSS"><a href="#持久型-XSS" class="headerlink" title="持久型 XSS"></a>持久型 XSS</h3><p>持久型 XSS 漏洞，也被称为存储型 XSS 漏洞，一般存在于 Form 表单提交等交互功能，如发帖留言，提交文本信息等，黑客利用的 XSS 漏洞，将内容经正常功能提交进入数据库持久保存，当前端页面获得后端从数据库中读出的注入代码时，恰好将其渲染执行。</p><p>主要注入页面方式和非持久型 XSS 漏洞类似，只不过持久型的不是来源于 URL，refferer，forms 等，而是来源于后端从数据库中读出来的数据。持久型 XSS 攻击不需要诱骗点击，黑客只需要在提交表单的地方完成注入即可，但是这种 XSS 攻击的成本相对还是很高。</p><h4 id="攻击成功需要同时满足以下几个条件"><a href="#攻击成功需要同时满足以下几个条件" class="headerlink" title="攻击成功需要同时满足以下几个条件 :"></a>攻击成功需要同时满足以下几个条件 :</h4><p>1 . POST 请求提交表单后端没做转义直接入库。<br>2 . 后端从数据库中取出数据没做转义直接输出给前端。<br>3 . 前端拿到后端数据没做转义直接渲染成 DOM。</p><h4 id="持久型-XSS-有以下几个特点"><a href="#持久型-XSS-有以下几个特点" class="headerlink" title="持久型 XSS 有以下几个特点 :"></a>持久型 XSS 有以下几个特点 :</h4><p>1 . 持久性，植入在数据库中<br>2 . 危害面广，甚至可以让用户机器变成 DDoS 攻击的肉鸡。<br>3 . 盗取用户敏感私密信息</p><h4 id="为了防止持久型-XSS-漏洞，需要前后端共同努力"><a href="#为了防止持久型-XSS-漏洞，需要前后端共同努力" class="headerlink" title="为了防止持久型 XSS 漏洞，需要前后端共同努力 :"></a>为了防止持久型 XSS 漏洞，需要前后端共同努力 :</h4><p>1 . 后端在入库前应该选择不相信任何前端数据，将所有的字段统一进行转义处理。<br>2 . 后端在输出给前端数据统一进行转义处理。<br>3 . 前端在渲染页面 DOM 的时候应该选择不相信任何后端数据，任何字段都需要做转义处理。</p><h3 id="基于字符集的-XSS"><a href="#基于字符集的-XSS" class="headerlink" title="基于字符集的 XSS"></a>基于字符集的 XSS</h3><p>其实现在很多的浏览器以及各种开源的库都专门针对了 XSS 进行转义处理，尽量默认抵御绝大多数 XSS 攻击，但是还是有很多方式可以绕过转义规则，让人防不胜防。比如「基于字符集的 XSS 攻击」就是绕过这些转义处理的一种攻击方式，比如有些 Web 页面字符集不固定，用户输入非期望字符集的字符，有时会绕过转义过滤规则。</p><h4 id="以基于-utf-7-的-XSS-为例"><a href="#以基于-utf-7-的-XSS-为例" class="headerlink" title="以基于 utf-7 的 XSS 为例"></a>以基于 utf-7 的 XSS 为例</h4><p>utf-7 是可以将所有的 unicode 通过 7bit 来表示的一种字符集 (但现在已经从 Unicode 规格中移除)。<br>这个字符集为了通过 7bit 来表示所有的文字, 除去数字和一部分的符号,其它的部分将都以 base64 编码为基础的方式呈现。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">"xss"</span>)&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">可以被解释为：</span></span><br><span class="line"><span class="regexp">+ADw-script+AD4-alert(+ACI-xss+ACI-)+ADw-/</span>script+AD4-</span><br></pre></td></tr></table></figure></p><p>可以形成「基于字符集的 XSS 攻击」的原因是由于浏览器在 meta 没有指定 charset 的时候有自动识别编码的机制，所以这类攻击通常就是发生在没有指定或者没来得及指定 meta 标签的 charset 的情况下。</p><h4 id="所以我们有什么办法避免这种-XSS-呢"><a href="#所以我们有什么办法避免这种-XSS-呢" class="headerlink" title="所以我们有什么办法避免这种 XSS 呢 ?"></a>所以我们有什么办法避免这种 XSS 呢 ?</h4><p>1 . 记住指定 <meta charset="utf-8"><br>2 . XML 中不仅要指定字符集为 utf-8，而且标签要闭合<br>3 . 牛文推荐：<a href="http://drops.wooyun.org/papers/1327" target="_blank" rel="noopener">http://drops.wooyun.org/papers/1327</a> （这个讲的很详细）</p><h3 id="基于-Flash-的跨站-XSS"><a href="#基于-Flash-的跨站-XSS" class="headerlink" title="基于 Flash 的跨站 XSS"></a>基于 Flash 的跨站 XSS</h3><p>基于 Flash 的跨站 XSS 也是属于反射型 XSS 的一种，虽然现在开发 ActionScript 的产品线几乎没有了，但还是提一句吧，AS 脚本可以接受用户输入并操作 cookie，攻击者可以配合其他 XSS（持久型或者非持久型）方法将恶意 swf 文件嵌入页面中。主要是因为 AS 有时候需要和 JS 传参交互，攻击者会通过恶意的 XSS 注入篡改参数，窃取并操作cookie。</p><p>避免方法 :<br>1 . 严格管理 cookie 的读写权限<br>2 . 对 Flash 能接受用户输入的参数进行过滤 escape 转义处理</p><h3 id="未经验证的跳转-XSS"><a href="#未经验证的跳转-XSS" class="headerlink" title="未经验证的跳转 XSS"></a>未经验证的跳转 XSS</h3><p>有一些场景是后端需要对一个传进来的待跳转的 URL 参数进行一个 302 跳转，可能其中会带有一些用户的敏感（cookie）信息。如果服务器端做302 跳转，跳转的地址来自用户的输入，攻击者可以输入一个恶意的跳转地址来执行脚本。</p><p>这时候需要通过以下方式来防止这类漏洞 :<br>1 . 对待跳转的 URL 参数做白名单或者某种规则过滤<br>2 . 后端注意对敏感信息的保护, 比如 cookie 使用来源验证。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用正则表达式统计代码行数</title>
      <link href="/2018/11/27/%E5%88%A9%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%9F%E8%AE%A1%E4%BB%A3%E7%A0%81%E8%A1%8C%E6%95%B0/"/>
      <url>/2018/11/27/%E5%88%A9%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%9F%E8%AE%A1%E4%BB%A3%E7%A0%81%E8%A1%8C%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>利用ide编辑器统计代码行数<br><a id="more"></a></p><h2 id="利用正则表达式统计代码行数"><a href="#利用正则表达式统计代码行数" class="headerlink" title="利用正则表达式统计代码行数"></a>利用正则表达式统计代码行数</h2><p>在项目中，我们常常有统计代码行数的需要，但是如果不利用第三方工具的话，面对一个项目（甚至一个工程或解决方案中若干个项目）中成百上千的代码文件，实在有一种力不从心的感觉。</p><p>但利用正则表达式可以巧妙解决。用的工具不是别的，正是所有的IDE（Visual Studio、Eclipse等等）和常用的文本编辑器（SublimeText2、Notepad++等）日常必备软件的“在文件中查找”，不同的软件略有不同，但大同小异。</p><p>再复杂的IDE，其搜索功能也是基于字符串的匹配进行的。我们知道，文本中每次换行会增加一个 \n 。如果直接用正则\n每一个匹配项就代表一次换行。但需要注意的是文件的最后一行是没有换行符的，所以文本行数=文件数+换行符数目，因而把两个看到的两个数字加起来才是文本行数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^.*$</span><br></pre></td></tr></table></figure><p>表示搜索条件为行首与行尾之间包含任意个任意字符（非换行符）。</p><p>上面的方法可以很迅速地得到代码行数，不过遗憾的是统计结果把空行（仅包含空格和制表符的行）也统计进去了，然而很多时候我们并不想把这些文本也给算进代码量里去，怎么办呢？别急，我们只要对正则表达式做一点点修改。我的思路是，只需要找出一个不是空格或制表符的字符即可，于是可写出了这个正则表达式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\s*[^\s]+.*$</span><br></pre></td></tr></table></figure></p><p>它表示先忽略一行前面的连续空格和制表符等，然后寻找是否有一个字符不为空格、制表符、换行符和回车符，如果有则表明这行不为空行。<br>不用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\s*\S+.*$</span><br></pre></td></tr></table></figure></p><p>是为了下面方便添加其他要排除的注释行或者独立的括号行。</p><p>在实际项目中，我们或许认为注释行不应成为生产量，应从统计数据中排除出去。我们首先要能够对注释行有一个认识。很多程序设计语言中，注释行都会用“/”或者“#”等字符开头。我们假设项目中的注释行都是以“/”或“#”开头的（请读者考虑自己项目的特点自行修改）。下面的正则表示，我们要查找的是一行中第一个非空字符不是“/”或“#”或“{”或“}”的行<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^\s*[^\s/#&#123;&#125;]+.*$ </span><br><span class="line">^\s*[^ \t\n\r/#&#123;&#125;]+.*$</span><br></pre></td></tr></table></figure></p><p>作用同上，说明在中括号[]内自定义原子表，打个空格，也可以代表空格。<br>因为控制开头和结尾，所以 + 后不必加问号 ? 取消贪婪模式了。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\s*[^\s/#&#123;&#125;]+</span><br></pre></td></tr></table></figure><p>也行，但是上面加上控制结尾比较严谨。另外，文本编辑框默认是视为单行的，没有设置多行模式，如果设为多行模式就得注意了。php 中，在定界符最右边加 m 即可视为多行。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zepto源码</title>
      <link href="/2018/11/16/zepto%E6%BA%90%E7%A0%81/"/>
      <url>/2018/11/16/zepto%E6%BA%90%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>zepto源码，有注释<br><a id="more"></a></p><h2 id="zepto源码"><a href="#zepto源码" class="headerlink" title="zepto源码"></a>zepto源码</h2><p>最近在看zepto源码，所以把一些注释也加上了，还没看完，以后继续加。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Zepto v1.2.0 - zepto event ajax form ie - zeptojs.com/license */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)</span><br><span class="line">    define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> factory(global) &#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    factory(global)</span><br><span class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>, key, $, classList, emptyArray = [], concat = emptyArray.concat, filter = emptyArray.filter, slice = emptyArray.slice,</span><br><span class="line">    <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">    elementDisplay = &#123;&#125;, classCache = &#123;&#125;,</span><br><span class="line">    cssNumber = &#123; <span class="string">'column-count'</span>: <span class="number">1</span>, <span class="string">'columns'</span>: <span class="number">1</span>, <span class="string">'font-weight'</span>: <span class="number">1</span>, <span class="string">'line-height'</span>: <span class="number">1</span>,<span class="string">'opacity'</span>: <span class="number">1</span>, <span class="string">'z-index'</span>: <span class="number">1</span>, <span class="string">'zoom'</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>, <span class="comment">// &lt;...&gt;都匹配</span></span><br><span class="line">    singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>, <span class="comment">// 只匹配没有内容的标签，如: &lt;div&gt;&lt;/div&gt;或&lt;input /&gt;</span></span><br><span class="line">    <span class="comment">// 匹配&lt;div /&gt;, &lt;: /&gt;这样的，除了&lt;input /&gt;,&lt;img /&gt;这样的</span></span><br><span class="line">    tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span>,</span><br><span class="line">    rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</span><br><span class="line">    capitalRE = <span class="regexp">/([A-Z])/g</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// special attributes that should be get/set via method calls</span></span><br><span class="line">    methodAttributes = [<span class="string">'val'</span>, <span class="string">'css'</span>, <span class="string">'html'</span>, <span class="string">'text'</span>, <span class="string">'data'</span>, <span class="string">'width'</span>, <span class="string">'height'</span>, <span class="string">'offset'</span>],</span><br><span class="line"></span><br><span class="line">    adjacencyOperators = [ <span class="string">'after'</span>, <span class="string">'prepend'</span>, <span class="string">'before'</span>, <span class="string">'append'</span> ],</span><br><span class="line">    table = <span class="built_in">document</span>.createElement(<span class="string">'table'</span>),</span><br><span class="line">    tableRow = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>),</span><br><span class="line">    containers = &#123;</span><br><span class="line">      <span class="string">'tr'</span>: <span class="built_in">document</span>.createElement(<span class="string">'tbody'</span>),</span><br><span class="line">      <span class="string">'tbody'</span>: table, </span><br><span class="line">      <span class="string">'thead'</span>: table, </span><br><span class="line">      <span class="string">'tfoot'</span>: table,</span><br><span class="line">      <span class="string">'td'</span>: tableRow, </span><br><span class="line">      <span class="string">'th'</span>: tableRow,</span><br><span class="line">      <span class="string">'*'</span>: <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    readyRE = <span class="regexp">/complete|loaded|interactive/</span>,</span><br><span class="line">    simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>,</span><br><span class="line">    class2type = &#123;&#125;,</span><br><span class="line">    toString = class2type.toString,</span><br><span class="line">    zepto = &#123;&#125;,</span><br><span class="line">    camelize, </span><br><span class="line">    uniq,</span><br><span class="line">    tempParent = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</span><br><span class="line">    propMap = &#123;</span><br><span class="line">      <span class="string">'tabindex'</span>: <span class="string">'tabIndex'</span>,</span><br><span class="line">      <span class="string">'readonly'</span>: <span class="string">'readOnly'</span>,</span><br><span class="line">      <span class="string">'for'</span>: <span class="string">'htmlFor'</span>,</span><br><span class="line">      <span class="string">'class'</span>: <span class="string">'className'</span>,</span><br><span class="line">      <span class="string">'maxlength'</span>: <span class="string">'maxLength'</span>,</span><br><span class="line">      <span class="string">'cellspacing'</span>: <span class="string">'cellSpacing'</span>,</span><br><span class="line">      <span class="string">'cellpadding'</span>: <span class="string">'cellPadding'</span>,</span><br><span class="line">      <span class="string">'rowspan'</span>: <span class="string">'rowSpan'</span>,</span><br><span class="line">      <span class="string">'colspan'</span>: <span class="string">'colSpan'</span>,</span><br><span class="line">      <span class="string">'usemap'</span>: <span class="string">'useMap'</span>,</span><br><span class="line">      <span class="string">'frameborder'</span>: <span class="string">'frameBorder'</span>,</span><br><span class="line">      <span class="string">'contenteditable'</span>: <span class="string">'contentEditable'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 判断是否为数组</span></span><br><span class="line">    isArray = <span class="built_in">Array</span>.isArray ||</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">object</span>)</span>&#123; <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span> &#125;</span><br><span class="line">  <span class="comment">// 判断节点是否包含选择器</span></span><br><span class="line">  zepto.matches = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!selector || !element || element.nodeType !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> matchesSelector = element.matches || element.webkitMatchesSelector ||</span><br><span class="line">                          element.mozMatchesSelector || element.oMatchesSelector ||</span><br><span class="line">                          element.matchesSelector</span><br><span class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.call(element, selector)</span><br><span class="line">    <span class="comment">// fall back to performing a selector:</span></span><br><span class="line">    <span class="keyword">var</span> match, parent = element.parentNode, temp = !parent</span><br><span class="line">    <span class="keyword">if</span> (temp) (parent = tempParent).appendChild(element)</span><br><span class="line">    <span class="comment">// ~这个符号可以将-1转化为0，直接判断就是false了</span></span><br><span class="line">    match = ~zepto.qsa(parent, selector).indexOf(element)</span><br><span class="line">    temp &amp;&amp; tempParent.removeChild(element)</span><br><span class="line">    <span class="keyword">return</span> match</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查看数据类型</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span> ? <span class="built_in">String</span>(obj) :</span><br><span class="line">      class2type[toString.call(obj)] || <span class="string">"object"</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断是否为函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123; <span class="keyword">return</span> type(value) == <span class="string">"function"</span> &#125;</span><br><span class="line">  <span class="comment">// 判断是否为window对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>)     </span>&#123; <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window &#125;</span><br><span class="line">  <span class="comment">// 判断是否为document对象  </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDocument</span>(<span class="params">obj</span>)   </span>&#123; <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE &#125;</span><br><span class="line">  <span class="comment">// 判断是否为object对象  </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)     </span>&#123; <span class="keyword">return</span> type(obj) == <span class="string">"object"</span> &#125;</span><br><span class="line">  <span class="comment">// 判断是不是纯对象，如 &#123;&#125;,prototype没有添加的</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 判断是不是类数组对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> length = !!obj &amp;&amp; <span class="string">'length'</span> <span class="keyword">in</span> obj &amp;&amp; obj.length,</span><br><span class="line">      type = $.type(obj)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'function'</span> != type &amp;&amp; !isWindow(obj) &amp;&amp; (</span><br><span class="line">      <span class="string">'array'</span> == type || length === <span class="number">0</span> ||</span><br><span class="line">        (<span class="keyword">typeof</span> length == <span class="string">'number'</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; (length - <span class="number">1</span>) <span class="keyword">in</span> obj)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 压缩精简数组，去掉null，undefined</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123; <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123; <span class="keyword">return</span> item != <span class="literal">null</span> &#125;) &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">array</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> array.length &gt; <span class="number">0</span> ? $.fn.concat.apply([], array) : array </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 将font-size形式转换为fontSize驼峰形式</span></span><br><span class="line">  camelize = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, chr</span>)</span>&#123; <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">''</span> &#125;) </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 将驼峰命名转为-形式,正则的$1,$2...代表前边小括号里的内容</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/::/g</span>, <span class="string">'/'</span>)</span><br><span class="line">           .replace(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">'$1_$2'</span>)</span><br><span class="line">           .replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">'$1_$2'</span>)</span><br><span class="line">           .replace(<span class="regexp">/_/g</span>, <span class="string">'-'</span>)</span><br><span class="line">           .toLowerCase()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删除数组中重复的元素，这个方法好牛逼</span></span><br><span class="line">  uniq = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item, idx</span>)</span>&#123; <span class="keyword">return</span> array.indexOf(item) == idx &#125;) </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果classCache中没有name的话，则新建一个这个name的正则</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">classRE</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache ?</span><br><span class="line">      classCache[name] : (classCache[name] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^|\\s)'</span> + name + <span class="string">'(\\s|$)'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 应该是给css赋值的时候，如果没在cssNumber这个表中的话就加上'px'后缀</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maybeAddPx</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> value == <span class="string">"number"</span> &amp;&amp; !cssNumber[dasherize(name)]) ? value + <span class="string">"px"</span> : value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 应该是查看如div,table这样的元素的默认display的值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaultDisplay</span>(<span class="params">nodeName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element, display</span><br><span class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123;</span><br><span class="line">      element = <span class="built_in">document</span>.createElement(nodeName)</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(element)</span><br><span class="line">      display = getComputedStyle(element, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>)</span><br><span class="line">      element.parentNode.removeChild(element)</span><br><span class="line">      display == <span class="string">"none"</span> &amp;&amp; (display = <span class="string">"block"</span>)</span><br><span class="line">      elementDisplay[nodeName] = display</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elementDisplay[nodeName]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取节点的子元素</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'children'</span> <span class="keyword">in</span> element ?</span><br><span class="line">      slice.call(element.children) :</span><br><span class="line">      $.map(element.childNodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123; <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) <span class="keyword">return</span> node &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, len = dom ? dom.length : <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) <span class="keyword">this</span>[i] = dom[i]</span><br><span class="line">    <span class="keyword">this</span>.length = len</span><br><span class="line">    <span class="keyword">this</span>.selector = selector || <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></span><br><span class="line">  <span class="comment">// to generate DOM nodes from the given html string.</span></span><br><span class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></span><br><span class="line">  <span class="comment">// This function can be overridden in plugins for example to make</span></span><br><span class="line">  <span class="comment">// it compatible with browsers that don't support the DOM fully.</span></span><br><span class="line">  zepto.fragment = <span class="function"><span class="keyword">function</span>(<span class="params">html, name, properties</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom, nodes, container</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A special case optimization for a single tag</span></span><br><span class="line">    <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">      <span class="keyword">if</span> (html.replace) html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>) <span class="comment">// 将&lt;div/&gt;转化成&lt;div&gt;&lt;/div&gt;</span></span><br><span class="line">      <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">'*'</span></span><br><span class="line">      <span class="comment">// 下面的做法就是将'&lt;span&gt;12345&lt;/span&gt;'这样的字符串转为dom节点的形式</span></span><br><span class="line">      container = containers[name]</span><br><span class="line">      container.innerHTML = <span class="string">''</span> + html</span><br><span class="line">      dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        container.removeChild(<span class="keyword">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(properties)) &#123;</span><br><span class="line">      nodes = $(dom)</span><br><span class="line">      $.each(properties, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) nodes[key](value)</span><br><span class="line">        <span class="keyword">else</span> nodes.attr(key, value)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dom</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.haha = zepto;</span><br><span class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></span><br><span class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></span><br><span class="line">  <span class="comment">// to the array. This method can be overridden in plugins.</span></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></span><br><span class="line">  <span class="comment">// collection. This method can be overridden in plugins.</span></span><br><span class="line">  zepto.isZ = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span></span><br><span class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></span><br><span class="line">  <span class="comment">// special cases).</span></span><br><span class="line">  <span class="comment">// This method can be overridden in plugins.</span></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom</span><br><span class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">    <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z()</span><br><span class="line">    <span class="comment">// Optimize for string selectors</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'string'</span>) &#123;</span><br><span class="line">      selector = selector.trim()</span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></span><br><span class="line">      <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></span><br><span class="line">      <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector))</span><br><span class="line">        dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">      <span class="comment">// If it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If a function is given, call it when the DOM is ready</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector)</span><br><span class="line">    <span class="comment">// If a Zepto collection is given, just return it</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// normalize array if an array of nodes is given</span></span><br><span class="line">      <span class="keyword">if</span> (isArray(selector)) dom = compact(selector)</span><br><span class="line">      <span class="comment">// Wrap DOM nodes.</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector))</span><br><span class="line">        dom = [selector], selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</span><br><span class="line">        dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">      <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></span><br><span class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></span><br><span class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></span><br><span class="line">  <span class="comment">// patchable in plugins.</span></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 深度拷贝的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</span><br><span class="line">      <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</span><br><span class="line">          target[key] = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key]))</span><br><span class="line">          target[key] = []</span><br><span class="line">        extend(target[key], source[key], deep)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></span><br><span class="line">  <span class="comment">// objects to the `target` object.</span></span><br><span class="line">  $.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deep, args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">'boolean'</span>) &#123;</span><br><span class="line">      deep = target</span><br><span class="line">      target = args.shift()</span><br><span class="line">    &#125;</span><br><span class="line">    args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123; extend(target, arg, deep) &#125;)</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span></span><br><span class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></span><br><span class="line">  <span class="comment">// This method can be overridden in plugins.</span></span><br><span class="line">  zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> found,</span><br><span class="line">        maybeID = selector[<span class="number">0</span>] == <span class="string">'#'</span>,</span><br><span class="line">        maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">'.'</span>,</span><br><span class="line">        nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></span><br><span class="line">        isSimple = simpleSelectorRE.test(nameOnly)</span><br><span class="line">    <span class="keyword">return</span> (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) ? <span class="comment">// Safari DocumentFragment doesn't have getElementById</span></span><br><span class="line">      ( (found = element.getElementById(nameOnly)) ? [found] : [] ) :</span><br><span class="line">      (element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span> &amp;&amp; element.nodeType !== <span class="number">11</span>) ? [] :</span><br><span class="line">      slice.call(</span><br><span class="line">        isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ? <span class="comment">// DocumentFragment doesn't have getElementsByClassName/TagName</span></span><br><span class="line">          maybeClass ? element.getElementsByClassName(nameOnly) : <span class="comment">// If it's simple, it could be a class</span></span><br><span class="line">          element.getElementsByTagName(selector) : <span class="comment">// Or a tag</span></span><br><span class="line">          element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">filtered</span>(<span class="params">nodes, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selector == <span class="literal">null</span> ? $(nodes) : $(nodes).filter(selector)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断父节点中是否包含子节点，parent为父节点，node为子节点</span></span><br><span class="line">  $.contains = <span class="built_in">document</span>.documentElement.contains ?</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> parent !== node &amp;&amp; parent.contains(node)</span><br><span class="line">    &#125; :</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (node &amp;&amp; (node = node.parentNode))</span><br><span class="line">        <span class="keyword">if</span> (node === parent) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcArg</span>(<span class="params">context, arg, idx, payload</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isFunction(arg) ? arg.call(context, idx, payload) : arg</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 设置node节点的属性值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAttribute</span>(<span class="params">node, name, value</span>) </span>&#123;</span><br><span class="line">    value == <span class="literal">null</span> ? node.removeAttribute(name) : node.setAttribute(name, value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">className</span>(<span class="params">node, value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> klass = node.className || <span class="string">''</span>,</span><br><span class="line">        svg   = klass &amp;&amp; klass.baseVal !== <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.baseVal : klass</span><br><span class="line">    svg ? (klass.baseVal = value) : (node.className = value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// "true"  =&gt; true</span></span><br><span class="line">  <span class="comment">// "false" =&gt; false</span></span><br><span class="line">  <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">  <span class="comment">// "42"    =&gt; 42</span></span><br><span class="line">  <span class="comment">// "42.5"  =&gt; 42.5</span></span><br><span class="line">  <span class="comment">// "08"    =&gt; "08"</span></span><br><span class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></span><br><span class="line">  <span class="comment">// String  =&gt; self</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 反序列化</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deserializeValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value ?</span><br><span class="line">        value == <span class="string">"true"</span> ||</span><br><span class="line">        ( value == <span class="string">"false"</span> ? <span class="literal">false</span> :</span><br><span class="line">          value == <span class="string">"null"</span> ? <span class="literal">null</span> :</span><br><span class="line">          +value + <span class="string">""</span> == value ? +value :</span><br><span class="line">          /^[\[\&#123;]/.test(value) ? $.parseJSON(value) :</span><br><span class="line">          value )</span><br><span class="line">        : value</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.type = type</span><br><span class="line">  $.isFunction = isFunction</span><br><span class="line">  $.isWindow = isWindow</span><br><span class="line">  $.isArray = isArray</span><br><span class="line">  $.isPlainObject = isPlainObject</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断是否为空对象函数</span></span><br><span class="line">  $.isEmptyObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name</span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断是否是数字形式的 123或'123'</span></span><br><span class="line">  $.isNumeric = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="built_in">Number</span>(val), type = <span class="keyword">typeof</span> val</span><br><span class="line">    <span class="keyword">return</span> val != <span class="literal">null</span> &amp;&amp; type != <span class="string">'boolean'</span> &amp;&amp;</span><br><span class="line">      (type != <span class="string">'string'</span> || val.length) &amp;&amp;</span><br><span class="line">      !<span class="built_in">isNaN</span>(num) &amp;&amp; <span class="built_in">isFinite</span>(num) || <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断元素是否在数组中，array数组，elem元素，i是从数组中的第几位开始查找</span></span><br><span class="line">  $.inArray = <span class="function"><span class="keyword">function</span>(<span class="params">elem, array, i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.camelCase = camelize</span><br><span class="line">  $.trim = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str == <span class="literal">null</span> ? <span class="string">""</span> : <span class="built_in">String</span>.prototype.trim.call(str)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// plugin compatibility</span></span><br><span class="line">  $.uuid = <span class="number">0</span></span><br><span class="line">  $.support = &#123; &#125;</span><br><span class="line">  $.expr = &#123; &#125;</span><br><span class="line">  $.noop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// map函数，对elements进行处理后返回新数组</span></span><br><span class="line">  $.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value, values = [], i, key</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements))</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span><br><span class="line">        value = callback(elements[i], i)</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</span><br><span class="line">        value = callback(elements[key], key)</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span> flatten(values)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历elements，执行callback函数，如果执行时返回false，则停止遍历操作</span></span><br><span class="line">  $.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, key</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elements</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 过滤数组</span></span><br><span class="line">  $.grep = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(elements, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) $.parseJSON = <span class="built_in">JSON</span>.parse</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Populate the class2type map</span></span><br><span class="line">  $.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">    class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define methods that will be available on all</span></span><br><span class="line">  <span class="comment">// Zepto collections</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: zepto.Z,</span><br><span class="line">    length: 0,</span><br><span class="line"></span><br><span class="line">    // Because a collection acts like an array</span><br><span class="line">    // copy over these useful array functions.</span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    reduce: emptyArray.reduce,</span><br><span class="line">    push: emptyArray.push,</span><br><span class="line">    sort: emptyArray.sort,</span><br><span class="line">    splice: emptyArray.splice,</span><br><span class="line">    indexOf: emptyArray.indexOf,</span><br><span class="line">    concat: function()&#123;</span><br><span class="line">      <span class="keyword">var</span> i, value, args = []</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">        value = <span class="built_in">arguments</span>[i]</span><br><span class="line">        args[i] = zepto.isZ(value) ? value.toArray() : value</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> concat.apply(zepto.isZ(<span class="keyword">this</span>) ? <span class="keyword">this</span>.toArray() : <span class="keyword">this</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></span><br><span class="line">    <span class="comment">// from their array counterparts</span></span><br><span class="line">    map: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $($.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, i</span>)</span>&#123; <span class="keyword">return</span> fn.call(el, i, el) &#125;))</span><br><span class="line">    &#125;,</span><br><span class="line">    slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    ready: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// need to check if document.body exists for IE as that browser reports</span></span><br><span class="line">      <span class="comment">// document ready when it hasn't yet created the body element</span></span><br><span class="line">      <span class="keyword">if</span> (readyRE.test(<span class="built_in">document</span>.readyState) &amp;&amp; <span class="built_in">document</span>.body) callback($)</span><br><span class="line">      <span class="keyword">else</span> <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; callback($) &#125;, <span class="literal">false</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span>: function(idx)&#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span> ? slice.call(<span class="keyword">this</span>) : <span class="keyword">this</span>[idx &gt;= <span class="number">0</span> ? idx : idx + <span class="keyword">this</span>.length]</span><br><span class="line">    &#125;,</span><br><span class="line">    toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.get() &#125;,</span><br><span class="line">    size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length</span><br><span class="line">    &#125;,</span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parentNode != <span class="literal">null</span>)</span><br><span class="line">          <span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    each: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">      emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> <span class="keyword">this</span>.not(<span class="keyword">this</span>.not(selector))</span><br><span class="line">      <span class="keyword">return</span> $(filter.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zepto.matches(element, selector)</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;,</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">selector,context</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(uniq(<span class="keyword">this</span>.concat($(selector,context))))</span><br><span class="line">    &#125;,</span><br><span class="line">    is: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span> &amp;&amp; zepto.matches(<span class="keyword">this</span>[<span class="number">0</span>], selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    not: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> nodes=[]</span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector) &amp;&amp; selector.call !== <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (!selector.call(<span class="keyword">this</span>,idx)) nodes.push(<span class="keyword">this</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> excludes = <span class="keyword">typeof</span> selector == <span class="string">'string'</span> ? <span class="keyword">this</span>.filter(selector) :</span><br><span class="line">          (likeArray(selector) &amp;&amp; isFunction(selector.item)) ? slice.call(selector) : $(selector)</span><br><span class="line">        <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (excludes.indexOf(el) &lt; <span class="number">0</span>) nodes.push(el)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> $(nodes)</span><br><span class="line">    &#125;,</span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isObject(selector) ?</span><br><span class="line">          $.contains(<span class="keyword">this</span>, selector) :</span><br><span class="line">          $(<span class="keyword">this</span>).find(selector).size()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    eq: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="number">-1</span> ? <span class="keyword">this</span>.slice(idx) : <span class="keyword">this</span>.slice(idx, + idx + <span class="number">1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el)</span><br><span class="line">    &#125;,</span><br><span class="line">    last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="keyword">this</span>.length - <span class="number">1</span>]</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el)</span><br><span class="line">    &#125;,</span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> result, $<span class="keyword">this</span> = <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">if</span> (!selector) result = $()</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'object'</span>)</span><br><span class="line">        result = $(selector).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> node = <span class="keyword">this</span></span><br><span class="line">          <span class="keyword">return</span> emptyArray.some.call($<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $.contains(parent, node)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length == <span class="number">1</span>) result = $(zepto.qsa(<span class="keyword">this</span>[<span class="number">0</span>], selector))</span><br><span class="line">      <span class="keyword">else</span> result = <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> zepto.qsa(<span class="keyword">this</span>, selector) &#125;)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;,</span><br><span class="line">    closest: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> nodes = [], collection = <span class="keyword">typeof</span> selector == <span class="string">'object'</span> &amp;&amp; $(selector)</span><br><span class="line">      <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, node</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (node &amp;&amp; !(collection ? collection.indexOf(node) &gt;= <span class="number">0</span> : zepto.matches(node, selector)))</span><br><span class="line">          node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode</span><br><span class="line">        <span class="keyword">if</span> (node &amp;&amp; nodes.indexOf(node) &lt; <span class="number">0</span>) nodes.push(node)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> $(nodes)</span><br><span class="line">    &#125;,</span><br><span class="line">    parents: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ancestors = [], nodes = <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">while</span> (nodes.length &gt; <span class="number">0</span>)</span><br><span class="line">        nodes = $.map(nodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> ((node = node.parentNode) &amp;&amp; !isDocument(node) &amp;&amp; ancestors.indexOf(node) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            ancestors.push(node)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">return</span> filtered(ancestors, selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    parent: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(uniq(<span class="keyword">this</span>.pluck(<span class="string">'parentNode'</span>)), selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    children: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(<span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> children(<span class="keyword">this</span>) &#125;), selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    contents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.contentDocument || slice.call(<span class="keyword">this</span>.childNodes) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    siblings: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(<span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">i, el</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filter.call(children(el.parentNode), <span class="function"><span class="keyword">function</span>(<span class="params">child</span>)</span>&#123; <span class="keyword">return</span> child!==el &#125;)</span><br><span class="line">      &#125;), selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    empty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.innerHTML = <span class="string">''</span> &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// `pluck` is borrowed from Prototype.js</span></span><br><span class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">property</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123; <span class="keyword">return</span> el[property] &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</span><br><span class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params">newContent</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.before(newContent).remove()</span><br><span class="line">    &#125;,</span><br><span class="line">    wrap: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !func)</span><br><span class="line">        <span class="keyword">var</span> dom   = $(structure).get(<span class="number">0</span>),</span><br><span class="line">            clone = dom.parentNode || <span class="keyword">this</span>.length &gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">        $(<span class="keyword">this</span>).wrapAll(</span><br><span class="line">          func ? structure.call(<span class="keyword">this</span>, index) :</span><br><span class="line">            clone ? dom.cloneNode(<span class="literal">true</span>) : dom</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">        $(<span class="keyword">this</span>[<span class="number">0</span>]).before(structure = $(structure))</span><br><span class="line">        <span class="keyword">var</span> children</span><br><span class="line">        <span class="comment">// drill down to the inmost element</span></span><br><span class="line">        <span class="keyword">while</span> ((children = structure.children()).length) structure = children.first()</span><br><span class="line">        $(structure).append(<span class="keyword">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    wrapInner: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = $(<span class="keyword">this</span>), contents = self.contents(),</span><br><span class="line">            dom  = func ? structure.call(<span class="keyword">this</span>, index) : structure</span><br><span class="line">        contents.length ? contents.wrapAll(dom) : self.append(dom)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    unwrap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.parent().each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="keyword">this</span>).replaceWith($(<span class="keyword">this</span>).children())</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.cloneNode(<span class="literal">true</span>) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    toggle: <span class="function"><span class="keyword">function</span>(<span class="params">setting</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> el = $(<span class="keyword">this</span>)</span><br><span class="line">        ;(setting === <span class="literal">undefined</span> ? el.css(<span class="string">"display"</span>) == <span class="string">"none"</span> : setting) ? el.show() : el.hide()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    prev: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">'previousElementSibling'</span>)).filter(selector || <span class="string">'*'</span>) &#125;,</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">'nextElementSibling'</span>)).filter(selector || <span class="string">'*'</span>) &#125;,</span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ?</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> originHtml = <span class="keyword">this</span>.innerHTML</span><br><span class="line">          $(<span class="keyword">this</span>).empty().append( funcArg(<span class="keyword">this</span>, html, idx, originHtml) )</span><br><span class="line">        &#125;) :</span><br><span class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> ? <span class="keyword">this</span>[<span class="number">0</span>].innerHTML : <span class="literal">null</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    text: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ?</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> newText = funcArg(<span class="keyword">this</span>, text, idx, <span class="keyword">this</span>.textContent)</span><br><span class="line">          <span class="keyword">this</span>.textContent = newText == <span class="literal">null</span> ? <span class="string">''</span> : <span class="string">''</span>+newText</span><br><span class="line">        &#125;) :</span><br><span class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> ? <span class="keyword">this</span>.pluck(<span class="string">'textContent'</span>).join(<span class="string">""</span>) : <span class="literal">null</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    attr: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> result</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">typeof</span> name == <span class="string">'string'</span> &amp;&amp; !(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>)) ?</span><br><span class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>].nodeType == <span class="number">1</span> &amp;&amp; (result = <span class="keyword">this</span>[<span class="number">0</span>].getAttribute(name)) != <span class="literal">null</span> ? result : <span class="literal">undefined</span>) :</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType !== <span class="number">1</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">if</span> (isObject(name)) <span class="keyword">for</span> (key <span class="keyword">in</span> name) setAttribute(<span class="keyword">this</span>, key, name[key])</span><br><span class="line">          <span class="keyword">else</span> setAttribute(<span class="keyword">this</span>, name, funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.getAttribute(name)))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    removeAttr: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.nodeType === <span class="number">1</span> &amp;&amp; name.split(<span class="string">' '</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">attribute</span>)</span>&#123;</span><br><span class="line">        setAttribute(<span class="keyword">this</span>, attribute)</span><br><span class="line">      &#125;, <span class="keyword">this</span>)&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    prop: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</span><br><span class="line">      name = propMap[name] || name</span><br><span class="line">      <span class="keyword">return</span> (<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>[name] = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>[name])</span><br><span class="line">        &#125;) :</span><br><span class="line">        (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>][name])</span><br><span class="line">    &#125;,</span><br><span class="line">    removeProp: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      name = propMap[name] || name</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">delete</span> <span class="keyword">this</span>[name] &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> attrName = <span class="string">'data-'</span> + name.replace(capitalRE, <span class="string">'-$1'</span>).toLowerCase()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data = (<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</span><br><span class="line">        <span class="keyword">this</span>.attr(attrName, value) :</span><br><span class="line">        <span class="keyword">this</span>.attr(attrName)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? deserializeValue(data) : <span class="literal">undefined</span></span><br><span class="line">    &#125;,</span><br><span class="line">    val: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) value = <span class="string">""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.value = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.value)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; (<span class="keyword">this</span>[<span class="number">0</span>].multiple ?</span><br><span class="line">           $(<span class="keyword">this</span>[<span class="number">0</span>]).find(<span class="string">'option'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.selected &#125;).pluck(<span class="string">'value'</span>) :</span><br><span class="line">           <span class="keyword">this</span>[<span class="number">0</span>].value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    offset: <span class="function"><span class="keyword">function</span>(<span class="params">coordinates</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (coordinates) <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">            coords = funcArg(<span class="keyword">this</span>, coordinates, index, $<span class="keyword">this</span>.offset()),</span><br><span class="line">            parentOffset = $<span class="keyword">this</span>.offsetParent().offset(),</span><br><span class="line">            props = &#123;</span><br><span class="line">              top:  coords.top  - parentOffset.top,</span><br><span class="line">              left: coords.left - parentOffset.left</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($<span class="keyword">this</span>.css(<span class="string">'position'</span>) == <span class="string">'static'</span>) props[<span class="string">'position'</span>] = <span class="string">'relative'</span></span><br><span class="line">        $<span class="keyword">this</span>.css(props)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">document</span>.documentElement !== <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !$.contains(<span class="built_in">document</span>.documentElement, <span class="keyword">this</span>[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span>&#125;</span><br><span class="line">      <span class="keyword">var</span> obj = <span class="keyword">this</span>[<span class="number">0</span>].getBoundingClientRect()</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        left: obj.left + <span class="built_in">window</span>.pageXOffset,</span><br><span class="line">        top: obj.top + <span class="built_in">window</span>.pageYOffset,</span><br><span class="line">        width: <span class="built_in">Math</span>.round(obj.width),</span><br><span class="line">        height: <span class="built_in">Math</span>.round(obj.height)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">property, value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> element = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> property == <span class="string">'string'</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!element) <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">return</span> element.style[camelize(property)] || getComputedStyle(element, <span class="string">''</span>).getPropertyValue(property)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isArray(property)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!element) <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">var</span> props = &#123;&#125;</span><br><span class="line">          <span class="keyword">var</span> computedStyle = getComputedStyle(element, <span class="string">''</span>)</span><br><span class="line">          $.each(property, <span class="function"><span class="keyword">function</span>(<span class="params">_, prop</span>)</span>&#123;</span><br><span class="line">            props[prop] = (element.style[camelize(prop)] || computedStyle.getPropertyValue(prop))</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span> props</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> css = <span class="string">''</span></span><br><span class="line">      <span class="keyword">if</span> (type(property) == <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.removeProperty(dasherize(property)) &#125;)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          css = dasherize(property) + <span class="string">":"</span> + maybeAddPx(property, value)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</span><br><span class="line">          <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.removeProperty(dasherize(key)) &#125;)</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            css += dasherize(key) + <span class="string">':'</span> + maybeAddPx(key, property[key]) + <span class="string">';'</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.cssText += <span class="string">';'</span> + css &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    index: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> element ? <span class="keyword">this</span>.indexOf($(element)[<span class="number">0</span>]) : <span class="keyword">this</span>.parent().children().indexOf(<span class="keyword">this</span>[<span class="number">0</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    hasClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      <span class="keyword">return</span> emptyArray.some.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.test(className(el))</span><br><span class="line">      &#125;, classRE(name))</span><br><span class="line">    &#125;,</span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">'className'</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span></span><br><span class="line">        classList = []</span><br><span class="line">        <span class="keyword">var</span> cls = className(<span class="keyword">this</span>), newName = funcArg(<span class="keyword">this</span>, name, idx, cls)</span><br><span class="line">        newName.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (!$(<span class="keyword">this</span>).hasClass(klass)) classList.push(klass)</span><br><span class="line">        &#125;, <span class="keyword">this</span>)</span><br><span class="line">        classList.length &amp;&amp; className(<span class="keyword">this</span>, cls + (cls ? <span class="string">" "</span> : <span class="string">""</span>) + classList.join(<span class="string">" "</span>))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    removeClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">'className'</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> className(<span class="keyword">this</span>, <span class="string">''</span>)</span><br><span class="line">        classList = className(<span class="keyword">this</span>)</span><br><span class="line">        funcArg(<span class="keyword">this</span>, name, idx, classList).split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</span><br><span class="line">          classList = classList.replace(classRE(klass), <span class="string">" "</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        className(<span class="keyword">this</span>, classList.trim())</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    toggleClass: <span class="function"><span class="keyword">function</span>(<span class="params">name, when</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>), names = funcArg(<span class="keyword">this</span>, name, idx, className(<span class="keyword">this</span>))</span><br><span class="line">        names.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</span><br><span class="line">          (when === <span class="literal">undefined</span> ? !$<span class="keyword">this</span>.hasClass(klass) : when) ?</span><br><span class="line">            $<span class="keyword">this</span>.addClass(klass) : $<span class="keyword">this</span>.removeClass(klass)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    scrollTop: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">var</span> hasScrollTop = <span class="string">'scrollTop'</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> hasScrollTop ? <span class="keyword">this</span>[<span class="number">0</span>].scrollTop : <span class="keyword">this</span>[<span class="number">0</span>].pageYOffset</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(hasScrollTop ?</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTop = value &#125; :</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTo(<span class="keyword">this</span>.scrollX, value) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    scrollLeft: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">var</span> hasScrollLeft = <span class="string">'scrollLeft'</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> hasScrollLeft ? <span class="keyword">this</span>[<span class="number">0</span>].scrollLeft : <span class="keyword">this</span>[<span class="number">0</span>].pageXOffset</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(hasScrollLeft ?</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollLeft = value &#125; :</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTo(value, <span class="keyword">this</span>.scrollY) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    position: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> elem = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">// Get *real* offsetParent</span></span><br><span class="line">        offsetParent = <span class="keyword">this</span>.offsetParent(),</span><br><span class="line">        <span class="comment">// Get correct offsets</span></span><br><span class="line">        offset       = <span class="keyword">this</span>.offset(),</span><br><span class="line">        parentOffset = rootNodeRE.test(offsetParent[<span class="number">0</span>].nodeName) ? &#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125; : offsetParent.offset()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract element margins</span></span><br><span class="line">      <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></span><br><span class="line">      <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></span><br><span class="line">      offset.top  -= <span class="built_in">parseFloat</span>( $(elem).css(<span class="string">'margin-top'</span>) ) || <span class="number">0</span></span><br><span class="line">      offset.left -= <span class="built_in">parseFloat</span>( $(elem).css(<span class="string">'margin-left'</span>) ) || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add offsetParent borders</span></span><br><span class="line">      parentOffset.top  += <span class="built_in">parseFloat</span>( $(offsetParent[<span class="number">0</span>]).css(<span class="string">'border-top-width'</span>) ) || <span class="number">0</span></span><br><span class="line">      parentOffset.left += <span class="built_in">parseFloat</span>( $(offsetParent[<span class="number">0</span>]).css(<span class="string">'border-left-width'</span>) ) || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract the two offsets</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        top:  offset.top  - parentOffset.top,</span><br><span class="line">        left: offset.left - parentOffset.left</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    offsetParent: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parent = <span class="keyword">this</span>.offsetParent || <span class="built_in">document</span>.body</span><br><span class="line">        <span class="keyword">while</span> (parent &amp;&amp; !rootNodeRE.test(parent.nodeName) &amp;&amp; $(parent).css(<span class="string">"position"</span>) == <span class="string">"static"</span>)</span><br><span class="line">          parent = parent.offsetParent</span><br><span class="line">        <span class="keyword">return</span> parent</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for now</span></span><br><span class="line">  $.fn.detach = $.fn.remove</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `width` and `height` functions</span></span><br><span class="line">  ;[<span class="string">'width'</span>, <span class="string">'height'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dimension</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dimensionProperty =</span><br><span class="line">      dimension.replace(<span class="regexp">/./</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>)</span>&#123; <span class="keyword">return</span> m[<span class="number">0</span>].toUpperCase() &#125;)</span><br><span class="line"></span><br><span class="line">    $.fn[dimension] = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> offset, el = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> isWindow(el) ? el[<span class="string">'inner'</span> + dimensionProperty] :</span><br><span class="line">        isDocument(el) ? el.documentElement[<span class="string">'scroll'</span> + dimensionProperty] :</span><br><span class="line">        (offset = <span class="keyword">this</span>.offset()) &amp;&amp; offset[dimension]</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        el = $(<span class="keyword">this</span>)</span><br><span class="line">        el.css(dimension, funcArg(<span class="keyword">this</span>, value, idx, el[dimension]()))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, fun</span>) </span>&#123;</span><br><span class="line">    fun(node)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = node.childNodes.length; i &lt; len; i++)</span><br><span class="line">      traverseNode(node.childNodes[i], fun)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></span><br><span class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></span><br><span class="line">  adjacencyOperators.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span> <span class="comment">//=&gt; prepend, append</span></span><br><span class="line"></span><br><span class="line">    $.fn[operator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></span><br><span class="line">      <span class="keyword">var</span> argType, nodes = $.map(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> arr = []</span><br><span class="line">            argType = type(arg)</span><br><span class="line">            <span class="keyword">if</span> (argType == <span class="string">"array"</span>) &#123;</span><br><span class="line">              arg.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (el.nodeType !== <span class="literal">undefined</span>) <span class="keyword">return</span> arr.push(el)</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ($.zepto.isZ(el)) <span class="keyword">return</span> arr = arr.concat(el.get())</span><br><span class="line">                arr = arr.concat(zepto.fragment(el))</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="keyword">return</span> arr</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> argType == <span class="string">"object"</span> || arg == <span class="literal">null</span> ?</span><br><span class="line">              arg : zepto.fragment(arg)</span><br><span class="line">          &#125;),</span><br><span class="line">          parent, copyByClone = <span class="keyword">this</span>.length &gt; <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (nodes.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, target</span>)</span>&#123;</span><br><span class="line">        parent = inside ? target : target.parentNode</span><br><span class="line"></span><br><span class="line">        <span class="comment">// convert all methods to a "before" operation</span></span><br><span class="line">        target = operatorIndex == <span class="number">0</span> ? target.nextSibling :</span><br><span class="line">                 operatorIndex == <span class="number">1</span> ? target.firstChild :</span><br><span class="line">                 operatorIndex == <span class="number">2</span> ? target :</span><br><span class="line">                 <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> parentInDocument = $.contains(<span class="built_in">document</span>.documentElement, parent)</span><br><span class="line"></span><br><span class="line">        nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (copyByClone) node = node.cloneNode(<span class="literal">true</span>)</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).remove()</span><br><span class="line"></span><br><span class="line">          parent.insertBefore(node, target)</span><br><span class="line">          <span class="keyword">if</span> (parentInDocument) traverseNode(node, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (el.nodeName != <span class="literal">null</span> &amp;&amp; el.nodeName.toUpperCase() === <span class="string">'SCRIPT'</span> &amp;&amp;</span><br><span class="line">               (!el.type || el.type === <span class="string">'text/javascript'</span>) &amp;&amp; !el.src)&#123;</span><br><span class="line">              <span class="keyword">var</span> target = el.ownerDocument ? el.ownerDocument.defaultView : <span class="built_in">window</span></span><br><span class="line">              target[<span class="string">'eval'</span>].call(target, el.innerHTML)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after    =&gt; insertAfter</span></span><br><span class="line">    <span class="comment">// prepend  =&gt; prependTo</span></span><br><span class="line">    <span class="comment">// before   =&gt; insertBefore</span></span><br><span class="line">    <span class="comment">// append   =&gt; appendTo</span></span><br><span class="line">    $.fn[inside ? operator+<span class="string">'To'</span> : <span class="string">'insert'</span>+(operatorIndex ? <span class="string">'Before'</span> : <span class="string">'After'</span>)] = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">      $(html)[operator](<span class="keyword">this</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  zepto.Z.prototype = Z.prototype = $.fn</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></span><br><span class="line">  zepto.uniq = uniq</span><br><span class="line">  zepto.deserializeValue = deserializeValue</span><br><span class="line">  $.zepto = zepto</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</span><br><span class="line"></span><br><span class="line"><span class="comment">// zepto的事件代码</span></span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _zid = <span class="number">1</span>, <span class="literal">undefined</span>,</span><br><span class="line">      slice = <span class="built_in">Array</span>.prototype.slice,</span><br><span class="line">      isFunction = $.isFunction,</span><br><span class="line">      isString = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">typeof</span> obj == <span class="string">'string'</span> &#125;,</span><br><span class="line">      handlers = &#123;&#125;,</span><br><span class="line">      specialEvents=&#123;&#125;,</span><br><span class="line">      focusinSupported = <span class="string">'onfocusin'</span> <span class="keyword">in</span> <span class="built_in">window</span>,</span><br><span class="line">      focus = &#123; <span class="attr">focus</span>: <span class="string">'focusin'</span>, <span class="attr">blur</span>: <span class="string">'focusout'</span> &#125;,</span><br><span class="line">      hover = &#123; <span class="attr">mouseenter</span>: <span class="string">'mouseover'</span>, <span class="attr">mouseleave</span>: <span class="string">'mouseout'</span> &#125;</span><br><span class="line"></span><br><span class="line">  specialEvents.click = specialEvents.mousedown = specialEvents.mouseup = specialEvents.mousemove = <span class="string">'MouseEvents'</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">zid</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> element._zid || (element._zid = _zid++)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">findHandlers</span>(<span class="params">element, event, fn, selector</span>) </span>&#123;</span><br><span class="line">    event = parse(event)</span><br><span class="line">    <span class="keyword">if</span> (event.ns) <span class="keyword">var</span> matcher = matcherFor(event.ns)</span><br><span class="line">    <span class="keyword">return</span> (handlers[zid(element)] || []).filter(<span class="function"><span class="keyword">function</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> handler</span><br><span class="line">        &amp;&amp; (!event.e  || handler.e == event.e)</span><br><span class="line">        &amp;&amp; (!event.ns || matcher.test(handler.ns))</span><br><span class="line">        &amp;&amp; (!fn       || zid(handler.fn) === zid(fn))</span><br><span class="line">        &amp;&amp; (!selector || handler.sel == selector)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> parts = (<span class="string">''</span> + event).split(<span class="string">'.'</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">e</span>: parts[<span class="number">0</span>], <span class="attr">ns</span>: parts.slice(<span class="number">1</span>).sort().join(<span class="string">' '</span>)&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">matcherFor</span>(<span class="params">ns</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(?:^| )'</span> + ns.replace(<span class="string">' '</span>, <span class="string">' .* ?'</span>) + <span class="string">'(?: |$)'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eventCapture</span>(<span class="params">handler, captureSetting</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> handler.del &amp;&amp;</span><br><span class="line">      (!focusinSupported &amp;&amp; (handler.e <span class="keyword">in</span> focus)) ||</span><br><span class="line">      !!captureSetting</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">realEvent</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hover[type] || (focusinSupported &amp;&amp; focus[type]) || type</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">element, events, fn, data, selector, delegator, capture</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id = zid(element), <span class="keyword">set</span> = (handlers[id] || (handlers[id] = []))</span><br><span class="line">    events.split(/\s/).forEach(function(event)&#123;</span><br><span class="line">      <span class="keyword">if</span> (event == <span class="string">'ready'</span>) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(fn)</span><br><span class="line">      <span class="keyword">var</span> handler   = parse(event)</span><br><span class="line">      handler.fn    = fn</span><br><span class="line">      handler.sel   = selector</span><br><span class="line">      <span class="comment">// emulate mouseenter, mouseleave</span></span><br><span class="line">      <span class="keyword">if</span> (handler.e <span class="keyword">in</span> hover) fn = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> related = e.relatedTarget</span><br><span class="line">        <span class="keyword">if</span> (!related || (related !== <span class="keyword">this</span> &amp;&amp; !$.contains(<span class="keyword">this</span>, related)))</span><br><span class="line">          <span class="keyword">return</span> handler.fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      handler.del   = delegator</span><br><span class="line">      <span class="keyword">var</span> callback  = delegator || fn</span><br><span class="line">      handler.proxy = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        e = compatible(e)</span><br><span class="line">        <span class="keyword">if</span> (e.isImmediatePropagationStopped()) <span class="keyword">return</span></span><br><span class="line">        e.data = data</span><br><span class="line">        <span class="keyword">var</span> result = callback.apply(element, e._args == <span class="literal">undefined</span> ? [e] : [e].concat(e._args))</span><br><span class="line">        <span class="keyword">if</span> (result === <span class="literal">false</span>) e.preventDefault(), e.stopPropagation()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">      handler.i = <span class="keyword">set</span>.length</span><br><span class="line">      <span class="keyword">set</span>.push(handler)</span><br><span class="line">      if ('addEventListener' in element)</span><br><span class="line">        element.addEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  function remove(element, events, fn, selector, capture)&#123;</span><br><span class="line">    <span class="keyword">var</span> id = zid(element)</span><br><span class="line">    ;(events || <span class="string">''</span>).split(<span class="regexp">/\s/</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">      findHandlers(element, event, fn, selector).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> handlers[id][handler.i]</span><br><span class="line">      <span class="keyword">if</span> (<span class="string">'removeEventListener'</span> <span class="keyword">in</span> element)</span><br><span class="line">        element.removeEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.event = &#123; <span class="attr">add</span>: add, <span class="attr">remove</span>: remove &#125;</span><br><span class="line"></span><br><span class="line">  $.proxy = <span class="function"><span class="keyword">function</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = (<span class="number">2</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) &amp;&amp; slice.call(<span class="built_in">arguments</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> (isFunction(fn)) &#123;</span><br><span class="line">      <span class="keyword">var</span> proxyFn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> fn.apply(context, args ? args.concat(slice.call(<span class="built_in">arguments</span>)) : <span class="built_in">arguments</span>) &#125;</span><br><span class="line">      proxyFn._zid = zid(fn)</span><br><span class="line">      <span class="keyword">return</span> proxyFn</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isString(context)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (args) &#123;</span><br><span class="line">        args.unshift(fn[context], fn)</span><br><span class="line">        <span class="keyword">return</span> $.proxy.apply(<span class="literal">null</span>, args)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $.proxy(fn[context], fn)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"expected function"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.bind = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.on(event, data, callback)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.unbind = <span class="function"><span class="keyword">function</span>(<span class="params">event, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.off(event, callback)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.one = <span class="function"><span class="keyword">function</span>(<span class="params">event, selector, data, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.on(event, selector, data, callback, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> returnTrue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;,</span><br><span class="line">      returnFalse = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">false</span>&#125;,</span><br><span class="line">      ignoreProperties = <span class="regexp">/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/</span>,</span><br><span class="line">      eventMethods = &#123;</span><br><span class="line">        preventDefault: <span class="string">'isDefaultPrevented'</span>,</span><br><span class="line">        stopImmediatePropagation: <span class="string">'isImmediatePropagationStopped'</span>,</span><br><span class="line">        stopPropagation: <span class="string">'isPropagationStopped'</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compatible</span>(<span class="params">event, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (source || !event.isDefaultPrevented) &#123;</span><br><span class="line">      source || (source = event)</span><br><span class="line"></span><br><span class="line">      $.each(eventMethods, <span class="function"><span class="keyword">function</span>(<span class="params">name, predicate</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> sourceMethod = source[name]</span><br><span class="line">        event[name] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>[predicate] = returnTrue</span><br><span class="line">          <span class="keyword">return</span> sourceMethod &amp;&amp; sourceMethod.apply(source, <span class="built_in">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        event[predicate] = returnFalse</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      event.timeStamp || (event.timeStamp = <span class="built_in">Date</span>.now())</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (source.defaultPrevented !== <span class="literal">undefined</span> ? source.defaultPrevented :</span><br><span class="line">          <span class="string">'returnValue'</span> <span class="keyword">in</span> source ? source.returnValue === <span class="literal">false</span> :</span><br><span class="line">          source.getPreventDefault &amp;&amp; source.getPreventDefault())</span><br><span class="line">        event.isDefaultPrevented = returnTrue</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> event</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createProxy</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> key, proxy = &#123; <span class="attr">originalEvent</span>: event &#125;</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> event)</span><br><span class="line">      <span class="keyword">if</span> (!ignoreProperties.test(key) &amp;&amp; event[key] !== <span class="literal">undefined</span>) proxy[key] = event[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> compatible(proxy, event)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.delegate = <span class="function"><span class="keyword">function</span>(<span class="params">selector, event, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.on(event, selector, callback)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.undelegate = <span class="function"><span class="keyword">function</span>(<span class="params">selector, event, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.off(event, selector, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.live = <span class="function"><span class="keyword">function</span>(<span class="params">event, callback</span>)</span>&#123;</span><br><span class="line">    $(<span class="built_in">document</span>.body).delegate(<span class="keyword">this</span>.selector, event, callback)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.die = <span class="function"><span class="keyword">function</span>(<span class="params">event, callback</span>)</span>&#123;</span><br><span class="line">    $(<span class="built_in">document</span>.body).undelegate(<span class="keyword">this</span>.selector, event, callback)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.on = <span class="function"><span class="keyword">function</span>(<span class="params">event, selector, data, callback, one</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> autoRemove, delegator, $<span class="keyword">this</span> = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">if</span> (event &amp;&amp; !isString(event)) &#123;</span><br><span class="line">      $.each(event, <span class="function"><span class="keyword">function</span>(<span class="params">type, fn</span>)</span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>.on(type, selector, data, fn, one)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> $<span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isString(selector) &amp;&amp; !isFunction(callback) &amp;&amp; callback !== <span class="literal">false</span>)</span><br><span class="line">      callback = data, data = selector, selector = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">if</span> (callback === <span class="literal">undefined</span> || data === <span class="literal">false</span>)</span><br><span class="line">      callback = data, data = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callback === <span class="literal">false</span>) callback = returnFalse</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $<span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, element</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (one) autoRemove = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        remove(element, e.type, callback)</span><br><span class="line">        <span class="keyword">return</span> callback.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (selector) delegator = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> evt, match = $(e.target).closest(selector, element).get(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> (match &amp;&amp; match !== element) &#123;</span><br><span class="line">          evt = $.extend(createProxy(e), &#123;<span class="attr">currentTarget</span>: match, <span class="attr">liveFired</span>: element&#125;)</span><br><span class="line">          <span class="keyword">return</span> (autoRemove || callback).apply(match, [evt].concat(slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      add(element, event, callback, data, selector, delegator || autoRemove)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.off = <span class="function"><span class="keyword">function</span>(<span class="params">event, selector, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $<span class="keyword">this</span> = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">if</span> (event &amp;&amp; !isString(event)) &#123;</span><br><span class="line">      $.each(event, <span class="function"><span class="keyword">function</span>(<span class="params">type, fn</span>)</span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>.off(type, selector, fn)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> $<span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isString(selector) &amp;&amp; !isFunction(callback) &amp;&amp; callback !== <span class="literal">false</span>)</span><br><span class="line">      callback = selector, selector = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callback === <span class="literal">false</span>) callback = returnFalse</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $<span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      remove(<span class="keyword">this</span>, event, callback, selector)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.trigger = <span class="function"><span class="keyword">function</span>(<span class="params">event, args</span>)</span>&#123;</span><br><span class="line">    event = (isString(event) || $.isPlainObject(event)) ? $.Event(event) : compatible(event)</span><br><span class="line">    event._args = args</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// handle focus(), blur() by calling them directly</span></span><br><span class="line">      <span class="keyword">if</span> (event.type <span class="keyword">in</span> focus &amp;&amp; <span class="keyword">typeof</span> <span class="keyword">this</span>[event.type] == <span class="string">"function"</span>) <span class="keyword">this</span>[event.type]()</span><br><span class="line">      <span class="comment">// items in the collection might not be DOM elements</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'dispatchEvent'</span> <span class="keyword">in</span> <span class="keyword">this</span>) <span class="keyword">this</span>.dispatchEvent(event)</span><br><span class="line">      <span class="keyword">else</span> $(<span class="keyword">this</span>).triggerHandler(event, args)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// triggers event handlers on current element just as if an event occurred,</span></span><br><span class="line">  <span class="comment">// doesn't trigger an actual event, doesn't bubble</span></span><br><span class="line">  $.fn.triggerHandler = <span class="function"><span class="keyword">function</span>(<span class="params">event, args</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e, result</span><br><span class="line">    <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">i, element</span>)</span>&#123;</span><br><span class="line">      e = createProxy(isString(event) ? $.Event(event) : event)</span><br><span class="line">      e._args = args</span><br><span class="line">      e.target = element</span><br><span class="line">      $.each(findHandlers(element, event.type || event), <span class="function"><span class="keyword">function</span>(<span class="params">i, handler</span>)</span>&#123;</span><br><span class="line">        result = handler.proxy(e)</span><br><span class="line">        <span class="keyword">if</span> (e.isImmediatePropagationStopped()) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// shortcut methods for `.bind(event, fn)` for each event type</span></span><br><span class="line">  ;(<span class="string">'focusin focusout focus blur load resize scroll unload click dblclick '</span>+</span><br><span class="line">  <span class="string">'mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave '</span>+</span><br><span class="line">  <span class="string">'change select keydown keypress keyup error'</span>).split(<span class="string">' '</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    $.fn[event] = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</span><br><span class="line">        <span class="keyword">this</span>.bind(event, callback) :</span><br><span class="line">        <span class="keyword">this</span>.trigger(event)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  $.Event = <span class="function"><span class="keyword">function</span>(<span class="params">type, props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isString(type)) props = type, type = props.type</span><br><span class="line">    <span class="keyword">var</span> event = <span class="built_in">document</span>.createEvent(specialEvents[type] || <span class="string">'Events'</span>), bubbles = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (props) <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> props) (name == <span class="string">'bubbles'</span>) ? (bubbles = !!props[name]) : (event[name] = props[name])</span><br><span class="line">    event.initEvent(type, bubbles, <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">return</span> compatible(event)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(Zepto)</span><br><span class="line"></span><br><span class="line"><span class="comment">// zepto的AJAX代码</span></span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> jsonpID = +<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">      <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">      key,</span><br><span class="line">      name,</span><br><span class="line">      rscript = <span class="regexp">/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi</span>,</span><br><span class="line">      scriptTypeRE = <span class="regexp">/^(?:text|application)\/javascript/i</span>,</span><br><span class="line">      xmlTypeRE = <span class="regexp">/^(?:text|application)\/xml/i</span>,</span><br><span class="line">      jsonType = <span class="string">'application/json'</span>,</span><br><span class="line">      htmlType = <span class="string">'text/html'</span>,</span><br><span class="line">      blankRE = <span class="regexp">/^\s*$/</span>,</span><br><span class="line">      originAnchor = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">  originAnchor.href = <span class="built_in">window</span>.location.href</span><br><span class="line"></span><br><span class="line">  <span class="comment">// trigger a custom event and return false if it was cancelled</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">triggerAndReturn</span>(<span class="params">context, eventName, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> event = $.Event(eventName)</span><br><span class="line">    $(context).trigger(event, data)</span><br><span class="line">    <span class="keyword">return</span> !event.isDefaultPrevented()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// trigger an Ajax "global" event</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">triggerGlobal</span>(<span class="params">settings, context, eventName, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (settings.global) <span class="keyword">return</span> triggerAndReturn(context || <span class="built_in">document</span>, eventName, data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Number of active Ajax requests</span></span><br><span class="line">  $.active = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxStart</span>(<span class="params">settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (settings.global &amp;&amp; $.active++ === <span class="number">0</span>) triggerGlobal(settings, <span class="literal">null</span>, <span class="string">'ajaxStart'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxStop</span>(<span class="params">settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (settings.global &amp;&amp; !(--$.active)) triggerGlobal(settings, <span class="literal">null</span>, <span class="string">'ajaxStop'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// triggers an extra global event "ajaxBeforeSend" that's like "ajaxSend" but cancelable</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxBeforeSend</span>(<span class="params">xhr, settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = settings.context</span><br><span class="line">    <span class="keyword">if</span> (settings.beforeSend.call(context, xhr, settings) === <span class="literal">false</span> ||</span><br><span class="line">        triggerGlobal(settings, context, <span class="string">'ajaxBeforeSend'</span>, [xhr, settings]) === <span class="literal">false</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    triggerGlobal(settings, context, <span class="string">'ajaxSend'</span>, [xhr, settings])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxSuccess</span>(<span class="params">data, xhr, settings, deferred</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = settings.context, status = <span class="string">'success'</span></span><br><span class="line">    settings.success.call(context, data, status, xhr)</span><br><span class="line">    <span class="keyword">if</span> (deferred) deferred.resolveWith(context, [data, status, xhr])</span><br><span class="line">    triggerGlobal(settings, context, <span class="string">'ajaxSuccess'</span>, [xhr, settings, data])</span><br><span class="line">    ajaxComplete(status, xhr, settings)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// type: "timeout", "error", "abort", "parsererror"</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxError</span>(<span class="params">error, type, xhr, settings, deferred</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = settings.context</span><br><span class="line">    settings.error.call(context, xhr, type, error)</span><br><span class="line">    <span class="keyword">if</span> (deferred) deferred.rejectWith(context, [xhr, type, error])</span><br><span class="line">    triggerGlobal(settings, context, <span class="string">'ajaxError'</span>, [xhr, settings, error || type])</span><br><span class="line">    ajaxComplete(type, xhr, settings)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// status: "success", "notmodified", "error", "timeout", "abort", "parsererror"</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxComplete</span>(<span class="params">status, xhr, settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = settings.context</span><br><span class="line">    settings.complete.call(context, xhr, status)</span><br><span class="line">    triggerGlobal(settings, context, <span class="string">'ajaxComplete'</span>, [xhr, settings])</span><br><span class="line">    ajaxStop(settings)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxDataFilter</span>(<span class="params">data, type, settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (settings.dataFilter == empty) <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">var</span> context = settings.context</span><br><span class="line">    <span class="keyword">return</span> settings.dataFilter.call(context, data, type)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Empty function, used as default callback</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">empty</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  $.ajaxJSONP = <span class="function"><span class="keyword">function</span>(<span class="params">options, deferred</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="string">'type'</span> <span class="keyword">in</span> options)) <span class="keyword">return</span> $.ajax(options)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _callbackName = options.jsonpCallback,</span><br><span class="line">      callbackName = ($.isFunction(_callbackName) ?</span><br><span class="line">        _callbackName() : _callbackName) || (<span class="string">'Zepto'</span> + (jsonpID++)),</span><br><span class="line">      script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>),</span><br><span class="line">      originalCallback = <span class="built_in">window</span>[callbackName],</span><br><span class="line">      responseData,</span><br><span class="line">      abort = <span class="function"><span class="keyword">function</span>(<span class="params">errorType</span>) </span>&#123;</span><br><span class="line">        $(script).triggerHandler(<span class="string">'error'</span>, errorType || <span class="string">'abort'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      xhr = &#123; <span class="attr">abort</span>: abort &#125;, abortTimeout</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deferred) deferred.promise(xhr)</span><br><span class="line"></span><br><span class="line">    $(script).on(<span class="string">'load error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e, errorType</span>)</span>&#123;</span><br><span class="line">      clearTimeout(abortTimeout)</span><br><span class="line">      $(script).off().remove()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (e.type == <span class="string">'error'</span> || !responseData) &#123;</span><br><span class="line">        ajaxError(<span class="literal">null</span>, errorType || <span class="string">'error'</span>, xhr, options, deferred)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ajaxSuccess(responseData[<span class="number">0</span>], xhr, options, deferred)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">window</span>[callbackName] = originalCallback</span><br><span class="line">      <span class="keyword">if</span> (responseData &amp;&amp; $.isFunction(originalCallback))</span><br><span class="line">        originalCallback(responseData[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">      originalCallback = responseData = <span class="literal">undefined</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ajaxBeforeSend(xhr, options) === <span class="literal">false</span>) &#123;</span><br><span class="line">      abort(<span class="string">'abort'</span>)</span><br><span class="line">      <span class="keyword">return</span> xhr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>[callbackName] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      responseData = <span class="built_in">arguments</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    script.src = options.url.replace(<span class="regexp">/\?(.+)=\?/</span>, <span class="string">'?$1='</span> + callbackName)</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (options.timeout &gt; <span class="number">0</span>) abortTimeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      abort(<span class="string">'timeout'</span>)</span><br><span class="line">    &#125;, options.timeout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> xhr</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.ajaxSettings = &#123;</span><br><span class="line">    <span class="comment">// Default type of request</span></span><br><span class="line">    type: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="comment">// Callback that is executed before request</span></span><br><span class="line">    beforeSend: empty,</span><br><span class="line">    <span class="comment">// Callback that is executed if the request succeeds</span></span><br><span class="line">    success: empty,</span><br><span class="line">    <span class="comment">// Callback that is executed the the server drops error</span></span><br><span class="line">    error: empty,</span><br><span class="line">    <span class="comment">// Callback that is executed on request complete (both: error and success)</span></span><br><span class="line">    complete: empty,</span><br><span class="line">    <span class="comment">// The context for the callbacks</span></span><br><span class="line">    context: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// Whether to trigger "global" Ajax events</span></span><br><span class="line">    global: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// Transport</span></span><br><span class="line">    xhr: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">window</span>.XMLHttpRequest()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// MIME types mapping</span></span><br><span class="line">    <span class="comment">// IIS returns Javascript as "application/x-javascript"</span></span><br><span class="line">    accepts: &#123;</span><br><span class="line">      script: <span class="string">'text/javascript, application/javascript, application/x-javascript'</span>,</span><br><span class="line">      json:   jsonType,</span><br><span class="line">      xml:    <span class="string">'application/xml, text/xml'</span>,</span><br><span class="line">      html:   htmlType,</span><br><span class="line">      text:   <span class="string">'text/plain'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Whether the request is to another domain</span></span><br><span class="line">    crossDomain: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// Default timeout</span></span><br><span class="line">    timeout: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// Whether data should be serialized to string</span></span><br><span class="line">    processData: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// Whether the browser should be allowed to cache GET responses</span></span><br><span class="line">    cache: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//Used to handle the raw response data of XMLHttpRequest.</span></span><br><span class="line">    <span class="comment">//This is a pre-filtering function to sanitize the response.</span></span><br><span class="line">    <span class="comment">//The sanitized response should be returned</span></span><br><span class="line">    dataFilter: empty</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mimeToDataType</span>(<span class="params">mime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mime) mime = mime.split(<span class="string">';'</span>, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> mime &amp;&amp; ( mime == htmlType ? <span class="string">'html'</span> :</span><br><span class="line">      mime == jsonType ? <span class="string">'json'</span> :</span><br><span class="line">      scriptTypeRE.test(mime) ? <span class="string">'script'</span> :</span><br><span class="line">      xmlTypeRE.test(mime) &amp;&amp; <span class="string">'xml'</span> ) || <span class="string">'text'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">appendQuery</span>(<span class="params">url, query</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (query == <span class="string">''</span>) <span class="keyword">return</span> url</span><br><span class="line">    <span class="keyword">return</span> (url + <span class="string">'&amp;'</span> + query).replace(<span class="regexp">/[&amp;?]&#123;1,2&#125;/</span>, <span class="string">'?'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// serialize payload and append it to the URL for GET requests</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">serializeData</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (options.processData &amp;&amp; options.data &amp;&amp; $.type(options.data) != <span class="string">"string"</span>)</span><br><span class="line">      options.data = $.param(options.data, options.traditional)</span><br><span class="line">    <span class="keyword">if</span> (options.data &amp;&amp; (!options.type || options.type.toUpperCase() == <span class="string">'GET'</span> || <span class="string">'jsonp'</span> == options.dataType))</span><br><span class="line">      options.url = appendQuery(options.url, options.data), options.data = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.ajax = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> settings = $.extend(&#123;&#125;, options || &#123;&#125;),</span><br><span class="line">        deferred = $.Deferred &amp;&amp; $.Deferred(),</span><br><span class="line">        urlAnchor, hashIndex</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> $.ajaxSettings) <span class="keyword">if</span> (settings[key] === <span class="literal">undefined</span>) settings[key] = $.ajaxSettings[key]</span><br><span class="line"></span><br><span class="line">    ajaxStart(settings)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!settings.crossDomain) &#123;</span><br><span class="line">      urlAnchor = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">      urlAnchor.href = settings.url</span><br><span class="line">      <span class="comment">// cleans up URL for .href (IE only), see https://github.com/madrobby/zepto/pull/1049</span></span><br><span class="line">      urlAnchor.href = urlAnchor.href</span><br><span class="line">      settings.crossDomain = (originAnchor.protocol + <span class="string">'//'</span> + originAnchor.host) !== (urlAnchor.protocol + <span class="string">'//'</span> + urlAnchor.host)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!settings.url) settings.url = <span class="built_in">window</span>.location.toString()</span><br><span class="line">    <span class="keyword">if</span> ((hashIndex = settings.url.indexOf(<span class="string">'#'</span>)) &gt; <span class="number">-1</span>) settings.url = settings.url.slice(<span class="number">0</span>, hashIndex)</span><br><span class="line">    serializeData(settings)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dataType = settings.dataType, hasPlaceholder = <span class="regexp">/\?.+=\?/</span>.test(settings.url)</span><br><span class="line">    <span class="keyword">if</span> (hasPlaceholder) dataType = <span class="string">'jsonp'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (settings.cache === <span class="literal">false</span> || (</span><br><span class="line">         (!options || options.cache !== <span class="literal">true</span>) &amp;&amp;</span><br><span class="line">         (<span class="string">'script'</span> == dataType || <span class="string">'jsonp'</span> == dataType)</span><br><span class="line">        ))</span><br><span class="line">      settings.url = appendQuery(settings.url, <span class="string">'_='</span> + <span class="built_in">Date</span>.now())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'jsonp'</span> == dataType) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!hasPlaceholder)</span><br><span class="line">        settings.url = appendQuery(settings.url,</span><br><span class="line">          settings.jsonp ? (settings.jsonp + <span class="string">'=?'</span>) : settings.jsonp === <span class="literal">false</span> ? <span class="string">''</span> : <span class="string">'callback=?'</span>)</span><br><span class="line">      <span class="keyword">return</span> $.ajaxJSONP(settings, deferred)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mime = settings.accepts[dataType],</span><br><span class="line">        headers = &#123; &#125;,</span><br><span class="line">        setHeader = <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123; headers[name.toLowerCase()] = [name, value] &#125;,</span><br><span class="line">        protocol = <span class="regexp">/^([\w-]+:)\/\//</span>.test(settings.url) ? <span class="built_in">RegExp</span>.$<span class="number">1</span> : <span class="built_in">window</span>.location.protocol,</span><br><span class="line">        xhr = settings.xhr(),</span><br><span class="line">        nativeSetHeader = xhr.setRequestHeader,</span><br><span class="line">        abortTimeout</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deferred) deferred.promise(xhr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!settings.crossDomain) setHeader(<span class="string">'X-Requested-With'</span>, <span class="string">'XMLHttpRequest'</span>)</span><br><span class="line">    setHeader(<span class="string">'Accept'</span>, mime || <span class="string">'*/*'</span>)</span><br><span class="line">    <span class="keyword">if</span> (mime = settings.mimeType || mime) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mime.indexOf(<span class="string">','</span>) &gt; <span class="number">-1</span>) mime = mime.split(<span class="string">','</span>, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">      xhr.overrideMimeType &amp;&amp; xhr.overrideMimeType(mime)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (settings.contentType || (settings.contentType !== <span class="literal">false</span> &amp;&amp; settings.data &amp;&amp; settings.type.toUpperCase() != <span class="string">'GET'</span>))</span><br><span class="line">      setHeader(<span class="string">'Content-Type'</span>, settings.contentType || <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (settings.headers) <span class="keyword">for</span> (name <span class="keyword">in</span> settings.headers) setHeader(name, settings.headers[name])</span><br><span class="line">    xhr.setRequestHeader = setHeader</span><br><span class="line"></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">        xhr.onreadystatechange = empty</span><br><span class="line">        clearTimeout(abortTimeout)</span><br><span class="line">        <span class="keyword">var</span> result, error = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span> || (xhr.status == <span class="number">0</span> &amp;&amp; protocol == <span class="string">'file:'</span>)) &#123;</span><br><span class="line">          dataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader(<span class="string">'content-type'</span>))</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (xhr.responseType == <span class="string">'arraybuffer'</span> || xhr.responseType == <span class="string">'blob'</span>)</span><br><span class="line">            result = xhr.response</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            result = xhr.responseText</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// http://perfectionkills.com/global-eval-what-are-the-options/</span></span><br><span class="line">              <span class="comment">// sanitize response accordingly if data filter callback provided</span></span><br><span class="line">              result = ajaxDataFilter(result, dataType, settings)</span><br><span class="line">              <span class="keyword">if</span> (dataType == <span class="string">'script'</span>)    (<span class="number">1</span>,<span class="built_in">eval</span>)(result)</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (dataType == <span class="string">'xml'</span>)  result = xhr.responseXML</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (dataType == <span class="string">'json'</span>) result = blankRE.test(result) ? <span class="literal">null</span> : $.parseJSON(result)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123; error = e &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (error) <span class="keyword">return</span> ajaxError(error, <span class="string">'parsererror'</span>, xhr, settings, deferred)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          ajaxSuccess(result, xhr, settings, deferred)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ajaxError(xhr.statusText || <span class="literal">null</span>, xhr.status ? <span class="string">'error'</span> : <span class="string">'abort'</span>, xhr, settings, deferred)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ajaxBeforeSend(xhr, settings) === <span class="literal">false</span>) &#123;</span><br><span class="line">      xhr.abort()</span><br><span class="line">      ajaxError(<span class="literal">null</span>, <span class="string">'abort'</span>, xhr, settings, deferred)</span><br><span class="line">      <span class="keyword">return</span> xhr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">async</span> = <span class="string">'async'</span> <span class="keyword">in</span> settings ? settings.async : <span class="literal">true</span></span><br><span class="line">    xhr.open(settings.type, settings.url, <span class="keyword">async</span>, settings.username, settings.password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (settings.xhrFields) <span class="keyword">for</span> (name <span class="keyword">in</span> settings.xhrFields) xhr[name] = settings.xhrFields[name]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> headers) nativeSetHeader.apply(xhr, headers[name])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (settings.timeout &gt; <span class="number">0</span>) abortTimeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        xhr.onreadystatechange = empty</span><br><span class="line">        xhr.abort()</span><br><span class="line">        ajaxError(<span class="literal">null</span>, <span class="string">'timeout'</span>, xhr, settings, deferred)</span><br><span class="line">      &#125;, settings.timeout)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// avoid sending empty string (#319)</span></span><br><span class="line">    xhr.send(settings.data ? settings.data : <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> xhr</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handle optional data/success arguments</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">parseArguments</span>(<span class="params">url, data, success, dataType</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($.isFunction(data)) dataType = success, success = data, data = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">if</span> (!$.isFunction(success)) dataType = success, success = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      url: url</span><br><span class="line">    , <span class="attr">data</span>: data</span><br><span class="line">    , <span class="attr">success</span>: success</span><br><span class="line">    , <span class="attr">dataType</span>: dataType</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.<span class="keyword">get</span> = function(/* url, data, success, dataType */)&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax(parseArguments.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.post = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="regexp">/* url, data, success, dataType */</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> options = parseArguments.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    options.type = <span class="string">'POST'</span></span><br><span class="line">    <span class="keyword">return</span> $.ajax(options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.getJSON = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="regexp">/* url, data, success */</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> options = parseArguments.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    options.dataType = <span class="string">'json'</span></span><br><span class="line">    <span class="keyword">return</span> $.ajax(options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.load = <span class="function"><span class="keyword">function</span>(<span class="params">url, data, success</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>, parts = url.split(<span class="regexp">/\s/</span>), selector,</span><br><span class="line">        options = parseArguments(url, data, success),</span><br><span class="line">        callback = options.success</span><br><span class="line">    <span class="keyword">if</span> (parts.length &gt; <span class="number">1</span>) options.url = parts[<span class="number">0</span>], selector = parts[<span class="number">1</span>]</span><br><span class="line">    options.success = <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">      self.html(selector ?</span><br><span class="line">        $(<span class="string">'&lt;div&gt;'</span>).html(response.replace(rscript, <span class="string">""</span>)).find(selector)</span><br><span class="line">        : response)</span><br><span class="line">      callback &amp;&amp; callback.apply(self, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    $.ajax(options)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">escape</span> = <span class="built_in">encodeURIComponent</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">params, obj, traditional, scope</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type, array = $.isArray(obj), hash = $.isPlainObject(obj)</span><br><span class="line">    $.each(obj, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">      type = $.type(value)</span><br><span class="line">      <span class="keyword">if</span> (scope) key = traditional ? scope :</span><br><span class="line">        scope + <span class="string">'['</span> + (hash || type == <span class="string">'object'</span> || type == <span class="string">'array'</span> ? key : <span class="string">''</span>) + <span class="string">']'</span></span><br><span class="line">      <span class="comment">// handle data in serializeArray() format</span></span><br><span class="line">      <span class="keyword">if</span> (!scope &amp;&amp; array) params.add(value.name, value.value)</span><br><span class="line">      <span class="comment">// recurse into nested objects</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="string">"array"</span> || (!traditional &amp;&amp; type == <span class="string">"object"</span>))</span><br><span class="line">        serialize(params, value, traditional, key)</span><br><span class="line">      <span class="keyword">else</span> params.add(key, value)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.param = <span class="function"><span class="keyword">function</span>(<span class="params">obj, traditional</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> params = []</span><br><span class="line">    params.add = <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> ($.isFunction(value)) value = value()</span><br><span class="line">      <span class="keyword">if</span> (value == <span class="literal">null</span>) value = <span class="string">""</span></span><br><span class="line">      <span class="keyword">this</span>.push(<span class="built_in">escape</span>(key) + <span class="string">'='</span> + <span class="built_in">escape</span>(value))</span><br><span class="line">    &#125;</span><br><span class="line">    serialize(params, obj, traditional)</span><br><span class="line">    <span class="keyword">return</span> params.join(<span class="string">'&amp;'</span>).replace(<span class="regexp">/%20/g</span>, <span class="string">'+'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(Zepto)</span><br><span class="line"></span><br><span class="line"><span class="comment">// zepro的form表单处理</span></span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</span><br><span class="line">  $.fn.serializeArray = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name, type, result = [],</span><br><span class="line">      add = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value.forEach) <span class="keyword">return</span> value.forEach(add)</span><br><span class="line">        result.push(&#123; <span class="attr">name</span>: name, <span class="attr">value</span>: value &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) $.each(<span class="keyword">this</span>[<span class="number">0</span>].elements, <span class="function"><span class="keyword">function</span>(<span class="params">_, field</span>)</span>&#123;</span><br><span class="line">      type = field.type, name = field.name</span><br><span class="line">      <span class="keyword">if</span> (name &amp;&amp; field.nodeName.toLowerCase() != <span class="string">'fieldset'</span> &amp;&amp;</span><br><span class="line">        !field.disabled &amp;&amp; type != <span class="string">'submit'</span> &amp;&amp; type != <span class="string">'reset'</span> &amp;&amp; type != <span class="string">'button'</span> &amp;&amp; type != <span class="string">'file'</span> &amp;&amp;</span><br><span class="line">        ((type != <span class="string">'radio'</span> &amp;&amp; type != <span class="string">'checkbox'</span>) || field.checked))</span><br><span class="line">          add($(field).val())</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.serialize = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = []</span><br><span class="line">    <span class="keyword">this</span>.serializeArray().forEach(<span class="function"><span class="keyword">function</span>(<span class="params">elm</span>)</span>&#123;</span><br><span class="line">      result.push(<span class="built_in">encodeURIComponent</span>(elm.name) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(elm.value))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result.join(<span class="string">'&amp;'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.submit = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) <span class="keyword">this</span>.bind(<span class="string">'submit'</span>, callback)</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length) &#123;</span><br><span class="line">      <span class="keyword">var</span> event = $.Event(<span class="string">'submit'</span>)</span><br><span class="line">      <span class="keyword">this</span>.eq(<span class="number">0</span>).trigger(event)</span><br><span class="line">      <span class="keyword">if</span> (!event.isDefaultPrevented()) <span class="keyword">this</span>.get(<span class="number">0</span>).submit()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(Zepto)</span><br><span class="line"></span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// getComputedStyle shouldn't freak out when called</span></span><br><span class="line">  <span class="comment">// without a valid element as argument</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    getComputedStyle(<span class="literal">undefined</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="keyword">var</span> nativeGetComputedStyle = getComputedStyle</span><br><span class="line">    <span class="built_in">window</span>.getComputedStyle = <span class="function"><span class="keyword">function</span>(<span class="params">element, pseudoElement</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nativeGetComputedStyle(element, pseudoElement)</span><br><span class="line">      &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line">  <span class="keyword">return</span> Zepto</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript获取数据类型</title>
      <link href="/2018/11/14/javascript%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2018/11/14/javascript%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>判断js的数据类型，如：Boolean Number String等<br><a id="more"></a></p><h2 id="javascript获取数据类型"><a href="#javascript获取数据类型" class="headerlink" title="javascript获取数据类型"></a>javascript获取数据类型</h2><p>平时在工作中，偶尔会用到判断一下这个数据是什么类型，是数组的？string的？function的？我一般都直接按照代码的需求，只写了需要判断的类型，用完就丢到一边，最近在看jquery源码，人家大牛写的真不错，改一改，封装一下，自己用哈。<br>话不多说，直接贴出代码，其实很简单的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toType</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> class2type = &#123;&#125;,</span><br><span class="line">        toString = class2type.toString;</span><br><span class="line"></span><br><span class="line">    <span class="string">"Boolean Number String Function Array Date RegExp Object Error Symbol"</span></span><br><span class="line">    .split( <span class="string">" "</span> )</span><br><span class="line">    .forEach(<span class="function"><span class="keyword">function</span>(<span class="params"> name </span>) </span>&#123;</span><br><span class="line">        class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( obj == <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">return</span> obj + <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span> ?</span><br><span class="line">      class2type[ toString.call( obj ) ] || <span class="string">"object"</span> :</span><br><span class="line">      <span class="keyword">typeof</span> obj;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>代码一共没有几行，接下来看看管不管用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试一下</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'对象的类型-&gt;'</span>,toType(&#123;&#125;));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'函数的类型-&gt;'</span>,toType(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'null的类型-&gt;'</span>,toType(<span class="literal">null</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'undefined的类型-&gt;'</span>,toType(<span class="literal">undefined</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'boolean的类型-&gt;'</span>,toType(<span class="literal">true</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'number的类型-&gt;'</span>,toType(<span class="number">555</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'string的类型-&gt;'</span>,toType(<span class="string">'abc'</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'array的类型-&gt;'</span>,toType([]));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'date的类型-&gt;'</span>,toType(<span class="keyword">new</span> <span class="built_in">Date</span>()));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'正则的类型-&gt;'</span>,toType(<span class="regexp">/abc/g</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'symbol-&gt;'</span>,toType(<span class="built_in">Symbol</span>()));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Error的类型-&gt;'</span>,toType(<span class="keyword">new</span> <span class="built_in">Error</span>()));</span><br></pre></td></tr></table></figure></p><p>基本上的类型都判断出来了，不错吧。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcp三次握手和四次挥手</title>
      <link href="/2018/11/07/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"/>
      <url>/2018/11/07/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/</url>
      
        <content type="html"><![CDATA[<p>我的tcp三次握手和四次挥手简洁理解。<br><a id="more"></a></p><h2 id="tcp三次握手和四次挥手"><a href="#tcp三次握手和四次挥手" class="headerlink" title="tcp三次握手和四次挥手"></a>tcp三次握手和四次挥手</h2><p>tcp三次握手和四次挥手，这是一个很基础的计算机网络层面的基础问题，让我回答我也说不出来具体的东西，所以，为了加强记忆，按照自己的理解，把它记下来。</p><h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><p>我们用打电话的生活场景来模拟三次握手：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client: 你好，能听到我说话吗？</span><br><span class="line">server：能听到，你能听到我说话吗？</span><br><span class="line">client：是的，我也能听到你说话。</span><br></pre></td></tr></table></figure></p><p>像上面这样，来回通过3次对话，确认了双方都可以接收到相互的信息。</p><h3 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h3><p>我们还用打电话的生活场景来模拟四次挥手：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client: 我有事，不跟你聊了哈。</span><br><span class="line">server：知道了。</span><br><span class="line">server：最后说一句，明天把书给我带来。</span><br><span class="line">client：好的，知道了。</span><br></pre></td></tr></table></figure></p><p>好了，四次挥手也模拟完了。<br>我这只是模拟了这两个过程而已，如果想学习真正的原理，<a href="https://blog.csdn.net/qzcsu/article/details/72861891" target="_blank" rel="noopener">请参考这里</a></p>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js抽象语法树AST</title>
      <link href="/2018/11/06/js%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91AST/"/>
      <url>/2018/11/06/js%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91AST/</url>
      
        <content type="html"><![CDATA[<p>通过javascript parser将代码转化成抽象语法树，这棵树定义了代码本身，通过操作这颗树，可以精准的定位到赋值语句、声明语句和运算语句。<br><a id="more"></a></p><h2 id="js抽象语法树AST"><a href="#js抽象语法树AST" class="headerlink" title="js抽象语法树AST"></a>js抽象语法树AST</h2><p>最近在研究webpack，想研究一下它是如何打包的，不过，刚刚入门，就有一个知识点把我难住了，那就是AST抽象语法树。于是乎，上网查了查，原理就是把代码解析，解析成一个有各种属性状态的json树，便于对代码进行操作，具体的解析代码当然是很难的，像我们这种菜鸟只需要了解一下用法就可以了。<br>babel是现在几乎每个项目中必备的一个东西，但是其工作原理避不开对js的解析在生成的过程，babel有引擎babylon，早期fork了项目acron，了解这个之前我们先来看看这种引擎解析出来是什么东西。不光是babel还有webpack等。</p><h3 id="什么是抽象语法树"><a href="#什么是抽象语法树" class="headerlink" title="什么是抽象语法树"></a>什么是抽象语法树</h3><p>见下面例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = a + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p><p>之后我们通过这个<a href="http://esprima.org/demo/parse.html" target="_blank" rel="noopener">网站</a>，他是一个esprima引擎的网站，十分好用.画成流程图如下：<br><img src="/2018/11/06/js抽象语法树AST/astImg1.png" alt="img"><br>而他的json对象格式是这样的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"Program"</span>,</span><br><span class="line">    <span class="string">"body"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"VariableDeclaration"</span>,</span><br><span class="line">            <span class="string">"declarations"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"type"</span>: <span class="string">"VariableDeclarator"</span>,</span><br><span class="line">                    <span class="string">"id"</span>: &#123;</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Identifier"</span>,</span><br><span class="line">                        <span class="string">"name"</span>: <span class="string">"a"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"init"</span>: &#123;</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Literal"</span>,</span><br><span class="line">                        <span class="string">"value"</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="string">"raw"</span>: <span class="string">"1"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"kind"</span>: <span class="string">"var"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"VariableDeclaration"</span>,</span><br><span class="line">            <span class="string">"declarations"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"type"</span>: <span class="string">"VariableDeclarator"</span>,</span><br><span class="line">                    <span class="string">"id"</span>: &#123;</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Identifier"</span>,</span><br><span class="line">                        <span class="string">"name"</span>: <span class="string">"b"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"init"</span>: &#123;</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"BinaryExpression"</span>,</span><br><span class="line">                        <span class="string">"operator"</span>: <span class="string">"+"</span>,</span><br><span class="line">                        <span class="string">"left"</span>: &#123;</span><br><span class="line">                            <span class="string">"type"</span>: <span class="string">"Identifier"</span>,</span><br><span class="line">                            <span class="string">"name"</span>: <span class="string">"a"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="string">"right"</span>: &#123;</span><br><span class="line">                            <span class="string">"type"</span>: <span class="string">"Literal"</span>,</span><br><span class="line">                            <span class="string">"value"</span>: <span class="number">1</span>,</span><br><span class="line">                            <span class="string">"raw"</span>: <span class="string">"1"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"kind"</span>: <span class="string">"var"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"sourceType"</span>: <span class="string">"script"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="众多AST解析引擎"><a href="#众多AST解析引擎" class="headerlink" title="众多AST解析引擎"></a>众多AST解析引擎</h3><p>chrome有v8，firefix有spidermonkey.还有一些常用的引擎有：</p><ul><li>esprima</li><li>acron</li><li>Traceur</li><li>UglifyJS2</li><li>shift</li></ul><h3 id="AST的学习三板斧"><a href="#AST的学习三板斧" class="headerlink" title="AST的学习三板斧"></a>AST的学习三板斧</h3><ul><li>通过esprima生成AST</li><li>通过estraverse遍历和更新AST</li><li>通过escodegen将AST重新生成源码</li></ul><p>来一个简单例子，看看用法：<br>1.先新建一个test的工程目录<br>2.在test工程下安装esprima、estraverse、escodegen的npm模块<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i esprima estraverse escodegen --save</span><br></pre></td></tr></table></figure></p><p>3.在目录下面新建一个test.js文件,载入以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> esprima = <span class="built_in">require</span>(<span class="string">'esprima'</span>);</span><br><span class="line"><span class="keyword">let</span> code = <span class="string">'const a = 1'</span>;</span><br><span class="line"><span class="keyword">const</span> ast = esprima.parseScript(code);</span><br><span class="line"><span class="built_in">console</span>.log(ast);</span><br></pre></td></tr></table></figure></p><p>你将会看到输出结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Script &#123;</span><br><span class="line">  type: <span class="string">'Program'</span>,</span><br><span class="line">  body:</span><br><span class="line">   [ VariableDeclaration &#123;</span><br><span class="line">       type: <span class="string">'VariableDeclaration'</span>,</span><br><span class="line">       declarations: [<span class="built_in">Array</span>],</span><br><span class="line">       kind: <span class="string">'const'</span> &#125; ],</span><br><span class="line">  sourceType: <span class="string">'script'</span> &#125;</span><br></pre></td></tr></table></figure></p><p>4.再在test文件中，载入以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> estraverse = <span class="built_in">require</span>(<span class="string">'estraverse'</span>);</span><br><span class="line"></span><br><span class="line">estraverse.traverse(ast, &#123;</span><br><span class="line">    enter: <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">        node.kind = <span class="string">"var"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(ast);</span><br></pre></td></tr></table></figure></p><p>输出的结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Script &#123;</span><br><span class="line">  type: <span class="string">'Program'</span>,</span><br><span class="line">  body:</span><br><span class="line">   [ VariableDeclaration &#123;</span><br><span class="line">       type: <span class="string">'VariableDeclaration'</span>,</span><br><span class="line">       declarations: [<span class="built_in">Array</span>],</span><br><span class="line">       kind: <span class="string">'var'</span> &#125; ],</span><br><span class="line">  sourceType: <span class="string">'script'</span> &#125;</span><br></pre></td></tr></table></figure></p><p>5.最后在test文件中，加入以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> escodegen = <span class="built_in">require</span>(<span class="string">"escodegen"</span>);</span><br><span class="line"><span class="keyword">const</span> transformCode = escodegen.generate(ast)</span><br><span class="line"><span class="built_in">console</span>.log(transformCode);</span><br></pre></td></tr></table></figure></p><p>输出的结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p><p>通过这三步，我们将const a = 1转化成了var a = 1</p><p>虽然，具体的解析原理我们并不知道，但是，通过这三个模块包，是不是有种自己搞出一个babel的赶脚。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>对象链式取值(如loadsh的_.get()方法)在项目中的应用</title>
      <link href="/2018/11/05/%E5%AF%B9%E8%B1%A1%E9%93%BE%E5%BC%8F%E5%8F%96%E5%80%BC-%E5%A6%82loadsh%E7%9A%84-get-%E6%96%B9%E6%B3%95-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
      <url>/2018/11/05/%E5%AF%B9%E8%B1%A1%E9%93%BE%E5%BC%8F%E5%8F%96%E5%80%BC-%E5%A6%82loadsh%E7%9A%84-get-%E6%96%B9%E6%B3%95-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>对象的链式取值在项目中的应用场景。<br><a id="more"></a></p><h2 id="对象链式取值-如loadsh的-get-方法-在项目中的应用"><a href="#对象链式取值-如loadsh的-get-方法-在项目中的应用" class="headerlink" title="对象链式取值(如loadsh的_.get()方法)在项目中的应用"></a>对象链式取值(如loadsh的_.get()方法)在项目中的应用</h2><p>相信大家在从后端获取数据的时候，像这样res.data.rows.count来获取数据的情况很多，如果后台返回的格式不对了，或则data是个null，那么很容易报<strong>Uncaught TypeError: Cannot read property ‘goods’ of undefined</strong>这样的错。<br>我们一般会这样写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(res &amp;&amp; res.data &amp;&amp; res.data.rows &amp;&amp; res.data.count) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>不过这么写实在是有些麻烦，我一般的做法是直接catch住error，然后定位到具体错误在哪，在改正。<br>不过，最近在网上看到一篇专门写关于对象的链式取值的文章，里边写了大概4种解决方法，这里我只记录学习了其中一种，也是兼容性最好的一种，就想使用loadsh的_.get方法，先看看loadsh是怎么用的，见下边<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object = &#123; <span class="string">'a'</span>: [&#123; <span class="string">'b'</span>: &#123; <span class="string">'c'</span>: <span class="number">3</span> &#125; &#125;] &#125;;</span><br><span class="line">_.get(object, <span class="string">'a[0].b.c'</span>);</span><br><span class="line"><span class="comment">// =&gt; 3</span></span><br><span class="line">_.get(object, [<span class="string">'a'</span>, <span class="string">'0'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]);</span><br><span class="line"><span class="comment">// =&gt; 3</span></span><br><span class="line">_.get(object, <span class="string">'a.b.c'</span>, <span class="string">'default'</span>);</span><br><span class="line"><span class="comment">// =&gt; 'default'</span></span><br></pre></td></tr></table></figure></p><p>使用方法一目了然，第一个参数：对象，第二个参数：链式字符串，第三个参数是，如果按照这个链式字符串在对象中取不到值，返回这个默认值。这样写的话，就像上边即使后台同事更改了数据结构，不会报错，而是返回默认值。（不过这种写法我觉得也有不好的地方，那就是不容易发现错误，后台返回的数据结构都变了，而我们前台并没有出现异常，而是返回来初始写的默认值，是不是有点。。。）不过，这种写法在其它场合我想一定会有用武之地。<br>我现在的项目中并没有用到loadsh这个库，但是还想用咋办呢？自己写一个喽，还好，写法简单，容易理解，注意，下边给出的代码交通过函数解析字符串方式来处理的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span> (<span class="params">obj, props, def</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((obj == <span class="literal">null</span>) || obj == <span class="literal">null</span> || <span class="keyword">typeof</span> props !== <span class="string">'string'</span>) <span class="keyword">return</span> def;</span><br><span class="line">    <span class="keyword">const</span> temp = props.split(<span class="string">'.'</span>);</span><br><span class="line">    <span class="keyword">const</span> fieldArr = [].concat(temp);</span><br><span class="line">    temp.forEach(<span class="function">(<span class="params">e, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/^(\w+)\[(\w+)\]$/</span>.test(e)) &#123;</span><br><span class="line">            <span class="keyword">const</span> matchs = e.match(<span class="regexp">/^(\w+)\[(\w+)\]$/</span>);</span><br><span class="line">            <span class="keyword">const</span> field1 = matchs[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">const</span> field2 = matchs[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">const</span> index = fieldArr.indexOf(e);</span><br><span class="line">            fieldArr.splice(index, <span class="number">1</span>, field1, field2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> fieldArr.reduce(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> target = pre[cur] || def;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(target <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [].concat(target);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(target <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, target)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;, obj)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c = &#123;<span class="attr">a</span>: &#123;<span class="attr">b</span> : [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] &#125;&#125;</span><br><span class="line"><span class="keyword">get</span>(c ,'a.b')     // [1,2,3]</span><br><span class="line"><span class="keyword">get</span>(c, 'a.b[1]')  // 2</span><br><span class="line"><span class="keyword">get</span>(c, 'a.d', 12)  // 12</span><br></pre></td></tr></table></figure></p><p>其实，在项目无论如何使用都没什么问题，即使什么都不做，最后项目完成时，也一定会因为出现报错而改正过来，最多就是不够健壮。我觉得这个函数解析字符串的方式很好，值得举一反三，值得学习。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack打包bundle.js文件代码分析</title>
      <link href="/2018/11/01/webpack%E6%89%93%E5%8C%85bundle-js%E6%96%87%E4%BB%B6%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/"/>
      <url>/2018/11/01/webpack%E6%89%93%E5%8C%85bundle-js%E6%96%87%E4%BB%B6%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>webpack这个打包工具，现在可以说很火，前一段时间为了优化公司项目，搞了一个月的gulp，说实在的，gulp的功能我感觉很强大了，而且用起来很灵活，最关键是简单，需要什么的时候直接弄个gulp任务，但是，使用场景很少了，由于之前的项目是php的，现在一般都用vue，react等，都已经集成了webpack，虽然说不用太多配置，但是需要配置的时候还是有的，所以，webpack研究一下也是有必要的，今天，复杂的先不说，只说说bundle.js这个文件里的代码都是干吗用的。<br><a id="more"></a></p><h2 id="webpack打包bundle-js文件代码分析"><a href="#webpack打包bundle-js文件代码分析" class="headerlink" title="webpack打包bundle.js文件代码分析"></a>webpack打包bundle.js文件代码分析</h2><h3 id="一个入口，一个文件"><a href="#一个入口，一个文件" class="headerlink" title="一个入口，一个文件"></a>一个入口，一个文件</h3><p>首先，webpack.config.js配置文件是这样滴：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry:<span class="string">'./index.js'</span>,</span><br><span class="line">  output:&#123;</span><br><span class="line">    filename:<span class="string">'bundle.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>index.js内容是这样滴：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'index'</span>);</span><br></pre></td></tr></table></figure></p><p>最后再看看打完包后的bundle.js内容<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bundle.js</span></span><br><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// The module cache</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// The require function</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>        <span class="comment">// Check if module is in cache</span></span><br><span class="line"><span class="comment">/******/</span>        <span class="keyword">if</span>(installedModules[moduleId])</span><br><span class="line"><span class="comment">/******/</span>            <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>        <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line"><span class="comment">/******/</span>        <span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line"><span class="comment">/******/</span>            exports: &#123;&#125;,</span><br><span class="line"><span class="comment">/******/</span>            id: moduleId,</span><br><span class="line"><span class="comment">/******/</span>            loaded: <span class="literal">false</span></span><br><span class="line"><span class="comment">/******/</span>        &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>        <span class="comment">// Execute the module function</span></span><br><span class="line"><span class="comment">/******/</span>        modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>        <span class="comment">// Flag the module as loaded</span></span><br><span class="line"><span class="comment">/******/</span>        <span class="built_in">module</span>.loaded = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>        <span class="comment">// Return the exports of the module</span></span><br><span class="line"><span class="comment">/******/</span>        <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line"><span class="comment">/******/</span>    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// expose the modules object (__webpack_modules__)</span></span><br><span class="line"><span class="comment">/******/</span>    __webpack_require__.m = modules;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// expose the module cache</span></span><br><span class="line"><span class="comment">/******/</span>    __webpack_require__.c = installedModules;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// __webpack_public_path__</span></span><br><span class="line"><span class="comment">/******/</span>    __webpack_require__.p = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// Load entry module and return exports</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="keyword">return</span> __webpack_require__(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> <span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'index'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br></pre></td></tr></table></figure></p><p>我们来分析一下bundle.js这个文件</p><ul><li>1.整个内容是一个自执行函数，自执行函数传的参数是一个数组，数组里的元素是function函数，这个函数体的内容就是index.js文件的内容。</li><li>2.在这个闭包函数中，__webpack_require_是模块加载函数，接收模块id（对，webpack中每个模块都会有一个独一无二的id，其实也就是在IIFE传参数组中的索引值（0，1，2…..）。</li><li>3.真正执行module index里面语句的是个调用<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Execute the module function</span></span><br><span class="line">modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br></pre></td></tr></table></figure></li></ul><p>我们再来看一个例子</p><h3 id="一个入口，两个文件，A依赖B"><a href="#一个入口，两个文件，A依赖B" class="headerlink" title="一个入口，两个文件，A依赖B"></a>一个入口，两个文件，A依赖B</h3><p>先贴出文件内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line"></span><br><span class="line">b.b1();</span><br></pre></td></tr></table></figure></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.js</span></span><br><span class="line">exports.b1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'b1'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.b2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'b2'</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bundle.js</span></span><br><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">// 省略一大段...........</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// Load entry module and return exports</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="keyword">return</span> __webpack_require__(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> <span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b = __webpack_require__(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line"></span><br><span class="line">    b.b1();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;,</span><br><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="comment">/***/</span> <span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    exports.b1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'b1'</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exports.b2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'b2'</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br></pre></td></tr></table></figure><p>我们再来分析一下上面的代码。</p><ul><li>1.由于有两个文件，所以IIFE得参数为长度是2的数组，并按照require的顺序排列。</li><li>2.IIFE函数体部分是一模一样的，也就是说再复杂的，多个依赖的文件，函数体部分也不变滴。</li><li><p>3.module a发生了变化，因为a依赖b，所以在a中调用webpack加载模块的函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1是模块b的id</span></span><br><span class="line"><span class="keyword">var</span> b = __webpack_require__(<span class="number">1</span>);</span><br></pre></td></tr></table></figure></li><li><p>4.我们再来分析一下modules[moduleId].call(module.exports, module, module.exports, <strong>webpack_require</strong>);<br>使用call是因为为了确保每个module中的this指向的是module本身。然后给它传__webpack_require函数是想让module有加载其他module的能力。</p><h3 id="其它情况"><a href="#其它情况" class="headerlink" title="其它情况"></a>其它情况</h3><p>其它的情况，比如多入口，多出口情况这里就不做过多分析，我也没搞明白，接下来准备手写一个简单的仿webpack打包工具。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端webview模板</title>
      <link href="/2018/10/30/%E7%A7%BB%E5%8A%A8%E7%AB%AFwebview%E6%A8%A1%E6%9D%BF/"/>
      <url>/2018/10/30/%E7%A7%BB%E5%8A%A8%E7%AB%AFwebview%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<p>移动端的页面平时偶尔会有需求需要做，特别是webview嵌入的页面居多，由于是有时候做，有时候不做，所以，需求来的时候从新写页面还是有点麻烦，所以把之前写的记录一下，下次直接copy就好了。<br><a id="more"></a></p><h2 id="移动端webview模板"><a href="#移动端webview模板" class="headerlink" title="移动端webview模板"></a>移动端webview模板</h2><h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><p>一些css初始化的内容<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">"utf-8"</span>;</span><br><span class="line"><span class="comment">/* CSS Document */</span></span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">ol</span>,<span class="selector-tag">p</span>,<span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">dl</span>,<span class="selector-tag">dd</span>,<span class="selector-tag">form</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,</span><br><span class="line"><span class="selector-tag">td</span>,<span class="selector-tag">th</span>,<span class="selector-tag">button</span>,<span class="selector-tag">strong</span>,<span class="selector-tag">em</span>,<span class="selector-tag">select</span>,<span class="selector-tag">video</span>,<span class="selector-tag">canvas</span>&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>&#123; <span class="attribute">font-weight</span>:normal;&#125;</span><br><span class="line"><span class="selector-tag">li</span>&#123;<span class="attribute">list-style</span>:none;<span class="attribute">vertical-align</span>:top;&#125;</span><br><span class="line"><span class="selector-tag">table</span>&#123; <span class="attribute">border-collapse</span>:collapse;&#125;</span><br><span class="line"><span class="selector-tag">textarea</span>&#123;<span class="attribute">resize</span>:none;<span class="attribute">overflow</span>:auto;&#125;</span><br><span class="line"><span class="selector-tag">img</span>&#123; <span class="attribute">border</span>:none; <span class="attribute">vertical-align</span>:middle; <span class="attribute">width</span>:<span class="number">100%</span>;&#125;</span><br><span class="line"><span class="selector-tag">em</span>,<span class="selector-tag">i</span>&#123; <span class="attribute">font-style</span>:normal;&#125;</span><br><span class="line"><span class="selector-tag">a</span>&#123; <span class="attribute">text-decoration</span>:none;&#125;</span><br><span class="line"><span class="selector-tag">a</span>,<span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">-webkit-appearance</span>: none;<span class="comment">/*屏蔽阴影*/</span></span><br><span class="line">    <span class="attribute">-webkit-tap-highlight-color</span>:<span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*ios android去除自带阴影的样式*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>, <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="comment">/* 禁止长按链接与图片弹出菜单 */</span></span><br><span class="line">    <span class="attribute">-webkit-touch-callout</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="comment">/* 禁止选中文本(如无文本选中需求,此为必选项) */</span></span><br><span class="line">    <span class="attribute">-webkit-user-select</span>: none;  </span><br><span class="line">    <span class="attribute">user-select</span>: none;</span><br><span class="line"> <span class="attribute">background</span>:<span class="number">#f5f5f5</span>;</span><br><span class="line"> <span class="attribute">overflow-x</span>:hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="js来控制rem大小代码"><a href="#js来控制rem大小代码" class="headerlink" title="js来控制rem大小代码"></a>js来控制rem大小代码</h3><p>js来修改html的font-size大小<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">doc, win</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> docEl = doc.documentElement,</span><br><span class="line">resizeEvt = <span class="string">'orientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">'orientationchange'</span> : <span class="string">'resize'</span>,</span><br><span class="line">recalc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clientWidth = docEl.clientWidth;</span><br><span class="line">  <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span><br><span class="line">  docEl.style.fontSize = clientWidth/<span class="number">20</span> + <span class="string">'px'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (!doc.addEventListener) <span class="keyword">return</span>;</span><br><span class="line">win.addEventListener(resizeEvt, recalc, <span class="literal">false</span>);</span><br><span class="line">doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, recalc, <span class="literal">false</span>);</span><br><span class="line">&#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>);</span><br></pre></td></tr></table></figure></p><h3 id="html页面内容"><a href="#html页面内容" class="headerlink" title="html页面内容"></a>html页面内容</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"email=no"</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-status-bar-style"</span> <span class="attr">content</span>=<span class="string">"black"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../js/config.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 判断ios android</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> u = navigator.userAgent;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> isAndroid = u.indexOf(<span class="string">'Android'</span>) &gt; <span class="number">-1</span> || u.indexOf(<span class="string">'Adr'</span>) &gt; <span class="number">-1</span>; <span class="comment">//android终端</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> isiOS = !!u.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>); <span class="comment">//ios终端</span></span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> goodsId = <span class="built_in">window</span>.location.search.split(<span class="string">'='</span>)[<span class="number">1</span>] </span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> reqUrl = BASEURL +<span class="string">'/goods/shopProduct/findSpuDescsBySpuId/'</span> + goodsId;</span></span><br><span class="line"><span class="javascript">    $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">        method: <span class="string">'POST'</span>,</span></span><br><span class="line">        url: reqUrl,</span><br><span class="line">        headers: &#123;</span><br><span class="line"><span class="javascript">              <span class="string">'client-token'</span>: <span class="string">'eyJhbGciOiJIUzUxMiJ9.eyJ1aWQiOiIxMjMiLCJjZXJ0Tm8iOiI0NTYifQ.xTR4SG0z3Nuf-siW34XtVgqNPr9PRpPb8XFKY6Hrj_Qg8kl9C0AeVFcQ8NnguQ-SrlHHcv5M16SkjVYX3PKweg'</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        data: &#123;goodsId: goodsId&#125;,</span><br><span class="line"><span class="javascript">        dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">        success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(res.code === <span class="string">'0000'</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> innerContent = res.data;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> bodyContent = $.parseHTML(innerContent);</span></span><br><span class="line"><span class="javascript">                $(<span class="string">'.content'</span>).append(bodyContent);</span></span><br><span class="line">                if(isiOS) &#123;</span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> imgNum = $(<span class="string">'img'</span>).size(), loadCount=<span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'img'</span>).on(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span></span><br><span class="line">                        loadCount++;</span><br><span class="line">                        if(loadCount === imgNum)&#123;</span><br><span class="line"><span class="javascript">                            <span class="comment">// 获取到页面高度返给ios端</span></span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> bodyHeight = $(<span class="string">'body'</span>).height() + <span class="number">25</span>;</span></span><br><span class="line"><span class="javascript">                            <span class="comment">// 调取ios注入的方法</span></span></span><br><span class="line"><span class="javascript">                            <span class="built_in">window</span>.webkit.messageHandlers.jsCallNative.postMessage(&#123;<span class="attr">height</span>: bodyHeight&#125;);</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个webview页面相对麻烦些，需求是在ios页面的固定位置显示webview内容，并不是新开一个新页面来整个显示webview内容，这样ios需要获取h5页面的高，而页面的内容又是h5页面通过ajax获取回来的，所以，ajax请求成功后，将内容插入到页面中，如果有图片的话，等待图片全部加载之后再计算页面的高，返给ios。这时，ios提供了一个函数注入到h5页面里了，我们直接调用就可以，代码中就是这个函数window.webkit.messageHandlers.jsCallNative.postMessage();</p><ul><li>补充点这方面的知识2019/2/2<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(isiOS) &#123; // 如果是ios的话</span><br><span class="line">window.webkit.messageHandlers.iosCallback.postMessage(null); // 我告诉ios端可以调我提供的callAppFnInfo函数，它会把值给我传过来。</span><br><span class="line">function callAppFnInfo(info) &#123;</span><br><span class="line">        alert(info);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else &#123; // android环境</span><br><span class="line">var da = window.WebViewInterface.getId(); // 直接调取android提供的方法，它可以直接返回值</span><br><span class="line">alert(da);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js基础知识思维导图</title>
      <link href="/2018/10/29/js%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/"/>
      <url>/2018/10/29/js%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<p>在网上无意间发现了一套js基础的思维导图，赶紧收为己用，呵呵。<br><a id="more"></a></p><h2 id="js基础知识思维导图"><a href="#js基础知识思维导图" class="headerlink" title="js基础知识思维导图"></a>js基础知识思维导图</h2><h4 id="1-变量"><a href="#1-变量" class="headerlink" title="1.变量"></a>1.变量</h4><p><img src="/2018/10/29/js基础知识思维导图/变量.gif" alt="img"></p><h4 id="2-数组"><a href="#2-数组" class="headerlink" title="2.数组"></a>2.数组</h4><p><img src="/2018/10/29/js基础知识思维导图/数组.gif" alt="img"></p><h4 id="3-运算符"><a href="#3-运算符" class="headerlink" title="3.运算符"></a>3.运算符</h4><p><img src="/2018/10/29/js基础知识思维导图/运算符.gif" alt="img"></p><h4 id="4-流程语句"><a href="#4-流程语句" class="headerlink" title="4.流程语句"></a>4.流程语句</h4><p><img src="/2018/10/29/js基础知识思维导图/流程语句.gif" alt="img"></p><h4 id="5-函数基础"><a href="#5-函数基础" class="headerlink" title="5.函数基础"></a>5.函数基础</h4><p><img src="/2018/10/29/js基础知识思维导图/函数基础.gif" alt="img"></p><h4 id="6-字符串函数"><a href="#6-字符串函数" class="headerlink" title="6.字符串函数"></a>6.字符串函数</h4><p><img src="/2018/10/29/js基础知识思维导图/字符串函数.gif" alt="img"></p><h4 id="7-基本dom操作"><a href="#7-基本dom操作" class="headerlink" title="7.基本dom操作"></a>7.基本dom操作</h4><p><img src="/2018/10/29/js基础知识思维导图/基本dom操作.gif" alt="img"></p><h4 id="8-浏览器Bom对象"><a href="#8-浏览器Bom对象" class="headerlink" title="8.浏览器Bom对象"></a>8.浏览器Bom对象</h4><p><img src="/2018/10/29/js基础知识思维导图/浏览器Bom对象.jpg" alt="img"></p><h4 id="9-正则表达式"><a href="#9-正则表达式" class="headerlink" title="9.正则表达式"></a>9.正则表达式</h4><p><img src="/2018/10/29/js基础知识思维导图/正则表达式.gif" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js类的继承(ES5写法)</title>
      <link href="/2018/10/23/js%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF-ES5%E5%86%99%E6%B3%95/"/>
      <url>/2018/10/23/js%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF-ES5%E5%86%99%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>js继承之终极继承寄生组合式继承<br><a id="more"></a></p><h2 id="js类的继承-ES5写法"><a href="#js类的继承-ES5写法" class="headerlink" title="js类的继承(ES5写法)"></a>js类的继承(ES5写法)</h2><p>js的继承方式有很多，大致的罗列一下：</p><ul><li>构造继承</li><li>原型链继承</li><li>组合继承</li><li>原型式继承</li><li>寄生式继承</li><li>寄生组合式继承<br>这里只是列举了一些，还有很多其它方法，就不一一写出。<br>在这些方法中，寄生组合式继承被认为是最好的，所以，只要记住这一种写法不就可以了吗。<br>寄生组合式继承代码如下：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inherits</span>(<span class="params">Child, Parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    F.prototype = Parent.prototype;</span><br><span class="line">    Child.prototype = <span class="keyword">new</span> F();</span><br><span class="line">    Child.prototype.constructor = Child;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = props.name || <span class="string">'Unnamed'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    Student.call(<span class="keyword">this</span>, props);</span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现原型继承链:</span></span><br><span class="line">inherits(PrimaryStudent, Student);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定其他方法到PrimaryStudent原型:</span></span><br><span class="line">PrimaryStudent.prototype.getGrade = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.grade;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实现call函数</title>
      <link href="/2018/10/19/%E5%AE%9E%E7%8E%B0call%E5%87%BD%E6%95%B0/"/>
      <url>/2018/10/19/%E5%AE%9E%E7%8E%B0call%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>自己实现call函数<br><a id="more"></a></p><h2 id="实现call函数"><a href="#实现call函数" class="headerlink" title="实现call函数"></a>实现call函数</h2><p>实现代码很简单，直接贴出来<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myCall = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">arguments</span>, str=<span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;args.length; i++) &#123;</span><br><span class="line">    str += (args[i]+<span class="string">','</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> newStr = str.slice(<span class="number">0</span>,(str.length<span class="number">-1</span>));</span><br><span class="line">  <span class="built_in">eval</span>(<span class="string">'context.fn('</span>+newStr+<span class="string">')'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+a+b);</span><br><span class="line">&#125;</span><br><span class="line">abc.myCall(&#123;</span><br><span class="line">  name: <span class="string">'join'</span></span><br><span class="line">&#125;,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">abc.myCall(&#123;</span><br><span class="line">  name: <span class="string">'mike'</span></span><br><span class="line">&#125;,<span class="number">3</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ajax跨域请求自定义header字段问题</title>
      <link href="/2018/10/16/ajax%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82%E8%87%AA%E5%AE%9A%E4%B9%89header%E5%AD%97%E6%AE%B5%E9%97%AE%E9%A2%98/"/>
      <url>/2018/10/16/ajax%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82%E8%87%AA%E5%AE%9A%E4%B9%89header%E5%AD%97%E6%AE%B5%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>Access-Control-Allow-Headers 列表中不存在请求标头 XXXXXX的处理办法<br><a id="more"></a></p><h2 id="ajax跨域请求自定义header字段问题"><a href="#ajax跨域请求自定义header字段问题" class="headerlink" title="ajax跨域请求自定义header字段问题"></a>ajax跨域请求自定义header字段问题</h2><p>首先，在后端允许跨域请求的情况下，前端加上自定义的请求字段，如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">        method: <span class="string">'POST'</span>,</span><br><span class="line">        url: reqUrl,</span><br><span class="line">        headers: &#123;</span><br><span class="line">              <span class="string">'client-token'</span>: <span class="string">'123456'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        data: &#123;<span class="attr">goodsId</span>: goodsId&#125;,</span><br><span class="line">        dataType: <span class="string">'json'</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p><p>客户端 按照上面的写，你需要处理的是 服务端 响应头的设置</p><h3 id="1-第一步"><a href="#1-第一步" class="headerlink" title="1.第一步"></a>1.第一步</h3><p>设置响应头<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">'Access-Control-Allow-Origin:*'</span>);  <span class="comment">//支持全域名访问，不安全，部署后需要固定限制为客户端网址</span></span><br><span class="line">header(<span class="string">'Access-Control-Allow-Methods:POST,GET,OPTIONS,DELETE'</span>); <span class="comment">//支持的http 动作</span></span><br><span class="line">header(<span class="string">'Access-Control-Allow-Headers:x-requested-with,content-type'</span>);  <span class="comment">//响应头 请按照自己需求添加。</span></span><br></pre></td></tr></table></figure></p><h3 id="2-第二步"><a href="#2-第二步" class="headerlink" title="2.第二步"></a>2.第二步</h3><p>了解IE chrome 等浏览器 对于 跨域请求并要求设置Headers自定义参数的时候的 “预请求”   就是如果遇到 跨域并设置headers的请求，所有请求需要两步完成！<br>A 第一步：发送预请求 OPTIONS 请求。此时 服务器端需要对于OPTIONS请求作出响应 一般使用202响应即可 不用返回任何内容信息。（能看到这份手稿的人，本人不相信你后台处理不了一个options请求）<br>B 第二步：服务器accepted 第一步请求后 浏览器自动执行第二步 发送真正的请求。此时 大多数人 会发现请求成功了，但是 有那么几个人会发现 请求成功了但是没有任何信息返回 why？因为你自定义的请求头在服务器响应中不存在！<br>查看console输出 会发现一个问题：<br>“Access-Control-Allow-Headers 列表中不存在请求标头 XXXXXX”【IE】，<br>request header field xxxxxx is not allowed by Access-Control-Allow-Header【chrome】<br>这是因为 你的XXXX请求头 没有在服务器端被允许哦~<br>遇到这个问题 只有通过修改服务器端来完成，举例：需要设置 client-token这么一个自定义头，那么 你需要在 服务端里面 将header(‘Access-Control-Allow-Headers:x-requested-with,content-type，client-token’);  同学们自行体会吧 这种语法就是根据“,”分割 自己需要设置什么头，必须要在 服务端请求的响应头里面设置好，不然客户端永远永远提交不上去！<br>至此  JavaScript/ajax  跨域+ 修改httpheader 任务完美实现。<br>“人们都一直在抱怨 JavaScript同源策略限制了web前端的发展！然而是服务端做的不够细致！”</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scratch介绍</title>
      <link href="/2018/10/11/scratch%E4%BB%8B%E7%BB%8D/"/>
      <url>/2018/10/11/scratch%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>少儿编程神器scratch简单介绍<br><a id="more"></a></p><h2 id="scratch介绍"><a href="#scratch介绍" class="headerlink" title="scratch介绍"></a>scratch介绍</h2><p>scratch是一款儿童学习编程的软件，把具体的一些控制语句以图形的形式表现出来，可以用鼠标来拖动，很生动，简单，不理解编程的孩子们容易学习，本人也是刚刚接触学习scratch，跟孩子们一样需要重头来学习，因为我想做一名少儿编程启蒙老师。<br>先把scratch的网址贴出来：<br><a href="https://scratch.mit.edu/" target="_blank" rel="noopener">scratch官网</a></p><h3 id="安装scratch"><a href="#安装scratch" class="headerlink" title="安装scratch"></a>安装scratch</h3><h4 id="在线免安装"><a href="#在线免安装" class="headerlink" title="在线免安装"></a>在线免安装</h4><p>首页点击try it out就进入在线页面玩耍了。<br><img src="/2018/10/11/scratch介绍/1.png" alt="img"></p><h4 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h4><p>首页的footer位置，support下有Offline Editor连接，<a href="https://scratch.mit.edu/download" target="_blank" rel="noopener">也可以点这里</a><br>之后见下图位置可以下载安装了<br><img src="/2018/10/11/scratch介绍/2.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 少儿编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scratch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编译与解释</title>
      <link href="/2018/10/10/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%A7%A3%E9%87%8A/"/>
      <url>/2018/10/10/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<p>编译与解释的介绍<br><a id="more"></a></p><h2 id="编译与解释"><a href="#编译与解释" class="headerlink" title="编译与解释"></a>编译与解释</h2><h3 id="什么是编译器"><a href="#什么是编译器" class="headerlink" title="什么是编译器"></a>什么是编译器</h3><p>编译器是一种计算机程序，负责把一种编程语言编写的源码转换成另外一种计算机代码，后者往往是以二进制的形式被称为目标代码(object code)。这个转换的过程通常的目的是生成可执行的程序。<br><br>编译器的产出是「另外一种代码」，然后这些代码等着被别人拿来执行，如果还不能直接被执行，那么还需要再编译或解释一遍，再交由计算机硬件执行。<br>编译器，往往是在「执行」之前完成，产出是一种可执行或需要再编译或者解释的「代码」。</p><h3 id="什么是解释器"><a href="#什么是解释器" class="headerlink" title="什么是解释器"></a>什么是解释器</h3><p>在计算机科学中，解释器是一种计算机程序，它直接执行由编程语言或脚本语言编写的代码，并不会把源代码预编译成机器码。一个解释器，通常会用以下的姿势来执行程序代码：<br><br>1.分析源代码，并且直接执行。<br>2.把源代码翻译成相对更加高效率的中间码，然后立即执行它。<br>3.执行由解释器内部的编译器预编译后保存的代码<br>可以把解释器看成一个黑盒子，我们输入源码，它就会实时返回结果。<br>不同类型的解释器，黑盒子里面的构造不一样，有些还会集成编译器，缓存编译结果，用来提高执行效率（例如 Chrome V8 也是这么做的）。<br>解释器通常是工作在「运行时」，并且对于我们输入的源码，是一行一行的解释然后执行，然后返回结果。</p><h3 id="分两个维度比较一下"><a href="#分两个维度比较一下" class="headerlink" title="分两个维度比较一下"></a>分两个维度比较一下</h3><h4 id="表现-Behavior"><a href="#表现-Behavior" class="headerlink" title="表现 Behavior"></a>表现 Behavior</h4><ul><li>编译器把源代码转换成其他的更低级的代码(例如二进制码、机器码)，但是不会执行它。</li><li>解释器会读取源代码，并且直接生成指令让计算机硬件执行，不会输出另外一种代码。</li></ul><h4 id="性能-Performance"><a href="#性能-Performance" class="headerlink" title="性能 Performance"></a>性能 Performance</h4><ul><li>编译器会事先用比较多的时间把整个程序的源代码编译成另外一种代码，后者往往较前者更加接近机器码，所以执行的效率会更加高。时间是消耗在预编译的过程中。</li><li>解释器会一行一行的读取源代码，解释，然后立即执行。这中间往往使用相对简单的词法分析、语法分析，压缩解释的时间，最后生成机器码，交由硬件执行。解释器适合比较低级的语言。但是相对于预编译好的代码，效率往往会更低。如何减少解释的次数和复杂性，是提高解释器效率的难题。</li></ul><h3 id="关于代码，需要知道的几个概念"><a href="#关于代码，需要知道的几个概念" class="headerlink" title="关于代码，需要知道的几个概念"></a>关于代码，需要知道的几个概念</h3><p>在看了不少不多关于「编译和解释」的文章之后，我发现下面的词汇是大量出现的。<br>知道这些词汇代表的意思，以及对应的层次，能够更好地看懂别人所要表达的意思。</p><h4 id="高级语言代码-High-Level-Code"><a href="#高级语言代码-High-Level-Code" class="headerlink" title="高级语言代码 High-Level Code"></a>高级语言代码 High-Level Code</h4><p>高级语言代码，自然是指由高级编程语言编写代码，对计算机的细节有更高层次的抽象。<br>相对于低级编程语言（low-level programming language）更接近自然语言（人类的语言）。<br>集成一系列的自动工具（垃圾回收，内存管理等），会让程序员延长寿命，更快乐的编写出更简洁，更易读的程序代码。</p><h4 id="低级语言代码-Low-Level-Code"><a href="#低级语言代码-Low-Level-Code" class="headerlink" title="低级语言代码 Low-Level Code"></a>低级语言代码 Low-Level Code</h4><p>低级语言代码，指由低级编程语言编写的代码，相对高级语言，少了更多的抽象概念，更加接近于汇编或者机器指令。<br>但是这也意味着代码的可移植性很差。<br>在我看来，高与低，只是一组相对词而已。<br>越高级的语言，性能、自由度越不及低级语言。<br>但是在抽象、可读可写性、可移植性越比低级语言优秀。<br>在以前的年代，C/C++语言相对汇编语言，机器指令来说，肯定是高级语言。<br>而到了今天，我们更多人对C语言偏向认知为「低级语言」。<br>或许未来世界的开发者，看我们现在所熟悉的Java、PHP、Python、ECMAScript等等，都是「low」到爆的语言。</p><h4 id="汇编语言-Assembly-Language"><a href="#汇编语言-Assembly-Language" class="headerlink" title="汇编语言 Assembly Language"></a>汇编语言 Assembly Language</h4><p>汇编语言作为一门低级语言，对应于计算机或者其他可编程的硬件。<br>它和计算机的体系结构以及机器指令是强关联的。<br>换句话说，就是不同的汇编语言代码对应特定的硬件，所以不用谈可移植性了。<br>相对于需要编译和解释的高级语言代码来说，汇编代码只需要翻译成机器码就可以执行了。<br>所以汇编语言也往往被称作象征性机器码(symbolic machine code)</p><h4 id="字节码-Byte-Code"><a href="#字节码-Byte-Code" class="headerlink" title="字节码 Byte Code"></a>字节码 Byte Code</h4><p>字节码严格来说不算是编程语言，而是高级编程语言为了种种需求（可移植性、可传输性、预编译等）而产生的中间码（Intermediate Code）。<br>它是由一堆指令集组成的代码，例如在javac编译过后的java源码产生的就是字节码。<br>源码在编译的过程中，是需要进行「词法分析 → 语法分析 → 生成目标代码」等过程的，在预编译的过程中，就完成这部分工作，生成字节码。<br>然后在后面交由解释器（这里通常指编程语言的虚拟机）解释执行，省去前面预编译的开销。</p><h4 id="机器码-Machine-Code"><a href="#机器码-Machine-Code" class="headerlink" title="机器码 Machine Code"></a>机器码 Machine Code</h4><p>机器码是一组可以直接被CPU执行的指令集，<br>每一条指令都代表一个特定的任务，或者是加载，或者是跳转，亦或是计算操作等等。<br>所有可以直接被CPU执行的程序，都是由这么一系列的指令组成的。<br>机器码可是看作是编译过程中，最低级的代码，因外再往下就是交由硬件来执行了。<br>当然机器码也是可以被编辑的，但是以人类难以看懂的姿势存在，可读性非常差。</p><h3 id="从熟悉的编程语言的角度来看看"><a href="#从熟悉的编程语言的角度来看看" class="headerlink" title="从熟悉的编程语言的角度来看看"></a>从熟悉的编程语言的角度来看看</h3><p><img src="/2018/10/10/编译与解释/1.webp" alt="img"><br>从左往右看，<br>1.以 Java 为例，我们在文本编译器写好了 Java 代码，交由「编译器」编译成 Java Bytecode。然后 Bytecode 交由 JVM 来执行，这时候 JVM 充当了「解释器」的角色，在解释 Bytecode 成 Machine Code 的同时执行它，返回结果。<br>2.以 BASIC 语言（早期的可以由计算机直译的语言） 为例，通过文本编译器编写好，不用经历「编译」的过程，就可以直接交由操作系统内部来进行「解释」然后执行。<br>3.以 C 语言为例，我们在文本编译器编写好源代码，然后运行 gcc hello.c 编译出 hello.out 文件，该文件由一系列的机器指令组成的机器码，可以直接交由硬件来执行。</p><h3 id="抽象看本质：人与计算机之间的鸿沟"><a href="#抽象看本质：人与计算机之间的鸿沟" class="headerlink" title="抽象看本质：人与计算机之间的鸿沟"></a>抽象看本质：人与计算机之间的鸿沟</h3><p>无论是最近在看《暗时间》的作者刘未鹏，还是前一段时间听《以产品思维写文章》讲座的阿禅，还是其他的很多聪明的人。<br>他们都强调「抽象看本质」的能力，能从事物本身抽象出共通属性，看待本质。<br>这也是很多人所说的「跳出这个框框再看」的思维方式。</p><p>无论是「编译 Compile」还是「解释 Interpret」。<br>本质还是「人与计算机的交流形式」，人的语言最终转换成机器语言。<br>一句 「Hello World」，经过一些列的「编译」和「解释」，最终转换成一系列包含机器指令的那些0和1，机器傻傻执行完之后，告诉你结果。</p><p>就这么一个过程，我们就需要很多的翻译官。<br>有些翻译官可以做到同声传译（解释），有些翻译官却只能把我们的意图记下来再全部翻译（编译）给计算机。<br>而往往一个翻译官能力有限，也只能把你的语言，翻译成另外一种低级点的语言，再由另外懂这个语言的翻译官来翻译更接近计算机能读得懂的语言。<br><img src="/2018/10/10/编译与解释/2.webp" alt="img"></p><h3 id="最后用一张图来展示一下编译与解释"><a href="#最后用一张图来展示一下编译与解释" class="headerlink" title="最后用一张图来展示一下编译与解释"></a>最后用一张图来展示一下编译与解释</h3><p><img src="/2018/10/10/编译与解释/3.webp" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue不同路由使用同一个组件重新加载这个组件</title>
      <link href="/2018/10/08/vue%E4%B8%8D%E5%90%8C%E8%B7%AF%E7%94%B1%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E8%BF%99%E4%B8%AA%E7%BB%84%E4%BB%B6/"/>
      <url>/2018/10/08/vue%E4%B8%8D%E5%90%8C%E8%B7%AF%E7%94%B1%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E8%BF%99%E4%B8%AA%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>vue不同路由使用同一个组件重新加载这个组件<br><a id="more"></a></p><h2 id="vue不同路由使用同一个组件重新加载这个组件"><a href="#vue不同路由使用同一个组件重新加载这个组件" class="headerlink" title="vue不同路由使用同一个组件重新加载这个组件"></a>vue不同路由使用同一个组件重新加载这个组件</h2><p>vue,react,angular都会有一个共同点，那就是如果两个路由用的是一个组件的话，在切换路由的时候组件的生命周期函数并没有被调用，比如有一些想在组件渲染之后调用的钩子函数并不会执行，这是为了性能的考虑。我之前用angular的时候有相应的解决办法，react也有，这里不做探讨，这里只说vue，昨天看到了一个这方面的解决方法，感觉很好，记录下来。<br><br>有两种解决方案：</p><h3 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h3><p>监听$route的变化来初始化数据，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    error: <span class="literal">null</span>,</span><br><span class="line">    post: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">watch: &#123;</span><br><span class="line">  <span class="string">'$route'</span>: &#123;</span><br><span class="line">    handler: <span class="string">'resetData'</span>,</span><br><span class="line">    immediate: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  resetData() &#123;</span><br><span class="line">    <span class="keyword">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.error = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.post = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.getPost(<span class="keyword">this</span>.$route.params.id)</span><br><span class="line">  &#125;,</span><br><span class="line">  getPost(id)&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><p>给router-view添加一个unique的key，这样即使是公用组件，只要url变化了，就一定会重新创建这个组件，将key直接设置为路由的完整路径。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view :key=<span class="string">"$route.fullpath"</span>&gt;&lt;<span class="regexp">/router-view&gt;</span></span><br></pre></td></tr></table></figure></p><p>组件代码就可以正常的书写了，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    error: <span class="literal">null</span>,</span><br><span class="line">    post: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">created () &#123;</span><br><span class="line">  <span class="keyword">this</span>.getPost(<span class="keyword">this</span>.$route.params.id)</span><br><span class="line">&#125;,</span><br><span class="line">methods () &#123;</span><br><span class="line">  getPost(postId) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片类型转换(image base64 file canvas)</title>
      <link href="/2018/09/29/%E5%9B%BE%E7%89%87%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-image-base64-file-canvas/"/>
      <url>/2018/09/29/%E5%9B%BE%E7%89%87%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-image-base64-file-canvas/</url>
      
        <content type="html"><![CDATA[<p>图片的各种类型相互间的转换。<br><a id="more"></a></p><h2 id="图片类型转换-image-base64-file-canvas"><a href="#图片类型转换-image-base64-file-canvas" class="headerlink" title="图片类型转换(image base64 file canvas)"></a>图片类型转换(image base64 file canvas)</h2><p>dom中的img标签来显示图片，在src上给一个图片的连接即可，但是如果想把这个图片放在canvas上，或者ipput上传的图片想显示出来，或者canvas剪裁的图片想保存为Blob格式用ajax上传等等一系列操作，如果不缕清楚的话真是迷糊，所以做一下小小的总结。</p><h3 id="url连接"><a href="#url连接" class="headerlink" title="url连接"></a>url连接</h3><p>urltoImage(url,fn) 会通过一个url加载所需要的图片对象，其中 url 参数传入图片的 url , fn 为回调方法,包含一个Image对象的参数，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">urltoImage</span> (<span class="params">url,fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.src = url;</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    fn(img);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="canvas画图片"><a href="#canvas画图片" class="headerlink" title="canvas画图片"></a>canvas画图片</h3><p>imagetoCanvas(image) 会将一个 Image 对象转变为一个 Canvas 类型对象，其中 image 参数传入一个Image对象，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imagetoCanvas</span>(<span class="params">image</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cvs = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>);</span><br><span class="line">  <span class="keyword">var</span> ctx = cvs.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  cvs.width = image.width;</span><br><span class="line">  cvs.height = image.height;</span><br><span class="line">  ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, cvs.width, cvs.height);</span><br><span class="line">  <span class="keyword">return</span> cvs ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="canvas图片转Blob"><a href="#canvas图片转Blob" class="headerlink" title="canvas图片转Blob"></a>canvas图片转Blob</h3><p> canvasResizetoFile(canvas,quality,fn) 会将一个 Canvas 对象压缩转变为一个 Blob 类型对象；其中 canvas 参数传入一个 Canvas 对象; quality 参数传入一个0-1的 number 类型，表示图片压缩质量; fn 为回调方法，包含一个 Blob 对象的参数;代码如下：<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canvasResizetoFile</span>(<span class="params">canvas,quality,fn</span>)</span>&#123;</span><br><span class="line">  canvas.toBlob(<span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</span><br><span class="line">    fn(blob);</span><br><span class="line">  &#125;,<span class="string">'image/jpeg'</span>,quality);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p> 这里的 Blob 对象表示不可变的类似文件对象的原始数据。 Blob 表示不一定是 JavaScript 原生形式的数据。 File 接口基于 Blob ，继承了 Blob 的功能并将其扩展使其支持用户系统上的文件。我们可以把它当做File类型对待，其他更具体的用法可以参考MDN文档</p><h3 id="canvas转dataURL"><a href="#canvas转dataURL" class="headerlink" title="canvas转dataURL"></a>canvas转dataURL</h3><p> canvasResizetoDataURL(canvas,quality) 会将一个 Canvas 对象压缩转变为一个 dataURL 字符串,其中 canvas 参数传入一个 Canvas 对象; quality 参数传入一个0-1的 number 类型，表示图片压缩质量;代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">methods.canvasResizetoDataURL = <span class="function"><span class="keyword">function</span>(<span class="params">canvas,quality</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> canvas.toDataURL(<span class="string">'image/jpeg'</span>,quality);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>其中的 toDataURL API可以参考MDN文档</p><h3 id="File-Blob-转dataURL"><a href="#File-Blob-转dataURL" class="headerlink" title="File(Blob)转dataURL"></a>File(Blob)转dataURL</h3><p> filetoDataURL(file,fn) 会将 File （ Blob ）类型文件转变为 dataURL 字符串,其中 file 参数传入一个 File （ Blob ）类型文件; fn 为回调方法，包含一个 dataURL 字符串的参数;代码如下：<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filetoDataURL</span>(<span class="params">file,fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">  reader.onloadend = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    fn(e.target.result);</span><br><span class="line">  &#125;;</span><br><span class="line">  reader.readAsDataURL(file);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="dataURL转为Image类型文件"><a href="#dataURL转为Image类型文件" class="headerlink" title="dataURL转为Image类型文件"></a>dataURL转为Image类型文件</h3><p> dataURLtoImage(dataurl,fn) 会将一串 dataURL 字符串转变为 Image 类型文件,其中 dataurl 参数传入一个 dataURL 字符串, fn 为回调方法，包含一个 Image 类型文件的参数，代码如下：<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURLtoImage</span>(<span class="params">dataurl,fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    fn(img);</span><br><span class="line">  &#125;;</span><br><span class="line">  img.src = dataurl;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="dataURL转为Blob类型"><a href="#dataURL转为Blob类型" class="headerlink" title="dataURL转为Blob类型"></a>dataURL转为Blob类型</h3><p>dataURLtoFile(dataurl) 会将一串 dataURL 字符串转变为 Blob 类型对象，其中 dataurl 参数传入一个 dataURL 字符串,代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURLtoFile</span>(<span class="params">dataurl</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = dataurl.split(<span class="string">','</span>), mime = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">    bstr = atob(arr[<span class="number">1</span>]), n = bstr.length, u8arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(n);</span><br><span class="line">  <span class="keyword">while</span>(n--)&#123;</span><br><span class="line">    u8arr[n] = bstr.charCodeAt(n);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob([u8arr], &#123;<span class="attr">type</span>:mime&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="实际应用demo"><a href="#实际应用demo" class="headerlink" title="实际应用demo"></a>实际应用demo</h3><p>对于常用的将一个 File 对象压缩之后再变为 File 对象,我们可以将上面的方法再封装一下，参考如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fileResizetoFile</span>(<span class="params">file,quality,fn</span>)</span>&#123;</span><br><span class="line">  filetoDataURL (file,<span class="function"><span class="keyword">function</span>(<span class="params">dataurl</span>)</span>&#123;</span><br><span class="line">    dataURLtoImage(dataurl,<span class="function"><span class="keyword">function</span>(<span class="params">image</span>)</span>&#123;</span><br><span class="line">      canvasResizetoFile(imagetoCanvas(image),quality,fn);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>其中， file 参数传入一个 File （ Blob ）类型文件； quality 参数传入一个 0-1 的 number 类型，表示图片压缩质量； fn 为回调方法，包含一个 Blob 类型文件的参数。<br>它使用起来就像下面这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>).files[<span class="number">0</span>];</span><br><span class="line">fileResizetoFile(file,<span class="number">0.6</span>,<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">  <span class="comment">//拿到res，做出你要上传的操作；</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h3 id="再来一个图片等比压缩的demo"><a href="#再来一个图片等比压缩的demo" class="headerlink" title="再来一个图片等比压缩的demo"></a>再来一个图片等比压缩的demo</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">proDownImage</span>(<span class="params">path,imgObj</span>) </span>&#123; <span class="comment">// 等比压缩图片工具</span></span><br><span class="line">  <span class="comment">//var proMaxHeight = 185;</span></span><br><span class="line">  <span class="keyword">var</span> proMaxHeight=<span class="number">300</span>;</span><br><span class="line">  <span class="keyword">var</span> proMaxWidth = <span class="number">175</span>;</span><br><span class="line">  <span class="keyword">var</span> size = <span class="keyword">new</span> <span class="built_in">Object</span>();　</span><br><span class="line">  <span class="keyword">var</span> image = <span class="keyword">new</span> Image();　</span><br><span class="line">  image.src = path;　</span><br><span class="line">  image.attachEvent(<span class="string">"onreadystatechange"</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 当加载状态改变时执行此方法,因为img的加载有延迟</span></span><br><span class="line">    <span class="keyword">if</span> (image.readyState == <span class="string">"complete"</span>) &#123; <span class="comment">// 当加载状态为完全结束时进入</span></span><br><span class="line">      <span class="keyword">if</span> (image.width &gt; <span class="number">0</span> &amp;&amp; image.height &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ww = proMaxWidth / image.width;</span><br><span class="line">        <span class="keyword">var</span> hh = proMaxHeight / image.height;　</span><br><span class="line">        <span class="keyword">var</span> rate = (ww &lt; hh) ? ww: hh;</span><br><span class="line">        <span class="keyword">if</span> (rate &lt;= <span class="number">1</span>) &#123;　</span><br><span class="line">          alert(<span class="string">"imgage width*rate is:"</span> + image.width * rate);</span><br><span class="line">          size.width = image.width * rate;</span><br><span class="line">          size.height = image.height * rate;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          alert(<span class="string">"imgage width is:"</span> + image.width);　　</span><br><span class="line">          size.width = image.width;　　</span><br><span class="line">          size.height = image.height;　　　</span><br><span class="line">        &#125;　</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    imgObj.attr(<span class="string">"width"</span>,size.width);</span><br><span class="line">    imgObj.attr(<span class="string">"height"</span>,size.height);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一些好的文章收集</title>
      <link href="/2018/09/28/%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%9A%84%E6%96%87%E7%AB%A0%E6%94%B6%E9%9B%86/"/>
      <url>/2018/09/28/%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%9A%84%E6%96%87%E7%AB%A0%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>网上看到的好文章，总结收集。<br><a id="more"></a></p><h2 id="一些好的文章收集"><a href="#一些好的文章收集" class="headerlink" title="一些好的文章收集"></a>一些好的文章收集</h2><p>自己写博客文章真的是一件耗时的事儿，写文章需要把各个方面的知识都整理好，有时候我都是在网上看到一篇不错的文章，想记录下来，就照猫画虎的copy，但是，copy下拉也需要时间啊，没办法，现在我只能把连接记录下来，等有时间再好好地记录一下。</p><ul><li><a href="https://feclub.cn/post/content/dom" target="_blank" rel="noopener">高频dom操作和页面性能优化探索</a></li><li><a href="https://mp.weixin.qq.com/s/zO3W6WBt-mVW7j5iPYzSTQ" target="_blank" rel="noopener">送你43道JS面试题</a></li><li><a href="https://www.villainhr.com/page/2017/04/17/SVG%20快速入门" target="_blank" rel="noopener">SVG快速入门</a></li><li><a href="https://www.oschina.net/news/96039/after-chrome66-ban-play-sound-auto" target="_blank" rel="noopener">浏览器audio自动播放解决方式</a></li><li><a href="https://juejin.im/post/5e8b261ae51d4546c0382ab4#heading-71" target="_blank" rel="noopener">前端基础拾遗90问</a></li><li><a href="https://tympanus.net/codrops/2016/04/26/the-aviator-animating-basic-3d-scene-threejs/" target="_blank" rel="noopener">3D小游戏教程</a></li><li><a href="https://sketchfab.com/3d-models/popular" target="_blank" rel="noopener">3D模型下载</a></li><li><a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">the-super-tiny-compiler,js编译器</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文章收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo中使用hexo-asset-image插件来加载本地图片</title>
      <link href="/2018/09/21/hexo%E4%B8%AD%E4%BD%BF%E7%94%A8hexo-asset-image%E6%8F%92%E4%BB%B6%E6%9D%A5%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/"/>
      <url>/2018/09/21/hexo%E4%B8%AD%E4%BD%BF%E7%94%A8hexo-asset-image%E6%8F%92%E4%BB%B6%E6%9D%A5%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>hexo中使用hexo-asset-image插件来加载本地图片,因为版本兼容问题不显示图片的解决办法。<br><a id="more"></a></p><h2 id="hexo中使用hexo-asset-image插件来加载本地图片"><a href="#hexo中使用hexo-asset-image插件来加载本地图片" class="headerlink" title="hexo中使用hexo-asset-image插件来加载本地图片"></a>hexo中使用hexo-asset-image插件来加载本地图片</h2><p>在使用hexo时，在md文件里加载图片一般都会用到网络上的图片，但是如果有些图片不允许使用，怎么办？当然可以用七牛云这种图床网站，如果想使用本地的图片怎么办呢？那就用到了hexo-asset-image这个插件，但是这个插件写的很早，与现在新版本的hexo不兼容，于是乎就有一些大牛进行了修改，这里贴出这位大牛的github地址，<a href="https://github.com/7ym0n/hexo-asset-image" target="_blank" rel="noopener">兼容新版本hexo的hexo-asset-image插件</a>。<br><br>使用方法就是替换掉npm安装的hexo-asset-image插件中的文件,代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosition</span>(<span class="params">str, m, i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.split(m, i).join(m).length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> version = <span class="built_in">String</span>(hexo.version).split(<span class="string">'.'</span>);</span><br><span class="line">hexo.extend.filter.register(<span class="string">'after_post_render'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = hexo.config;</span><br><span class="line">  <span class="keyword">if</span>(config.post_asset_folder)&#123;</span><br><span class="line">    <span class="keyword">var</span> link = data.permalink;</span><br><span class="line"><span class="keyword">if</span>(version.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">Number</span>(version[<span class="number">0</span>]) == <span class="number">3</span>)</span><br><span class="line">   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">'/'</span>, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">'/'</span>, <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line"><span class="comment">// In hexo 3.1.1, the permalink of "about" page is like ".../about/index.html".</span></span><br><span class="line"><span class="keyword">var</span> endPos = link.lastIndexOf(<span class="string">'/'</span>) + <span class="number">1</span>;</span><br><span class="line">    link = link.substring(beginPos, endPos);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toprocess = [<span class="string">'excerpt'</span>, <span class="string">'more'</span>, <span class="string">'content'</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; toprocess.length; i++)&#123;</span><br><span class="line">      <span class="keyword">var</span> key = toprocess[i];</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">var</span> $ = cheerio.load(data[key], &#123;</span><br><span class="line">        ignoreWhitespace: <span class="literal">false</span>,</span><br><span class="line">        xmlMode: <span class="literal">false</span>,</span><br><span class="line">        lowerCaseTags: <span class="literal">false</span>,</span><br><span class="line">        decodeEntities: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      $(<span class="string">'img'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'src'</span>))&#123;</span><br><span class="line"><span class="comment">// For windows style path, we replace '\' to '/'.</span></span><br><span class="line"><span class="keyword">var</span> src = $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>).replace(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="regexp">/http[s]*.*|\/\/.*/</span>.test(src) &amp;&amp;</span><br><span class="line">   !<span class="regexp">/^\s*\//</span>.test(src)) &#123;</span><br><span class="line">  <span class="comment">// For "about" page, the first part of "src" can't be removed.</span></span><br><span class="line">  <span class="comment">// In addition, to support multi-level local directory.</span></span><br><span class="line">  <span class="keyword">var</span> linkArray = link.split(<span class="string">'/'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> elem != <span class="string">''</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> srcArray = src.split(<span class="string">'/'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> elem != <span class="string">''</span> &amp;&amp; elem != <span class="string">'.'</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span>(srcArray.length &gt; <span class="number">1</span>)</span><br><span class="line">srcArray.shift();</span><br><span class="line">  src = srcArray.join(<span class="string">'/'</span>);</span><br><span class="line">  $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>, config.root + link + src);</span><br><span class="line">  <span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">"update link as:--&gt;"</span>+config.root + link + src);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">"no src attr, skipped..."</span>);</span><br><span class="line"><span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info($(<span class="keyword">this</span>));</span><br><span class="line">&#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      data[key] = $.html();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>图片具体的引入方式：<br><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MacGesture2-Publish</span><br><span class="line">├── apppicker.jpg</span><br><span class="line">├── logo.jpg</span><br><span class="line">└── rules.jpg</span><br><span class="line">MacGesture2-Publish.md</span><br><span class="line"></span><br><span class="line">Make sure post_asset_folder: <span class="literal">true</span> <span class="keyword">in</span> your _config.yml.</span><br><span class="line">Just use ![logo](logo.jpg) to insert logo.jpg.</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP缓存机制及原理</title>
      <link href="/2018/09/19/HTTP%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E5%8F%8A%E5%8E%9F%E7%90%86/"/>
      <url>/2018/09/19/HTTP%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E5%8F%8A%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>HTTP缓存机制及原理的一些小总结<br><a id="more"></a></p><h2 id="HTTP缓存机制及原理"><a href="#HTTP缓存机制及原理" class="headerlink" title="HTTP缓存机制及原理"></a>HTTP缓存机制及原理</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Http 缓存机制作为 web 性能优化的重要手段，对于从事 Web 开发的同学们来说，应该是知识体系库中的一个基础环节，同时对于有志成为前端架构师的同学来说是必备的知识技能。<br><br>但是对于很多前端同学来说，仅仅只是知道浏览器会对请求的静态文件进行缓存，但是为什么被缓存，缓存是怎样生效的，却并不是很清楚。<br><br>在此，我会尝试用简单明了的文字，像大家系统的介绍HTTP缓存机制，期望对各位正确的理解前端缓存有所帮助。<br></p><h3 id="在介绍HTTP缓存之前，作为知识铺垫，先简单介绍一下HTTP报文"><a href="#在介绍HTTP缓存之前，作为知识铺垫，先简单介绍一下HTTP报文" class="headerlink" title="在介绍HTTP缓存之前，作为知识铺垫，先简单介绍一下HTTP报文"></a>在介绍HTTP缓存之前，作为知识铺垫，先简单介绍一下HTTP报文</h3><p>HTTP报文就是浏览器和服务器间通信时发送及响应的数据块。<br><br>浏览器向服务器请求数据，发送请求(request)报文；服务器向浏览器返回数据，返回响应(response)报文。<br><br>报文信息主要分为两部分<br><br>1.包含属性的首部(header)————————–附加信息（cookie，缓存信息等）与缓存相关的规则信息，均包含在header中<br><br>2.包含数据的主体部分(body)———————–HTTP请求真正想要传输的部分<br></p><h3 id="缓存规则解析"><a href="#缓存规则解析" class="headerlink" title="缓存规则解析"></a>缓存规则解析</h3><p>为方便大家理解，我们认为浏览器存在一个缓存数据库,用于存储缓存信息。<br><br>在客户端第一次请求数据时，此时缓存数据库中没有对应的缓存数据，需要请求服务器，服务器返回后，将数据存储至缓存数据库中。<br><br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141639213-1923993391.png" alt="img"><br>HTTP缓存有多种规则，根据是否需要重新向服务器发起请求来分类，我将其分为两大类(强制缓存，对比缓存)<br>在详细介绍这两种规则之前，先通过时序图的方式，让大家对这两种规则有个简单了解。<br><br>已存在缓存数据时，仅基于强制缓存，请求数据的流程如下<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210135521072-1812985836.png" alt="img"><br>已存在缓存数据时，仅基于对比缓存，请求数据的流程如<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141716838-764535017.png" alt="img"><br>对缓存机制不太了解的同学可能会问，基于对比缓存的流程下，不管是否使用缓存，都需要向服务器发送请求，那么还用缓存干什么？<br><br>这个问题，我们暂且放下，后文在详细介绍每种缓存规则的时候，会带给大家答案。<br><br>我们可以看到两类缓存规则的不同，强制缓存如果生效，不需要再和服务器发生交互，而对比缓存不管是否生效，都需要与服务端发生交互。<br><br>两类缓存规则可以同时存在，强制缓存优先级高于对比缓存，也就是说，当执行强制缓存的规则时，如果缓存生效，直接使用缓存，不再执行对比缓存规则。<br></p><h3 id="强制缓存"><a href="#强制缓存" class="headerlink" title="强制缓存"></a>强制缓存</h3><p>从上文我们得知，强制缓存，在缓存数据未失效的情况下，可以直接使用缓存数据，那么浏览器是如何判断缓存数据是否失效呢？<br><br>我们知道，在没有缓存数据的时候，浏览器向服务器请求数据时，服务器会将数据和缓存规则一并返回，缓存规则信息包含在响应header中。<br><br>对于强制缓存来说，响应header中会有两个字段来标明失效规则（Expires/Cache-Control）<br><br>使用chrome的开发者工具，可以很明显的看到对于强制缓存生效时，网络请求的情况<br><br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141755072-1978466289.png" alt="img"></p><h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>Expires的值为服务端返回的到期时间，即下一次请求时，请求时间小于服务端返回的到期时间，直接使用缓存数据。<br><br>不过Expires 是HTTP 1.0的东西，现在默认浏览器均默认使用HTTP 1.1，所以它的作用基本忽略。<br><br>另一个问题是，到期时间是由服务端生成的，但是客户端时间可能跟服务端时间有误差，这就会导致缓存命中的误差。<br><br>所以HTTP 1.1 的版本，使用Cache-Control替代。<br></p><h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>Cache-Control 是最重要的规则。常见的取值有private、public、no-cache、max-age，no-store，默认为private。<br><br>private:             客户端可以缓存<br><br>public:              客户端和代理服务器都可缓存（前端的同学，可以认为public和private是一样的）<br><br>max-age=xxx:   缓存的内容将在 xxx 秒后失效<br><br>no-cache:          需要使用对比缓存来验证缓存数据（后面介绍）<br><br>no-store:           所有内容都不会缓存，强制缓存，对比缓存都不会触发（对于前端开发来说，缓存越多越好，so…基本上和它说886）<br><br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141836104-1513192908.png" alt="img"><br>图中Cache-Control仅指定了max-age，所以默认为private，缓存时间为31536000秒（365天）<br><br>也就是说，在365天内再次请求这条数据，都会直接获取缓存数据库中的数据，直接使用。<br></p><h3 id="对比缓存"><a href="#对比缓存" class="headerlink" title="对比缓存"></a>对比缓存</h3><p>对比缓存，顾名思义，需要进行比较判断是否可以使用缓存。<br><br>浏览器第一次请求数据时，服务器会将缓存标识与数据一起返回给客户端，客户端将二者备份至缓存数据库中。<br><br>再次请求数据时，客户端将备份的缓存标识发送给服务器，服务器根据缓存标识进行判断，判断成功后，返回304状态码，通知客户端比较成功，可以使用缓存数据。<br><br>第一次访问：<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141911682-1756976419.png" alt="img"><br>再次访问：<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141921697-379821074.png" alt="img"><br>通过两图的对比，我们可以很清楚的发现，在对比缓存生效时，状态码为304，并且报文大小和请求时间大大减少。<br><br>原因是，服务端在进行标识比较后，只返回header部分，通过状态码通知客户端使用缓存，不再需要将报文主体部分返回给客户端。<br><br>对于对比缓存来说，缓存标识的传递是我们着重需要理解的，它在请求header和响应header间进行传递，一共分为两种标识传递，接下来，我们分开介绍。<br></p><h3 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified  /  If-Modified-Since"></a>Last-Modified  /  If-Modified-Since</h3><h4 id="Last-Modified："><a href="#Last-Modified：" class="headerlink" title="Last-Modified："></a>Last-Modified：</h4><p>服务器在响应请求时，告诉浏览器资源的最后修改时间。<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210142249541-789089587.png" alt="img"></p><h4 id="If-Modified-Since："><a href="#If-Modified-Since：" class="headerlink" title="If-Modified-Since："></a>If-Modified-Since：</h4><p>再次请求服务器时，通过此字段通知服务器上次请求时，服务器返回的资源最后修改时间。<br><br>服务器收到请求后发现有头If-Modified-Since 则与被请求资源的最后修改时间进行比对。<br><br>若资源的最后修改时间大于If-Modified-Since，说明资源又被改动过，则响应整片资源内容，返回状态码200；<br><br>若资源的最后修改时间小于或等于If-Modified-Since，说明资源无新修改，则响应HTTP 304，告知浏览器继续使用所保存的cache。<br><br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210142307166-135607673.png" alt="img"></p><h3 id="Etag-If-None-Match（优先级高于Last-Modified-If-Modified-Since）"><a href="#Etag-If-None-Match（优先级高于Last-Modified-If-Modified-Since）" class="headerlink" title="Etag  /  If-None-Match（优先级高于Last-Modified  /  If-Modified-Since）"></a>Etag  /  If-None-Match（优先级高于Last-Modified  /  If-Modified-Since）</h3><h4 id="Etag："><a href="#Etag：" class="headerlink" title="Etag："></a>Etag：</h4><p>服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器决定）。<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210142054182-1766818273.png" alt="img"></p><h4 id="If-None-Match："><a href="#If-None-Match：" class="headerlink" title="If-None-Match："></a>If-None-Match：</h4><p>再次请求服务器时，通过此字段通知服务器客户段缓存数据的唯一标识。<br><br>服务器收到请求后发现有头If-None-Match 则与被请求资源的唯一标识进行比对，不同，说明资源又被改动过，则响应整片资源内容，返回状态码200；<br><br>相同，说明资源无新修改，则响应HTTP 304，告知浏览器继续使用所保存的cache。<br><br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210142115479-1921175758.png" alt="img"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>对于强制缓存，服务器通知浏览器一个缓存时间，在缓存时间内，下次请求，直接用缓存，不在时间内，执行比较缓存策略。<br><br>对于比较缓存，将缓存信息中的Etag和Last-Modified通过请求发送给服务器，由服务器校验，返回304状态码时，浏览器直接使用缓存。<br><br>浏览器第一次请求：<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210142134291-1976923079.png" alt="img"><br>浏览器再次请求时：<br><img src="/2018/09/19/HTTP缓存机制及原理/632130-20170210141453338-1263276228.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> 网络基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css省略号</title>
      <link href="/2018/09/14/css%E7%9C%81%E7%95%A5%E5%8F%B7/"/>
      <url>/2018/09/14/css%E7%9C%81%E7%95%A5%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<p>页面中文字溢出的省略号<br><a id="more"></a></p><h2 id="css文本溢出省略号"><a href="#css文本溢出省略号" class="headerlink" title="css文本溢出省略号"></a>css文本溢出省略号</h2><h3 id="单行文本省略号"><a href="#单行文本省略号" class="headerlink" title="单行文本省略号"></a>单行文本省略号</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">overflow: hidden;</span><br><span class="line">text-overflow: ellipsis;</span><br><span class="line">white-space: nowrap;</span><br><span class="line"><span class="comment">// 有些浏览器需要加上width</span></span><br></pre></td></tr></table></figure><h3 id="多行文本溢出省略号"><a href="#多行文本溢出省略号" class="headerlink" title="多行文本溢出省略号"></a>多行文本溢出省略号</h3><p>在WebKit浏览器或移动端（绝大部分是WebKit内核的浏览器）的页面实现比较简单，可以直接使用WebKit的CSS扩展属性(WebKit是私有属性)-webkit-line-clamp ；注意：这是一个 不规范的属性（unsupported WebKit property），它没有出现在 CSS 规范草案中。<br><br>-webkit-line-clamp用来限制在一个块元素显示的文本的行数。 为了实现该效果，它需要组合其他的WebKit属性。<br>常见结合属性：<br></p><ul><li>display: -webkit-box; 必须结合的属性 ，将对象作为弹性伸缩盒子模型显示 。</li><li>-webkit-box-orient 必须结合的属性 ，设置或检索伸缩盒对象的子元素的排列方式 。</li><li>text-overflow: ellipsis;，可以用来多行文本的情况下，用省略号“…”隐藏超出范围的文本 。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">overflow : hidden;</span><br><span class="line">text-overflow: ellipsis;</span><br><span class="line">display: -webkit-box;</span><br><span class="line">-webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">-webkit-box-orient: vertical;</span><br></pre></td></tr></table></figure></li></ul><h3 id="兼容其它浏览器的写法"><a href="#兼容其它浏览器的写法" class="headerlink" title="兼容其它浏览器的写法"></a>兼容其它浏览器的写法</h3><p>html:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;WebKit Browsers will clamp the number <span class="keyword">of</span> lines <span class="keyword">in</span> <span class="keyword">this</span> paragraph to <span class="number">2.</span> Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed <span class="keyword">do</span> eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor <span class="keyword">in</span> reprehenderit <span class="keyword">in</span> voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt <span class="keyword">in</span> culpa qui officia deserunt mollit anim id est laborum.&lt;<span class="regexp">/p&gt;</span></span><br></pre></td></tr></table></figure></p><p>css:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p &#123;</span><br><span class="line">    position:relative;</span><br><span class="line">    line-height:<span class="number">1.4</span>em;</span><br><span class="line">    <span class="comment">/* 3 times the line-height to show 3 lines */</span></span><br><span class="line">    height:<span class="number">4.2</span>em;</span><br><span class="line">    overflow:hidden;</span><br><span class="line">&#125;</span><br><span class="line">p::after &#123;</span><br><span class="line">    content:<span class="string">"..."</span>;</span><br><span class="line">    font-weight:bold;</span><br><span class="line">    position:absolute;</span><br><span class="line">    bottom:<span class="number">0</span>;</span><br><span class="line">    right:<span class="number">0</span>;</span><br><span class="line">    padding:<span class="number">0</span> <span class="number">20</span>px <span class="number">1</span>px <span class="number">45</span>px;</span><br><span class="line">    background:url(http:<span class="comment">//css88.b0.upaiyun.com/css88/2014/09/ellipsis_bg.png) repeat-y;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这里注意几点：<b></b></p><ul><li>height高度真好是line-height的3倍；</li><li>结束的省略好用了半透明的png做了减淡的效果，或者设置背景颜色；</li><li>IE6-7不显示content内容，所以要兼容IE6-7可以是在内容中加入一个标签，比如用<span class="line-clamp">…</span>去模拟；</li><li>要支持IE8，需要将::after替换成:after；</li></ul>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 样式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>资源导航</title>
      <link href="/2018/09/06/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/"/>
      <url>/2018/09/06/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/</url>
      
        <content type="html"><![CDATA[<p>整理常用的工具库和学习资源<br><a id="more"></a></p><h1 id="资源导航"><a href="#资源导航" class="headerlink" title="资源导航"></a>资源导航</h1><h2 id="github"><a href="#github" class="headerlink" title="github"></a>github</h2><ul><li><a href="https://github.com/chokcoco" target="_blank" rel="noopener">coco大神的github</a></li><li><a href="https://github.com/ljianshu" target="_blank" rel="noopener">前端工匠-浪里行舟</a></li><li><a href="https://www.josephxia.com/" target="_blank" rel="noopener">开课吧夏老师blog</a></li><li><a href="https://github.com/danistefanovic/build-your-own-x" target="_blank" rel="noopener">造轮子教程</a></li><li><a href="https://github.com/liriliri" target="_blank" rel="noopener">liriliri</a></li></ul><h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2><ul><li><a href="https://www.cnblogs.com/xuanhun/category/568577.html" target="_blank" rel="noopener">玄魂工作室-nw.js教程</a></li><li><a href="http://www.yanhuangxueyuan.com" target="_blank" rel="noopener">WebGL教程-郭隆邦_技术博客</a></li><li><a href="https://svg.brucewar.cn/" target="_blank" rel="noopener">SVG教程</a></li><li><a href="https://semlinker.com/" target="_blank" rel="noopener">前端修仙之路</a></li><li><a href="https://wangdoc.com/" target="_blank" rel="noopener">阮一峰javascript教程</a></li><li><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener">阮一峰typeScript教程</a></li><li><a href="https://es6.ruanyifeng.com/" target="_blank" rel="noopener">阮一峰es6教程</a></li><li><a href="https://www.bookstack.cn/read/webapi-tutorial" target="_blank" rel="noopener">阮一峰Web-API教程</a></li><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">廖雪峰的官方网站</a></li><li><a href="https://github.com/xxlllq/" target="_blank" rel="noopener">软考高级架构师</a></li><li><a href="https://gitee.com/jishupang/web_atlas" target="_blank" rel="noopener">技术胖-前端知识图谱+B站视频整合</a></li><li><a href="https://wangtunan.github.io/blog/" target="_blank" rel="noopener">汪图南</a></li><li><a href="https://chenshenhai.com/" target="_blank" rel="noopener">大深海的技术博客</a></li><li><a href="https://juejin.cn/column/7140843956958396429" target="_blank" rel="noopener">历时8个月！10w字前端知识体系+大厂面试总结（基础知识篇）</a></li></ul><h2 id="文档电子书"><a href="#文档电子书" class="headerlink" title="文档电子书"></a>文档电子书</h2><ul><li><a href="https://www.bookstack.cn/" target="_blank" rel="noopener">书栈网</a></li></ul><h2 id="大团队官网"><a href="#大团队官网" class="headerlink" title="大团队官网"></a>大团队官网</h2><ul><li><a href="https://aotu.io/" target="_blank" rel="noopener">京东-凹凸实验室</a></li><li><a href="http://alloyteam.com/" target="_blank" rel="noopener">腾讯-alloyteam</a></li><li><a href="https://imweb.io/" target="_blank" rel="noopener">腾讯-imweb</a></li><li><a href="https://fed.taobao.org/" target="_blank" rel="noopener">淘宝-FED</a></li><li><a href="http://fex.baidu.com/" target="_blank" rel="noopener">百度-FEX</a><h2 id="工具库"><a href="#工具库" class="headerlink" title="工具库"></a>工具库</h2></li><li><a href="https://github.com/jobbole/awesome-javascript-cn" target="_blank" rel="noopener">JavaScript 资源大全中文版</a></li><li><a href="https://imgcook.taobao.org/" target="_blank" rel="noopener">阿里-imgcook-由设计稿一键智能生成代码</a></li><li><a href="https://caniuse.com/" target="_blank" rel="noopener">浏览器兼容性查看-caniuse</a></li><li><a href="https://htmlreference.io/" target="_blank" rel="noopener">html-在线guide</a></li><li><a href="https://cssreference.io/" target="_blank" rel="noopener">css-在线guide</a></li><li><a href="https://codesandbox.io/" target="_blank" rel="noopener">在线开发工具-可以选择各种框架一</a></li><li><a href="https://stackblitz.com/" target="_blank" rel="noopener">在线开发工具-可以选择各种框架二</a></li><li><a href="https://any86.github.io/any-rule/" target="_blank" rel="noopener">正则大全</a></li><li><a href="https://github.com/30-seconds/30-seconds-of-code" target="_blank" rel="noopener">30-seconds-of-code</a><h2 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h2></li><li><a href="https://github.com/jobbole/awesome-nodejs-cn" target="_blank" rel="noopener">nodejs资源总汇</a><h2 id="刷题"><a href="#刷题" class="headerlink" title="刷题"></a>刷题</h2></li><li><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">力扣</a></li><li><a href="https://github.com/lydiahallie/javascript-questions" target="_blank" rel="noopener">javascriptQuestions</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 工具库 </tag>
            
            <tag> 资源导航 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jquery上传文件</title>
      <link href="/2018/09/03/jquery%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/"/>
      <url>/2018/09/03/jquery%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>之前在项目中使用jquery，Formdata实现文件上传<br><a id="more"></a></p><h2 id="jquery上传文件"><a href="#jquery上传文件" class="headerlink" title="jquery上传文件"></a>jquery上传文件</h2><p>现在的上传文件插件非常的多，比如在一个表单中，上传身份证照片，点击上传按钮，选好图片，上传好了，一般都提交到了一个图片服务器上，这是常规做法，但是有遇到过，有的后端同事要求我在点击form的提交按钮时，图片和输入框，下拉信息一并提交，当然，直接用form来做都不用改什么就可以，但是，如果需要更灵活的话，我选择了FormData对象配合jquery来做，具体代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>upload file<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.upload_area</span> &gt; <span class="selector-tag">div</span>, <span class="selector-class">.userType_area</span> &gt; <span class="selector-tag">div</span> , <span class="selector-class">.sendType_area</span> &gt; <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#DAD5D5</span>;</span></span><br><span class="line">    padding: 10px 15px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-id">#myUploadBtn</span>&#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>:<span class="selector-id">#1874D5</span>;</span></span><br><span class="line">    border: none;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#ffffff</span>;</span></span><br><span class="line">    padding: 5px 12px;</span><br><span class="line">&#125;</span><br><span class="line">h3 &#123;</span><br><span class="line">    margin: 5px 0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.fileName</span> &#123;</span></span><br><span class="line">    margin-left: 15px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.userType_area</span> &#123;&#125; </span></span><br><span class="line"><span class="css"><span class="selector-class">.userType_area</span> <span class="selector-tag">ul</span> , <span class="selector-class">.sendType_area</span> <span class="selector-tag">ul</span> &#123;</span></span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.userType_area</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> , <span class="selector-class">.sendType_area</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line">    position: relative;</span><br><span class="line">    float: left;</span><br><span class="line">    padding: 2px 5px;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>:<span class="selector-id">#1874D5</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#ffffff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#ffffff</span>;</span></span><br><span class="line">    margin: 0 10px;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">span</span><span class="selector-class">.checkMark</span> &#123;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    width: 20px;</span><br><span class="line">    height: 20px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-tag">rgba</span>(0,0,0,<span class="selector-class">.5</span>);</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fffff</span>;</span></span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.text_area</span> &#123;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.text_area</span> <span class="selector-tag">textarea</span> &#123;</span></span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 120px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.mes_box</span> &#123;</span></span><br><span class="line">    display: none;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 20%;</span><br><span class="line">    left: 50%;</span><br><span class="line"><span class="css">    <span class="selector-tag">margin</span><span class="selector-pseudo">:0</span> 0 0 <span class="selector-tag">-150px</span>;</span></span><br><span class="line">    width: 300px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    background-color: gray;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.mes_box</span> &gt; <span class="selector-class">.cancel</span> &#123;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 30px;</span><br><span class="line">    height: 30px;</span><br><span class="line">    border-radius: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line"><span class="css">    <span class="selector-tag">line-height</span><span class="selector-pseudo">:23px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    font-size: 25px;</span><br><span class="line">    right: 5px;</span><br><span class="line">    top: 3px;</span><br><span class="line"><span class="css">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#fff</span>;</span></span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.mes_box</span> &gt; <span class="selector-tag">strong</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#ffffff</span>;</span></span><br><span class="line">    display: inline-block;</span><br><span class="line">    margin: 70px 0;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mes_box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"cancel"</span>&gt;</span>x<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"choosefile"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"upload_area"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"myUploadBtn"</span>&gt;</span>请选择您要上传的文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"fileName"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"userType_area"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>选择用户类型<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-code</span>=<span class="string">"1"</span>&gt;</span>余额不足<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-code</span>=<span class="string">"2"</span>&gt;</span>宽带到期<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-code</span>=<span class="string">"3"</span>&gt;</span>其它<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sendType_area"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>选择推送触点<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-code</span>=<span class="string">"1"</span>&gt;</span>辽宁联通为信号<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-code</span>=<span class="string">"2"</span>&gt;</span>短信<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-code</span>=<span class="string">"3"</span>&gt;</span>其它<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text_area"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>输入推送需求<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">cols</span>=<span class="string">"30"</span> <span class="attr">rows</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendFile"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary bsok"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> isok = <span class="literal">true</span> , isover = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//选择文件点击事件</span></span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'#myUploadBtn'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                       (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">return</span> $(<span class="string">'#choosefile'</span>)[<span class="number">0</span>].click();</span></span><br><span class="line">                        &#125;)();</span><br><span class="line">                    &#125;);</span><br><span class="line"><span class="javascript">            <span class="comment">//上传选择文件change事件</span></span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'#choosefile'</span>).on(<span class="string">'change'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">'.fileName'</span>).text(<span class="string">'上传的文件名：'</span>+$(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>].name);</span></span><br><span class="line">                    &#125;);</span><br><span class="line"><span class="javascript">            <span class="comment">//被选中函数</span></span></span><br><span class="line"><span class="javascript">                    <span class="function"><span class="keyword">function</span> <span class="title">checkMark</span>(<span class="params">$el,isDan</span>)</span>&#123;</span></span><br><span class="line"><span class="xml">                        var strNode = '<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"checkMark"</span>&gt;</span>√<span class="tag">&lt;/<span class="name">span</span>&gt;</span>'</span></span><br><span class="line">                        if(isDan)&#123;</span><br><span class="line"><span class="javascript">                            <span class="keyword">if</span>($el.data(<span class="string">'checkMark'</span>))&#123;</span></span><br><span class="line"><span class="javascript">                                $el.find(<span class="string">'span'</span>).remove();</span></span><br><span class="line"><span class="javascript">                                $el.data(<span class="string">'checkMark'</span>, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                                $el.siblings().data(<span class="string">'checkMark'</span>, <span class="literal">false</span>).find(<span class="string">'span'</span>).remove();</span></span><br><span class="line"><span class="javascript">                                $el.data(<span class="string">'checkMark'</span>, <span class="literal">true</span>).append(strNode); </span></span><br><span class="line">                            &#125;</span><br><span class="line">                                  </span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">if</span>($el.data(<span class="string">'checkMark'</span>))&#123;</span></span><br><span class="line"><span class="javascript">                                $el.find(<span class="string">'span'</span>).remove();</span></span><br><span class="line"><span class="javascript">                                $el.data(<span class="string">'checkMark'</span>, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                                $el.data(<span class="string">'checkMark'</span>, <span class="literal">true</span>).append(strNode); </span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">            <span class="comment">//获取被选中的code</span></span></span><br><span class="line"><span class="javascript">                    <span class="function"><span class="keyword">function</span> <span class="title">getCode</span>(<span class="params">$el</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> arr = [];</span></span><br><span class="line"><span class="javascript">                        $el.find(<span class="string">'li'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">index, el</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">if</span>($(<span class="keyword">this</span>).data(<span class="string">'checkMark'</span>) == <span class="literal">true</span>)&#123;</span></span><br><span class="line"><span class="javascript">                                arr.push($(<span class="keyword">this</span>).data(<span class="string">'code'</span>));</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> arr;</span></span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">            <span class="comment">//选择用户类型添加事件</span></span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'.userType_area li'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        checkMark($(<span class="keyword">this</span>),<span class="literal">true</span>);</span></span><br><span class="line">                    &#125;);</span><br><span class="line"><span class="javascript">            <span class="comment">//推送触点添加事件</span></span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'.sendType_area li'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        checkMark($(<span class="keyword">this</span>),<span class="literal">false</span>);</span></span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">//上传文件点击事件</span></span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'#sendFile'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> upload_file = $(<span class="string">'#choosefile'</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> userType = getCode($(<span class="string">'.userType_area'</span>));</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> sendType = getCode($(<span class="string">'.sendType_area'</span>));</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> text = $(<span class="string">'.text_area textarea'</span>).val();</span></span><br><span class="line">                        if(upload_file)&#123;</span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> houz = <span class="regexp">/\.[^\.]+$/</span>.exec(upload_file.name);</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> size = upload_file.size; </span></span><br><span class="line">                        &#125;</span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(upload_file);</span></span><br><span class="line">                        if(!upload_file)&#123;</span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'请选择一个要上传的文件'</span>);</span></span><br><span class="line"><span class="javascript">                            isok = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(userType.length === <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'请选择用户类型'</span>);</span></span><br><span class="line"><span class="javascript">                            isok = <span class="literal">false</span>;   </span></span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sendType.length === <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'请选择推送触点'</span>);</span></span><br><span class="line"><span class="javascript">                            isok = <span class="literal">false</span>;  </span></span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!text)&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'请输入推送需求'</span>);</span></span><br><span class="line"><span class="javascript">                            isok = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(houz[<span class="number">0</span>] !== <span class="string">'.txt'</span>)&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'请上传以txt结尾的文件'</span>);</span></span><br><span class="line"><span class="javascript">                            isok = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(size &gt; <span class="number">4194304</span>)&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'您上传的文件过大，请上传小于4M的文件'</span>);</span></span><br><span class="line"><span class="javascript">                            isok = <span class="literal">false</span>;</span></span><br><span class="line">                        &#125;;</span><br><span class="line"><span class="javascript">                        fd.append(<span class="string">'userType'</span>,userType);</span></span><br><span class="line"><span class="javascript">                        fd.append(<span class="string">'sendType'</span>,userType);</span></span><br><span class="line"><span class="javascript">                        fd.append(<span class="string">'text'</span>,userType);</span></span><br><span class="line"><span class="javascript">                        fd.append(<span class="string">'file'</span>,upload_file);</span></span><br><span class="line">                        if(isok)&#123;</span><br><span class="line"><span class="javascript">                            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                                url:  ajaxUrl + <span class="string">"/module/channel/checkByWhere"</span>,</span></span><br><span class="line"><span class="javascript">                                type: <span class="string">'POST'</span>,</span></span><br><span class="line"><span class="javascript">                                cache: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                                processData: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                                contentType: <span class="literal">false</span>,</span></span><br><span class="line">                                data: fd,</span><br><span class="line"><span class="javascript">                                success:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                                    $(<span class="string">".modal-content"</span>).mask(<span class="string">"hide"</span>);</span></span><br><span class="line"><span class="javascript">                                    <span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span></span><br><span class="line"><span class="javascript">                                        $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                                        $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'数据提交成功'</span>);</span></span><br><span class="line"><span class="javascript">                                        isover = <span class="literal">true</span>;    </span></span><br><span class="line"><span class="javascript">                                    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                                        $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                                        $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'服务器问题，数据提交失败'</span>);</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;,</span><br><span class="line"><span class="javascript">                                error:<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                                    $(<span class="string">".modal-content"</span>).mask(<span class="string">"hide"</span>);</span></span><br><span class="line"><span class="javascript">                                    $(<span class="string">'.mes_box'</span>).show();</span></span><br><span class="line"><span class="javascript">                                    $(<span class="string">'.mes_box strong'</span>).text(<span class="string">'由于网络原因提交失败'</span>);</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line"><span class="javascript">                            $(<span class="string">".modal-content"</span>).mask(<span class="string">"show"</span>);<span class="comment">//ajax提交数据出现loading蒙层</span></span></span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    </span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">//提示框关闭按钮点击事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.mes_box .cancel'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="keyword">this</span>).parent().hide();</span></span><br><span class="line"><span class="javascript">                isok = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(isover === <span class="literal">true</span>)&#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'#createModal'</span>).remove();</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'.modal-backdrop.fade.in'</span>).remove();</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;)();</span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>这是整个页面的内容，其实重要的几个点在这里：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#myUploadBtn'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                       (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> $(<span class="string">'#choosefile'</span>)[<span class="number">0</span>].click();</span><br><span class="line">                        &#125;)();</span><br><span class="line">                    &#125;);</span><br><span class="line">上边这个函数就是把实际的input file 标签隐藏，用其他的按钮来触发弹出选择文件的窗口，</span><br><span class="line">注意，不能直接用file.click()这种形式，要 (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> file.click();</span><br><span class="line">                        &#125;)();</span><br><span class="line">这样做才可以调出选择文件的窗口。</span><br><span class="line"></span><br><span class="line">再有一点，利用了h5的 <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData(); 类，把需要上传的文件起个key值，直接放到fd实例里，</span><br><span class="line">fd.append(<span class="string">'userType'</span>,userType);</span><br><span class="line">                        fd.append(<span class="string">'sendType'</span>,userType);</span><br><span class="line">                        fd.append(<span class="string">'text'</span>,userType);</span><br><span class="line">                        fd.append(<span class="string">'file'</span>,upload_file);</span><br><span class="line">之后用ajax直接把fd对象上传就可以了，以jquery为例</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">                            url:  ajaxUrl + <span class="string">"/module/channel/checkByWhere"</span>,</span><br><span class="line">                            type: <span class="string">'POST'</span>,</span><br><span class="line">                            cache: <span class="literal">false</span>,</span><br><span class="line">                            processData: <span class="literal">false</span>,<span class="comment">//不对数据进行处理，保持2进制</span></span><br><span class="line">                            contentType: <span class="literal">false</span>,<span class="comment">//不对数据进行处理，保持2进制</span></span><br><span class="line">                            data: fd</span><br><span class="line">                        &#125;);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript提高性能</title>
      <link href="/2018/09/01/javascript%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD/"/>
      <url>/2018/09/01/javascript%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<p>javascript提高性能的方式总结<br><a id="more"></a></p><h2 id="javascript提高性能"><a href="#javascript提高性能" class="headerlink" title="javascript提高性能"></a>javascript提高性能</h2><p>&emsp;&emsp;javascript如何提高性能，这个在面试中被问到的几率也是蛮高的，之前我也就是想到哪里说到哪里，面试官估计也都是菜鸟（我面的也都是小公司），也觉得我说的对，但是，有空冷静下来，觉得自己说的每次都不是很全面，所以，我想把平时能想到的记录下来，这样再去面试的时候，呵呵，一定把面试官说蒙。</p><h3 id="4种内存泄漏"><a href="#4种内存泄漏" class="headerlink" title="4种内存泄漏"></a>4种内存泄漏</h3><p>&emsp;&emsp;提高JavaScript性能，首先就是避免4种内存泄漏,这里只是简单列出。<br></p><h4 id="1-意外的全局变量"><a href="#1-意外的全局变量" class="headerlink" title="1.意外的全局变量"></a>1.意外的全局变量</h4><p>JavaScript的目标是开发一种看起来像Java但足够自由的被初学者使用的语言。JavaScript自由的其中一种方式是它可以处理没有声明的变量：一个未声明的变量的引用在全局对象中创建了一个新变量。在浏览器的环境中，全局对象是window。也就是说：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    bar = <span class="string">"this is a hidden global variable"</span>;</span><br><span class="line">&#125;</span><br><span class="line">实际上是：</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.bar = <span class="string">"this is an explicit global variable"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果bar是仅在foo函数作用域内承载引用，并且你忘记用var来声明的变量，一个意外的全局变量就被创建了。在这个例子中，泄漏一个单一字符串不会有太大害处，但这的确是不好的。<br><br>另一种意外全局变量被创建的方式是通过this：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.variable = <span class="string">"potential accidental global"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Foo called on its own, this points to the global object (window)</span></span><br><span class="line"><span class="comment">// rather than being undefined.</span></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure></p><p>为了阻止这种错误发生，在你的Javascript文件最前面添加’use strict;’。这开启了解析JavaScript的阻止意外全局的更严格的模式。<br><br>全局变量的一个注意事项：<br><br>即使我们谈了不明的全局变量，仍然存在很多代码被显式的全局变量填充的情况。这是通过定义不可收集的情况（除非清零或重新赋值）。特别的，用来临时存储和处理大量信息的全局变量会引起关注。如果必须用全局变量来存储很多数据，在处理完之后，确保对其清零或重新赋值。 一个在与全局连接上增加内存消耗常见的原因是缓存)。 缓存存储重复被使用的数据。为此，为了有效，缓存必须有其大小的上限。飙出限制的缓存可能会因为内容不可被回收，导致高内存消耗。</p><h4 id="2-被遗忘的计时器或回调"><a href="#2-被遗忘的计时器或回调" class="headerlink" title="2.被遗忘的计时器或回调"></a>2.被遗忘的计时器或回调</h4><p>在JavaScript中setInterval的使用相当常见。其他库提供观察者和其他工具以回调。这些库中大多数，在引用的实例变成不可访问之后，负责让回调的任何引用也不可访问。在setInterval的情况下，这样的代码很常见：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> someResource = getData();</span><br><span class="line">    setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'Node'</span>);</span><br><span class="line">    <span class="keyword">if</span>(node) &#123;</span><br><span class="line">    <span class="comment">// Do stuff with node and someResource.</span></span><br><span class="line">    node.innerHTML = <span class="built_in">JSON</span>.stringify(someResource));</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></p><p>这个例子表明了跳动的计时器可能发生什么：计时器使得节点或数据的引用不再被需要了。代表node的对象将来可能被移除，使得整个块在间隔中的处理不必要。然而，处理函数，由于间隔仍然是活跃的，不能被回收（间隔需要被停掉才能回收）。如果间隔处理不能被回收，它的依赖也不能被回收。那意味着可能存储着大量数据的someResource，也不能被回收。<br><br>观察者情况下，一旦不被需要（或相关的对象快要访问不到）就创建明确移除他们的函数很重要。在过去，这由于特定浏览器（IE6）不能很好的管理循环引用（下面有更多相关信息），曾经尤为重要。现如今，一旦观察对象变成不可访问的，即使收听者没有明确的被移除，多数浏览器可以并会回收观察者处理函数。然而，它保持了在对象被处理前明确的移除这些观察者的好实践。例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  element.innerHtml = <span class="string">'text'</span>;</span><br><span class="line">&#125;</span><br><span class="line">element.addEventListener(<span class="string">'click'</span>, onClick);</span><br><span class="line"><span class="comment">// Do stuff</span></span><br><span class="line">element.removeEventListener(<span class="string">'click'</span>, onClick);</span><br><span class="line">element.parentNode.removeChild(element);</span><br><span class="line"><span class="comment">// Now when element goes out of scope,</span></span><br><span class="line"><span class="comment">// both element and onClick will be collected even in old browsers that don't</span></span><br><span class="line"><span class="comment">// handle cycles well.</span></span><br></pre></td></tr></table></figure></p><p>一条关于对象观察者及循环引用的笔记<br><br>观察者和循环引用曾经是JavaScript开发者的祸患。这是由于IE垃圾回收的一个bug(或者设计决议)出现的情况。IE的老版本不能检测到DOM节点和JavaScript代码间的循环引用。 这是一个通常为观察到的保留引用（如同上面的例子）的观察者的典型。 也就是说，每次在IE中对一个节点添加观察者的时候，会导致泄漏。这是开发者在节点或空引用之前开始明确的移除处理函数的原因。 现在，现代浏览器（包括IE和MS Edge）使用可以剪裁这些循环和正确处理的现代垃圾回收算法。换言之，在使一个节点不可访问前，调用removeEventLister不是严格意义上必须的。<br><br>像Jquery一样的框架和库做了在处置一个节点前（当为其使用特定的API的时候）移除监听者的工作。这被在库内部处理，即使在像老版本IE一样有问题的浏览器里面跑，也会确保没有泄漏产生。</p><h4 id="3-超出DOM引用"><a href="#3-超出DOM引用" class="headerlink" title="3. 超出DOM引用"></a>3. 超出DOM引用</h4><p>有时存储DOM节点到数据结构中可能有用。假设你想要迅速的更新一个表格几行内容。存储每个DOM行节点的引用到一个字典或数组会起作用。当这发生是，两个对于同个DOM元素的引用被留存：一个在DOM树中，另外一个在字典中。如果在将来的某些点你决定要移除这些行，需要让两个引用都不可用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elements = &#123;</span><br><span class="line">    button: <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>),</span><br><span class="line">    image: <span class="built_in">document</span>.getElementById(<span class="string">'image'</span>),</span><br><span class="line">    text: <span class="built_in">document</span>.getElementById(<span class="string">'text'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doStuff</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">image.src = <span class="string">'http://some.url/image'</span>;</span><br><span class="line">button.click();</span><br><span class="line"><span class="built_in">console</span>.log(text.innerHTML);</span><br><span class="line"><span class="comment">// Much more logic</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// The button is a direct child of body.</span></span><br><span class="line"><span class="built_in">document</span>.body.removeChild(<span class="built_in">document</span>.getElementById(<span class="string">'button'</span>));</span><br><span class="line"><span class="comment">// At this point, we still have a reference to #button in the global</span></span><br><span class="line"><span class="comment">// elements dictionary. In other words, the button element is still in</span></span><br><span class="line"><span class="comment">// memory and cannot be collected by the GC.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>对此的额外考虑，必须处理DOM树内的内部节点或叶子节点。假设你在JavaScript代码中保留了一个对于特定的表格内节点（一个td标签）的引用。在将来的某个点决定从DOM中移除这个表格，但是保留对于那个节点的引用。直观的，会假设GC会回收除那个节点之外的每个节点。在实践中，这不会发生的：这个单节点是那个表格的子节点，子节点保留对父节点引用。换句话说，来自JavaScript代码的表格元素的引用会引起在内存里存整个表格。当保留DOM元素的引用的时候，仔细考虑下。</p><h4 id="4-闭包"><a href="#4-闭包" class="headerlink" title="4.闭包"></a>4.闭包</h4><p>一个JavaScript开发的关键点是闭包：从父级作用域捕获变量的匿名函数。很多开发者发现，由于JavaScript runtime的实现细节，有以一种微妙的方式泄漏的可能，这种特殊的情况：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> theThing = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> replaceThing = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> originalThing = theThing;</span><br><span class="line">    <span class="keyword">var</span> unused = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (originalThing)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"hi"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    theThing = &#123;</span><br><span class="line">        longStr: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1000000</span>).join(<span class="string">'*'</span>),</span><br><span class="line">        someMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(someMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">setInterval(replaceThing, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></p><p>这个代码片段做了一件事：每次replaceThing被调用的时候，theThing获取到一个包括一个大数组和新闭包(somMethod)的新对象。同时，变量unused保留了一个有originalThing（theThing从之前的对replaceThing的调用）引用的闭包。已经有点疑惑了，哈？重要的是一旦一个作用域被在同个父作用域下的闭包创建，那个作用域是共享的。这种情况下，为闭包somMethod创建的作用域被unused共享了。unused有一个对originalThing的引用。即使unused从来没被用过，someMethod可以通过theTing被使用。由于someMethod和unused共享了闭包作用域，即使unused从来没被用过，它对originalThing的引用迫使它停留在活跃状态（不能回收）。当这个代码片段重复运行的时候，可以看到内存使用稳步的增长。GC运行的时候，这并不会减轻。本质上，一组关联的闭包被创建（同unused变量在表单中的根节点一起），这些闭包作用域中每个带了大数组一个非直接的引用，导致了大型的泄漏。</p><h4 id="垃圾回收的直观行为"><a href="#垃圾回收的直观行为" class="headerlink" title="垃圾回收的直观行为"></a>垃圾回收的直观行为</h4><p>即使垃圾回收很方便，他们有自己的一套权衡方法。其中一个权衡是nondeterminism。也就是说，GC是不可预期的。通常不能确定什么时候回收器被执行。这意味着在一些情况下，需要比程序正在使用的更多的内存。其他情况下，短的暂停在特别敏感的应用中很明显。即使不确定性意味着不能确定回收什么时候执行，大多数GC实现共享在分配期间，普通的回收通行证模式。如果没有执行分配，大多数CG停留在休息状态。考虑下面的方案：<br><br>1.执行一组大型的分配。<br><br>2.多数元素（或所有）被标记为不可访问（假设我们置空了一个指向不再需要的缓存的引用）。<br><br>3.没有进一步的分配执行了。<br><br>在这个方案中，大多GC不会运行任何进一步的回收通行了。换言之，即使有可用于回收的，不可访问的引用，回收器不会要求他了。这不是严格的泄漏，但是也会导致比平常更高的内存使用率。<br><br>Google在 JavaScript Memory Profiling docs, example #2.文章中，提供了一个优秀的例子。<br></p><h3 id="编写javascript代码时的优化"><a href="#编写javascript代码时的优化" class="headerlink" title="编写javascript代码时的优化"></a>编写javascript代码时的优化</h3><h4 id="1-从JavaScript的作用域谈起"><a href="#1-从JavaScript的作用域谈起" class="headerlink" title="1.从JavaScript的作用域谈起"></a>1.从JavaScript的作用域谈起</h4><p>当JavaScript代码执行时，JavaScript引擎会创建一个执行环境，又叫执行上下文。执行环境定义了变量或函数有权访问的其他数据，决定了它们的行为，每个执行环境都有一个与它关联的变量对象，环境中定义的所有函数、变量都保存在这个对象中。在页面加载的时候，JavaScript引擎会创建一个全局的执行环境，所有全局变量和函数都是作为window对象（浏览器中）的属性和方法创建的。在此之后，每执行一个函数，JavaScript引擎都会创建一个对应的执行环境，并将该环境放入环境栈中，所以当前正在执行的函数的执行环境是在环境栈的最顶部的，当函数执行完毕之后，其执行环境会弹出栈，并被销毁，保存在其中的变量和函数定义也会被销毁。<br><br>当代码在一个执行环境中执行时，JavaScript引擎会创建变量对象的一个作用域链，它可以保证对执行环境有权访问的变量和函数的有序访问。作用域链的前端始终是当前执行的代码所在的环境的变量对象。全局环境的作用域链中只有一个变量对象，它定义了所有可用的全局变量和函数。当函数被创建时，JavaScript引擎会把创建时执行环境的作用域链赋给函数的内部属性[[scope]]；当函数被执行时，JavaScript引擎会创建一个活动对象，最开始时这个活动对象只有一个变量，即arguments对象。该活动对象会出现在执行环境作用域链的顶端，接下来是函数[[scope]]属性中的对象。<br><br>当需要查找某个变量或函数时，JavaScript引擎会通过执行环境的作用域链来查找变量和函数，从作用域链的顶端开始，如果没找到，则向下寻找直至找到为止。若一直到全局作用域都没有找到,则该变量或函数为undefined。<br><br>举个栗子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = add(<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure></p><p>代码执行时，add函数有一个仅包含全局变量对象的[[scope]]属性，add函数执行时，JavaScript引擎创建新的执行环境以及一个包含this、arguments、a、b的活动对象，并将其添加到作用域链中。如下图所示：<br><img src="https://images2015.cnblogs.com/blog/861963/201603/861963-20160324125541214-276062560.png" alt="img"></p><h4 id="2-使用局部变量"><a href="#2-使用局部变量" class="headerlink" title="2.使用局部变量"></a>2.使用局部变量</h4><p>了解了作用域链的概念，我们应该知道在查找变量会从作用域链的顶端开始一层一层的向下找。显然，查找的层数越多，花费的时间越多。所以为了提高查找的速度，我们应该尽量使用 局部变量（到目前为止，局部变量是JavaScript中读写最快的标识符）。<br><br>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createEle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createEle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> doc = <span class="built_in">document</span>;</span><br><span class="line">    doc.createElement(<span class="string">"div"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当document使用次数比较少时，可能无所谓，可是如果在一个函数的循环中大量使用document，我们可以提前将document变成局部变量。<br><br>来看看jquery怎么写的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">     <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure></p><p>这样写的优势：<br><br>1、window和undefined都是为了减少变量查找所经过的scope作用域。当window通过传递给闭包内部之后，在闭包内部使用它的时候，可以把它当成一个局部变量，显然比原先在window scope下查找的时候要快一些。（原来的window处于作用域链的最顶端，查找速度慢）<br><br>2、在jquery压缩版本jquery.min.js中可以将局部变量window替换成单个字母，减小文件大小，提高加载速度<br><br><img src="https://images2015.cnblogs.com/blog/861963/201603/861963-20160306142846424-1341096196.png" alt="img"><br>3、undefined也是JavaScript中的全局属性。将undefined作为参数传递给闭包，因为没给它传递值，它的值就是undefined，这样闭包内部在使用它的时候就可以把它当做局部变量使用，从而提高查找速度。undefined并不是JavaScript的保留字或者关键字。<br><br>4、undefined在某些低版本的浏览器（例如IE8、IE7）中值是可以被修改的（在ECMAScript3中，undefined是可读/写的变量，可以给它赋任意值，这个错误在ECMAScript5中做了修正），将undefined作为参数并且不给它传值可以防止因undefined的值被修改而产生的错误。</p><h4 id="3-避免增长作用域链"><a href="#3-避免增长作用域链" class="headerlink" title="3.避免增长作用域链"></a>3.避免增长作用域链<br></h4><p>在JavaScript中，有两种语句可以临时增加作用域链：with、try-catch<br><br>with可以使对象的属性可以像全局变量来使用，它实际上是将一个新的变量对象添加到执行环境作用域的顶部，这个变量对象包含了指定对象的所有属性，因此可以直接访问。<br><br>这样看似很方便，但是增长了作用域链，原来函数中的局部变量不在处于作用域链的顶端，因此在访问这些变量的时候要查找到第二层才能找到它。当with语句块之行结束后，作用域链将回到原来的状态。鉴于with的这个缺点，所以不推荐使用。<br><br>try-catch中的catch从句和with类似，也是在作用域链的顶端增加了一个对象，该对象包含了由catch指定命名的异常对象。但是因为catch语句只有在放生错误的时候才执行，因此影响比较少。</p><h4 id="4-字符串链接优化"><a href="#4-字符串链接优化" class="headerlink" title="4.字符串链接优化"></a>4.字符串链接优化</h4><p>由于字符串是不可变的，所以在进行字符串连接时，需要创建临时字符串。频繁创建、销毁临时字符串会导致性能低下。<br><br>当然，这个问题在新版本浏览器包括IE8+中都得到了优化，所以不需要担心<br><br>在低版本浏览器（IE6、IE7）中，我们可以种数组的join方法来代替。<br><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> temp = [];</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">temp[i++] = <span class="string">"Hello"</span>;</span><br><span class="line">temp[i++] = <span class="string">" "</span>;</span><br><span class="line">temp[i++] =<span class="string">"everyone"</span>;</span><br><span class="line"><span class="keyword">var</span> outcome = temp.join(<span class="string">""</span>);</span><br></pre></td></tr></table></figure></p><h4 id="5-条件判断"><a href="#5-条件判断" class="headerlink" title="5.条件判断"></a>5.条件判断</h4><p>当出现条件判断时，我们采用什么样的结构才能使性能最优？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(val == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> v0;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(val == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> v1;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(val == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> v2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(val == <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> v3;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(val == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当条件分支比较多时，我们可以斟酌哪种条件出现的概率比较大，并将对应的语句放在最上面，这样可以减少判断次数。<br><br>使用switch语句，新版的浏览器基本上都对switch做了优化，这样层数比较深时，性能比if会更好<br><br>使用数组：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v = [v0,v1,v2,v3,v4];</span><br><span class="line"><span class="keyword">return</span> v[valeue];</span><br></pre></td></tr></table></figure></p><p>要求：对应的结果是单一值，而不是一系列操作<br><br>另外，其他方面的优化，譬如<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition1) &#123;</span><br><span class="line">    <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line"><span class="keyword">if</span>(condition1) &#123;</span><br><span class="line">    <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v2;</span><br></pre></td></tr></table></figure></p><h4 id="6-快速循环"><a href="#6-快速循环" class="headerlink" title="6.快速循环"></a>6.快速循环</h4><p>1、循环总次数使用局部变量<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>;i &lt; arr.length;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line"><span class="keyword">var</span> len = arr.length;</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这样就避免了每次循环的属性查找。这点尤其重要，因为在进行dom操作时，很多人会这样写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> divList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"div"</span>);</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>;i &lt; divList.length;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>查找DOM元素的属性是相对耗时的，所以应该避免这种写法。<br><br>2、如果可以，递减代替递增<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i &lt; arr.length;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = arr.length - <span class="number">1</span>;i--;) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(i &lt; arr.length) &#123;</span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line"><span class="keyword">var</span> i = arr.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(i--) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>i=0的时候会直接跳出，循环次数比较多时还是很有用的。</p><h4 id="7-展开循环"><a href="#7-展开循环" class="headerlink" title="7.展开循环"></a>7.展开循环</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = arr.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(i--) &#123;</span><br><span class="line">    dosomething(arr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>遇到这样的情况时，执行一次循环的时候我们可以选择不止执行一次函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> interations = <span class="built_in">Math</span>.floor(arr.length / <span class="number">8</span>);</span><br><span class="line"><span class="keyword">var</span> left = arr.length % <span class="number">8</span>;</span><br><span class="line"><span class="keyword">var</span>  i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(left) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        dosomething(arr[i++]);</span><br><span class="line">    &#125; <span class="keyword">while</span>(--left);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">    dosomething(arr[i++]);</span><br><span class="line">&#125; <span class="keyword">while</span>(--interations);</span><br></pre></td></tr></table></figure></p><p>当遇到大数组，减少循环的开销，性能不就提上去了嘛。（至于为什么是每次循环，调8次函数，大牛测出来的，这样达到最佳）</p><h4 id="8-高效存取数据"><a href="#8-高效存取数据" class="headerlink" title="8.高效存取数据"></a>8.高效存取数据</h4><p>JavaScript中4种地方可以存取数据：<br><br>字面量值；变量；数组元素；对象属性<br><br>字面量值和变量中存取数据是最快的，从数组元素和对象属性中存取数据相对较慢，并且随着深度增加，存取速度会越来越慢，譬如obj.item.value就比obj.item慢。<br><br>某些情况下我们可以将对象、数组属性存成局部变量来提高速度，譬如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>;i &lt; arr.length;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line"><span class="keyword">var</span> len = arr.length;</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> divList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"div"</span>);</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>;i &lt; divList.length;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">var</span> divList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"div"</span>);</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>,len = divList.length;i &lt; len;i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="9-事件委托"><a href="#9-事件委托" class="headerlink" title="9.事件委托"></a>9.事件委托</h4><p>事件委托就是利用冒泡的原理，将原本应该添加在某些元素身上的监听事件，添加到其父元素身上，来达到提高性能的效果。<br><br>举个栗子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">1</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;2&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">3</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;4&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">5</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;6&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">7</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;8&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">9</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;10&lt;/</span>li&gt;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'ul'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> liList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'li'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>,len = liList.length;i &lt; len;i++) &#123;</span><br><span class="line">        liList[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(<span class="keyword">this</span>.innerHTML);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>这样我们就为每个li添加了监听事件了。<br><br>显然，我们通过循环为每个li添加监听事件是不优化的。这样不仅浪费了内存，在新的li加入的时候我们还要重新为它添加监听事件。<br><br>我们可以这样写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">1</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;2&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">3</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;4&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">5</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;6&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">7</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;8&lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;<span class="number">9</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;10&lt;/</span>li&gt;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'ul'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> liList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'li'</span>);</span><br><span class="line"></span><br><span class="line">    ul.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> e = e || <span class="built_in">window</span>.event;</span><br><span class="line">        <span class="keyword">var</span> target = e.target || e.srcElement;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(target.nodeName.toLowerCase() == <span class="string">"li"</span>) &#123;</span><br><span class="line">            alert(target.innerHTML);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>这样写的好处：<br><br>只添加一个监听事件，节省了内存；新加入li的时候我们也不用为它单独添加监听事件；在页面中添加事件处理程序所需的时候更少，因为我们只需要为一个DOM元素添加事件处理程序。</p><h3 id="使用typescript"><a href="#使用typescript" class="headerlink" title="使用typescript"></a>使用typescript</h3><p>使用typescript来提高性能我实在一本关于nodejs的书里看到的，主要还是用在chrome的V8引擎上，这本书里写的比如<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个数相加的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(add(i + i*<span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>书里说，如果V8引擎发现一个函数使用频率很高，而且参数传入的都是同一种类型的，好像是在内存寻址的时候书都很快，因为引擎认为传入的参数就是int型。<br><br>再来看一个例子<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个数相加的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span>(i % <span class="number">8</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(add(i + i*<span class="number">0.3</span>)); <span class="comment">// 这里出现了浮点数</span></span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(add(i + i*<span class="number">3</span>)); <span class="comment">// 这里是整数</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上边的代码可以看到，在使用整形参数的时候突然传入浮点数，V8引擎寻址机制突然变化，丢弃之前的函数，使用新的来计算，性能下降。<br><br>所以，如果使用typescript，类型固定，这样性能就会提高哦。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue双向绑定的简单实现</title>
      <link href="/2018/08/30/vue%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/"/>
      <url>/2018/08/30/vue%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>参考网上vue实现教程简单整理<br><a id="more"></a></p><h2 id="vue双向绑定的简单实现"><a href="#vue双向绑定的简单实现" class="headerlink" title="vue双向绑定的简单实现"></a>vue双向绑定的简单实现</h2><p>&emsp;&emsp;首先，这篇文章并非我的原创，在网上看到了很多写vue原理的文章，感觉这篇写的层次结构清晰，容易理解，所以留作收藏。<br>废话不多说，开始。</p><h3 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h3><p>&emsp;&emsp;Vue的双向数据绑定的原理相信大家也都十分了解了，主要是通过 Object对象的defineProperty属性，重写data的set和get函数来实现的,这里对原理不做过多描述，主要还是来实现一个实例。为了使代码更加的清晰，这里只会实现最基本的内容，主要实现v-model，v-bind 和v-click三个命令，其他命令也可以自行补充。<br><br>添加网上的一张图<br><br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/aVp1YC8UV0f0zE1BuK03NMJDibwUmypG8icoXmEwXflpO3TQh4CiaKx0VRTHWlyRQbmX5I3USiaHtSoibZ8yvX98jtg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h3 id="2-实现"><a href="#2-实现" class="headerlink" title="2.实现"></a>2.实现</h3><p>页面结构很简单，如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"number"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ype</span>=<span class="string">"button"</span> <span class="attr">v-click</span>=<span class="string">"increment"</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-bind</span>=<span class="string">"number"</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>包含：<br><br>1.一个input，使用v-model指令<br><br>2.一个button，使用v-click指令<br><br>3.一个h3，使用v-bind指令。<br><br>我们最后会通过类似于vue的方式来使用我们的双向数据绑定，结合我们的数据结构添加注释：<br><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> myVue(&#123;</span><br><span class="line">            el:<span class="string">'#app'</span>,</span><br><span class="line">            data:&#123;</span><br><span class="line">              number:<span class="number">0</span>    </span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;</span><br><span class="line">              increment:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.number++;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></p><p>首先我们需要定义一个myVue构造函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myVue</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>为了初始化这个构造函数，给它添加一 个_init属性<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myVue</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._init(options);</span><br><span class="line">&#125;</span><br><span class="line">myVue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.$options = options;  <span class="comment">// options 为上面使用时传入的结构体，包括el,data,methods</span></span><br><span class="line">    <span class="keyword">this</span>.$el = <span class="built_in">document</span>.querySelector(options.el); <span class="comment">// el是 #app, this.$el是id为app的Element元素</span></span><br><span class="line">    <span class="keyword">this</span>.$data = options.data; <span class="comment">// this.$data = &#123;number: 0&#125;</span></span><br><span class="line">    <span class="keyword">this</span>.$methods = options.methods;  <span class="comment">// this.$methods = &#123;increment: function()&#123;&#125;&#125;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>接下来实现_obverse函数，对data进行处理，重写data的set和get函数<br><br>并改造_init函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">myVue.prototype._obverse = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123; <span class="comment">// obj = &#123;number: 0&#125;</span></span><br><span class="line">   <span class="keyword">var</span> value;</span><br><span class="line">   <span class="keyword">for</span> (key <span class="keyword">in</span> obj) &#123;  <span class="comment">//遍历obj对象</span></span><br><span class="line">     <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">       value = obj[key]; </span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'object'</span>) &#123;  <span class="comment">//如果值还是对象，则遍历处理</span></span><br><span class="line">         <span class="keyword">this</span>._obverse(value);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.$data, key, &#123;  <span class="comment">//关键</span></span><br><span class="line">         enumerable: <span class="literal">true</span>,</span><br><span class="line">         configurable: <span class="literal">true</span>,</span><br><span class="line">         <span class="keyword">get</span>: function () &#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">`获取<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">           <span class="keyword">return</span> value;</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="keyword">set</span>: function (newVal) &#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">`更新<span class="subst">$&#123;newVal&#125;</span>`</span>);</span><br><span class="line">           <span class="keyword">if</span> (value !== newVal) &#123;</span><br><span class="line">             value = newVal;</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">myVue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.$options = options;</span><br><span class="line">   <span class="keyword">this</span>.$el = <span class="built_in">document</span>.querySelector(options.el);</span><br><span class="line">   <span class="keyword">this</span>.$data = options.data;</span><br><span class="line">   <span class="keyword">this</span>.$methods = options.methods;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">this</span>._obverse(<span class="keyword">this</span>.$data);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>接下来我们写一个指令类Watcher，用来绑定更新函数，实现对DOM元素的更新<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Watcher</span>(<span class="params">name, el, vm, exp, attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;         <span class="comment">//指令名称，例如文本节点，该值设为"text"</span></span><br><span class="line">    <span class="keyword">this</span>.el = el;             <span class="comment">//指令对应的DOM元素</span></span><br><span class="line">    <span class="keyword">this</span>.vm = vm;             <span class="comment">//指令所属myVue实例</span></span><br><span class="line">    <span class="keyword">this</span>.exp = exp;           <span class="comment">//指令对应的值，本例如"number"</span></span><br><span class="line">    <span class="keyword">this</span>.attr = attr;         <span class="comment">//绑定的属性值，本例为"innerHTML"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.update();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Watcher.prototype.update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.el[<span class="keyword">this</span>.attr] = <span class="keyword">this</span>.vm.$data[<span class="keyword">this</span>.exp]; <span class="comment">//比如 H3.innerHTML = this.data.number; 当number改变时，会触发这个update函数，保证对应的DOM内容进行了更新。</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>更新_init函数以及_obverse函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">myVue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">this</span>._binding = &#123;&#125;;   <span class="comment">//_binding保存着model与view的映射关系，也就是我们前面定义的Watcher的实例。当model改变时，我们会触发其中的指令类更新，保证view也能实时更新</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  myVue.prototype._obverse = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">      <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">        <span class="keyword">this</span>._binding[key] = &#123;    <span class="comment">// 按照前面的数据，_binding = &#123;number: _directives: []&#125;                                                                                                                                                  </span></span><br><span class="line">          _directives: []</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">var</span> binding = <span class="keyword">this</span>._binding[key];</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.$data, key, &#123;</span><br><span class="line">          <span class="comment">//...</span></span><br><span class="line">          <span class="keyword">set</span>: function (newVal) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`更新<span class="subst">$&#123;newVal&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">if</span> (value !== newVal) &#123;</span><br><span class="line">              value = newVal;</span><br><span class="line">              binding._directives.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;  <span class="comment">// 当number改变时，触发_binding[number]._directives 中的绑定的Watcher类的更新</span></span><br><span class="line">                item.update();</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>  那么如何将view与model进行绑定呢？接下来我们定义一个_compile函数，用来解析我们的指令（v-bind,v-model,v-clickde）等，并在这个过程中对view与model进行绑定。<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">   myVue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">this</span>._complie(<span class="keyword">this</span>.$el);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">myVue.prototype._complie = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123; root 为 id为app的Element元素，也就是我们的根元素</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> nodes = root.children;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nodes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> node = nodes[i];</span><br><span class="line">      <span class="keyword">if</span> (node.children.length) &#123;  <span class="comment">// 对所有元素进行遍历，并进行处理</span></span><br><span class="line">        <span class="keyword">this</span>._complie(node);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.hasAttribute(<span class="string">'v-click'</span>)) &#123;  <span class="comment">// 如果有v-click属性，我们监听它的onclick事件，触发increment事件，即number++</span></span><br><span class="line">        node.onclick = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> attrVal = nodes[i].getAttribute(<span class="string">'v-click'</span>);</span><br><span class="line">          <span class="keyword">return</span> _this.$methods[attrVal].bind(_this.$data);  <span class="comment">//bind是使data的作用域与method函数的作用域保持一致</span></span><br><span class="line">        &#125;)();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.hasAttribute(<span class="string">'v-model'</span>) &amp;&amp; (node.tagName == <span class="string">'INPUT'</span> || node.tagName == <span class="string">'TEXTAREA'</span>)) &#123; <span class="comment">// 如果有v-model属性，并且元素是INPUT或者TEXTAREA，我们监听它的input事件</span></span><br><span class="line">        node.addEventListener(<span class="string">'input'</span>, (<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;  </span><br><span class="line">          <span class="keyword">var</span> attrVal = node.getAttribute(<span class="string">'v-model'</span>);</span><br><span class="line">           <span class="comment">//_this._binding['number']._directives = [一个Watcher实例]</span></span><br><span class="line">           <span class="comment">// 其中Watcher.prototype.update = function () &#123;</span></span><br><span class="line">           <span class="comment">//    node['vaule'] = _this.$data['number'];  这就将node的值保持与number一致</span></span><br><span class="line">           <span class="comment">// &#125;</span></span><br><span class="line">          _this._binding[attrVal]._directives.push(<span class="keyword">new</span> Watcher(  </span><br><span class="line">            <span class="string">'input'</span>,</span><br><span class="line">            node,</span><br><span class="line">            _this,</span><br><span class="line">            attrVal,</span><br><span class="line">            <span class="string">'value'</span></span><br><span class="line">          ))</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            _this.$data[attrVal] =  nodes[key].value; <span class="comment">// 使number 的值与 node的value保持一致，已经实现了双向绑定</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)(i));</span><br><span class="line">      &#125; </span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.hasAttribute(<span class="string">'v-bind'</span>)) &#123; <span class="comment">// 如果有v-bind属性，我们只要使node的值及时更新为data中number的值即可</span></span><br><span class="line">        <span class="keyword">var</span> attrVal = node.getAttribute(<span class="string">'v-bind'</span>);</span><br><span class="line">        _this._binding[attrVal]._directives.push(<span class="keyword">new</span> Watcher(</span><br><span class="line">          <span class="string">'text'</span>,</span><br><span class="line">          node,</span><br><span class="line">          _this,</span><br><span class="line">          attrVal,</span><br><span class="line">          <span class="string">'innerHTML'</span></span><br><span class="line">        ))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>  至此，我们已经实现了一个简单vue的双向绑定功能，包括v-bind, v-model, v-click三个指令。效果如下图<br>  <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fq7aw6sl3hg30go072qva.gif" alt="img"><br>  附上全部代码，不到150行<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">  &lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;myVue&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  #app &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;input type="text"  v-model="number"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button type="button" v-click="increment"&gt;增加&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h3 v-bind="number"&gt;&lt;/</span>h3&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">myVue</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._init(options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  myVue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.$options = options;</span><br><span class="line">    <span class="keyword">this</span>.$el = <span class="built_in">document</span>.querySelector(options.el);</span><br><span class="line">    <span class="keyword">this</span>.$data = options.data;</span><br><span class="line">    <span class="keyword">this</span>.$methods = options.methods;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>._binding = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>._obverse(<span class="keyword">this</span>.$data);</span><br><span class="line">    <span class="keyword">this</span>._complie(<span class="keyword">this</span>.$el);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  myVue.prototype._obverse = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value;</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">        <span class="keyword">this</span>._binding[key] = &#123;                                                                                                                                                          </span><br><span class="line">          _directives: []</span><br><span class="line">        &#125;;</span><br><span class="line">        value = obj[key];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'object'</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>._obverse(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> binding = <span class="keyword">this</span>._binding[key];</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.$data, key, &#123;</span><br><span class="line">          enumerable: <span class="literal">true</span>,</span><br><span class="line">          configurable: <span class="literal">true</span>,</span><br><span class="line">          <span class="keyword">get</span>: function () &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`获取<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="keyword">set</span>: function (newVal) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`更新<span class="subst">$&#123;newVal&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">if</span> (value !== newVal) &#123;</span><br><span class="line">              value = newVal;</span><br><span class="line">              binding._directives.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">                item.update();</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  myVue.prototype._complie = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> nodes = root.children;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nodes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> node = nodes[i];</span><br><span class="line">      <span class="keyword">if</span> (node.children.length) &#123;</span><br><span class="line">        <span class="keyword">this</span>._complie(node);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.hasAttribute(<span class="string">'v-click'</span>)) &#123;</span><br><span class="line">        node.onclick = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> attrVal = nodes[i].getAttribute(<span class="string">'v-click'</span>);</span><br><span class="line">          <span class="keyword">return</span> _this.$methods[attrVal].bind(_this.$data);</span><br><span class="line">        &#125;)();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.hasAttribute(<span class="string">'v-model'</span>) &amp;&amp; (node.tagName == <span class="string">'INPUT'</span> || node.tagName == <span class="string">'TEXTAREA'</span>)) &#123;</span><br><span class="line">        node.addEventListener(<span class="string">'input'</span>, (<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> attrVal = node.getAttribute(<span class="string">'v-model'</span>);</span><br><span class="line">          _this._binding[attrVal]._directives.push(<span class="keyword">new</span> Watcher(</span><br><span class="line">            <span class="string">'input'</span>,</span><br><span class="line">            node,</span><br><span class="line">            _this,</span><br><span class="line">            attrVal,</span><br><span class="line">            <span class="string">'value'</span></span><br><span class="line">          ))</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            _this.$data[attrVal] =  nodes[key].value;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)(i));</span><br><span class="line">      &#125; </span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.hasAttribute(<span class="string">'v-bind'</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> attrVal = node.getAttribute(<span class="string">'v-bind'</span>);</span><br><span class="line">        _this._binding[attrVal]._directives.push(<span class="keyword">new</span> Watcher(</span><br><span class="line">          <span class="string">'text'</span>,</span><br><span class="line">          node,</span><br><span class="line">          _this,</span><br><span class="line">          attrVal,</span><br><span class="line">          <span class="string">'innerHTML'</span></span><br><span class="line">        ))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Watcher</span>(<span class="params">name, el, vm, exp, attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;         <span class="comment">//指令名称，例如文本节点，该值设为"text"</span></span><br><span class="line">    <span class="keyword">this</span>.el = el;             <span class="comment">//指令对应的DOM元素</span></span><br><span class="line">    <span class="keyword">this</span>.vm = vm;             <span class="comment">//指令所属myVue实例</span></span><br><span class="line">    <span class="keyword">this</span>.exp = exp;           <span class="comment">//指令对应的值，本例如"number"</span></span><br><span class="line">    <span class="keyword">this</span>.attr = attr;         <span class="comment">//绑定的属性值，本例为"innerHTML"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.update();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Watcher.prototype.update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.el[<span class="keyword">this</span>.attr] = <span class="keyword">this</span>.vm.$data[<span class="keyword">this</span>.exp];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> app = <span class="keyword">new</span> myVue(&#123;</span><br><span class="line">      el:<span class="string">'#app'</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        number: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        increment: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.number ++;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>以上就是所有内容，这个代码不是我创造的，我只是代码的搬运工。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webSocket</title>
      <link href="/2018/08/29/webSocket%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2018/08/29/webSocket%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>在项目中使用websocket的小心得<br><a id="more"></a></p><h2 id="webSocket在项目中的使用"><a href="#webSocket在项目中的使用" class="headerlink" title="webSocket在项目中的使用"></a>webSocket在项目中的使用</h2><p>&emsp;&emsp;webSocket,这个技术相信大家都已经很熟悉了，就是前端浏览器与后端服务器一直保持连通状态，我们在项目中，经常会遇到这样的需求，一个数据图表展示页面，产品的需求是每隔5秒钟页面刷新一次，传统的做法是请求轮询机制，也就是setInterval这个定时器，一遍又一遍的请求后端接口，这个方法简单（特别是后端简单），但是如果前端页面有大量的这种需求，会影响性能，所以，webSocket是现在最好的选择。<br>&emsp;&emsp;其实webSocket现在还是比较重要的，一般在面试的时候，被问到的几率还是很大的。我之前在项目中没有用到过，但是自己写过webSocket的demo，浏览器配合nodejs来写，也是参考了网上的代码，还是很简单的<a href="https://github.com/jinux7/study-collections/tree/master/websocket-test" target="_blank" rel="noopener">webSocket详细代码看这里</a>。在面试时被问到的时候，也是实话实说，有可能面试官也是小白，基本上都没往下问，但是，确实是这么简单吗？答案显然不是，待我慢慢道来。<br>&emsp;&emsp;首先，我在最近两个项目中，都用到了webSocket，所以还是有发言权的。如果，产品提出了webSocket的需求，对于我们前端来说，并不是直接写个原生的webSocket就可以，而是需要看后端小伙伴们的脸色，什么意思？就是说得看后端用的是什么webSocket库，我接触的有两种，第一个是stomp,说是webSocket的子协议，后端选了这个库之后，我们前端也得相应的选择与后端相配合的前端库，一般情况下，官网很明确的给出了后端和前端相配合写法，当然，写法也是很简单，跟原生差不多。第二个是，sockjs这个库，当然，也是后端小伙伴选好了之后，告诉我，我相应的在前端也用的跟后端一样库。<br>&emsp;&emsp;最后总结一下，webSocket技术并不难（对于我们前端来说，当然，nodejs的后端也很简单，java就不知道了，每次调起来看他们都是一脸懵逼的样子），无论是面试还是在实际工作中，问道这个问题时，我们首先想到的应该是，后端选择的是什么库，我们前端应该跟后端小伙伴保持一致，可别需求以来，觉得简单直接开些，等联调的时候，我靠，为什么连不上呢？你们前后端不在一个频道上，怎么连接啊。所以，我们要说，我做过的项目是这样这样滴，不知道这次我们后端小伙伴用到的webSocket库是什么呢？</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> webSocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs代理服务器</title>
      <link href="/2018/08/27/nodejs%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2018/08/27/nodejs%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>nodejs代理服务器简单实现<br><a id="more"></a></p><h2 id="nodejs代理服务"><a href="#nodejs代理服务" class="headerlink" title="nodejs代理服务"></a>nodejs代理服务</h2><p> 最近在与后台同事联调的时候，出现了点故障，跨域，这个经常碰到很好解决的问题，但是一般情况下需要前后端一起配合来解决，比如jsonp，或者h5后端在返回头加上允许跨域的头设置，但是如果后台同事是个小白，问啥啥不明白，也是没招了。我之前还用过将chrome的跨域设置给禁掉的方法，但是这次不知道为啥，也不好使了。最后，只能是用代理这种方式，我现在用的是vue框架，其实vue的脚手架已经集成了跨域功能，只需要配置一下就可以，但是，现在框架这么多，前一阵子还react，angular的项目，最近有换成vue，配置的话，肯定要去查看api，记不住啊，而且，版本不同，设置方法也不同，不如自己写一个，这样多简单，需要的时候把代理服务开启就搞定了。于是乎，自己写一个，当然，稍微想一下就知道，代理的原理，就是利用nodejs在中间做一次请求以及数据返回，不过自己写还得思考，上网找一下多简单，baidu一搜索，哇靠，第一个映入眼帘的就是nodejs代理服务8行代码，嗯，就是这么简单，废话不多说，上代码,当然，自己还得加工一下哦。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxyUrl = process.argv[<span class="number">2</span>] || <span class="string">'http://127.0.0.1:8888'</span>; <span class="comment">// 如果有传入的代理url，使用它</span></span><br><span class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"Content-Type,Content-Length, Authorization, Accept,X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>,<span class="string">' 3.2.1'</span>)</span><br><span class="line">    <span class="keyword">if</span>(req.method==<span class="string">"OPTIONS"</span>) res.send(<span class="number">200</span>); <span class="comment">// 让options请求快速返回</span></span><br><span class="line">    <span class="keyword">else</span>  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = proxyUrl + req.url;</span><br><span class="line">    req.pipe(request(url)).pipe(res);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(process.env.PORT || <span class="number">3000</span>, ()=&gt;&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'代理服务器，在3000端口已经开启'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p> 再把package.json文件内容贴出来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;node-proxy&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;serve&quot;: &quot;node server http://127.0.0.1:9000&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;express&quot;: &quot;^4.16.3&quot;,</span><br><span class="line">    &quot;request&quot;: &quot;^2.88.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/jinux7/study-collections/tree/master/node-proxy-代理服务器" target="_blank" rel="noopener">源码在这里</a></p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 后端代理服务 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
