<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jinux</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="/"/>
  <updated>2019-05-28T06:22:37.985Z</updated>
  <id>/</id>
  
  <author>
    <name>jinux</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>docker常用命令</title>
    <link href="/2019/05/28/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>/2019/05/28/docker常用命令/</id>
    <published>2019-05-28T06:14:50.000Z</published>
    <updated>2019-05-28T06:22:37.985Z</updated>
    
    <content type="html"><![CDATA[<p>docker常用命令<br><a id="more"></a></p><h2 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h2><p>最近想在win10下安装mysql5.6版本，装了半天没装成功，于是乎用docker来解决了。<br>docker需要命令行，这里以mysql为例，贴出一个别人的blog(懒得写了)。<br><a href="https://www.cnblogs.com/pwc1996/p/5425234.html" target="_blank" rel="noopener">docker运行mysql</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;docker常用命令&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="docker" scheme="/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>windows下git命令批处理执行</title>
    <link href="/2019/05/24/windows%E4%B8%8Bgit%E5%91%BD%E4%BB%A4%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8C/"/>
    <id>/2019/05/24/windows下git命令批处理执行/</id>
    <published>2019-05-24T06:04:09.000Z</published>
    <updated>2019-05-27T03:13:50.466Z</updated>
    
    <content type="html"><![CDATA[<p>win10操作系统下利用批处理程序来运行git操作。<br><a id="more"></a></p><h2 id="windows下git命令批处理执行"><a href="#windows下git命令批处理执行" class="headerlink" title="windows下git命令批处理执行"></a>windows下git命令批处理执行</h2><p>首先，我说一下我要这样做的起因，也许大家都会有感。<br>目前，我在做的项目是一个，但是下面分了5个子项目，这5个子项目，每一个自己拥有一个git仓库，所以，我在上传代码的操作就是，commit-&gt;pull-&gt;push,这样反复5回，因为有5个仓库嘛。有时候一天要好多次，效率太低了，于是我就想起了利用windows系统的批处理来做。<br>在使用批处理来操作git命令，首先需要把git的操作仓库方式改为ssh，使用ssh的话，还需要ssh key，ssh key的生成方法是，打开git的命令行工具，输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 首先检查一下现在电脑里是否已经有生成的ssh key</span><br><span class="line">cd ~/.ssh</span><br><span class="line">// ~这个符号我在git命令行下才能打出来，cmd没打出来。</span><br><span class="line">// ~/ 这个路径就是C:\Users\kaiya这个，看看现在是否已经有现成的ssh key</span><br><span class="line">// 如果有，就不用再生成了</span><br><span class="line"></span><br><span class="line">// 接下来是生成ssh key命令</span><br><span class="line">ssh-keygen -t rsa -C &quot;124076***@qq.com&quot;</span><br><span class="line">// 需要自己在电脑中注册的git邮箱,如果不知道，可以查一下 git config --global user.email</span><br><span class="line">// 生成的ssh key自动保存在C:\Users\kaiya这个目录下（这个是我的用户名）</span><br><span class="line">// 生成过程中一路回车就好，不用设置密码等</span><br></pre></td></tr></table></figure></p><p>有了ssh key，添加到github或自己公司的gitlab上就好了。<br>比如要添加到github上，登录账号进入自己的github库，步骤见下图<br><img src="/2019/05/24/windows下git命令批处理执行/1.png" alt="img"><br><img src="/2019/05/24/windows下git命令批处理执行/2.png" alt="img"><br>点进去之后，按照页面提示填写就可以了。<br>以上就是配置好了ssh key，之后就是用git拉取，推送代码了，这里有一个地方需要注意，那就是Git对仓库的操作方式，既然已经添加了ssh key，就需要用git的ssh提交方式。查看.git文件夹下的config文件，找到下面的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">  // 这个是ssh提交方式</span><br><span class="line">url = git@172.24.112.158:root/airport.git</span><br><span class="line">  </span><br><span class="line">  // 这个是http提交方式</span><br><span class="line">  url = http://172.24.112.158/root/webviewpage</span><br><span class="line"></span><br><span class="line">fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure></p><p>按照上面的写法，只留下ssh提交方式即可。<br>接下来，我们来写windows的批处理命令,先写一个处理一个仓库的git操作批处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">cd C:\WORK\git-ku\ejashop</span><br><span class="line">@echo off</span><br><span class="line">echo git批处理开始执行</span><br><span class="line">git status</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;update&quot;</span><br><span class="line">git pull</span><br><span class="line">git push</span><br><span class="line">echo ----------</span><br><span class="line">echo git commit pull push都已完成，点击任意键退出</span><br><span class="line">pause</span><br></pre></td></tr></table></figure></p><p>再写一个调用多个批处理文件的操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">pause</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\git&quot; call ehome.bat</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\git&quot; call airport.bat</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\git&quot; call eHomeOperation.bat</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\git&quot; call kaidian.bat</span><br></pre></td></tr></table></figure></p><p>这里，需要注意一下，因为批处理是在cmd命令行下执行的，所以要把git的环境变量配好哦。<br>好了，通过这样的方法，以后麻烦的git操作，点击一下就可以搞定喽。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;win10操作系统下利用批处理程序来运行git操作。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="计算机原理" scheme="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
      <category term="github" scheme="/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>多个ajax请求,页面渲染顺序问题</title>
    <link href="/2019/05/20/%E5%A4%9A%E4%B8%AAajax%E8%AF%B7%E6%B1%82-%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98/"/>
    <id>/2019/05/20/多个ajax请求-页面渲染顺序问题/</id>
    <published>2019-05-20T07:04:15.000Z</published>
    <updated>2019-05-21T00:52:30.868Z</updated>
    
    <content type="html"><![CDATA[<p>在一个页面中,多个ajax请求,页面渲染顺序问题。<br><a id="more"></a></p><h2 id="多个ajax请求-页面渲染顺序问题"><a href="#多个ajax请求-页面渲染顺序问题" class="headerlink" title="多个ajax请求,页面渲染顺序问题"></a>多个ajax请求,页面渲染顺序问题</h2><p>如题，比如说在一个页面中有两个按钮或者多个，按照先后顺序点击，都发出了ajax请求，但是他们返回的顺序就不会按照点击按钮的顺序返回，如果，它们操作的是页面的同一个显示区域，比如列表，那就ajax访问最慢的接口最后被渲染出来，有可能这个接口是用户最开始点击的按钮渲染出来的，这样就会产生错误信息，用户本想最后点击那个按钮返回的数据才是他想要的。<br>其实，这个问题我并没有遇到过，这个是大约一年前我再一次面试中被问到的，当时由于没有做好准备，我也只能诚实的回答没有遇到过此场景，今天我又来了兴致，把它的解决方法记录下来（我的拖延症是不是很严重），这个解决方式是我自己定的，其实也是实现起来比较简单的。<br>为了加快写作，直接把代码贴出来，在代码中写注释<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;script src=<span class="string">"./jquery.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  &lt;title&gt;多个ajax请求,页面渲染顺序问题&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;style&gt;</span></span><br><span class="line"><span class="regexp">    .content &#123;</span></span><br><span class="line"><span class="regexp">      width: 500px;</span></span><br><span class="line"><span class="regexp">      height: 100px;</span></span><br><span class="line"><span class="regexp">      background-color: #eeeeee;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>style&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="content"&gt;</span></span><br><span class="line"><span class="regexp">    原始内容</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">  &lt;button id=<span class="string">"btn1"</span>&gt;按钮<span class="number">2</span>s&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button id="btn2"&gt;按钮5s&lt;/</span>button&gt;</span><br><span class="line">  &lt;button id=<span class="string">"btn3"</span>&gt;按钮<span class="number">3</span>s&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 后端地址</span></span><br><span class="line">  <span class="keyword">var</span> baseUrl = <span class="string">"http://localhost:3000/"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存放ajax标志的数组，用来区分是哪个ajax</span></span><br><span class="line">  <span class="keyword">var</span> orderArr = [];</span><br><span class="line">  <span class="comment">// 按钮1加点击事件</span></span><br><span class="line">  $(<span class="string">'#btn1'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将btn1按钮的标志传入数组</span></span><br><span class="line">    ajaxOrder(<span class="string">'btn1'</span>);</span><br><span class="line">    $.post(baseUrl+<span class="string">'delay2s'</span>, (res)=&gt; &#123;</span><br><span class="line">      <span class="comment">// 渲染页面</span></span><br><span class="line">      render(<span class="string">'btn1'</span>, res.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 按钮2加点击事件</span></span><br><span class="line">  $(<span class="string">'#btn2'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ajaxOrder(<span class="string">'btn2'</span>);</span><br><span class="line">    $.post(baseUrl+<span class="string">'delay5s'</span>, (res)=&gt; &#123;</span><br><span class="line">      render(<span class="string">'btn2'</span>, res.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 按钮3加点击事件</span></span><br><span class="line">  $(<span class="string">'#btn3'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ajaxOrder(<span class="string">'btn3'</span>);</span><br><span class="line">    $.post(baseUrl+<span class="string">'delay3s'</span>, (res)=&gt; &#123;</span><br><span class="line">      render(<span class="string">'btn3'</span>, res.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 向存放ajax标志位数组中push ajax标志</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajaxOrder</span>(<span class="params">flag</span>) </span>&#123;</span><br><span class="line">    orderArr.push(flag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据ajax的标志来渲染页面</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">flag, val</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果数组中只有一个标志的情况，直接渲染并清空数组</span></span><br><span class="line">    <span class="keyword">if</span>(orderArr.length === <span class="number">1</span>) &#123;</span><br><span class="line">      orderArr = [];</span><br><span class="line">      $(<span class="string">'.content'</span>).html(val);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果标志数组中多余一个标志</span></span><br><span class="line">    <span class="keyword">if</span>(orderArr.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果这个标志是第一个请求的标志，则渲染页面</span></span><br><span class="line">      <span class="keyword">if</span>(orderArr.indexOf(flag) === <span class="number">0</span>) &#123;</span><br><span class="line">        orderArr.shift();</span><br><span class="line">        $(<span class="string">'.content'</span>).html(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123; <span class="comment">// 如果不是第一个，则不渲染页面，并把这个标志剔除</span></span><br><span class="line">        <span class="keyword">let</span> index = orderArr.indexOf(flag);</span><br><span class="line">        orderArr.splice(index,<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><p>大概的流程就是，按照按钮点击的顺序来显示请求的结果。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在一个页面中,多个ajax请求,页面渲染顺序问题。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="面试题" scheme="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>webpack打包多页面项目</title>
    <link href="/2019/05/20/webpack%E6%89%93%E5%8C%85%E5%A4%9A%E9%A1%B5%E9%9D%A2%E9%A1%B9%E7%9B%AE/"/>
    <id>/2019/05/20/webpack打包多页面项目/</id>
    <published>2019-05-20T02:26:35.000Z</published>
    <updated>2019-05-20T02:46:28.390Z</updated>
    
    <content type="html"><![CDATA[<p>webpack打包多页面项目<br><a id="more"></a></p><h2 id="webpack打包多页面项目"><a href="#webpack打包多页面项目" class="headerlink" title="webpack打包多页面项目"></a>webpack打包多页面项目</h2><p>平时我们在工作中，使用webpack来打包单页面应用的项目很多，多页面应用之前我都是使用gulp来做，今天我在github发现一个不错的demo，我就不写具体的分析步骤了，代码里边写的很清楚，直接贴地址喽。<br><a href="https://github.com/jixoba/webpack-dev" target="_blank" rel="noopener">点击这里看项目</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;webpack打包多页面项目&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="webpack" scheme="/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>手写自动化构建工具</title>
    <link href="/2019/05/15/%E6%89%8B%E5%86%99%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
    <id>/2019/05/15/手写自动化构建工具/</id>
    <published>2019-05-15T06:38:40.000Z</published>
    <updated>2019-05-15T06:38:40.843Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="xxx" scheme="/tags/xxx/"/>
    
  </entry>
  
  <entry>
    <title>import和require的本质区别</title>
    <link href="/2019/05/09/import%E5%92%8Crequire%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB/"/>
    <id>/2019/05/09/import和require的本质区别/</id>
    <published>2019-05-09T08:00:05.000Z</published>
    <updated>2019-05-09T08:44:15.447Z</updated>
    
    <content type="html"><![CDATA[<p>简单的说一下import和require的本质区别<br><a id="more"></a></p><h2 id="import和require的本质区别"><a href="#import和require的本质区别" class="headerlink" title="import和require的本质区别"></a>import和require的本质区别</h2><p>import是ES6的模块规范，require是commonjs的模块规范，详细的用法我不介绍，我只想说一下他们最基本的区别，import是静态加载模块，require是动态加载，那么静态加载和动态加载的区别是什么呢？<br>静态加载时代码在编译的时候已经执行了，动态加载是编译后在代码运行的时候再执行，那么具体点是什么呢？<br>先说说import，如下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'name.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// name.js文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name = <span class="string">'jinux'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> age = <span class="number">20</span></span><br></pre></td></tr></table></figure></p><p>上面的代码表示main.js文件里引入了name.js文件导出的变量，在代码编译阶段执行后的代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">'jinux'</span></span><br></pre></td></tr></table></figure></p><p>这个是我自己理解的，其实就是直接把name.js里的代码放到了main.js文件里，好比是在main.js文件中声明一样。<br>再来看看require<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">require</span>(<span class="string">'obj.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.js文件</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'jinux'</span>,</span><br><span class="line">  age: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.export obj;</span><br></pre></td></tr></table></figure></p><p>require是在运行阶段，需要把obj对象整个加载进内存，之后用到哪个变量就用哪个，这里再对比一下import，import是静态加载，如果只引入了name，age是不会引入的，所以是按需引入，性能更高。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单的说一下import和require的本质区别&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>http常用状态码</title>
    <link href="/2019/05/06/http%E5%B8%B8%E7%94%A8%E7%8A%B6%E6%80%81%E7%A0%81/"/>
    <id>/2019/05/06/http常用状态码/</id>
    <published>2019-05-06T02:52:37.000Z</published>
    <updated>2019-05-06T05:21:56.964Z</updated>
    
    <content type="html"><![CDATA[<p>列出了一些常用的http请求状态码<br><a id="more"></a></p><h2 id="http常用状态码"><a href="#http常用状态码" class="headerlink" title="http常用状态码"></a>http常用状态码</h2><p>我们在日常开发中，经常会使用ajax，会看到请求返回的状态码，也就是Status Code。<br>常见的3个是:</p><ul><li>200 – 服务器成功返回网页</li><li>404 – 请求的网页不存在</li><li>503 – 服务器超时</li></ul><p>但是，作为一个合格的前端，还需要掌握的详细点，下面列出常用的状态码，也不是最全的哦。</p><h3 id="1xx（临时响应）"><a href="#1xx（临时响应）" class="headerlink" title="1xx（临时响应）"></a>1xx（临时响应）</h3><p>表示临时响应并需要请求者继续执行操作的状态码。</p><ul><li>100（继续）:    请求者应当继续提出请求。服务器返回此代码表示已收到请求的第一部分，正在等待其余部分。</li><li>101（切换协议）:    请求者已要求服务器切换协议，服务器已确认并准备切换。</li></ul><h3 id="2xx-（成功）"><a href="#2xx-（成功）" class="headerlink" title="2xx （成功）"></a>2xx （成功）</h3><p>表示成功处理了请求的状态码。</p><ul><li>200（成功）:    服务器已成功处理了请求。通常，这表示服务器提供了请求的网页。如果是对您的 robots.txt 文件显示此状态码，则表示 Googlebot 已成功检索到该文件。</li><li>201（已创建）:    请求成功并且服务器创建了新的资源。</li><li>202（已接受）:    服务器已接受请求，但尚未处理。</li><li>203（非授权信息）:    服务器已成功处理了请求，但返回的信息可能来自另一来源。</li><li>204（无内容）:    服务器成功处理了请求，但没有返回任何内容。</li><li>205（重置内容）:    服务器成功处理了请求，但没有返回任何内容。与 204 响应不同，此响应要求请求者重置文档视图（例如，清除表单内容以输入新内容）。</li><li>206（部分内容）:    服务器成功处理了部分 GET 请求。</li></ul><h3 id="3xx-（重定向）"><a href="#3xx-（重定向）" class="headerlink" title="3xx （重定向）"></a>3xx （重定向）</h3><p>要完成请求，需要进一步操作。通常，这些状态码用来重定向。</p><ul><li>300（多种选择）:    针对请求，服务器可执行多种操作。服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择。</li><li>301（永久移动）:    请求的网页已永久移动到新位置。服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。您应使用此代码告诉 Googlebot 某个网页或网站已永久移动到新位置。</li><li>302（临时移动）:    服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来响应以后的请求。此代码与响应 GET 和 HEAD 请求的 301 代码类似，会自动将请求者转到不同的位置，但您不应使用此代码来告诉 Googlebot 某个网页或网站已经移动，因为 Googlebot 会继续抓取原有位置并编制索引。</li><li>303（查看其他位置）: 请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码。对于除 HEAD 之外的所有请求，服务器会自动转到其他位置。</li><li>304（未修改）: 自从上次请求后，请求的网页未修改过。服务器返回此响应时，不会返回网页内容。如果网页自请求者上次请求后再也没有更改过，您应将服务器配置为返回此响应（称为 If-Modified-Since HTTP 标头）。服务器可以告诉 Googlebot 自从上次抓取后网页没有变更，进而节省带宽和开销。</li><li>305（使用代理）:    请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理。</li><li>307（临时重定向）:    服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来响应以后的请求。此代码与响应 GET 和 HEAD 请求的 <code>&lt;a href=answer.py?answer=&gt;301&lt;/a&gt;</code> 代码类似，会自动将请求者转到不同的位置，但您不应使用此代码来告诉 Googlebot 某个页面或网站已经移动，因为 Googlebot 会继续抓取原有位置并编制索引。</li></ul><h3 id="4xx（请求错误）"><a href="#4xx（请求错误）" class="headerlink" title="4xx（请求错误）"></a>4xx（请求错误）</h3><p>这些状态码表示请求可能出错，妨碍了服务器的处理。</p><ul><li>400（错误请求）: 服务器不理解请求的语法。</li><li>401（未授权）: 请求要求身份验证。对于登录后请求的网页，服务器可能返回此响应。</li><li>403（禁止）: 服务器拒绝请求。如果您在 Googlebot 尝试抓取您网站上的有效网页时看到此状态码（您可以在 Google 网站管理员工具诊断下的网络抓取页面上看到此信息），可能是您的服务器或主机拒绝了 Googlebot 访问。</li><li>404（未找到）: 服务器找不到请求的网页。例如，对于服务器上不存在的网页经常会返回此代码。</li><li>405（方法禁用）: 禁用请求中指定的方法。</li><li>406（不接受）:    无法使用请求的内容特性响应请求的网页。</li><li>407（需要代理授权）:    此状态码与 <code>&lt;a href=answer.py?answer=35128&gt;401（未授权）&lt;/a&gt;</code>类似，但指定请求者应当授权使用代理。如果服务器返回此响应，还表示请求者应当使用代理。</li><li>408（请求超时）:    服务器等候请求时发生超时。</li><li>409（冲突）:    服务器在完成请求时发生冲突。服务器必须在响应中包含有关冲突的信息。服务器在响应与前一个请求相冲突的 PUT 请求时可能会返回此代码，以及两个请求的差异列表。</li><li>410（已删除）:    如果请求的资源已永久删除，服务器就会返回此响应。该代码与 404（未找到）代码类似，但在资源以前存在而现在不存在的情况下，有时会用来替代 404 代码。如果资源已永久移动，您应使用 301 指定资源的新位置。</li><li>411（需要有效长度）:    服务器不接受不含有效内容长度标头字段的请求。</li><li>412（未满足前提条件）:    服务器未满足请求者在请求中设置的其中一个前提条件。</li><li>413（请求实体过大）:    服务器无法处理请求，因为请求实体过大，超出服务器的处理能力。</li><li>414（请求的 URI 过长）:    请求的 URI（通常为网址）过长，服务器无法处理。</li><li>415（不支持的媒体类型）:    请求的格式不受请求页面的支持。</li><li>416（请求范围不符合要求）:    如果页面无法提供请求的范围，则服务器会返回此状态码。</li><li>417（未满足期望值）:    服务器未满足”期望”请求标头字段的要求。</li></ul><h3 id="5xx（服务器错误）"><a href="#5xx（服务器错误）" class="headerlink" title="5xx（服务器错误）"></a>5xx（服务器错误）</h3><p>这些状态码表示服务器在处理请求时发生内部错误。这些错误可能是服务器本身的错误，而不是请求出错。</p><ul><li>500（服务器内部错误）    服务器遇到错误，无法完成请求。</li><li>501（尚未实施）    服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码。</li><li>502（错误网关）    服务器作为网关或代理，从上游服务器收到无效响应。</li><li>503（服务不可用）    服务器目前无法使用（由于超载或停机维护）。通常，这只是暂时状态。</li><li>504（网关超时）    服务器作为网关或代理，但是没有及时从上游服务器收到请求。</li><li>505（HTTP 版本不受支持）    服务器不支持请求中所用的 HTTP 协议版本。</li></ul><p>以上就是一些常用的http状态吗，如果想了解更多，<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noopener">点击这里喽</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;列出了一些常用的http请求状态码&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="网络基础" scheme="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>nodejs将vue的dist目录文件copy到目标目录</title>
    <link href="/2019/04/23/nodejs%E5%B0%86vue%E7%9A%84dist%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6copy%E5%88%B0%E7%9B%AE%E6%A0%87%E7%9B%AE%E5%BD%95/"/>
    <id>/2019/04/23/nodejs将vue的dist目录文件copy到目标目录/</id>
    <published>2019-04-23T05:32:30.000Z</published>
    <updated>2019-04-23T07:01:49.223Z</updated>
    
    <content type="html"><![CDATA[<p>利用nodejs拷贝转移文件<br><a id="more"></a></p><h2 id="nodejs将vue的dist目录文件copy到目标目录"><a href="#nodejs将vue的dist目录文件copy到目标目录" class="headerlink" title="nodejs将vue的dist目录文件copy到目标目录"></a>nodejs将vue的dist目录文件copy到目标目录</h2><p>上篇文章写了《window批处理执行webpack打包》，这篇文章主要写打包好的文件自动转移到git目录下。<br>其实就是用的nodejs的读写文件API而已，代码不多，见下面：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">let</span> fse = <span class="built_in">require</span>(<span class="string">'fs-extra'</span>) <span class="comment">// 文件的正删改查模块，比原生方便</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制文件</span></span><br><span class="line"><span class="keyword">var</span> copy=<span class="function"><span class="keyword">function</span>(<span class="params">src,dst</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> paths = fs.readdirSync(src); <span class="comment">//同步读取当前目录</span></span><br><span class="line">  paths.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _src=src+<span class="string">'/'</span>+path;</span><br><span class="line">      <span class="keyword">var</span> _dst=dst+<span class="string">'/'</span>+path;</span><br><span class="line">      fs.stat(_src,<span class="function"><span class="keyword">function</span>(<span class="params">err,stats</span>)</span>&#123;  <span class="comment">//stats  该对象 包含文件属性</span></span><br><span class="line">          <span class="keyword">if</span>(err)<span class="keyword">throw</span> err;</span><br><span class="line">          <span class="keyword">if</span>(stats.isFile())&#123; <span class="comment">//如果是个文件则拷贝 </span></span><br><span class="line">              <span class="keyword">let</span> _dst = dst+<span class="string">'/'</span> + path;</span><br><span class="line">              <span class="keyword">let</span>  readable=fs.createReadStream(_src);<span class="comment">//创建读取流</span></span><br><span class="line">              <span class="keyword">let</span>  writable=fs.createWriteStream(_dst);<span class="comment">//创建写入流</span></span><br><span class="line">              readable.pipe(writable);</span><br><span class="line">          &#125;<span class="keyword">else</span> <span class="keyword">if</span>(stats.isDirectory())&#123; <span class="comment">//是目录则 递归 </span></span><br><span class="line">              checkDirectory(_src,_dst,copy);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 检查文件夹是否存在，新建文件夹并copy</span></span><br><span class="line"><span class="keyword">var</span> checkDirectory=<span class="function"><span class="keyword">function</span>(<span class="params">src,dst,callback</span>)</span>&#123;</span><br><span class="line">  fs.access(dst, fs.constants.F_OK, (err) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          fs.mkdirSync(dst);</span><br><span class="line">          callback(src,dst);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          callback(src,dst);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除旧文件</span></span><br><span class="line"><span class="keyword">var</span> cleanOld = <span class="function"><span class="keyword">function</span>(<span class="params">dest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dest_static = path.join(dest, <span class="string">'static'</span>); </span><br><span class="line">  <span class="keyword">let</span> dest_index = path.join(dest, <span class="string">'index.html'</span>); </span><br><span class="line">  fs.exists(dest_static,<span class="function"><span class="keyword">function</span>(<span class="params">exists</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(exists) fse.removeSync(dest_static);</span><br><span class="line">  &#125;);</span><br><span class="line">  fs.exists(dest_index,<span class="function"><span class="keyword">function</span>(<span class="params">exists</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(exists) fse.removeSync(dest_index);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件路径</span></span><br><span class="line"><span class="keyword">let</span> url_src_ehome = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\ejashop\\dist\\'</span>),</span><br><span class="line">    url_dest_ehome = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\ehome'</span>),</span><br><span class="line">    url_src_airport = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\airport\\dist\\'</span>),</span><br><span class="line">    url_dest_airport = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\airport'</span>),</span><br><span class="line">    url_src_operation = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\eHomeOperation\\dist\\'</span>),</span><br><span class="line">    url_dest_operation = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\operation'</span>),</span><br><span class="line">    url_src_openShop = path.relative(__dirname, <span class="string">'C:\\WORK\\new-airport\\6 编码\\5 Web\\kaidian\\dist\\'</span>),</span><br><span class="line">    url_dest_openShop = path.relative(__dirname, <span class="string">'C:\\Users\\kaiya\\Desktop\\公司文件\\gitlang\\langcnew\\demo2\\openShop'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// copy之前先清空旧文件</span></span><br><span class="line">cleanOld(url_dest_ehome);</span><br><span class="line">cleanOld(url_dest_airport);</span><br><span class="line">cleanOld(url_dest_operation);</span><br><span class="line">cleanOld(url_dest_openShop);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4个项目的copy转移</span></span><br><span class="line">checkDirectory(url_src_ehome, url_dest_ehome,copy);</span><br><span class="line">checkDirectory(url_src_airport, url_dest_airport,copy);</span><br><span class="line">checkDirectory(url_src_operation, url_dest_operation,copy);</span><br><span class="line">checkDirectory(url_src_openShop, url_dest_openShop,copy);</span><br></pre></td></tr></table></figure></p><p>这里需要注意一点，path.relative(__dirname, ‘C:\WORK\new-airport\6 编码\5 Web\ejashop\dist\‘);利用path模块将两个绝对路径变成相对路径。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;利用nodejs拷贝转移文件&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="nodejs" scheme="/categories/nodejs/"/>
    
    
      <category term="工具库" scheme="/tags/%E5%B7%A5%E5%85%B7%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>window批处理执行webpack打包</title>
    <link href="/2019/04/19/window%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8Cwebpack%E6%89%93%E5%8C%85/"/>
    <id>/2019/04/19/window批处理执行webpack打包/</id>
    <published>2019-04-19T01:14:31.000Z</published>
    <updated>2019-04-19T01:37:13.570Z</updated>
    
    <content type="html"><![CDATA[<p>利用window的批处理文件bat来批量执行debpack打包命令。<br><a id="more"></a></p><h2 id="window批处理执行webpack打包"><a href="#window批处理执行webpack打包" class="headerlink" title="window批处理执行webpack打包"></a>window批处理执行webpack打包</h2><p>现在的前端开发，使用vue，react，angular等框架的项目非常多，部署的时候需要打包后进行部署，比如运行npm run build命令，但是比如我现在的项目，有4个子平台，每个平台是独立的一套vue，每次打包的时候需要进入到4个不同的平台目录进行打包命令操作，还有一点，我们项目分为测试环境，生产环境，这样就会出现更多次打包操作，每次都很烦，进入一个文件夹，打开命令提示符，输入npm run build，有没有方便点的方式呢，有，可以利用window系统的批处理文件来操作。<br>首先，下面的是执行一个打包命令的.bat文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">cd C:\WORK\new-airport\6 编码\5 Web\ejashop</span><br><span class="line">npm run build</span><br><span class="line">pause</span><br></pre></td></tr></table></figure></p><ul><li>chcp 65001 //是用来可以在文件路径中使用中文</li><li>cd C:\WORK\new-airport\6 编码\5 Web\ejashop //进入到项目的目录</li><li>npm run build //执行打包命令</li><li>pause // 命令行暂停，等待下一步操作</li></ul><p>上面的是执行一个打包命令的，多个打包操作需要创建多个.bat文件，每执行一个点击一下也很麻烦，我们可以在创建一个.bat文件，用来执行这些批处理文件操作，向下面这样:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br><span class="line">pause</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\build&quot; call ehome.bat</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\build&quot; call airport.bat</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\build&quot; call eHomeOperation.bat</span><br><span class="line">start /D &quot;C:\Users\kaiya\Desktop\批处理node\build&quot; call kaidian.bat</span><br></pre></td></tr></table></figure></p><ul><li>chcp 65001 //是用来可以在文件路径中使用中文</li><li>start /D “C:\Users\kaiya\Desktop\批处理node\build” call ehome.bat //执行具体的.bat文件</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;利用window的批处理文件bat来批量执行debpack打包命令。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="计算机原理" scheme="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="webpack" scheme="/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>http请求头响应头字段详解</title>
    <link href="/2019/04/15/http%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%93%8D%E5%BA%94%E5%A4%B4%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3/"/>
    <id>/2019/04/15/http请求头响应头字段详解/</id>
    <published>2019-04-15T09:04:24.000Z</published>
    <updated>2019-04-16T08:35:39.798Z</updated>
    
    <content type="html"><![CDATA[<p>http请求头和返回头字段的解释<br><a id="more"></a></p><h2 id="http请求头响应头字段详解"><a href="#http请求头响应头字段详解" class="headerlink" title="http请求头响应头字段详解"></a>http请求头响应头字段详解</h2><p>作为一名前端开发人员，肯定少不了要和网络打交道，因为要从服务器端拉取数据，从服务端获取数据最常用的方式还是通过HTTP请求。给服务器发请求的时候有请求头，接受服务器响应的时候有响应头，客户端和服务器端互相沟通需要的信息都是通过这些“头”来传送，这些信息是一些类似key:value的键值对。了解这些“头”中字段的含义对于理解整个请求过程有很大的帮助。这里列举了常用的“头”字段的解释以及例子，本文可以作为工具文收藏，以备需要时查看。</p><h3 id="常用标准请求头字段"><a href="#常用标准请求头字段" class="headerlink" title="常用标准请求头字段"></a>常用标准请求头字段</h3><ul><li><p>Accept 设置接受的内容类型<br>Accept: text/plain</p></li><li><p>Accept-Charset 设置接受的字符编码<br>Accept-Charset: utf-8</p></li><li><p>Accept-Encoding 设置接受的编码格式<br>Accept-Encoding: gzip, deflate</p></li><li><p>Accept-Datetime 设置接受的版本时间<br>Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</p></li><li><p>Accept-Language 设置接受的语言<br>Accept-Language: en-US</p></li><li><p>Authorization 设置HTTP身份验证的凭证<br>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</p></li><li><p>Cache-Control 设置请求响应链上所有的缓存机制必须遵守的指令<br>Cache-Control: no-cache</p></li><li><p>Connection 设置当前连接和hop-by-hop协议请求字段列表的控制选项<br>Connection: keep-alive<br>Connection: Upgrade</p></li><li><p>Content-Length 设置请求体的字节长度<br>Content-Length: 348</p></li><li><p>Content-MD5 设置基于MD5算法对请求体内容进行Base64二进制编码<br>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</p></li><li><p>Content-Type 设置请求体的MIME类型（适用POST和PUT请求）<br>Content-Type: application/x-www-form-urlencoded</p></li><li><p>Cookie 设置服务器使用Set-Cookie发送的http cookie<br>Cookie: $Version=1; Skin=new;</p></li><li><p>Date 设置消息发送的日期和时间<br>Date: Tue, 15 Nov 1994 08:12:31 GMT</p></li><li><p>Expect 标识客户端需要的特殊浏览器行为<br>Expect: 100-continue</p></li><li><p>Forwarded 披露客户端通过http代理连接web服务的源信息<br>Forwarded: for=192.0.2.60;proto=http;by=203.0.113.43<br>Forwarded: for=192.0.2.43, for=198.51.100.17</p></li><li><p>From 设置发送请求的用户的email地址<br>From: <a href="mailto:user@example.com" target="_blank" rel="noopener">user@example.com</a></p></li><li><p>Host 设置服务器域名和TCP端口号，如果使用的是服务请求标准端口号，端口号可以省略<br>Host: en.wikipedia.org:8080<br>Host: en.wikipedia.org</p></li><li><p>If-Match 设置客户端的ETag,当时客户端ETag和服务器生成的ETag一致才执行，适用于更新自从上次更新之后没有改变的资源<br>If-Match: “737060cd8c284d8af7ad3082f209582d</p></li><li><p>If-Modified-Since 设置更新时间，从更新时间到服务端接受请求这段时间内如果资源没有改变，允许服务端返回304 Not Modified<br>If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</p></li><li><p>If-None-Match 设置客户端ETag，如果和服务端接受请求生成的ETage相同，允许服务端返回304 Not Modified<br>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</p></li><li><p>If-Range 设置客户端ETag，如果和服务端接受请求生成的ETage相同，返回缺失的实体部分；否则返回整个新的实体<br>If-Range: “737060cd8c284d8af7ad3082f209582d”</p></li><li><p>If-Unmodified-Since 设置更新时间，只有从更新时间到服务端接受请求这段时间内实体没有改变，服务端才会发送响应<br>If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</p></li><li><p>Max-Forwards 限制代理或网关转发消息的次数<br>Max-Forwards: 10</p></li><li><p>Origin 标识跨域资源请求（请求服务端设置Access-Control-Allow-Origin响应字段）<br>Origin: <a href="http://www.example-social-network.com" target="_blank" rel="noopener">http://www.example-social-network.com</a></p></li><li><p>Pragma 设置特殊实现字段，可能会对请求响应链有多种影响<br>Pragma: no-cache</p></li><li><p>Proxy-Authorization 为连接代理授权认证信息<br>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</p></li><li><p>Range 请求部分实体，设置请求实体的字节数范围，具体可以参见HTTP/1.1中的Byte serving<br>Range: bytes=500-999</p></li><li><p>Referer 设置前一个页面的地址，并且前一个页面中的连接指向当前请求，意思就是如果当前请求是在A页面中发送的，那么referer就是A页面的url地址（轶事：这个单词正确的拼法应该是”referrer”,但是在很多规范中都拼成了”referer”，所以这个单词也就成为标准用法）<br>Referer: <a href="http://en.wikipedia.org/wiki/Main_Page" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Main_Page</a></p></li><li><p>TE 设置用户代理期望接受的传输编码格式，和响应头中的Transfer-Encoding字段一样<br>TE: trailers, deflate</p></li><li><p>Upgrade 请求服务端升级协议<br>Upgrade: HTTP/2.0, HTTPS/1.3, IRC/6.9, RTA/x11, websocket</p></li><li><p>User-Agent 用户代理的字符串值<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:12.0) Gecko/20100101 Firefox/21.0</p></li><li><p>Via 通知服务器代理请求<br>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</p></li><li><p>Warning 实体可能会发生的问题的通用警告<br>Warning: 199 Miscellaneous warning</p></li></ul><h3 id="常用非标准请求头字段"><a href="#常用非标准请求头字段" class="headerlink" title="常用非标准请求头字段"></a>常用非标准请求头字段</h3><ul><li><p>X-Requested-With 标识Ajax请求，大部分js框架发送请求时都会设置它为XMLHttpRequest<br>X-Requested-With: XMLHttpRequest</p></li><li><p>DNT 请求web应用禁用用户追踪<br>DNT: 1 (Do Not Track Enabled)<br>DNT: 0 (Do Not Track Disabled)</p></li><li><p>X-Forwarded-For 一个事实标准，用来标识客户端通过HTTP代理或者负载均衡器连接的web服务器的原始IP地址<br>X-Forwarded-For: client1, proxy1, proxy2<br>X-Forwarded-For: 129.78.138.66, 129.78.64.103</p></li><li><p>X-Forwarded-Host 一个事实标准，用来标识客户端在HTTP请求头中请求的原始host,因为主机名或者反向代理的端口可能与处理请求的原始服务器不同<br>X-Forwarded-Host: en.wikipedia.org:8080<br>X-Forwarded-Host: en.wikipedia.org</p></li><li><p>X-Forwarded-Proto 一个事实标准，用来标识HTTP原始协议，因为反向代理或者负载均衡器和web服务器可能使用http,但是请求到反向代理使用的是https<br>X-Forwarded-Proto: https</p></li><li><p>Front-End-Https 微软应用程序和负载均衡器使用的非标准header字段<br>Front-End-Https: on</p></li><li><p>X-Http-Method-Override 请求web应用时，使用header字段中给定的方法（通常是put或者delete）覆盖请求中指定的方法（通常是post）,如果用户代理或者防火墙不支持直接使用put或者delete方法发送请求时，可以使用这个字段<br>X-HTTP-Method-Override: DELETE</p></li><li><p>X-ATT-DeviceId 允许更简单的解析用户代理在AT&amp;T设备上的MakeModel/Firmware<br>X-Att-Deviceid: GT-P7320/P7320XXLPG</p></li><li><p>X-Wap-Profile 设置描述当前连接设备的详细信息的xml文件在网络中的位置<br>x-wap-profile: <a href="http://wap.samsungmobile.com/uaprof/SGH-I777.xml" target="_blank" rel="noopener">http://wap.samsungmobile.com/uaprof/SGH-I777.xml</a></p></li><li><p>Proxy-Connection 早起HTTP版本中的一个误称，现在使用标准的connection字段<br>Proxy-Connection: keep-alive</p></li><li><p>X-UIDH 服务端深度包检测插入的一个唯一ID标识Verizon Wireless的客户<br>X-UIDH: …</p></li><li><p>X-Csrf-Token,X-CSRFToken,X-XSRF-TOKEN 防止跨站请求伪造<br>X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql</p></li><li><p>X-Request-ID,X-Correlation-ID 标识客户端和服务端的HTTP请求<br>X-Request-ID: f058ebd6-02f7-4d3f-942e-904344e8cde5</p></li></ul><h3 id="常用标准响应头字段"><a href="#常用标准响应头字段" class="headerlink" title="常用标准响应头字段"></a>常用标准响应头字段</h3><ul><li><p>Access-Control-Allow-Origin 指定哪些站点可以参与跨站资源共享<br>Access-Control-Allow-Origin: *</p></li><li><p>Accept-Patch 指定服务器支持的补丁文档格式，适用于http的patch方法<br>Accept-Patch: text/example;charset=utf-8</p></li><li><p>Accept-Ranges 服务器通过byte serving支持的部分内容范围类型<br>Accept-Ranges: bytes</p></li><li><p>Age 对象在代理缓存中暂存的秒数<br>Age: 12</p></li><li><p>Allow 设置特定资源的有效行为，适用方法不被允许的http 405错误<br>Allow: GET, HEAD</p></li><li><p>Alt-Svc 服务器使用”Alt-Svc”（Alternative Servicesde的缩写）头标识资源可以通过不同的网络位置或者不同的网络协议获取<br>Alt-Svc: h2=”http2.example.com:443”; ma=7200</p></li><li><p>Cache-Control 告诉服务端到客户端所有的缓存机制是否可以缓存这个对象，单位是秒<br>Cache-Control: max-age=3600</p></li><li><p>Connection 设置当前连接和hop-by-hop协议请求字段列表的控制选项<br>Connection: close</p></li><li><p>Content-Disposition 告诉客户端弹出一个文件下载框，并且可以指定下载文件名<br>Content-Disposition: attachment; filename=”fname.ext”</p></li><li><p>Content-Encoding 设置数据使用的编码类型<br>Content-Encoding: gzip</p></li><li><p>Content-Language 为封闭内容设置自然语言或者目标用户语言<br>Content-Language: en</p></li><li><p>Content-Length 响应体的字节长度<br>Content-Length: 348</p></li><li><p>Content-Location 设置返回数据的另一个位置<br>Content-Location: /index.htm</p></li><li><p>Content-MD5 设置基于MD5算法对响应体内容进行Base64二进制编码<br>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</p></li><li><p>Content-Range 标识响应体内容属于完整消息体中的那一部分<br>Content-Range: bytes 21010-47021/47022</p></li><li><p>Content-Type 设置响应体的MIME类型<br>Content-Type: text/html; charset=utf-8</p></li><li><p>Date 设置消息发送的日期和时间<br>Date: Tue, 15 Nov 1994 08:12:31 GMT</p></li><li><p>ETag 特定版本资源的标识符，通常是消息摘要<br>ETag: “737060cd8c284d8af7ad3082f209582d”</p></li><li><p>Expires 设置响应体的过期时间<br>Expires: Thu, 01 Dec 1994 16:00:00 GMT</p></li><li><p>Last-Modified 设置请求对象最后一次的修改日期<br>Last-Modified: Tue, 15 Nov 1994 12:45:26 GMT</p></li><li><p>Link 设置与其他资源的类型关系<br>Link: ; rel=”alternate”</p></li><li><p>Location 在重定向中或者创建新资源时使用<br>Location: <a href="http://www.w3.org/pub/WWW/People.html" target="_blank" rel="noopener">http://www.w3.org/pub/WWW/People.html</a></p></li><li><p>P3P 以P3P:CP=”your_compact_policy”的格式设置支持P3P(Platform for Privacy Preferences Project)策略，大部分浏览器没有完全支持P3P策略，许多站点设置假的策略内容欺骗支持P3P策略的浏览器以获取第三方cookie的授权<br>P3P: CP=”This is not a P3P policy! See <a href="http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657" target="_blank" rel="noopener">http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657</a> for more info.”</p></li><li><p>Pragma 设置特殊实现字段，可能会对请求响应链有多种影响<br>Pragma: no-cache</p></li><li><p>Proxy-Authenticate 设置访问代理的请求权限<br>Proxy-Authenticate: Basic</p></li><li><p>Public-Key-Pins 设置站点的授权TLS证书<br>Public-Key-Pins: max-age=2592000; pin-sha256=”E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=”;</p></li><li><p>Refresh “重定向或者新资源创建时使用，在页面的头部有个扩展可以实现相似的功能，并且大部分浏览器都支持</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">"refresh"</span> content=<span class="string">"5; url=http://example.com/"</span>&gt;</span><br><span class="line">Refresh: <span class="number">5</span>; url=http:<span class="comment">//www.w3.org/pub/WWW/People.html</span></span><br></pre></td></tr></table></figure></li><li><p>Retry-After 如果实体暂时不可用，可以设置这个值让客户端重试，可以使用时间段（单位是秒）或者HTTP时间<br>Example 1: Retry-After: 120<br>Example 2: Retry-After: Fri, 07 Nov 2014 23:59:59 GMT</p></li><li><p>Server 服务器名称<br>Server: Apache/2.4.1 (Unix)</p></li><li><p>Set-Cookie 设置HTTP Cookie<br>Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</p></li><li><p>Status 设置HTTP响应状态<br>Status: 200 OK</p></li><li><p>Strict-Transport-Security 一种HSTS策略通知HTTP客户端缓存HTTPS策略多长时间以及是否应用到子域<br>Strict-Transport-Security: max-age=16070400; includeSubDomains</p></li><li><p>Trailer 标识给定的header字段将展示在后续的chunked编码的消息中<br>Trailer: Max-Forwards</p></li><li><p>Transfer-Encoding 设置传输实体的编码格式，目前支持的格式： chunked, compress, deflate, gzip, identity<br>Transfer-Encoding: chunked</p></li><li><p>TSV Tracking Status Value，在响应中设置给DNT(do-not-track),可能的取值<br>　　　“!” — under construction<br>　　　“?” — dynamic<br>　　　“G” — gateway to multiple parties<br>　　　“N” — not tracking<br>　　　“T” — tracking<br>　　　“C” — tracking with consent<br>　　　“P” — tracking only if consented<br>　　　“D” — disregarding DNT<br>　　　“U” — updated<br>TSV: ?</p></li><li><p>Upgrade 请求客户端升级协议<br>Upgrade: HTTP/2.0, HTTPS/1.3, IRC/6.9, RTA/x11, websocket</p></li><li><p>Vary 通知下级代理如何匹配未来的请求头已让其决定缓存的响应是否可用而不是重新从源主机请求新的<br>Example 1: Vary: *<br>Example 2: Vary: Accept-Language</p></li><li><p>Via 通知客户端代理，通过其要发送什么响应<br>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</p></li><li><p>Warning 实体可能会发生的问题的通用警告<br>Warning: 199 Miscellaneous warning</p></li><li><p>WWW-Authenticate 标识访问请求实体的身份验证方案<br>WWW-Authenticate: Basic</p></li><li><p>X-Frame-Options 点击劫持保护：<br>　　　deny frame中不渲染<br>　　　sameorigin 如果源不匹配不渲染<br>　　　allow-from 允许指定位置访问<br>　　　allowall 不标准，允许任意位置访问<br>X-Frame-Options: deny</p></li></ul><h3 id="常用非标准响应头字段"><a href="#常用非标准响应头字段" class="headerlink" title="常用非标准响应头字段"></a>常用非标准响应头字段</h3><ul><li><p>X-XSS-Protection 过滤跨站脚本<br>X-XSS-Protection: 1; mode=block</p></li><li><p>Content-Security-Policy, X-Content-Security-Policy,X-WebKit-CSP 定义内容安全策略<br>X-WebKit-CSP: default-src ‘self’</p></li><li><p>X-Content-Type-Options 唯一的取值是””,阻止IE在响应中嗅探定义的内容格式以外的其他MIME格式<br>X-Content-Type-Options: nosniff</p></li><li><p>X-Powered-By 指定支持web应用的技术<br>X-Powered-By: PHP/5.4.0</p></li><li><p>X-UA-Compatible 推荐首选的渲染引擎来展示内容，通常向后兼容，也用于激活IE中内嵌chrome框架插件<br><meta http-equiv="X-UA-Compatible" content="chrome=1"><br>X-UA-Compatible: IE=EmulateIE7<br>X-UA-Compatible: IE=edge<br>X-UA-Compatible: Chrome=1</p></li><li><p>X-Content-Duration 提供音视频的持续时间，单位是秒，只有Gecko内核浏览器支持<br>X-Content-Duration: 42.666</p></li><li><p>Upgrade-Insecure-Requests 标识服务器是否可以处理HTTPS协议<br>Upgrade-Insecure-Requests: 1</p></li><li><p>X-Request-ID,X-Correlation-ID 标识一个客户端和服务端的请求<br>X-Request-ID: f058ebd6-02f7-4d3f-942e-904344e8cde5</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;http请求头和返回头字段的解释&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="网络基础" scheme="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>ajax携带cookie</title>
    <link href="/2019/04/15/ajax%E6%90%BA%E5%B8%A6cookie/"/>
    <id>/2019/04/15/ajax携带cookie/</id>
    <published>2019-04-15T08:39:46.000Z</published>
    <updated>2019-04-15T08:59:48.714Z</updated>
    
    <content type="html"><![CDATA[<p>ajax同域和跨域情况下携带cookie问题<br><a id="more"></a></p><h2 id="ajax携带cookie"><a href="#ajax携带cookie" class="headerlink" title="ajax携带cookie"></a>ajax携带cookie</h2><p>这是一个老生常谈的问题，但是时间长了总容易忘掉，今天记录下来，以便下次方便记起来。</p><p>首先，今天我遇到了一个坑，chrome浏览无论是同域还是跨域状态下，浏览器request headers里居然都不显示，刚开始我还以为是设置错了，后来发现其他浏览器都显示，我想有可能是chrome浏览器安全考虑吧，但是，这并不影响后台接收，只是不显示而已。</p><p>同域下无可厚非，什么都不用做就会带上cookie。</p><p>跨域下的设置：<br>浏览器端，需要设置withCredentials为true<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原生方式</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'http://example.com/'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jquery方式</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">        url: <span class="string">"http://192.168.252.12:3006/post_form"</span>,</span><br><span class="line">        type: <span class="string">'POST'</span>,</span><br><span class="line">        xhrFields: &#123;</span><br><span class="line">            withCredentials: <span class="literal">true</span> <span class="comment">// 这里设置了withCredentials</span></span><br><span class="line">        &#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios方式</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line">axios.defaults.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></p><p>再来说说后端的设置，以nodejs的express为例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回头设置</span></span><br><span class="line">res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://localhost:9000"</span>); <span class="comment">// 注意，这里不能写*,应该是具体的地址</span></span><br><span class="line">res.header(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br></pre></td></tr></table></figure></p><p>最后附上demo代码：<br>前端<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="jquery.js"&gt;&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  ajax cookie demo</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">            url: <span class="string">"http://192.168.252.12:3006/post_form"</span>,</span><br><span class="line">            type: <span class="string">'POST'</span>,</span><br><span class="line">            xhrFields: &#123;</span><br><span class="line">                withCredentials: <span class="literal">true</span> <span class="comment">// 这里设置了withCredentials</span></span><br><span class="line">            &#125;,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;,</span><br><span class="line">            error: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p><p>后端<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> multiparty = <span class="built_in">require</span>(<span class="string">'multiparty'</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>); </span><br><span class="line"></span><br><span class="line">app.set(<span class="string">'port'</span>,process.env.PORT || <span class="number">3006</span>);   <span class="comment">//设置端口</span></span><br><span class="line"></span><br><span class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://localhost:9000"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br><span class="line"></span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"client-token,Content-Type,Content-Length, Authorization, Accept,X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>,<span class="string">' 3.2.1'</span>);</span><br><span class="line">    <span class="keyword">if</span>(req.method==<span class="string">"OPTIONS"</span>) res.send(<span class="number">200</span>); <span class="comment">//让options请求快速返回</span></span><br><span class="line">    <span class="keyword">else</span>  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用static中间件 制定public目录为静态资源目录,其中资源不会经过任何处理</span></span><br><span class="line">app.use(express.static(__dirname + <span class="string">'/public'</span>));</span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// for parsing application/json</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;)); <span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line">app.use(cookieParser()); <span class="comment">// cookie解析</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/post_form'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = &#123;</span><br><span class="line">            name: req.body.name,</span><br><span class="line">            info: req.body.info,</span><br><span class="line">            hostName: req.hostname</span><br><span class="line">        &#125;;</span><br><span class="line">        res.cookie(<span class="string">"add"</span>, <span class="string">'test456'</span>, &#123;<span class="attr">maxAge</span>: <span class="number">900000</span>, <span class="attr">httpOnly</span>: <span class="literal">true</span>&#125;); <span class="comment">// 设置cookie</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'cookie-&gt;'</span> + req.cookies.add); <span class="comment">// 读取cookie</span></span><br><span class="line">        res.send(data);  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'服务器启动完成，端口为： '</span>+app.get(<span class="string">'port'</span>) );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ajax同域和跨域情况下携带cookie问题&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="ajax" scheme="/tags/ajax/"/>
    
  </entry>
  
  <entry>
    <title>let存在变量提升吗?</title>
    <link href="/2019/04/10/let%E5%AD%98%E5%9C%A8%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E5%90%97/"/>
    <id>/2019/04/10/let存在变量提升吗/</id>
    <published>2019-04-10T07:20:08.000Z</published>
    <updated>2019-04-10T08:02:51.446Z</updated>
    
    <content type="html"><![CDATA[<p>javascript中关于let的一些小知识<br><a id="more"></a></p><h2 id="let存在变量提升吗"><a href="#let存在变量提升吗" class="headerlink" title="let存在变量提升吗?"></a>let存在变量提升吗?</h2><p>let是ES6推出的新语法，平时简单的用大家都明白，但是里边的原理还是很深的。<br>在MDN的文档中对于let的特性是这样说的：</p><ul><li>let 声明的变量的作用域是块级的；</li><li>let 不能重复声明已存在的变量；</li><li>let 有暂时死区，不会被提升。<br>我们来看一个小demo<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  let b = 12</span></span><br><span class="line"><span class="regexp">  console.log(b)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></li></ul><p>代码执行报错：Uncaught SyntaxError: Identifier ‘b’ has already been declared</p><p>先给window创建b的属性，然后再去声明b，这个时候，b是个全局变量可以直接通过b访问，let 又不可以重复声明。此处可以解释的通。那么请看下面的代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  console.log(b)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></p><p>如果把let b 提升到上面的script块就可以声明成功。如果说从上往下执行的话，b是已经存在的了，那么let b是不可以声明的成功的。</p><p>到这里就有些解释不通了。为什么window已经声明了b的属性，会成为一个单独的b变量。let 的时候却没有报错呢。这里就需要对let 是不是会变量提升划一个问号了。</p><p>先把这个问题放在这里，我们继续看下面这段代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.b)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>window下已经声明了b的属性，而且let 一个b 打印出来分别是22和12。这里我们假设存在变量提升的话，那么js引擎在预解析的时候会先声明b对象。然后实际执行的时候，再给window创建b属性。到这里我们就可以解释的通了。既然存在变量提升的话，我是不是可以在声明之前打印一下b的值呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>报错 Uncaught ReferenceError: b is not defined<br>纳尼？难道let 真的不存在变量提升？因为鄙人有强迫症，本着不达目的不罢休的目的，问了度娘，找到了如下的参考资料。<br>要搞清楚提升的本质，需要理解 JS 变量的「创建create、初始化initialize 和赋值assign」。<br>我们来看看 var 声明的「创建、初始化和赋值」过程<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>在执行 fn 时，会有以下过程（不完全）：</p><p>1.进入 fn，为 fn 创建一个环境。<br>2.找到 fn 中所有用 var 声明的变量，在这个环境中「创建」这些变量（即 x 和 y）。<br>3.将这些变量「初始化」为 undefined。<br>4.开始执行代码<br>5.x = 1 将 x 变量「赋值」为 1<br>6.y = 2 将 y 变量「赋值」为 2<br>也就是说 var 声明会在代码执行之前就将「创建变量，并将其初始化为 undefined」。<br>这就解释了为什么在 var x = 1 之前 console.log(x) 会得到 undefined。<br>接下来来看 function 声明的「创建、初始化和赋值」过程<br>假设代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">fn2()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>JS 引擎会有一下过程：<br>1.找到所有用 function 声明的变量，在环境中「创建」这些变量。<br>2.将这些变量「初始化」并「赋值」为 function(){ console.log(2) }。<br>3.开始执行代码 fn2()<br>也就是说 function 声明会在代码执行之前就「创建、初始化并赋值」。<br>接下来看 let 声明的「创建、初始化和赋值」过程<br>假设代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line">  x = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>我们只看 {} 里面的过程：<br>1.找到所有用 let 声明的变量，在环境中「创建」这些变量<br>2.开始执行代码（注意现在还没有初始化）<br>3.执行 x = 1，将 x 「初始化」为 1（这并不是一次赋值，如果代码是 let x，就将 x 初始化为 undefined）<br>4.执行 x = 2，对 x 进行「赋值」<br>这就解释了为什么在 let x 之前使用 x 会报错：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">let</span> x = <span class="string">'global'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x) <span class="comment">// Uncaught ReferenceError: x is not defined</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>原因有两个<br>1.console.log(x) 中的 x 指的是下面的 x，而不是全局的 x<br>2.执行 log 时 x 还没「初始化」，所以不能使用（也就是所谓的暂时死区）<br>看到这里，你应该明白了 let 到底有没有提升：<br>1.let 的「创建」过程被提升了，但是初始化没有提升。<br>2.var 的「创建」和「初始化」都被提升了。<br>function 的「创建」「初始化」和「赋值」都被提升了。</p><p>至此 我们也可以解释</p><ul><li>为什么跨script标签提示重复声明：因为浏览器是从上往下执行js代码的，也就是说在第一段js执行完成之后，再去预解析第二段js代码，执行第二段代码。</li><li>为什么在同一个script标签中可以定义b： 因为在js引擎预解析script的时候先创建了b。然后再执行Object.defineProperty为window增加b属性。所以此处的b和window.b不是一个变量。</li><li>为什么在同一个script标签中可以定义b，但是在b声明之前会报错b没有定义：因为只是创建了b变量，并没有初始化。没有初始化，变量是不可以使用的</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;javascript中关于let的一些小知识&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>封装ajax工具插件</title>
    <link href="/2019/04/03/%E5%B0%81%E8%A3%85ajax%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/"/>
    <id>/2019/04/03/封装ajax工具插件/</id>
    <published>2019-04-03T06:47:46.000Z</published>
    <updated>2019-04-03T07:07:43.636Z</updated>
    
    <content type="html"><![CDATA[<p>封装一个自己的ajax工具插件<br><a id="more"></a></p><h2 id="封装ajax工具插件"><a href="#封装ajax工具插件" class="headerlink" title="封装ajax工具插件"></a>封装ajax工具插件</h2><p>我们在平时开发的时候，ajax请求都会用到现有库，用的比较多的如jquery，axios等，偶尔自己写个原生ajax请求的情况也有，这些库是怎么写的呢，我们自己封装一个库，来学习学习ajax的一些基础知识。<br>在写这篇文章的时候，是因为头两天同事问我一个ajax问题，关于请求参数的，我突然回答不出来，忘记了，于是翻出来2年前自己封的ajax工具看了一眼，知道了怎么回事，决定把代码写到博客里，忘了的时候方便看一下。<br>下面我只贴出了核心代码，其他部分我会提供github的地址：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">window,undefined</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jinuxAjax挂载到window上</span></span><br><span class="line"><span class="built_in">window</span>.jinuxAjax = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line">ieAjaxInit();</span><br><span class="line"><span class="comment">//默认参数配置</span></span><br><span class="line"><span class="keyword">var</span> defaultOpt = &#123;</span><br><span class="line">url:<span class="string">''</span>,</span><br><span class="line">type: <span class="string">'GET'</span>,</span><br><span class="line">data: <span class="literal">null</span>,</span><br><span class="line">contentType: <span class="string">'application/x-www-form-urlencoded'</span>,<span class="comment">//'text/plain;charset=UTF-8','application/json','multipart/form-data'</span></span><br><span class="line">timeOut: <span class="number">5000</span>,</span><br><span class="line">files:[],</span><br><span class="line">progress: <span class="literal">null</span>,</span><br><span class="line">before: fn,</span><br><span class="line">success: fn,</span><br><span class="line">error: fn,</span><br><span class="line">complete: fn</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数对象继承获取新参数对象</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">Object</span>.assign)&#123;</span><br><span class="line"><span class="keyword">var</span> opt = <span class="built_in">Object</span>.assign(&#123;&#125;, defaultOpt, opt);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> defaultOpt)&#123;</span><br><span class="line">defaultOpt[name] = opt[name] || defaultOpt[name];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> opt = defaultOpt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestData(opt);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将json格式数据转成application/x-www-form-urlencoded格式数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encodeFormData</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!data) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line"><span class="keyword">var</span> pairs = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> data)&#123;</span><br><span class="line"><span class="keyword">if</span>(!data.hasOwnProperty(name)) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> data[name] === <span class="string">'function'</span>) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">var</span> value = data[name].toString();</span><br><span class="line">name = <span class="built_in">encodeURIComponent</span>(name.replace(<span class="string">'%20'</span>,<span class="string">'+'</span>));</span><br><span class="line">value = <span class="built_in">encodeURIComponent</span>(value.replace(<span class="string">'%20'</span>,<span class="string">'+'</span>));</span><br><span class="line">pairs.push(name + <span class="string">'='</span> + value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pairs.join(<span class="string">'&amp;'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax的get请求函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="keyword">var</span> timeoutFlag = <span class="literal">false</span>; <span class="comment">//是否超时</span></span><br><span class="line"><span class="comment">//启动计时器，做超时处理</span></span><br><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">timeoutFlag = <span class="literal">true</span>;</span><br><span class="line">request.abort();</span><br><span class="line">&#125;,opt.timeOut);</span><br><span class="line"></span><br><span class="line">request.open(<span class="string">'GET'</span>,opt.url +<span class="string">'?'</span>+ encodeFormData(opt.data));</span><br><span class="line">opt.before(); <span class="comment">//请求之前执行before函数</span></span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(request.readyState === <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(timeoutFlag) <span class="keyword">return</span>;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="keyword">if</span>(request.status === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> type = request.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line"><span class="comment">//检查type类型做相应的解析处理</span></span><br><span class="line"><span class="keyword">if</span>(type.indexOf(<span class="string">'xml'</span>) !== <span class="number">-1</span> &amp;&amp; request.responseXML)&#123; <span class="comment">//xml相应</span></span><br><span class="line">opt.success(request.responseXML);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.indexOf(<span class="string">'application/json'</span>) !== <span class="number">-1</span>) &#123; <span class="comment">//json相应</span></span><br><span class="line">opt.success(<span class="built_in">JSON</span>.parse(request.responseText));</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.success(request.responseText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.error(request);</span><br><span class="line">&#125;</span><br><span class="line">opt.complete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">request.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax的post请求函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">postData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest(), sendData=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> timeoutFlag = <span class="literal">false</span>; <span class="comment">//是否超时</span></span><br><span class="line"><span class="comment">//启动计时器，做超时处理</span></span><br><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">timeoutFlag = <span class="literal">true</span>;</span><br><span class="line">request.abort();</span><br><span class="line">&#125;,opt.timeOut);</span><br><span class="line"></span><br><span class="line">request.open(<span class="string">'POST'</span>,opt.url);</span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(request.readyState === <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(timeoutFlag) <span class="keyword">return</span>;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="keyword">if</span>(request.status === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> type = request.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line"><span class="comment">//检查type类型做相应的解析处理</span></span><br><span class="line"><span class="keyword">if</span>(type.indexOf(<span class="string">'xml'</span>) !== <span class="number">-1</span> &amp;&amp; request.responseXML)&#123; <span class="comment">//xml相应</span></span><br><span class="line">opt.success(request.responseXML);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.indexOf(<span class="string">'application/json'</span>) !== <span class="number">-1</span>) &#123; <span class="comment">//json相应</span></span><br><span class="line">opt.success(<span class="built_in">JSON</span>.parse(request.responseText));</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.success(request.responseText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.error(request);</span><br><span class="line">&#125;</span><br><span class="line">opt.complete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理接收进度事件</span></span><br><span class="line"><span class="keyword">if</span>(opt.progress.enable &amp;&amp; request.upload)&#123;</span><br><span class="line">request.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(ev.lengthComputable)&#123;</span><br><span class="line">opt.progress.receiveHandle(ev);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">request.upload.onload = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">opt.progress.successHandle(ev);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(opt.contentType === <span class="string">'application/x-www-form-urlencoded'</span>)&#123;</span><br><span class="line">request.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>);</span><br><span class="line">sendData = encodeFormData(opt.data);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt.contentType === <span class="string">'application/json'</span>) &#123;</span><br><span class="line">request.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/json; charset=utf-8'</span>);</span><br><span class="line">sendData = <span class="built_in">JSON</span>.stringify(opt.data);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt.contentType === <span class="string">'multipart/form-data'</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> opt.data)&#123;</span><br><span class="line"><span class="keyword">if</span>( !opt.data.hasOwnProperty(name) ) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">typeof</span> opt.data[name] === <span class="string">'function'</span> ) <span class="keyword">continue</span>; </span><br><span class="line">fd.append(name,opt.data[name]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;opt.files.length; i++)&#123;</span><br><span class="line">fd.append(<span class="string">'file'</span>+i,opt.files[i]);</span><br><span class="line">&#125;</span><br><span class="line">sendData = fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.send(sendData);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax请求函数，在函数内再调用get或者post</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(opt.type === <span class="string">'GET'</span>)&#123;</span><br><span class="line">getData(opt);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">postData(opt);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个空函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果是ie6，创建XMLHttpRequest对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ieAjaxInit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest === <span class="literal">undefined</span>)&#123;</span><br><span class="line"><span class="built_in">window</span>.XMLHttpRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Msxml2.XMLHTTP.6.0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e1) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Msxml2.XMLHTTP.3.0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e2) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'不支持XMLHttpRequest'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure></p><p>详细代码请<a href="https://github.com/jinux7/jinux-ajax" target="_blank" rel="noopener">点击这里看源码</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;封装一个自己的ajax工具插件&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="ajax" scheme="/tags/ajax/"/>
    
  </entry>
  
  <entry>
    <title>防抖与节流</title>
    <link href="/2019/04/03/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/"/>
    <id>/2019/04/03/防抖与节流/</id>
    <published>2019-04-03T05:45:23.000Z</published>
    <updated>2019-04-03T06:32:46.011Z</updated>
    
    <content type="html"><![CDATA[<p>简单的介绍一下防抖与节流<br><a id="more"></a><br>作为一名前端开发者，我们经常会处理各种事件，比如常见的click、scroll、 resize等等。仔细一想，会发现像scroll、scroll、onchange这类事件会频繁触发，如果我们在回调中计算元素位置、做一些跟DOM相关的操作，引起浏览器回流和重绘，频繁触发回调，很可能会造成浏览器掉帧，甚至会使浏览器崩溃，影响用户体验。针对这种现象，目前有两种常用的解决方案：防抖和节流。</p><h2 id="防抖（debounce）"><a href="#防抖（debounce）" class="headerlink" title="防抖（debounce）"></a>防抖（debounce）</h2><p>所谓防抖，就是指触发事件后，就是把触发非常频繁的事件合并成一次去执行。即在指定时间内只执行一次回调函数，如果在指定的时间内又触发了该事件，则回调函数的执行时间会基于此刻重新开始计算。</p><ul><li>以我们生活中乘车刷卡的情景举例，只要乘客不断地在刷卡，司机师傅就不能开车，乘客刷卡完毕之后，司机会等待几分钟，确定乘客坐稳再开车。如果司机在最后等待的时间内又有新的乘客上车，那么司机等乘客刷卡完毕之后，还要再等待一会，等待所有乘客坐稳再开车。<br><img src="/2019/04/03/防抖与节流/1.jpg" alt="img"><br>具体应该怎么去实现这样的功能呢？第一时间肯定会想到使用setTimeout方法，那我们就尝试写一个简单的函数来实现这个功能吧~<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debounce = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timeId;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = <span class="keyword">this</span>, args = <span class="built_in">arguments</span>;</span><br><span class="line">    timeId &amp;&amp; clearTimeout(timeout);</span><br><span class="line">    timeId = setTimeout(<span class="function"><span class="keyword">function</span> </span>&#123;</span><br><span class="line">          fn.apply(context, args);</span><br><span class="line">        &#125;, delayTime)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>思路解析：<br>执行debounce函数之后会返回一个新的函数，通过闭包的形式，维护一个变量timeId，每次执行该函数的时候会结束之前的延迟操作，重新执行setTimeout方法，也就实现了上面所说的指定的时间内多次触发同一个事件，会合并执行一次。<br>温馨提示：<br>1、上述代码中arguments只会保存事件回调函数中的参数，譬如：事件对象等，并不会保存fn、delayTime<br>2、使用apply改变传入的fn方法中的this指向，指向绑定事件的DOM元素。</p><h2 id="节流（throttle）"><a href="#节流（throttle）" class="headerlink" title="节流（throttle）"></a>节流（throttle）</h2><p>所谓节流，是指频繁触发事件时，只会在指定的时间段内执行事件回调，即触发事件间隔大于等于指定的时间才会执行回调函数。</p><ul><li>类比到生活中的水龙头，拧紧水龙头到某种程度会发现，每隔一段时间，就会有水滴流出。<br><img src="/2019/04/03/防抖与节流/2.jpg" alt="img"><br>说到时间间隔，大家肯定会想到使用setTimeout来实现，在这里，我们使用两种方法来简单实现这种功能：时间戳和setTimeout定时器。</li><li>时间戳<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = (fn, delayTime) = &gt;&#123;</span><br><span class="line">    <span class="keyword">var</span> _start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _now = <span class="built_in">Date</span>.now(),</span><br><span class="line">        context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (_now - _start &gt;= delayTime) &#123;</span><br><span class="line">            fn.apply(context, args);</span><br><span class="line">            _start = <span class="built_in">Date</span>.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>通过比较两次时间戳的间隔是否大于等于我们事先指定的时间来决定是否执行事件回调。</p><ul><li>定时器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            flag = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn.apply(context, args);</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;,delayTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>在上述实现过程中，我们设置了一个标志变量flag，当delayTime之后执行事件回调，便会把这个变量重置，表示一次回调已经执行结束。 对比上述两种实现，我们会发现一个有趣的现象：<br>1、使用时间戳方式，页面加载的时候就会开始计时，如果页面加载时间大于我们设定的delayTime，第一次触发事件回调的时候便会立即fn，并不会延迟。如果最后一次触发回调与前一次触发回调的时间差小于delayTime，则最后一次触发事件并不会执行fn；<br>2、使用定时器方式，我们第一次触发回调的时候才会开始计时，如果最后一次触发回调事件与前一次时间间隔小于delayTime，delayTime之后仍会执行fn。<br>这两种方式有点优势互补的意思，哈哈~<br>我们考虑把这两种方式结合起来，便会在第一次触发事件时执行fn，最后一次与前一次间隔比较短，delayTime之后再次执行fn。<br>想法简单实现如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag, _start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>,</span><br><span class="line">        _now = <span class="built_in">Date</span>.now(),</span><br><span class="line">        remainTime = delayTime - (_now - _start);</span><br><span class="line">        <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">            &#125;,remainTime)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过上面的分析，可以很明显的看出函数防抖和函数节流的区别：<br>频繁触发事件时，函数防抖只会在最后一次触发事件只会才会执行回调内容，其他情况下会重新计算延迟事件，而函数节流便会很有规律的每隔一定时间执行一次回调函数。</p><ul><li>requestAnimationFrame<br>之前，我们使用setTimeout简单实现了防抖和节流功能，如果我们不考虑兼容性，追求精度比较高的页面效果，可以考虑试试html5提供的API–requestAnimationFrame。<br>与setTimeout相比，requestAnimationFrame的时间间隔是有系统来决定，保证屏幕刷新一次，回调函数只会执行一次，比如屏幕的刷新频率是60HZ，即间隔1000ms/60会执行一次回调。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn();</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><p>上述代码的基本功能就是保证在屏幕刷新的时候（对于大多数的屏幕来说，大约16.67ms），可以执行一次回调函数fn。使用这种方式也存在一种比较明显的缺点，时间间隔只能跟随系统变化，我们无法修改，但是准确性会比setTimeout高一些。<br>注意：</p><ul><li>防抖和节流只是减少了事件回调函数的执行次数，并不会减少事件的触发频率。</li><li>防抖和节流并没有从本质上解决性能问题，我们还应该注意优化我们事件回调函数的逻辑功能，避免在回调中执行比较复杂的DOM操作，减少浏览器reflow和repaint。<br>上面的示例代码比较简单，只是说明了基本的思路。目前已经有工具库实现了这些功能，比如underscore，考虑的情况也会比较多，大家可以去查看源码，学习作者的思路，加深理解。<br>underscore的debounce方法源码：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">_.debounce = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, immediate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, result;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params">context, args</span>) </span>&#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (args) result = func.apply(context, args);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> debounced = restArguments(<span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (timeout) clearTimeout(timeout);</span><br><span class="line">        <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">            <span class="keyword">var</span> callNow = !timeout;</span><br><span class="line">            timeout = setTimeout(later, wait);</span><br><span class="line">            <span class="keyword">if</span> (callNow) result = func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeout = _.delay(later, wait, <span class="keyword">this</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line">    debounced.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><p>underscore的throttle源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">_.throttle = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, context, args, result;</span><br><span class="line">    <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!options) options = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        previous = options.leading === <span class="literal">false</span> ? <span class="number">0</span> : _.now();</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> throttled = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> now = _.now();</span><br><span class="line">        <span class="keyword">if</span> (!previous &amp;&amp; options.leading === <span class="literal">false</span>) previous = now;</span><br><span class="line">        <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">        context = <span class="keyword">this</span>;</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">            <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">                clearTimeout(timeout);</span><br><span class="line">                timeout = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            previous = now;</span><br><span class="line">            result = func.apply(context, args);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> (!timeout &amp;&amp; options.trailing !== <span class="literal">false</span>) &#123;</span><br><span class="line">            timeout = setTimeout(later, remaining);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">    throttled.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        previous = <span class="number">0</span>;</span><br><span class="line">        timeout = context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> throttled;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单的介绍一下防抖与节流&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>HTML5中Video标签无法播放mp4的解决办法</title>
    <link href="/2019/03/21/HTML5%E4%B8%ADVideo%E6%A0%87%E7%AD%BE%E6%97%A0%E6%B3%95%E6%92%AD%E6%94%BEmp4%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/</id>
    <published>2019-03-21T01:13:22.000Z</published>
    <updated>2019-03-27T07:32:06.085Z</updated>
    
    <content type="html"><![CDATA[<p>解决其它格式视频转mp4格式文件，video标签无法播放问题<br><a id="more"></a></p><h2 id="HTML5中Video标签无法播放mp4的解决办法"><a href="#HTML5中Video标签无法播放mp4的解决办法" class="headerlink" title="HTML5中Video标签无法播放mp4的解决办法"></a>HTML5中Video标签无法播放mp4的解决办法</h2><p>首先，浏览器使用环境chrome<br>在使用video标签播放视频的时候，我一般都选择mp4格式的文件，在网上下载的demo视频或者是手机拍摄的mp4文件都可以播放，但是，我用格式工厂把avi格式的文件转换成mp4文件就无法播放，为什么呢？<br>带着疑问，上网找答案，找到了原因，如下：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/1.png" alt="img"><br>使用格式工厂的mp4转换功能转出来的mp4文件并不能使用，于是把能播放的视频文件和不能播放的视频文件的编码格式对比了一下<br>可以播放的：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/2.png" alt="img"><br>不可以播放的：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/3.png" alt="img"><br>所以，在格式工厂转换的时候需要转成AVC编码格式的mp4文件<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/4.png" alt="img"><br>好了，按照这种方式就可以正常播放了。<br>*补充更新：<br>上边的方式在pc端chrome浏览器上可以，但是在移动端上还是无法播放，最后没有办法，我采用了WebM格式。<br>格式工厂可以转换，见下图<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/5.png" alt="img"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;解决其它格式视频转mp4格式文件，video标签无法播放问题&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>移动端兼容性</title>
    <link href="/2019/03/05/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    <id>/2019/03/05/移动端兼容性/</id>
    <published>2019-03-05T01:43:57.000Z</published>
    <updated>2019-03-07T06:05:28.759Z</updated>
    
    <content type="html"><![CDATA[<p>移动端有关html标签节点的兼容性问题<br><a id="more"></a></p><h2 id="移动端兼容性"><a href="#移动端兼容性" class="headerlink" title="移动端兼容性"></a>移动端兼容性</h2><h3 id="meta标签"><a href="#meta标签" class="headerlink" title="meta标签"></a>meta标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// viewport就啥也不说了，必须得加</span></span><br><span class="line">&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动或禁用自动识别页面中的电话号码</span></span><br><span class="line">&lt;meta name=<span class="string">"format-detection"</span> content=<span class="string">"telephone=no"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动或禁用自动识别邮箱地址</span></span><br><span class="line">&lt;meta name=<span class="string">"format-detection"</span>  content=<span class="string">"email=no"</span> /&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 Web 应用是否以全屏模式运行。</span></span><br><span class="line">&lt;meta name=<span class="string">"apple-mobile-web-app-capable"</span> content=<span class="string">"yes"</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 的 safari 顶端状态条的样式，可选的参数有：default、black、black-translucent</span></span><br><span class="line">&lt;meta name=<span class="string">"apple-mobile-web-app-status-bar-style"</span>  content=<span class="string">"black"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// winphone 系统 a、input 标签被点击时产生的半透明灰色背景怎么去掉</span></span><br><span class="line">&lt;meta name=<span class="string">"msapplication-tap-highlight"</span>  content=<span class="string">"no"</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="body-img等标签"><a href="#body-img等标签" class="headerlink" title="body,img等标签"></a>body,img等标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁止 ios 长按时不触发系统的菜单，禁止 ios&amp;android 长按时下载图片</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-touch-callout: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止ios和android用户选中文字</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-user-select:none</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="图片不清晰"><a href="#图片不清晰" class="headerlink" title="图片不清晰"></a>图片不清晰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如，iphone6，设备款375，物理像素750，正常一张占1/3屏幕的图片，125px，如果准备一张125的</span></span><br><span class="line"><span class="comment">// 肯定会模糊，必须准备250px的。如果像iphone6 plus，像素比3， 占1/3的图片138px，实际需要414px。</span></span><br><span class="line"><span class="comment">// 解决方案：</span></span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    .css &#123;</span><br><span class="line">      background-image: url(<span class="string">'2x.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    .css &#123;</span><br><span class="line">      background-image: url(<span class="string">'3x.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="表单的标签"><a href="#表单的标签" class="headerlink" title="表单的标签"></a>表单的标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input 输入框不可编辑</span></span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"xxx"</span> disabled=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"xxx"</span> readonly=<span class="string">"true"</span>/&gt;</span><br><span class="line"><span class="comment">/* disabled 文本框变灰，通过request.getParameter("name")得不到文本框中的内容</span></span><br><span class="line"><span class="comment">readonly 只是使文本框不能输入，样式没有变化，通过request.getParameter("name")可以得到内容 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 输入的时候英文首字母的默认大写</span></span><br><span class="line">&lt;input autocapitalize=<span class="string">"off"</span> autocorrect=<span class="string">"off"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// android 上去掉语音输入按钮</span></span><br><span class="line">input::-webkit-input-speech-button &#123;</span><br><span class="line">  display: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios系统中元素被触摸时产生的半透明灰色遮罩怎么去掉</span></span><br><span class="line">a,button,input,textarea&#123;</span><br><span class="line">  -webkit-tap-highlight-color: rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>;)</span><br><span class="line">  -webkit-user-modify:read-write-plaintext-only;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">/* -webkit-user-modify 这个属性使用需谨慎，副作用就是输入法不再能够输入多个字符</span></span><br><span class="line"><span class="comment">另外，有些机型去除不了，如小米2</span></span><br><span class="line"><span class="comment">对于按钮类，不使用a或者input标签，直接用div标签 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单元素的默认外观重置</span></span><br><span class="line">  -webkit-appearance:none;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改表单输入框 placeholder 的颜色值</span></span><br><span class="line">  input::-webkit-input-placeholder&#123;color:#ccc;&#125; </span><br><span class="line">  input:focus::-webkit-input-placeholder&#123;color:#eee;&#125; </span><br><span class="line"><span class="comment">// 注意 placeholder,  ios 可以换行，android 不可以</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Input 的placeholder会出现文本位置偏上的情况</span></span><br><span class="line">input 的placeholder会出现文本位置偏上的情况：PC端设置line-height等于height能够对齐，而移动端仍然是偏上，解决是设置line-height：normal</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用 select 默认下拉箭头</span></span><br><span class="line">select::-ms-expand &#123;<span class="attr">display</span>: none;&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用 radio 和 checkbox 默认样式</span></span><br><span class="line">input[type=radio]::-ms-check,</span><br><span class="line">input[type=checkbox]::-ms-check &#123; </span><br><span class="line">  display: none; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="a标签"><a href="#a标签" class="headerlink" title="a标签"></a>a标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">部分安卓手机 a 标签用作按钮的时候，页面显示空白</span><br><span class="line">解决办法：用 button 标签替换 a 标签</span><br></pre></td></tr></table></figure><h3 id="button"><a href="#button" class="headerlink" title="button"></a>button</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去除button在ios上的默认样式</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-appearance: none;</span><br><span class="line">  border-radius: <span class="number">0</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不想让按钮touch时有蓝色的边框     </span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-tap-highlight-color:rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="audio和video"><a href="#audio和video" class="headerlink" title="audio和video"></a>audio和video</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在ios和andriod中,audio元素和video元素在无法自动播放</span></span><br><span class="line"><span class="comment">// 应对方案：触屏即播</span></span><br><span class="line">$(<span class="string">'html'</span>).one(<span class="string">'touchstart'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    audio.play()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 视频默认全屏播放，如何阻止全屏播放－ webkit-playsinline</span></span><br><span class="line">&lt;video id=<span class="string">"video"</span> src=<span class="string">""</span> webkit-playsinline poster=<span class="string">""</span> &gt;<span class="xml"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 视频，音频获取播放结束后的回调函数－ended</span></span><br><span class="line">$(<span class="string">'#video'</span>).on(<span class="string">'ended'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  alert(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="click点击事件"><a href="#click点击事件" class="headerlink" title="click点击事件"></a>click点击事件</h3><h4 id="300毫秒延迟"><a href="#300毫秒延迟" class="headerlink" title="300毫秒延迟"></a>300毫秒延迟</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 300毫秒延迟解决方案</span></span><br><span class="line"><span class="number">1.</span>fastclick可以解决在手机上点击事件的<span class="number">300</span>ms延迟</span><br><span class="line"><span class="number">2.</span>zepto的touch模块，tap事件也是为了解决在click的延迟问题</span><br><span class="line"><span class="number">3.</span>触摸事件的响应顺序为 touchstart --&gt; touchmove --&gt; touchend --&gt; click,也可以通过绑定ontouchstart事件，加快对事件的响应，解决<span class="number">300</span>ms延迟问题</span><br></pre></td></tr></table></figure><h4 id="ios-label-span-监听click事件-不触发"><a href="#ios-label-span-监听click事件-不触发" class="headerlink" title="ios(label,span)监听click事件,不触发"></a>ios(label,span)监听click事件,不触发</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所监听元素加上</span></span><br><span class="line">.css &#123;</span><br><span class="line">  cursor:pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h2><h3 id="webkit-keyframes-注意"><a href="#webkit-keyframes-注意" class="headerlink" title="@-webkit-keyframes 注意"></a>@-webkit-keyframes 注意</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以<span class="number">0</span>%开始<span class="number">100</span>%结束，<span class="number">0</span>%的百分号不能去掉</span><br><span class="line">after和before伪类无法使用动画</span><br></pre></td></tr></table></figure><h3 id="border-radius-注意"><a href="#border-radius-注意" class="headerlink" title="border-radius 注意"></a>border-radius 注意</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不支持%单位</span><br><span class="line">三星 Galaxy S4中自带浏览器不支持 border-radius 缩写</span><br><span class="line">同时写入 border-radius 和背景色的时候，背景色会溢出到圆角以外部分</span><br></pre></td></tr></table></figure><h3 id="解决-transition-闪屏"><a href="#解决-transition-闪屏" class="headerlink" title="解决 transition 闪屏"></a>解决 transition 闪屏</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.css&#123; </span><br><span class="line">  <span class="comment">/*设置内嵌的元素在 3D 空间如何呈现：保留 3D*/</span> </span><br><span class="line">  -webkit-transform-style: preserve<span class="number">-3</span>d; </span><br><span class="line">  <span class="comment">/*（设置进行转换的元素的背面在面对用户时是否可见：隐藏）*/</span> </span><br><span class="line">  -webkit-backface-visibility: hidden; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="阻止用户调整微信浏览器字体大小"><a href="#阻止用户调整微信浏览器字体大小" class="headerlink" title="阻止用户调整微信浏览器字体大小"></a>阻止用户调整微信浏览器字体大小</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ios 管事，android 暂无解决方案</span></span><br><span class="line">body&#123;</span><br><span class="line">  -webkit-text-size-adjust: <span class="number">100</span>%!important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="屏幕旋转的事件和样式"><a href="#屏幕旋转的事件和样式" class="headerlink" title="屏幕旋转的事件和样式"></a>屏幕旋转的事件和样式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 事件</span></span><br><span class="line"><span class="built_in">window</span>.orientation，取值：正负<span class="number">90</span>表示横屏模式、<span class="number">0</span>和<span class="number">180</span>表现为竖屏模式；</span><br><span class="line"><span class="comment">// 代码判断</span></span><br><span class="line"><span class="built_in">window</span>.onorientationchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">  <span class="keyword">switch</span>(<span class="built_in">window</span>.orientation)&#123; </span><br><span class="line">    <span class="keyword">case</span> <span class="number">-90</span>: </span><br><span class="line">    <span class="keyword">case</span> <span class="number">90</span>: </span><br><span class="line">        alert(<span class="string">"横屏:"</span> + <span class="built_in">window</span>.orientation); </span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: </span><br><span class="line">    <span class="keyword">case</span> <span class="number">180</span>: </span><br><span class="line">        alert(<span class="string">"竖屏:"</span> + <span class="built_in">window</span>.orientation); </span><br><span class="line">    <span class="keyword">break</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 样式</span></span><br><span class="line"><span class="comment">/*竖屏时使用的样式*/</span> </span><br><span class="line">@media all and (orientation:portrait) &#123;</span><br><span class="line">  .css&#123;&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横屏时使用的样式*/</span> </span><br><span class="line">@media all and (orientation:landscape) &#123;</span><br><span class="line">  .css&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fixed元素无法点击"><a href="#fixed元素无法点击" class="headerlink" title="fixed元素无法点击"></a>fixed元素无法点击</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">场景：父元素设置position: fixed;</span><br><span class="line">子元素设置position: absolute;</span><br><span class="line">此时，如果父元素/子元素还设置了overflow: hidden 则出现“父元素遮挡该子元素“的bug。</span><br><span class="line">视觉(view)层并没有出现遮挡，只是无法触发绑定在该子元素上的事件。可理解为：「看到点不到」。</span><br><span class="line">补充： 页面往下滚动，触发position: fixed;的特性时，才会出现这个bug，在最顶不会出现。</span><br><span class="line">测试平台： 小米<span class="number">1</span>S，Android4<span class="number">.0</span>的Chrome18</span><br><span class="line">解决办法： 把父元素和子元素的overflow: hidden去掉。</span><br></pre></td></tr></table></figure><h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">body如果设置height:<span class="number">100</span>%;overflow:hidden是依然可以滑动的，如果需禁止，</span><br><span class="line">要再加一层div设置 height:<span class="number">100</span>%加overflow：hidden（html,body加height:<span class="number">100</span>%） ，</span><br><span class="line">这样元素超出body的高度也不能滑动了。</span><br><span class="line">或者同时给html，body加height:<span class="number">100</span>%;overflow:hidden</span><br></pre></td></tr></table></figure><h3 id="ios阻止旋转屏幕时自动调整字体大小"><a href="#ios阻止旋转屏幕时自动调整字体大小" class="headerlink" title="ios阻止旋转屏幕时自动调整字体大小"></a>ios阻止旋转屏幕时自动调整字体大小</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html, body, form, fieldset, p, div, h1, h2, h3, h4, h5, h6 &#123;</span><br><span class="line">  -webkit-text-size-adjust:none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过transform进行skew变形，rotate旋转会造成出现锯齿现象"><a href="#通过transform进行skew变形，rotate旋转会造成出现锯齿现象" class="headerlink" title="通过transform进行skew变形，rotate旋转会造成出现锯齿现象"></a>通过transform进行skew变形，rotate旋转会造成出现锯齿现象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-webkit-transform: rotate(<span class="number">-4</span>deg) skew(<span class="number">10</span>deg) translateZ(<span class="number">0</span>);</span><br><span class="line">transform: rotate(<span class="number">-4</span>deg) skew(<span class="number">10</span>deg) translateZ(<span class="number">0</span>);</span><br><span class="line">outline: <span class="number">1</span>px solid rgba(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="iOS6下伪类-hover"><a href="#iOS6下伪类-hover" class="headerlink" title="iOS6下伪类:hover"></a>iOS6下伪类:hover</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">除了&lt;a&gt;之外的元素无效；在Android下则有效。类似</span><br><span class="line">div#topFloatBar_l:hover #topFloatBar_menu &#123;</span><br><span class="line">  display:block; </span><br><span class="line">&#125;</span><br><span class="line">这样的导航显示在iOS6点击没有点击效果，只能通过增加点击侦听器给元素增减<span class="class"><span class="keyword">class</span>来控制子元素。</span></span><br></pre></td></tr></table></figure><h3 id="点击按钮时背景变黑色的解决"><a href="#点击按钮时背景变黑色的解决" class="headerlink" title="点击按钮时背景变黑色的解决"></a>点击按钮时背景变黑色的解决</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击按钮时背景变黑色的解决</span></span><br><span class="line">-webkit-tap-highlight-color: transparent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们去掉默认的大黑块儿后，要添加自己想要的点击时按住按钮的效果，用以下代码：</span></span><br><span class="line">span:active&#123;</span><br><span class="line">  box-shadow: inset 0 5px 10px #B41313,inset 0 -5px 10px #B41313;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加完上述代码后，在安卓上，都可以看到想要的效果，但是iphone上依旧不行，</span></span><br><span class="line"><span class="comment">// :active  需要一个触发事件才可以，于是乎，用以下代码：</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><h3 id="retina屏下border的1px会变粗"><a href="#retina屏下border的1px会变粗" class="headerlink" title="retina屏下border的1px会变粗"></a>retina屏下border的1px会变粗</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为像素比，比如，iphone6的像素比是2，window.devicePixelRatio可以查看，</span></span><br><span class="line"><span class="comment">// iphone6的设备宽是375,而物理像素是750，在css中的1px，实际控制的是2px的像素，</span></span><br><span class="line"><span class="comment">// 所以看起来会变粗了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决一：IOS8下已经支持带小数的px值, media query对应devicePixelRatio有个查询值-webkit-min-device-pixel-ratio, css可以写成这样</span></span><br><span class="line">.border &#123; border: 1px solid #999 &#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    .border &#123; border: 0.5px solid #999 &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    .border &#123; border: 0.333333px solid #999 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决二：background渐变</span></span><br><span class="line"><span class="comment">// 背景渐变, 渐变在透明色和边框色中间分割, frozenUI用的就是这种方法, 借用它的上边框写法:</span></span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)&#123;</span><br><span class="line">    .ui-border-t &#123;</span><br><span class="line">        background-position: left top;</span><br><span class="line">        background-image: -webkit-gradient(linear,left bottom,left top,color-stop(0.5,transparent),color-stop(0.5,#e0e0e0),to(#e0e0e0));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决三：</span></span><br><span class="line"><span class="comment">// :before, :after与transform</span></span><br><span class="line">.radius-border&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)&#123;</span><br><span class="line">    .radius-border:before&#123;</span><br><span class="line">        content: <span class="string">""</span>;</span><br><span class="line">        pointer-events: none; <span class="comment">/* 防止点击触发 */</span></span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: <span class="number">200</span>%;</span><br><span class="line">        height: <span class="number">200</span>%;</span><br><span class="line">        left: <span class="number">0</span>;</span><br><span class="line">        top: <span class="number">0</span>;</span><br><span class="line">        border-radius: <span class="number">8</span>px;</span><br><span class="line">        border:1px solid #999;</span><br><span class="line">        -webkit-transform(scale(<span class="number">0.5</span>));</span><br><span class="line">        -webkit-transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">        transform(scale(<span class="number">0.5</span>));</span><br><span class="line">        transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;移动端有关html标签节点的兼容性问题&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="移动端" scheme="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/"/>
    
      <category term="兼容性" scheme="/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>vue自定义指令之输入框限制字数</title>
    <link href="/2019/03/01/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E4%B9%8B%E8%BE%93%E5%85%A5%E6%A1%86%E9%99%90%E5%88%B6%E5%AD%97%E6%95%B0/"/>
    <id>/2019/03/01/vue自定义指令之输入框限制字数/</id>
    <published>2019-03-01T06:36:24.000Z</published>
    <updated>2019-03-04T08:15:45.039Z</updated>
    
    <content type="html"><![CDATA[<p>input输入框限制字数的指令制作<br><a id="more"></a></p><h2 id="vue自定义指令之输入框限制字数"><a href="#vue自定义指令之输入框限制字数" class="headerlink" title="vue自定义指令之输入框限制字数"></a>vue自定义指令之输入框限制字数</h2><p>vue自定义指令没啥说的，说明见<a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">官网</a>,具体代码见下面:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'inputvalidatecounter'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nSpan = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>),</span><br><span class="line">        nInput = el.querySelector(<span class="string">'input'</span>),</span><br><span class="line">        count = +binding.expression || <span class="number">50</span>;</span><br><span class="line">    el.appendChild(nSpan);</span><br><span class="line">    nSpan.innerHTML = <span class="string">'还可以填写'</span>+count+<span class="string">'字'</span>;</span><br><span class="line">    nInput.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> num = count - <span class="keyword">this</span>.value.length;</span><br><span class="line">      <span class="keyword">if</span>(num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> substr = <span class="keyword">this</span>.value.substring(<span class="number">0</span>,count<span class="number">-1</span>);</span><br><span class="line">          <span class="keyword">this</span>.value = substr;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      nSpan.innerHTML = <span class="string">'还可以填写'</span>+(num&lt;<span class="number">0</span>?<span class="number">0</span>:num)+<span class="string">'字'</span>;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>需要注意的地方：</p><ul><li>这个指令只适用于iview的Input组件，看里边操作dom元素就可以看出来，想改成其它的也是简单。</li><li><h1 id="在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。"><a href="#在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。" class="headerlink" title="在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。"></a>在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。</h1>2019年3月4日更改<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'inputvalidatecounter'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding, vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nSpan = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>),</span><br><span class="line">        nInput = el.querySelector(<span class="string">'input'</span>) || el.querySelector(<span class="string">'textarea'</span>),</span><br><span class="line">        count = +binding.expression || <span class="number">50</span>;</span><br><span class="line">    el.appendChild(nSpan);</span><br><span class="line">    nSpan.innerHTML = <span class="string">'还可以填写'</span>+count+<span class="string">'字'</span>;</span><br><span class="line">    nInput.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> num = count - <span class="keyword">this</span>.value.length;</span><br><span class="line">      <span class="keyword">if</span>(num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> substr = <span class="keyword">this</span>.value.substring(<span class="number">0</span>,count);</span><br><span class="line">          <span class="keyword">this</span>.value = substr;</span><br><span class="line">          <span class="comment">// 新添加开始</span></span><br><span class="line">          <span class="keyword">var</span> keyArr = vnode.data.model.expression.split(<span class="string">'.'</span>);</span><br><span class="line">          <span class="keyword">var</span> evalStr = <span class="string">'vnode.context._data'</span>;</span><br><span class="line">          keyArr.forEach(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span><br><span class="line">            evalStr += <span class="string">'["'</span>+item+<span class="string">'"]'</span>;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="built_in">eval</span>(evalStr+<span class="string">'="'</span>+<span class="keyword">this</span>.value+<span class="string">'"'</span>)</span><br><span class="line">          <span class="comment">// 新添加结束</span></span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      nSpan.innerHTML = <span class="string">'还可以填写'</span>+(num&lt;<span class="number">0</span>?<span class="number">0</span>:num)+<span class="string">'字'</span>;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><p>新添加的内容只有几行，其实是为了修改第一版的bug，当在input里输入内容的时候，超过一定字数后，进入延迟函数，这里把input的value值更改了，但是并没有更改这个指令所在组件里v-model的值，所以，这里需要修正。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vnode是这个指令所在的组建的虚拟dom</span></span><br><span class="line"><span class="comment">// vnode.data.model.expression 这就可以直接找到v-model里的变量名</span></span><br><span class="line"><span class="keyword">var</span> keyArr = vnode.data.model.expression.split(<span class="string">'.'</span>);</span><br><span class="line"><span class="comment">// vnode知道了，vnode.context很显然就是组件所在的父级组件，可以通过 _data 这个数据去改变v-model里变量的值。</span></span><br><span class="line"><span class="keyword">var</span> evalStr = <span class="string">'vnode.context._data'</span>;</span><br><span class="line">keyArr.forEach(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span><br><span class="line">  evalStr += <span class="string">'["'</span>+item+<span class="string">'"]'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 经过上边的循环是因为这种情况, v-model="formitem.name"，像这种的值，而不是v-model="name"这种。</span></span><br><span class="line"><span class="comment">// 最后需要eval来执行这些字符串组成的代码。</span></span><br><span class="line"><span class="built_in">eval</span>(evalStr+<span class="string">'="'</span>+<span class="keyword">this</span>.value+<span class="string">'"'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;input输入框限制字数的指令制作&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="vue" scheme="/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>js图片下载之后端部分</title>
    <link href="/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86/"/>
    <id>/2019/02/27/js图片下载之后端部分/</id>
    <published>2019-02-27T05:31:24.000Z</published>
    <updated>2019-02-27T06:05:37.582Z</updated>
    
    <content type="html"><![CDATA[<p>nodejs服务返回图片二进制数据<br><a id="more"></a></p><h2 id="js图片下载之后端部分"><a href="#js图片下载之后端部分" class="headerlink" title="js图片下载之后端部分"></a>js图片下载之后端部分</h2><p>本站<a href="/2019/02/27/js图片下载之前端部分/">《js图片下载之前端部分》</a>,写了如何利用js来下载图片，第二种方式需要后端返回图片的二进制数据，这篇文章我来写一下如何使用nodejs向前端返图片的二进制数据，我总结了三种方法。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  fs.createReadStream(<span class="string">'./img/1.jpg'</span>)</span><br><span class="line">  .pipe(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这种方法利用了stream和pipe，一行代码就解决了，利用fs去读取图片的流只有，用pipe方法把流转给res，res自动就把数据返回给前端。</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> readerStream = fs.createReadStream(process.cwd() + <span class="string">'/img/1.jpg'</span>);</span><br><span class="line">  <span class="comment">// 设置编码为 binary 必须</span></span><br><span class="line">  readerStream.setEncoding(<span class="string">'binary'</span>);</span><br><span class="line">  readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">     data += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 必须加上binary，返回的是二进制</span></span><br><span class="line">    res.end(data, <span class="string">'binary'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这个方法其实跟第一个差不多，都是使用了fs的流来读取图片，但是没有使用pipe直接把数据流转给res，需要自己监听数据来处理，这里我试验了好多方式，终于成功了，注意readerStream.setEncoding(‘binary’)和res.end(data, ‘binary’)，都需要加上binary格式。</p><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">    fs.readFile(<span class="string">'./img/1.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">     &#125;</span><br><span class="line">     res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这种方法时最简单的，但是遇到大文件会影响计算机的性能。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>最后整体代码贴一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>,<span class="string">' 3.2.1'</span>)</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream+pipe方式一</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  fs.createReadStream(<span class="string">'./img/1.jpg'</span>)</span><br><span class="line">  .pipe(res);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// stream方式二</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> readerStream = fs.createReadStream(process.cwd() + <span class="string">'/img/1.jpg'</span>);</span><br><span class="line">  <span class="comment">// 设置编码为 binary 必须</span></span><br><span class="line">  readerStream.setEncoding(<span class="string">'binary'</span>);</span><br><span class="line">  readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">     data += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 必须加上binary，返回的是二进制</span></span><br><span class="line">    res.end(data, <span class="string">'binary'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接读取整个文件方式三</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">    fs.readFile(<span class="string">'./img/1.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">     &#125;</span><br><span class="line">     res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nodejs服务返回图片二进制数据&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="nodejs" scheme="/categories/nodejs/"/>
    
    
      <category term="图片处理" scheme="/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>js图片下载之前端部分</title>
    <link href="/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/"/>
    <id>/2019/02/27/js图片下载之前端部分/</id>
    <published>2019-02-27T02:31:41.000Z</published>
    <updated>2019-02-27T06:03:47.927Z</updated>
    
    <content type="html"><![CDATA[<p>js控制图片下载<br><a id="more"></a></p><h2 id="js图片下载之前端部分"><a href="#js图片下载之前端部分" class="headerlink" title="js图片下载之前端部分"></a>js图片下载之前端部分</h2><p>这两天有一个小需求，就是点击页面中的下载按钮，下载指定的图片。经过一番的小研究，发现想实现这个功能，基本上都用到a标签的download属性，也就a标签的href指向图片地址，加上download属性后，点a标签就可以下载图片了。但是，有个问题，这需要在同域名下才好用，跨域貌似都不行，所以，在跨域的情况下就得另想办法。我总结了两种方法，一一道来。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>利用canvas，就是有一个图片地址，利用canvas把图片画出来，之后再通过canvas的toDataURL方法，将图片转为base64的数据，再把这个数据赋值给a标签的href属性，就可以了。这里注意一点，canvas调取toDataURL方法时，如果是跨域图片需要后台允许跨域，还需要在img标签的”crossOrigin”属性设置为’Anonymous’才管用，最后贴出具体代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadImg</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 通过构造函数来创建的 img 实例，在赋予 src 值后就会立刻下载图片，相比 createElement() 创建 &lt;img&gt; 省去了 append()，也就避免了文档冗余和污染</span></span><br><span class="line">        <span class="keyword">var</span> Img = <span class="keyword">new</span> Image(),</span><br><span class="line">            dataURL=<span class="string">''</span>;</span><br><span class="line">        Img.setAttribute(<span class="string">"crossOrigin"</span>,<span class="string">'Anonymous'</span>); <span class="comment">// 这里允许了跨域图片</span></span><br><span class="line">        Img.src=url;</span><br><span class="line">        Img.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 要先确保图片完整获取到，这是个异步事件</span></span><br><span class="line">            <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>), <span class="comment">// 创建canvas元素</span></span><br><span class="line">                width=Img.width, <span class="comment">// 确保canvas的尺寸和图片一样</span></span><br><span class="line">                height=Img.height;</span><br><span class="line">            canvas.width=width;</span><br><span class="line">            canvas.height=height;</span><br><span class="line">            canvas.getContext(<span class="string">"2d"</span>).drawImage(Img,<span class="number">0</span>,<span class="number">0</span>,width,height); <span class="comment">// 将图片绘制到canvas中</span></span><br><span class="line">            dataURL=canvas.toDataURL(<span class="string">'image/jpeg'</span>); <span class="comment">// 转换图片为dataURL</span></span><br><span class="line">            <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>),</span><br><span class="line">        body = <span class="built_in">document</span>.body;</span><br><span class="line">            a.download = <span class="string">'img.jpg'</span>;</span><br><span class="line">            a.href = dataURL;</span><br><span class="line">            body.append(a); </span><br><span class="line">            a.click();</span><br><span class="line">            body.removeChild(a);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>第二种方法就需要后端配合了，前端使用ajax请求到图片的二进制数据，之后利用了FileReader这个API，具体看代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">downloadImg</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, url, <span class="literal">true</span>);    <span class="comment">// 请求方式</span></span><br><span class="line">  xhr.responseType = <span class="string">"blob"</span>;  <span class="comment">// 返回类型blob</span></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 请求完成</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="comment">// 返回200</span></span><br><span class="line">      <span class="keyword">var</span> blob = <span class="keyword">this</span>.response;</span><br><span class="line">      <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">      reader.readAsDataURL(blob);  <span class="comment">// 转换为base64，可以直接放入a标签的href</span></span><br><span class="line">      reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 转换完成，创建一个a标签用于下载</span></span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>),</span><br><span class="line">        body = <span class="built_in">document</span>.body;</span><br><span class="line">        a.download = <span class="string">'img.jpg'</span>;</span><br><span class="line">        a.href = e.target.result;</span><br><span class="line">        body.append(a); </span><br><span class="line">        a.click();</span><br><span class="line">        body.removeChild(a);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 发送ajax请求</span></span><br><span class="line">  xhr.send()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这个方法需要后端发送图片的二进制数据，我也写了nodejs的发送方法，见<a href="/2019/02/27/js图片下载之后端部分/">《js图片下载之后端部分》</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;js控制图片下载&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
      <category term="图片处理" scheme="/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>浏览器消息提示Notification</title>
    <link href="/2019/02/14/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BANotification/"/>
    <id>/2019/02/14/浏览器消息提示Notification/</id>
    <published>2019-02-14T06:41:44.000Z</published>
    <updated>2019-02-14T06:54:50.672Z</updated>
    
    <content type="html"><![CDATA[<p>浏览器自带的消息提示框<br><a id="more"></a></p><h2 id="浏览器消息提示Notification"><a href="#浏览器消息提示Notification" class="headerlink" title="浏览器消息提示Notification"></a>浏览器消息提示Notification</h2><p>这两天有一个新需求，微信网页版有这个功能，就是当浏览器最小化后，微信来消息，这时在电脑桌面的右下角会有消息提示框。<br>这个功能用到了浏览器新特性的Notification接口，虽说兼容性不好，但是在现代浏览器上使用还是可以的。<br>直接贴出demo:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Notification&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;button id=<span class="string">"message"</span>&gt;弹消息&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button id="message-delay"&gt;弹消息延迟&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  var btn = document.getElementById('message');</span></span><br><span class="line"><span class="regexp">  var btnDelay = document.getElementById('message-delay');</span></span><br><span class="line"><span class="regexp">  btn.addEventListener('click', ()=&gt; &#123;</span></span><br><span class="line"><span class="regexp">    notifyMe(&#123;</span></span><br><span class="line"><span class="regexp">      title: '消息通知',</span></span><br><span class="line"><span class="regexp">      body: '菜品订单',</span></span><br><span class="line"><span class="regexp">      icon: './</span>asset/image/icon.png<span class="string">'</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  btnDelay.addEventListener('</span>click<span class="string">', ()=&gt; &#123;</span></span><br><span class="line"><span class="string">      setTimeout(()=&gt; &#123;</span></span><br><span class="line"><span class="string">        notifyMe(&#123;</span></span><br><span class="line"><span class="string">          title: '</span>消息通知<span class="string">',</span></span><br><span class="line"><span class="string">          body: '</span>菜品订单<span class="string">',</span></span><br><span class="line"><span class="string">          icon: '</span>./asset/image/icon.png<span class="string">'</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">      &#125;, 5000);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  function notifyMe(options) &#123;</span></span><br><span class="line"><span class="string">    // if(!document.hidden) return; // 判断浏览器是否最小化</span></span><br><span class="line"><span class="string">    // 先检查浏览器是否支持</span></span><br><span class="line"><span class="string">    if (!("Notification" in window)) &#123;</span></span><br><span class="line"><span class="string">      alert("This browser does not support desktop notification");</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 检查用户是否同意接受通知</span></span><br><span class="line"><span class="string">    else if (Notification.permission === "granted") &#123;</span></span><br><span class="line"><span class="string">      // If it'</span>s okay <span class="keyword">let</span><span class="string">'s create a notification</span></span><br><span class="line"><span class="string">      var notification = new Notification(options.title, &#123;</span></span><br><span class="line"><span class="string">        body: options.body,</span></span><br><span class="line"><span class="string">        icon: options.icon,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 否则我们需要向用户获取权限</span></span><br><span class="line"><span class="string">    else if (Notification.permission !== '</span>denied<span class="string">') &#123;</span></span><br><span class="line"><span class="string">      Notification.requestPermission(function (permission) &#123;</span></span><br><span class="line"><span class="string">        // 如果用户同意，就可以向他们发送通知</span></span><br><span class="line"><span class="string">        if (permission === "granted") &#123;</span></span><br><span class="line"><span class="string">          var notification = new Notification(options.title, &#123;</span></span><br><span class="line"><span class="string">            body: options.body,</span></span><br><span class="line"><span class="string">            icon: options.icon,</span></span><br><span class="line"><span class="string">          &#125;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 过3秒关闭提示框</span></span><br><span class="line"><span class="string">    setTimeout(function() &#123;</span></span><br><span class="line"><span class="string">      notification.close();</span></span><br><span class="line"><span class="string">    &#125;, 3000);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;浏览器自带的消息提示框&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
</feed>
