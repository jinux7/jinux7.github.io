<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jinux</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="/"/>
  <updated>2019-04-10T08:02:51.446Z</updated>
  <id>/</id>
  
  <author>
    <name>jinux</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>let存在变量提升吗?</title>
    <link href="/2019/04/10/let%E5%AD%98%E5%9C%A8%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E5%90%97/"/>
    <id>/2019/04/10/let存在变量提升吗/</id>
    <published>2019-04-10T07:20:08.000Z</published>
    <updated>2019-04-10T08:02:51.446Z</updated>
    
    <content type="html"><![CDATA[<p>javascript中关于let的一些小知识<br><a id="more"></a></p><h2 id="let存在变量提升吗"><a href="#let存在变量提升吗" class="headerlink" title="let存在变量提升吗?"></a>let存在变量提升吗?</h2><p>let是ES6推出的新语法，平时简单的用大家都明白，但是里边的原理还是很深的。<br>在MDN的文档中对于let的特性是这样说的：</p><ul><li>let 声明的变量的作用域是块级的；</li><li>let 不能重复声明已存在的变量；</li><li>let 有暂时死区，不会被提升。<br>我们来看一个小demo<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  let b = 12</span></span><br><span class="line"><span class="regexp">  console.log(b)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></li></ul><p>代码执行报错：Uncaught SyntaxError: Identifier ‘b’ has already been declared</p><p>先给window创建b的属性，然后再去声明b，这个时候，b是个全局变量可以直接通过b访问，let 又不可以重复声明。此处可以解释的通。那么请看下面的代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  console.log(b)</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></p><p>如果把let b 提升到上面的script块就可以声明成功。如果说从上往下执行的话，b是已经存在的了，那么let b是不可以声明的成功的。</p><p>到这里就有些解释不通了。为什么window已经声明了b的属性，会成为一个单独的b变量。let 的时候却没有报错呢。这里就需要对let 是不是会变量提升划一个问号了。</p><p>先把这个问题放在这里，我们继续看下面这段代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.b)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>window下已经声明了b的属性，而且let 一个b 打印出来分别是22和12。这里我们假设存在变量提升的话，那么js引擎在预解析的时候会先声明b对象。然后实际执行的时候，再给window创建b属性。到这里我们就可以解释的通了。既然存在变量提升的话，我是不是可以在声明之前打印一下b的值呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">'b'</span>, &#123;</span><br><span class="line">    value: <span class="number">22</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">12</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>报错 Uncaught ReferenceError: b is not defined<br>纳尼？难道let 真的不存在变量提升？因为鄙人有强迫症，本着不达目的不罢休的目的，问了度娘，找到了如下的参考资料。<br>要搞清楚提升的本质，需要理解 JS 变量的「创建create、初始化initialize 和赋值assign」。<br>我们来看看 var 声明的「创建、初始化和赋值」过程<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>在执行 fn 时，会有以下过程（不完全）：</p><p>1.进入 fn，为 fn 创建一个环境。<br>2.找到 fn 中所有用 var 声明的变量，在这个环境中「创建」这些变量（即 x 和 y）。<br>3.将这些变量「初始化」为 undefined。<br>4.开始执行代码<br>5.x = 1 将 x 变量「赋值」为 1<br>6.y = 2 将 y 变量「赋值」为 2<br>也就是说 var 声明会在代码执行之前就将「创建变量，并将其初始化为 undefined」。<br>这就解释了为什么在 var x = 1 之前 console.log(x) 会得到 undefined。<br>接下来来看 function 声明的「创建、初始化和赋值」过程<br>假设代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">fn2()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>JS 引擎会有一下过程：<br>1.找到所有用 function 声明的变量，在环境中「创建」这些变量。<br>2.将这些变量「初始化」并「赋值」为 function(){ console.log(2) }。<br>3.开始执行代码 fn2()<br>也就是说 function 声明会在代码执行之前就「创建、初始化并赋值」。<br>接下来看 let 声明的「创建、初始化和赋值」过程<br>假设代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line">  x = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>我们只看 {} 里面的过程：<br>1.找到所有用 let 声明的变量，在环境中「创建」这些变量<br>2.开始执行代码（注意现在还没有初始化）<br>3.执行 x = 1，将 x 「初始化」为 1（这并不是一次赋值，如果代码是 let x，就将 x 初始化为 undefined）<br>4.执行 x = 2，对 x 进行「赋值」<br>这就解释了为什么在 let x 之前使用 x 会报错：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">let</span> x = <span class="string">'global'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x) <span class="comment">// Uncaught ReferenceError: x is not defined</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>原因有两个<br>1.console.log(x) 中的 x 指的是下面的 x，而不是全局的 x<br>2.执行 log 时 x 还没「初始化」，所以不能使用（也就是所谓的暂时死区）<br>看到这里，你应该明白了 let 到底有没有提升：<br>1.let 的「创建」过程被提升了，但是初始化没有提升。<br>2.var 的「创建」和「初始化」都被提升了。<br>function 的「创建」「初始化」和「赋值」都被提升了。</p><p>至此 我们也可以解释</p><ul><li>为什么跨script标签提示重复声明：因为浏览器是从上往下执行js代码的，也就是说在第一段js执行完成之后，再去预解析第二段js代码，执行第二段代码。</li><li>为什么在同一个script标签中可以定义b： 因为在js引擎预解析script的时候先创建了b。然后再执行Object.defineProperty为window增加b属性。所以此处的b和window.b不是一个变量。</li><li>为什么在同一个script标签中可以定义b，但是在b声明之前会报错b没有定义：因为只是创建了b变量，并没有初始化。没有初始化，变量是不可以使用的</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;javascript中关于let的一些小知识&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>封装ajax工具插件</title>
    <link href="/2019/04/03/%E5%B0%81%E8%A3%85ajax%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/"/>
    <id>/2019/04/03/封装ajax工具插件/</id>
    <published>2019-04-03T06:47:46.000Z</published>
    <updated>2019-04-03T07:07:43.636Z</updated>
    
    <content type="html"><![CDATA[<p>封装一个自己的ajax工具插件<br><a id="more"></a></p><h2 id="封装ajax工具插件"><a href="#封装ajax工具插件" class="headerlink" title="封装ajax工具插件"></a>封装ajax工具插件</h2><p>我们在平时开发的时候，ajax请求都会用到现有库，用的比较多的如jquery，axios等，偶尔自己写个原生ajax请求的情况也有，这些库是怎么写的呢，我们自己封装一个库，来学习学习ajax的一些基础知识。<br>在写这篇文章的时候，是因为头两天同事问我一个ajax问题，关于请求参数的，我突然回答不出来，忘记了，于是翻出来2年前自己封的ajax工具看了一眼，知道了怎么回事，决定把代码写到博客里，忘了的时候方便看一下。<br>下面我只贴出了核心代码，其他部分我会提供github的地址：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">window,undefined</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jinuxAjax挂载到window上</span></span><br><span class="line"><span class="built_in">window</span>.jinuxAjax = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line">ieAjaxInit();</span><br><span class="line"><span class="comment">//默认参数配置</span></span><br><span class="line"><span class="keyword">var</span> defaultOpt = &#123;</span><br><span class="line">url:<span class="string">''</span>,</span><br><span class="line">type: <span class="string">'GET'</span>,</span><br><span class="line">data: <span class="literal">null</span>,</span><br><span class="line">contentType: <span class="string">'application/x-www-form-urlencoded'</span>,<span class="comment">//'text/plain;charset=UTF-8','application/json','multipart/form-data'</span></span><br><span class="line">timeOut: <span class="number">5000</span>,</span><br><span class="line">files:[],</span><br><span class="line">progress: <span class="literal">null</span>,</span><br><span class="line">before: fn,</span><br><span class="line">success: fn,</span><br><span class="line">error: fn,</span><br><span class="line">complete: fn</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数对象继承获取新参数对象</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">Object</span>.assign)&#123;</span><br><span class="line"><span class="keyword">var</span> opt = <span class="built_in">Object</span>.assign(&#123;&#125;, defaultOpt, opt);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> defaultOpt)&#123;</span><br><span class="line">defaultOpt[name] = opt[name] || defaultOpt[name];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> opt = defaultOpt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestData(opt);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将json格式数据转成application/x-www-form-urlencoded格式数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encodeFormData</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!data) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line"><span class="keyword">var</span> pairs = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> data)&#123;</span><br><span class="line"><span class="keyword">if</span>(!data.hasOwnProperty(name)) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> data[name] === <span class="string">'function'</span>) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">var</span> value = data[name].toString();</span><br><span class="line">name = <span class="built_in">encodeURIComponent</span>(name.replace(<span class="string">'%20'</span>,<span class="string">'+'</span>));</span><br><span class="line">value = <span class="built_in">encodeURIComponent</span>(value.replace(<span class="string">'%20'</span>,<span class="string">'+'</span>));</span><br><span class="line">pairs.push(name + <span class="string">'='</span> + value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pairs.join(<span class="string">'&amp;'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax的get请求函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="keyword">var</span> timeoutFlag = <span class="literal">false</span>; <span class="comment">//是否超时</span></span><br><span class="line"><span class="comment">//启动计时器，做超时处理</span></span><br><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">timeoutFlag = <span class="literal">true</span>;</span><br><span class="line">request.abort();</span><br><span class="line">&#125;,opt.timeOut);</span><br><span class="line"></span><br><span class="line">request.open(<span class="string">'GET'</span>,opt.url +<span class="string">'?'</span>+ encodeFormData(opt.data));</span><br><span class="line">opt.before(); <span class="comment">//请求之前执行before函数</span></span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(request.readyState === <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(timeoutFlag) <span class="keyword">return</span>;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="keyword">if</span>(request.status === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> type = request.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line"><span class="comment">//检查type类型做相应的解析处理</span></span><br><span class="line"><span class="keyword">if</span>(type.indexOf(<span class="string">'xml'</span>) !== <span class="number">-1</span> &amp;&amp; request.responseXML)&#123; <span class="comment">//xml相应</span></span><br><span class="line">opt.success(request.responseXML);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.indexOf(<span class="string">'application/json'</span>) !== <span class="number">-1</span>) &#123; <span class="comment">//json相应</span></span><br><span class="line">opt.success(<span class="built_in">JSON</span>.parse(request.responseText));</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.success(request.responseText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.error(request);</span><br><span class="line">&#125;</span><br><span class="line">opt.complete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">request.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax的post请求函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">postData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest(), sendData=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> timeoutFlag = <span class="literal">false</span>; <span class="comment">//是否超时</span></span><br><span class="line"><span class="comment">//启动计时器，做超时处理</span></span><br><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">timeoutFlag = <span class="literal">true</span>;</span><br><span class="line">request.abort();</span><br><span class="line">&#125;,opt.timeOut);</span><br><span class="line"></span><br><span class="line">request.open(<span class="string">'POST'</span>,opt.url);</span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(request.readyState === <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(timeoutFlag) <span class="keyword">return</span>;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="keyword">if</span>(request.status === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> type = request.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line"><span class="comment">//检查type类型做相应的解析处理</span></span><br><span class="line"><span class="keyword">if</span>(type.indexOf(<span class="string">'xml'</span>) !== <span class="number">-1</span> &amp;&amp; request.responseXML)&#123; <span class="comment">//xml相应</span></span><br><span class="line">opt.success(request.responseXML);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.indexOf(<span class="string">'application/json'</span>) !== <span class="number">-1</span>) &#123; <span class="comment">//json相应</span></span><br><span class="line">opt.success(<span class="built_in">JSON</span>.parse(request.responseText));</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.success(request.responseText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">opt.error(request);</span><br><span class="line">&#125;</span><br><span class="line">opt.complete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理接收进度事件</span></span><br><span class="line"><span class="keyword">if</span>(opt.progress.enable &amp;&amp; request.upload)&#123;</span><br><span class="line">request.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(ev.lengthComputable)&#123;</span><br><span class="line">opt.progress.receiveHandle(ev);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">request.upload.onload = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">opt.progress.successHandle(ev);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(opt.contentType === <span class="string">'application/x-www-form-urlencoded'</span>)&#123;</span><br><span class="line">request.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>);</span><br><span class="line">sendData = encodeFormData(opt.data);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt.contentType === <span class="string">'application/json'</span>) &#123;</span><br><span class="line">request.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/json; charset=utf-8'</span>);</span><br><span class="line">sendData = <span class="built_in">JSON</span>.stringify(opt.data);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt.contentType === <span class="string">'multipart/form-data'</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> opt.data)&#123;</span><br><span class="line"><span class="keyword">if</span>( !opt.data.hasOwnProperty(name) ) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">typeof</span> opt.data[name] === <span class="string">'function'</span> ) <span class="keyword">continue</span>; </span><br><span class="line">fd.append(name,opt.data[name]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;opt.files.length; i++)&#123;</span><br><span class="line">fd.append(<span class="string">'file'</span>+i,opt.files[i]);</span><br><span class="line">&#125;</span><br><span class="line">sendData = fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.send(sendData);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ajax请求函数，在函数内再调用get或者post</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestData</span>(<span class="params">opt</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(opt.type === <span class="string">'GET'</span>)&#123;</span><br><span class="line">getData(opt);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">postData(opt);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个空函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果是ie6，创建XMLHttpRequest对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ieAjaxInit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest === <span class="literal">undefined</span>)&#123;</span><br><span class="line"><span class="built_in">window</span>.XMLHttpRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Msxml2.XMLHTTP.6.0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e1) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Msxml2.XMLHTTP.3.0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e2) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'不支持XMLHttpRequest'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure></p><p>详细代码请<a href="https://github.com/jinux7/jinux-ajax" target="_blank" rel="noopener">点击这里看源码</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;封装一个自己的ajax工具插件&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="ajax" scheme="/tags/ajax/"/>
    
  </entry>
  
  <entry>
    <title>防抖与节流</title>
    <link href="/2019/04/03/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/"/>
    <id>/2019/04/03/防抖与节流/</id>
    <published>2019-04-03T05:45:23.000Z</published>
    <updated>2019-04-03T06:32:46.011Z</updated>
    
    <content type="html"><![CDATA[<p>简单的介绍一下防抖与节流<br><a id="more"></a><br>作为一名前端开发者，我们经常会处理各种事件，比如常见的click、scroll、 resize等等。仔细一想，会发现像scroll、scroll、onchange这类事件会频繁触发，如果我们在回调中计算元素位置、做一些跟DOM相关的操作，引起浏览器回流和重绘，频繁触发回调，很可能会造成浏览器掉帧，甚至会使浏览器崩溃，影响用户体验。针对这种现象，目前有两种常用的解决方案：防抖和节流。</p><h2 id="防抖（debounce）"><a href="#防抖（debounce）" class="headerlink" title="防抖（debounce）"></a>防抖（debounce）</h2><p>所谓防抖，就是指触发事件后，就是把触发非常频繁的事件合并成一次去执行。即在指定时间内只执行一次回调函数，如果在指定的时间内又触发了该事件，则回调函数的执行时间会基于此刻重新开始计算。</p><ul><li>以我们生活中乘车刷卡的情景举例，只要乘客不断地在刷卡，司机师傅就不能开车，乘客刷卡完毕之后，司机会等待几分钟，确定乘客坐稳再开车。如果司机在最后等待的时间内又有新的乘客上车，那么司机等乘客刷卡完毕之后，还要再等待一会，等待所有乘客坐稳再开车。<br><img src="/2019/04/03/防抖与节流/1.jpg" alt="img"><br>具体应该怎么去实现这样的功能呢？第一时间肯定会想到使用setTimeout方法，那我们就尝试写一个简单的函数来实现这个功能吧~<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debounce = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timeId;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = <span class="keyword">this</span>, args = <span class="built_in">arguments</span>;</span><br><span class="line">    timeId &amp;&amp; clearTimeout(timeout);</span><br><span class="line">    timeId = setTimeout(<span class="function"><span class="keyword">function</span> </span>&#123;</span><br><span class="line">          fn.apply(context, args);</span><br><span class="line">        &#125;, delayTime)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>思路解析：<br>执行debounce函数之后会返回一个新的函数，通过闭包的形式，维护一个变量timeId，每次执行该函数的时候会结束之前的延迟操作，重新执行setTimeout方法，也就实现了上面所说的指定的时间内多次触发同一个事件，会合并执行一次。<br>温馨提示：<br>1、上述代码中arguments只会保存事件回调函数中的参数，譬如：事件对象等，并不会保存fn、delayTime<br>2、使用apply改变传入的fn方法中的this指向，指向绑定事件的DOM元素。</p><h2 id="节流（throttle）"><a href="#节流（throttle）" class="headerlink" title="节流（throttle）"></a>节流（throttle）</h2><p>所谓节流，是指频繁触发事件时，只会在指定的时间段内执行事件回调，即触发事件间隔大于等于指定的时间才会执行回调函数。</p><ul><li>类比到生活中的水龙头，拧紧水龙头到某种程度会发现，每隔一段时间，就会有水滴流出。<br><img src="/2019/04/03/防抖与节流/2.jpg" alt="img"><br>说到时间间隔，大家肯定会想到使用setTimeout来实现，在这里，我们使用两种方法来简单实现这种功能：时间戳和setTimeout定时器。</li><li>时间戳<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = (fn, delayTime) = &gt;&#123;</span><br><span class="line">    <span class="keyword">var</span> _start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _now = <span class="built_in">Date</span>.now(),</span><br><span class="line">        context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (_now - _start &gt;= delayTime) &#123;</span><br><span class="line">            fn.apply(context, args);</span><br><span class="line">            _start = <span class="built_in">Date</span>.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>通过比较两次时间戳的间隔是否大于等于我们事先指定的时间来决定是否执行事件回调。</p><ul><li>定时器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            flag = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn.apply(context, args);</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;,delayTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>在上述实现过程中，我们设置了一个标志变量flag，当delayTime之后执行事件回调，便会把这个变量重置，表示一次回调已经执行结束。 对比上述两种实现，我们会发现一个有趣的现象：<br>1、使用时间戳方式，页面加载的时候就会开始计时，如果页面加载时间大于我们设定的delayTime，第一次触发事件回调的时候便会立即fn，并不会延迟。如果最后一次触发回调与前一次触发回调的时间差小于delayTime，则最后一次触发事件并不会执行fn；<br>2、使用定时器方式，我们第一次触发回调的时候才会开始计时，如果最后一次触发回调事件与前一次时间间隔小于delayTime，delayTime之后仍会执行fn。<br>这两种方式有点优势互补的意思，哈哈~<br>我们考虑把这两种方式结合起来，便会在第一次触发事件时执行fn，最后一次与前一次间隔比较短，delayTime之后再次执行fn。<br>想法简单实现如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag, _start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">        args = <span class="built_in">arguments</span>,</span><br><span class="line">        _now = <span class="built_in">Date</span>.now(),</span><br><span class="line">        remainTime = delayTime - (_now - _start);</span><br><span class="line">        <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">            &#125;,remainTime)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过上面的分析，可以很明显的看出函数防抖和函数节流的区别：<br>频繁触发事件时，函数防抖只会在最后一次触发事件只会才会执行回调内容，其他情况下会重新计算延迟事件，而函数节流便会很有规律的每隔一定时间执行一次回调函数。</p><ul><li>requestAnimationFrame<br>之前，我们使用setTimeout简单实现了防抖和节流功能，如果我们不考虑兼容性，追求精度比较高的页面效果，可以考虑试试html5提供的API–requestAnimationFrame。<br>与setTimeout相比，requestAnimationFrame的时间间隔是有系统来决定，保证屏幕刷新一次，回调函数只会执行一次，比如屏幕的刷新频率是60HZ，即间隔1000ms/60会执行一次回调。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delayTime</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                fn();</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><p>上述代码的基本功能就是保证在屏幕刷新的时候（对于大多数的屏幕来说，大约16.67ms），可以执行一次回调函数fn。使用这种方式也存在一种比较明显的缺点，时间间隔只能跟随系统变化，我们无法修改，但是准确性会比setTimeout高一些。<br>注意：</p><ul><li>防抖和节流只是减少了事件回调函数的执行次数，并不会减少事件的触发频率。</li><li>防抖和节流并没有从本质上解决性能问题，我们还应该注意优化我们事件回调函数的逻辑功能，避免在回调中执行比较复杂的DOM操作，减少浏览器reflow和repaint。<br>上面的示例代码比较简单，只是说明了基本的思路。目前已经有工具库实现了这些功能，比如underscore，考虑的情况也会比较多，大家可以去查看源码，学习作者的思路，加深理解。<br>underscore的debounce方法源码：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">_.debounce = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, immediate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, result;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params">context, args</span>) </span>&#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (args) result = func.apply(context, args);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> debounced = restArguments(<span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (timeout) clearTimeout(timeout);</span><br><span class="line">        <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">            <span class="keyword">var</span> callNow = !timeout;</span><br><span class="line">            timeout = setTimeout(later, wait);</span><br><span class="line">            <span class="keyword">if</span> (callNow) result = func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeout = _.delay(later, wait, <span class="keyword">this</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line">    debounced.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><p>underscore的throttle源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">_.throttle = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, context, args, result;</span><br><span class="line">    <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!options) options = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        previous = options.leading === <span class="literal">false</span> ? <span class="number">0</span> : _.now();</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> throttled = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> now = _.now();</span><br><span class="line">        <span class="keyword">if</span> (!previous &amp;&amp; options.leading === <span class="literal">false</span>) previous = now;</span><br><span class="line">        <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">        context = <span class="keyword">this</span>;</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">            <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">                clearTimeout(timeout);</span><br><span class="line">                timeout = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            previous = now;</span><br><span class="line">            result = func.apply(context, args);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> (!timeout &amp;&amp; options.trailing !== <span class="literal">false</span>) &#123;</span><br><span class="line">            timeout = setTimeout(later, remaining);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">    throttled.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        previous = <span class="number">0</span>;</span><br><span class="line">        timeout = context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> throttled;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单的介绍一下防抖与节流&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>HTML5中Video标签无法播放mp4的解决办法</title>
    <link href="/2019/03/21/HTML5%E4%B8%ADVideo%E6%A0%87%E7%AD%BE%E6%97%A0%E6%B3%95%E6%92%AD%E6%94%BEmp4%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/</id>
    <published>2019-03-21T01:13:22.000Z</published>
    <updated>2019-03-27T07:32:06.085Z</updated>
    
    <content type="html"><![CDATA[<p>解决其它格式视频转mp4格式文件，video标签无法播放问题<br><a id="more"></a></p><h2 id="HTML5中Video标签无法播放mp4的解决办法"><a href="#HTML5中Video标签无法播放mp4的解决办法" class="headerlink" title="HTML5中Video标签无法播放mp4的解决办法"></a>HTML5中Video标签无法播放mp4的解决办法</h2><p>首先，浏览器使用环境chrome<br>在使用video标签播放视频的时候，我一般都选择mp4格式的文件，在网上下载的demo视频或者是手机拍摄的mp4文件都可以播放，但是，我用格式工厂把avi格式的文件转换成mp4文件就无法播放，为什么呢？<br>带着疑问，上网找答案，找到了原因，如下：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/1.png" alt="img"><br>使用格式工厂的mp4转换功能转出来的mp4文件并不能使用，于是把能播放的视频文件和不能播放的视频文件的编码格式对比了一下<br>可以播放的：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/2.png" alt="img"><br>不可以播放的：<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/3.png" alt="img"><br>所以，在格式工厂转换的时候需要转成AVC编码格式的mp4文件<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/4.png" alt="img"><br>好了，按照这种方式就可以正常播放了。<br>*补充更新：<br>上边的方式在pc端chrome浏览器上可以，但是在移动端上还是无法播放，最后没有办法，我采用了WebM格式。<br>格式工厂可以转换，见下图<br><img src="/2019/03/21/HTML5中Video标签无法播放mp4的解决办法/5.png" alt="img"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;解决其它格式视频转mp4格式文件，video标签无法播放问题&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>移动端兼容性</title>
    <link href="/2019/03/05/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    <id>/2019/03/05/移动端兼容性/</id>
    <published>2019-03-05T01:43:57.000Z</published>
    <updated>2019-03-07T06:05:28.759Z</updated>
    
    <content type="html"><![CDATA[<p>移动端有关html标签节点的兼容性问题<br><a id="more"></a></p><h2 id="移动端兼容性"><a href="#移动端兼容性" class="headerlink" title="移动端兼容性"></a>移动端兼容性</h2><h3 id="meta标签"><a href="#meta标签" class="headerlink" title="meta标签"></a>meta标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// viewport就啥也不说了，必须得加</span></span><br><span class="line">&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动或禁用自动识别页面中的电话号码</span></span><br><span class="line">&lt;meta name=<span class="string">"format-detection"</span> content=<span class="string">"telephone=no"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动或禁用自动识别邮箱地址</span></span><br><span class="line">&lt;meta name=<span class="string">"format-detection"</span>  content=<span class="string">"email=no"</span> /&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 Web 应用是否以全屏模式运行。</span></span><br><span class="line">&lt;meta name=<span class="string">"apple-mobile-web-app-capable"</span> content=<span class="string">"yes"</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 的 safari 顶端状态条的样式，可选的参数有：default、black、black-translucent</span></span><br><span class="line">&lt;meta name=<span class="string">"apple-mobile-web-app-status-bar-style"</span>  content=<span class="string">"black"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// winphone 系统 a、input 标签被点击时产生的半透明灰色背景怎么去掉</span></span><br><span class="line">&lt;meta name=<span class="string">"msapplication-tap-highlight"</span>  content=<span class="string">"no"</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="body-img等标签"><a href="#body-img等标签" class="headerlink" title="body,img等标签"></a>body,img等标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁止 ios 长按时不触发系统的菜单，禁止 ios&amp;android 长按时下载图片</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-touch-callout: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止ios和android用户选中文字</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-user-select:none</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="图片不清晰"><a href="#图片不清晰" class="headerlink" title="图片不清晰"></a>图片不清晰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如，iphone6，设备款375，物理像素750，正常一张占1/3屏幕的图片，125px，如果准备一张125的</span></span><br><span class="line"><span class="comment">// 肯定会模糊，必须准备250px的。如果像iphone6 plus，像素比3， 占1/3的图片138px，实际需要414px。</span></span><br><span class="line"><span class="comment">// 解决方案：</span></span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    .css &#123;</span><br><span class="line">      background-image: url(<span class="string">'2x.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    .css &#123;</span><br><span class="line">      background-image: url(<span class="string">'3x.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="表单的标签"><a href="#表单的标签" class="headerlink" title="表单的标签"></a>表单的标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input 输入框不可编辑</span></span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"xxx"</span> disabled=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> value=<span class="string">"xxx"</span> readonly=<span class="string">"true"</span>/&gt;</span><br><span class="line"><span class="comment">/* disabled 文本框变灰，通过request.getParameter("name")得不到文本框中的内容</span></span><br><span class="line"><span class="comment">readonly 只是使文本框不能输入，样式没有变化，通过request.getParameter("name")可以得到内容 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 输入的时候英文首字母的默认大写</span></span><br><span class="line">&lt;input autocapitalize=<span class="string">"off"</span> autocorrect=<span class="string">"off"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// android 上去掉语音输入按钮</span></span><br><span class="line">input::-webkit-input-speech-button &#123;</span><br><span class="line">  display: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios系统中元素被触摸时产生的半透明灰色遮罩怎么去掉</span></span><br><span class="line">a,button,input,textarea&#123;</span><br><span class="line">  -webkit-tap-highlight-color: rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>;)</span><br><span class="line">  -webkit-user-modify:read-write-plaintext-only;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">/* -webkit-user-modify 这个属性使用需谨慎，副作用就是输入法不再能够输入多个字符</span></span><br><span class="line"><span class="comment">另外，有些机型去除不了，如小米2</span></span><br><span class="line"><span class="comment">对于按钮类，不使用a或者input标签，直接用div标签 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单元素的默认外观重置</span></span><br><span class="line">  -webkit-appearance:none;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改表单输入框 placeholder 的颜色值</span></span><br><span class="line">  input::-webkit-input-placeholder&#123;color:#ccc;&#125; </span><br><span class="line">  input:focus::-webkit-input-placeholder&#123;color:#eee;&#125; </span><br><span class="line"><span class="comment">// 注意 placeholder,  ios 可以换行，android 不可以</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Input 的placeholder会出现文本位置偏上的情况</span></span><br><span class="line">input 的placeholder会出现文本位置偏上的情况：PC端设置line-height等于height能够对齐，而移动端仍然是偏上，解决是设置line-height：normal</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用 select 默认下拉箭头</span></span><br><span class="line">select::-ms-expand &#123;<span class="attr">display</span>: none;&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用 radio 和 checkbox 默认样式</span></span><br><span class="line">input[type=radio]::-ms-check,</span><br><span class="line">input[type=checkbox]::-ms-check &#123; </span><br><span class="line">  display: none; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="a标签"><a href="#a标签" class="headerlink" title="a标签"></a>a标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">部分安卓手机 a 标签用作按钮的时候，页面显示空白</span><br><span class="line">解决办法：用 button 标签替换 a 标签</span><br></pre></td></tr></table></figure><h3 id="button"><a href="#button" class="headerlink" title="button"></a>button</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去除button在ios上的默认样式</span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-appearance: none;</span><br><span class="line">  border-radius: <span class="number">0</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不想让按钮touch时有蓝色的边框     </span></span><br><span class="line">.css &#123;</span><br><span class="line">  -webkit-tap-highlight-color:rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="audio和video"><a href="#audio和video" class="headerlink" title="audio和video"></a>audio和video</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在ios和andriod中,audio元素和video元素在无法自动播放</span></span><br><span class="line"><span class="comment">// 应对方案：触屏即播</span></span><br><span class="line">$(<span class="string">'html'</span>).one(<span class="string">'touchstart'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    audio.play()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ios 视频默认全屏播放，如何阻止全屏播放－ webkit-playsinline</span></span><br><span class="line">&lt;video id=<span class="string">"video"</span> src=<span class="string">""</span> webkit-playsinline poster=<span class="string">""</span> &gt;<span class="xml"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 视频，音频获取播放结束后的回调函数－ended</span></span><br><span class="line">$(<span class="string">'#video'</span>).on(<span class="string">'ended'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  alert(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="click点击事件"><a href="#click点击事件" class="headerlink" title="click点击事件"></a>click点击事件</h3><h4 id="300毫秒延迟"><a href="#300毫秒延迟" class="headerlink" title="300毫秒延迟"></a>300毫秒延迟</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 300毫秒延迟解决方案</span></span><br><span class="line"><span class="number">1.</span>fastclick可以解决在手机上点击事件的<span class="number">300</span>ms延迟</span><br><span class="line"><span class="number">2.</span>zepto的touch模块，tap事件也是为了解决在click的延迟问题</span><br><span class="line"><span class="number">3.</span>触摸事件的响应顺序为 touchstart --&gt; touchmove --&gt; touchend --&gt; click,也可以通过绑定ontouchstart事件，加快对事件的响应，解决<span class="number">300</span>ms延迟问题</span><br></pre></td></tr></table></figure><h4 id="ios-label-span-监听click事件-不触发"><a href="#ios-label-span-监听click事件-不触发" class="headerlink" title="ios(label,span)监听click事件,不触发"></a>ios(label,span)监听click事件,不触发</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所监听元素加上</span></span><br><span class="line">.css &#123;</span><br><span class="line">  cursor:pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h2><h3 id="webkit-keyframes-注意"><a href="#webkit-keyframes-注意" class="headerlink" title="@-webkit-keyframes 注意"></a>@-webkit-keyframes 注意</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以<span class="number">0</span>%开始<span class="number">100</span>%结束，<span class="number">0</span>%的百分号不能去掉</span><br><span class="line">after和before伪类无法使用动画</span><br></pre></td></tr></table></figure><h3 id="border-radius-注意"><a href="#border-radius-注意" class="headerlink" title="border-radius 注意"></a>border-radius 注意</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不支持%单位</span><br><span class="line">三星 Galaxy S4中自带浏览器不支持 border-radius 缩写</span><br><span class="line">同时写入 border-radius 和背景色的时候，背景色会溢出到圆角以外部分</span><br></pre></td></tr></table></figure><h3 id="解决-transition-闪屏"><a href="#解决-transition-闪屏" class="headerlink" title="解决 transition 闪屏"></a>解决 transition 闪屏</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.css&#123; </span><br><span class="line">  <span class="comment">/*设置内嵌的元素在 3D 空间如何呈现：保留 3D*/</span> </span><br><span class="line">  -webkit-transform-style: preserve<span class="number">-3</span>d; </span><br><span class="line">  <span class="comment">/*（设置进行转换的元素的背面在面对用户时是否可见：隐藏）*/</span> </span><br><span class="line">  -webkit-backface-visibility: hidden; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="阻止用户调整微信浏览器字体大小"><a href="#阻止用户调整微信浏览器字体大小" class="headerlink" title="阻止用户调整微信浏览器字体大小"></a>阻止用户调整微信浏览器字体大小</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ios 管事，android 暂无解决方案</span></span><br><span class="line">body&#123;</span><br><span class="line">  -webkit-text-size-adjust: <span class="number">100</span>%!important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="屏幕旋转的事件和样式"><a href="#屏幕旋转的事件和样式" class="headerlink" title="屏幕旋转的事件和样式"></a>屏幕旋转的事件和样式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 事件</span></span><br><span class="line"><span class="built_in">window</span>.orientation，取值：正负<span class="number">90</span>表示横屏模式、<span class="number">0</span>和<span class="number">180</span>表现为竖屏模式；</span><br><span class="line"><span class="comment">// 代码判断</span></span><br><span class="line"><span class="built_in">window</span>.onorientationchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">  <span class="keyword">switch</span>(<span class="built_in">window</span>.orientation)&#123; </span><br><span class="line">    <span class="keyword">case</span> <span class="number">-90</span>: </span><br><span class="line">    <span class="keyword">case</span> <span class="number">90</span>: </span><br><span class="line">        alert(<span class="string">"横屏:"</span> + <span class="built_in">window</span>.orientation); </span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: </span><br><span class="line">    <span class="keyword">case</span> <span class="number">180</span>: </span><br><span class="line">        alert(<span class="string">"竖屏:"</span> + <span class="built_in">window</span>.orientation); </span><br><span class="line">    <span class="keyword">break</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 样式</span></span><br><span class="line"><span class="comment">/*竖屏时使用的样式*/</span> </span><br><span class="line">@media all and (orientation:portrait) &#123;</span><br><span class="line">  .css&#123;&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横屏时使用的样式*/</span> </span><br><span class="line">@media all and (orientation:landscape) &#123;</span><br><span class="line">  .css&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fixed元素无法点击"><a href="#fixed元素无法点击" class="headerlink" title="fixed元素无法点击"></a>fixed元素无法点击</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">场景：父元素设置position: fixed;</span><br><span class="line">子元素设置position: absolute;</span><br><span class="line">此时，如果父元素/子元素还设置了overflow: hidden 则出现“父元素遮挡该子元素“的bug。</span><br><span class="line">视觉(view)层并没有出现遮挡，只是无法触发绑定在该子元素上的事件。可理解为：「看到点不到」。</span><br><span class="line">补充： 页面往下滚动，触发position: fixed;的特性时，才会出现这个bug，在最顶不会出现。</span><br><span class="line">测试平台： 小米<span class="number">1</span>S，Android4<span class="number">.0</span>的Chrome18</span><br><span class="line">解决办法： 把父元素和子元素的overflow: hidden去掉。</span><br></pre></td></tr></table></figure><h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">body如果设置height:<span class="number">100</span>%;overflow:hidden是依然可以滑动的，如果需禁止，</span><br><span class="line">要再加一层div设置 height:<span class="number">100</span>%加overflow：hidden（html,body加height:<span class="number">100</span>%） ，</span><br><span class="line">这样元素超出body的高度也不能滑动了。</span><br><span class="line">或者同时给html，body加height:<span class="number">100</span>%;overflow:hidden</span><br></pre></td></tr></table></figure><h3 id="ios阻止旋转屏幕时自动调整字体大小"><a href="#ios阻止旋转屏幕时自动调整字体大小" class="headerlink" title="ios阻止旋转屏幕时自动调整字体大小"></a>ios阻止旋转屏幕时自动调整字体大小</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html, body, form, fieldset, p, div, h1, h2, h3, h4, h5, h6 &#123;</span><br><span class="line">  -webkit-text-size-adjust:none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过transform进行skew变形，rotate旋转会造成出现锯齿现象"><a href="#通过transform进行skew变形，rotate旋转会造成出现锯齿现象" class="headerlink" title="通过transform进行skew变形，rotate旋转会造成出现锯齿现象"></a>通过transform进行skew变形，rotate旋转会造成出现锯齿现象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-webkit-transform: rotate(<span class="number">-4</span>deg) skew(<span class="number">10</span>deg) translateZ(<span class="number">0</span>);</span><br><span class="line">transform: rotate(<span class="number">-4</span>deg) skew(<span class="number">10</span>deg) translateZ(<span class="number">0</span>);</span><br><span class="line">outline: <span class="number">1</span>px solid rgba(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="iOS6下伪类-hover"><a href="#iOS6下伪类-hover" class="headerlink" title="iOS6下伪类:hover"></a>iOS6下伪类:hover</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">除了&lt;a&gt;之外的元素无效；在Android下则有效。类似</span><br><span class="line">div#topFloatBar_l:hover #topFloatBar_menu &#123;</span><br><span class="line">  display:block; </span><br><span class="line">&#125;</span><br><span class="line">这样的导航显示在iOS6点击没有点击效果，只能通过增加点击侦听器给元素增减<span class="class"><span class="keyword">class</span>来控制子元素。</span></span><br></pre></td></tr></table></figure><h3 id="点击按钮时背景变黑色的解决"><a href="#点击按钮时背景变黑色的解决" class="headerlink" title="点击按钮时背景变黑色的解决"></a>点击按钮时背景变黑色的解决</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击按钮时背景变黑色的解决</span></span><br><span class="line">-webkit-tap-highlight-color: transparent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们去掉默认的大黑块儿后，要添加自己想要的点击时按住按钮的效果，用以下代码：</span></span><br><span class="line">span:active&#123;</span><br><span class="line">  box-shadow: inset 0 5px 10px #B41313,inset 0 -5px 10px #B41313;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加完上述代码后，在安卓上，都可以看到想要的效果，但是iphone上依旧不行，</span></span><br><span class="line"><span class="comment">// :active  需要一个触发事件才可以，于是乎，用以下代码：</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><h3 id="retina屏下border的1px会变粗"><a href="#retina屏下border的1px会变粗" class="headerlink" title="retina屏下border的1px会变粗"></a>retina屏下border的1px会变粗</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为像素比，比如，iphone6的像素比是2，window.devicePixelRatio可以查看，</span></span><br><span class="line"><span class="comment">// iphone6的设备宽是375,而物理像素是750，在css中的1px，实际控制的是2px的像素，</span></span><br><span class="line"><span class="comment">// 所以看起来会变粗了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决一：IOS8下已经支持带小数的px值, media query对应devicePixelRatio有个查询值-webkit-min-device-pixel-ratio, css可以写成这样</span></span><br><span class="line">.border &#123; border: 1px solid #999 &#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    .border &#123; border: 0.5px solid #999 &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    .border &#123; border: 0.333333px solid #999 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决二：background渐变</span></span><br><span class="line"><span class="comment">// 背景渐变, 渐变在透明色和边框色中间分割, frozenUI用的就是这种方法, 借用它的上边框写法:</span></span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)&#123;</span><br><span class="line">    .ui-border-t &#123;</span><br><span class="line">        background-position: left top;</span><br><span class="line">        background-image: -webkit-gradient(linear,left bottom,left top,color-stop(0.5,transparent),color-stop(0.5,#e0e0e0),to(#e0e0e0));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决三：</span></span><br><span class="line"><span class="comment">// :before, :after与transform</span></span><br><span class="line">.radius-border&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)&#123;</span><br><span class="line">    .radius-border:before&#123;</span><br><span class="line">        content: <span class="string">""</span>;</span><br><span class="line">        pointer-events: none; <span class="comment">/* 防止点击触发 */</span></span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: <span class="number">200</span>%;</span><br><span class="line">        height: <span class="number">200</span>%;</span><br><span class="line">        left: <span class="number">0</span>;</span><br><span class="line">        top: <span class="number">0</span>;</span><br><span class="line">        border-radius: <span class="number">8</span>px;</span><br><span class="line">        border:1px solid #999;</span><br><span class="line">        -webkit-transform(scale(<span class="number">0.5</span>));</span><br><span class="line">        -webkit-transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">        transform(scale(<span class="number">0.5</span>));</span><br><span class="line">        transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;移动端有关html标签节点的兼容性问题&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="移动端" scheme="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/"/>
    
      <category term="兼容性" scheme="/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>vue自定义指令之输入框限制字数</title>
    <link href="/2019/03/01/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E4%B9%8B%E8%BE%93%E5%85%A5%E6%A1%86%E9%99%90%E5%88%B6%E5%AD%97%E6%95%B0/"/>
    <id>/2019/03/01/vue自定义指令之输入框限制字数/</id>
    <published>2019-03-01T06:36:24.000Z</published>
    <updated>2019-03-04T08:15:45.039Z</updated>
    
    <content type="html"><![CDATA[<p>input输入框限制字数的指令制作<br><a id="more"></a></p><h2 id="vue自定义指令之输入框限制字数"><a href="#vue自定义指令之输入框限制字数" class="headerlink" title="vue自定义指令之输入框限制字数"></a>vue自定义指令之输入框限制字数</h2><p>vue自定义指令没啥说的，说明见<a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">官网</a>,具体代码见下面:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'inputvalidatecounter'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nSpan = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>),</span><br><span class="line">        nInput = el.querySelector(<span class="string">'input'</span>),</span><br><span class="line">        count = +binding.expression || <span class="number">50</span>;</span><br><span class="line">    el.appendChild(nSpan);</span><br><span class="line">    nSpan.innerHTML = <span class="string">'还可以填写'</span>+count+<span class="string">'字'</span>;</span><br><span class="line">    nInput.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> num = count - <span class="keyword">this</span>.value.length;</span><br><span class="line">      <span class="keyword">if</span>(num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> substr = <span class="keyword">this</span>.value.substring(<span class="number">0</span>,count<span class="number">-1</span>);</span><br><span class="line">          <span class="keyword">this</span>.value = substr;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      nSpan.innerHTML = <span class="string">'还可以填写'</span>+(num&lt;<span class="number">0</span>?<span class="number">0</span>:num)+<span class="string">'字'</span>;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>需要注意的地方：</p><ul><li>这个指令只适用于iview的Input组件，看里边操作dom元素就可以看出来，想改成其它的也是简单。</li><li><h1 id="在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。"><a href="#在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。" class="headerlink" title="在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。"></a>在更改input的value的时候，最开始改不过来，后来我做了下延迟才解决这个问题，我想应该是在直接给input的value赋值后由于vue还在做监控，所以又给改回去了，所以来个延迟，在它监控触发结束后再改正。</h1>2019年3月4日更改<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'inputvalidatecounter'</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding, vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nSpan = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>),</span><br><span class="line">        nInput = el.querySelector(<span class="string">'input'</span>) || el.querySelector(<span class="string">'textarea'</span>),</span><br><span class="line">        count = +binding.expression || <span class="number">50</span>;</span><br><span class="line">    el.appendChild(nSpan);</span><br><span class="line">    nSpan.innerHTML = <span class="string">'还可以填写'</span>+count+<span class="string">'字'</span>;</span><br><span class="line">    nInput.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> num = count - <span class="keyword">this</span>.value.length;</span><br><span class="line">      <span class="keyword">if</span>(num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> substr = <span class="keyword">this</span>.value.substring(<span class="number">0</span>,count);</span><br><span class="line">          <span class="keyword">this</span>.value = substr;</span><br><span class="line">          <span class="comment">// 新添加开始</span></span><br><span class="line">          <span class="keyword">var</span> keyArr = vnode.data.model.expression.split(<span class="string">'.'</span>);</span><br><span class="line">          <span class="keyword">var</span> evalStr = <span class="string">'vnode.context._data'</span>;</span><br><span class="line">          keyArr.forEach(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span><br><span class="line">            evalStr += <span class="string">'["'</span>+item+<span class="string">'"]'</span>;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="built_in">eval</span>(evalStr+<span class="string">'="'</span>+<span class="keyword">this</span>.value+<span class="string">'"'</span>)</span><br><span class="line">          <span class="comment">// 新添加结束</span></span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      nSpan.innerHTML = <span class="string">'还可以填写'</span>+(num&lt;<span class="number">0</span>?<span class="number">0</span>:num)+<span class="string">'字'</span>;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><p>新添加的内容只有几行，其实是为了修改第一版的bug，当在input里输入内容的时候，超过一定字数后，进入延迟函数，这里把input的value值更改了，但是并没有更改这个指令所在组件里v-model的值，所以，这里需要修正。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vnode是这个指令所在的组建的虚拟dom</span></span><br><span class="line"><span class="comment">// vnode.data.model.expression 这就可以直接找到v-model里的变量名</span></span><br><span class="line"><span class="keyword">var</span> keyArr = vnode.data.model.expression.split(<span class="string">'.'</span>);</span><br><span class="line"><span class="comment">// vnode知道了，vnode.context很显然就是组件所在的父级组件，可以通过 _data 这个数据去改变v-model里变量的值。</span></span><br><span class="line"><span class="keyword">var</span> evalStr = <span class="string">'vnode.context._data'</span>;</span><br><span class="line">keyArr.forEach(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span><br><span class="line">  evalStr += <span class="string">'["'</span>+item+<span class="string">'"]'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 经过上边的循环是因为这种情况, v-model="formitem.name"，像这种的值，而不是v-model="name"这种。</span></span><br><span class="line"><span class="comment">// 最后需要eval来执行这些字符串组成的代码。</span></span><br><span class="line"><span class="built_in">eval</span>(evalStr+<span class="string">'="'</span>+<span class="keyword">this</span>.value+<span class="string">'"'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;input输入框限制字数的指令制作&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="vue" scheme="/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>js图片下载之后端部分</title>
    <link href="/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86/"/>
    <id>/2019/02/27/js图片下载之后端部分/</id>
    <published>2019-02-27T05:31:24.000Z</published>
    <updated>2019-02-27T06:05:37.582Z</updated>
    
    <content type="html"><![CDATA[<p>nodejs服务返回图片二进制数据<br><a id="more"></a></p><h2 id="js图片下载之后端部分"><a href="#js图片下载之后端部分" class="headerlink" title="js图片下载之后端部分"></a>js图片下载之后端部分</h2><p>本站<a href="/2019/02/27/js图片下载之前端部分/">《js图片下载之前端部分》</a>,写了如何利用js来下载图片，第二种方式需要后端返回图片的二进制数据，这篇文章我来写一下如何使用nodejs向前端返图片的二进制数据，我总结了三种方法。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  fs.createReadStream(<span class="string">'./img/1.jpg'</span>)</span><br><span class="line">  .pipe(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这种方法利用了stream和pipe，一行代码就解决了，利用fs去读取图片的流只有，用pipe方法把流转给res，res自动就把数据返回给前端。</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> readerStream = fs.createReadStream(process.cwd() + <span class="string">'/img/1.jpg'</span>);</span><br><span class="line">  <span class="comment">// 设置编码为 binary 必须</span></span><br><span class="line">  readerStream.setEncoding(<span class="string">'binary'</span>);</span><br><span class="line">  readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">     data += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 必须加上binary，返回的是二进制</span></span><br><span class="line">    res.end(data, <span class="string">'binary'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这个方法其实跟第一个差不多，都是使用了fs的流来读取图片，但是没有使用pipe直接把数据流转给res，需要自己监听数据来处理，这里我试验了好多方式，终于成功了，注意readerStream.setEncoding(‘binary’)和res.end(data, ‘binary’)，都需要加上binary格式。</p><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">    fs.readFile(<span class="string">'./img/1.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">     &#125;</span><br><span class="line">     res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这种方法时最简单的，但是遇到大文件会影响计算机的性能。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>最后整体代码贴一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>,<span class="string">' 3.2.1'</span>)</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream+pipe方式一</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  fs.createReadStream(<span class="string">'./img/1.jpg'</span>)</span><br><span class="line">  .pipe(res);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// stream方式二</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> readerStream = fs.createReadStream(process.cwd() + <span class="string">'/img/1.jpg'</span>);</span><br><span class="line">  <span class="comment">// 设置编码为 binary 必须</span></span><br><span class="line">  readerStream.setEncoding(<span class="string">'binary'</span>);</span><br><span class="line">  readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">     data += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 必须加上binary，返回的是二进制</span></span><br><span class="line">    res.end(data, <span class="string">'binary'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接读取整个文件方式三</span></span><br><span class="line">app.post(<span class="string">'/downimg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">    fs.readFile(<span class="string">'./img/1.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">     &#125;</span><br><span class="line">     res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nodejs服务返回图片二进制数据&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="nodejs" scheme="/categories/nodejs/"/>
    
    
      <category term="图片处理" scheme="/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>js图片下载之前端部分</title>
    <link href="/2019/02/27/js%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/"/>
    <id>/2019/02/27/js图片下载之前端部分/</id>
    <published>2019-02-27T02:31:41.000Z</published>
    <updated>2019-02-27T06:03:47.927Z</updated>
    
    <content type="html"><![CDATA[<p>js控制图片下载<br><a id="more"></a></p><h2 id="js图片下载之前端部分"><a href="#js图片下载之前端部分" class="headerlink" title="js图片下载之前端部分"></a>js图片下载之前端部分</h2><p>这两天有一个小需求，就是点击页面中的下载按钮，下载指定的图片。经过一番的小研究，发现想实现这个功能，基本上都用到a标签的download属性，也就a标签的href指向图片地址，加上download属性后，点a标签就可以下载图片了。但是，有个问题，这需要在同域名下才好用，跨域貌似都不行，所以，在跨域的情况下就得另想办法。我总结了两种方法，一一道来。</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>利用canvas，就是有一个图片地址，利用canvas把图片画出来，之后再通过canvas的toDataURL方法，将图片转为base64的数据，再把这个数据赋值给a标签的href属性，就可以了。这里注意一点，canvas调取toDataURL方法时，如果是跨域图片需要后台允许跨域，还需要在img标签的”crossOrigin”属性设置为’Anonymous’才管用，最后贴出具体代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadImg</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 通过构造函数来创建的 img 实例，在赋予 src 值后就会立刻下载图片，相比 createElement() 创建 &lt;img&gt; 省去了 append()，也就避免了文档冗余和污染</span></span><br><span class="line">        <span class="keyword">var</span> Img = <span class="keyword">new</span> Image(),</span><br><span class="line">            dataURL=<span class="string">''</span>;</span><br><span class="line">        Img.setAttribute(<span class="string">"crossOrigin"</span>,<span class="string">'Anonymous'</span>); <span class="comment">// 这里允许了跨域图片</span></span><br><span class="line">        Img.src=url;</span><br><span class="line">        Img.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 要先确保图片完整获取到，这是个异步事件</span></span><br><span class="line">            <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>), <span class="comment">// 创建canvas元素</span></span><br><span class="line">                width=Img.width, <span class="comment">// 确保canvas的尺寸和图片一样</span></span><br><span class="line">                height=Img.height;</span><br><span class="line">            canvas.width=width;</span><br><span class="line">            canvas.height=height;</span><br><span class="line">            canvas.getContext(<span class="string">"2d"</span>).drawImage(Img,<span class="number">0</span>,<span class="number">0</span>,width,height); <span class="comment">// 将图片绘制到canvas中</span></span><br><span class="line">            dataURL=canvas.toDataURL(<span class="string">'image/jpeg'</span>); <span class="comment">// 转换图片为dataURL</span></span><br><span class="line">            <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>),</span><br><span class="line">        body = <span class="built_in">document</span>.body;</span><br><span class="line">            a.download = <span class="string">'img.jpg'</span>;</span><br><span class="line">            a.href = dataURL;</span><br><span class="line">            body.append(a); </span><br><span class="line">            a.click();</span><br><span class="line">            body.removeChild(a);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>第二种方法就需要后端配合了，前端使用ajax请求到图片的二进制数据，之后利用了FileReader这个API，具体看代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">downloadImg</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, url, <span class="literal">true</span>);    <span class="comment">// 请求方式</span></span><br><span class="line">  xhr.responseType = <span class="string">"blob"</span>;  <span class="comment">// 返回类型blob</span></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 请求完成</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="comment">// 返回200</span></span><br><span class="line">      <span class="keyword">var</span> blob = <span class="keyword">this</span>.response;</span><br><span class="line">      <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">      reader.readAsDataURL(blob);  <span class="comment">// 转换为base64，可以直接放入a标签的href</span></span><br><span class="line">      reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 转换完成，创建一个a标签用于下载</span></span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>),</span><br><span class="line">        body = <span class="built_in">document</span>.body;</span><br><span class="line">        a.download = <span class="string">'img.jpg'</span>;</span><br><span class="line">        a.href = e.target.result;</span><br><span class="line">        body.append(a); </span><br><span class="line">        a.click();</span><br><span class="line">        body.removeChild(a);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 发送ajax请求</span></span><br><span class="line">  xhr.send()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这个方法需要后端发送图片的二进制数据，我也写了nodejs的发送方法，见<a href="/2019/02/27/js图片下载之后端部分/">《js图片下载之后端部分》</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;js控制图片下载&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
      <category term="图片处理" scheme="/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>浏览器消息提示Notification</title>
    <link href="/2019/02/14/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BANotification/"/>
    <id>/2019/02/14/浏览器消息提示Notification/</id>
    <published>2019-02-14T06:41:44.000Z</published>
    <updated>2019-02-14T06:54:50.672Z</updated>
    
    <content type="html"><![CDATA[<p>浏览器自带的消息提示框<br><a id="more"></a></p><h2 id="浏览器消息提示Notification"><a href="#浏览器消息提示Notification" class="headerlink" title="浏览器消息提示Notification"></a>浏览器消息提示Notification</h2><p>这两天有一个新需求，微信网页版有这个功能，就是当浏览器最小化后，微信来消息，这时在电脑桌面的右下角会有消息提示框。<br>这个功能用到了浏览器新特性的Notification接口，虽说兼容性不好，但是在现代浏览器上使用还是可以的。<br>直接贴出demo:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">  &lt;title&gt;Notification&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;button id=<span class="string">"message"</span>&gt;弹消息&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button id="message-delay"&gt;弹消息延迟&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  var btn = document.getElementById('message');</span></span><br><span class="line"><span class="regexp">  var btnDelay = document.getElementById('message-delay');</span></span><br><span class="line"><span class="regexp">  btn.addEventListener('click', ()=&gt; &#123;</span></span><br><span class="line"><span class="regexp">    notifyMe(&#123;</span></span><br><span class="line"><span class="regexp">      title: '消息通知',</span></span><br><span class="line"><span class="regexp">      body: '菜品订单',</span></span><br><span class="line"><span class="regexp">      icon: './</span>asset/image/icon.png<span class="string">'</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  btnDelay.addEventListener('</span>click<span class="string">', ()=&gt; &#123;</span></span><br><span class="line"><span class="string">      setTimeout(()=&gt; &#123;</span></span><br><span class="line"><span class="string">        notifyMe(&#123;</span></span><br><span class="line"><span class="string">          title: '</span>消息通知<span class="string">',</span></span><br><span class="line"><span class="string">          body: '</span>菜品订单<span class="string">',</span></span><br><span class="line"><span class="string">          icon: '</span>./asset/image/icon.png<span class="string">'</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">      &#125;, 5000);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  function notifyMe(options) &#123;</span></span><br><span class="line"><span class="string">    // if(!document.hidden) return; // 判断浏览器是否最小化</span></span><br><span class="line"><span class="string">    // 先检查浏览器是否支持</span></span><br><span class="line"><span class="string">    if (!("Notification" in window)) &#123;</span></span><br><span class="line"><span class="string">      alert("This browser does not support desktop notification");</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 检查用户是否同意接受通知</span></span><br><span class="line"><span class="string">    else if (Notification.permission === "granted") &#123;</span></span><br><span class="line"><span class="string">      // If it'</span>s okay <span class="keyword">let</span><span class="string">'s create a notification</span></span><br><span class="line"><span class="string">      var notification = new Notification(options.title, &#123;</span></span><br><span class="line"><span class="string">        body: options.body,</span></span><br><span class="line"><span class="string">        icon: options.icon,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 否则我们需要向用户获取权限</span></span><br><span class="line"><span class="string">    else if (Notification.permission !== '</span>denied<span class="string">') &#123;</span></span><br><span class="line"><span class="string">      Notification.requestPermission(function (permission) &#123;</span></span><br><span class="line"><span class="string">        // 如果用户同意，就可以向他们发送通知</span></span><br><span class="line"><span class="string">        if (permission === "granted") &#123;</span></span><br><span class="line"><span class="string">          var notification = new Notification(options.title, &#123;</span></span><br><span class="line"><span class="string">            body: options.body,</span></span><br><span class="line"><span class="string">            icon: options.icon,</span></span><br><span class="line"><span class="string">          &#125;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 过3秒关闭提示框</span></span><br><span class="line"><span class="string">    setTimeout(function() &#123;</span></span><br><span class="line"><span class="string">      notification.close();</span></span><br><span class="line"><span class="string">    &#125;, 3000);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;浏览器自带的消息提示框&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>git常用命令</title>
    <link href="/2019/01/31/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>/2019/01/31/git常用命令/</id>
    <published>2019-01-31T08:57:14.000Z</published>
    <updated>2019-02-01T05:08:51.840Z</updated>
    
    <content type="html"><![CDATA[<p>工作中常用的git命令小总结<br><a id="more"></a></p><h2 id="git常用命令"><a href="#git常用命令" class="headerlink" title="git常用命令"></a>git常用命令</h2><p>git在我们工作中使用的很多，还有想github这样牛逼的代码托管网站，所以，git这个版本管理工具越来越多的被使用，其实git使用起来还是很复杂的，但是，我平时只是提交代码，所以就用到了几个命令而已，在这里做一下记录。</p><h3 id="先来个简单点的"><a href="#先来个简单点的" class="headerlink" title="先来个简单点的"></a>先来个简单点的</h3><ul><li><p>首先就是把现有的项目clone到本地。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jixoba/jQuery-Seat-Charts.git</span><br></pre></td></tr></table></figure></li><li><p>之后就是我常用的几个提交命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git status  // 查看更改的文件有哪些</span><br><span class="line">git add .   // add后边.的话，就是把所有改动的文件添加进去</span><br><span class="line">git commit -m &quot;提交log信息&quot; // 提交信息</span><br><span class="line">git push    // 最后把更改内容推到远程仓库中</span><br></pre></td></tr></table></figure></li></ul><p>以上就是我经常用到的简单命令，如果有分支的话可能会复杂点，根据提示就可以了</p><h3 id="说点复杂的"><a href="#说点复杂的" class="headerlink" title="说点复杂的"></a>说点复杂的</h3><ul><li><p>新建分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch branchname // branchname就是分支名</span><br></pre></td></tr></table></figure></li><li><p>查看分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -a  //查看所有分支</span><br><span class="line">git branch -r  //查看远程分支</span><br></pre></td></tr></table></figure></li><li><p>本地切换分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout branchname</span><br></pre></td></tr></table></figure></li><li><p>克隆带有分支的项目方法一</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b template https://github.com/iview/iview-admin.git  // clone template分支</span><br></pre></td></tr></table></figure></li><li><p>克隆带有分支的项目方法二</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/iview/iview-admin.git // clone整个项目</span><br><span class="line"></span><br><span class="line">git branch -a  //列出所有分支名称如下： * 号表示当前分支</span><br><span class="line">  * dev  </span><br><span class="line">  remotes/origin/HEAD -&gt; origin/dev</span><br><span class="line">  remotes/origin/desktop</span><br><span class="line">  remotes/origin/template</span><br></pre></td></tr></table></figure></li><li><p>接下来，可以在本地新建分支并与远程仓库的分支进行关联了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b template origin/template   // 作用是checkout远程仓库origin的分支template，在本地起名为template分支，并切换到本地的template分支</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;工作中常用的git命令小总结&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>jquery座位插件</title>
    <link href="/2019/01/29/jquery%E5%BA%A7%E4%BD%8D%E6%8F%92%E4%BB%B6/"/>
    <id>/2019/01/29/jquery座位插件/</id>
    <published>2019-01-29T07:44:05.000Z</published>
    <updated>2019-01-29T08:38:49.604Z</updated>
    
    <content type="html"><![CDATA[<p>一个画座位图的jquery插件<br><a id="more"></a></p><h2 id="jquery座位插件"><a href="#jquery座位插件" class="headerlink" title="jquery座位插件"></a>jquery座位插件</h2><p>最近这两天在画飞机的座位布局图和选座系统，本来想自己直接用原生画出来的，但是领导说其他部门做过相关功能，别的部门用的是jQuery-Seat-Charts这个插件，所以我也得使用。<br><a href="https://github.com/jixoba/jQuery-Seat-Charts" target="_blank" rel="noopener">这里是插件地址，我fork了下来</a><br>其实，这个插件的使用很简单，按照giyhub的文档就可以使用，因为需要定制开发，所以我大致的看了一下源码，觉得很好，主要是它在每个座位上加的事件，如果是我写的话，可能使用click事件，但是它用的focus事件和blur事件，正常情况下只有form表单的一些元素才有focus事件，但是想在div上也使用focus事件的话，需要给这个div加上tabIndex属性，一般情况下设为-1，就可以直接使用div的el.focus()方法了，我觉得这个好处就是，当点击其它座位时，之前focus的座位会触发blur事件，可以在这里做一些操作，简化了代码。<br>以后再画座位的时候还可以使用这个插件，比如电影院选做系统，动车，飞机等，还是很方便的的。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个画座位图的jquery插件&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="jquery" scheme="/tags/jquery/"/>
    
  </entry>
  
  <entry>
    <title>手写一个trigger插件</title>
    <link href="/2019/01/22/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AAtrigger%E6%8F%92%E4%BB%B6/"/>
    <id>/2019/01/22/手写一个trigger插件/</id>
    <published>2019-01-22T07:22:58.000Z</published>
    <updated>2019-01-22T08:41:41.185Z</updated>
    
    <content type="html"><![CDATA[<p>自己写一个简单的trigger来触发事件<br><a id="more"></a></p><h2 id="手写一个trigger插件"><a href="#手写一个trigger插件" class="headerlink" title="手写一个trigger插件"></a>手写一个trigger插件</h2><p>各位小伙伴们，jquery大家超级熟悉吧，jquery的trigger函数一定知道吧，反正我是非常喜欢用它，有时候比如要把一个弹出层隐藏掉，大家可能会去改这个弹出层的css，但是我可能会直接trigger一下这个弹出层取消按钮，因为我懒嘛，哈哈。<br>但是，有时候可能想用trigger的时候，发现并没有使用jquery，额，自己写一个吧，其实，这段代码的核心部分我是参考了百度的一个手势库，好像叫touch.js,当时看的时候貌似这个库已经5年没人维护了，不过，模拟触发事件的代码被我留下了。见下面：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">'object'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = factory;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)</span><br><span class="line">define([], factory);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span>)</span><br><span class="line">exports[<span class="string">"jinuxTrigger"</span>] = factory;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">root[<span class="string">"jinuxTrigger"</span>] = factory;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, evt, detail</span>) </span>&#123;</span><br><span class="line">detail = detail || &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> e, opt = &#123;</span><br><span class="line">            bubbles: <span class="literal">true</span>,</span><br><span class="line">            cancelable: <span class="literal">true</span>,</span><br><span class="line">            detail: detail</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> CustomEvent !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">            e = <span class="keyword">new</span> CustomEvent(evt, opt);</span><br><span class="line">            <span class="keyword">if</span> (el) &#123;</span><br><span class="line">                el.dispatchEvent(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            e = <span class="built_in">document</span>.createEvent(<span class="string">"CustomEvent"</span>);</span><br><span class="line">            e.initCustomEvent(evt, <span class="literal">true</span>, <span class="literal">true</span>, detail);</span><br><span class="line">            <span class="keyword">if</span> (el) &#123;</span><br><span class="line">                el.dispatchEvent(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">"jinux-trigger is not supported by environment."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>再附上一个小demo<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>jinux-trigger<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./trigger.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>页面加载进来之后，等待3秒后代码触发按钮的点击事件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>点击...<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'button'</span>);</span></span><br><span class="line"><span class="javascript">    btn.addEventListener(<span class="string">'click'</span>,()=&gt;&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">'点击按钮被点击了！！！'</span>);</span></span><br><span class="line"><span class="javascript">    &#125;,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">//页面加载进来之后，等待3秒后代码触发按钮的点击</span></span></span><br><span class="line"><span class="javascript">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        jinuxTrigger(btn,<span class="string">'click'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;,3000);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己写一个简单的trigger来触发事件&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="js工具库" scheme="/tags/js%E5%B7%A5%E5%85%B7%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>谷歌黑语法</title>
    <link href="/2019/01/14/%E8%B0%B7%E6%AD%8C%E9%BB%91%E8%AF%AD%E6%B3%95/"/>
    <id>/2019/01/14/谷歌黑语法/</id>
    <published>2019-01-14T05:49:16.000Z</published>
    <updated>2019-01-15T06:05:34.367Z</updated>
    
    <content type="html"><![CDATA[<p>关于搜索引擎的一些使用技巧<br><a id="more"></a></p><h2 id="谷歌黑语法"><a href="#谷歌黑语法" class="headerlink" title="谷歌黑语法"></a>谷歌黑语法</h2><p>平时，我们经常用百度来搜索一些东西，由于墙的原因，我们很少用谷歌，但是我们工作生活中使用百度就已经足够了。<br>今天这篇文章介绍一下谷歌搜索的使用技巧，因为谷歌是所搜的老大，所以其它搜索引擎也来效仿谷歌，因而，下边介绍的这些搜索知识，基本上所有的搜索引擎都会适用的。</p><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><p>谷歌的默认搜索是and逻辑，意思就是，我们在输入关键字后进行搜索时，如输入：“program google”后，会搜出包含“program”和“google”的文件内容，如下图1所示。<br><img src="/2019/01/14/谷歌黑语法/1.png" alt="img"><br>说到这里，我就插入一个小知识点：基础布尔逻辑。<br>对于一个搜索引擎来说，进行搜索的时候是要搜索到匹配到所有关键词的页面，还是包含关键词中的任意关键词就可以，取决于一个搜索引擎的一些特别算法，称之为搜索引擎的布尔逻辑默认值。<br>而google就是用and作为默认逻辑（搜索到所有的关键词），当然这个前提是我们没有输入一些特殊的命令。如果你不确定你要搜索的内容，或者你想搜索两个中的任意一个，那么就要使用关键词“OR”。注意：OR是大写的，小写是不起作用的，而且，每一个关键词与“OR”之间是有一个空格的，我们来看一下搜索结果。<br><img src="/2019/01/14/谷歌黑语法/2.png" alt="img"><br>当然，可以预想的是，google的结果要比program多得多，所以结果第一页全是有关google的内容。此外，还可以借助计算机体系语言中的“|”来代替“OR”，效果是一样的。<br>当然，如果你希望搜索“programgoogle”的内容，而不希望这两个单词之间有任何其他的内容，那么就要使用双引号把搜索的内容组成一个词组来达到目的。如下图3所示。<br><img src="/2019/01/14/谷歌黑语法/3.png" alt="img"><br>如上图所示，结果中的programgoogle都是在一起的，没有分割。当然这样的结果比较少，只有2740个，但是看图1，结果却有7亿多个。而且，大部分搜索引擎都有智能断句的功能，如果没有特殊的命令，搜索引擎会一定量的根据大众的语言使用习惯来判断你要搜索什么，而这样的做法，不仅仅没有使搜索引擎显得不听话，反而对大众来讲搜索引擎变得十分智能和高效！<br>但是如果我们只想看到“program”的内容，而不希望看到“google”的内容，就可以把“-”（减号或者破折号）应用到搜索当中去，语法为“program -google”，注意，“-”之前是有一个空格的，而其后却是和下一个关键词是紧紧相连的！搜索的结果如下图4所示。可以看得到结果中都会包含program，而不包含google。<br><img src="/2019/01/14/谷歌黑语法/4.png" alt="img"><br>说到这里，还要提一下google的约束扩展问题了。一般来说，当输入关键词后，google会把相关网页和信息的结果呈现在我们面前。然而，有一些单词在搜索引擎中是会被智能忽略的，导致我们得不到想要的结果。比如十分常用的“www”和“the”，基本上任何一个网页上都会找到的东西，就会被google自动忽略（不要觉得这样不好，还是那个道理，在实际引用当中这样做反而显得更加高效和智能）。如果我们不想忽略这些词进行查询，就得在这些关键词的前面加上符号“+”。如下图5所示：<br><img src="/2019/01/14/谷歌黑语法/5.png" alt="img"><br>看上去两者好像没有什么大的区别，其实仔细比较一下搜索结果就可以看得出，加上加号的搜索结果有一万多个，而不加加号的结果却有着55亿多！而因为google和www的关联度比较高，所以在前面的结果表现的差别不大。<br>除了上述字符之外，一些搜索引擎支持一种叫做“stemming”（填充）的技术。Stemming是指在查询的关键词中添加一些通配符，通常是“*”，有时候也可能是“？”，这些通配符的作用是要求搜索引擎进行查询是可以返回多个不同的结果。其中通配符代表占位，可以匹配其他任意字母和单词，而其他的字或词组与用户输入的相同。如我们想要搜索“Lionel Messi”的内容，却忘记了第一个单词的一些拼写，就可以输入“l*Messi”进行查询，注意：此处整个字符串是要用一个英文半角双引号括住的！结果如下图所示。<br><img src="/2019/01/14/谷歌黑语法/6.png" alt="img"><br>可以看到，google自动匹配出Lionel Messi的内容并且进行了搜索。这样的方式有利于我们只能记住单词或短语的一部分的内容时使用。<br>基本的语法就讲到这里，上述的内容也没有列全，因为有些搜索功能不太常用。不过，这些语法就已经够我们日常使用的了，基本语法就是做基本的事，google也有一些高级的语法，见下边高级语法。</p><h3 id="高级语法"><a href="#高级语法" class="headerlink" title="高级语法"></a>高级语法</h3><h4 id="intitle"><a href="#intitle" class="headerlink" title="intitle"></a>intitle</h4><p>首先要介绍的就是“intitle:”的用法，这个串的作用是将搜索的范围局限在标题上。在关键词前面加上这个，就会只对网页的标题进行搜索并且配对，最后将结果返回给用户。例如输入“intitle:program moon”进行搜索，就会返回如下图所示的结果。<br><img src="/2019/01/14/谷歌黑语法/7.png" alt="img"><br>但是可以看到，貌似搜索结果中只出现了关于program的内容，而并没有moon相关的内容，这里其实还是牵扯到搜索引擎的基础布尔逻辑问题，在intitle:语法上，google会检索所有的网页，只要出现program或者moon其中的一个就会被匹配，意料之中的是，关于program的内容肯定是要远远多于moon的内容的，所以搜索结果里关于program的内容占据了主导，可以理解为moon这个关键词被一定量的智能忽略了。但是如果我们想要找到网页标题中既有program又有moon的网页呢?那么我们就要使用“intitle:”的一个变体“allintitle:”，使用这个前缀后，就能得到我们想要的结果了。如下图所示，除了第一条为google的图片推荐，其余的结果中网页的标题既含有program这个关键词，又含有moon这个关键词。<br><img src="/2019/01/14/谷歌黑语法/8.png" alt="img"></p><h4 id="intext"><a href="#intext" class="headerlink" title="intext"></a>intext</h4><p>看到这个单词，大概就可以猜到它的意义了，“intext:”是用来搜索网页正文内容的，这样就可以忽略网页中的超文本链接、URL和题目。我们输入“intext:2018 program”进行搜索，结果如下图所示，结果中显示的网页大部分标题几乎没有规律，但是网页的索引中都包含着 “2018 program”，但是因为2018和program的同时出现的网页实在比较少，两个关键词的关联度实在不高（笔者此时的时间为2016年12月25日00:07:10），因为现在才是2016年，如果换成“2016 program”我相信应该会有更多的结果出现。但是我们要明白，这时搜索引擎关注的内容是网页的正文。与之相对应的也有一个变体：“allintext:”，用法和上面的“allintitle”相似，我就不做过多的介绍了。<br><img src="/2019/01/14/谷歌黑语法/9.png" alt="img"><br>到这里恐怕就有读者要问了，这与我们平时的搜索相比没有什么高级的地方啊？确实，就平时的搜索来讲，这个语法的意义确实不太重大，但是在某些领域，例如黑客作为一名攻击者，构造好关键词配合适当的语法就可以进行撒网式的攻击，这个呢，我们点到为止，这里就不谈了。</p><h4 id="inanchor"><a href="#inanchor" class="headerlink" title="inanchor"></a>inanchor</h4><p>这个语法的意思是在页面的链接锚点进行搜索。<br>链接锚点指的是一个链接的描述文本，如这样的一段HTML代码：&lt;a href=<a href="https://www.baidu.com&gt;百度" target="_blank" rel="noopener">https://www.baidu.com&gt;百度</a>，链接的锚点就是“百度”了。<br>我们搜索“inanchor:login”就可以搜索到有那些含有锚点的网页了，如下图所示。当然，这个语法也有一个变体“allinanchor:”，意思也与前面的类似。<br><img src="/2019/01/14/谷歌黑语法/10.png" alt="img"></p><h4 id="site"><a href="#site" class="headerlink" title="site"></a>site</h4><p>这个语法是把搜索限制在站点域名之内。例如我们搜索“program site:google.com”，结果如下图所示，这里呢，我们通常不需要加上前面的www，这样搜索的结果就会是包括所有含有google.com域名的有关内容，包括顶级域名和二级域名甚至三级域名的内容。也就是说我们甚至可以通过搜索，确定google.com大概有多少个子域名！<br><img src="/2019/01/14/谷歌黑语法/11.png" alt="img"></p><h4 id="inurl"><a href="#inurl" class="headerlink" title="inurl"></a>inurl</h4><p>inurl:会将搜索的范围限制在URL或者网站的页面上，这个语法对于查找搜索和帮助是很有用的，不仅适合我们普通的搜索，在黑客搜索中用处也很大。例如我们输入“inurl:password”，结果如下图所示，结果显示了所有URL中含有password的网页。另外，这个语法也有一个变体：“allinurl:”，用法与前面的相似。<br><img src="/2019/01/14/谷歌黑语法/12.png" alt="img"><br>在黑客领域，inurl和site的使用是十分的频繁的，利用他们组合可以搜索到有用的信息，如我们可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“site:google.com –inurl:www.google.com”，而这个语法的含义就是搜索google到底有多少个子域名。</span><br></pre></td></tr></table></figure></p><h4 id="link"><a href="#link" class="headerlink" title="link"></a>link</h4><p>这个的功能是查询所有链接到某个特定URL上的列表。要注意的是，是特定的URL页面，如输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“link:www.baidu.com”</span><br></pre></td></tr></table></figure></p><p>进行搜索，如下图所示，就会返回所有链接到百度主页的网页了。因此，我们同样可以指定特定的URL页面来进行搜索。<br><img src="/2019/01/14/谷歌黑语法/13.png" alt="img"></p><h4 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h4><p>Cache可以帮助我们查找到google索引过的页面副本，它最大的好处就是即使源文件界面不存在了，或者变成了其它的内容，我们依然可以搜索的到。例如输入:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“cache：www.baidu.com”</span><br></pre></td></tr></table></figure></p><p>结果如下所示，可以看到，格式虽然乱糟糟的，但是依稀可以从中获取一些有用的信息的。在国内的搜索引擎上，可能也有类似的功能，比如百度的网页快照，其功能与这个类似。<br><img src="/2019/01/14/谷歌黑语法/14.png" alt="img"></p><h4 id="filetype"><a href="#filetype" class="headerlink" title="filetype"></a>filetype</h4><p>filetype是指搜索指定后缀的文件。这个不太常用，但是在黑客领域有一定的作用。但是我们的重点是讲解语法，所以这里就一笔带过（关于filetype的一些其他内容我会在以后的博文中展示），如下图所示，输入“filetype:mdb”，结果就会显示出一些网站的数据库文件。<br><img src="/2019/01/14/谷歌黑语法/15.png" alt="img"></p><h4 id="related"><a href="#related" class="headerlink" title="related"></a>related</h4><p>这个语法是用于搜索与某些页面相关的网站的，可以辅助我们搜索同类的页面。比如我们输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“related:www.google.com”</span><br></pre></td></tr></table></figure></p><p>显示的结果都是一些其他的搜索引擎。<br><img src="/2019/01/14/谷歌黑语法/16.png" alt="img"></p><h4 id="info"><a href="#info" class="headerlink" title="info"></a>info</h4><p>这个语法可以搜索到关于一个URL的更多信息的页面列表，这里的信息包括这个网页的cache，还有与这个网页相似的网页等等，注意下面的英文信息就好。输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“info:www.google.com”</span><br></pre></td></tr></table></figure></p><p>结果如下图所示。<br><img src="/2019/01/14/谷歌黑语法/17.png" alt="img"></p><p>好了，大概就这么多了，还用别的这里就不介绍了，对于我这种小白来说已经够用的了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于搜索引擎的一些使用技巧&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="计算机原理" scheme="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="网络基础" scheme="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>es6-async-await</title>
    <link href="/2019/01/03/es6-async-await/"/>
    <id>/2019/01/03/es6-async-await/</id>
    <published>2019-01-03T06:17:47.000Z</published>
    <updated>2019-01-03T06:26:12.963Z</updated>
    
    <content type="html"><![CDATA[<p>es6中async-await的demo<br><a id="more"></a></p><h2 id="es6-async-await"><a href="#es6-async-await" class="headerlink" title="es6-async-await"></a>es6-async-await</h2><p>es6现在已经在项目中使用了，async偶尔用，所以要用的时候总是忘记，写个小demo，用的时候看一眼，哈哈<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;es7-<span class="keyword">async</span>-<span class="keyword">await</span>&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;es7-<span class="keyword">async</span>-<span class="keyword">await</span>&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">//写一个返回Promise的异步函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncTime</span>(<span class="params">val, ms</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">resolve(val);</span><br><span class="line">&#125;,ms);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//async函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">await</span> asyncTime(<span class="number">1</span>, <span class="number">1000</span>); <span class="comment">//a的值就是Promise函数里面resolve的参数值</span></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">await</span> asyncTime(a+<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">await</span> asyncTime(b+<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br><span class="line"><span class="keyword">let</span> d = <span class="keyword">await</span> <span class="number">123</span>; <span class="comment">//await后面可以不是Promise函数，但是会自动包装成一个Promise函数并且立即向后执行</span></span><br><span class="line"><span class="built_in">console</span>.log(d);</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line">testAsync().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'async函数的then函数-&gt;'</span>,res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//async函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync_2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">await</span> testAsync(); <span class="comment">//因为async本身执行后会返回一个Promise函数(async函数内部return的值只作为async返回的Promise函数的then里的参数传入)，所以此处也可以在await后边写async函数。</span></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">testAsync_2().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'async函数2的then函数-&gt;'</span>,res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//再来一个多个异步函数执行的例子</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync_3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([asyncTime(<span class="string">'all1'</span>,<span class="number">2000</span>),asyncTime(<span class="string">'all2'</span>,<span class="number">2000</span>),asyncTime(<span class="string">'all3'</span>,<span class="number">2000</span>)]);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">testAsync_3().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">alert(res);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;es6中async-await的demo&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>github预览静态库页面</title>
    <link href="/2019/01/02/github%E9%A2%84%E8%A7%88%E9%9D%99%E6%80%81%E5%BA%93%E9%A1%B5%E9%9D%A2/"/>
    <id>/2019/01/02/github预览静态库页面/</id>
    <published>2019-01-02T08:53:42.000Z</published>
    <updated>2019-01-03T00:52:33.164Z</updated>
    
    <content type="html"><![CDATA[<p>github预览静态库页面<br><a id="more"></a></p><h2 id="github预览静态库页面"><a href="#github预览静态库页面" class="headerlink" title="github预览静态库页面"></a>github预览静态库页面</h2><p>类似于 <a href="https://jinux7.github.io" target="_blank" rel="noopener">https://jinux7.github.io</a> 这样的github静态网站展示大家都知道怎么弄，在网上可以搜索到很多教程，我自己的blog网站就是这么搞的，但是这种方法我发现一个github账户只能弄出一个，今天我想说的是另一种方式，直接可以访问到普通库里的静态页面。<br>这里需要github提供的一个服务地址，见下边：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://htmlpreview.github.io/?https://raw.githubusercontent.com/jixoba/mobile_company/master/index.html</span><br></pre></td></tr></table></figure></p><p>上边的这段地址就可以访问普通库里的静态页面了，注意jixoba/mobile_company这个，是库的名称，只需要更改这个库名，其它地方不需要动。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;github预览静态库页面&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="github" scheme="/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>cordova android打包配置详解</title>
    <link href="/2018/12/18/cordova-android%E6%89%93%E5%8C%85%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
    <id>/2018/12/18/cordova-android打包配置详解/</id>
    <published>2018-12-18T07:27:22.000Z</published>
    <updated>2018-12-19T05:22:57.679Z</updated>
    
    <content type="html"><![CDATA[<p>cordova打包android app<br><a id="more"></a></p><h2 id="cordova-android打包配置详解"><a href="#cordova-android打包配置详解" class="headerlink" title="cordova android打包配置详解"></a>cordova android打包配置详解</h2><p>前几天在网上看到了cordova的东西，之前有过鼓捣react native和weex，所以看看它有什么特点。<br>由于我用的是win10系统，所以在配置环境的时候相当的麻烦，这里稍微的屡一下。</p><h3 id="一-安装JDK"><a href="#一-安装JDK" class="headerlink" title="一 安装JDK"></a>一 安装JDK</h3><p>JDK是java的开发工具包，因为我们打包安卓的apk文件，安卓是依赖java的，所以这个必须安装。<br>我刚开始安装的是最新版的，但是与cordova版本好像不是很搭，于是安装了JDK8这个版本。<br>安装好了之后要配置环境变量，首先是新建变量名JAVA_HOME，指向JDK的安装目录，之后再配置一下path，指向JDK里的bin目录。<br>再配置一下jre的path，也是指向jre里的bin目录。（jre安装有的直接安装JDK的时候顺便安装了，有的版本需要另外单独安装）</p><h3 id="二-安装SDK"><a href="#二-安装SDK" class="headerlink" title="二 安装SDK"></a>二 安装SDK</h3><p>SDK稍微有点复杂，首先还是下载SDK并且安装，这里需要注意，安装路径，我用的win10，必须安装在 用户/用户名/AppData/Local,<br>其它系统可能无所谓。安装好了之后，还是配置环境变量，新建变量名ANDROID_SDK_HOME，指向安装的SDK目录，再配置path，指向SDK下的<br>tools和platform-tools。</p><h3 id="三-安装Gradle"><a href="#三-安装Gradle" class="headerlink" title="三 安装Gradle"></a>三 安装Gradle</h3><p>Gradle好像是一个打包工具，直接下载安装，之后配置一下Gradle的bin目录环境变量。</p><h3 id="四-安装cordova"><a href="#四-安装cordova" class="headerlink" title="四 安装cordova"></a>四 安装cordova</h3><p>cordova的安装和运行需要nodejs，所以用npm来安装。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g cordova@6.1.1</span><br></pre></td></tr></table></figure></p><p>注意，这里我安装的是6.1.1版本，高版本莫名其妙的报错，这个稳妥一些。<br>之后就是使用cordova来创建项目喽。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cordova create app jinux.com.cn app  // 创建一个项目</span><br><span class="line">cd app // 进入app项目</span><br><span class="line">cordova platform android  // 添加安卓模板</span><br><span class="line">cordova requirements  // 查看打包缺少什么依赖项</span><br><span class="line">cordova build android  // 打包apk</span><br></pre></td></tr></table></figure></p><p>以上的这些命令，在查看依赖项的时候肯定回报一些错误，SDK的一些依赖没有安装，进入SDK文件夹，打开SDK Manager.exe，根据依赖的提示下载相应的包，注意，这里是从谷歌上拉取，所以要开代理哦。<br>第一次build的时候，Gradle需要从网络上下载一堆包，还是注意需要代理拉取谷歌的文件，很慢的，耐心等待。<br>*下面是一个别人写的cordova博文，可供参考<br><a href="http://www.xiaoxiaohan.com/js/58.html#comments" target="_blank" rel="noopener">参考</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;cordova打包android app&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="cordova" scheme="/tags/cordova/"/>
    
  </entry>
  
  <entry>
    <title>setTimeout&amp;async&amp;Promise执行顺序</title>
    <link href="/2018/12/11/setTimeout-async-Promise%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"/>
    <id>/2018/12/11/setTimeout-async-Promise执行顺序/</id>
    <published>2018-12-11T01:59:32.000Z</published>
    <updated>2018-12-11T02:36:37.697Z</updated>
    
    <content type="html"><![CDATA[<p>setTimeout&amp;async&amp;Promise执行顺序简要分析<br><a id="more"></a></p><h2 id="setTimeout-amp-async-amp-Promise执行顺序"><a href="#setTimeout-amp-async-amp-Promise执行顺序" class="headerlink" title="setTimeout&amp;async&amp;Promise执行顺序"></a>setTimeout&amp;async&amp;Promise执行顺序</h2><p>看到标题，觉得这种需求在实际项目中基本遇不到，是的，我从没有遇到过，而且，要用就用一种，既然用了async，还用啥Promise。不过，网上有一道面试题，据说是今日头条的面试题，考的就是这方面的知识，先贴出代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>)</span><br><span class="line">    <span class="keyword">await</span> async2()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async2'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line">async1();</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">    resolve();</span><br><span class="line">&#125; ).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">&#125; )</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>)</span><br></pre></td></tr></table></figure></p><p>答案一会再说。<br>先来分析一下，setTimeout,async,Promise执行的有先顺序。其实，要想研究明白这个问题，需要了解异步执行的宏任务，微任务知识，而且，在浏览器和nodejs环境下还不一样，这里我不对这些知识作深入分析，因为我看了些相关知识，看的晕头转向，所以，我只简单的记一下在浏览器环境下的优先顺序。<br>异步发生的节点是：<br>1.setTimeout的回调函数。<br>2.Promise实例的then方法中的回调函数。<br>3.async函数中await 后面紧跟着的函数（如async2），这个地方比较有意思，进入async2的时候是同步的，async2里边如果都是同步函数，那就继续执行，等执行完毕，返回先关东西后，”await async2()”这句话下边的语句不会马上执行，有点像Promise实例的then方法中的回调一样，需要排队等待。<br>所以，优先顺序是Promise的then方法回调第一，async await 之后的语句排第二，setTimeout的回调排第三。<br>记住了吗？我没有考虑理论知识，只是简单地死记硬背而已。<br>最后，把上边代码的结果写出来，看看与你想的是否一样。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">script start</span><br><span class="line">async1 start</span><br><span class="line">async2</span><br><span class="line">promise1</span><br><span class="line">script end</span><br><span class="line">promise2</span><br><span class="line">async1 end</span><br><span class="line">setTimeout</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;setTimeout&amp;amp;async&amp;amp;Promise执行顺序简要分析&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="面试题" scheme="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
      <category term="基础知识" scheme="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>nodejs搭建https服务器</title>
    <link href="/2018/12/07/nodejs%E6%90%AD%E5%BB%BAhttps%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>/2018/12/07/nodejs搭建https服务器/</id>
    <published>2018-12-07T07:03:57.000Z</published>
    <updated>2018-12-07T08:03:44.502Z</updated>
    
    <content type="html"><![CDATA[<p>ssl证书的创建，https服务器的搭建<br><a id="more"></a></p><h2 id="nodejs搭建https服务器"><a href="#nodejs搭建https服务器" class="headerlink" title="nodejs搭建https服务器"></a>nodejs搭建https服务器</h2><p>虽然作者是一名菜鸟前端，但是学习https相关的知识还是必须的。之前看过很多理论的文章，http与https的区别，ssl证书如何起作用的等等，说实话，我都忘记了，今天正好有时间，早上坐地铁就看了相关的文章，刚才写出了一个demo，现在就记录一下整个过程。</p><h3 id="http与https区别"><a href="#http与https区别" class="headerlink" title="http与https区别"></a>http与https区别</h3><ul><li>HTTP: 超文本传输协议 (Hypertext transfer protocol) 是一种详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。</li><li>HTTPS:（Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司进行，提供了身份验证与加密通讯方法，现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。<blockquote><p>区别：</p></blockquote></li><li>https协议需要到ca申请证书，一般免费证书很少，需要交费。</li><li>http是超文本传输协议，信息是明文传输，https 则是具有安全性的ssl加密传输协议。</li><li>http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</li><li>http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。<h3 id="创建ssl证书"><a href="#创建ssl证书" class="headerlink" title="创建ssl证书"></a>创建ssl证书</h3><h4 id="第一步，安装openssl"><a href="#第一步，安装openssl" class="headerlink" title="第一步，安装openssl"></a>第一步，安装openssl</h4>安装openssl，很简单，按照正常的window软件按照下一步按照就可以，下面是下载地址，注意选择是64bit还是32bit哦,我下载了“Win64 OpenSSL v1.1.1a Ligh”这个版本，因为体积小，所以下载了light的版本。<br><a href="https://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener">openssl下载地址</a><br>安装好了之后，配置一下环境变量，这样在哪个文件夹下都可以直接使用openssl命令了。<h4 id="第二部，使用openssl创建ssl证书"><a href="#第二部，使用openssl创建ssl证书" class="headerlink" title="第二部，使用openssl创建ssl证书"></a>第二部，使用openssl创建ssl证书</h4>这个步骤还是有点小困难，在网上按照有的教程弄不好使，后来找到一个教程，好使，直接贴出命令行代码。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#生成私钥key文件：</span><br><span class="line">~ D:\workspace\javascript\nodejs-https&gt;openssl genrsa -out privatekey.pem 1024</span><br><span class="line">Generating RSA private key, 1024 bit long modulus</span><br><span class="line">...........................++++++</span><br><span class="line">........++++++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line"></span><br><span class="line">#通过私钥生成CSR证书签名</span><br><span class="line">~ D:\workspace\javascript\nodejs-https&gt;openssl req -new -key privatekey.pem -out certrequest.csr</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:Beijing</span><br><span class="line">Locality Name (eg, city) []:Beijing</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:fens.me</span><br><span class="line">Organizational Unit Name (eg, section) []:fens.me</span><br><span class="line">Common Name (eg, YOUR name) []:Conan Zhang</span><br><span class="line">Email Address []:bsspirit@gmail.com</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"></span><br><span class="line"># 通过私钥和证书签名生成证书文件</span><br><span class="line">~ D:\workspace\javascript\nodejs-https&gt;openssl x509 -req -in certrequest.csr -signkey privatekey.pem -out certificate.pem</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=Beijing/L=Beijing/O=fens.me/OU=fens.me/CN=Conan Zhang/emailAddress=bsspirit@gmail.com</span><br><span class="line">Getting Private key</span><br></pre></td></tr></table></figure></li></ul><p>注意在通过私钥生成CSR证书签名的时候需要添加一些个人信息。<br>新生成了3个文件：certificate.pem, certrequest.csr, privatekey.pem</p><ul><li>privatekey.pem: 私钥</li><li>certrequest.csr: CSR证书签名</li><li>certificate.pem: 证书文件<br>接下来，直接在nodejs的服务代码中引入相关文件就可以了。<h3 id="nodejs创建https服务器"><a href="#nodejs创建https服务器" class="headerlink" title="nodejs创建https服务器"></a>nodejs创建https服务器</h3>直接贴代码了，这步骤就很简单了<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">var</span> privateKey  = fs.readFileSync(<span class="string">'./ssl/privatekey.pem'</span>, <span class="string">'utf8'</span>),</span><br><span class="line">    certificate = fs.readFileSync(<span class="string">'./ssl/certificate.pem'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="keyword">var</span> credentials = &#123;<span class="attr">key</span>: privateKey, <span class="attr">cert</span>: certificate&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpServer = http.createServer(app);</span><br><span class="line"><span class="keyword">var</span> httpsServer = https.createServer(credentials, app);</span><br><span class="line"><span class="keyword">var</span> PORT = <span class="number">18080</span>;</span><br><span class="line"><span class="keyword">var</span> SSLPORT = <span class="number">18081</span>;</span><br><span class="line"></span><br><span class="line">httpServer.listen(PORT, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'HTTP Server is running on: http://localhost:%s'</span>, PORT);</span><br><span class="line">&#125;);</span><br><span class="line">httpsServer.listen(SSLPORT, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'HTTPS Server is running on: https://localhost:%s'</span>, SSLPORT);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Welcome</span></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.protocol === <span class="string">'https'</span>) &#123;</span><br><span class="line">        res.status(<span class="number">200</span>).send(<span class="string">'Welcome to Safety Land!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.status(<span class="number">200</span>).send(<span class="string">'Welcome!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><p>好了，https服务器搭建完成，原来这么简单。不过，有个问题，因为这个ssl证书属于个人证书，并不是第三方的安全CA证书，所以在浏览器访问https协议时候会有不安全的提醒文字，这个对于我们测试来说是没问题的，如果想在正规的网站上使用，我们还得去阿里云申请CA证书哦。<br>最后，本想把本demo的代码上传到github，不过，代码实在是简单，不传了，直接放个截图得了。<br><img src="/2018/12/07/nodejs搭建https服务器/1.png" alt="img"><br>ssl文件夹里放了3个ssl文件哦。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ssl证书的创建，https服务器的搭建&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="nodejs" scheme="/categories/nodejs/"/>
    
    
      <category term="网络基础" scheme="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    
      <category term="web安全" scheme="/tags/web%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>vue-iview Modal组件简单分析</title>
    <link href="/2018/12/04/vue-iview-Modal%E7%BB%84%E4%BB%B6%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/"/>
    <id>/2018/12/04/vue-iview-Modal组件简单分析/</id>
    <published>2018-12-04T07:49:12.000Z</published>
    <updated>2018-12-05T02:22:50.407Z</updated>
    
    <content type="html"><![CDATA[<p>vue-iview Modal组件简单分析<br><a id="more"></a></p><h2 id="vue-iview-Modal组件简单分析"><a href="#vue-iview-Modal组件简单分析" class="headerlink" title="vue-iview Modal组件简单分析"></a>vue-iview Modal组件简单分析</h2><p>现在公司的项目前端框架用的是vue，在工作中避免不了要写一些组件，其实写组件的方法千千种，怎么写都行，但是，总想写出来的组件像一些ui框架里的组件一样高大上，于是乎，今天有点时间，大致的看了一下iview的Modal组件，简单的记录一下思想。<br>由于时间原因，代码并没有深入往里边看，只是把大致的框框看了一下。<br>首先，我们看看Modal组件的用法，<a href="https://www.iviewui.com/components/modal#API" target="_blank" rel="noopener">官方文档点这里</a><br>简单的用法如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Modal v-model=<span class="string">"modal12"</span> draggable scrollable title=<span class="string">"Modal 1"</span>&gt;</span><br><span class="line">    &lt;div&gt;This is the first modal&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Modal&gt;</span><br><span class="line"><span class="comment">// 上边这个是基础写法</span></span><br><span class="line"><span class="comment">// 下边这个写法可以直接调用，不需要在html中写出&lt;Modal&gt;&lt;/Modal&gt;标签</span></span><br><span class="line"><span class="keyword">this</span>.$Modal.info(config)</span><br><span class="line"><span class="keyword">this</span>.$Modal.success(config)</span><br></pre></td></tr></table></figure></p><p>先看一下iview的Modal组件文件夹结构<br><img src="/2018/12/04/vue-iview-Modal组件简单分析/1.png" alt="img"><br>index文件是入口文件，里边导出了Modal对象。也就是可以使用<modal></modal>标签的原因，因为给Modal对象加一大堆方法，但是它还是一个vue的基础组件。大家可能注意到了，当使用<modal></modal>标签定义组建的时候，发现最后组件的dom元素被插入到了body下，而不是在具体引入的位置，这是因为Modal组件里有一个指令：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  Modal组件里有</span></span><br><span class="line">directives: &#123; TransferDom &#125;</span><br><span class="line"><span class="comment">// 追溯TransferDom指令，发现有如下代码</span></span><br><span class="line">parentNode.replaceChild(home, el); <span class="comment">// moving out, el is no longer in the document</span></span><br><span class="line">getTarget(value).appendChild(el); <span class="comment">// moving into new place</span></span><br></pre></td></tr></table></figure></p><p>modal.vue文件是组件的基础文件，也就是页面显示出来的东西，index文件里的东西可以看出来，只是给Modal对象添加了一些静态方法，为了this.$Modal.info(config)这样调用的时候使用。<br>confrim文件里主要做了this.$Modal.info()这样调用的时候动态new Vue()实例，也是以modal.vue这个组件为基础，动态的插入到body节点里，代码见下边:<br><img src="/2018/12/04/vue-iview-Modal组件简单分析/2.png" alt="img"><br>就是通过new Vue()的实例获取到这个组建的html代码片段，再插入到body节点中。<br>最后，再看看iview如何变成vue的全局组件的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue, opts = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里添加全局组件</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(iview).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        Vue.component(key, iview[key]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里添加实例方法</span></span><br><span class="line">    Vue.prototype.$Modal = Modal;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>以上就是大概思路哈。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;vue-iview Modal组件简单分析&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="vue" scheme="/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>小巧的html模板引擎</title>
    <link href="/2018/11/30/%E5%B0%8F%E5%B7%A7%E7%9A%84html%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/"/>
    <id>/2018/11/30/小巧的html模板引擎/</id>
    <published>2018-11-30T06:57:20.000Z</published>
    <updated>2018-11-30T07:16:38.370Z</updated>
    
    <content type="html"><![CDATA[<p>小巧的html模板引擎<br><a id="more"></a></p><h2 id="小巧的html模板引擎"><a href="#小巧的html模板引擎" class="headerlink" title="小巧的html模板引擎"></a>小巧的html模板引擎</h2><p>今天看coco大神的github，看到了他写的html模板引擎，默默地记录下来，其实，模板引擎我自己也写过一个，不过总觉得大神写的一定比我的好，<a href="https://github.com/jinux7/jinux-template" target="_blank" rel="noopener">点击这是我写的</a><br>先贴出代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * coTemplate</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">name, definition</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span>) &#123;</span><br><span class="line">        define(definition);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>[name] = definition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="string">'cotemplate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tplReg = <span class="regexp">/\$\&#123;\s*([^\&#123;\&#125;\s]+)\s*\&#125;/g</span>;</span><br><span class="line">    <span class="keyword">var</span> jsReg = <span class="regexp">/(^( )?(if|for|else|switch|case|break|&#123;|&#125;))(.*)?/g</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> code = <span class="string">'var r=[];\n'</span>;</span><br><span class="line">    <span class="keyword">var</span> match = <span class="string">'undefined'</span>;</span><br><span class="line">    <span class="keyword">var</span> pointer = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加单行逻辑</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; line </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">lineAdd</span>(<span class="params">line</span>) </span>&#123;</span><br><span class="line">        code += <span class="string">'r.push("'</span> + line.replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>) + <span class="string">'");\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板拼接</span></span><br><span class="line"><span class="comment">     * @param &#123;String&#125; tpl 模板字符串 </span></span><br><span class="line"><span class="comment">     * @param &#123;Objcet&#125; data 模板内替换对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">cotemplate</span>(<span class="params">tpl, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (match = tplReg.exec(tpl)) &#123;</span><br><span class="line">            <span class="comment">// 添加非逻辑部分</span></span><br><span class="line">            lineAdd(tpl.slice(pointer, match.index)); </span><br><span class="line"></span><br><span class="line">            <span class="comment">// 添加逻辑部分 "$&#123;" + match[1] + "&#125;";</span></span><br><span class="line">            code += (<span class="string">'r.push(String(this.'</span> + match[<span class="number">1</span>] + <span class="string">'));'</span>);</span><br><span class="line"></span><br><span class="line">            pointer = match.index + match[<span class="number">0</span>].length;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加代码的最后一截</span></span><br><span class="line">        lineAdd(tpl.substr(pointer, tpl.length - pointer)); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回结果，在这里我们就拿到了装入数组后的代码</span></span><br><span class="line">        code += <span class="string">'return r.join("");'</span>; </span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(code);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(code.replace(<span class="regexp">/[\r\t\n]/g</span>, <span class="string">''</span>)).apply(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * export</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> cotemplate;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>用法Demo<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"../js/cotemplate.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">    name: <span class="string">'Coco'</span>,</span><br><span class="line">    info: &#123;</span><br><span class="line">        age: <span class="number">18</span></span><br><span class="line">    &#125;,</span><br><span class="line">    bar: &#123;</span><br><span class="line">        foo: &#123;</span><br><span class="line">            <span class="keyword">else</span>: <span class="string">'co-template'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tpl = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;p&gt;name:<span class="subst">$&#123;coco&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;Age:<span class="subst">$&#123;info.age&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;<span class="subst">$&#123;bar.foo.<span class="keyword">else</span>&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">          `</span>;</span><br><span class="line"></span><br><span class="line">cotemplate(tpl, data);</span><br><span class="line"><span class="comment">// &lt;p&gt;Name:Coco&lt;/p&gt;        </span></span><br><span class="line"><span class="comment">// &lt;p&gt;Age:18&lt;/p&gt;        </span></span><br><span class="line"><span class="comment">// &lt;div&gt;HTML-template:co-template&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;小巧的html模板引擎&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="/categories/javascript/"/>
    
    
      <category term="js工具库" scheme="/tags/js%E5%B7%A5%E5%85%B7%E5%BA%93/"/>
    
  </entry>
  
</feed>
