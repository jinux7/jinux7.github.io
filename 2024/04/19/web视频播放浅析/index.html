<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>web视频播放浅析 | jinux</title>
  <meta name="description" content="前端 学习 javascript">
  <meta name="keywords" content>
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="alternate" href="/atom.xml" title="jinux">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="简单的介绍html中video标签的几种使用场景,注意，视频播放是点播形式。">
<meta name="keywords" content="基础知识,html">
<meta property="og:type" content="article">
<meta property="og:title" content="web视频播放浅析">
<meta property="og:url" content="/2024/04/19/web视频播放浅析/index.html">
<meta property="og:site_name" content="jinux">
<meta property="og:description" content="简单的介绍html中video标签的几种使用场景,注意，视频播放是点播形式。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="/2024/04/19/web视频播放浅析/1.png">
<meta property="og:image" content="/2024/04/19/web视频播放浅析/2.png">
<meta property="og:image" content="/2024/04/19/web视频播放浅析/3.png">
<meta property="og:image" content="/2024/04/19/web视频播放浅析/4.png">
<meta property="og:image" content="/2024/04/19/web视频播放浅析/5.png">
<meta property="og:updated_time" content="2024-04-22T01:16:01.429Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="web视频播放浅析">
<meta name="twitter:description" content="简单的介绍html中video标签的几种使用场景,注意，视频播放是点播形式。">
<meta name="twitter:image" content="/2024/04/19/web视频播放浅析/1.png">

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/node-waves/0.7.5/waves.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>
</html>
<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script>
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				<!-- <i class="fa fa-home"></i> -->
				jinux
			</a>

				<div class='menu'>
					<ul class='h-list'>
						
							<li>
								<a class='flat-box nav-home' href='/'>
									<i class="fa fa-home"></i>
									主页
								</a>
							</li>
						
							<li>
								<a class='flat-box nav-cube' href='/categories'>
									<i class="fa fa-cube"></i>
									导航
								</a>
							</li>
						
							<li>
								<a class='flat-box nav-github' href='https://github.com/jinux7'>
									<i class="fa fa-github"></i>
									github
								</a>
							</li>
						
							<li>
								<a class='flat-box nav-archive' href='/archives'>
									<i class="fa fa-archive"></i>
									归档
								</a>
							</li>
						
					</ul>
					<div class='underline'></div>
				</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon"><i class="fa fa-search"></i></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><i class="fa fa-search flat-box"></i></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><i class="fa fa-navicon flat-box"></i></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				xaoxuu
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><i class="fa fa-comments flat-box"></i></a></li>
				<li class='s-top'><a href='javascript:void(0)'><i class="fa fa-arrow-up flat-box"></i></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><i class="fa fa-list-ul flat-box"></i></a></li>
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
        <div class="header">jinux</div>
		<nav>
			
				<a href="/" class="nav-home nav">
					<i class="fa fa-home"></i>
					主页
				</a>
			
				<a href="/categories" class="nav-cube nav">
					<i class="fa fa-cube"></i>
					导航
				</a>
			
				<a href="https://github.com/jinux7" class="nav-github nav">
					<i class="fa fa-github"></i>
					github
				</a>
			
				<a href="/archives" class="nav-archive nav">
					<i class="fa fa-archive"></i>
					归档
				</a>
			
		</nav>
	</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-web视频播放浅析" class="post white-box article-type-post" itemscope itemprop="blogPost">
    <section class='meta'>
        <h1 class="title">
            
                web视频播放浅析
            
        </h1>
        <time>
            2024-04-19 Friday&nbsp;&nbsp;
            <i class="fa fa-eye" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
        </time>
        
    
    <div class='cats'>
        <a href="/categories/javascript/">javascript</a>
    </div>


    </section>
    
        <section class="toc-wrapper">
            <div class="header"><i class="fa fa-list" aria-hidden="true"></i>&nbsp;&nbsp;目录</div>
            <div class='content'>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#视频知识"><span class="toc-number">1.</span> <span class="toc-text">视频知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常见的视频文件格式"><span class="toc-number">1.1.</span> <span class="toc-text">常见的视频文件格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常见的视频编码格式"><span class="toc-number">1.2.</span> <span class="toc-text">常见的视频编码格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#浏览器中的视频格式"><span class="toc-number">1.3.</span> <span class="toc-text">浏览器中的视频格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WebM"><span class="toc-number">1.3.1.</span> <span class="toc-text">WebM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ogg-Theora"><span class="toc-number">1.3.2.</span> <span class="toc-text">Ogg/Theora</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MPEG-4-H-264"><span class="toc-number">1.3.3.</span> <span class="toc-text">MPEG-4/H.264</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见视频播放方法"><span class="toc-number">2.</span> <span class="toc-text">常见视频播放方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础方式"><span class="toc-number">2.1.</span> <span class="toc-text">基础方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#video-stream方式"><span class="toc-number">2.2.</span> <span class="toc-text">video-stream方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mediaSource方式"><span class="toc-number">2.3.</span> <span class="toc-text">mediaSource方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#m3u8-Hls方式"><span class="toc-number">2.4.</span> <span class="toc-text">m3u8 Hls方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li></ol>
            </div>
        </section>
    

    <section class="article typo">

        <div class="article-entry" itemprop="articleBody">
            <p>简单的介绍html中video标签的几种使用场景,注意，视频播放是点播形式。<br><a id="more"></a></p>
<h2 id="视频知识"><a href="#视频知识" class="headerlink" title="视频知识"></a>视频知识</h2><p>web端以前用flash播放视频，但是由于安全原因，现在已经抛弃，使用html5的video标签。</p>
<blockquote>
<p>视频容器（也称为视频封装格式）是用来存储音频、视频和其他元数据（如字幕、章节信息等）的一种文件格式结构。它将音视频编码数据组织在一起，以便于播放器解析和呈现。容器的作用就像一个“包装盒”，将不同的轨道（视频流、音频流、字幕流等）按照一定的标准组织起来，使得各部分数据可以同步播放。</p>
</blockquote>
<h3 id="常见的视频文件格式"><a href="#常见的视频文件格式" class="headerlink" title="常见的视频文件格式"></a>常见的视频文件格式</h3><p><img src="/2024/04/19/web视频播放浅析/1.png" alt="img"></p>
<h3 id="常见的视频编码格式"><a href="#常见的视频编码格式" class="headerlink" title="常见的视频编码格式"></a>常见的视频编码格式</h3><p><img src="/2024/04/19/web视频播放浅析/2.png" alt="img"></p>
<h3 id="浏览器中的视频格式"><a href="#浏览器中的视频格式" class="headerlink" title="浏览器中的视频格式"></a>浏览器中的视频格式</h3><h4 id="WebM"><a href="#WebM" class="headerlink" title="WebM"></a>WebM</h4><p><img src="/2024/04/19/web视频播放浅析/3.png" alt="img"></p>
<h4 id="Ogg-Theora"><a href="#Ogg-Theora" class="headerlink" title="Ogg/Theora"></a>Ogg/Theora</h4><p><img src="/2024/04/19/web视频播放浅析/4.png" alt="img"></p>
<h4 id="MPEG-4-H-264"><a href="#MPEG-4-H-264" class="headerlink" title="MPEG-4/H.264"></a>MPEG-4/H.264</h4><p><img src="/2024/04/19/web视频播放浅析/5.png" alt="img"></p>
<h2 id="常见视频播放方法"><a href="#常见视频播放方法" class="headerlink" title="常见视频播放方法"></a>常见视频播放方法</h2><h3 id="基础方式"><a href="#基础方式" class="headerlink" title="基础方式"></a>基础方式</h3><p>使用<code>video</code>标签，<code>src</code>直接链接到一个完整的视频地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;video-basic&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">      #video &#123;</span><br><span class="line">        width: 800px;</span><br><span class="line">        margin: 20px auto;</span><br><span class="line">        display: block;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">      &lt;video id=&quot;video&quot; controls autoplay&gt;</span><br><span class="line">        &lt;source src=&quot;http://127.0.0.1:3000/video1.mp4&quot; type=&quot;&quot;&gt;</span><br><span class="line">      &lt;/video&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>这个例子是最基础最简单的。<br><a href="https://github.com/jinux7/study-collections/tree/master/video%E8%A7%86%E9%A2%91/basic-usage" target="_blank" rel="noopener">源码</a></p>
<h3 id="video-stream方式"><a href="#video-stream方式" class="headerlink" title="video-stream方式"></a>video-stream方式</h3><p>前端代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;link rel=&quot;icon&quot; href=&quot;data:,&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;</span><br><span class="line">    &lt;title&gt;Streaming&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">      body &#123;</span><br><span class="line">        background-color: #000000;</span><br><span class="line">      &#125;</span><br><span class="line">      video &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 0;</span><br><span class="line">        right: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        left: 0;</span><br><span class="line">        max-height: 100%;</span><br><span class="line">        max-width: 100%;</span><br><span class="line">        margin: auto;</span><br><span class="line">        object-fit: contain;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;video </span><br><span class="line">      src=&quot;http://localhost:3000/api/video/video.mp4&quot;</span><br><span class="line">      playsInline</span><br><span class="line">      muted</span><br><span class="line">      autoplay</span><br><span class="line">      controls </span><br><span class="line">      controlsList=&quot;nodownload&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/video&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>后端代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">import Koa from &apos;koa&apos;</span><br><span class="line">import KoaRouter from &apos;koa-router&apos;</span><br><span class="line">import sendFile from &apos;koa-sendfile&apos;</span><br><span class="line">import url from &apos;url&apos;</span><br><span class="line">import path from &apos;path&apos;</span><br><span class="line">import fs from &apos;fs&apos;</span><br><span class="line">import util from &apos;util&apos;</span><br><span class="line"></span><br><span class="line">const __filename = url.fileURLToPath(import.meta.url)</span><br><span class="line">const __dirname = path.dirname(__filename)</span><br><span class="line"></span><br><span class="line">const PORT = parseInt(process.env.PORT, 10) || 3000</span><br><span class="line">const app = new Koa()</span><br><span class="line">const router = new KoaRouter()</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Serve HTML page containing the video player</span><br><span class="line">//</span><br><span class="line">router.get(&apos;/&apos;, async (ctx) =&gt; &#123;</span><br><span class="line">    await sendFile(ctx, path.resolve(__dirname, &apos;public&apos;, &apos;index.html&apos;))</span><br><span class="line"></span><br><span class="line">    if (!ctx.status) &#123;</span><br><span class="line">        ctx.throw(404)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Serve video streaming</span><br><span class="line">//</span><br><span class="line">router.get(&apos;/api/video/:name&apos;, async (ctx, next) =&gt; &#123;</span><br><span class="line">    const &#123; name &#125; = ctx.params</span><br><span class="line"></span><br><span class="line">    if (</span><br><span class="line">        !/^[a-z0-9-_ ]+\.mp4$/i.test(name)</span><br><span class="line">    ) &#123;</span><br><span class="line">        return next()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const &#123; request, response &#125; = ctx</span><br><span class="line">    const &#123; range &#125; = request.headers</span><br><span class="line"></span><br><span class="line">    if (!range) &#123;</span><br><span class="line">        ctx.throw(400, &apos;Range not provided&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const videoPath = path.resolve(__dirname, &apos;videos&apos;, name)</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        await util.promisify(fs.access)(videoPath)</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        if (err.code === &apos;ENOENT&apos;) &#123;</span><br><span class="line">            ctx.throw(404)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ctx.throw(err.toString())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //</span><br><span class="line">    // Calculate start Content-Range</span><br><span class="line">    //</span><br><span class="line">    const parts = range.replace(&apos;bytes=&apos;, &apos;&apos;).split(&apos;-&apos;)</span><br><span class="line">    const rangeStart = parts[0] &amp;&amp; parts[0].trim()</span><br><span class="line">    const start = rangeStart ? parseInt(rangeStart, 10) : 0</span><br><span class="line"></span><br><span class="line">    //</span><br><span class="line">    // Calculate video size and chunk size</span><br><span class="line">    //</span><br><span class="line">    const videoStat = await util.promisify(fs.stat)(videoPath)</span><br><span class="line">    const videoSize = videoStat.size</span><br><span class="line">    const chunkSize = 10 ** 6 // 1mb</span><br><span class="line"></span><br><span class="line">    //</span><br><span class="line">    // Calculate end Content-Range</span><br><span class="line">    //</span><br><span class="line">    // Safari/iOS first sends a request with bytes=0-1 range HTTP header</span><br><span class="line">    // probably to find out if the server supports byte ranges</span><br><span class="line">    //</span><br><span class="line">    const rangeEnd = parts[1] &amp;&amp; parts[1].trim()</span><br><span class="line">    const __rangeEnd = rangeEnd ? parseInt(rangeEnd, 10) : undefined</span><br><span class="line">    const end = __rangeEnd === 1 ? __rangeEnd : (Math.min(start + chunkSize, videoSize) - 1) // We remove 1 byte because start and end start from 0</span><br><span class="line">    const contentLength = end - start + 1 // We add 1 byte because start and end start from 0</span><br><span class="line"></span><br><span class="line">    response.set(&apos;Content-Range&apos;, `bytes $&#123;start&#125;-$&#123;end&#125;/$&#123;videoSize&#125;`)</span><br><span class="line">    response.set(&apos;Accept-Ranges&apos;, &apos;bytes&apos;)</span><br><span class="line">    response.set(&apos;Content-Length&apos;, contentLength)</span><br><span class="line"></span><br><span class="line">    const stream = fs.createReadStream(videoPath, &#123; start, end &#125;)</span><br><span class="line">    stream.on(&apos;error&apos;, (err) =&gt; &#123;</span><br><span class="line">        console.log(err.toString())</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    response.status = 206</span><br><span class="line">    response.type = path.extname(name)</span><br><span class="line">    response.body = stream</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// We ignore ECONNRESET, ECANCELED and ECONNABORTED errors</span><br><span class="line">// because when the browser closes the connection, the server</span><br><span class="line">// tries to read the stream. So, the server says that it cannot</span><br><span class="line">// read a closed stream.</span><br><span class="line">//</span><br><span class="line">app.on(&apos;error&apos;, (err) =&gt; &#123;</span><br><span class="line">    if (![&apos;ECONNRESET&apos;, &apos;ECANCELED&apos;, &apos;ECONNABORTED&apos;].includes(err.code)) &#123;</span><br><span class="line">        console.log(err.toString())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Add Koa Router middleware</span><br><span class="line">//</span><br><span class="line">app.use(router.routes())</span><br><span class="line">app.use(router.allowedMethods())</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Start the server on the specified PORT</span><br><span class="line">//</span><br><span class="line">app.listen(PORT)</span><br><span class="line">console.log(&apos;Video Streaming Server is running on Port&apos;, PORT)</span><br></pre></td></tr></table></figure></p>
<p>可以看出，前端部分的代码跟第一个例子一样，直接给<code>video</code>标签的<code>src</code>一个视频链接地址，但是这个地址指向后台一个api接口。<br><code>video</code>标签默认会在请求头加上<code>Content-Range</code>属性，后端接口会根据这个属性去返回对应的数据。对于前端开发来说是无感的，因为浏览器已经自动完成了，只需要对后端接口做处理即可。<br><a href="https://github.com/jinux7/study-collections/tree/master/video%E8%A7%86%E9%A2%91/video-streaming" target="_blank" rel="noopener">源码</a></p>
<h3 id="mediaSource方式"><a href="#mediaSource方式" class="headerlink" title="mediaSource方式"></a>mediaSource方式</h3><p>这个方式用到了MediaSource这个API，允许JavaScript创建和处理媒体数据源，使得浏览器能够播放来自各种来源的自定义媒体数据，而不是只限于原始的文件或 URL。<br>前端代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;video id=&quot;video&quot; width=&quot;800&quot; height=&quot;400&quot; webkit-playsinline=&quot;true&quot; controls playsinline=&quot;true&quot; type=&quot;video/mp4&quot; muted x5-video-player-type=&quot;h5&quot; &gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      var PostbirdMp4ToBlob = &#123;</span><br><span class="line">        mediaSource:new MediaSource(),</span><br><span class="line">        // 检查是否支持 MediaSource 或者 mimeCodec</span><br><span class="line">        checkSupported: function (cb) &#123;</span><br><span class="line">            if (&apos;MediaSource&apos; in window &amp;&amp; MediaSource.isTypeSupported(this.mimeCodec)) &#123;</span><br><span class="line">                </span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                this.video.src  = assetUrl; // 如果不支持，则直接将 src 修改成原始的url，保证兼容性</span><br><span class="line">                console.error(&apos;Unsupported MediaSource or unsupported MIME type or codec: &apos;, this.mimeCodec);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 初始化 selector / assetUrl / mimeCodec / autoPlay</span><br><span class="line">        // selector：video的选择器 exp: &apos;#video&apos;</span><br><span class="line">        // assetUrl: video的请求地址 exp : &apos;./v.mp4&apos;</span><br><span class="line">        // mimeCodec: 编码模式  exp:  &apos;video/mp4; codecs=&quot;avc1.640028, mp4a.40.2&quot;&apos;</span><br><span class="line">        init: function (selector, assetUrl, mimeCodec) &#123;</span><br><span class="line">            this.video = document.querySelector(selector); // 获取vide dom</span><br><span class="line">            this.assetUrl = assetUrl;</span><br><span class="line">            this.mimeCodec = mimeCodec;</span><br><span class="line">            this.checkSupported();</span><br><span class="line">            this.start();// 开启</span><br><span class="line">        &#125;,</span><br><span class="line">        start: function () &#123;</span><br><span class="line">            console.log(this.mediaSource.readyState); // closed </span><br><span class="line">            this.video.src = URL.createObjectURL(this.mediaSource);</span><br><span class="line">            this.mediaSource.addEventListener(&apos;sourceopen&apos;, this.sourceOpen.bind(this));// bind(this) 保证回调</span><br><span class="line">        &#125;,</span><br><span class="line">        // MediaSource sourceopen 事件处理</span><br><span class="line">        sourceOpen: function (_) &#123;</span><br><span class="line">            var _this = this;</span><br><span class="line">            console.log(this.mediaSource.readyState); // open</span><br><span class="line">            var sourceBuffer = this.mediaSource.addSourceBuffer(this.mimeCodec);</span><br><span class="line">            this.fetchAB(this.assetUrl, function (buf) &#123;</span><br><span class="line">                sourceBuffer.addEventListener(&apos;updateend&apos;, function (_) &#123;</span><br><span class="line">                    _this.mediaSource.endOfStream();// 结束</span><br><span class="line">                    _this.video.play(); // 播放视频</span><br><span class="line">                    console.log(_this.mediaSource.readyState); // ended</span><br><span class="line">                &#125;);</span><br><span class="line">                sourceBuffer.appendBuffer(buf);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        // 基于 XHR 的简单封装</span><br><span class="line">        // arguments - url </span><br><span class="line">        // arguments - cb (回调函数)</span><br><span class="line">        fetchAB: function (url, cb) &#123;</span><br><span class="line">            var xhr = new XMLHttpRequest;</span><br><span class="line">            xhr.open(&apos;get&apos;, url);</span><br><span class="line">            xhr.responseType = &apos;arraybuffer&apos;;</span><br><span class="line">            xhr.onload = function () &#123;</span><br><span class="line">                cb(xhr.response);</span><br><span class="line">            &#125;;</span><br><span class="line">            xhr.send();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var codec = &apos;video/mp4; codecs=&quot;avc1.42e01e, mp4a.40.2&quot;&apos;;</span><br><span class="line">        PostbirdMp4ToBlob.init(&apos;#video&apos;, &apos;/video/video1.mp4&apos;, codec);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>后端代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;);</span><br><span class="line">const Router = require(&apos;koa-router&apos;);</span><br><span class="line">const static = require(&apos;koa-static&apos;);</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;).promises;</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const router = new Router();</span><br><span class="line"></span><br><span class="line">app.use(static(&apos;./static&apos;));</span><br><span class="line">app.use(router.routes());</span><br><span class="line"></span><br><span class="line">app.listen(8080, () =&gt; &#123;</span><br><span class="line">    console.log(&apos;server is run at 8080......&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>后端是一个静态资源服务器</p>
<blockquote>
<p>这里需要注意下，用MediaSource接口来播放视频，对视频文件是有要求的，目前例子中的mp4文件可以播放，但是笔者试了很多方式来转换其它的视频文件都没有成功，目前也在尝试中。</p>
</blockquote>
<p><a href="https://github.com/jinux7/study-collections/tree/master/video%E8%A7%86%E9%A2%91/media-source" target="_blank" rel="noopener">源码</a></p>
<h3 id="m3u8-Hls方式"><a href="#m3u8-Hls方式" class="headerlink" title="m3u8 Hls方式"></a>m3u8 Hls方式</h3><p>.m3u8文件本质上是一个索引文件，其中包含了指向一系列多媒体片段（通常是经过加密或未加密的TS格式文件）的URL列表。<br>前端代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;video-m3u8&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;video-list&quot;&gt;</span><br><span class="line">        &lt;div&gt;播放列表&lt;/div&gt;</span><br><span class="line">        &lt;ul&gt;&lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;video id=&quot;video&quot; controls autoplay&gt;&lt;/video&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script type=&quot;module&quot; src=&quot;/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">// main.js</span><br><span class="line">import &apos;./style.css&apos;;</span><br><span class="line">import Hls from &apos;hls.js&apos;;</span><br><span class="line">var video = document.getElementById(&apos;video&apos;);</span><br><span class="line">var videoList = [&apos;video1&apos;, &apos;video2&apos;, &apos;video3&apos;, &apos;video4&apos;, &apos;video5&apos;];</span><br><span class="line">// 创建buttons并插入dom</span><br><span class="line">var nUl = document.querySelector(&apos;.video-list ul&apos;);</span><br><span class="line">videoList.forEach(item=&gt; &#123;</span><br><span class="line">  var nLi= document.createElement(&apos;li&apos;);</span><br><span class="line">  var nBtn= document.createElement(&apos;button&apos;);</span><br><span class="line">  nBtn.textContent = item;</span><br><span class="line">  nLi.appendChild(nBtn);</span><br><span class="line">  nUl.appendChild(nLi);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">playVideo(videoList[0]);</span><br><span class="line"></span><br><span class="line">// 按钮添加事件</span><br><span class="line">var buttons = document.querySelectorAll(&apos;.video-list button&apos;);</span><br><span class="line">for(let btn of buttons) &#123;</span><br><span class="line">  btn.onclick = (evt)=&gt; &#123;</span><br><span class="line">    let videoName = evt.target.textContent;</span><br><span class="line">    playVideo(videoName);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 播放video</span><br><span class="line">function playVideo(videoName) &#123;</span><br><span class="line">  if (Hls.isSupported()) &#123;</span><br><span class="line">    var hls = new Hls();</span><br><span class="line">    hls.loadSource(&apos;http://127.0.0.1:3000/&apos;+videoName+&apos;.m3u8&apos;);</span><br><span class="line">    hls.attachMedia(video);</span><br><span class="line">    hls.on(Hls.Events.MANIFEST_PARSED, function () &#123;</span><br><span class="line">      // video.play();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; else if (video.canPlayType(&apos;application/vnd.apple.mpegurl&apos;)) &#123;</span><br><span class="line">    video.src = &apos;http://127.0.0.1:3000/&apos;+videoName+&apos;.m3u8&apos;;</span><br><span class="line">    video.addEventListener(&apos;loadedmetadata&apos;, function () &#123;</span><br><span class="line">      // video.play();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>js文件中需要<code>hls.js</code>库。</p>
<blockquote>
<p>hls.js 是一个开源的JavaScript库，专为解决在现代Web浏览器上播放基于HTTP Live Streaming (HLS)协议的视频内容而设计。HLS协议由苹果公司开发，被广泛用于在网络上分发实时和点播视频内容，尤其适用于移动端和桌面设备。<br>HLS协议的工作原理是将长视频文件切割成一系列小的媒体片段（通常为MPEG-2 Transport Stream格式，扩展名为.ts），并通过一个M3U8索引文件来组织这些片段。M3U8文件包含了指向各个视频片段的URL以及元数据，如分辨率、编码类型等信息。</p>
</blockquote>
<p><code>video.src = &#39;http://127.0.0.1:3000/&#39;+videoName+&#39;.m3u8&#39;</code>这段代码是指向一个<code>.m3u8</code>的文件，这个文件怎么生成的呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">// creatM3u8.js</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const fluentFFmpeg = require(&apos;fluent-ffmpeg&apos;);</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">// 输入文件夹</span><br><span class="line">const inputFolder = path.resolve(__dirname, &apos;./sourceVideos&apos;);</span><br><span class="line">// 输入文件夹下的所有视频文件list</span><br><span class="line">const files = fs.readdirSync(inputFolder);</span><br><span class="line"></span><br><span class="line">// 输出目录，用于保存生成的 TS 文件和 M3U8 索引文件</span><br><span class="line">const outputDir = path.resolve(__dirname, &apos;./public&apos;);</span><br><span class="line">// FfmpegCommand实例变量</span><br><span class="line">let command;</span><br><span class="line">// 删除文件夹内容</span><br><span class="line">deleteFolderRecursiveSync(outputDir);</span><br><span class="line">// 循环files文件列表，逐个转换</span><br><span class="line">(async ()=&gt; &#123;</span><br><span class="line">  for(let file of files) &#123;</span><br><span class="line">    // 创建一个 FfmpegCommand 实例</span><br><span class="line">    command = fluentFFmpeg();</span><br><span class="line">    await creatVideos(file);</span><br><span class="line">    console.log(&apos;-----完成转换&apos;+file+&apos;-----&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">function creatVideos(file) &#123;</span><br><span class="line">  return new Promise((resolve, reject )=&gt; &#123;</span><br><span class="line">    console.log(&apos;-----开始转换&apos;+file+&apos;-----&apos;);</span><br><span class="line">    const basenameWithExt = path.basename(file);</span><br><span class="line">    const extname = path.extname(basenameWithExt);</span><br><span class="line">    const fileNameWithoutExt = basenameWithExt.slice(0, -extname.length);</span><br><span class="line">    // 设置输出目录和 HLS 参数</span><br><span class="line">    command.input(`$&#123;inputFolder&#125;/$&#123;file&#125;`)</span><br><span class="line">    .output(`$&#123;outputDir&#125;/$&#123;fileNameWithoutExt&#125;.m3u8`)</span><br><span class="line">    .outputOptions([</span><br><span class="line">      &apos;-hls_time 10&apos;, // 每个切片时长为 10 秒</span><br><span class="line">      &apos;-hls_list_size 0&apos;, // 不限制播放列表的大小（无限循环）</span><br><span class="line">      `-hls_segment_filename $&#123;outputDir&#125;/$&#123;file&#125;_%03d.ts`, // 指定切片文件命名规则</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    // 执行转换过程</span><br><span class="line">    command</span><br><span class="line">    .on(&apos;progress&apos;, function(progress) &#123;</span><br><span class="line">      let per = parseInt(progress.percent || 0);</span><br><span class="line">      console.log(&apos;转换进度: &apos; + per + &apos;%&apos;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(&apos;end&apos;, () =&gt; &#123;</span><br><span class="line">      // console.log(&apos;HLS 转换完成！&apos;);</span><br><span class="line">      resolve(file);</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(&apos;error&apos;, (err) =&gt; &#123;</span><br><span class="line">      console.error(&apos;An error occurred: &apos; + err.message);</span><br><span class="line">    &#125;)</span><br><span class="line">    .run();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">// 删除文件夹内容</span><br><span class="line">function deleteFolderRecursiveSync(folderPath) &#123;</span><br><span class="line">  if (!fs.existsSync(folderPath)) return;</span><br><span class="line"></span><br><span class="line">  const files = fs.readdirSync(folderPath);</span><br><span class="line"></span><br><span class="line">  for (let i = 0; i &lt; files.length; i++) &#123;</span><br><span class="line">    const filePath = path.join(folderPath, files[i]);</span><br><span class="line"></span><br><span class="line">    if (fs.lstatSync(filePath).isDirectory()) &#123;</span><br><span class="line">      // 如果是子目录，则递归删除</span><br><span class="line">      deleteFolderRecursiveSync(filePath);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 如果是文件，则直接删除</span><br><span class="line">      fs.unlinkSync(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个文件读取目录<code>sourceVideos</code>文件夹下的mp4文件，并且分成n个视频片段和.m3u8文件，保存到了public目录下。<br>public目录是一个静态资源服务器文件夹，前端<code>hls.js</code>库会拿到<code>m3u8</code>文件，解析文件内容，加载视频片段并播放。<br><a href="https://github.com/jinux7/study-collections/tree/master/video%E8%A7%86%E9%A2%91/m3u8" target="_blank" rel="noopener">源码</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上简单介绍并列举了几种<code>video</code>标签在web视频播放中的例子。</p>

        </div>

        
            <div class="article-tags tags">
                
                    <a href="/tags/基础知识/"><i class="fa fa-tag"></i>&nbsp;&nbsp;基础知识</a>
                
                    <a href="/tags/html/"><i class="fa fa-tag"></i>&nbsp;&nbsp;html</a>
                
            </div>
        

        
            <div class="art-item-footer">
                
                    <span class="art-item-left">
                        <i class="fa fa-chevron-left" aria-hidden="true"></i>&nbsp;
                        <a href="/2024/05/30/windows系统安装redis/" rel="prev" title="windows系统安装Redis">
                            windows系统安装Redis
                        </a>
                    </span>
                
                
                    <span class="art-item-right">
                        <a href="/2024/03/18/npm安装不同版本的一个包/" rel="next" title="npm安装不同版本的一个包">
                            npm安装不同版本的一个包
                        </a>&nbsp;
                        <i class="fa fa-chevron-right" aria-hidden="true"></i>
                    </span>
                
            </div>
        

    </section>

</article>

<br>

<!-- 显示推荐文章和评论 -->


<script>
    window.subData = {
        title: 'web视频播放浅析',
        tools: true
    }
</script>


      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>
    
        <img class='avatar waves-image' src='https://avatars2.githubusercontent.com/u/20313228?s=400&u=81b6a332e9a0f8c63e4841766106f3c8f881cfb5&v=4' />
    
</section>


  <section class='m_widget categories'>
<div class='header'><i class="fa fa-sitemap" aria-hidden="true"></i>&nbsp;&nbsp;分类</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/css/"><div class='name'>css</div><div class='badge'>11</div></a></li>
    
        <li><a class="flat-box" href="/categories/javascript/"><div class='name'>javascript</div><div class='badge'>177</div></a></li>
    
        <li><a class="flat-box" href="/categories/nodejs/"><div class='name'>nodejs</div><div class='badge'>19</div></a></li>
    
        <li><a class="flat-box" href="/categories/服务器/"><div class='name'>服务器</div><div class='badge'>15</div></a></li>
    
        <li><a class="flat-box" href="/categories/计算机原理/"><div class='name'>计算机原理</div><div class='badge'>21</div></a></li>
    
    </ul>
    
</div>
</section>


  
<div class="m_widget tagcloud">
    <div class="header"><i class="fa fa-tags" aria-hidden="true"></i>&nbsp;&nbsp;标签</div>
    <div class='content'>
        <a href="/tags/3D/" style="font-size: 14.77px; color: #949494">3D</a> <a href="/tags/AI/" style="font-size: 14px; color: #999">AI</a> <a href="/tags/MYSQL笔记/" style="font-size: 20.15px; color: #6f6f6f">MYSQL笔记</a> <a href="/tags/Threejs/" style="font-size: 15.54px; color: #8f8f8f">Threejs</a> <a href="/tags/ajax/" style="font-size: 17.85px; color: #7f7f7f">ajax</a> <a href="/tags/canvas/" style="font-size: 14.77px; color: #949494">canvas</a> <a href="/tags/cordova/" style="font-size: 14px; color: #999">cordova</a> <a href="/tags/docker/" style="font-size: 14px; color: #999">docker</a> <a href="/tags/github/" style="font-size: 17.85px; color: #7f7f7f">github</a> <a href="/tags/hexo/" style="font-size: 14px; color: #999">hexo</a> <a href="/tags/html/" style="font-size: 17.08px; color: #848484">html</a> <a href="/tags/jquery/" style="font-size: 15.54px; color: #8f8f8f">jquery</a> <a href="/tags/linux/" style="font-size: 14.77px; color: #949494">linux</a> <a href="/tags/nodejs/" style="font-size: 15.54px; color: #8f8f8f">nodejs</a> <a href="/tags/npm/" style="font-size: 14px; color: #999">npm</a> <a href="/tags/typescript/" style="font-size: 14px; color: #999">typescript</a> <a href="/tags/vue/" style="font-size: 20.92px; color: #6a6a6a">vue</a> <a href="/tags/webSocket/" style="font-size: 14px; color: #999">webSocket</a> <a href="/tags/webpack/" style="font-size: 17.85px; color: #7f7f7f">webpack</a> <a href="/tags/web图形/" style="font-size: 17.85px; color: #7f7f7f">web图形</a> <a href="/tags/web安全/" style="font-size: 17.85px; color: #7f7f7f">web安全</a> <a href="/tags/web性能/" style="font-size: 18.62px; color: #7a7a7a">web性能</a> <a href="/tags/worker/" style="font-size: 14.77px; color: #949494">worker</a> <a href="/tags/兼容性/" style="font-size: 15.54px; color: #8f8f8f">兼容性</a> <a href="/tags/后端/" style="font-size: 15.54px; color: #8f8f8f">后端</a> <a href="/tags/后端代理服务/" style="font-size: 14px; color: #999">后端代理服务</a> <a href="/tags/图片处理/" style="font-size: 17.85px; color: #7f7f7f">图片处理</a> <a href="/tags/基础知识/" style="font-size: 24px; color: #555">基础知识</a> <a href="/tags/少儿编程/" style="font-size: 14px; color: #999">少儿编程</a> <a href="/tags/工具库/" style="font-size: 23.23px; color: #5a5a5a">工具库</a> <a href="/tags/微信/" style="font-size: 14.77px; color: #949494">微信</a> <a href="/tags/手写/" style="font-size: 19.38px; color: #747474">手写</a> <a href="/tags/文章收集/" style="font-size: 14px; color: #999">文章收集</a> <a href="/tags/日语/" style="font-size: 17.85px; color: #7f7f7f">日语</a> <a href="/tags/样式/" style="font-size: 17.85px; color: #7f7f7f">样式</a> <a href="/tags/正则/" style="font-size: 14px; color: #999">正则</a> <a href="/tags/浏览器/" style="font-size: 16.31px; color: #898989">浏览器</a> <a href="/tags/爬虫/" style="font-size: 14px; color: #999">爬虫</a> <a href="/tags/移动端/" style="font-size: 21.69px; color: #656565">移动端</a> <a href="/tags/算法/" style="font-size: 15.54px; color: #8f8f8f">算法</a> <a href="/tags/编译/" style="font-size: 17.08px; color: #848484">编译</a> <a href="/tags/网络基础/" style="font-size: 20.15px; color: #6f6f6f">网络基础</a> <a href="/tags/调试/" style="font-size: 14.77px; color: #949494">调试</a> <a href="/tags/资源导航/" style="font-size: 14.77px; color: #949494">资源导航</a> <a href="/tags/软考/" style="font-size: 14px; color: #999">软考</a> <a href="/tags/面试题/" style="font-size: 22.46px; color: #5f5f5f">面试题</a> <a href="/tags/面试题系列/" style="font-size: 17.85px; color: #7f7f7f">面试题系列</a>
    </div>
</div>




      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">
    <div class="social-wrapper">
      
    </div>
    <br>
    <div>博客内容遵循 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="licenses">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></div>
    <div>本站使用 <a href="https://github.com/xaoxuu/hexo-theme-material-x" target="_blank" class="codename">Material-X</a> 作为主题，
		总访问量为 <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
    </div>

</footer>

  <script>setLoadingBarProgress(80);</script>
  <!-- <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/js/jquery.min.js"></script>
<!-- <script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script> -->
<script src="/js/waves.min.js"></script>
<!-- <script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script> -->
<script src="/js/scrollreveal.min.js"></script>
<!-- 访问统计 -->
<!-- <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- 推荐文章 -->
<!-- <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script> -->
<!-- <script src="//unpkg.com/valine/dist/Valine.min.js"></script> -->
<script src="/js/jquery.fitvids.js"></script>
<script>
var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
var ALGOLIA_API_KEY = "";
var ALGOLIA_APP_ID = "";
var ALGOLIA_INDEX_NAME = "";
var AZURE_SERVICE_NAME = "";
var AZURE_INDEX_NAME = "";
var AZURE_QUERY_KEY = "";
var BAIDU_API_ID = "";
var SEARCH_SERVICE = "hexo";
var ROOT = "/"||"/";
if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


    
    
    


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
